Kekule.ChemWidget={};Kekule.ChemWidget.AbstractWidget=Kekule.Widget.BaseWidget;Kekule.ChemWidget.ComponentWidgetNames={menu:"menu",newDoc:"newDoc",clearObjs:"clearObjs",loadFile:"loadFile",loadData:"loadData",saveData:"saveData",zoomIn:"zoomIn",zoomOut:"zoomOut",resetZoom:"resetZoom",rotateRight:"rotateRight",rotateLeft:"rotateLeft",rotateX:"rotateX",rotateY:"rotateY",rotateZ:"rotateZ",reset:"reset",molDisplayType:"molDisplayType",molDisplayTypeCondensed:"molDisplayTypeCondensed",molDisplayTypeSkeletal:"molDisplayTypeSkeletal",molDisplayTypeWire:"molDisplayTypeWire",molDisplayTypeSticks:"molDisplayTypeSticks",molDisplayTypeBallStick:"molDisplayTypeBallStick",molDisplayTypeSpaceFill:"molDisplayTypeSpaceFill",molHideHydrogens:"molHideHydrogens",openEditor:"openEditor",config:"config",objInspector:"objInspector",undo:"undo",redo:"redo",copy:"copy",cut:"cut",paste:"paste",cloneSelection:"cloneSelection",toggleSelect:"toggleSelect",dragScroll:"dragScroll",erase:"erase",manipulate:"manipulate",trackInput:"trackInput",molBond:"bond",molAtom:"atom",molFormula:"formula",molAtomAndFormula:"atomAndFormula",molCharge:"charge",textBlock:"textBlock",imageBlock:"imageBlock",molRing:"ring",glyph:"glyph",textImage:"textImage",fontName:"fontName",fontSize:"fontSize",color:"color",textDirection:"textDirection",textAlign:"textAlign"};Kekule.ChemWidget.HtmlClassNames={PREFIX:"K-Chem-",INNER_TOOLBAR:"K-Chem-InnerToolbar"};(function(){var d=Class.PropertyScope;var b=Kekule.ChemWidget;var a=Kekule.Widget.HtmlClassNames;var c=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DIALOG_LOADDATA:"K-Chem-Dialog-LoadData",DIALOG_LOADDATA_FORMATBOX:"K-Chem-Dialog-LoadData-FormatBox",DIALOG_LOADDATA_SRCEDITOR:"K-Chem-Dialog-LoadData-SrcEditor",DIALOG_LOADDATA_BTN_LOADFROMFILE:"K-Chem-Dialog-LoadData-Btn-LoadFromFile"});Kekule.ChemWidget.LoadDataDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.ChemWidget.LoadDataDialog",initialize:function($super,e,f,g){this._openFileAction=new Kekule.ActionLoadFileData();this._openFileAction.update();this._openFileAction.addEventListener("load",this.reactFileLoad,this);this._sBtnLoadFromFile=Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_FROM_FILE");this._formatItems=null;$super(e,f||Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG"),g||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);if(this.setResizable){this.setResizable(true)}},finalize:function($super){this._openFileAction.finalize();$super()},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,setter:null});this.defineProp("allowedFormatIds",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("allowedFormatIds",e);this.updateFormatItems()}})},initPropValues:function($super){$super();this.setAutoAdjustSizeOnPopup(true)},doGetWidgetClassName:function($super){return $super()+" "+c.DIALOG_LOADDATA},doCreateClientContents:function($super,i){$super();var h=this.getDocument();var f=h.createElement("div");f.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_FORMAT");i.appendChild(f);f=h.createElement("div");i.appendChild(f);var e=new Kekule.Widget.SelectBox(this);e.addClassName(c.DIALOG_LOADDATA_FORMATBOX);e.appendToElem(f);this._formatSelector=e;this.updateFormatItems();var f=h.createElement("div");f.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_SRC");i.appendChild(f);f=h.createElement("div");i.appendChild(f);var g=new Kekule.Widget.TextEditor(this);g.setWrap("off");g.setToolbarPos(Kekule.Widget.Position.BOTTOM);g.addClassName(c.DIALOG_LOADDATA_SRCEDITOR);g.appendToElem(f);this._dataEditor=g},getFormatSelectorItems:function(e){var s=[];var p=this.getAllowedFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds();for(var n=0,g=p.length;n<g;++n){var f=Kekule.IO.DataFormatsManager.getFormatInfo(p[n]);if(f){var o=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(f.fileExts));for(var m=0,h=o.length;m<h;++m){o[m]="*."+o[m]}var r=o.join(", ");var q=f.title;if(r){q+=" ("+r+")"}s.push({value:f.mimeType,text:q,title:f.mimeType,data:f})}}s.sort(function(j,i){return(j.text<i.text)?-1:(j.text>i.text)?1:0});return s},getFileFilters:function(j){var e=[];for(var h=0,f=j.length;h<f;++h){var m=j[h];var k=m.data;var n=m.text||m.title||m.value;var g=Kekule.ArrayUtils.toArray(k.fileExts);e.push({title:n,filter:"."+g.join(",.")})}e.push(Kekule.NativeServices.FILTER_ALL_SUPPORT);e.push(Kekule.NativeServices.FILTER_ANY);return e},updateFormatItems:function(){this._formatItems=this.getFormatSelectorItems();this._formatSelector.setItems(this._formatItems);var e=this.getFileFilters(this._formatItems);this._openFileAction.setFilters(e)},doSetButtons:function($super,g){var f=g||[];if(f.indexOf(this._sBtnLoadFromFile)<0){f.unshift(this._sBtnLoadFromFile)}$super(f);var e=this.getDialogButton(this._sBtnLoadFromFile);e.setAction(this._openFileAction);e.linkStyleResource(Kekule.Widget.StyleResourceNames.BUTTON_LOAD_FILE);e.addClassName(c.DIALOG_LOADDATA_BTN_LOADFROMFILE);e.setEnabled(this._openFileAction.getEnabled())},reactFileLoad:function(i){var h=i.data;var k=i.fileName;var j;try{if(i.success&&h&&k){j=Kekule.IO.loadTypedData(h,null,k);this.setPropStoreFieldValue("chemObj",j);var f=Kekule.Widget.DialogButtons.OK;this.close(f)}else{j=null}}catch(g){Kekule.error(g)}},open:function($super,g,e,f){this.setPropStoreFieldValue("chemObj",null);return $super(g,e,f)},close:function($super,f){if(!this.getChemObj()){if(this.isPositiveResult(f)){var g=this._dataEditor.getValue();var i=this._formatSelector.getValue();try{var j=Kekule.IO.loadTypedData(g,i);if(j){this.setPropStoreFieldValue("chemObj",j)}else{Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}}catch(h){Kekule.raise(h,Kekule.ExceptionLevel.ERROR)}}}return $super(f)}})})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;var d=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{PERIODIC_TABLE:"K-Chem-Periodic-Table",PERIODIC_TABLE_MINI:"K-Chem-Periodic-Table-Mini",PERIODIC_TABLE_LEGEND:"K-Chem-Periodic-Table-Legend",PERIODIC_TABLE_LEGEND_CONTENT:"K-Chem-Periodic-Table-Legend-Content",PERIODIC_TABLE_LEGEND_COLORS:"K-Chem-Periodic-Table-Legend-Colors",PERIODIC_TABLE_LEGEND_COLOR:"K-Chem-Periodic-Table-Legend-Color",PERIODIC_TABLE_MAINTABLE:"K-Chem-Periodic-Table-MainTable",PERIODIC_TABLE_EXTRATABLE:"K-Chem-Periodic-Table-ExtraTable",PERIODIC_TABLE_ELEM_CELL:"K-Chem-Periodic-Table-Elem-Cell",PERIODIC_TABLE_ELEM_STUBSCELL:"K-Chem-Periodic-Table-Elem-StubsCell",PERIODIC_TABLE_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_HEAD_CELL:"K-Chem-Periodic-Table-Head-Cell",PERIODIC_TABLE_HEAD_CELL_CONTENT:"K-Chem-Periodic-Table-Head-Cell-Content",PERIODIC_TABLE_HEAD_CELL_GROUP:"K-Chem-Periodic-Table-Head-Cell-Group",PERIODIC_TABLE_HEAD_CELL_PERIOD:"K-Chem-Periodic-Table-Head-Cell-Period",ELEM_SYMBOL:"K-Chem-Elem-Symbol",ELEM_SYMBOL_STUBS:"K-Chem-Elem-Symbol-Stubs",ELEM_NAME:"K-Chem-Elem-Name",ATOMIC_NUM:"K-Chem-Atomic-Num",ATOMIC_WEIGHT:"K-Chem-Atomic-Weight"});Kekule.globalOptions.add("chemWidget.periodicTable",{displayedComponents:["symbol","name","atomicNumber","groupHead","legend"]});Kekule.ChemWidget.PeriodicTable=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.PeriodicTable",BINDABLE_TAG_NAMES:["span","div"],ELEM_DATA_FIELD:"__$elemData__",MAX_GROUP:18,MAX_PERIOD:7,LA_SERIES:["La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu"],AC_SERIES:["Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr"],initialize:function($super,e,f){this.setPropStoreFieldValue("displayedComponents",f||this.getDefaultDisplayedComponents());this._elemCells=[];this._selectedElemCells=[];$super(e);this.setEnableSelect(true);this.setEnableMultiSelect(true)},initProperties:function(){this.defineProp("displayedComponents",{dataType:DataType.ARRAY,getter:function(){return this.getPropStoreFieldValue("displayedComponents")||this.getDefaultDisplayedComponents()}});this.defineProp("startingAtomNum",{dataType:DataType.INT});this.defineProp("endingAtomNum",{dataType:DataType.INT});this.defineProp("useMiniMode",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useMiniMode",e);if(e){this.addClassName(d.PERIODIC_TABLE_MINI)}else{this.removeClassName(d.PERIODIC_TABLE_MINI)}}});this.defineProp("enableSelect",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableSelect")||this.getEnableMultiSelect()}});this.defineProp("enableMultiSelect",{dataType:DataType.BOOL});this.defineProp("selected",{dataType:DataType.HASH,serializable:false,setter:null,getter:function(){return this.getSelection()?this.getSelection()[0]:null}});this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,setter:null,getter:function(){var e=[];var g=this._selectedElemCells||[];for(var h=0,f=g.length;h<f;++h){var j=g[h][this.ELEM_DATA_FIELD];if(j){e.push(j)}}return e}});this.defineProp("selectedSymbol",{dataType:DataType.STRING,getter:function(){return this.getSelectedSymbols()[0]},setter:function(e){this.setSelectedSymbols([e])}});this.defineProp("selectedSymbols",{dataType:DataType.ARRAY,getter:function(){var h=this.getSelection();if(h){var e=[];for(var g=0,f=h.length;g<f;++g){e.push(h[g].symbol)}return e}return[]},setter:function(e){this.selectSymbols(e)}})},doGetWidgetClassName:function($super){return $super()+" "+d.PERIODIC_TABLE},doCreateRootElement:function(f){var e=f.createElement("div");return e},doCreateSubElements:function($super,g,e){$super(g,e);var f=this.createMainTable(g,e);return[f]},doObjectChange:function(e){var f=["displayedComponents","startingAtomNum","endingAtomNum"];if(Kekule.ArrayUtils.intersect(e,f).length){this.recreateMainTable()}},getDefaultDisplayedComponents:function(){return Kekule.globalOptions.chemWidget.periodicTable.displayedComponents},getShowElemSymbol:function(){var e=this.getDisplayedComponents();return e.indexOf("symbol")>=0},getShowElemName:function(){var e=this.getDisplayedComponents();return e.indexOf("name")>=0},getShowAtomicNum:function(){var e=this.getDisplayedComponents();return e.indexOf("atomicNumber")>=0},getShowAtomicWeight:function(){var e=this.getDisplayedComponents();return e.indexOf("atomicWeight")>=0},getShowGroupHead:function(){var e=this.getDisplayedComponents();return e.indexOf("groupHead")>=0},getShowPeriodHead:function(){var e=this.getDisplayedComponents();return e.indexOf("periodHead")>=0},getShowLegend:function(){var e=this.getDisplayedComponents();return e.indexOf("legend")>=0},recreateMainTable:function(){this.deselectAll();var e=this.getElement();b.clearChildContent(e);this.createMainTable(e.ownerDocument,e)},createMainTable:function(L,y){var E=Kekule.chemicalElementsData;var g=[];this._elemCells=[];var r=[];var u=[];var w=L.createElement("table");for(var n=0;n<=this.MAX_PERIOD;++n){var j=L.createElement("tr");var o=[];for(var h=0;h<=this.MAX_GROUP;++h){var s=L.createElement("td");j.appendChild(s);o.push(s)}w.appendChild(j);g.push(o)}var e=L.createElement("table");for(var n=0;n<2;++n){var j=L.createElement("tr");var o=[];for(var h=0;h<this.LA_SERIES.length;++h){var s=L.createElement("td");j.appendChild(s);o.push(s)}e.appendChild(j);r.push(o)}var J=this.getStartingAtomNum()||0;var f=this.getEndingAtomNum()||300000;for(var C=0,A=E.length;C<A;++C){var G=E[C];var q=G.atomicNumber;if(q<J||q>f){continue}var B=G.symbol;var D=G.period;var p=G.group;var k=G.chemicalSerie.replace(/\s/g,"");Kekule.ArrayUtils.pushUnique(u,G.chemicalSerie);var s;var v=this.LA_SERIES.indexOf(B);var t=this.AC_SERIES.indexOf(B);if(v>=0){s=r[0][v]}else{if(t>=0){s=r[1][t]}else{if(D&&p){s=g[D][p]}}}if(s){s.className=d.PERIODIC_TABLE_ELEM_CELL;s.appendChild(this.createElemCellContent(L,G,k.upperFirst()));s[this.ELEM_DATA_FIELD]=G;this._elemCells.push(s)}if((v===0)||(t===0)){s=g[D][p];s.className=d.PERIODIC_TABLE_ELEM_STUBSCELL;s.appendChild(this.createElemCellStubsContent(L,G,k.upperFirst()))}}if(this.getShowGroupHead()){var m=["IA","IIA","IIIB","IVB","VB","VIB","VIIB","","VIII","","IB","IIB","IIIA","IVA","VA","VIA","VIIA","VIIIA"];for(var h=1;h<=this.MAX_GROUP;++h){var n=(h===1)||(h===18)?0:(h===2)||(h>=13)?1:3;var s=g[n][h];s.className=d.PERIODIC_TABLE_HEAD_CELL+" "+d.PERIODIC_TABLE_HEAD_CELL_GROUP;s.appendChild(this.createHeadContent(L,m[h-1]))}}if(this.getShowPeriodHead()){for(var n=1;n<=this.MAX_PERIOD;++n){var s=g[n][0];s.className=d.PERIODIC_TABLE_HEAD_CELL+" "+d.PERIODIC_TABLE_HEAD_CELL_PERIOD;s.appendChild(this.createHeadContent(L,n))}}y.appendChild(w);if(this.getShowLegend()){var K=L.createElement("a");K.href="javascript:void(0)";K.className=d.PERIODIC_TABLE_LEGEND+" "+a.CORNER_ALL;b.setElementText(K,Kekule.$L("ChemWidgetTexts.LEGEND_CAPTION"));var x=L.createElement("div");x.className=d.PERIODIC_TABLE_LEGEND_CONTENT+" "+a.CORNER_ALL;var z={symbol:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_SYMBOL"),atomicNumber:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_NUM"),naturalMass:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_WEIGHT"),name:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_NAME")};var H=this.createElemCellContent(L,z,d.PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT);x.appendChild(H);var I=L.createElement("div");I.className=d.PERIODIC_TABLE_LEGEND_COLORS;for(var C=0,A=u.length;C<A;++C){var F=L.createElement("div");F.className=d.PERIODIC_TABLE_LEGEND_COLOR+" "+u[C].replace(/\s/g,"");b.setElementText(F,u[C]);I.appendChild(F)}x.appendChild(I);K.appendChild(x);y.appendChild(K)}y.appendChild(e);return w},createElemCellContent:function(j,g,k){var e=j.createElement("div");var i=d.PERIODIC_TABLE_ELEM_CELL_CONTENT;if(k){i+=" "+k}e.className=i;if(this.getShowAtomicNum()){e.appendChild(this.createElemContentComponent(j,g.atomicNumber,d.ATOMIC_NUM))}if(this.getShowAtomicWeight()){var h=g.naturalMass;if(h){var f=(typeof(h)==="number")?h.toFixed(3):h;e.appendChild(this.createElemContentComponent(j,f,d.ATOMIC_WEIGHT))}else{e.appendChild(this.createElemContentComponent(j,"\u00a0",d.ATOMIC_WEIGHT))}}if(this.getShowElemSymbol()){e.appendChild(this.createElemContentComponent(j,g.symbol,d.ELEM_SYMBOL))}if(this.getShowElemName()){e.appendChild(this.createElemContentComponent(j,g.name,d.ELEM_NAME))}return e},createElemCellStubsContent:function(i,f,k){var e=i.createElement("div");e.className=d.PERIODIC_TABLE_ELEM_CELL_CONTENT+" "+(k||"");var j,h,g;g=f.chemicalSerie;if(f.symbol==="La"){j="57-71";h="La-Lu"}else{j="89-103";h="Ac-Lr"}if(this.getShowAtomicNum()){e.appendChild(this.createElemContentComponent(i,j,d.ATOMIC_NUM))}if(this.getShowElemSymbol()){e.appendChild(this.createElemContentComponent(i,h,d.ELEM_SYMBOL_STUBS,true))}if(this.getShowElemName()){e.appendChild(this.createElemContentComponent(i,g,d.ELEM_NAME))}return e},createElemContentComponent:function(h,g,e,j){var f=h.createElement("span");f.className=e;if(j){var i=h.createElement("span");f.appendChild(i)}b.setElementText(i||f,g);return f},createHeadContent:function(f,g,h){var e=f.createElement("div");e.className=d.PERIODIC_TABLE_HEAD_CELL_CONTENT+" "+(h||"");b.setElementText(e,g);return e},_getAtomCellElem:function(f){var e=b.getNearestAncestorByTagName(f,"td",true);if(e&&(this._elemCells.indexOf(e)>=0)){return e}else{return null}},_getCellElemOfSymbol:function(k){var g=this._elemCells;for(var h=0,f=g.length;h<f;++h){var e=g[h];var j=e[this.ELEM_DATA_FIELD];if(j.symbol===k){return e}}return null},isCellSelected:function(e){return this._selectedElemCells.indexOf(e)>=0},selectCell:function(e){if(e){c.addClass(e,a.STATE_SELECTED);Kekule.ArrayUtils.pushUnique(this._selectedElemCells,e);this.invokeEvent("select",{elemData:e[this.ELEM_DATA_FIELD]})}},deselectCell:function(e){if(e){c.removeClass(e,a.STATE_SELECTED);Kekule.ArrayUtils.remove(this._selectedElemCells,e);this.invokeEvent("deselect",{elemData:e[this.ELEM_DATA_FIELD]})}},toggleCell:function(e){if(this.isCellSelected(e)){this.deselectCell(e)}else{this.selectCell(e)}},deselectAll:function(){var e=this._selectedElemCells;for(var f=e.length-1;f>=0;--f){this.deselectCell(e[f])}return this},selectSymbols:function(g){this.deselectAll();var j=Kekule.ArrayUtils.toArray(g);for(var h=0,f=j.length;h<f;++h){var e=this._getCellElemOfSymbol(j[h]);if(e){this.selectCell(e)}}return this},react_click:function($super,h){if(this.getEnableSelect()){var g=h.getTarget();var f=this._getAtomCellElem(g);if(f){if(!this.getEnableMultiSelect()){this.deselectAll();this.selectCell(f)}else{this.toggleCell(f)}return true}}$super(h)}})})();(function(){var f=Class.PropertyScope;var d=Kekule.DomUtils;var c=Kekule.ZoomUtils;var b=Kekule.ChemWidget;var a=Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DISPLAYER_DRAWCONTEXT_PARENT:"K-Chem-Displayer-DrawContext-Parent",ACTION_MOL_DISPLAY_TYPE:"K-Chem-MolDisplayType",ACTION_MOL_DISPLAY_SKELETAL:"K-Chem-MolDisplaySkeletal",ACTION_MOL_DISPLAY_CONDENSED:"K-Chem-MolDisplayCondensed",ACTION_MOL_DISPLAY_WIRE:"K-Chem-MolDisplayWire",ACTION_MOL_DISPLAY_BALLSTICK:"K-Chem-MolDisplayBallStick",ACTION_MOL_DISPLAY_STICKS:"K-Chem-MolDisplaySticks",ACTION_MOL_DISPLAY_SPACEFILL:"K-Chem-MolDisplaySpaceFill",ACTION_MOL_HIDE_HYDROGENS:"K-Chem-MolHideHydrogens",ACTION_ZOOMIN:"K-Chem-ZoomIn",ACTION_ZOOMOUT:"K-Chem-ZoomOut",ACTION_RESET:"K-Chem-Reset",ACTION_RESET_ZOOM:"K-Chem-ResetZoom",ACTION_LOADFILE:"K-Chem-LoadFile",ACTION_LOADDATA:"K-Chem-LoadData",ACTION_SAVEFILE:"K-Chem-SaveFile",ACTION_CLEAROBJS:"K-Chem-ClearObjs",ACTION_CONFIG:"K-Chem-Config",DIALOG_CHOOSE_FILE_FORAMT:"K-Chem-Dialog-Choose-File-Format",DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX:"K-Chem-Dialog-Choose-File-Format-FormatBox",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER:"K-Chem-Dialog-Choose-File-Format-Previewer"});Kekule.ChemWidget.ChemObjDisplayerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerConfigs",initProperties:function(){this.addConfigProp("ioConfigs","Kekule.ChemWidget.ChemObjDisplayerIOConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("ioConfigs",new Kekule.ChemWidget.ChemObjDisplayerIOConfigs())}});Kekule.ChemWidget.ChemObjDisplayerIOConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerIOConfigs",initProperties:function(){this.addBoolConfigProp("canonicalizeBeforeSave",true)}});Kekule.ChemWidget.ChemObjDisplayer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer",initialize:function($super,g,j,h,i){this._paintFlag=0;this._bgColorMap={};this._contextTransformOpsMap=new Kekule.MapEx();this.setPropStoreFieldValue("resetAfterLoad",true);this.setPropStoreFieldValue("renderType",h||Kekule.Render.RendererType.R2D);$super(g);if(j){this.setChemObj(j)}this.setEnableLoadNewFile(true);this.setPropStoreFieldValue("displayerConfigs",i||this.createDefaultConfigs())},doFinalize:function($super){this.setChemObj(null);this.getPainter().finalize();var g=this.getPropStoreFieldValue("drawBridge");var h=this.getPropStoreFieldValue("drawContext");if(h&&g){g.releaseContext(h)}if(g.finalize){g.finalize()}this.setPropStoreFieldValue("drawBridge",null);this.setPropStoreFieldValue("drawContext",null);if(this._contextTransformOpsMap){this._contextTransformOpsMap.finalize()}$super()},initProperties:function(){this.defineProp("displayerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:false,scope:f.PUBLIC});this.defineProp("enableLoadNewFile",{dataType:DataType.BOOL});this.defineProp("allowedInputFormatIds",{dataType:DataType.ARRAY});this.defineProp("allowedOutputFormatIds",{dataType:DataType.ARRAY});this.defineProp("standardizationOptions",{dataType:DataType.HASH});this.defineProp("resetAfterLoad",{dataType:DataType.BOOL});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,scope:f.PUBLIC,setter:function(h){var g=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",h);this.chemObjChanged(h,g)}});this.defineProp("chemObjLoaded",{dataType:DataType.BOOL,serializable:false,scope:f.PUBLIC,setter:null,getter:function(){return this.getChemObj()&&this.getPropStoreFieldValue("chemObjLoaded")}});this.defineProp("renderType",{dataType:DataType.INT,serializable:false,scope:f.PUBLISHED,setter:function(h){if(!this.getAllowRenderTypeChange()){Kekule.error(Kekule.$L("ErrorMsg.RENDER_TYPE_CHANGE_NOT_ALLOWED"));return}var g=this.getRenderType();if(h!==g){this.setPropStoreFieldValue("renderType",h);this.resetRenderType(g,h)}}});this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:false,scope:f.PUBLIC,getter:function(){var g=this.getPropStoreFieldValue("renderConfigs");if(!g){g=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()}return g}});this.defineProp("backgroundColor",{dataType:DataType.STRING,scope:f.PUBLISHED,setter:function(g){this.setPropStoreFieldValue("backgroundColor",g);this._bgColorMap[this.getRenderType().toString()]=g;this.backgroundColorChanged()}});this.defineProp("transformParams",{dataType:DataType.HASH,serializable:false,scope:f.PUBLIC,getter:function(){var g=Object.extend({},this.getDrawOptions());g.screenCoordOffset=this.getBaseCoordOffset();return g},setter:function(g){var h=g||{};this.setDrawOptions(h);this.setBaseCoordOffset(h.baseCoordOffset);this.drawOptionChanged()}});this.defineProp("drawOptions",{dataType:DataType.HASH,serializable:false,scope:f.PUBLIC,getter:function(){var g=this.getPropStoreFieldValue("drawOptions");if(!g){g={};this.setPropStoreFieldValue("drawOptions",g)}return g},setter:function(g){this.setPropStoreFieldValue("drawOptions",g);this.drawOptionChanged()}});this.defineProp("zoom",{dataType:DataType.FLOAT,serializable:false,getter:function(){var g=this.getDrawOptions()||{};return g.zoom},setter:function(g){this.zoomTo(g);return this}});this.defineProp("initialZoom",{dataType:DataType.FLOAT});this.defineProp("autofit",{dataType:DataType.BOOL,serializable:false,getter:function(){var g=this.getDrawOptions()||{};return g.autofit},setter:function(g){var h=this.getDrawOptions()||{};h.autofit=g;return this.setDrawOptions(h)}});this.defineProp("moleculeDisplayType",{dataType:DataType.INT,serializable:false,getter:function(){var g=this.getDrawOptions()||{};return g.moleculeDisplayType},setter:function(g){this.getDrawOptions().moleculeDisplayType=g;this.drawOptionChanged();return this}});this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL,serializable:false,scope:f.PUBLIC,getter:function(){return Kekule.oneOf(this.getDrawOptions().allowCoordBorrow,this.getRenderConfigs().getGeneralConfigs().getAllowCoordBorrow())}});this.defineProp("autoSize",{dataType:DataType.BOOL,serializable:false,setter:function(g){if(g!=this.getAutoSize()){this.setPropStoreFieldValue("autoSize",g);if(g&&this.allowAutoSize()){this.drawOptionChanged()}}}});this.defineProp("padding",{dataType:DataType.INT,serializable:false,setter:function(g){if(g!=this.getPadding()){this.setPropStoreFieldValue("padding",g);this.getDrawOptions().autofitContextPadding=g;this.drawOptionChanged()}}});this.defineProp("baseCoordOffset",{dataType:DataType.Hash,serializable:false,setter:function(g){this.setPropStoreFieldValue("baseCoordOffset",g);if(this.getChemObjLoaded()){this.repaint()}}});this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:false,scope:f.PRIVATE,setter:null,getter:function(h){var g=this.getPropStoreFieldValue("drawBridge");if(!g){g=this.createDrawBridge(h);this.setPropStoreFieldValue("drawBridge",g)}return g}});this.defineProp("drawContext",{dataType:DataType.OBJECT,serializable:false,scope:f.PRIVATE,setter:null,getter:function(){var g=this.getPropStoreFieldValue("drawContext");if(!g){var j=this.getDrawBridge();if(j){var h=this.getDrawContextParentElem();if(!h){return null}else{var i=Kekule.HtmlElementUtils.getElemOffsetDimension(h);g=j.createContext(h,i.width,i.height);this.setPropStoreFieldValue("drawContext",g)}}}return g}});this.defineProp("painter",{dataType:"Kekule.Render.ChemObjPainter",serializable:false,scope:f.PRIVATE,setter:null,getter:function(){var g=this.getPropStoreFieldValue("painter");if(!g){g=this.createNewPainter()}return g}});this.defineProp("rootRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:false,scope:f.PRIVATE,setter:null,getter:function(){var g=this.getPainter();return g?g.getRenderer():null}})},initPropValues:function($super){$super();this.setStandardizationOptions({unmarshalSubFragments:false})},doWidgetShowStateChanged:function($super,g){$super(g);if(g){this.setChemObj(this.getChemObj())}},getAllowRenderTypeChange:function(){return false},resetRenderType:function(j,g){var l=this.getChemObj();var k=this.getPropStoreFieldValue("drawBridge");var i=this.getPropStoreFieldValue("drawContext");if(k){if(i){k.releaseContext(i)}}this.setPropStoreFieldValue("drawContext",null);this.setPropStoreFieldValue("drawBridge",null);var h=this.getBackgroundColorOfType(g);this.getDrawOptions().moleculeDisplayType=this.getDefaultMoleculeDisplayType(g);this.setPropStoreFieldValue("backgroundColor",h);this.backgroundColorChanged(true);this.setChemObj(l||null)},createDefaultConfigs:function(){return new Kekule.ChemWidget.ChemObjDisplayerConfigs()},getCoordMode:function(){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D},setCoordMode:function(h){var g=(h===Kekule.CoordMode.COORD3D)?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(g)},loadPredefinedResDataToProp:function(h,g,j){if(h==="chemObj"){if(j){try{var k=Kekule.IO.loadTypedData(g.data,g.resType,g.resUri);this.setChemObj(k)}catch(i){this.reportException(i)}}else{this.reportException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+g.resUri||"")}}},reportException:function(h,g){Kekule.raise(h,g||Kekule.ExceptionLevel.ERROR)},createDrawBridge:function(h){var i=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.DrawBridge3DMananger:Kekule.Render.DrawBridge2DMananger;var g=i.getPreferredBridgeInstance();if(!g){if(!h){Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"))}}return g},getDrawContextParentElem:function(j){var g=this._drawContextParentElem;if(!g&&!j){g=this.getDocument().createElement("div");this._drawContextParentElem=g;Kekule.HtmlElementUtils.addClass(g,a.DYN_CREATED);Kekule.HtmlElementUtils.addClass(g,e.DISPLAYER_DRAWCONTEXT_PARENT);g.style.width="100%";g.style.height="100%";var h=this.getElement();var i=Kekule.DomUtils.getFirstChildElem(h);if(i){h.insertBefore(g,i)}else{h.appendChild(g)}}return g},allowAutoSize:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D},canModifyPartialGraphic:function(h){var g=this.getDrawBridge();return g.canModifyGraphic?g.canModifyGraphic(h||this.getDrawContext()):false},doInsertedToDom:function(){this.doResize()},doResize:function(){this.refitDrawContext(this.isPainting())},refitDrawContext:function(h){if(this.getDrawBridge(true)&&this.getDrawContext()){var g=Kekule.HtmlElementUtils.getElemClientDimension(this.getDrawContextParentElem());var i=this.changeContextDimension(g);if(!h&&i){this.repaint()}}},getContextDimension:function(){if(this.getDrawBridge()&&this.getDrawContext()){return this.getDrawBridge().getContextDimension(this.getDrawContext())}else{return null}},changeContextDimension:function(g){if(this.getDrawBridge()&&this.getDrawContext()){this.getDrawBridge().setContextDimension(this.getDrawContext(),g.width,g.height);return true}else{return false}},clearContext:function(){var h=this.getPropStoreFieldValue("drawContext");if(h){var g=this.getPropStoreFieldValue("painter");if(g){g.clear(h)}this.getDrawBridge().clearContext(h)}},createNewPainter:function(i){var h=this.getPropStoreFieldValue("painter");if(h){h.finalize()}var g=new Kekule.Render.ChemObjPainter(this.getRenderType(),i,this.getDrawBridge());this.setPropStoreFieldValue("painter",g);return g},chemObjChanged:function(h,g){this.doLoad(h);if(this.getResetAfterLoad()&&g){this.resetDisplay()}},load:function(g){this.setChemObj(g)},doLoad:function(i){this.refitDrawContext(true);this.setPropStoreFieldValue("chemObjLoaded",false);try{if(i){var g=this.createNewPainter(i);g.setRenderConfigs(this.getRenderConfigs());this.repaint();this.setPropStoreFieldValue("chemObjLoaded",true)}else{this.clearContext()}this.invokeEvent("load",{obj:i})}catch(h){this.clearContext();this.reportException(h)}finally{this.doLoadEnd(this.getChemObj())}},doLoadEnd:function(g){},loadFromData:function(g,j,i){try{if(!g){this.setChemObj(null);return null}else{var k=Kekule.IO.loadTypedData(g,j,i);if(k){this.setChemObj(k)}else{Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}return k}}catch(h){this.reportException(h)}},loadFromFile:function(h){if(!h){this.setChemObj(null)}else{var g=this;try{Kekule.IO.loadFileData(h,function(k,j){if(j){g.setChemObj(k)}})}catch(i){this.reportException(i)}}},getSavingTargetObj:function(){return this.getChemObj()},saveData:function(l,g,j){var j=j||this.getSavingTargetObj();this.prepareSaveData(j);var i=Kekule.IO.ChemDataWriterManager.getWriterByFormat(l,null,j);if(i){var k=this._needToCanonicalizeBeforeSaving()&&this.getDisplayerConfigs().getIoConfigs().getCanonicalizeBeforeSave();if(k&&j.standardize){var j=j.clone?j.clone(true):j;j.standardize(this.getStandardizationOptions())}if(!g){var m=Kekule.IO.DataFormatsManager.getFormatInfo(l);g=m.dataType}var h=i.writeData(j,g,l);return h}else{Kekule.error(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT"));return null}},_needToCanonicalizeBeforeSaving:function(){return false},prepareSaveData:function(g){},getDrawClientDimension:function(){var g=Kekule.HtmlElementUtils.getElemClientDimension(this.getCoreElement());return g},setDrawDimension:function(h,g){this.setDimension(h,g)},calcDrawBaseCoord:function(q){var n;var h=this.getDrawContext();var o=this.getPainter();var i;if((!this._isContinuousRepainting)&&this.getAutoSize()&&this.allowAutoSize()){var m=this.getPadding()||0;var k=o.estimateScreenBox(h,n,q,this.getAllowCoordBorrow());if(k){var g=k.x2-k.x1+m*2;var p=k.y2-k.y1+m*2;this.changeContextDimension({width:g,height:p});this.setDrawDimension(g,p);i={width:g,height:p};n={x:g/2,y:p/2}}}else{n=q?q.baseCoord:null;if(!n){var l=this.getDrawClientDimension();n={x:l.width/2,y:l.height/2};var j=this.getBaseCoordOffset();if(j){n=Kekule.CoordUtils.add(n,j)}}}n=this.getDrawBridge().transformScreenCoordToContext(h,n);return{baseCoord:n,baseCoordPos:Kekule.Render.CoordPos.CENTER,newWidgetDimension:i}},getActualDrawOptions:function(){return this.getDrawOptions()},calcDrawParams:function(i){var h=this.getActualDrawOptions();if(i){h=Object.extend(h,i)}var g=this.calcDrawBaseCoord(h);return{drawOptions:h,baseCoord:g.baseCoord,baseCoordPos:g.baseCoordPos,newWidgetDimension:g.newWidgetDimension}},_savePainterInitialRenderTransformOptions:function(i,h){var g=h.getActualInitialRenderTransformOptions(i);this._contextTransformOpsMap.set(i,g)},repaint:function(l){this.beginPaint();try{if(!l||!l.doNotClear){this.clearContext()}if(!this.getChemObj()){return}var g=this.getPainter();var k=this.getDrawContext();var h;var i;var j=true;if(l&&l.preserveTransformOptions){i=this._contextTransformOpsMap.get(k)||null;j=false;h=this.calcDrawParams(i)}else{h=this.calcDrawParams(l)}this._lastBaseCoord=h.baseCoord;g.draw(k,h.baseCoord,h.drawOptions);if(j){this._savePainterInitialRenderTransformOptions(k,g)}}finally{this.endPaint()}},beginPaint:function(){if(!this._paintFlag){this._paintFlag=0}++this._paintFlag},endPaint:function(){if(this._paintFlag>0){--this._paintFlag}if(this._paintFlag<0){this._paintFlag=0}},isPainting:function(){return this._paintFlag>0},getBackgroundColorOfType:function(g){return this._bgColorMap[g.toString()]},setBackgroundColorOfType:function(g,h){this._bgColorMap[h.toString()]=g;if(h===this.getRenderType()){this.setBackgroundColor(g)}},backgroundColorChanged:function(i){var g=this.getBackgroundColor();if(g==="transparent"){g=null}var h=this.getDrawBridge(true);if(h&&h.setClearColor){h.setClearColor(this.getDrawContext(),g);if(!i){this.repaint()}}},drawOptionChanged:function(){this.repaint()},geometryOptionChanged:function(){var g=this.getPainter();var i=this.getDrawOptions();if(g.supportGeometryOptionChange()){var h=this.getDrawContext();g.changeGeometryOptions(h,i.baseCoord||this._lastBaseCoord,i);this._savePainterInitialRenderTransformOptions(h,g)}else{this.drawOptionChanged()}},beginContinuousRepainting:function(){this._isContinuousRepainting=true},endContinuousRepainting:function(){if(this._isContinuousRepainting){this._isContinuousRepainting=false;this.repaint()}},resetDisplay:function(){var g=this.getDrawOptions();g.zoom=this.getInitialZoom()||1;g.rotateX=0;g.rotateY=0;g.rotateZ=0;g.rotateAngle=0;g.rotateAxisVector=null;g.rotateMatrix=null;this.setBaseCoordOffset(null);this.geometryOptionChanged();return this},getCurrZoom:function(){return this.getDrawOptions().zoom||1},zoomTo:function(h,g){this.getDrawOptions().zoom=h;if(!g){this.geometryOptionChanged()}return this},zoomIn:function(h){var i=this.getCurrZoom();var g=c.getNextZoomInRatio(i,h||1);return this.zoomTo(g)},zoomOut:function(h){var i=this.getCurrZoom();var g=c.getNextZoomOutRatio(i,h||1);return this.zoomTo(g)},resetZoom:function(){return this.zoomTo(this.getInitialZoom()||1)},getDefaultMoleculeDisplayType:function(g){return(g===Kekule.Render.RendererType.R3D)?Kekule.Render.Molecule3DDisplayType.DEFAULT:Kekule.Render.Molecule2DDisplayType.DEFAULT},getCurrMoleculeDisplayType:function(){var g=this.getDrawOptions().moleculeDisplayType;if(!g){g=this.getDefaultMoleculeDisplayType(this.getRenderType())}return g},setHideHydrogens:function(g){this.getDrawOptions().hideHydrogens=g;this.drawOptionChanged();return this},exportToDataUri:function(g,h){return this.getDrawBridge().exportToDataUri(this.getDrawContext(),g,h)},createConfigurator:function($super){var g=$super();g.addEventListener("configChange",function(h){this.repaint()},this);return g}});Kekule.ChemWidget.ChemObjDisplayer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Settings",initialize:function($super,g){$super(g)},initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile"])},getDisplayer:function(){return this.getWidget()}});Kekule.ChemWidget.ChemObjDisplayer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function($super,g){$super(g)},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function($super){var u=$super();var t=this.getDisplayer();var n=[t.getDisplayerConfigs(),t.getRenderConfigs()];for(var o=0,m=n.length;o<m;++o){var g=n[o];var s=g.getPropListOfScopes([Class.PropertyScope.PUBLISHED]);for(var q=0,h=s.getLength();q<h;++q){var r=s.getPropInfoAt(q);var p=g.getPropValue(r.name);if(p){u.push({obj:p,name:r.name,title:r.title,description:r.description})}}}return u},getDisplayer:function(){return this.getWidget()}});Kekule.ChemWidget.ActionDisplayerLoadFile=Class.create(Kekule.ActionLoadFileData,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadFile",HTML_CLASSNAME:e.ACTION_LOADFILE,initialize:function($super,g){$super();this.setDisplayer(g);this.setText(Kekule.$L("ChemWidgetTexts.CAPTION_LOADFILE"));this.setHint(Kekule.$L("ChemWidgetTexts.HINT_LOADFILE"))},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:false})},doUpdate:function($super){$super();var g=this.getDisplayer();this.setEnabled(this.getEnabled()&&g&&g.getEnabled()&&g.getEnableLoadNewFile())},doDataLoaded:function(h,i,g){if(g){this.getDisplayer().loadFromData(h,null,i)}}});Kekule.ChemWidget.ActionOnDisplayer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnDisplayer",initialize:function($super,h,g,i){$super();this.setDisplayer(h);this.setText(g);this.setHint(i)},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:false})},doUpdate:function(){var g=this.getDisplayer();this.setEnabled(g&&g.getChemObj()&&g.getChemObjLoaded()&&g.getEnabled())}});Kekule.ChemWidget.ActionDisplayerClear=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerClear",HTML_CLASSNAME:e.ACTION_CLEAROBJS,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_CLEAROBJS"),Kekule.$L("ChemWidgetTexts.HINT_CLEAROBJS"))},doUpdate:function($super){$super();var g=this.getDisplayer();this.setEnabled(g&&g.getEnabled()&&g.getChemObj())},doExecute:function(h){var g=this.getDisplayer();g.setChemObj(null)}});Kekule.ChemWidget.ActionDisplayerLoadData=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadData",HTML_CLASSNAME:e.ACTION_LOADDATA,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA"),Kekule.$L("ChemWidgetTexts.HINT_LOADDATA"))},finalize:function($super){$super()},initPropValues:function($super){$super();this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("dataDialog",{dataType:"Kekule.ChemWidget.LoadDataDialog",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("dataDialog");if(!g){g=this.createDataDialog();this.setPropStoreFieldValue("dataDialog",g)}return g}});this.defineProp("dialogShowType",{dataType:DataType.INT})},createDataDialog:function(){var h=this.getDisplayer().getDocument();var g=new Kekule.ChemWidget.LoadDataDialog(h);return g},doUpdate:function($super){$super();var g=this.getDisplayer();this.setEnabled(g&&g.getEnabled()&&g.getEnableLoadNewFile())},doExecute:function(j){var g=this;var i=this.getDataDialog();i.setAllowedFormatIds(this.getDisplayer().getAllowedInputFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds());var h=i._formatSelector;var l=this.getDialogShowType();var k=(l===Kekule.Widget.ShowHideType.DIALOG)?i.openModal:i.open;k.apply(i,[function(m){if(i.isPositiveResult(m)){var n=g.getDisplayer();n.load(i.getChemObj())}},j,l])}});Kekule.ChemWidget.ActionDisplayerSaveFile=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerSaveFile",HTML_CLASSNAME:e.ACTION_SAVEFILE,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEFILE"),Kekule.$L("ChemWidgetTexts.HINT_SAVEFILE"));this._saveAction=new Kekule.ActionFileSave()},finalize:function($super){this._saveAction.finalize();$super()},initPropValues:function($super){$super();this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("formatDialog",{dataType:"Kekule.Widget.Dialog",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("formatDialog");if(!g){g=this.createFormatDialog();this.setPropStoreFieldValue("formatDialog",g)}return g}});this.defineProp("lastFormat",{dataType:DataType.STRING,serializable:false});this.defineProp("currSaveData",{dataType:DataType.VARIANT,serializable:false});this.defineProp("dialogShowType",{dataType:DataType.INT})},getChemObjSrcInfo:function(h){var g=this.getDisplayer();return g.getChemObjSrcInfo?g.getChemObjSrcInfo(h):h.getSrcInfo?h.getSrcInfo():null},getChemObjSrcFormat:function(h){var g=this.getChemObjSrcInfo(h);return g?g.format:null},createFormatDialog:function(){var k=this.getDisplayer().getDocument();var g=new Kekule.Widget.Dialog(k,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEDATA_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);g.addClassName(e.DIALOG_CHOOSE_FILE_FORAMT);g.setAutoAdjustSizeOnPopup(true);var j=k.createElement("div");j.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_SELECT_FORMAT");g.getClientElem().appendChild(j);j=k.createElement("div");g.getClientElem().appendChild(j);var i=new Kekule.Widget.SelectBox(g);i.addClassName(e.DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX);i.appendToElem(j);i.addEventListener("valueChange",this.reactFormatSelectorChange,this);g._formatSelector=i;var j=k.createElement("div");j.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_PREVIEW_FILE_CONTENT");g.getClientElem().appendChild(j);j=k.createElement("div");g.getClientElem().appendChild(j);var h=new Kekule.Widget.TextEditor(g);h.setReadOnly(true);h.setWrap("off");h.setToolbarPos(Kekule.Widget.Position.BOTTOM);h.addClassName(e.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER);h.appendToElem(j);g._previewTextArea=h;if(g.setResizable){g.setResizable(true)}return g},getAvailableWriterInfos:function(h){if(!h){return[]}else{var g=Kekule.IO.ChemDataWriterManager.getAvailableWriterInfos(null,h);return g}},getFormatSelectorItems:function(w,t){var z=[];var u=[];var q=this.getChemObjSrcInfo(w);var x=(q)?q.format:null;for(var r=0,m=t.length;r<m;++r){var h=t[r];Kekule.ArrayUtils.pushUnique(u,h.formatId)}u=Kekule.ArrayUtils.intersect(this.getAllowedFormatIds(),u);for(var r=0,m=u.length;r<m;++r){var g=Kekule.IO.DataFormatsManager.getFormatInfo(u[r]);if(g){var s=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(g.fileExts));for(var p=0,n=s.length;p<n;++p){s[p]="*."+s[p]}var y=s.join(", ");var v=g.title;if(y){v+=" ("+y+")"}var o=x?(u[r]===x):this.getLastFormat()?(this.getLastFormat()===u[r]):r===0;z.push({value:g.id,text:v,title:g.mimeType,data:g,selected:o})}}z.sort(function(j,i){return(j.text<i.text)?-1:(j.text>i.text)?1:0});return z},getAllowedFormatIds:function(){return this.getDisplayer().getAllowedOutputFormatIds()||Kekule.IO.ChemDataWriterManager.getAllWritableFormatIds()},getFileFilters:function(m){var g=[];for(var k=0,h=m.length;k<h;++k){var o=m[k];var n=o.data;var p=o.text||o.title||o.value;var j=Kekule.ArrayUtils.toArray(n.fileExts);g.push({title:p,filter:"."+j.join(",.")})}g.push(Kekule.NativeServices.FILTER_ALL_SUPPORT);g.push(Kekule.NativeServices.FILTER_ANY);return g},updateFormatItems:function(h){this._formatItems=this.getFormatSelectorItems(h,this.getAvailableWriterInfos());this._formatSelector.setItems(this._formatItems);var g=this.getFileFilters(this._formatItems);this._saveAction.setFilters(g)},reactFormatSelectorChange:function(){var g=this.getFormatDialog()._formatSelector.getValue();this.updatePreview(g,this.getFormatDialog())},updatePreview:function(j,m){var i=m._previewTextArea;i.setValue("");if(j){var l=Kekule.IO.DataFormatsManager.getFormatInfo(j);var h=this.getTargetObj();var k=this.getChemObjSrcInfo(h);if(k&&k.format===j&&k.data){i.setValue(k.data);this.setCurrSaveData(k.data)}else{var g=this.getDisplayer().saveData(j,l.dataType,h);i.setValue(g);this.setCurrSaveData(g)}}},getTargetObj:function(g){return this.getDisplayer().getSavingTargetObj()},doUpdate:function($super){$super();var g=this.getDisplayer();if(this._saveAction){this._saveAction.update()}this.setEnabled(g&&g.getEnabled()&&g.getChemObj())},doExecute:function(k){var q=this;var l=this.getFormatDialog();var p=this.getTargetObj();var h=l._formatSelector;var m=this.getAvailableWriterInfos(p);var i=this.getFormatSelectorItems(p,m);h.setItems(i);this.reactFormatSelectorChange();var n=false;if(this._saveAction){n=this._saveAction.getEnabled()}var g=l.getDialogButton(Kekule.Widget.DialogButtons.OK);if(g){g.setEnabled(n)}var j=this.getDialogShowType();var o=(j===Kekule.Widget.ShowHideType.DIALOG)?l.openModal:l.open;o.apply(l,[function(s){if(s===Kekule.Widget.DialogButtons.OK){var v=q.getCurrSaveData();q._saveAction.setData(v);var w=l._formatSelector.getValue();q.setLastFormat(w);var y=Kekule.IO.DataFormatsManager.getFormatInfo(w);var r=y.fileExts;var t=Kekule.ArrayUtils.toArray(r[0]||r);var u=[{title:y.title||y.mimeType,filter:"."+t.join(",.")},Kekule.NativeServices.FILTER_ANY];var x=Kekule.$L("ChemWidgetTexts.S_DEF_SAVE_FILENAME")+"."+t;q._saveAction.setFileName(x);q._saveAction.setFilters(u);q._saveAction.execute(k)}},k,j])}});Kekule.ChemWidget.ActionDisplayerReset=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerReset",HTML_CLASSNAME:e.ACTION_RESET,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_RESETVIEW"),Kekule.$L("ChemWidgetTexts.HINT_RESETVIEW"))},doExecute:function(){this.getDisplayer().resetDisplay()}});Kekule.ChemWidget.ActionDisplayerZoomIn=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomIn",HTML_CLASSNAME:e.ACTION_ZOOMIN,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMIN"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMIN"))},doExecute:function(){this.getDisplayer().zoomIn()}});Kekule.ChemWidget.ActionDisplayerZoomOut=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomOut",HTML_CLASSNAME:e.ACTION_ZOOMOUT,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMOUT"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMOUT"))},doExecute:function(){this.getDisplayer().zoomOut()}});Kekule.ChemWidget.ActionDisplayerResetZoom=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerResetZoom",HTML_CLASSNAME:e.ACTION_RESET_ZOOM,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_RESETZOOM"),Kekule.$L("ChemWidgetTexts.HINT_RESETZOOM"))},doExecute:function(){this.getDisplayer().resetZoom()}});Kekule.ChemWidget.ActionDisplayerHideHydrogens=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerHideHydrogens",HTML_CLASSNAME:e.ACTION_MOL_HIDE_HYDROGENS,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_HIDEHYDROGENS"),Kekule.$L("ChemWidgetTexts.HINT_HIDEHYDROGENS"))},doUpdate:function($super){$super();var h=this.getDisplayer();var g=h&&(h.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(g).setEnabled(this.getEnabled()&&g)},doExecute:function(){var g=!this.getChecked();this.setChecked(g);this.getDisplayer().setHideHydrogens(g)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase",initialize:function($super,h,g,j,i){$super(h,g,j);this._displayType=i;this.setCheckGroup("__molDisplayType__")},doUpdate:function($super){$super();var g=this.getDisplayer();this.setChecked(g&&g.getCurrMoleculeDisplayType()===this.getMolDisplayType())},doExecute:function(){this.getDisplayer().setMoleculeDisplayType(this._displayType);this.setChecked(true)},getMolDisplayType:function(){return this._displayType}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D",doUpdate:function($super){$super();var h=this.getDisplayer();var g=h&&(h.getRenderType()===Kekule.Render.RendererType.R2D);this.setDisplayed(g).setEnabled(this.getEnabled()&&g)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D",doUpdate:function($super){$super();var h=this.getDisplayer();var g=h&&(h.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(g).setEnabled(this.getEnabled()&&g)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_SKELETAL,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_SKELETAL"),Kekule.$L("ChemWidgetTexts.HINT_SKELETAL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE=Kekule.Render.Molecule2DDisplayType.SKELETAL;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_CONDENSED,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_CONDENSED"),Kekule.$L("ChemWidgetTexts.HINT_CONDENSED"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE=Kekule.Render.Molecule2DDisplayType.CONDENSED;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_WIRE,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_WIRE"),Kekule.$L("ChemWidgetTexts.HINT_WIRE"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE=Kekule.Render.Molecule3DDisplayType.WIRE;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_STICKS,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_STICKS"),Kekule.$L("ChemWidgetTexts.HINT_STICKS"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE=Kekule.Render.Molecule3DDisplayType.STICKS;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_BALLSTICK,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_BALLSTICK"),Kekule.$L("ChemWidgetTexts.HINT_BALLSTICK"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE=Kekule.Render.Molecule3DDisplayType.BALL_STICK;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_SPACEFILL,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_SPACEFILL"),Kekule.$L("ChemWidgetTexts.HINT_SPACEFILL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE=Kekule.Render.Molecule3DDisplayType.SPACE_FILL})();(function(){var a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEM_STRUCT_TREE_VIEW:"K-Chem-Struct-TreeView",CHEM_STRUCT_TREE_VIEW_ITEM_TITLE:"K-Chem-Struct-TreeView-ItemTitle",CHEM_STRUCT_TREE_VIEW_ITEM_TYPE:"K-Chem-Struct-TreeView-ItemType"});Kekule.ChemWidget.StructureTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.ChemWidget.StructureTreeView",initialize:function($super,b,c){$super(b);this.setPropStoreFieldValue("objMap",new Kekule.MapEx(true));this.setEnableLiveUpdate(true);this.setEnableMultiSelected(true);this.setRootObj(c);this._pauseLiveUpdateFlag=0;this._changedObjects=[]},initProperties:function(){this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:false,setter:function(c){var b=this.getPropStoreFieldValue("rootObj");this.setPropStoreFieldValue("rootObj",c);this.rootObjChanged(c,b)}});this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL});this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:false})},doGetWidgetClassName:function($super){return $super()+" "+a.CHEM_STRUCT_TREE_VIEW},rootObjChanged:function(c,b){this.clearChildItems();this.getObjMap().clear();if(b){this._uninstallRootEventHandler(b)}if(c){this._fillTree(c);this._installRootEventHandler(c)}},pauseLiveUpdate:function(){if(this._pauseLiveUpdateFlag>=0){this._pauseLiveUpdateFlag=0;this._changedObjects=[]}--this._pauseLiveUpdateFlag;return this},resumeLiveUpdate:function(){++this._pauseLiveUpdateFlag;if(this._pauseLiveUpdateFlag>=0){this._pauseLiveUpdateFlag=0;for(var c=0,b=this._changedObjects.length;c<b;++c){this.refreshObject(this._changedObjects[c])}}},isLiveUpdatePaused:function(){return(this._pauseLiveUpdateFlag<0)},_installRootEventHandler:function(b){b.addEventListener("change",this.reactChemObjChange,this)},_uninstallRootEventHandler:function(b){b.removeEventListener("change",this.reactChemObjChange,this)},reactChemObjChange:function(b){if(this.getEnableLiveUpdate()){if(this.isLiveUpdatePaused()){if(this.getObjMap().get(b.target)){Kekule.ArrayUtils.pushUnique(this._changedObjects,b.target)}}else{this.refreshObject(b.target)}}},refreshObject:function(c){var b=this.getObjMap().get(c);if(b){this._updateTreeItem(b,c)}return this},_fillTree:function(b){if(b){this.clearChildItems();this._updateTreeItem(this.appendChildItem(),b)}},_updateTreeItem:function(g,k){var j=this._getChemObjDisplayTitle(k);var e={text:j,obj:k};this.setItemData(g,e);this.getObjMap().set(k,g);var b=this.getChildItemCount(g);var d=k.getChildCount();for(var f=0;f<d;++f){var c=k.getChildAt(f);if(!c.isSelectable()){continue}var h;if(f<b){h=this.getChildItemAt(g,f)}else{h=this.appendChildItem(g)}this._updateTreeItem(h,c)}if(b>d){for(var f=b-1;f>=d;--f){this.removeChildItemAt(g,f)}}},_getChemObjDisplayTitle:function(h){var b="";var g=h.getId();if(g){b+='<span class="'+a.CHEM_STRUCT_TREE_VIEW_ITEM_TITLE+'">'+g+"</span>"}var f=h.getClassName();var e=f.split(".");var d=e.length?e[e.length-1]:f;var c='<span class="'+a.CHEM_STRUCT_TREE_VIEW_ITEM_TYPE+'">('+d+")</span>";return b+c},selectChemObjs:function(d){var c=[];for(var e=0,b=d.length;e<b;++e){var g=d[e];var f=this.getObjMap().get(g);if(f){c.push(f)}}this.select(c);return this},getSelectedChemObjs:function(){var b=[];var d=this.getSelection();if(d&&d.length){for(var e=0,c=d.length;e<c;++e){var f=this.getItemData(d[e]);if(f&&f.obj){b.push(f.obj)}}}return b}})})();(function(){var a=Kekule.oneOf;Kekule.ChemWidget.AbstractUIMarker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.AbstractUIMarker",initialize:function($super){$super();this.setVisible(true)},initProperties:function(){this.defineProp("drawStyles",{dataType:DataType.OBJECT});this.defineProp("visible",{dataType:DataType.BOOL})}});Kekule.ChemWidget.MetaShapeUiMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker",initialize:function($super,b){$super();if(b){this.setShapeInfo(b)}},initProperties:function(){this.defineProp("shapeInfo",{dataType:DataType.OBJECT});this.defineProp("shapeType",{dataType:DataType.INT,serializable:false,setter:null,getter:function(){var b=this.getShapeInfo();return b?b.shapeType:null}})}});Kekule.ChemWidget.MetaShapeUIMarker=Kekule.ChemWidget.MetaShapeUiMarker;Kekule.ChemWidget.TextUiMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker",initialize:function($super,b,c){$super();if(b){this.setText(b)}if(c){this.setCoord(c)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING});this.defineProp("coord",{dataType:DataType.HASH})}});Kekule.ChemWidget.UiMarkerCollection=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection",initProperties:function(){this.defineProp("markers",{dataType:DataType.ARRAY,getter:function(){var b=this.getPropStoreFieldValue("markers");if(!b){b=[];this.setPropStoreFieldValue("markers",b)}return b},setter:null})},getMarkerCount:function(){return this.getMarkers().length},getMarkerAt:function(b){return this.getMarkers()[b]},addMarker:function(b){return this.getMarkers().push(b)},indexOfMarker:function(b){return this.getMarkers().indexOf(b)},removeMarker:function(b){var d=this.getMarkers();var c=d.indexOf(b);if(c>=0){d.splice(c,1)}},clearMarkers:function(){this.setPropStoreFieldValue("markers",[])}});Kekule.ChemWidget.UiMarker2DRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerRenderer"});Kekule.ChemWidget.MetaShapeUiMarker2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker2DRenderer",doDrawSelf:function($super,b,h,k){var f=this.getChemObj();var j=f.getShapeInfo();if(!j){return null}var c=Object.create(k);c=Object.extend(c,f.getDrawStyles()||{});if(c.color){if(!c.strokeColor){c.strokeColor=c.color}if(!c.fillColor){c.fillColor=c.color}}var m;if(Kekule.Render.MetaShapeUtils.isCompositeShape(j)){if(j.length>1){m=this.createDrawGroup(b);for(var e=0,d=j.length;e<d;++e){var g=j[e];this.doDrawShape(b,m,g,c)}}else{if(j.length===1){m=this.doDrawShape(b,null,j[0],c)}else{return null}}}else{m=this.doDrawShape(b,null,j,c)}return m},doDrawShape:function(b,o,j,q){var f=Kekule.Render.MetaShapeType;var r;if(Kekule.Render.MetaShapeUtils.isCompositeShape(j)){r=this.createDrawGroup(b);for(var g=0,e=j.length;g<e;++g){var d=this.doDrawShape(b,r,j[g],q)}}else{var n=j.coords;switch(j.shapeType){case f.POINT:r=this.drawCircle(b,n[0],1,q);break;case f.CIRCLE:r=this.drawCircle(b,n[0],j.radius,q);break;case f.LINE:var c=q;if(j.width){c=Object.create(q);c.strokeWidth=j.width}r=this.drawLine(b,n[0],n[1],c);break;case f.RECT:r=this.drawRect(b,n[0],n[1],q);break;case f.POLYGON:case f.POLYLINE:var k=[];for(var g=0,e=n.length;g<e;++g){var h=(g===0)?"M":"L";k.push(h);var m=[n[g].x,n[g].y];k.push(m)}if(j.shapeType===f.POLYGON){k.push("L");m=[n[0].x,n[0].y];k.push(m)}var p=Kekule.Render.DrawPathUtils.makePath.apply(this,k);r=this.drawPath(b,p,q);break}}if(o){this.addToDrawGroup(r,o)}return r}});Kekule.ChemWidget.TextUiMarker2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker2DRenderer",doDrawSelf:function($super,d,f,c){var b=this.getChemObj();var e={textBoxXAlignment:Kekule.Render.BoxXAlignment.CENTER,textBoxYAlignment:Kekule.Render.BoxYAlignment.CENTER};e=Object.extend(e,c);e=Object.extend(e,b.getDrawStyles()||{});var h=b.getCoord();var g=b.getText();if(g&&h){return this.drawText(d,h,b.getText(),e)}else{return null}}});Kekule.ChemWidget.UiMarkerCollection2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection2DRenderer",getChildObjs:function($super){var f=this.getChemObj();var e=f.getMarkers();var b=[];for(var d=0,c=e.length;d<c;++d){if(e[d].getVisible()){b.push(e[d])}}return b}});Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.MetaShapeUiMarker,Kekule.ChemWidget.MetaShapeUiMarker2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.TextUiMarker,Kekule.ChemWidget.TextUiMarker2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.UiMarkerCollection,Kekule.ChemWidget.UiMarkerCollection2DRenderer);Kekule.ChemWidget.UiMarkersRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkersRenderer",DRAW_ELEM_FIELD:"__$drawElem__",initialize:function($super,b,c){$super(b,c);this._drawGroup=null},initProperties:function(){},getObjDrawElem:function(b,c){return this.getExtraProp2(b,c,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(b,d,c){this.setExtraProp2(b,d,this.DRAW_ELEM_FIELD,c)},doEstimateRenderBox:function(d,e,c,b){return null},doDraw:function($super,c,d,b){$super(c,d,b);var f=this.getChemObj();var e=this.createDrawGroup(c);this.setObjDrawElem(c,f,e);if(f.getMarkerCount()>0){this.doDrawMarkers(c,e,f.getMarkers(),b)}return e},doUpdate1:function($super,d,g,b){if(this.canModifyGraphic(d)){var e=false;var c=Kekule.Render.ObjectUpdateType;switch(b){case c.ADD:e=this.doAddNew(d,g);break;case c.MODIFY:e=this.doModify(d,g);break;case c.REMOVE:var f=this._extractObjsOfUpdateObjDetails(g);e=this.doRemove(d,f);break;default:return $super(d,g,b)}return e}else{return $super(d,updatedObjs,b)}},doAddNew:function(b,c){if(this.canRemoveElem()){return this.doModify(b,c)}else{return false}},doModify:function(b,g){if(this.canRemoveElem()){var e=this._extractObjsOfUpdateObjDetails(g);this.remove(b,e);var f=this.getChemObj();var c=this.getObjDrawElem(f);var d=this.getDrawParams();if(e.indexOf(f)>=0){this.draw(b,d.baseCoord,d.options)}else{this.doDrawMarkers(b,c,e,d.options)}}else{return false}},doRemove:function(b,d){if(this.canRemoveElem()){var c=this.getObjDrawElem(d);if(c){var e=this.getObjDrawElem(this.getChemObj());this.doRemoveFromGroup(c,e);this.doRemoveElem(b,c);this.setObjDrawElem(d,null)}}else{return false}},doDrawMarkers:function(f,g,h,d){for(var e=0,c=h.length;e<c;++e){var b=h[e];if(b.getVisible()){this.doDrawMarker(f,g,b,d)}}},doDrawMarker:function(b,h,f,k){var j=f.getShapeInfo();if(!j){return null}var c=Object.create(k);c=Object.extend(f.getDrawStyles()||{});if(c.color){if(!c.strokeColor){c.strokeColor=c.color}if(!c.fillColor){c.fillColor=c.color}}var m;if(Kekule.ArrayUtils.isArray(j)){if(j.length>1){m=this.createDrawGroup(b);for(var e=0,d=j.length;e<d;++e){var g=j[e];this.doDrawShape(b,m,g,c)}}else{if(j.length===1){m=this.doDrawShape(b,null,j[0],c)}else{return null}}}else{m=this.doDrawShape(b,null,j,c)}if(m){this.setObjDrawElem(b,f,m);if(h){this.addToDrawGroup(m,h)}}return m},doDrawShape:function(b,o,j,q){var f=Kekule.Render.MetaShapeType;var r;if(Kekule.Render.MetaShapeUtils.isCompositeShape(j)){r=this.createDrawGroup(b);for(var g=0,e=j.length;g<e;++g){var d=this.doDrawShape(b,r,j[g],q)}}else{var n=j.coords;switch(j.shapeType){case f.POINT:r=this.drawCircle(b,n[0],1,q);break;case f.CIRCLE:r=this.drawCircle(b,n[0],j.radius,q);break;case f.LINE:var c=q;if(j.width){c=Object.create(q);c.strokeWidth=j.width}r=this.drawLine(b,n[0],n[1],c);break;case f.RECT:r=this.drawRect(b,n[0],n[1],q);break;case f.POLYGON:case f.POLYLINE:var k=[];for(var g=0,e=n.length;g<e;++g){var h=(g===0)?"M":"L";k.push(h);var m=[n[g].x,n[g].y];k.push(m)}if(j.shapeType===f.POLYGON){k.push("L");m=[n[0].x,n[0].y];k.push(m)}var p=Kekule.Render.DrawPathUtils.makePath.apply(this,k);r=this.drawPath(b,p,q);break}}if(o){this.addToDrawGroup(r,o)}return r}});Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.ChemWidget.UiMarkersRenderer)})();(function(){var b=Class.PropertyScope;var e=Kekule.ArrayUtils;var j=Kekule.ZoomUtils;var c=Kekule.ChemWidget.ComponentWidgetNames;var i=Kekule.ChemWidget;var d=Kekule.Widget.EvokeMode;Kekule.globalOptions.add("chemWidget.viewer",{toolButtons:[c.loadData,c.saveData,c.molDisplayType,c.molHideHydrogens,c.zoomIn,c.zoomOut,c.rotateX,c.rotateY,c.rotateZ,c.rotateLeft,c.rotateRight,c.reset,c.openEditor],menuItems:[c.loadData,c.saveData,Kekule.Widget.MenuItem.SEPARATOR_TEXT,c.molDisplayType,c.molHideHydrogens,c.zoomIn,c.zoomOut,{text:Kekule.$L("ChemWidgetTexts.CAPTION_ROTATE"),hint:Kekule.$L("ChemWidgetTexts.HINT_ROTATE"),children:[c.rotateLeft,c.rotateRight,c.rotateX,c.rotateY,c.rotateZ]},c.reset,Kekule.Widget.MenuItem.SEPARATOR_TEXT,c.openEditor,c.config]});Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER:"K-Chem-Viewer",VIEWER2D:"K-Chem-Viewer2D",VIEWER3D:"K-Chem-Viewer3D",VIEWER_CAPTION:"K-Chem-Viewer-Caption",VIEWER_EMBEDDED_TOOLBAR:"K-Chem-Viewer-Embedded-Toolbar",VIEWER_MENU_BUTTON:"K-Chem-Viewer-Menu-Button",VIEWER_EDITOR_FULLCLIENT:"K-Chem-Viewer-Editor-FullClient",ACTION_ROTATE_LEFT:"K-Chem-RotateLeft",ACTION_ROTATE_RIGHT:"K-Chem-RotateRight",ACTION_ROTATE_X:"K-Chem-RotateX",ACTION_ROTATE_Y:"K-Chem-RotateY",ACTION_ROTATE_Z:"K-Chem-RotateZ",ACTION_VIEWER_EDIT:"K-Chem-Viewer-Edit"});var g=Kekule.Widget.HtmlClassNames;var a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.Viewer=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.ChemWidget.Viewer",BINDABLE_TAG_NAMES:["div","span","img"],DEF_BGCOLOR_2D:null,DEF_BGCOLOR_3D:"#000000",DEF_TOOLBAR_EVOKE_MODES:[d.EVOKEE_CLICK,d.EVOKEE_MOUSE_ENTER,d.EVOKEE_TOUCH],DEF_TOOLBAR_REVOKE_MODES:[d.EVOKEE_MOUSE_LEAVE,d.EVOKER_TIMEOUT],initialize:function($super,k,q,n,m){this.setPropStoreFieldValue("renderType",n||Kekule.Render.RendererType.R2D);this.setPropStoreFieldValue("enableToolbar",false);this.setPropStoreFieldValue("toolbarEvokeModes",this.DEF_TOOLBAR_EVOKE_MODES);this.setPropStoreFieldValue("toolbarRevokeModes",this.DEF_TOOLBAR_REVOKE_MODES);this.setPropStoreFieldValue("enableDirectInteraction",true);this.setPropStoreFieldValue("toolbarPos",Kekule.Widget.Position.AUTO);this.setPropStoreFieldValue("toolbarMarginHorizontal",10);this.setPropStoreFieldValue("toolbarMarginVertical",10);this.setPropStoreFieldValue("showCaption",false);this.setPropStoreFieldValue("useCornerDecoration",true);$super(k,q,n,m);this.setPadding(this.getRenderConfigs().getLengthConfigs().getActualLength("autofitContextPadding"));this._isContinuousRepainting=false;var l=Kekule.Render.RendererType;var o=(this.getRenderType()===l.R2D)?(this.getBackgroundColor()||this.DEF_BGCOLOR_2D):this.DEF_BGCOLOR_2D;var p=(this.getRenderType()===l.R3D)?(this.getBackgroundColor()||this.DEF_BGCOLOR_3D):this.DEF_BGCOLOR_3D;this.setBackgroundColorOfType(o,l.R2D);this.setBackgroundColorOfType(p,l.R3D);this.useCornerDecorationChanged();this.doResize();this.addIaController("default",new Kekule.ChemWidget.ViewerBasicInteractionController(this),true)},doFinalize:function($super){var k=this.getToolbar();if(k){k.finalize()}$super()},initProperties:function(){this.defineProp("viewerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:false,getter:function(){return this.getDisplayerConfigs()},setter:function(k){return this.setDisplayerConfigs(k)}});this.defineProp("allowedMolDisplayTypes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(k){this.setPropStoreFieldValue("allowedMolDisplayTypes",k);this.updateUiComps()}});this.defineProp("enableRestraintRotation3D",{dataType:DataType.BOOL});this.defineProp("restraintRotation3DEdgeRatio",{dataType:DataType.FLOAT});this.defineProp("enableEdit",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableEdit")&&(this.getCoordMode()!==Kekule.CoordMode.COORD3D)}});this.defineProp("shareEditorInstance",{dataType:DataType.BOOL});this.defineProp("enableEditFromVoid",{dataType:DataType.BOOL});this.defineProp("restrainEditorWithCurrObj",{dataType:DataType.BOOL});this.defineProp("modalEdit",{dataType:DataType.BOOL});this.defineProp("editorProperties",{dataType:DataType.HASH});this.defineProp("toolButtons",{dataType:DataType.ARRAY,scope:b.PUBLIC,getter:function(){var k=this.getPropStoreFieldValue("toolButtons");return k},setter:function(k){this.setPropStoreFieldValue("toolButtons",k);this.updateToolbar()}});this.defineProp("menuItems",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(k){this.setPropStoreFieldValue("menuItems",k);this.updateMenu()}});this.defineProp("menu",{dataType:"Kekule.Widget.Menu",serializable:false,scope:b.PRIVATE,setter:function(l){var k=this.getMenu();if(l!==k){if(k){k.finalize();k=null}this.setPropStoreFieldValue("menu",l)}}});this.defineProp("toolbar",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,scope:b.PRIVATE,setter:function(n){var l=this.getToolbar();var k=this.getToolbarEvokeHelper();if(n!==l){if(l){l.finalize();var m=this.getToolbarEvokeHelper();if(m){m.finalize()}l=null}if(k){k.finalize()}this.setPropStoreFieldValue("toolbar",n);if(n){this.setPropStoreFieldValue("toolbarEvokeHelper",new Kekule.Widget.DynamicEvokeHelper(this,n,this.getToolbarEvokeModes(),this.getToolbarRevokeModes()))}}}});this.defineProp("enableToolbar",{dataType:DataType.BOOL,setter:function(k){this.setPropStoreFieldValue("enableToolbar",k);this.updateToolbar()}});this.defineProp("toolbarPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(k){this.setPropStoreFieldValue("toolbarPos",k);this.adjustToolbarPos()}});this.defineProp("toolbarMarginVertical",{dataType:DataType.INT,setter:function(k){this.setPropStoreFieldValue("toolbarMarginVertical",k);this.adjustToolbarPos()}});this.defineProp("toolbarMarginHorizontal",{dataType:DataType.INT,setter:function(k){this.setPropStoreFieldValue("toolbarMarginHorizontal",k);this.adjustToolbarPos()}});this.defineProp("toolbarEvokeHelper",{dataType:"Kekule.Widget.DynamicEvokeHelper",serializable:false,setter:null,scope:b.PRIVATE});this.defineProp("toolbarEvokeModes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(k){this.setPropStoreFieldValue("toolbarEvokeModes",k||[]);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setEvokeModes(k||[])}}});this.defineProp("toolbarRevokeModes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(k){this.setPropStoreFieldValue("toolbarRevokeModes",k||[]);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setRevokeModes(k||[])}}});this.defineProp("toolbarRevokeTimeout",{dataType:DataType.INT,setter:function(k){this.setPropStoreFieldValue("toolbarRevokeTimeout",k);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setTimeout(k)}}});this.defineProp("toolbarParentElem",{dataType:DataType.OBJECT,serializable:false,setter:function(k){if(this.getToolbarParentElem()!==k){this.setPropStoreFieldValue("toolbarParentElem",k);this.updateToolbar()}}});this.defineProp("caption",{dataType:DataType.STRING,setter:function(k){this.setPropStoreFieldValue("caption",k);Kekule.DomUtils.setElementText(this.getCaptionElem(),k||"");this.captionChanged()}});this.defineProp("showCaption",{dataType:DataType.BOOL,setter:function(k){this.setPropStoreFieldValue("showCaption",k);this.captionChanged()}});this.defineProp("captionPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(k){this.setPropStoreFieldValue("captionPos",k);this.captionChanged()}});this.defineProp("autoCaption",{dataType:DataType.BOOL,setter:function(k){this.setPropStoreFieldValue("autoCaption",k);if(k){this.autoDetectCaption()}}});this.defineProp("captionElem",{dataType:DataType.OBJECT,scope:b.PRIVATE,setter:null,getter:function(l){var k=this.getPropStoreFieldValue("captionElem");if(!k&&!l){k=this.doCreateCaptionElem();this.setPropStoreFieldValue("captionElem",k)}return k}});this.defineProp("actions",{dataType:"Kekule.ActionList",serializable:false,scope:b.PUBLIC,setter:null,getter:function(){var k=this.getPropStoreFieldValue("actions");if(!k){k=new Kekule.ActionList();this.setPropStoreFieldValue("actions",k)}return k}});this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:false,scope:b.PRIVATE,setter:null,getter:function(){var k=this.getPropStoreFieldValue("actionMap");if(!k){k=new Kekule.MapEx(true);this.setPropStoreFieldValue("actionMap",k)}return k}});this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL});this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL,setter:function(k){this.setPropStoreFieldValue("enableTouchInteraction",!!k);this.setTouchAction(k?"none":null)}})},initPropValues:function($super){this.setUseNormalBackground(false);this.setModalEdit(true);this.setRestrainEditorWithCurrObj(true);this.setRestraintRotation3DEdgeRatio(0.18);this.setEnableRestraintRotation3D(true);this.setShareEditorInstance(true);this.setEnableTouchInteraction(!true)},canUsePlaceHolderOnElem:function(l){var k=l.getAttribute("src");return(l.tagName.toLowerCase()==="img")&&(!!k)},doObjectChange:function($super,k){$super(k);this.updateActions()},doSetElement:function($super,l){var m=l;if(m){var k=m.tagName.toLowerCase();if(k==="img"){m=Kekule.DomUtils.replaceTagName(m,"span")}}return $super(m)},doUnbindElement:function($super,k){if(this._drawContextParentElem&&this._drawContextParentElem.parentNode){this._drawContextParentElem.parentNode.removeChild(this._drawContextParentElem);this._drawContextParentElem=null}return $super(k)},doCreateRootElement:function(l){var k=l.createElement("div");return k},doGetWidgetClassName:function($super){var l=$super()+" "+a.VIEWER;try{var m=this.getRenderType();var k=this._getRenderTypeSpecifiedHtmlClassName(m);l+=" "+k}catch(n){}return l},_getRenderTypeSpecifiedHtmlClassName:function(k){return(k===Kekule.Render.RendererType.R3D)?a.VIEWER3D:a.VIEWER2D},getResizerElement:function(){return this.getDrawContextParentElem()},doResize:function($super){this.adjustDrawParentDim();this.adjustToolbarPos();$super()},doWidgetShowStateChanged:function(k){if(k){this.updateActions()}},refitDrawContext:function($super,k){$super(k);this.adjustToolbarPos()},getAllowRenderTypeChange:function(){return true},resetRenderType:function($super,n,l){$super(n,l);var m=this._getRenderTypeSpecifiedHtmlClassName(n);var k=this._getRenderTypeSpecifiedHtmlClassName(l);this.removeClassName(m);this.addClassName(k);this.updateUiComps()},doLoadEnd:function(k){this.updateActions();this.autoDetectCaption()},doSetUseCornerDecoration:function($super,k){$super(k);this.useCornerDecorationChanged()},useCornerDecorationChanged:function(){var l=this.getDrawContextParentElem();if(l){var k=this.getUseCornerDecoration();if(k){Kekule.HtmlElementUtils.addClass(l,g.CORNER_ALL)}else{Kekule.HtmlElementUtils.removeClass(l,g.CORNER_ALL)}}},adjustDrawParentDim:function(){var n=this.getDrawContextParentElem();var l=n.parentNode;var q=this.getCaptionElem(true);var p=Kekule.HtmlElementUtils.getElemClientDimension(l);var m,o;if(q&&this.captionIsShown()&&q.parentNode===l){var k=Kekule.HtmlElementUtils.getElemClientDimension(q);o=Math.max(p.height-k.height,0);m=(this.getCaptionPos()&Kekule.Widget.Position.TOP)?k.height:0;n.style.top=m+"px";n.style.height=o+"px"}else{Kekule.StyleUtils.removeStyleProperty(n.style,"top");n.style.height=p.height+"px"}},getInteractionReceiverElem:function(){return this.getDrawContextParentElem()},setDrawDimension:function($super,n,l){var m=l;if(this.captionIsShown()){var k=Kekule.HtmlElementUtils.getElemClientDimension(this.getCaptionElem());m+=k.height||0}$super(n,m)},doCreateCaptionElem:function(){var k=this.getDocument().createElement("span");k.className=g.DYN_CREATED+"  "+g.SELECTABLE+" "+a.VIEWER_CAPTION;this.getElement().appendChild(k);return k},captionChanged:function(){if(this.captionIsShown()){var l=this.getCaptionElem();var k=l.style;var m=this.getCaptionPos();if(m&Kekule.Widget.Position.TOP){k.top=0;k.bottom="auto"}else{k.bottom=0;k.top="auto"}k.display="block"}else{var l=this.getCaptionElem(true);if(l){l.style.display="none"}}this.doResize()},captionIsShown:function(){return this.getCaption()&&this.getShowCaption()},getAllowEditing:function(){return(this.getCoordMode()!==Kekule.CoordMode.COORD3D)&&this.getEnableEdit()&&(this.getChemObj()||this.getEnableEditFromVoid())},getComposerDialog:function(){var k;if(this.getShareEditorInstance()){k=Kekule.ChemWidget.Viewer._composerDialog}else{k=this._composerDialog}if(!k){if(Kekule.Editor.ComposerDialog){k=new Kekule.Editor.ComposerDialog(this,Kekule.$L("ChemWidgetTexts.CAPTION_EDIT_OBJ"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL])}}if(this.getShareEditorInstance()){Kekule.ChemWidget.Viewer._composerDialog=k}else{this._composerDialog=k}return k},getComposerPanel:function(){var k;if(this.getShareEditorInstance()){k=Kekule.ChemWidget.Viewer._composerPanel}else{k=this._composerPanel}if(!k){if(Kekule.Editor.Composer){k=new Kekule.Editor.Composer(this);k.addClassName(a.VIEWER_EDITOR_FULLCLIENT);k.setUseNormalBackground(true);var n=Kekule.Editor.Composer.getMinPreferredDimension();k.setMinDimension(n);k.setEnableDimensionTransform(true);k.setAutoResizeConstraints({width:1,height:1});var m=Kekule.globalOptions.chemWidget.composer.commonToolButtons;m=e.exclude(m,[c.cut,c.config,c.objInspector]);k.setCommonToolButtons(m);var l=[{text:Kekule.$L("ChemWidgetTexts.CAPTION_EDITOR_DONE"),hint:Kekule.$L("ChemWidgetTexts.HINT_EDITOR_DONE"),htmlClass:"K-Res-Button-YesOk",showText:true,"#execute":function(){k._doneEditCallback();k.hide()}},{text:Kekule.$L("ChemWidgetTexts.CAPTION_EDITOR_CANCEL"),hint:Kekule.$L("ChemWidgetTexts.HINT_EDITOR_CANCEL"),htmlClass:"K-Res-Button-NoCancel",showText:true,"#execute":function(){k.hide()}}];k._customEndEditButtons=l}}if(this.getShareEditorInstance()){Kekule.ChemWidget.Viewer._composerPanel=k}else{this._composerPanel=k}k._invokerViewer=this;k._doneEditCallback=null;return k},openEditor:function(k){if(this.getAllowEditing()){var q=this.getChemObj();var n=!q;var o=q&&q.isEmpty&&q.isEmpty();var m=this.getRestrainEditorWithCurrObj();var p=Kekule.DocumentUtils.getClientDimension(this.getDocument());var l=Kekule.Editor.Composer.getMinPreferredDimension();if(p.width<=l.width+50||p.height<l.height+100){this._openEditComposer(k,q,m,n,o)}else{this._openEditComposerDialog(k,q,m,n,o)}}},_prepareEditComposer:function(o,l,k,n){o.setEnableCreateNewDoc(k||!l);o.setEnableLoadNewFile(k||!l);o.setAllowCreateNewChild(k||!l);var m=this.getEditorProperties();if(m){o.setPropValues(m)}},_feedbackEditResult:function(m,n,l){if(!m.isDirty()){return}var k=m.getSavingTargetObj();if(l){this.setChemObj(k.clone())}else{if(this.getRestrainEditorWithCurrObj()){if(n.getClass()===k.getClass()){n.assign(k.clone())}else{n.assign(cloneObj)}n.setSrcInfo(null);this.setChemObj(n)}else{this.setChemObj(k)}}},_openEditComposerDialog:function(p,r,s,m,l){var o=this.getComposerDialog();if(!o){Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"));return}var k=o.getComposer();this._prepareEditComposer(k,s,m,l);var n;if(!m&&!l){n=r.clone();o.setChemObj(n)}else{o.getComposer().newDoc()}var t=this;var q=function(u){if(u===Kekule.Widget.DialogButtons.OK&&o.getComposer().isDirty()){t._feedbackEditResult(o.getComposer(),r,m)}};if(this.getModalEdit()){o.openModal(q,p||this)}else{o.openPopup(q,p||this)}},_openEditComposer:function(v,w,x,o,m){var k=this.getComposerPanel();if(!k){Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"));return}this._prepareEditComposer(k,x,o,m);var u=k._customEndEditButtons;var t=k.getCommonToolButtons()||[];var p=false;for(var s=0,q=u.length;s<q;++s){var n=u[s];if(t.indexOf(n)<0){t.push(n);p=true}}if(p){k.setCommonToolButtons(t)}if(!o&&!m){var r=w.clone();k.setChemObj(r)}else{k.newDoc()}var y=this;k._doneEditCallback=function(){y._feedbackEditResult(k,w,o)};k.show(v,function(){if(!o&&!m){k.setChemObj(r)}else{}},Kekule.Widget.ShowHideType.POPUP)},resetView:function(){return this.resetDisplay()},getCurr2DRotationAngle:function(){return this.getDrawOptions().rotateAngle||0},rotate2DBy:function(l,k){return this.rotate2DTo(this.getCurr2DRotationAngle()+l,k)},rotate2DTo:function(l,k){this.getDrawOptions().rotateAngle=l;if(!k){this.geometryOptionChanged()}return this},getCurr3DRotationInfo:function(){var m={};var k=["rotateMatrix","rotateX","rotateY","rotateZ","rotateAngle"];var p=this.getDrawOptions();for(var o=0,n=k.length;o<n;++o){var q=k[o];m[q]=p[q]||0}m.rotateAxisVector=p.rotateAxisVector||null;return m},setRotate3DMatrix:function(k,l){this.getDrawOptions().rotateMatrix=k;if(!l){this.geometryOptionChanged()}return this},rotate3DBy:function(l,k,r,o){var p=this.getCurr3DRotationInfo();var q=p.rotateMatrix||Kekule.MatrixUtils.createIdentity(4);var n=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:l,rotateY:k,rotateZ:r});var m=Kekule.MatrixUtils.multiply(n,q);this.setRotate3DMatrix(m,o);return this},rotate3DByAxis:function(q,o,m){var n=this.getCurr3DRotationInfo();var p=n.rotateMatrix||Kekule.MatrixUtils.createIdentity(4);var l=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:q,rotateAxisVector:o});var k=Kekule.MatrixUtils.multiply(l,p);this.setRotate3DMatrix(k,m);return this},getDefaultToolBarButtons:function(){return Kekule.globalOptions.chemWidget.viewer.toolButtons},isToolbarEmbedded:function(){return !this.getToolbarParentElem()},adjustToolbarPos:function(){var w=this.getToolbar();if(!w){return}if(this.isToolbarEmbedded()){var n=Kekule.Widget.Position;var s=Kekule.HtmlElementUtils.getElemPageRect(this.getDrawContextParentElem());var q=Kekule.HtmlElementUtils.getElemPageRect(w);var v=this.getToolbarPos();var k=this.getToolbarMarginHorizontal();var r=this.getToolbarMarginVertical();var l="left",u="top";var m="right",p="bottom";var t=(s.width-q.width)/2;var x=(s.height-q.height)/2;if(v===n.AUTO||!v){var o=((k>0)?k:0)*2+q.width;var y=((r>0)?r:0)*2+q.height;if(o>s.width){v|=n.LEFT;k=0}else{v|=n.RIGHT}if(y>s.height/2){v|=n.BOTTOM;r=-1}else{v|=n.BOTTOM}}if(v&n.LEFT){l="left";m="right";t=(k>=0)?k:k-q.width}else{if(v&n.RIGHT){l="right";m="left";t=(k>=0)?k:k-q.width}}if(v&n.TOP){u="top";p="bottom";x=(r>=0)?r:r-q.height}else{if(v&n.BOTTOM){u="bottom";p="top";x=(r>=0)?r:r-q.height}}w.removeStyleProperty(m);w.removeStyleProperty(p);w.setStyleProperty(l,t+"px");w.setStyleProperty(u,x+"px")}else{w.removeStyleProperty("left");w.removeStyleProperty("top");w.removeStyleProperty("width");w.removeStyleProperty("height")}},updateToolbar:function(){if(this.getEnableToolbar()){this.createToolbar();this.adjustToolbarPos()}else{this.setToolbar(null)}},updateMenu:function(){this.createMenu()},updateUiComps:function(){this.updateToolbar();this.updateMenu()},updateActions:function(){if(this.getActions()){this.getActions().updateAll()}},clearActions:function(){this.getActions().clear();this.getActionMap().clear()},getCompActionClass:function(k){return this.getChildActionClass(k,true)},_getActionOfComp:function(l,p,n){var m=this.getActionMap();var k=m.get(l);if(!k&&p){var o=this.getCompActionClass(l)||n;if(o){k=new o(this);m.set(l,k);this.getActions().add(k)}}return k},createToolbar:function(){this.clearActions();var m=new Kekule.Widget.ButtonGroup(this);m.addClassName(g.DYN_CREATED);m.setDisplayed(false);m.setShowText(false);m.doSetShowGlyph(true);var q=this.getToolButtons()||this.getDefaultToolBarButtons();for(var p=0,k=q.length;p<k;++p){var n=q[p];var o=this.createToolButton(n,m)}m.addClassName(a.INNER_TOOLBAR);if(this.isToolbarEmbedded()){m.addClassName(a.VIEWER_EMBEDDED_TOOLBAR)}m.appendToElem(this.getToolbarParentElem()||this.getElement());this.setToolbar(m);return m},createToolButton:function(s,q){var t=null;var n=this.beginContinuousRepainting.bind(this);var l=this.endContinuousRepainting.bind(this);var o=[c.rotateX,c.rotateY,c.rotateZ,c.rotateLeft,c.rotateRight];if(DataType.isObjectValue(s)){var r=Object.extend({widget:Kekule.Widget.Button},s);t=Kekule.Widget.Utils.createFromHash(q,r);var p=r.actionClass;if(p){if(typeof(p)==="string"){p=ClassEx.findClass(r.actionClass)}}if(p){var m=this._getActionOfComp(t,true,p);if(m){t.setAction(m)}}}else{if(s===c.molDisplayType){return this.createMolDisplayTypeButton(q)}else{if(s===c.menu){return this.createMenuButton(q)}}var p=this.getCompActionClass(s);var k=Kekule.Widget.Button;if(s===c.molHideHydrogens){k=Kekule.Widget.CheckButton}t=new k(q);var m=this._getActionOfComp(s,true);if(m){t.setAction(m)}if(o.indexOf(s)>=0){t.setPeriodicalExecInterval(20);t.setEnablePeriodicalExec(true);t.addEventListener("activate",n);t.addEventListener("deactivate",l)}}return t},createMenuButton:function(l){var k=new Kekule.Widget.DropDownButton(l);k.setText(Kekule.$L("WidgetTexts.CAPTION_MENU")).setHint(Kekule.$L("WidgetTexts.HINT_MENU"));k.addClassName(a.VIEWER_MENU_BUTTON);if(!this.getMenu()){this.createMenu()}k.setDropDownWidget(this.getMenu());return k},createMolDisplayTypeButton:function(s){var u=new Kekule.Widget.CompactButtonSet(s);u.getButtonSet().addClassName(a.INNER_TOOLBAR);u.setShowText(false);var n=this._getActionOfComp(c.molDisplayType,true);u.setAction(n);this.getActions().add(n);var t=this.getDocument();var q=this.getAllowedMolDisplayTypes();var r=this._getUsableMolDisplayActionClasses(q);for(var p=0,m=r.length;p<m;++p){var o=r[p].TYPE;var k=new Kekule.Widget.RadioButton(t);var n=this._getActionOfComp(c.molDisplayType+o,true,r[p]);k.setAction(n);u.append(k,o===this.getCurrMoleculeDisplayType())}return u},_getUsableMolDisplayActionClasses:function(q){var k=[];var p=(this.getRenderType()===Kekule.Render.RendererType.R3D)?i.Viewer.molDisplayType3DActionClasses:i.Viewer.molDisplayType2DActionClasses;for(var o=0,m=p.length;o<m;++o){var n=p[o].TYPE;if(q&&(q.indexOf(n)<0)&&(n!==this.getCurrMoleculeDisplayType())){continue}k.push(p[o])}return k},getDefaultMenuItems:function(){return Kekule.globalOptions.chemWidget.viewer.menuItems},prepareMenuItems:function(n){var t=[];var k=Kekule.Widget.MenuItem.SEPARATOR_TEXT;for(var p=0,o=n.length;p<o;++p){var q=n[p];if(typeof(q)==="string"){if(q!==k){var m=this.createPredefinedMenuItemDefHash(q);if(m){t.push(m)}}}else{var s=Object.extend({},q);if(!q.widget&&!q.widgetClass){s.widget=Kekule.Widget.MenuItem}if(q.children&&q.children.length){var r=this.prepareMenuItems(q.children);s.children=r}t.push(s)}}return t},createPredefinedMenuItemDefHash:function(m){if(m===c.molDisplayType){return this.createMolDisplayMenuDefHash()}var l=[c.rotateX,c.rotateY,c.rotateZ,c.rotateLeft,c.rotateRight];var o=this.beginContinuousRepainting.bind(this);var r=this.endContinuousRepainting.bind(this);var p=this.getCompActionClass(m);var q=Kekule.Widget.MenuItem;var k=null;var n=this._getActionOfComp(m,true);if(n){k={widget:q,action:n};if(l.indexOf(m)>=0){k=Object.extend(k,{periodicalExecInterval:20,enablePeriodicalExec:true,"#activate":o,"@deactivate":r})}}return k},createMolDisplayMenuDefHash:function(){var r=this._getActionOfComp(c.molDisplayType,true);var k={widget:Kekule.Widget.MenuItem,action:r};var q=[];var n=this.getAllowedMolDisplayTypes();var s=this._getUsableMolDisplayActionClasses(n);for(var p=0,m=s.length;p<m;++p){var o=s[p].TYPE;var r=this._getActionOfComp(c.molDisplayType+o,true,s[p]);q.push({widget:Kekule.Widget.MenuItem,action:r})}if(q.length){k.children=[{widget:Kekule.Widget.PopupMenu,children:q}]}return k},createMenu:function(){var k=this.getMenu();if(!k){k=new Kekule.Widget.PopupMenu(this);k.addClassName(g.DYN_CREATED);k.setDisplayed(false)}else{k.clearMenuItems()}var l=this.getMenuItems()||this.getDefaultMenuItems();l=this.prepareMenuItems(l);k.createChildrenByDefs(l);this.setMenu(k);return k},autoDetectCaption:function(){if(this.getAutoCaption()){var m=this.getChemObj();if(m){var l=m&&m.getInfo();var n=m&&m.getSrcInfo();if(l&&n){var k=l.title||l.caption||m.getName()||n.fileName;if(k){this.setCaption(k)}}}}}});var h=Kekule.X.Event;Kekule.ChemWidget.ViewerBasicInteractionController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.ChemWidget.ViewerBasicInteractionController",initialize:function($super,k){$super(k);this._enableMouseRotate=true;this._transformInfo={isTransforming:false,lastCoord:null,lastZoom:null};this._restraintCoord=null;this._doInteractiveTransformStepBind=this._doInteractiveTransformStep.bind(this)},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:false,getter:function(){return this.getWidget()},setter:function(k){this.setWidget(k)}})},getViewerRenderType:function(){return this.getViewer().getRenderType()},getEnableInteraction:function(){var l=this.getViewer();var k=!!(l&&l.getEnableDirectInteraction()&&l.getChemObjLoaded());return k},getEnableTouchInteraction:function(){var l=this.getViewer();var k=!!(l&&l.getEnableDirectInteraction()&&l.getEnableTouchInteraction()&&l.getChemObjLoaded());return k},_initTransform:function(){var p=this.getViewer();var l=p.getOffsetWidth();var m=p.getOffsetHeight();var k;var o=this._transformInfo;var n=this._restraintCoord;if(n){k=(n==="x")?m:l;o.angleRatio=1/k*Math.PI*2}else{k=Math.min(l,m);o.angleRatio=1/k*Math.PI}},zoomViewer:function(l){var k=this.getViewer();if(!k||!k.getChemObj()){return}if(l>0){if(k.zoomIn){k.zoomIn(l)}}else{if(l<0){if(k.zoomOut){k.zoomOut(-l)}}}},isEventFromInteractionArea:function(m){var l=m.getTarget();var k=this.getViewer().getInteractionReceiverElem();return(l===k)||Kekule.DomUtils.isDescendantOf(l,k)},_beginInteractTransformAtCoord:function(m,k,n,l){var p=this.getViewer();if(p&&p.getChemObj()){var o=this._transformInfo;o.isTransforming=true;o.lastCoord={x:m,y:k};this._restraintCoord=this._calcRestraintRotateCoord(n,l);this._initTransform();this.getViewer().setTouchAction("none");this._requestInteractiveTransform(m,k)}},_endInteractTransform:function(){this._transformInfo.isTransforming=false;this.getViewer().setTouchAction(null);this._doInteractiveTransformEnd()},_calcRestraintRotateCoord:function(m,l){var t=this.getViewer();var z=null;var x=this._getRestraintRotate3DEdgeSize();if(x>0){var p=t.getInteractionReceiverElem();var w=Kekule.HtmlElementUtils.getElemPageRect(p,true);var n=m-w.left;var y=l-w.top;var k=w.right-m;var v=w.bottom-l;var q,o,s,r;if(n<=k){s=1;q=n}else{s=-1;q=k}if(y<=v){r=1;o=y}else{r=-1;o=v}var u=Math.min(q,o);if(u>x){return null}else{if(o>u){if(s<0){z="x"}}else{if(r>0){z="z"}else{z="y"}}}}return z},_interactTransformAtCoord:function(m,k){var n=this._transformInfo.lastCoord;if(n){var l={x:m,y:k};var o=Kekule.CoordUtils.getDistance(n,l);if(o<5){return}}this._requestInteractiveTransform(m,k)},_requestInteractiveTransform:function(l,k){this._transformInfo.interactScreenCoord={x:l,y:k};if(!this._interactiveTransformStepId){this._interactiveTransformStepId=window.requestAnimationFrame(this._doInteractiveTransformStepBind)}},_doInteractiveTransformStep:function(){if(this._transformInfo&&this._transformInfo.isTransforming){var k=this._transformInfo.interactScreenCoord;if(this.getViewerRenderType()===Kekule.Render.RendererType.R3D){this.rotateByXYDistance(k.x,k.y)}else{this.moveByXYDistance(k.x,k.y)}this._interactiveTransformStepId=window.requestAnimationFrame(this._doInteractiveTransformStepBind)}},_doInteractiveTransformEnd:function(){if(this._interactiveTransformStepId){window.cancelAnimationFrame(this._interactiveTransformStepId);this._interactiveTransformStepId=null}},_getRestraintRotate3DEdgeSize:function(){var m=this.getViewer();if(m.getEnableRestraintRotation3D()&&m.getRenderType()===Kekule.Render.RendererType.R3D){var l=m.getDimension();var k=Math.min(l.width,l.height);return k*(m.getRestraintRotation3DEdgeRatio()||0)}else{return 0}},needReactEvent:function(k){return this.getEnableInteraction()&&this.isEventFromInteractionArea(k)},react_dblclick:function(k){if(this.needReactEvent(k)){this.getViewer().resetDisplay()}},react_mousewheel:function(k){if(this.needReactEvent(k)){var l=k.wheelDeltaY||k.wheelDelta;if(l){l/=120}this.zoomViewer(l);k.preventDefault();return true}},react_pointerdown:function(k){if(!this.needReactEvent(k)){return}if(k.getButton()===h.MouseButton.LEFT){if(k.getPointerType()!==h.PointerType.TOUCH||this.getEnableTouchInteraction()){this._beginInteractTransformAtCoord(k.getScreenX(),k.getScreenY(),k.getClientX(),k.getClientY())}}},react_pointerhold:function(k){if(!this.needReactEvent(k)){return}if(k.getPointerType()===h.PointerType.TOUCH&&k.getButton()===h.MouseButton.LEFT){this.getViewer().setEnableTouchInteraction(!this.getViewer().getEnableTouchInteraction())}},react_pointerleave:function(k){this._endInteractTransform()},react_pointerup:function(k){if(k.getButton()===h.MouseButton.LEFT){this._endInteractTransform()}},react_pointermove:function(k){if(!this.needReactEvent(k)){return}if(this._transformInfo.isTransforming){this._interactTransformAtCoord(k.getScreenX(),k.getScreenY());k.preventDefault()}},moveByXYDistance:function(m,l){var o=this._transformInfo;if(o&&o.isTransforming&&(!o.calculating)){var p=this.getViewer();if(p.getRenderType()===Kekule.Render.RendererType.R3D){return}o.calculating=true;try{var n={x:m,y:l};var q=Kekule.CoordUtils.substract(n,o.lastCoord);var k=p.getBaseCoordOffset()||{};k=Kekule.CoordUtils.add(k,q);p.setBaseCoordOffset(k);o.lastCoord=n}finally{o.calculating=false}}},rotateByXYDistance:function(n,m){var o=this._transformInfo;if(o&&o.isTransforming&&(!o.calculating)){var r=this.getViewer();if(r.getRenderType()!==Kekule.Render.RendererType.R3D){return}o.calculating=true;try{var l={x:n,y:m};var u=Kekule.CoordUtils.substract(l,o.lastCoord);u.y=-u.y;var p,q,t;if(this._restraintCoord){var k=this._restraintCoord;if(k==="x"){p=u.y;t={x:1,y:0,z:0}}else{p=u.x;if(k==="y"){t={x:0,y:-1,z:0}}else{t={x:0,y:0,z:1}}}q=-p*o.angleRatio}else{p=Kekule.CoordUtils.getDistance({x:0,y:0},u);q=p*o.angleRatio;t={x:-u.y,y:u.x,z:0}}r.rotate3DByAxis(q,t);o.lastCoord=l;o.calculating=false}catch(s){}finally{o.calculating=false}}},doTestMouseCursor:function(n,m){var k="";var l=this._transformInfo;if(l.isTransforming){k="move"}return k}});Kekule.ChemWidget.Viewer2D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer2D",initialize:function($super,k,l){$super(k,l,Kekule.Render.RendererType.R2D)},getAllowRenderTypeChange:function(){return false}});Kekule.ChemWidget.Viewer3D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer3D",initialize:function($super,k,l){$super(k,l,Kekule.Render.RendererType.R3D)},getAllowRenderTypeChange:function(){return false}});var f=Kekule.ObjPropSettingManager;f.register("Kekule.ChemWidget.Viewer.fullFunc",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:true,enableEdit:true,toolButtons:null});f.register("Kekule.ChemWidget.Viewer.basic",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:false,toolButtons:[c.saveData,c.molDisplayType,c.zoomIn,c.zoomOut],menuItems:[c.saveData,"-",c.molDisplayType,c.zoomIn,c.zoomOut]});f.register("Kekule.ChemWidget.Viewer.mini",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:false,toolButtons:[c.menu],menuItems:[c.saveData,"-",c.molDisplayType,c.zoomIn,c.zoomOut]});f.register("Kekule.ChemWidget.Viewer.static",{enableToolbar:false,enableDirectInteraction:false,enableTouchInteraction:false,toolButtons:[],menuItems:[]});f.register("Kekule.ChemWidget.Viewer.editOnly",{enableToolbar:true,enableEdit:true,toolButtons:[c.openEditor],menuItems:[c.openEditor]});Kekule.ChemWidget.Viewer.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.ChemWidget.Viewer.Settings",initProperties:function(){this.defineDelegatedProps(["enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","enableEdit","modalEdit"])},getViewer:function(){return this.getWidget()}});Kekule.ChemWidget.ActionOnViewer=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionOnViewer",initialize:function($super,m,k,l){$super(m,k,l)},doUpdate:function(){var k=this.getDisplayer();this.setEnabled(k&&k.getChemObj()&&k.getChemObjLoaded()&&k.getEnabled())},getViewer:function(){var k=this.getDisplayer();return(k instanceof Kekule.ChemWidget.Viewer)?k:null}});Kekule.ChemWidget.ActionViewerRotateBase=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase",initialize:function($super,m,k,l){$super(m,k,l);this.setDelta(2*Math.PI/180)},initProperties:function(){this.defineProp("delta",{dataType:DataType.FLOAT})},isShiftModified:function(k){return k&&k.getShiftKey()}});Kekule.ChemWidget.ActionViewerRotateBase2D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase2D",doUpdate:function($super){$super();var l=this.getViewer();var k=l&&(l.getRenderType()===Kekule.Render.RendererType.R2D);this.setDisplayed(k).setEnabled(this.getEnabled()&&k)}});Kekule.ChemWidget.ActionViewerRotateBase3D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase3D",doUpdate:function($super){$super();var l=this.getViewer();var k=l&&(l.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(k).setEnabled(this.getEnabled()&&k)}});Kekule.ChemWidget.ActionViewerRotateLeft=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateLeft",HTML_CLASSNAME:a.ACTION_ROTATE_LEFT,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATELEFT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATELEFT"))},doExecute:function(l,k){var m=this.getDelta();this.getViewer().rotate2DBy(m)}});Kekule.ChemWidget.ActionViewerRotateRight=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateRight",HTML_CLASSNAME:a.ACTION_ROTATE_RIGHT,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATERIGHT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATERIGHT"))},doExecute:function(l,k){var m=-this.getDelta();this.getViewer().rotate2DBy(m)}});Kekule.ChemWidget.ActionViewerRotateX=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateX",HTML_CLASSNAME:a.ACTION_ROTATE_X,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEX"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEX"))},doExecute:function(m,l){var k=this.isShiftModified(l);var n=-this.getDelta();if(k){n=-n}this.getViewer().rotate3DBy(n,0,0)}});Kekule.ChemWidget.ActionViewerRotateY=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateY",HTML_CLASSNAME:a.ACTION_ROTATE_Y,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEY"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEY"))},doExecute:function(m,l){var k=this.isShiftModified(l);var n=-this.getDelta();if(k){n=-n}this.getViewer().rotate3DBy(0,n,0)}});Kekule.ChemWidget.ActionViewerRotateZ=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateZ",HTML_CLASSNAME:a.ACTION_ROTATE_Z,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEZ"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEZ"))},doExecute:function(m,l){var k=this.isShiftModified(l);var n=-this.getDelta();if(k){n=-n}this.getViewer().rotate3DBy(0,0,n)}});Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub",initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_MOL_DISPLAY_TYPE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_DISPLAY_TYPE"))},doExecute:function(k){}});Kekule.ChemWidget.ActionViewerEdit=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerEdit",HTML_CLASSNAME:a.ACTION_VIEWER_EDIT,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_OPENEDITOR"),Kekule.$L("ChemWidgetTexts.HINT_OPENEDITOR"))},doUpdate:function($super){$super();var k=this.getViewer();this.setEnabled(k&&k.getAllowEditing()&&k.getEnabled());this.setDisplayed(k&&k.getEnableEdit())},doExecute:function(k){var l=this.getViewer();l.openEditor(k)}});Kekule.ChemWidget.Viewer.rotate2DActionClasses=[i.ActionViewerRotateLeft,i.ActionViewerRotateRight];Kekule.ChemWidget.Viewer.rotate3DActionClasses=[i.ActionViewerRotateX,i.ActionViewerRotateY,i.ActionViewerRotateZ];Kekule.ChemWidget.Viewer.molDisplayType2DActionClasses=[i.ActionDisplayerChangeMolDisplayTypeSkeletal,i.ActionDisplayerChangeMolDisplayTypeCondensed];Kekule.ChemWidget.Viewer.molDisplayType3DActionClasses=[i.ActionDisplayerChangeMolDisplayTypeWire,i.ActionDisplayerChangeMolDisplayTypeSticks,i.ActionDisplayerChangeMolDisplayTypeBallStick,i.ActionDisplayerChangeMolDisplayTypeSpaceFill];Kekule._registerAfterLoadSysProc(function(){var m=Kekule.ActionManager;var k=Kekule.ChemWidget;var n=Kekule.ChemWidget.Viewer;var l=m.registerNamedActionClass;l(c.loadFile,k.ActionDisplayerLoadFile,n);l(c.loadData,k.ActionDisplayerLoadData,n);l(c.saveData,k.ActionDisplayerSaveFile,n);l(c.clearObjs,k.ActionDisplayerClear,n);l(c.zoomIn,k.ActionDisplayerZoomIn,n);l(c.zoomOut,k.ActionDisplayerZoomOut,n);l(c.rotateLeft,k.ActionViewerRotateLeft,n);l(c.rotateRight,k.ActionViewerRotateRight,n);l(c.rotateX,k.ActionViewerRotateX,n);l(c.rotateY,k.ActionViewerRotateY,n);l(c.rotateZ,k.ActionViewerRotateZ,n);l(c.reset,k.ActionDisplayerReset,n);l(c.molHideHydrogens,k.ActionDisplayerHideHydrogens,n);l(c.molDisplayType,k.ActionViewerChangeMolDisplayTypeStub,n);l(c.openEditor,k.ActionViewerEdit,n);l(c.config,Kekule.Widget.ActionOpenConfigWidget,n);l(c.molDisplayTypeCondensed,k.ActionDisplayerChangeMolDisplayTypeCondensed,n);l(c.molDisplayTypeSkeletal,k.ActionDisplayerChangeMolDisplayTypeSkeletal,n);l(c.molDisplayTypeWire,k.ActionDisplayerChangeMolDisplayTypeWire,n);l(c.molDisplayTypeSticks,k.ActionDisplayerChangeMolDisplayTypeSticks,n);l(c.molDisplayTypeBallStick,k.ActionDisplayerChangeMolDisplayTypeBallStick,n);l(c.molDisplayTypeSpaceFill,k.ActionDisplayerChangeMolDisplayTypeSpaceFill,n)})})();(function(){var c=Class.PropertyScope;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER_GRID:"K-Chem-Viewer-Grid"});var a=Kekule.Widget.HtmlClassNames;var b=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ViewerGrid=Class.create(Kekule.Widget.WidgetGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid",initialize:function($super,d,f,e){this.setPropStoreFieldValue("renderType",f);this.setPropStoreFieldValue("viewerConfigs",e);$super(d)},initProperties:function(){this._shadowedPropPairs=[];this.defineProp("renderType",{dataType:DataType.INT,serializable:false,setter:null,scope:c.PUBLIC});this.defineProp("chemObjs",{dataType:DataType.ARRAY,serializable:false,setter:null,getter:function(){var d=[];this.each(function(e){d.push(e.getChemObj())});return d}});this.defineViewerShadowProps(["drawOptions","moleculeDisplayType","zoom","autoSize","enableLoadNewFile","viewerConfigs","allowedMolDisplayTypes","enableEdit","modalEdit","toolButtons","enableToolbar","toolbarPos","toolbarMarginVertical","toolbarMarginHorizontal","toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","caption","showCaption","autoCaption","captionPos","enableDirectInteraction","enableTouchInteraction"]);this.defineViewerShadowProps(["viewerPredefinedSetting"],["predefinedSetting"]);this.defineProp("actionLoadData",{dataType:"Kekule.ChemWidget.ActionDisplayerLoadData",serializable:false,scope:c.PRIVATE,setter:null,getter:function(){var d=this.getPropStoreFieldValue("actionLoadData");if(!d){d=new Kekule.ChemWidget.ActionDisplayerLoadData();this.setPropStoreFieldValue("actionLoadData",d)}return d}})},defineViewerShadowProps:function(j,f){if(!f){f=[]}for(var g=0,e=j.length;g<e;++g){var h=j[g];var d=f[g]||j[g];this.defineViewerShadowProp(h,d)}},defineViewerShadowProp:function(h,f){if(!f){f=h}var e=Kekule.ChemWidget.Viewer;var g=ClassEx.getPropInfo(e,f);if(g){var d=Object.create(g);d.getter=undefined;d.setter=function(i){this.setPropStoreFieldValue(h,i);this.each(function(j){j.setPropValue(f,i)})};this.defineProp(h,d);this._shadowedPropPairs.push({prop:h,viewerProp:f})}},doGetWidgetClassName:function($super){return $super()+" "+b.VIEWER_GRID},createWidget:function($super){var f=this.getDocument();var e=new Kekule.ChemWidget.LoadDataDialog(f);var d=this;e.openModal(function(g){if(e.isPositiveResult(g)){var i=e.getChemObj();if(i){var h=d.doCreateNewChildWidget(f,i);h.setParent(d)}}},this.getAddingCell())},doCreateNewChildWidget:function(e,f){var d=new Kekule.ChemWidget.Viewer(e,null,this.getRenderType(),this.getViewerConfigs());this.doSetShadowedPropValuesToViewer(d);if(!f){}else{d.setChemObj(f)}return d},doSetShadowedPropValuesToViewer:function(h){for(var e=0,d=this._shadowedPropPairs.length;e<d;++e){var g=this._shadowedPropPairs[e];var f=this.getPropValue(g.prop);h.setPropValue(g.viewerProp,f)}},addChemObj:function(d){this.doCreateNewChildWidget(this.getDocument(),d).setParent(this);return this},removeChemObj:function(e){var d=this;this.each(function(f){if(f.getChemObj()===e){d.removeWidget(f,true)}});return this}});Kekule.ChemWidget.ViewerGrid2D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid2D",initialize:function($super,d,e){$super(d,Kekule.Render.RendererType.R2D,e)}});Kekule.ChemWidget.ViewerGrid3D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid3D",initialize:function($super,d,e){$super(d,Kekule.Render.RendererType.R3D,e)}})})();(function(){var f=Class.PropertyScope;var d=Kekule.DomUtils;var a=Kekule.ArrayUtils;var c=Kekule.ChemWidget;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMOBJSETTER:"K-Chem-Obj-Setter",CHEMOBJSETTER_TOOLBAR_AREA:"K-Chem-Obj-Setter-Toolbar-Area",CHEMOBJSETTER_CLIENT:"K-Chem-Obj-Setter-Client",CHEMOBJSETTER_VIEWER:"K-Chem-Obj-Setter-Viewer",CHEMOBJSETTER_TABGROUP:"K-Chem-Obj-Setter-TabGroup",CHEMOBJSETTER_INFOLABEL:"K-Chem-Obj-Setter-InfoLabel",CHEMOBJSETTER_REGION:"K-Chem-Obj-Setter-Region",CHEMOBJSETTER_REGION_LABEL:"K-Chem-Obj-Setter-Region-Label",CHEMOBJSETTER_LINE:"K-Chem-Obj-Setter-Line",CHEMOBJSETTER_CONFIGURATOR:"K-Chem-Obj-Setter-Configurator"});var b=Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ChemObjInserter=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter",DEF_BGCOLOR_2D:"transparent",DEF_BGCOLOR_3D:"#000000",initialize:function($super,g,k,i,h){this._configAction=new Kekule.Widget.ActionOpenConfigWidget(this);this._toolbarParentElem=null;this._infoLabel=null;this._infoLabelTemplate=Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH_HEIGHT");$super(g);var j=this.getViewer();if(i){j.setRenderType(i)}if(h){j.setViewerConfigs(h)}this.adjustChildrenSizes()},doFinalize:function($super){if(this._configAction){this._configAction.finalize()}$super()},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("viewer");if(!g){g=this.createViewer();this.setPropStoreFieldValue("viewer",g)}return g}});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,scope:f.PUBLIC,getter:function(){var g=this.getPropStoreFieldValue("viewer");return g?g.getChemObj():this.getPropStoreFieldValue("chemObj")},setter:function(g){this.setPropStoreFieldValue("chemObj",g);if(this.getViewer()){this.getViewer().setChemObj(g)}}});this.defineProp("renderType",{dataType:DataType.INT,serializable:false,scope:f.PUBLIC,setter:function(j){var h=this.getRenderType();if(j!==h){this.setPropStoreFieldValue("renderType",j);this.getViewer().setRenderType(j);var i=this.getTabs();if(i){var g=(j===Kekule.Render.RendererType.R3D)?1:0;i.getChildWidgets()[g].setChecked(true)}}}});this.defineProp("is3D",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getRenderType()===Kekule.Render.RendererType.R3D},setter:function(g){this.setRenderType(g?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D)}});this.defineProp("showInfo",{dataType:DataType.BOOL,serializable:false,getter:function(){return this._infoLabel&&Kekule.StyleUtils.isShown(this._infoLabel)},setter:function(g){if(this._infoLabel){Kekule.StyleUtils.setDisplay(this._infoLabel,g)}}});this.defineProp("autoSizeExport",{dataType:DataType.BOOL});this.defineProp("backgroundColor2D",{dataType:DataType.STRING,setter:function(g){this.setPropStoreFieldValue("backgroundColor2D",g);this.backgroundColorChange()}});this.defineProp("backgroundColor3D",{dataType:DataType.STRING,setter:function(g){this.setPropStoreFieldValue("backgroundColor3D",g);this.backgroundColorChange()}});this.defineProp("exportViewerPredefinedSetting",{dataType:DataType.STRING});this.defineProp("clientPanel",{dataType:DataType.OBJECT,serializable:false,setter:false,scope:f.PRIVATE});this.defineProp("tabs",{dataType:DataType.OBJECT,serializable:false,setter:false,scope:f.PRIVATE});this._defineViewerDelegatedProp("chemObjLoaded");this._defineViewerDelegatedProp("renderConfigs");this._defineViewerDelegatedProp("drawOptions");this._defineViewerDelegatedProp("allowCoordBorrow");this._defineViewerDelegatedProp("autoSize");this._defineViewerDelegatedProp("autofit");this._defineViewerDelegatedProp("viewerConfigs");this._defineViewerDelegatedProp("allowedMolDisplayTypes");this._defineViewerDelegatedProp("enableEdit");this._defineViewerDelegatedProp("enableEditFromVoid");this._defineViewerDelegatedProp("modalEdit");this._defineViewerDelegatedProp("toolButtons");this._defineViewerDelegatedProp("enableDirectInteraction");this._defineViewerDelegatedProp("enableTouchInteraction")},initPropValues:function($super){$super();this.setAutoSizeExport(true);this.setBackgroundColor3D(this.DEF_BGCOLOR_3D);this.setExportViewerPredefinedSetting("basic")},_defineViewerDelegatedProp:function(j,g){if(!g){g=j}var h=ClassEx.getPropInfo(Kekule.ChemWidget.Viewer,g);var i=Object.create(h);i.getter=null;i.setter=null;if(h.getter){i.getter=function(){return this.getViewer().getPropValue(g)}}if(h.setter){i.setter=function(k){this.getViewer().setPropValue(g,k)}}return this.defineProp(j,i)},loadPredefinedResDataToProp:function(h,g,i){if(h==="chemObj"){if(i){var j=Kekule.IO.loadTypedData(g.data,g.resType,g.resUri);this.setChemObj(j)}else{Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+g.resUri||"")}}},doGetWidgetClassName:function($super){var g=$super()+" "+e.CHEMOBJSETTER;return g},doCreateRootElement:function(h){var g=h.createElement("div");return g},doCreateSubElements:function($super,j,h){var g=$super(j,h);this.createToolbarParent(h);var i=new Kekule.Widget.Panel(this);i.addClassName(e.CHEMOBJSETTER_CLIENT);i.setUseCornerDecoration(false);i.appendToElem(h);this.setPropStoreFieldValue("clientPanel",i);this.createViewer(i.getCoreElement());this.createInfoLabel(h,this.getViewer());this.createTabs(h);return g},doResize:function($super){this.adjustChildrenSizes()},doWidgetShowStateChanged:function($super,g){$super(g);this.adjustChildrenSizes()},getResizerElement:function(){return this.getClientPanel()?this.getClientPanel().getCoreElement():this.getCoreElement()},getBackgroundColor:function(h){var g=(h===Kekule.Render.RendererType.R3D)?this.getBackgroundColor3D():this.getBackgroundColor2D();if(g===Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT){g="transparent"}return g},setBackgroundColor:function(g,h){if(h===Kekule.Render.RendererType.R3D){var i=g||this.DEF_BGCOLOR_3D;this.setBackgroundColor3D(i)}else{var i=g||this.DEF_BGCOLOR_2D;this.setBackgroundColor2D(i)}},backgroundColorChange:function(){var g=this.getBackgroundColor(this.getRenderType());var h=this.getPropStoreFieldValue("viewer");if(h){h.setBackgroundColor(g)}},adjustChildrenSizes:function(){var g=this.getPageRect();var k=Kekule.HtmlElementUtils.getElemPageRect(this._toolbarParentElem);var i=this.getTabs();var l=i&&i.getPageRect();var j=l.top-k.bottom;this.getClientPanel().setHeight(j+"px");this.getViewer().resized()},createViewer:function(h){var k=Kekule.ChemWidget.ComponentWidgetNames;var i=Kekule.Widget.EvokeMode;var g=new Kekule.ChemWidget.Viewer(this,null,this.getRenderType());g.addClassName([b.DYN_CREATED,e.CHEMOBJSETTER_VIEWER]);g.setRenderType(Kekule.Render.RendererType.R2D);g.setEnableEdit(true);g.setEnableEditFromVoid(true);g.setRestrainEditorWithCurrObj(false);g.setEnableToolbar(true);g.setPredefinedSetting("fullFunc");var j=a.exclude(g.getDefaultToolBarButtons(),k.config);j.push({action:this._configAction});j.splice(2,0,k.clearObjs);g.setToolbarParentElem(this._toolbarParentElem);g.setToolButtons(j);g.setToolbarPos(Kekule.Widget.Position.BOTTOM);g.setToolbarMarginVertical(-2);g.setToolbarEvokeModes([i.ALWAYS]);g.addEventListener("resize",this.updateInfoLabel,this);g.appendToElem(h);g.setChemObj(this.getChemObj());this.setPropStoreFieldValue("viewer",g);this.backgroundColorChange();return g},createToolbarParent:function(h){var g=h.ownerDocument.createElement("div");g.className=e.CHEMOBJSETTER_TOOLBAR_AREA;h.appendChild(g);this._toolbarParentElem=g;return g},createTabs:function(k){var o=[Kekule.$L("ChemWidgetTexts.CAPTION_2D"),Kekule.$L("ChemWidgetTexts.CAPTION_3D")];var j=(this.getRenderType()===Kekule.Render.RendererType.R3D)?1:0;var g=new Kekule.Widget.TabButtonGroup(this);g.setTabButtonPosition(Kekule.Widget.Position.BOTTOM);g.addClassName([b.DYN_CREATED,e.CHEMOBJSETTER_TABGROUP]);var p=[];for(var n=0,h=o.length;n<h;++n){var m=new Kekule.Widget.RadioButton(g);m.setText(o[n]);if(n===j){m.setChecked(true)}p.push(m)}g.addEventListener("switch",function(r){var q=r.button;var i=p.indexOf(q);var l=(i===1)?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(l);this.backgroundColorChange()},this);g.appendToElem(k);this.setPropStoreFieldValue("tabs",g);return g},createInfoLabel:function(h,i){var g=this.getDocument().createElement("div");g.className=b.DYN_CREATED+" "+e.CHEMOBJSETTER_INFOLABEL;i.getElement().appendChild(g);this._infoLabel=g;return g},updateInfoLabel:function(){var i=this.getViewer();if(i&&this._infoLabel){var h=i.getContextDimension();var g=h?this._infoLabelTemplate.format(Math.round(h.width),Math.round(h.height)):"";Kekule.DomUtils.setElementText(this._infoLabel,g)}},getContextDimension:function(){return this.getViewer().getContextDimension()},setContextDimension:function(k){var g=this.getContextDimension();var h=k.width-g.width;var i=k.height-g.height;var j=this.getDimension();var l={width:j.width+h,height:j.height+i};this.setDimension(l.width,l.height);return this},exportToDataUri:function(h,i){var g=this.getViewer().exportToDataUri(h,i);return g},exportDetails:function(h,i){if(this.getAutoSizeExport()){this.setAutoSize(true)}var j=this.getViewer().getActualDrawOptions();var l=this.getViewer().getContextDimension();var g={dataUri:this.exportToDataUri(h,i),drawOptions:j,drawOptionsJson:JSON.stringify(j),chemObj:this.getChemObj(),chemObjJson:Kekule.IO.saveMimeData(this.getChemObj(),"chemical/x-kekule-json"),autoSize:this.getAutoSizeExport(),autofit:this.getAutofit(),width:Math.round(l.width),height:Math.round(l.height),renderType:this.getRenderType()||Kekule.Render.RendererType.R2D,backgroundColor:this.getBackgroundColor(this.getRenderType()),predefinedSetting:this.getExportViewerPredefinedSetting()};if(this.getAutoSizeExport()){this.setAutoSize(false);var k=this.getViewer().getElement();k.style.width="auto";k.style.height="auto";this.getViewer().resized()}return g},getExportImgElemAttributes:function(h,i){var k=this.exportDetails(h,i);var j="width:"+k.width+"px; height:"+k.height+"px";var g={src:k.dataUri,style:j,width:k.width,height:k.height,"data-kekule-widget":"Kekule.ChemWidget.Viewer","data-render-type":k.renderType,"data-chem-obj":k.chemObjJson,"data-draw-options":k.drawOptionsJson,"data-predefined-setting":k.predefinedSetting};if(Kekule.ObjUtils.notUnset(k.autoSize)){g["data-auto-size"]=k.autoSize}if(Kekule.ObjUtils.notUnset(k.autofit)){g["data-auto-fit"]=k.autofit}if(Kekule.ObjUtils.notUnset(k.backgroundColor)){g["data-background-color"]=k.backgroundColor}return g},createExportImgElement:function(j,h,i){var g=j.createElement("img");var k=this.getExportImgElemAttributes(h,i);Kekule.DomUtils.setElemAttributes(g,k);return g},importChemObjWithDetails:function(h,g){this.setChemObj(h);this.setRenderType(g.renderType||Kekule.Render.RendererType.R2D);if(Kekule.ObjUtils.notUnset(g.autoSize)){this.setAutoSizeExport(!!g.autoSize)}if(Kekule.ObjUtils.notUnset(g.autofit)){this.setAutofit(!!g.autofit)}if(g.width&&g.height&&(!g.autoSize||g.renderType===Kekule.Render.RendererType.R3D)){this.setContextDimension({width:g.width,height:g.height})}if(g.drawOptions){this.getViewer().setDrawOptions(g.drawOptions)}if(g.backgroundColor){this.setBackgroundColor(g.backgroundColor,this.getRenderType())}return this},importFromElemAttribs:function(h){h.width=JsonUtility.parse(h.width);h.height=JsonUtility.parse(h.height);var g=h["data-chem-obj"];var i=g?Kekule.IO.loadMimeData(g,"chemical/x-kekule-json"):null;if(h["data-render-type"]){h.renderType=JsonUtility.parse(h["data-render-type"])}if(h["data-draw-options"]){h.drawOptions=JsonUtility.parse(h["data-draw-options"])}if(h["data-auto-size"]){h.autoSize=JsonUtility.parse(h["data-auto-size"])}if(h["data-autofit"]){h.autofit=JsonUtility.parse(h["data-autofit"])}if(h.backgroundColor){h.backgroundColor=h.backgroundColor}return this.importChemObjWithDetails(i,h)},importFromElem:function(g){var h=Kekule.HtmlElementUtils.getElemPageRect(g);var i=Kekule.DomUtils.fetchAttributeValuesToJson(g);if(!i.width){i.width=h.width}if(!i.height){i.height=h.height}return this.importFromElemAttribs(i)}});Kekule.ChemWidget.ChemObjInserter.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter.Configurator",initialize:function($super,g){this._checkBoxAutoSize=null;this._checkBoxAutofit=null;this._checkBoxShowInfo=null;this._textBoxWidth=null;this._textBoxHeight=null;this._colorPicker=null;$super(g);this.addEventListener("valueChange",function(h){this.saveConfigValues()},this)},initPropValues:function($super){$super();this.setAutoUpdate(true)},doGetWidgetClassName:function($super){return $super()+" "+e.CHEMOBJSETTER_CONFIGURATOR},doCreateSubElements:function(m,k){var l=m.createElement("div");l.className=e.CHEMOBJSETTER_REGION;var j=new Kekule.Widget.CheckBox(this);j.setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOSIZE"));j.addClassName(e.CHEMOBJSETTER_LINE);j.appendToElem(l);this._checkBoxAutoSize=j;var h=m.createElement("span");h.className=b.PART_ASSOC_TEXT_CONTENT;d.setElementText(h,Kekule.$L("ChemWidgetTexts.HINT_AUTOSIZE"));l.appendChild(h);var j=new Kekule.Widget.CheckBox(this);j.setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOFIT"));j.addClassName(e.CHEMOBJSETTER_LINE);j.appendToElem(l);this._checkBoxAutofit=j;var h=m.createElement("span");h.className=b.PART_ASSOC_TEXT_CONTENT;d.setElementText(h,Kekule.$L("ChemWidgetTexts.HINT_AUTOFIT"));l.appendChild(h);k.appendChild(l);var l=m.createElement("div");l.className=e.CHEMOBJSETTER_REGION;var i=m.createElement("label");i.className=e.CHEMOBJSETTER_REGION_LABEL;d.setElementText(i,Kekule.$L("ChemWidgetTexts.CAPTION_LABEL_SIZE"));l.appendChild(i);l.appendChild(m.createElement("br"));var n=new Kekule.Widget.TextBox(this);n.setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_WIDTH"));n.appendToElem(l);this._textBoxWidth=n;var i=m.createElement("span");d.setElementText(i,"×");l.appendChild(i);var n=new Kekule.Widget.TextBox(this);n.setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_HEIGHT"));n.appendToElem(l);this._textBoxHeight=n;var j=new Kekule.Widget.CheckBox(this);j.setText(Kekule.$L("ChemWidgetTexts.CAPTION_SHOWSIZEINFO"));j.appendToElem(l);this._checkBoxShowInfo=j;k.appendChild(l);var l=m.createElement("div");l.className=e.CHEMOBJSETTER_REGION;var i=m.createElement("label");i.className=e.CHEMOBJSETTER_REGION_LABEL;d.setElementText(i,Kekule.$L("ChemWidgetTexts.CAPTION_BACKGROUND_COLOR"));l.appendChild(i);l.appendChild(m.createElement("br"));var g=new Kekule.Widget.ColorPicker(this);g.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT]);g.appendToElem(l);this._colorPicker=g;k.appendChild(l)},loadConfigValues:function($super){$super();var g=this.getWidget();if(g){var i=!g.getIs3D();this._checkBoxAutoSize.setChecked(i&&g.getAutoSizeExport());this._checkBoxAutoSize.setEnabled(i);this._checkBoxAutofit.setChecked(i&&g.getAutofit());this._checkBoxAutofit.setEnabled(i);this._checkBoxShowInfo.setChecked(g.getShowInfo());var j=g.getContextDimension();this._textBoxWidth.setText(Math.round(j.width));this._textBoxHeight.setText(Math.round(j.height));var h=i?g.getBackgroundColor2D():g.getBackgroundColor3D();this._colorPicker.setValue(h||Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT)}},saveConfigValues:function($super){$super();var g=this.getWidget();if(g){var h=!g.getIs3D();if(h){g.setAutoSizeExport(this._checkBoxAutoSize.getChecked());g.setAutofit(this._checkBoxAutofit.getChecked());g.setBackgroundColor2D(this._colorPicker.getValue())}else{g.setBackgroundColor3D(this._colorPicker.getValue())}g.setShowInfo(this._checkBoxShowInfo.getChecked());var i={width:parseInt(this._textBoxWidth.getText()),height:parseInt(this._textBoxHeight.getText())};g.setContextDimension(i);g.invokeEvent("configSave")}}})})();(function(){var b=Kekule;var c=Kekule.CoordMode;var a=Kekule.ArrayUtils;ClassEx.extend(Kekule.ChemObject,{isStandalone:function(){return !this.getIsAttachedToParent()},getStandaloneAncestor:function(){var d=this;while(d.isStandalone&&(!d.isStandalone())&&d.getParent&&d.getParent()){d=d.getParent()}return d},getCascadeDeleteObjs:function(){return[]},cascadeRemove:function(e){var d=this.getParent();if(d&&d.notifyBeforeCascadeRemove){d.notifyBeforeCascadeRemove(this)}if(e){this.finalize()}else{this.removeSelf()}if(d&&d.notifyAfterCascadeRemove){d.notifyAfterCascadeRemove(this)}},notifyBeforeCascadeRemove:function(d,e){},notifyAfterCascadeRemove:function(d,e){if((!this.getKeepEmptyEvenOnCascadeRemove())&&this.isEmpty()){this.cascadeRemove(e)}},isCoordDependent:function(){return false},getCoordDependentObjects:function(){var d=[];if(!this.isCoordDependent()){d.push(this)}return d},getCoordDeterminateObjects:function(){var d=[];if(this.getAttachedMarkers){var g=this.getAttachedMarkers()||[];for(var f=0,e=g.length;f<e;++f){d=d.concat(g[f].getCoordDependentObjects())}}return d},getAllContainingConnectors:function(){return[]},getConstraintManipulationBaseObj:function(){if(this.isAttachedMarker&&this.isAttachedMarker()){var d=this.getParent();if(d instanceof Kekule.StructureFragment){return null}else{return d}}else{return null}},transformAbsCoordByMatrix:function(h,k,g,n,e,q){if(this.getChildCount&&(n||Kekule.ObjUtils.isUnset(n))){for(var j=0,f=this.getChildCount();j<f;++j){var d=this.getChildAt(j);if(d&&d.transformAbsCoordByMatrix){d.transformAbsCoordByMatrix(k,k,g,n,e,true)}}}var p=(g===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix;if(q){if(this.getCoordOfMode&&this.setCoordOfMode){var m=this.getCoordOfMode(g,e);var o=p(m,h);this.setCoordOfMode(o,g)}}else{if(this.getAbsCoordOfMode&&this.setAbsCoordOfMode){var m=this.getAbsCoordOfMode(g,e);var o=p(m,h);this.setAbsCoordOfMode(o,g)}}},scaleSize:function(f,h,m,e){if(this.getSizeOfMode&&this.setSizeOfMode){var n=this.getSizeOfMode(h,e);var k=Kekule.CoordUtils.multiply(n,f);this.setSizeOfMode(k,h)}if(this.getChildCount&&(m||Kekule.ObjUtils.isUnset(m))){for(var j=0,g=this.getChildCount();j<g;++j){var d=this.getChildAt(j);if(d&&d.scaleSize){d.scaleSize(f,h,m,e)}}}}});ClassEx.extendMethod(Kekule.ChemObject,"_attachedMarkerAdded",function(f,e){var d=f(e);if(e){e.setIsAttachedToParent(true)}return d});ClassEx.extendMethod(Kekule.ChemObject,"_attachedMarkerRemoved",function(f,e){var d=f(e);if(e){e.setIsAttachedToParent(false)}return d});ClassEx.defineProps(Kekule.ChemObject,[{name:"keepEmptyEvenOnCascadeRemove",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC},{name:"isAttachedToParent",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}]);ClassEx.extend(Kekule.ChemStructureObject,{getCascadeDeleteObjs:function($super){var d=$super();var j=this.getLinkedConnectors?this.getLinkedConnectors():[];for(var h=0,f=j.length;h<f;++h){var e=j[h];if(e.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(d,e);var g=e.getCascadeDeleteObjs();Kekule.ArrayUtils.pushUnique(d,g)}}return d},isStandalone:function($super){return false},getCoordDeterminateObjects:function($super){var d=$super();var g=this.getLinkedConnectors();for(var h=0,f=g.length;h<f;++h){var e=g[h];a.pushUnique(d,e);a.pushUnique(d,e.getCoordDeterminateObjects())}return d}});ClassEx.extend(Kekule.BaseStructureNode,{getCascadeDeleteObjs:function($super){return $super()},isCoordDependent:function(){return false},move:function(g,f){var e=this.getCoordOfMode(f);var d=Kekule.CoordUtils.add(e,g);this.setCoordOfMode(d,f);return d},move2D:function(d){return this.move(d,c.COORD2D)},move3D:function(d){return this.move(d,c.COORD3D)}});ClassEx.extend(Kekule.BaseStructureConnector,{getCascadeDeleteObjs:function($super){var d=$super();var h=this.getConnectedObjs();for(var f=0,e=h.length;f<e;++f){var g=h[f];if(g instanceof Kekule.BaseStructureNode){if(g.getLinkedConnectors().length<=1){Kekule.ArrayUtils.pushUnique(d,g)}}}return d},isCoordDependent:function(){return true},getCoordDependentObjects:function($super){var d=$super();var h=this.getConnectedObjs();for(var f=0,e=h.length;f<e;++f){var g=h[f];var j;if(g.isExposed){var j=g.isExposed()?g:g.getExposedAncestor()}else{j=g}if(j){a.pushUnique(d,j.getCoordDependentObjects())}}return d},move:function(h,f){for(var e=0,d=this.getConnectedObjCount();e<d;++e){var g=this.getConnectedObjAt(e);if(g.move){g.move(h,f)}}},move2D:function(d){return this.move(d,c.COORD2D)},move3D:function(d){return this.move(d,c.COORD3D)},setAbsBaseCoord:function(f,e){var d=this.getAbsBaseCoord();var g=Kekule.CoordUtils.substract(f,d);this.move(g,e)},setAbsBaseCoord2D:function(d){this.setAbsCoordOfMode(d,Kekule.CoordMode.COORD2D)},setAbsBaseCoord3D:function(d){this.setAbsCoordOfMode(d,Kekule.CoordMode.COORD3D)}});ClassEx.extend(Kekule.ChemStructureNode,{getConstraintManipulationBaseObj:function($super){var d=this.getLinkedObjs();return(d.length===1)?d[0]:$super()}});ClassEx.extend(Kekule.Glyph.PathGlyphNode,{getCascadeDeleteObjs:function($super){var d=[this.getParent()];return d}});ClassEx.extend(Kekule.Glyph.PathGlyphConnector,{getCascadeDeleteObjs:function($super){var d=[this.getParent()];return d}});ClassEx.extend(Kekule.StructureFragment,{isStandalone:function($super){return !this.getCrossConnectors().length},notifyBeforeCascadeRemove:function($super,f,h){var d=this._getObjsNeedToBeCascadeRemoved(f);if(d&&d.length){for(var e=d.length-1;e>=0;--e){var g=d[e];if(h){g.finalize()}else{g.removeSelf()}}}$super(f,h)},getCoordDependentObjects:function($super){if(this.isExpanded&&!this.isExpanded()){return $super()}else{if(!this.hasCtab()){return $super()}else{var d=[];var e=this.getChildCount();for(var f=0;f<e;++f){var g=this.getChildAt(f);a.pushUnique(d,g.getCoordDependentObjects())}return d}}},transformAbsCoordByMatrix:function($super,h,k,g,m,e,n){if(m||Kekule.ObjUtils.isUnset(m)){for(var j=0,f=this.getNodeCount();j<f;++j){var d=this.getNodeAt(j);if(d&&d.transformAbsCoordByMatrix){d.transformAbsCoordByMatrix(k,k,g,m,e,true)}}}$super(h,k,g,false,e,n)}});ClassEx.extend(Kekule.Glyph.Base,{isStandalone:function($super){return $super()}});ClassEx.extend(Kekule.Glyph.PathGlyph,{getCoordDependentObjects:function(){var d=[];var e=this.getNodeCount();for(var f=0;f<e;++f){var g=this.getNodeAt(f);d.push(g)}return d},transformAbsCoordByMatrix:function($super,h,k,g,m,e,n){if(m||Kekule.ObjUtils.isUnset(m)){for(var j=0,f=this.getNodeCount();j<f;++j){var d=this.getNodeAt(j);if(d&&d.transformAbsCoordByMatrix){d.transformAbsCoordByMatrix(k,k,g,m,e,true)}}}$super(h,k,g,false,e,n)}})})();(function(){var a=Kekule.ArrayUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{EDITOR:"K-Chem-Editor",EDITOR_CLIENT:"K-Chem-Editor-Client",EDITOR_UIEVENT_RECEIVER:"K-Chem-Editor-UiEvent-Receiver",EDITOR2D:"K-Chem-Editor2D",EDITOR3D:"K-Chem-Editor3D"});Kekule.ChemWidget.Editor={};Kekule.Editor=Kekule.ChemWidget.Editor;Kekule.Editor.CoordSys=Kekule.Render.CoordSystem;Kekule.Editor.BoxRegion={OUTSIDE:0,CORNER_TL:1,CORNER_TR:2,CORNER_BL:3,CORNER_BR:4,EDGE_TOP:11,EDGE_LEFT:12,EDGE_BOTTOM:13,EDGE_RIGHT:14,INSIDE:20};Kekule.Editor.SelectMode={RECT:0,POLYGON:1,POLYLINE:2,ANCESTOR:10};Kekule.Editor.BaseEditor=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.Editor.BaseEditor",BINDABLE_TAG_NAMES:["div","span"],OBSERVING_GESTURES:["rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout",],initialize:function($super,f,i,h,g){this._objSelectFlag=0;this._objectUpdateFlag=0;this._objectManipulateFlag=0;this._uiMarkerUpdateFlag=0;this._updatedObjectDetails=[];this._operatingObjs=[];this._operatingRenderers=[];this._initialRenderTransformParams=null;this._objChanged=false;this._lengthCaches={};this.setPropStoreFieldValue("enableCreateNewDoc",true);this.setPropStoreFieldValue("enableOperHistory",true);this.setPropStoreFieldValue("enableOperContext",true);this.setPropStoreFieldValue("initOnNewDoc",true);$super(f,i,h);if(!this.getChemObj()&&this.getInitOnNewDoc()&&this.getEnableCreateNewDoc()){this.newDoc()}this.setPropStoreFieldValue("editorConfigs",g||this.createDefaultConfigs());this.setEnableGesture(true)},initProperties:function(){this.defineProp("editorConfigs",{dataType:"Kekule.Editor.BaseEditorConfigs",serializable:false,getter:function(){return this.getDisplayerConfigs()},setter:function(f){return this.setDisplayerConfigs(f)}});this.defineProp("defBondLength",{dataType:DataType.FLOAT,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("defBondLength");if(!f){f=this.getEditorConfigs().getStructureConfigs().getDefBondLength()}return f}});this.defineProp("defBondScreenLength",{dataType:DataType.FLOAT,serializable:false,setter:null,getter:function(){var g=this._lengthCaches.defBondScreenLength;if(g){return g}else{var h=this.getDefBondLength()||0;var f=this.translateDistance(h,Kekule.Render.CoordSystem.CHEM,Kekule.Render.CoordSystem.SCREEN);this._lengthCaches.defBondScreenLength=f;return f}}});this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:false,setter:null,getter:function(){var f=this.getCurrPointerType();return this.getInteractionBoundInflation(f)}});this.defineProp("currPointerType",{dataType:DataType.STRING,serializable:false});this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:false});this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false});this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,getter:function(){var f=this.getPropStoreFieldValue("operHistory");if(!f){f=new Kekule.OperationHistory();this.setPropStoreFieldValue("operHistory",f);f.addEventListener("push",this.reactOperHistoryPush,this);f.addEventListener("pop",this.reactOperHistoryPop,this);f.addEventListener("undo",this.reactOperHistoryUndo,this);f.addEventListener("redo",this.reactOperHistoryRedo,this);f.addEventListener("clear",this.reactOperHistoryClear,this);f.addEventListener("change",this.reactOperHistoryChange,this)}return f},setter:null});this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("selection");if(!f){f=[];this.setPropStoreFieldValue("selection",f)}return f},setter:function(f){this.setPropStoreFieldValue("selection",f);this.selectionChanged()}});this.defineProp("selectMode",{dataType:DataType.INT,getter:function(){var f=this.getPropStoreFieldValue("selectMode");if(Kekule.ObjUtils.isUnset(f)){f=Kekule.Editor.SelectMode.RECT}return f},setter:function(f){if(this.getSelectMode()!==f){this.setPropStoreFieldValue("selectMode",f);this.hideSelectingMarker()}}});this.defineProp("isToggleSelectOn",{dataType:DataType.BOOL});this.defineProp("hotTrackedObjs",{dataType:DataType.ARRAY,serializable:false,setter:function(k){var m=k?Kekule.ArrayUtils.toArray(k):[];if(this.getEditorConfigs()&&this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){this.setPropStoreFieldValue("hotTrackedObjs",m);var j;if(m&&m.length){j=[];for(var g=0,f=m.length;g<f;++g){var h=this.getBoundInfoRecorder().getBound(this.getObjContext(),m[g]);if(j){Kekule.ArrayUtils.pushUnique(j,h)}}}if(j){this.changeHotTrackMarkerBounds(j)}else{if(this.getUiHotTrackMarker().getVisible()){this.hideHotTrackMarker()}}}}});this.defineProp("hotTrackedObj",{dataType:DataType.OBJECT,serializable:false,getter:function(){return this.getHotTrackedObjs()&&this.getHotTrackedObjs()[0]},setter:function(f){this.setHotTrackedObjs(f)}});this.defineProp("enableOperContext",{dataType:DataType.BOOL,setter:function(h){this.setPropStoreFieldValue("enableOperContext",!!h);if(!h){var g=this.getPropStoreFieldValue("operContext");var f=this.getPropStoreFieldValue("drawBridge");if(f&&g){f.releaseContext(g)}}}});this.defineProp("enableGesture",{dataType:DataType.BOOL,setter:function(g){var f=!!g;if(this.getEnableGesture()!==f){this.setPropStoreFieldValue("enableGesture",f);if(f){this.startObservingGestureEvents(this.OBSERVING_GESTURES)}else{this.startObservingGestureEvents(this.OBSERVING_GESTURES)}}}});this.defineProp("uiEventReceiverElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("objContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("operContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("uiContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("objContext",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){return this.getDrawContext()}});this.defineProp("operContext",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){if(!this.getEnableOperContext()){return null}else{var f=this.getPropStoreFieldValue("operContext");if(!f){var i=this.getDrawBridge();if(i){var g=this.getOperContextParentElem();if(!g){return null}else{var h=Kekule.HtmlElementUtils.getElemScrollDimension(g);f=i.createContext(g,h.width,h.height);this.setPropStoreFieldValue("operContext",f)}}}return f}}});this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("uiContext");if(!f){var i=this.getUiDrawBridge();if(i){var g=this.getUiContextParentElem();if(!g){return null}else{var h=Kekule.HtmlElementUtils.getElemScrollDimension(g);f=i.createContext(g,h.width,h.height);this.setPropStoreFieldValue("uiContext",f)}}}return f}});this.defineProp("objDrawBridge",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){return this.getDrawBridge()}});this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("uiDrawBridge");if(!f){f=this.createUiDrawBridge();this.setPropStoreFieldValue("uiDrawBridge",f)}return f}});this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("uiPainter");if(!f){var g=this.getUiMarkers();f=new Kekule.Render.ChemObjPainter(Kekule.Render.RendererType.R2D,g,this.getUiDrawBridge());f.setCanModifyTargetObj(true);this.setPropStoreFieldValue("uiPainter",f);return f}return f}});this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:false,setter:null,getter:function(){var g=this.getUiPainter();if(g){var f=g.getRenderer();if(!f){g.prepareRenderer()}return g.getRenderer()||null}else{return null}}});this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("uiMarkers");if(!f){f=new Kekule.ChemWidget.UiMarkerCollection();this.setPropStoreFieldValue("uiMarkers",f)}return f}});this._defineUiMarkerProp("uiHotTrackMarker");this._defineUiMarkerProp("uiSelectionAreaMarker");this._defineUiMarkerProp("uiSelectingMarker");this.defineProp("uiSelectionAreaContainerBox",{dataType:DataType.Object,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("objRendererMap",{dataType:"Kekule.MapEx",serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("objRendererMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("objRendererMap",f)}return f}});this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:false,setter:null});this.defineProp("zoomCenter",{dataType:DataType.HASH})},_defineUiMarkerProp:function(f,g){return this.defineProp(f,{dataType:"Kekule.ChemWidget.AbstractUIMarker",serializable:false,getter:function(){var h=this.getPropStoreFieldValue(f);if(!h){h=this.createShapeBasedMarker(f,null,null,false)}return h},setter:function(i){if(!g){g=this.getUiMarkers()}var h=this.getPropValue(f);if(h){g.removeMarker(h);h.finalize()}g.addMarker(i);this.setPropStoreFieldValue(f,i)}})},doFinalize:function($super){var j=this.getPropStoreFieldValue("operHistory");if(j){j.finalize();this.setPropStoreFieldValue("operHistory",null)}var g=this.getPropStoreFieldValue("objDrawBridge");var i=this.getPropStoreFieldValue("operContext");if(g&&i){g.releaseContext(i)}this.setPropStoreFieldValue("operContext",null);var g=this.getPropStoreFieldValue("uiDrawBridge");var i=this.getPropStoreFieldValue("uiContext");if(g&&i){g.releaseContext(i)}this.setPropStoreFieldValue("uiDrawBridge",null);this.setPropStoreFieldValue("uiContext",null);var k=this.getPropStoreFieldValue("boundInfoRecorder");if(k){k.finalize()}this.setPropStoreFieldValue("boundInfoRecorder",null);var f=this.getPropStoreFieldValue("objRendererMap");if(f){f.finalize()}this.setPropStoreFieldValue("objRendererMap",null);$super()},createDefaultConfigs:function(){return new Kekule.Editor.BaseEditorConfigs()},doCreateRootElement:function(g){var f=g.createElement("div");return f},doCreateSubElements:function(h,f){var g=h.createElement("div");g.className=e.EDITOR_CLIENT;f.appendChild(g);this._editClientElem=g;return[g]},getCoreElement:function($super){return this._editClientElem||$super()},getEditClientElem:function(){return this._editClientElem},doGetWidgetClassName:function($super){var g=$super()+" "+e.EDITOR;var f=(this.getRenderType()===Kekule.Render.RendererType.R3D)?e.EDITOR3D:e.EDITOR2D;g+=" "+f;return g},doBindElement:function(f){this.createContextParentElems();this.createUiEventReceiverElem()},doGetInitialZoom:function($super){var f;var g=this.getEditorConfigs();if(g){f=g.getInteractionConfigs().getEditorInitialZoom()}if(!f){f=$super()}return f},doSetInitialZoom:function($super,g){var f=this.getEditorConfigs();if(f){f.getInteractionConfigs().setEditorInitialZoom(g)}$super(g)},zoomTo:function($super,k,h,f){var n=Kekule.CoordUtils;var l=this.getCurrZoom();var i=k;var o=$super(k,h);var m=this.getElement();var j={x:m.scrollLeft,y:m.scrollTop};if(!f){f=this.getZoomCenter()}if(!f){f=n.add(j,{x:m.clientWidth/2,y:m.clientHeight/2})}var g=n.multiply(f,i/l-1);m.scrollLeft+=g.x;m.scrollTop+=g.y;return o},zoomIn:function(h,f){var i=this.getCurrZoom();var g=Kekule.ZoomUtils.getNextZoomInRatio(i,h||1);return this.zoomTo(g,null,f)},zoomOut:function(h,f){var i=this.getCurrZoom();var g=Kekule.ZoomUtils.getNextZoomOutRatio(i,h||1);return this.zoomTo(g,null,f)},resetZoom:function(f){return this.zoomTo(this.getInitialZoom()||1,null,f)},changeClientSize:function(j,r,n){this._initialRenderTransformParams=null;var k=this.getCoreElement();var g=k.style;if(!n){n=1}var q=j*n;var p=r*n;if(q){g.width=q+"px"}if(p){g.height=p+"px"}var f=[this.getObjContext(),this.getOperContext(),this.getUiContext()];for(var o=0,m=f.length;o<m;++o){var s=f[o];if(s){this.getDrawBridge().setContextDimension(s,q,p)}}this.repaint()},isDirty:function(){if(this.getEnableOperHistory()){return this.getOperHistory().getCurrIndex()>=0}else{return this._objChanged}},getChemObjSrcInfo:function(f){if(this.isDirty()){return null}else{return f.getSrcInfo?f.getSrcInfo():null}},getActualDrawOptions:function($super){var g=$super();if(this._initialRenderTransformParams){var f=Object.extend({},this._initialRenderTransformParams);f=Object.extend(f,g);return f}else{return g}},repaint:function($super,h){var g=h;var f=$super(g);if(!this._initialRenderTransformParams){this._initialRenderTransformParams=this.getPainter().getActualInitialRenderTransformOptions(this.getObjContext())}this.recalcUiMarkers();return f},newDoc:function(){this.load(this.doCreateNewDocObj())},doCreateNewDocObj:function(){return new Kekule.Molecule()},getExportableClasses:function(){var f=this.getChemObj();if(!f){return[]}else{return f.getClass?f.getClass():null}},exportObj:function(f){return this.exportObjs(f)[0]},exportObjs:function(f){var g=this.getChemObj();if(!f){return[g]}else{return(g&&(g instanceof f))?[g]:[]}},doLoad:function($super,f){this.deselectAll();this._initialRenderTransformParams=null;this.getObjRendererMap().clear();if(this.getOperHistory()){this.getOperHistory().clear()}$super(f);this._objChanged=false},doLoadEnd:function($super,f){$super();if(!f){this._initialRenderTransformParams=null}},doResize:function($super){this._initialRenderTransformParams=null;$super()},geometryOptionChanged:function($super){var f=this.getDrawOptions().zoom;this.zoomChanged(f);this._clearLengthCaches();$super()},zoomChanged:function(f){},_clearLengthCaches:function(){this._lengthCaches={}},chemObjChanged:function($super,g,f){$super(g,f);if(g!==f){if(f){this._uninstallChemObjEventListener(f)}if(g){this._installChemObjEventListener(g)}}},_installChemObjEventListener:function(f){f.addEventListener("change",this.reactChemObjChange,this)},_uninstallChemObjEventListener:function(f){f.removeEventListener("change",this.reactChemObjChange,this)},createUiEventReceiverElem:function(){var g=this.getCoreElement();if(g){var f=g.ownerDocument.createElement("div");f.className=e.EDITOR_UIEVENT_RECEIVER;g.appendChild(f);d.addClass(f,b.DYN_CREATED);this.setPropStoreFieldValue("uiEventReceiverElem",f);return f}},createContextParentElems:function(){var f=this.getCoreElement();if(f){var g=f.ownerDocument;this._createContextParentElem(g,f,"objContextParentElem");this._createContextParentElem(g,f,"operContextParentElem");this._createContextParentElem(g,f,"uiContextParentElem")}},_createContextParentElem:function(i,g,h){var f=i.createElement("div");f.style.position="absolute";f.style.width="100%";f.style.height="100%";f.className=h+" "+b.DYN_CREATED;this.setPropStoreFieldValue(h,f);g.appendChild(f);return f},createNewPainter:function($super,g){var f=$super(g);if(f){f.setCanModifyTargetObj(true);this.installPainterEventHandlers(f);this.createNewBoundInfoRecorder(this.getPainter())}return f},createNewBoundInfoRecorder:function(h){var f=this.getPropStoreFieldValue("boundInfoRecorder");if(f){f.finalize()}var g=new Kekule.Render.BoundInfoRecorder(h);this.setPropStoreFieldValue("boundInfoRecorder",g)},getDrawContextParentElem:function(){return this.getObjContextParentElem()},createUiDrawBridge:function(){var f=Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!f){Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"))}return f},changeContextDimension:function($super,g){var f=$super(g);if(f){this._resizeContext(this.getOperContext(),this.getObjDrawBridge(),g.width,g.height);this._resizeContext(this.getUiContext(),this.getUiDrawBridge(),g.width,g.height)}return f},_resizeContext:function(g,i,h,f){if(g&&i){i.setContextDimension(g,h,f)}},_clearSpecContext:function(f,g){if(g&&f){g.clearContext(f)}},clearObjContext:function(){this._clearSpecContext(this.getObjContext(),this.getDrawBridge());if(this.getBoundInfoRecorder()){this.getBoundInfoRecorder().clear(this.getObjContext())}},clearOperContext:function(){this._clearSpecContext(this.getOperContext(),this.getDrawBridge())},clearUiContext:function(){this._clearSpecContext(this.getUiContext(),this.getUiDrawBridge())},clearContext:function(){this.clearObjContext();if(this._operatingRenderers){this.clearOperContext()}},repaintOperContext:function(g){if(this._operatingRenderers&&this._operatingObjs){this.clearOperContext();var f={partialDrawObjs:this._operatingObjs,doNotClear:true};this.repaint(f)}},getOperatingRenderers:function(){if(!this._operatingRenderers){this._operatingRenderers=[]}return this._operatingRenderers},setOperatingRenderers:function(f){this._operatingRenderers=f},installPainterEventHandlers:function(f){f.addEventListener("prepareDrawing",this.reactChemObjPrepareDrawing,this);f.addEventListener("clear",this.reactChemObjClear,this)},reactChemObjPrepareDrawing:function(o){var h=o.context;var n=o.obj;if(n&&((h===this.getObjContext())||(h===this.getOperContext()))){var m=o.target;this.getObjRendererMap().set(n,m);if(this.getEnableOperContext()){var k=this._operatingObjs||[];var g=false;for(var j=0,f=k.length;j<f;++j){if(this._isChemObjDirectlyRenderedByRenderer(this.getObjContext(),k[j],m)){g=true;break}}if(g){this._setRendererToOperContext(m);a.pushUnique(this.getOperatingRenderers(),m)}}}},reactChemObjClear:function(i){var f=i.context;var h=i.obj;if(h&&((f===this.getObjContext())||(f===this.getOperContext()))){var g=i.target;this.getObjRendererMap().remove(h);a.remove(this.getOperatingRenderers(),g)}},reactChemObjChange:function(g){var f=g.target;var i=g.changedPropNames||[];var h=["id","owner","ownedObjs"];i=Kekule.ArrayUtils.exclude(i,h);if(i.length||!g.changedPropNames){this.objectChanged(f,i)}},reactOperHistoryPush:function(f){this.invokeEvent("operPush",f)},reactOperHistoryPop:function(f){this.invokeEvent("operPop",f)},reactOperHistoryUndo:function(f){this.invokeEvent("operUndo",f)},reactOperHistoryRedo:function(f){this.invokeEvent("operRedo",f)},reactOperHistoryClear:function(f){this.invokeEvent("operHistoryClear",f)},reactOperHistoryChange:function(f){this.invokeEvent("operChange",f)},beginUpdateObject:function(){if(this._objectUpdateFlag>=0){this.invokeEvent("beginUpdateObject")}--this._objectUpdateFlag},endUpdateObject:function(){++this._objectUpdateFlag;if(!this.isUpdatingObject()){if((this._updatedObjectDetails&&this._updatedObjectDetails.length)){this.objectsChanged(this._updatedObjectDetails);this._updatedObjectDetails=[]}this.invokeEvent("endUpdateObject")}},isUpdatingObject:function(){return(this._objectUpdateFlag<0)},_mergeObjUpdatedDetails:function(g,j){for(var h=0,f=j.length;h<f;++h){this._mergeObjUpdatedDetailItem(g,j[h])}},_mergeObjUpdatedDetailItem:function(g,j){for(var h=0,f=g.length;h<f;++h){var k=g[h];if(k.obj===j.obj){if(!k.propNames){k.propNames=[]}if(j.propNames){Kekule.ArrayUtils.pushUnique(k.propNames,j.propNames)}return}}g.push(j)},_logUpdatedDetail:function(f){var g="";f.forEach(function(h){g+="Obj: "+h.obj.getId()+"["+h.obj.getClassName()+"]     ";g+="Props: ["+h.propNames.join(", ")+"]";g+="\n"});console.log(g)},objectChanged:function(i,g){var h={obj:i,propNames:g};var f=this.objectsChanged(h);this.invokeEvent("editObjChanged",Object.extend({},h));return f},objectsChanged:function(h){var f=DataType.isArrayValue(h)?h:[h];if(this.isUpdatingObject()){this._mergeObjUpdatedDetails(this._updatedObjectDetails,f)}else{var g=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(f);this.doObjectsChanged(f,g);this.invokeEvent("editObjsUpdated",{details:Object.extend({},h)})}this._objChanged=true;this.invokeEvent("editObjsChanged",{details:Object.extend({},h)});var j=this.getSelection();if(j&&g){var i=a.intersect(j,g);if(i.length){this.invokeEvent("selectedObjsUpdated",{objs:i})}}},doObjectsChanged:function(m,j){var g=Kekule.ArrayUtils.clone(m);if(!j){j=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(g)}var l=this._getAdditionalRenderRelatedObjs(j);if(l.length){var i=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(l);Kekule.ArrayUtils.pushUnique(g,i)}Kekule.ArrayUtils.pushUnique(j,l);var f=this._operatingRenderers;var h=f&&this._isAllObjsRenderedByRenderers(this.getObjContext(),j,f);var k=this.canModifyPartialGraphic();if(k){this.getRootRenderer().modify(this.getObjContext(),g);this.recalcUiMarkers()}else{if(h){this.repaintOperContext()}else{this.repaint()}}},beginManipulateObject:function(){if(this._objectManipulateFlag>=0){this.invokeEvent("beginManipulateObject")}--this._objectManipulateFlag},endManipulateObject:function(){++this._objectManipulateFlag;if(!this.isManipulatingObject()){this._objectManipulateFlag=0;this.invokeEvent("endManipulateObject")}},isManipulatingObject:function(){return(this._objectManipulateFlag<0)},_needToCanonicalizeBeforeSaving:function(){return true},_getAdditionalRenderRelatedObjs:function(m){var f=[];for(var h=0,g=m.length;h<g;++h){var j=m[h];var k=j.getCoordDeterminateObjects?j.getCoordDeterminateObjects():[];Kekule.ArrayUtils.pushUnique(f,k)}return f},_isAllObjsRenderedByRenderers:function(f,p,q){for(var o=0,g=p.length;o<g;++o){var n=p[o];var s=false;for(var m=0,h=q.length;m<h;++m){var r=q[m];if(r.isChemObjRenderedBySelf(f,n)){s=true;break}}if(!s){return false}}return true},prepareOperatingObjs:function(f){if(this._operatingRenderers&&this._operatingRenderers.length){this.endOperatingObjs(true)}if(this.getEnableOperContext()){this._prepareRenderObjsInOperContext(f);this._operatingObjs=f}this.repaint()},endOperatingObjs:function(f){if(this.getEnableOperContext()){this._endRenderObjsInOperContext();this._operatingObjs=null;if(!f){this.repaint()}}},_isChemObjDirectlyRenderedByRenderer:function(g,i,h){var f=i.getStandaloneAncestor?i.getStandaloneAncestor():i;return h.isChemObjRenderedDirectlyBySelf(g,f)},_getStandaloneRenderObjsInOperContext:function(k){var j=[];for(var g=0,f=k.length;g<f;++g){var h=k[g];if(h.getStandaloneAncestor){h=h.getStandaloneAncestor()}Kekule.ArrayUtils.pushUnique(j,h)}return j},_prepareRenderObjsInOperContext:function(t){var h=[];var f=this.getObjRendererMap();var p=f.getValues();var g=this.getObjContext();var m=this._getStandaloneRenderObjsInOperContext(t);for(var s=0,n=m.length;s<n;++s){var r=m[s];for(var q=0,o=p.length;q<o;++q){var u=p[q];if(u.isChemObjRenderedDirectlyBySelf(g,r)){Kekule.ArrayUtils.pushUnique(h,u)}}}if(h.length>0){for(var s=0,n=h.length;s<n;++s){var u=h[s];this._setRendererToOperContext(u)}this._operatingRenderers=h}else{this._operatingRenderers=null}},_endRenderObjsInOperContext:function(){var g=this._operatingRenderers;if(g&&g.length){for(var h=0,f=g.length;h<f;++h){var j=g[h];this._unsetRendererToOperContext(j)}this.clearOperContext()}this._operatingRenderers=null},_setRendererToOperContext:function(f){f.setRedirectContext(this.getOperContext())},_unsetRendererToOperContext:function(f){f.setRedirectContext(null)},getInteractionBoundInflation:function(g){var f=this._lengthCaches.interactionBoundInflations;var o=g||"default";if(f){if(f[o]){return f[o]}}var h=this.getEditorConfigs().getInteractionConfigs();var q="objBoundTrackInflationRatio";var s,n=h.getPropValue(q);if(g){var i=g.upperFirst();var l=q+i;if(h.hasProperty(l)){s=h.getPropValue(l)}}var m=s||n;var k=m&&this.getDefBondScreenLength()*m;var v="objBoundTrackMinInflation";var j,t=h.getPropValue(v);if(g){var p=v+i;if(h.hasProperty(p)){j=h.getPropValue(p)}}var u=j||t;var r=Math.max(k||0,u);if(!f){f={};this._lengthCaches.interactionBoundInflations=f}f[o]=r;return r},clearBoundMap:function(){this.getBoundInfoRecorder().clear(this.getObjContext())},findTopmostBoundInfo:function(i,h){if(i&&i.length){var f=null;var g=i.length-1;f=i[g];while((g>=0)&&(h&&(h.indexOf(f.obj)>=0))){--g;f=i[g]}return f}else{return null}},getBoundInfosAtCoord:function(g,j,k){var f=this.getBoundInfoRecorder();var m=k||this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation();var l=this.screenCoordToContext(g);var i=(this.getRenderType()===Kekule.Render.RendererType.R3D)?{x:0,y:0}:null;var h=f.getIntersectionInfos(this.getObjContext(),l,i,m,j);return h},getTopmostBoundInfoAtCoord:function(o,n,r){var f=this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest();if(!f){return this.findTopmostBoundInfo(this.getBoundInfosAtCoord(o,null,r),n,r)}var m=Kekule.Render.MetaShapeUtils;var g=this.getBoundInfosAtCoord(o,null,r);var t,j,l;var p=function(i,u,v){t=i;j=u||i.boundInfo;if(Kekule.ObjUtils.notUnset(v)){l=v}else{l=m.getDistance(o,j)}};for(var k=g.length-1;k>=0;--k){var h=g[k];if(n&&(n.indexOf(h.obj)>=0)){continue}if(!t){p(h)}else{var s=h.boundInfo;if(s.shapeType<j.shapeType){p(h,s)}else{if(s.shapeType===j.shapeType){var q=m.getDistance(o,s);if(q<l){p(h,s,q)}}}}}return t},getTopmostBasicObjectAtCoord:function(f,h){var g=this.getTopmostBoundInfoAtCoord(f,null,h);return g?g.obj:null},getChemObjBounds:function(n,m){var i=[];var o=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),n);if(o&&o.length){for(var g=0,f=o.length;g<f;++g){var l=o[g];var h=l.boundInfo;if(h){h=Kekule.Render.MetaShapeUtils.inflateShape(h,m);i.push(h)}}}return i},beginUpdateUiMarkers:function(){--this._uiMarkerUpdateFlag},endUpdateUiMarkers:function(){++this._uiMarkerUpdateFlag;if(!this.isUpdatingUiMarkers()){this.repaintUiMarker()}},isUpdatingUiMarkers:function(){return(this._uiMarkerUpdateFlag<0)},recalcUiMarkers:function(){this.beginUpdateUiMarkers();try{this.recalcHotTrackMarker();this.recalcSelectionAreaMarker()}finally{this.endUpdateUiMarkers()}},repaintUiMarker:function(){if(this.isUpdatingUiMarkers()){return}this.clearUiContext();var f=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),f.baseCoord,f.drawOptions)},createShapeBasedMarker:function(i,h,j,g){var f=new Kekule.ChemWidget.MetaShapeUIMarker();if(h){f.setShapeInfo(h)}if(j){f.setDrawStyles(j)}this.setPropStoreFieldValue(i,f);this.getUiMarkers().addMarker(f);if(g){this.repaintUiMarker()}return f},modifyShapeBasedMarker:function(g,h,j,i){var f=Kekule.Render.ObjectUpdateType.MODIFY;if(h){g.setShapeInfo(h)}if(j){g.setDrawStyles(j)}if(i){this.repaintUiMarker()}},hideUiMarker:function(f,g){f.setVisible(false);if(g){this.repaintUiMarker()}},showUiMarker:function(f,g){f.setVisible(true);if(g){this.repaintUiMarker()}},removeUiMarker:function(f){if(f){this.getUiMarkers().removeMarker(f);this.repaintUiMarker()}},clearUiMarkers:function(){this.getUiMarkers().clearMarkers();this.repaintUiMarker()},changeHotTrackMarkerBounds:function(q){var o=Kekule.ArrayUtils.toArray(q);var g=this.getEditorConfigs().getUiMarkerConfigs();var n={color:g.getHotTrackerColor(),opacity:g.getHotTrackerOpacity()};var r=this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation();var f=[];for(var k=0,h=o.length;k<h;++k){var m=o[k];var j=r?Kekule.Render.MetaShapeUtils.inflateShape(m,r):m;if(j){f.push(j)}}var p=this.getUiHotTrackMarker();p.setVisible(true);this.modifyShapeBasedMarker(p,f,n,true);return this},hideHotTrackMarker:function(){var f=this.getUiHotTrackMarker();if(f){this.hideUiMarker(f,true)}return this},showHotTrackMarker:function(){var f=this.getUiHotTrackMarker();if(f){this.showUiMarker(f,true)}return this},hotTrackOnCoord:function(f){if(this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){this.setHotTrackedObj(this.getTopmostBasicObjectAtCoord(f,this.getCurrBoundInflation()))}return this},hotTrackOnObj:function(f){this.setHotTrackedObj(f);return this},hideHotTrack:function(f){this.hideHotTrackMarker();if(!f){this.clearHotTrackedObjs()}return this},clearHotTrackedObjs:function(){this.setHotTrackedObjs([])},addHotTrackedObj:function(g){var f=this.getHotTrackedObjs()||[];Kekule.ArrayUtils.pushUnique(f,g);this.setHotTrackedObjs(f);return this},recalcHotTrackMarker:function(){this.setHotTrackedObjs(this.getHotTrackedObjs())},changeSelectionAreaMarkerBound:function(i,h){var g=this.getEditorConfigs().getUiMarkerConfigs();if(!h){h={strokeColor:g.getSelectionMarkerStrokeColor(),strokeWidth:g.getSelectionMarkerStrokeWidth(),fillColor:g.getSelectionMarkerFillColor(),opacity:g.getSelectionMarkerOpacity()}}var f=this.getUiSelectionAreaMarker();if(f){f.setVisible(true);this.modifyShapeBasedMarker(f,i,h,true)}return this},hideSelectionAreaMarker:function(){var f=this.getUiSelectionAreaMarker();if(f){this.hideUiMarker(f,true)}},showSelectionAreaMarker:function(){var f=this.getUiSelectionAreaMarker();if(f){this.showUiMarker(f,true)}},recalcSelectionAreaMarker:function(o){this.beginUpdateUiMarkers();try{var v=this.getSelection();var t=v.length;if(t<=0){this.hideSelectionAreaMarker()}else{var f=[];var g=null;var w=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation();for(var r=0;r<t;++r){var q=v[r];var u=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),q);if(u&&u.length){for(var p=0,n=u.length;p<n;++p){var h=u[p];var m=h.boundInfo;if(m){m=Kekule.Render.MetaShapeUtils.inflateShape(m,w);f.push(m);var s=Kekule.Render.MetaShapeUtils.getContainerBox(m);g=g?Kekule.BoxUtils.getContainerBox(g,s):s}}}}this.setUiSelectionAreaContainerBox(g);if(g){var l=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:g.x1,y:g.y1},{x:g.x2,y:g.y2}]);f.push(l)}else{this.hideSelectionAreaMarker()}if(f.length){this.changeSelectionAreaMarkerBound(f)}}}finally{this.endUpdateUiMarkers()}},_highlightSelectionAreaMarker:function(){var g=this.getEditorConfigs().getUiMarkerConfigs();var f={strokeColor:g.getSelectionMarkerStrokeColor(),strokeWidth:g.getSelectionMarkerStrokeWidth(),fillColor:g.getSelectionMarkerFillColor(),opacity:g.getSelectionMarkerEmphasisOpacity()};this.changeSelectionAreaMarkerBound(null,f)},_restoreSelectionAreaMarker:function(){var g=this.getEditorConfigs().getUiMarkerConfigs();var f={strokeColor:g.getSelectionMarkerStrokeColor(),strokeWidth:g.getSelectionMarkerStrokeWidth(),fillColor:g.getSelectionMarkerFillColor(),opacity:g.getSelectionMarkerOpacity()};this.changeSelectionAreaMarkerBound(null,f)},pulseSelectionAreaMarker:function(g,h){if(this.getUiSelectionAreaMarker()){if(!g){g=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseDuration()||0}if(!h){h=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseCount()||1}if(!g){return}var f=g/h;this.doPulseSelectionAreaMarker(f,h)}return this},doPulseSelectionAreaMarker:function(f,g){this._highlightSelectionAreaMarker();setTimeout(this._restoreSelectionAreaMarker.bind(this),f);if(g>1){setTimeout(this.doPulseSelectionAreaMarker.bind(this,f,g-1),f*2)}},startSelecting:function(f,i){if(i===undefined){i=this.getIsToggleSelectOn()}if(!i){this.deselectAll()}var h=Kekule.Editor.SelectMode;var g=this.getSelectMode();this._currSelectMode=g;return(g===h.POLYLINE||g===h.POLYGON)?this.startSelectingCurveDrag(f,i):this.startSelectingBoxDrag(f,i)},addSelectingAnchorCoord:function(f){var h=Kekule.Editor.SelectMode;var g=this._currSelectMode;return(g===h.POLYLINE||g===h.POLYGON)?this.dragSelectingCurveToCoord(f):this.dragSelectingBoxToCoord(f)},endSelecting:function(n,f){if(f===undefined){f=this.getIsToggleSelectOn()}var o=Kekule.Editor.SelectMode;var m=this._currSelectMode;var q=this.getEditorConfigs().getInteractionConfigs().getEnablePartialAreaSelecting();var j;if(m===o.POLYLINE||m===o.POLYGON){var g=this._selectingCurveCoords;var k=this.getEditorConfigs().getInteractionConfigs().getSelectingCurveSimplificationDistanceThreshold();var i=Kekule.GeometryUtils.simplifyCurveToLineSegments(g,k);this.endSelectingCurveDrag(n,f);if(m===o.POLYLINE){var l=this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth();j=this.getObjectsIntersetExtendedPolyline(i,l)}else{j=this.getObjectsInPolygon(i,q);this.endSelectingCurveDrag(n,f)}}else{var p=this._selectingBoxStartCoord;var h=Kekule.BoxUtils.createBox(p,n);j=this.getObjectsInScreenBox(h,q);this.endSelectingBoxDrag(n,f)}j=this._getActualSelectedObjsInSelecting(j);if(f){this.toggleSelectingState(j)}else{this.select(j)}this.hideSelectingMarker()},cancelSelecting:function(){this.hideSelectingMarker()},_getActualSelectedObjsInSelecting:function(f){if(f&&f.length){if(this._isInAncestorSelectMode()){f=this._getAllStandaloneAncestorObjs(f)}return f}else{return[]}},_isInAncestorSelectMode:function(){return this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR},_getAllStandaloneAncestorObjs:function(k){var f=[];for(var h=0,g=k.length;h<g;++h){var j=k[h];if(j&&j.getStandaloneAncestor){j=j.getStandaloneAncestor()}a.pushUnique(f,j)}return f},startSelectingBoxDrag:function(f,g){this._selectingBoxStartCoord=f},dragSelectingBoxToCoord:function(f){var h=this._selectingBoxStartCoord;var g=f;this.changeSelectingMarkerBox(h,g)},endSelectingBoxDrag:function(f,h){var g=this._selectingBoxStartCoord;this._selectingBoxEndCoord=f},startSelectingCurveDrag:function(f,g){this._selectingCurveCoords=[f]},dragSelectingCurveToCoord:function(f){this._selectingCurveCoords.push(f);this.changeSelectingMarkerCurve(this._selectingCurveCoords,this._currSelectMode===Kekule.Editor.SelectMode.POLYGON)},endSelectingCurveDrag:function(f,g){this._selectingCurveCoords.push(f)},selectOnCoord:function(i,h){if(h===undefined){h=this.getIsToggleSelectOn()}var f=this.getTopmostBasicObjectAtCoord(i,this.getCurrBoundInflation());if(f){var g=this._getActualSelectedObjsInSelecting([f]);if(g){if(h){this.toggleSelectingState(g)}else{this.select(g)}}}},changeSelectingMarkerBound:function(i,h){var g=this.getEditorConfigs().getUiMarkerConfigs();if(!h){h={strokeColor:g.getSelectingMarkerStrokeColor(),strokeWidth:g.getSelectingMarkerStrokeWidth(),strokeDash:g.getSelectingMarkerStrokeDash(),fillColor:g.getSelectingMarkerFillColor(),opacity:g.getSelectingMarkerOpacity()}}var f=this.getUiSelectingMarker();f.setVisible(true);this.modifyShapeBasedMarker(f,i,h,true);return this},changeSelectingMarkerCurve:function(m,n){var g=[];for(var j=0,f=m.length-1;j<f;++j){g.push(this.screenCoordToContext(m[j]))}var o=Kekule.Render.MetaShapeUtils.createShapeInfo(n?Kekule.Render.MetaShapeType.POLYGON:Kekule.Render.MetaShapeType.POLYLINE,g);var h;if(!n){var k=this.getEditorConfigs().getUiMarkerConfigs();h={strokeColor:k.getSelectingBrushMarkerStrokeColor(),strokeWidth:this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth(),strokeDash:k.getSelectingBrushMarkerStrokeDash(),lineCap:k.getSelectingBrushMarkerStrokeLineCap(),lineJoin:k.getSelectingBrushMarkerStrokeLineJoin(),opacity:k.getSelectingBrushMarkerOpacity()}}return this.changeSelectingMarkerBound(o,h)},changeSelectingMarkerBox:function(h,f){var i=this.screenCoordToContext(h);var g=this.screenCoordToContext(f);var j=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:Math.min(i.x,g.x),y:Math.min(i.y,g.y)},{x:Math.max(i.x,g.x),y:Math.max(i.y,g.y)}]);return this.changeSelectingMarkerBound(j)},hideSelectingMarker:function(){var f=this.getUiSelectingMarker();if(f){this.hideUiMarker(f,true)}},showSelectingMarker:function(){var f=this.getUiSelectingMarker();if(f){this.showUiMarker(f,true)}},getCoordRegionInSelectionMarker:function(n,t){var i=Kekule.Editor.BoxRegion;var u=Kekule.CoordUtils;var o=this.screenCoordToContext(n);var j=this.getUiSelectionAreaMarker();if(j&&j.getVisible()){var l=this.getUiSelectionAreaContainerBox();if(Kekule.ObjUtils.isUnset(t)){t=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerEdgeInflation()}var h=(t/2)||0;var q=u.substract({x:l.x1,y:l.y1},{x:h,y:h});var p=u.add({x:l.x2,y:l.y2},{x:h,y:h});if((o.x<q.x)||(o.y<q.y)||(o.x>p.x)||(o.y>p.y)){return i.OUTSIDE}var g=u.substract(o,q);var f=u.substract(p,o);var s=g.x;var r=f.x;var m=g.y;var k=f.y;if(m<k){if(s<r){if(m<=t){return(s<=t)?i.CORNER_TL:i.EDGE_TOP}else{if(s<=t){return i.EDGE_LEFT}else{return i.INSIDE}}}else{if(m<=t){return(r<=t)?i.CORNER_TR:i.EDGE_TOP}else{if(r<=t){return i.EDGE_RIGHT}else{return i.INSIDE}}}}else{if(s<r){if(k<=t){return(s<=t)?i.CORNER_BL:i.EDGE_BOTTOM}else{if(s<=t){return i.EDGE_LEFT}else{return i.INSIDE}}}else{if(k<=t){return(r<=t)?i.CORNER_BR:i.EDGE_BOTTOM}else{if(r<=t){return i.EDGE_RIGHT}else{return i.INSIDE}}}}}return i.OUTSIDE},isCoordInSelectionMarkerBound:function(f){return(this.getCoordRegionInSelectionMarker(f)!==Kekule.Editor.BoxRegion.OUTSIDE)},getObjSelectedRenderOptions:function(){return this._selectedRenderOptions},_getObjRenderOptionItemAppendMethod:function(f){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?f.addOverrideRender3DOptionItem:f.addOverrideRenderOptionItem},_getObjRenderOptionItemRemoveMethod:function(f){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?f.removeOverrideRender3DOptionItem:f.removeOverrideRenderOptionItem},_addSelectRenderOptions:function(h){var f=this.getObjSelectedRenderOptions();if(f){var g=this._getObjRenderOptionItemAppendMethod(h);return g.apply(h,[f])}else{return null}},_removeSelectRenderOptions:function(h){var f=this.getObjSelectedRenderOptions();if(f){var g=this._getObjRenderOptionItemRemoveMethod(h);return g.apply(h,[this.getObjSelectedRenderOptions()])}else{return null}},beginUpdateSelection:function(){this.beginUpdateObject();--this._objSelectFlag},endUpdateSelection:function(){++this._objSelectFlag;if(this._objSelectFlag>=0){this.selectionChanged()}this.endUpdateObject()},isUpdatingSelection:function(){return(this._objSelectFlag<0)},selectionChanged:function(){if(!this.isUpdatingSelection()){this.notifyPropSet("selection",this.getSelection());this.invokeEvent("selectionChange");return this.doSelectionChanged()}},doSelectionChanged:function(){this.recalcSelectionAreaMarker()},isInSelection:function(f){return this.getSelection().indexOf(f)>=0},addObjToSelection:function(g){var f=this.getSelection();Kekule.ArrayUtils.pushUnique(f,g.getNearestSelectableObject());this._addSelectRenderOptions(g);this.selectionChanged();return this},removeObjFromSelection:function(k,j){var h=this.getSelection();Kekule.ArrayUtils.remove(h,k);this._removeSelectRenderOptions(k);for(var f=h.length-1;f>=0;--f){var g=h[f];if(g.isChildOf&&g.isChildOf(k)){this.removeObjFromSelection(g,true)}}this.selectionChanged();return this},deselectAll:function(){var f=this.getSelection();return this.removeFromSelection(f)},select:function(f){this.beginUpdateSelection();try{this.deselectAll();this.addToSelection(f)}finally{this.endUpdateSelection()}return this},addToSelection:function(j){if(!j){return}var h=DataType.isArrayValue(j)?j:[j];this.beginUpdateSelection();try{for(var g=0,f=h.length;g<f;++g){this.addObjToSelection(h[g])}}finally{this.endUpdateSelection()}return this},removeFromSelection:function(h){if(!h){return}var g=DataType.isArrayValue(h)?h:[h];this.beginUpdateSelection();try{for(var f=g.length-1;f>=0;--f){this.removeObjFromSelection(g[f])}}finally{this.endUpdateSelection()}return this},toggleSelectingState:function(k){if(!k){return}var j=DataType.isArrayValue(k)?k:[k];this.beginUpdateSelection();try{for(var g=0,f=j.length;g<f;++g){var h=j[g];if(this.isInSelection(h)){this.removeObjFromSelection(h)}else{this.addObjToSelection(h)}}}finally{this.endUpdateSelection()}return this},hasSelection:function(){return !!this.getSelection().length},deleteSelectedObjs:function(){},getObjectsIntersetExtendedPolyline:function(p,n){var f=[];for(var k=0,j=p.length;k<j;++k){f.push(this.screenCoordToContext(p[k]))}var m=[];var h=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext());var g=Kekule.Render.MetaShapeUtils.isIntersectingPolyline;for(var k=0,j=h.length;k<j;++k){var o=h[k];var q=o.boundInfo;if(q){if(g(q,f,n)){m.push(o.obj)}}}return m},getObjectsInPolygon:function(q,j){var f=[];for(var m=0,k=q.length;m<k;++m){f.push(this.screenCoordToContext(q[m]))}var n=[];var h=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext());var g=j?Kekule.Render.MetaShapeUtils.isIntersectingPolygon:Kekule.Render.MetaShapeUtils.isInsidePolygon;for(var m=0,k=h.length;m<k;++m){var o=h[m];var p=o.boundInfo;if(p){if(g(p,f)){n.push(o.obj)}}}return n},getObjectsInScreenBox:function(q,h){var n=this.screenBoxToContext(q);var m=[];var g=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext());var f=h?Kekule.Render.MetaShapeUtils.isIntersectingBox:Kekule.Render.MetaShapeUtils.isInsideBox;for(var k=0,j=g.length;k<j;++k){var o=g[k];var p=o.boundInfo;if(p){if(f(p,n)){m.push(o.obj)}}}return m},selectObjectsInScreenBox:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.select(g)}return g},addObjectsInScreenBoxToSelection:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.addToSelection(g)}return g},removeObjectsInScreenBoxFromSelection:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.removeFromSelection(g)}return g},toggleSelectingStateOfObjectsInScreenBox:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.toggleSelectingState(g)}return g},getObjectsContainerBox:function(x,v){var u=Kekule.ArrayUtils.toArray(x);var h=v||0;var f=[];var g=null;for(var s=0,n=u.length;s<n;++s){var r=u[s];var w=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),r);if(w&&w.length){for(var q=0,p=w.length;q<p;++q){var m=w[q];var o=m.boundInfo;if(o){if(h){o=Kekule.Render.MetaShapeUtils.inflateShape(o,h)}var t=Kekule.Render.MetaShapeUtils.getContainerBox(o);g=g?Kekule.BoxUtils.getContainerBox(g,t):t}}}}return g},getSelectionContainerBox:function(f){return this.getObjectsContainerBox(this.getSelection(),f)},isSelectionVisible:function(){var f=this.getSelectionContainerBox();if(f){var i=this.getClientDimension();var h=this.getClientScrollPosition();var g={x1:h.x,y1:h.y,x2:h.x+i.width,y2:h.y+i.height};return Kekule.BoxUtils.hasIntersection(f,g)}else{return false}},getObjSize:function(f){return this.doGetObjSize(f)},doGetObjSize:function(g){var f=this.getCoordMode();return g.getSizeOfMode?g.getSizeOfMode(f):null},setObjSize:function(g,f){this.doSetObjSize(g,f);this.objectChanged(g)},doSetObjSize:function(g,f){if(g.setSizeOfMode){g.setSizeOfMode(dimension,this.getCoordMode())}},getObjCoord:function(g,f){return this.doGetObjCoord(g,f)},doGetObjCoord:function(l,k){var j=this.getCoordMode();var h=this.getAllowCoordBorrow();var g=l.getAbsBaseCoord?l.getAbsBaseCoord(j,h):l.getAbsCoordOfMode?l.getAbsCoordOfMode(j,h):l.getCoordOfMode?l.getCoordOfMode(j,h):null;if(j===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(k)){var f=Kekule.Render.CoordPos.DEFAULT;if(k!==f){var h=this.getAllowCoordBorrow();var i=l.getExposedContainerBox?l.getExposedContainerBox(j,h):l.getContainerBox?l.getContainerBox(j,h):null;if(i){if(k===Kekule.Render.CoordPos.CORNER_TL){var m={x:(i.x2-i.x1)/2,y:(i.y2-i.y1)/2};g.x=g.x-m.x;g.y=g.y+m.y}}}}return g},setObjCoord:function(g,h,f){this.doSetObjCoord(g,h,f);this.objectChanged(g)},doSetObjCoord:function(j,l,f){var n=Object.create(l);var i=this.getCoordMode();if(i===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(f)){var g=Kekule.Render.CoordPos.DEFAULT;if(f!==g){var h=this.getAllowCoordBorrow();var k=j.getExposedContainerBox?j.getExposedContainerBox(i,h):j.getContainerBox?j.getContainerBox(i,h):null;if(k){var m={x:(k.x2-k.x1)/2,y:(k.y2-k.y1)/2};if(f===Kekule.Render.CoordPos.CORNER_TL){n.x=l.x+m.x;n.y=l.y-m.y}}}}if(j.setAbsBaseCoord){j.setAbsBaseCoord(n,i)}else{if(j.setAbsCoordOfMode){j.setAbsCoordOfMode(n,i)}else{if(j.setAbsCoordOfMode){j.setCoordOfMode(n,i)}}}},getObjectContextCoord:function(g,f){var h=this.getObjCoord(g,f);return this.objCoordToContext(h)},setObjectContextCoord:function(h,f,g){var i=this.contextCoordToObj(f);if(i){this.setObjCoord(h,i,g)}},getObjectScreenCoord:function(g,f){var h=this.getObjCoord(g,f);return this.objCoordToScreen(h)},setObjectScreenCoord:function(h,f,g){var i=this.screenCoordToObj(f);if(i){this.setObjCoord(h,i,g)}},getCoord:function(i,f,h){var g=this.getObjCoord(i,h);return this.translateCoord(g,Kekule.Editor.CoordSys.OBJ,f)},setCoord:function(j,i,f,h){var g=this.translateCoord(i,f,Kekule.Editor.CoordSys.OBJ);this.setObjCoord(j,g,h)},getSize:function(h,f){var g=this.getObjSize(h);return this.translateCoord(g,Kekule.Editor.CoordSys.OBJ,f)},setSize:function(i,g,f){var h=this.translateCoord(g,f,Kekule.Editor.CoordSys.OBJ);this.setObjSize(i,h)},translateCoord:function(j,g,h){if(!j){return null}var i=Kekule.Editor.CoordSys;if(g===i.SCREEN){if(h===i.SCREEN){return j}else{if(h===i.CONTEXT){return this.getObjDrawBridge().transformScreenCoordToContext(this.getObjContext(),j)}else{var f=this.getObjDrawBridge().transformScreenCoordToContext(this.getObjContext(),j);return this.getRootRenderer().transformCoordToObj(this.getObjContext(),this.getChemObj(),f)}}}else{if(g===i.CONTEXT){if(h===i.SCREEN){return this.getObjDrawBridge().transformContextCoordToScreen(this.getObjContext(),j)}else{if(h===i.CONTEXT){return j}else{return this.getRootRenderer().transformCoordToObj(this.getObjContext(),this.getChemObj(),j)}}}else{if(h===i.SCREEN){var f=this.getRootRenderer().transformCoordToContext(this.getObjContext(),this.getChemObj(),j);return this.getObjDrawBridge().transformContextCoordToScreen(this.getObjContext(),f)}else{if(h===i.CONTEXT){return this.getRootRenderer().transformCoordToContext(this.getObjContext(),this.getChemObj(),j)}else{return j}}}}},translateDistance:function(l,f,g){var j={x:0,y:0,z:0};var h={x:l,y:0,z:0};var k=this.translateCoord(j,f,g);var i=this.translateCoord(h,f,g);return Kekule.CoordUtils.getDistance(k,i)},transformCoordAndSizeOfObjects:function(q,p){var k=this.getCoordMode();var h=this.getAllowCoordBorrow();var o=(k===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(p):Kekule.CoordUtils.calcTransform2DMatrix(p);var f=Object.extend({},p);f=Object.extend(f,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});var g=(k===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(f):Kekule.CoordUtils.calcTransform2DMatrix(f);for(var n=0,j=q.length;n<j;++n){var m=q[n];m.transformAbsCoordByMatrix(o,g,k,true,h);m.scaleSize(p.scale,k,true,h)}},objCoordToContext:function(g){var f=Kekule.Editor.CoordSys;return this.translateCoord(g,f.OBJ,f.CONTEXT)},contextCoordToObj:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.CONTEXT,g.OBJ)},objCoordToScreen:function(g){var f=Kekule.Editor.CoordSys;return this.translateCoord(g,f.OBJ,f.SCREEN)},screenCoordToObj:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.SCREEN,g.OBJ)},screenCoordToContext:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.SCREEN,g.CONTEXT)},contextCoordToScreen:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.CONTEXT,g.SCREEN)},screenBoxToContext:function(f){var h=this.screenCoordToContext({x:f.x1,y:f.y1});var g=this.screenCoordToContext({x:f.x2,y:f.y2});return{x1:h.x,y1:h.y,x2:g.x,y2:g.y}},createDefaultNode:function(j,f,g){var i=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId();var h=new Kekule.Atom();h.setIsotopeId(i);if(g){g.appendNode(h)}this.setCoord(h,j,f);return h},operationDone:function(f){this.doOperationDone(f)},doOperationDone:function(f){},clearOperHistory:function(){var f=this.getOperHistory();if(f){f.clear()}},pushOperation:function(f,i){var g=this.getOperHistory();if(g&&f){g.push(f)}if(i){this.beginUpdateObject();try{f.execute()}finally{this.endUpdateObject()}}},popOperation:function(f){var i;var g=this.getOperHistory();if(g){i=g.pop(operation);if(f){this.beginUpdateObject();try{i.reverse()}finally{this.endUpdateObject()}}return i}else{return null}},execOperation:function(f){this.beginUpdateObject();try{f.execute()}finally{this.endUpdateObject()}if(this.getEnableOperHistory()){this.pushOperation(f,false)}return this},undo:function(){var g;var f=this.getOperHistory();if(f){this.beginUpdateObject();try{g=f.undo()}finally{this.endUpdateObject();if(g){this.operationDone(g)}}}return g},redo:function(){var g;var f=this.getOperHistory();if(f){this.beginUpdateObject();try{g=f.redo()}finally{this.endUpdateObject();if(g){this.operationDone(g)}}}return g},undoAll:function(){var g;var f=this.getOperHistory();if(f){this.beginUpdateObject();try{g=f.undoAll()}finally{this.endUpdateObject()}}return g},canUndo:function(){var f=this.getOperHistory();return f?f.canUndo():false},canRedo:function(){var f=this.getOperHistory();return f?f.canRedo():false},modifyObjects:function(f,j,p){var o=Kekule.ArrayUtils.toArray(f);try{var g=new Kekule.MacroOperation();for(var n=0,k=o.length;n<k;++n){var m=o[n];var h=new Kekule.ChemObjOperation.Modify(m,j,this);g.add(h)}g.execute()}finally{if(p&&this.getEnableOperHistory()&&g.getChildCount()){this.pushOperation(g)}}return this},modifyObjectsRenderOptions:function(h,p,o,u){var t=Kekule.ArrayUtils.toArray(h);var g=o?"render3DOptions":"renderOptions";var v=o?"getRender3DOptions":"getRenderOptions";try{var k=new Kekule.MacroOperation();for(var s=0,n=t.length;s<n;++s){var r=t[s];if(r[v]){var j=r[v]();var f=Object.extend({},j);f=Object.extend(f,p);var q={};q[g]=f;var m=new Kekule.ChemObjOperation.Modify(r,q,this);k.add(m)}}k.execute()}finally{if(u&&this.getEnableOperHistory()&&k.getChildCount()){this.pushOperation(k)}}return this},getClientDimension:function(){var f=this.getElement();return{width:f.clientWidth,height:f.clientHeight}},getClientScrollPosition:function(){var f=this.getEditClientElem().parentNode;return f?{x:f.scrollLeft,y:f.scrollTop}:null},scrollClientTo:function(g,h){var f=this.getEditClientElem().parentNode;if(Kekule.ObjUtils.notUnset(g)){f.scrollTop=g}if(Kekule.ObjUtils.notUnset(h)){f.scrollLeft=h}return this},scrollClientToTop:function(){return this.scrollClientTo(0,null)},doBeforeDispatchUiEvent:function($super,g){var f=g.getType();if(["pointerdown","pointermove","pointerup"].indexOf(f)>=0){this.setCurrPointerType(g.pointerType)}return $super(g)}});Kekule.Editor.BaseEditor.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.Editor.BaseEditor.Settings",initProperties:function(){this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getEnableCreateNewDoc()},setter:function(f){this.getEditor().setEnableCreateNewDoc(f)}});this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getInitOnNewDoc()},setter:function(f){this.getEditor().setInitOnNewDoc(f)}});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getEnableOperHistory()},setter:function(f){this.getEditor().setEnableOperHistory(f)}})},getEditor:function(){return this.getDisplayer()}});Kekule.Editor.IaControllerManager={_controllerMap:new Kekule.MapEx(true),register:function(g,f){c._controllerMap.set(g,f)},unregister:function(f){c._controllerMap.remove(f)},getAllControllerClasses:function(){return c._controllerMap.getKeys()},getAvailableControllerClasses:function(g){var f=[];var m=c.getAllControllerClasses();for(var k=0,h=m.length;k<h;++k){var n=m[k];var j=c._controllerMap.get(n);if(!j||ClassEx.isOrIsDescendantOf(g,j)){f.push(n)}}return f}};var c=Kekule.Editor.IaControllerManager;Kekule.Editor.BaseEditorIaController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function($super,f){$super(f)},initProperties:function(){this.defineProp("manuallyHotTrack",{dataType:DataType.BOOL,serializable:false});this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:false,getter:function(){return this.getEditor().getCurrBoundInflation()},setter:null})},getDefId:function(){return Kekule.ClassUtils.getLastClassName(this.getClassName())},getEditor:function(){return this.getWidget()},setEditor:function(f){return this.setWidget(f)},getEditorConfigs:function(){var f=this.getEditor();return f?f.getEditorConfigs():null},getInteractionBoundInflation:function(f){return this.getEditor().getInteractionBoundInflation(f)},handleUiEvent:function($super,i){var g=false;var h=(i.getTarget&&i.getTarget())||i.target;var f=this.getEditor().getUiEventReceiverElem();if(f){if((h===f)||Kekule.DomUtils.isDescendantOf(h,f)){g=true}}else{g=true}if(g){$super(i)}},canInteractWithObj:function(f){return !!f},hotTrackOnObj:function(f){this.getEditor().hotTrackOnObj(f)},zoomEditor:function(g,f){if(g>0){this.getEditor().zoomIn(g,f)}else{if(g<0){this.getEditor().zoomOut(-g,f)}}},_filterBasicObjectsInEditor:function(n){var j=this.getEditor();var k=j.getChemObj();var f=[];for(var h=0,g=n.length;h<g;++h){var m=n[h];if(m.isChildOf(k)){f.push(m)}}return f},doneInsertOrModifyBasicObjects:function(g){if(this.getEditorConfigs().getInteractionConfigs().getAutoSelectNewlyInsertedObjects()){var f=this._filterBasicObjectsInEditor(g);this.getEditor().select(f)}},react_pointerdown:function(f){f.preventDefault();return true},react_pointermove:function(g){var h=this._getEventMouseCoord(g);var f=this.getEditor().getTopmostBasicObjectAtCoord(h,this.getCurrBoundInflation());if(!this.getManuallyHotTrack()){if(f&&this.canInteractWithObj(f)){this.hotTrackOnObj(f)}else{this.hotTrackOnObj(null)}}g.preventDefault();return true},react_mousewheel:function(g){if(g.getCtrlKey()){var f=this._getEventMouseCoord(g);try{var h=g.wheelDeltaY||g.wheelDelta;if(h){h/=120}this.zoomEditor(h,f)}finally{}g.preventDefault();return true}},_getEventMouseCoord:function($super,h,g){var f=g||this.getWidget().getCoreElement();return $super(h,f)}});Kekule.Editor.ClientDragScrollIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ClientDragScrollIaController",initialize:function($super,f){$super(f);this._isExecuting=false},canInteractWithObj:function(f){return false},doTestMouseCursor:function(g,f){return this.isExecuting()?["grabbing","-webkit-grabbing","-moz-grabbing","move"]:["grab","-webkit-grab","-moz-grab","pointer"]},isExecuting:function(){return this._isExecuting},startScroll:function(f){this._startCoord=f;this._originalScrollPos=this.getEditor().getClientScrollPosition();this._isExecuting=true},endScroll:function(){this._isExecuting=false;this._startCoord=null;this._originalScrollPos=null},scrollTo:function(f){if(this.isExecuting()){var h=this._startCoord;var i=Kekule.CoordUtils.substract(h,f);var g=Kekule.CoordUtils.add(this._originalScrollPos,i);this.getEditor().scrollClientTo(g.y,g.x)}},react_pointerdown:function(f){if(f.getButton()===Kekule.X.Event.MouseButton.LEFT){if(!this.isExecuting()){var g={x:f.getScreenX(),y:f.getScreenY()};this.startScroll(g);f.preventDefault()}}else{if(f.getButton()===Kekule.X.Event.MouseButton.RIGHT){if(this.isExecuting()){this.endScroll();f.preventDefault()}}}},react_pointerup:function(f){if(f.getButton()===Kekule.X.Event.MouseButton.LEFT){if(this.isExecuting()){this.endScroll();f.preventDefault()}}},react_pointermove:function($super,f){$super(f);if(this.isExecuting()){var g={x:f.getScreenX(),y:f.getScreenY()};this.scrollTo(g);f.preventDefault()}return true}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.ClientDragScrollIaController,Kekule.Editor.BaseEditor);Kekule.Editor.BasicEraserIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicEraserIaController",initialize:function($super,f){$super(f);this._isExecuting=false},canInteractWithObj:function(f){return !!f},removeObjs:function(g){if(g&&g.length){var f=this.getEditor();f.beginUpdateObject();try{var h=this.doGetActualRemovedObjs(g);this.doRemoveObjs(h)}finally{f.endUpdateObject()}}},doRemoveObjs:function(f){},doGetActualRemovedObjs:function(f){return f},removeSelection:function(){var f=this.getEditor();this.removeObjs(f.getSelection());f.deselectAll()},removeOnScreenCoord:function(g){var f=this.getEditor().getTopmostBasicObjectAtCoord(g);if(f){this.removeObjs([f]);return true}else{return false}},startRemove:function(){this._isExecuting=true},endRemove:function(){this._isExecuting=false},isRemoving:function(){return this._isExecuting},react_pointerdown:function(f){if(f.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.startRemove();var g=this._getEventMouseCoord(f);this.removeOnScreenCoord(g);f.preventDefault()}else{if(f.getButton()===Kekule.X.Event.MOUSE_BTN_RIGHT){this.endRemove();f.preventDefault()}}},react_pointerup:function(f){if(f.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.endRemove();f.preventDefault()}},react_pointermove:function($super,f){$super(f);if(this.isRemoving()){var g=this._getEventMouseCoord(f);this.removeOnScreenCoord(g);f.preventDefault()}return true}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicEraserIaController,Kekule.Editor.BaseEditor);Kekule.Editor.BasicManipulationIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicManipulationIaController",initialize:function($super,f){$super(f);this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL);this.setEnableSelect(false);this.setEnableGestureManipulation(false);this.setEnableMove(true);this.setEnableResize(true);this.setEnableAspectRatioLockedResize(true);this.setEnableRotate(true);this._suppressConstrainedResize=false;this._manipulationStepBuffer={};this._suspendedOperations=null;this.execManipulationStepBind=this.execManipulationStep.bind(this)},initProperties:function(){this.defineProp("selectMode",{dataType:DataType.INT,serializable:false});this.defineProp("enableSelect",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableResize",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableRotate",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableGestureManipulation",{dataType:DataType.BOOL,serializable:false});this.defineProp("state",{dataType:DataType.INT,serializable:false});this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("startCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("endCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("startBox",{dataType:DataType.HASH,serializable:false});this.defineProp("endBox",{dataType:DataType.HASH,serializable:false});this.defineProp("lastRotateAngle",{dataType:DataType.FLOAT,serializable:false});this.defineProp("rotateRefCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("rotateCenter",{dataType:DataType.HASH,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("rotateCenter");if(!f){var g=this._getManipulateObjsCenterCoord();f=this.getEditor().objCoordToScreen(g);this.setPropStoreFieldValue("rotateCenter",f)}return f}});this.defineProp("resizeStartingRegion",{dataType:DataType.INT,serializable:false});this.defineProp("enableAspectRatioLockedResize",{dataType:DataType.BOOL,serializable:false});this.defineProp("rotateStartingRegion",{dataType:DataType.INT,serializable:false});this.defineProp("manipulateOriginObjs",{dataType:DataType.ARRAY,serializable:false});this.defineProp("manipulateObjs",{dataType:DataType.ARRAY,serializable:false,setter:function(f){this.setPropStoreFieldValue("manipulateObjs",f);if(!f){this.getEditor().endOperatingObjs()}else{this.getEditor().prepareOperatingObjs(f)}}});this.defineProp("manipulateObjInfoMap",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("manipulateObjInfoMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("manipulateObjInfoMap",f)}return f}});this.defineProp("manipulateObjCurrInfoMap",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("manipulateObjCurrInfoMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("manipulateObjCurrInfoMap",f)}return f}});this.defineProp("manipulationType",{dataType:DataType.INT,serializable:false});this.defineProp("isManipulatingSelection",{dataType:DataType.BOOL,serializable:false});this.defineProp("moveOperations",{dataType:DataType.ARRAY,serializable:false});this.defineProp("objOperationMap",{dataType:"Kekule.MapEx",serializable:false,getter:function(){var f=this.getPropStoreFieldValue("objOperationMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("objOperationMap",f)}return f}})},doFinalize:function($super){var f=this.getPropStoreFieldValue("manipulateObjInfoMap");if(f){f.clear()}f=this.getPropStoreFieldValue("objOperationMap");if(f){f.clear()}$super()},hotTrackOnObj:function($super,g){if(this.getEnableSelect()&&this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR){var f=this.getStandaloneAncestor(g);(g&&g.getStandaloneAncestor)?g.getStandaloneAncestor():g;return $super(f)}else{return $super(g)}},getStandaloneAncestor:function(f){return(f&&f.getStandaloneAncestor)?f.getStandaloneAncestor():f},isInAncestorSelectMode:function(){return this.getEnableSelect()&&(this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR)},isAspectRatioLockedResize:function(){return this.getEnableAspectRatioLockedResize()&&(!this._suppressConstrainedResize)},getCoordOnSelectionRotationRegion:function(o){var k=Kekule.Editor.BoxRegion;var p=this.getEditor();var q=p.getCoordRegionInSelectionMarker(o);if(q!==k.OUTSIDE){return false}var f=p.getEditorConfigs().getInteractionConfigs().getRotationRegionInflation();var m=p.getUiSelectionAreaContainerBox();if(m&&p.hasSelection()){var n=[k.CORNER_TL,k.CORNER_TR,k.CORNER_BR,k.CORNER_BL];var v=[{x:m.x1,y:m.y1},{x:m.x2,y:m.y1},{x:m.x2,y:m.y2},{x:m.x1,y:m.y2}];var w=false;var u=f;for(var j=0,h=n.length;j<h;++j){var t=n[j];var s=v[j];var g=Kekule.CoordUtils.getDistance(s,o);if(g<=u){w=t;u=g}}return w}else{return false}},createManipulateOperation:function(){return this.doCreateManipulateMoveAndResizeOperation()},doCreateManipulateMoveAndResizeOperation:function(){var m=[];this.setMoveOperations(m);var o=this.getManipulateObjs();var g=this.getManipulateObjInfoMap();var h=this.getObjOperationMap();h.clear();for(var n=0,j=o.length;n<j;++n){var k=o[n];var p=g.get(k);var f=new Kekule.ChemObjOperation.MoveAndResize(k,null,null,this.getEditor().getCoordMode(),true,this.getEditor());f.setAllowCoordBorrow(this.getEditor().getAllowCoordBorrow());f.setOldCoord(p.objCoord);f.setOldDimension(p.size);m.push(f)}return m},updateChildMoveOperation:function(h,f,g){var i=this.getMoveOperations()[h];i.setNewCoord(g)},updateChildResizeOperation:function(h,g,f){var i=this.getMoveOperations()[h];i.setNewDimension(f)},getAllObjOperations:function(f){var h=this.getMoveOperations();var g=h?Kekule.ArrayUtils.clone(h):[];return g},getActiveOperation:function(f){var g=this.getAllObjOperations(f);g=Kekule.ArrayUtils.toUnique(g);if(g.length<=0){return null}else{if(g.length===1){return g[0]}else{var h=new Kekule.MacroOperation(g);return h}}},reverseActiveOperation:function(){var f=this.getActiveOperation();return f.reverse()},addOperationToEditor:function(){var f=this.getEditor();if(f&&f.getEnableOperHistory()){var g=this.getActiveOperation(true);if(g){f.pushOperation(g)}}},getCurrAvailableManipulationTypes:function(){var g=Kekule.Editor.BasicManipulationIaController.ManipulationType;var h=this.getEditor().getSelectionContainerBox();if(!h){return[]}else{var f=[];if(this.getEnableMove()){f.push(g.MOVE)}if(!Kekule.NumUtils.isFloatEqual(h.x1,h.x2,1e-10)||!Kekule.NumUtils.isFloatEqual(h.y1,h.y2,1e-10)){if(this.getEnableResize()){f.push(g.RESIZE)}if(this.getEnableRotate()){f.push(g.ROTATE)}if(this.getEnableResize()||this.getEnableRotate()){f.push(g.TRANSFORM)}}return f}},getActualManipulatingObjects:function(k){var f=[];for(var h=0,g=k.length;h<g;++h){var j=k[h];var m=j.getCoordDependentObjects?j.getCoordDependentObjects():[j];Kekule.ArrayUtils.pushUnique(f,m)}return f},doPrepareManipulatingObjects:function(o,m){var n=this.getActualManipulatingObjects(o);this.setManipulateOriginObjs(o);this.setManipulateObjs(n);var f=this.getManipulateObjInfoMap();f.clear();var p=this.getEditor();for(var k=0,h=n.length;k<h;++k){var j=n[k];var g=this.createManipulateObjInfo(j,k,m);f.set(j,g)}},doPrepareManipulatingStartingCoords:function(f,i,h,g){this.setStartBox(i);this.setRotateCenter(h);this.setRotateRefCoord(g);this.setLastRotateAngle(null)},prepareManipulating:function(j,g,f,k,i,h){this.setManipulationType(j);this.doPrepareManipulatingObjects(g,f);this.doPrepareManipulatingStartingCoords(f,k,i,h);this.createManipulateOperation();this._runManipulationStepId=window.requestAnimationFrame(this.execManipulationStepBind)},cancelManipulate:function(){var f=this.getEditor();var g=this.getManipulateObjs();this.reverseActiveOperation();this.notifyCoordChangeOfObjects(this.getManipulateObjs());this.manipulateEnd()},_getManipulateObjsCenterCoord:function(){var o=this.getManipulateObjs();if(!o||!o.length){return null}var m=this.getEditor().getCoordMode();var g=this.getEditor().getAllowCoordBorrow();var k={x:0,y:0,z:0};for(var h=0,f=o.length;h<f;++h){var n=o[h];var j=n.getAbsBaseCoord?n.getAbsBaseCoord(m,g):n.getAbsCoord?n.getAbsCoord(m,g):n.getCoordOfMode?n.getCoordOfMode(m,g):null;if(j){k=Kekule.CoordUtils.add(k,j)}}return Kekule.CoordUtils.divide(k,o.length)},_maniplateObjsFrameEnd:function(f){},_addManipultingObjNewInfo:function(i,g){var f=this.getManipulateObjCurrInfoMap();var h=f.get(i)||{};h=Object.extend(h,g);f.set(i,h)},applyManipulatingObjsInfo:function(n){var m=this.getManipulateObjs();var j=this.getManipulateObjCurrInfoMap();for(var g=0,f=m.length;g<f;++g){var k=m[g];var h=j.get(k);this.applySingleManipulatingObjInfo(g,k,h,n)}},applySingleManipulatingObjInfo:function(i,g,f,h){if(f){if(f.screenCoord){this.doMoveManipulatedObj(i,g,f.screenCoord,h)}if(f.size){this.doResizeManipulatedObj(i,g,f.size)}}},_calcRotateAngle:function(q){var g=Kekule.CoordUtils;var j;var k=false;var n=this.getRotateCenter();var p=this.getRotateRefCoord()||this.getStartCoord();var l=this.getEditorConfigs().getInteractionConfigs().getRotationLocationPointDistanceThreshold();if(l){var f=g.getDistance(p,n);if(f<l){j=0;k=true;this.setStartCoord(q);return false}var o=g.getDistance(q,n);if(o<l){j=0;k=true;return false}}if(!k){var i=g.substract(q,n);var h=Math.atan2(i.y,i.x);i=g.substract(p,n);var m=Math.atan2(i.y,i.x);j=h-m}return{angle:j,startAngle:m,endAngle:h}},_calcActualRotateAngle:function(i,h,f,g){return h},_calcManipulateObjsRotationParams:function(g,k){if(!this.getEnableRotate()){return false}var i=this.getRotateCenter();var h=this._calcRotateAngle(k);if(!h){return false}var j=this._calcActualRotateAngle(g,h.angle,h.startAngle,h.endAngle);var f=this.getLastRotateAngle();if(Kekule.ObjUtils.notUnset(f)&&Kekule.NumUtils.isFloatEqual(j,f,0.0175)){return false}this.setLastRotateAngle(j);return{center:i,rotateAngle:j}},_calcActualResizeScales:function(f,g){return g},_calcManipulateObjsResizeParams:function(f,g,q){if(!this.getEnableResize()){return false}var h=Kekule.Editor.BoxRegion;var o=Kekule.CoordUtils;var k=this.getStartBox();var r=o.substract(q,this.getStartCoord());var l;var i,t,s;if(g===h.EDGE_TOP){r.x=0;l={x:(k.x1+k.x2)/2,y:k.y2}}else{if(g===h.EDGE_BOTTOM){r.x=0;l={x:(k.x1+k.x2)/2,y:k.y1}}else{if(g===h.EDGE_LEFT){r.y=0;l={x:k.x2,y:(k.y1+k.y2)/2}}else{if(g===h.EDGE_RIGHT){r.y=0;l={x:k.x1,y:(k.y1+k.y2)/2}}else{if(this.isAspectRatioLockedResize()){i=true}l=(g===h.CORNER_TL)?{x:k.x2,y:k.y2}:(g===h.CORNER_TR)?{x:k.x1,y:k.y2}:(g===h.CORNER_BL)?{x:k.x2,y:k.y1}:{x:k.x1,y:k.y1}}}}}var n=(g===h.CORNER_TL)||(g===h.CORNER_BL)||(g===h.EDGE_LEFT);var m=(g===h.CORNER_TL)||(g===h.CORNER_TR)||(g===h.EDGE_TOP);var v,u;if(Kekule.NumUtils.isFloatEqual(k.x1,k.x2,1e-10)){v=1}else{v=1+r.x/(k.x2-k.x1)*(n?-1:1)}if(Kekule.NumUtils.isFloatEqual(k.y1,k.y2,1e-10)){u=1}else{u=1+r.y/(k.y2-k.y1)*(m?-1:1)}if(i){var x=Math.abs(v),w=Math.abs(u);if(x>=w){u=(Math.sign(u)||1)*x}else{v=(Math.sign(v)||1)*w}}var p=this._calcActualResizeScales(f,{scaleX:v,scaleY:u});var j={center:l,scaleX:p.scaleX,scaleY:p.scaleY};return j},_calcManipulateObjsTransformInfo:function(o,u){var f=Kekule.CoordUtils;var v=false;var j=v?f.calcTransform3DMatrix(u):f.calcTransform2DMatrix(u);var t=u.scaleX||u.scale;var r=u.scaleY||u.scale;for(var m=0,h=o.length;m<h;++m){var k=o[m];var g=this.getManipulateObjInfoMap().get(k);var q={};if(!g.hasNoCoord){var p=g.screenCoord;var s=f.transform2DByMatrix(p,j);q.screenCoord=s}if(g.size&&(t||r)){var n={x:g.size.x*Math.abs(t||1),y:g.size.y*Math.abs(r||1)};q.size=n}this._addManipultingObjNewInfo(k,q)}return true},doTransformManipulatedObjs:function(f,m,h){var i=Kekule.Editor.BasicManipulationIaController.ManipulationType;var k=this.getEditor();var j=this.getManipulateObjs();var l=h;if(!l){if(f===i.RESIZE){l=this._calcManipulateObjsResizeParams(j,this.getResizeStartingRegion(),m)}else{if(f===i.ROTATE){l=this._calcManipulateObjsRotationParams(j,m)}}}var n=l&&this._calcManipulateObjsTransformInfo(j,l);if(!n){return}k.beginUpdateObject();var g=this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(m);this._maniplateObjsFrameEnd(j);this.notifyCoordChangeOfObjects(j)}finally{k.endUpdateObject();this.manipulateStepDone()}},_calcActualMovedScreenCoord:function(h,g,f){return f},_calcManipulateObjsMoveInfo:function(o,p){var f=Kekule.CoordUtils;var h=this.getManipulateObjCurrInfoMap();for(var m=0,j=o.length;m<j;++m){var k=o[m];var g=this.getManipulateObjInfoMap().get(k);if(g.hasNoCoord){continue}var n=f.add(p,g.screenCoordOffset);n=this._calcActualMovedScreenCoord(k,g,n);this._addManipultingObjNewInfo(k,{screenCoord:n})}},moveManipulatedObjs:function(k){var j=Kekule.CoordUtils;var g=this.getEditor();var i=this.getManipulateObjs();var f=[];this._calcManipulateObjsMoveInfo(i,k);g.beginUpdateObject();var h=this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(k);this._maniplateObjsFrameEnd(i);this.notifyCoordChangeOfObjects(i)}finally{g.endUpdateObject();this.manipulateStepDone()}},doMoveManipulatedObj:function(j,i,g,f){var h=this.getEditor();this.updateChildMoveOperation(j,i,h.screenCoordToObj(g));h.setObjectScreenCoord(i,g)},doResizeManipulatedObj:function(h,g,f){this.updateChildResizeOperation(h,g,f);if(g.setSizeOfMode){g.setSizeOfMode(f,this.getEditor().getCoordMode())}},startDirectManipulate:function(k,i,f,l,h,g){var j=Kekule.ArrayUtils.toArray(i);this.setState(Kekule.Editor.BasicManipulationIaController.State.MANIPULATING);this.setBaseCoord(f);this.setStartCoord(f);this.setRotateRefCoord(g);this.setIsManipulatingSelection(false);this.prepareManipulating(k||Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE,j,f,l,h,g)},manipulateStepDone:function(){},manipulateEnd:function(){if(this._runManipulationStepId){window.cancelAnimationFrame(this._runManipulationStepId);this._runManipulationStepId=null}var f=this.getEditor();f.endManipulateObject()},stopManipulate:function(){this.setManipulateObjs(null);this.getManipulateObjInfoMap().clear();this.getObjOperationMap().clear();this.manipulateEnd()},refreshManipulateObjs:function(){this.setManipulateObjs(this.getManipulateObjs())},createManipulateObjInfo:function(i,j,f){var g=this.getEditor();var h={objCoord:g.getObjCoord(i),screenCoord:g.getObjectScreenCoord(i),size:g.getObjSize(i)};h.hasNoCoord=!h.objCoord;if(!h.hasNoCoord&&f){h.screenCoordOffset=Kekule.CoordUtils.substract(h.screenCoord,f)}return h},notifyCoordChangeOfObjects:function(q){var f=[];var r=this.getEditor();var n=this.getEditor().getCoordMode()===Kekule.CoordMode.COORD3D?"coord3D":"coord2D";for(var p=0,g=q.length;p<g;++p){var o=q[p];Kekule.ArrayUtils.pushUnique(f,{obj:o,propNames:[n]});var s=o.getCoordDeterminateObjects?o.getCoordDeterminateObjects():[o];for(var m=0,h=s.length;m<h;++m){Kekule.ArrayUtils.pushUnique(f,{obj:s[m],propNames:[n]})}}r.objectsChanged(f)},canInteractWithObj:function(f){return(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL)&&f},doTestMouseCursor:function(h,i){var n="";var j=this._getEventMouseCoord(i,this.getEditor().getEditClientElem());if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL){var g=Kekule.Editor.BoxRegion;var l=this.getEditor().getCoordRegionInSelectionMarker(j);var n;if(this.getEnableSelect()){var f=Kekule.Editor.BasicManipulationIaController.ManipulationType;var m=this.getCurrAvailableManipulationTypes();if(m.indexOf(f.MOVE)>=0){n=(l===g.INSIDE)?"move":""}if(!n&&(m.indexOf(f.RESIZE)>=0)){var n=(l===g.CORNER_TL)?"nwse-resize":(l===g.CORNER_TR)?"nesw-resize":(l===g.CORNER_BL)?"nesw-resize":(l===g.CORNER_BR)?"nwse-resize":(l===g.EDGE_TOP)||(l===g.EDGE_BOTTOM)?"ns-resize":(l===g.EDGE_LEFT)||(l===g.EDGE_RIGHT)?"ew-resize":""}if(!n){if(m.indexOf(f.ROTATE)>=0){var l=this.getCoordOnSelectionRotationRegion(j);if(!!l){var k=Kekule.Widget.StyleResourceNames;n=(l===g.CORNER_TL)?k.CURSOR_ROTATE_NW:(l===g.CORNER_TR)?k.CURSOR_ROTATE_NE:(l===g.CORNER_BL)?k.CURSOR_ROTATE_SW:(l===g.CORNER_BR)?k.CURSOR_ROTATE_SE:k.CURSOR_ROTATE}}}}}return n},setSuspendedOperations:function(g,f,i){var h=this;this._suspendedOperations={immediate:g,delayed:f,delayExecId:setTimeout(this.execSuspendedDelayOperation.bind(this),i)};return this._suspendedOperations},execSuspendedImmediateOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var f=this._suspendedOperations.immediate;this._suspendedOperations=null;return f.apply(this)}},execSuspendedDelayOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var f=this._suspendedOperations.delayed;this._suspendedOperations=null;return f.apply(this)}},haltSuspendedOperations:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);this._suspendedOperations=null}},_startNewSelecting:function(f,g){if(this.getEnableSelect()){this.getEditor().startSelecting(f,g||this.getEditor().getIsToggleSelectOn());this.setState(Kekule.Editor.BasicManipulationIaController.State.SELECTING)}},_startOffSelectionManipulation:function(f){this.beginManipulation(f,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE);this.getEditor().pulseSelectionAreaMarker()},beginManipulation:function(f,u,t){var k=Kekule.Editor.BasicManipulationIaController.State;var h=Kekule.Editor.BasicManipulationIaController.ManipulationType;var p=this.getCurrAvailableManipulationTypes();var o=u&&u.pointerType==="touch";var g=this.getEditor();g.beginManipulateObject();this.setBaseCoord(f);this.setStartCoord(f);var w=f&&this.getEditor().getCoordRegionInSelectionMarker(f);var l=Kekule.Editor.BoxRegion;var q=f&&this.getCoordOnSelectionRotationRegion(f);var m=(p.indexOf(h.TRANSFORM)>=0)&&(t===h.TRANSFORM);if(!m){var n=!o&&(p.indexOf(h.RESIZE)>=0)&&((t===h.RESIZE)||((w!==l.INSIDE)&&(w!==l.OUTSIDE)));var s=!n&&(p.indexOf(h.MOVE)>=0)&&((t===h.MOVE)||(w!==l.OUTSIDE));var j=!o&&!n&&!s&&(p.indexOf(h.ROTATE)>=0)&&((t===h.ROTATE)||!!q)}else{this._availTransformTypes=p}if(m){this.setState(k.MANIPULATING);this.setIsManipulatingSelection(true);this.setResizeStartingRegion(w);this.setRotateStartingRegion(q);this.prepareManipulating(h.TRANSFORM,this.getEditor().getSelection(),f,this.getEditor().getSelectionContainerBox())}else{if(n){this.setState(k.MANIPULATING);this.setIsManipulatingSelection(true);this.setResizeStartingRegion(w);this.prepareManipulating(h.RESIZE,this.getEditor().getSelection(),f,this.getEditor().getSelectionContainerBox())}else{if(s){this.setState(k.MANIPULATING);this.setIsManipulatingSelection(true);this.prepareManipulating(h.MOVE,this.getEditor().getSelection(),f)}else{if(j){this.setState(k.MANIPULATING);this.setIsManipulatingSelection(true);this.setRotateStartingRegion(q);this.prepareManipulating(h.ROTATE,this.getEditor().getSelection(),f,this.getEditor().getSelectionContainerBox())}else{var r=this.getEditor().getTopmostBasicObjectAtCoord(f,this.getCurrBoundInflation());if(r){r=r.getNearestSelectableObject();if(this.isInAncestorSelectMode()){r=this.getStandaloneAncestor(r)}if(this.getEnableMove()){this.startDirectManipulate(null,r,f)}}else{if(this.getEnableMove()&&this.getEnableSelect()&&this.getEditorConfigs().getInteractionConfigs().getEnableOffSelectionManipulation()&&this.getEditor().hasSelection()&&this.getEditor().isSelectionVisible()){this.setState(k.SUSPENDING);var v=this.getEditorConfigs().getInteractionConfigs().getOffSelectionManipulationActivatingTimeThreshold();var i=u&&u.getShiftKey();this.setSuspendedOperations(this._startNewSelecting.bind(this,f,i),this._startOffSelectionManipulation.bind(this,f),v)}else{if(this.getEnableSelect()){var i=u&&u.getShiftKey();this._startNewSelecting(f,i)}}}}}}}},execManipulationStep:function(f){if(this.getState()!==Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){return false}var g=this._manipulationStepBuffer.coord;var h=this._manipulationStepBuffer.event;var i=this._manipulationStepBuffer.explicitTransformParams;if(g&&h){this.doExecManipulationStep(g,h,this._manipulationStepBuffer)}else{if(i){this.doExecManipulationStepWithExplicitTransformParams(i,this._manipulationStepBuffer)}}this._manipulationStepBuffer.coord=null;this._manipulationStepBuffer.event=null;this._manipulationStepBuffer.explicitTransformParams=null;this._runManipulationStepId=window.requestAnimationFrame(this.execManipulationStepBind)},doExecManipulationStep:function(h,i,k){var f=Kekule.Editor.BasicManipulationIaController.ManipulationType;var j=this.getManipulationType();var g=this.getEditor();g.beginUpdateObject();try{this._isBusy=true;if(j===f.MOVE){this.moveManipulatedObjs(h)}else{if(j===f.RESIZE){this._suppressConstrainedResize=i.getAltKey();this.doTransformManipulatedObjs(j,h)}else{if(j===f.ROTATE){this.doTransformManipulatedObjs(j,h)}}}}finally{g.endUpdateObject();this._isBusy=false}},doExecManipulationStepWithExplicitTransformParams:function(j,i){var f=Kekule.Editor.BasicManipulationIaController.ManipulationType;var h=this.getManipulationType();if(h===f.TRANSFORM){var g=this.getEditor();g.beginUpdateObject();try{this._isBusy=true;this.doTransformManipulatedObjs(h,null,j)}finally{g.endUpdateObject();this._isBusy=false}}},updateManipulationStepBuffer:function(f,g){Object.extend(f,g)},react_pointermove:function($super,l){$super(l);if(this._isBusy){return true}var j=Kekule.Editor.BasicManipulationIaController.State;var i=Kekule.Editor.BasicManipulationIaController.ManipulationType;var k=this._getEventMouseCoord(l);var g;if(this._lastMouseMoveCoord){var h=Kekule.CoordUtils.getDistance(k,this._lastMouseMoveCoord);g=h;if(h<2){return true}}this._lastMouseMoveCoord=k;if(this.getState()===j.SUSPENDING){var m=this.getEditorConfigs().getInteractionConfigs().getUnmovePointerDistanceThreshold()||0;if(Kekule.ObjUtils.notUnset(g)&&(g>m)){this.execSuspendedImmediateOperation()}}var f=this.getState();if(f===j.SELECTING){if(this.getEnableSelect()){this.getEditor().addSelectingAnchorCoord(k)}l.preventDefault()}else{if(f===j.MANIPULATING){this.updateManipulationStepBuffer(this._manipulationStepBuffer,{coord:k,event:l});l.preventDefault()}}return true},react_pointerdown:function($super,g){$super(g);var f=Kekule.Editor.BasicManipulationIaController.State;if(g.getButton()===Kekule.X.Event.MouseButton.LEFT){this._lastMouseMoveCoord=null;var h=this._getEventMouseCoord(g);if((this.getState()===f.NORMAL)){this.beginManipulation(h,g);g.preventDefault()}}else{if(g.getButton()===Kekule.X.Event.MouseButton.RIGHT){if(this.getState()===f.MANIPULATING){this.cancelManipulate();this.setState(f.NORMAL);g.stopPropagation();g.preventDefault()}else{if(this.getState()===f.SUSPENDING){this.haltSuspendedOperations()}}}}return true},react_pointerup:function(l){if(l.getButton()===Kekule.X.Event.MouseButton.LEFT){var m=this._getEventMouseCoord(l);this.setEndCoord(m);var i=this.getStartCoord();var f=m;var k=l.getShiftKey();var g=Kekule.Editor.BasicManipulationIaController.State;if(this.getState()===g.SUSPENDING){this.execSuspendedImmediateOperation()}var j=this.getState();if(j===g.SELECTING){this.getEditor().endSelecting(m,k||this.getEditor().getIsToggleSelectOn());this.setState(g.NORMAL);l.preventDefault();var h=this.getEditor();h.endManipulateObject()}else{if(j===g.MANIPULATING){if(Kekule.CoordUtils.isEqual(i,f)){if(this.getEnableSelect()){this.getEditor().selectOnCoord(i,k||this.getEditor().getIsToggleSelectOn())}}else{this.addOperationToEditor()}this.stopManipulate();this.setState(g.NORMAL);l.preventDefault()}}}return true},react_mousewheel:function($super,g){if(g.getCtrlKey()){var f=this.getState();if(f===Kekule.Editor.BasicManipulationIaController.State.NORMAL){return $super(g)}g.preventDefault()}},_isGestureManipulationEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureManipulation()},_isGestureZoomOnEditorEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureZoomOnEditor()},_isInGestureManipulation:function(){return !!this._initialGestureTransformParams},_isGestureZoomOnEditor:function(){return !!this._initialGestureZoomLevel},beginGestureTransform:function(f){if(this.getEditor().hasSelection()){this._initialGestureZoomLevel=null;if(this._isGestureManipulationEnabled()){this.haltSuspendedOperations();this._initialGestureTransformParams={angle:(f.rotation*Math.PI/180)||0};if(this.getState()!==Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){this.beginManipulation(null,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM)}else{if(this.getManipulationType()!==Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM){this.setManipulationType(Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM)}}}else{this._initialGestureTransformParams=null}}else{if(this._isGestureZoomOnEditorEnabled()){this.getEditor().cancelSelecting();this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL);this._initialGestureZoomLevel=this.getEditor().getZoom()}}},endGestureTransform:function(){if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){if(this._isInGestureManipulation()){this.addOperationToEditor();this.stopManipulate();this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL);this._initialGestureTransformParams=null}}if(this._isGestureZoomOnEditor()){this._initialGestureZoomLevel=null}},doGestureTransformStep:function(n){var j=Kekule.Editor.BasicManipulationIaController.ManipulationType;if((this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING)&&(this.getManipulationType()===j.TRANSFORM)&&(this._isInGestureManipulation())){var l=this._availTransformTypes||[];var g=this.getRotateCenter();var o,k;if(l.indexOf(j.RESIZE)>=0){var h=n.scale;o=this._calcActualResizeScales(this.getManipulateObjs(),{scaleX:h,scaleY:h})}else{o={scaleX:1,scaleY:1}}if(l.indexOf(j.ROTATE)>=0){var f=n.rotation*Math.PI/180;var k=f-this._initialGestureTransformParams.angle;k=this._calcActualRotateAngle(this.getManipulateObjs(),k,this._initialGestureTransformParams.angle,f)}else{k=0}this.updateManipulationStepBuffer(this._manipulationStepBuffer,{explicitTransformParams:{center:g,scaleX:o.scaleX,scaleY:o.scaleY,rotateAngle:k}});n.preventDefault()}else{if(this._isGestureZoomOnEditor()){var m=this.getEditor();var h=n.scale;var i=this._initialGestureZoomLevel;m.zoomTo(i*h,null,n.center)}}},react_rotatestart:function(f){if(this.getEnableGestureManipulation()){this.beginGestureTransform(f)}},react_rotate:function(f){if(this.getEnableGestureManipulation()){this.doGestureTransformStep(f)}},react_rotateend:function(f){if(this.getEnableGestureManipulation()){this.endGestureTransform()}},react_rotatecancel:function(f){if(this.getEnableGestureManipulation()){this.endGestureTransform()}},react_pinchstart:function(f){if(this.getEnableGestureManipulation()){this.beginGestureTransform(f)}},react_pinchmove:function(f){if(this.getEnableGestureManipulation()){this.doGestureTransformStep(f)}},react_pinchend:function(f){if(this.getEnableGestureManipulation()){this.endGestureTransform()}},react_pinchcancel:function(f){if(this.getEnableGestureManipulation()){this.endGestureTransform()}}});Kekule.Editor.BasicManipulationIaController.State={NORMAL:0,SELECTING:1,MANIPULATING:2,SUSPENDING:11};Kekule.Editor.BasicManipulationIaController.ManipulationType={MOVE:0,ROTATE:1,RESIZE:2,TRANSFORM:4};Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicManipulationIaController,Kekule.Editor.BaseEditor)})();(function(){Kekule.ChemObjOperation={};Kekule.ChemObjOperation.Base=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemObjOperation.Base",initialize:function($super,b,a){$super();this.setTarget(b);if(a){this.setEditor(a)}},initProperties:function(){this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL});this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false})},notifyBeforeAddingByEditor:function(c,b,a){if(c.beforeAddingByEditor){c.beforeAddingByEditor(b,a)}},notifyBeforeRemovingByEditor:function(b,a){if(b.beforeRemovingByEditor){b.beforeRemovingByEditor(a)}},notifyBeforeModifyingByEditor:function(b,a){if(b.beforeModifyingByEditor){b.beforeModifyingByEditor(a)}},notifyAfterAddingByEditor:function(c,b,a){if(c.afterAddingByEditor){c.afterAddingByEditor(b,a)}},notifyAfterRemovingByEditor:function(b,a){if(b.afterRemovingByEditor){b.afterRemovingByEditor(a)}},notifyAfterModifyingByEditor:function(b,a){if(b.afterModifyingByEditor){b.afterModifyingByEditor(a)}}});Kekule.ChemObjOperation.Modify=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Modify",initialize:function($super,c,b,a){$super(c,a);if(b){this.setNewPropValues(b)}},initProperties:function(){this.defineProp("newPropValues",{dataType:DataType.HASH});this.defineProp("oldPropValues",{dataType:DataType.HASH})},doExecute:function(){var a={};var d=this.getNewPropValues();var c=this.getTarget();c.beginUpdate();try{this.notifyBeforeModifyingByEditor(c,d);for(var e in d){var b=d[e];a[e]=c.getPropValue(e);c.setPropValue(e,b)}this.notifyAfterModifyingByEditor(c,d)}finally{c.endUpdate()}this.setOldPropValues(a)},doReverse:function(){var c=this.getOldPropValues();var b=this.getTarget();b.beginUpdate();try{this.notifyBeforeModifyingByEditor(b,c);for(var d in c){var a=c[d];b.setPropValue(d,a)}this.notifyAfterModifyingByEditor(b,c)}finally{b.endUpdate()}}});Kekule.ChemObjOperation.MoveTo=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveTo",initialize:function($super,e,a,c,d,b){$super(e,b);if(a){this.setNewCoord(a)}this.setCoordMode(c||Kekule.CoordMode.COORD2D);this.setUseAbsBaseCoord(!!d)},initProperties:function(){this.defineProp("newCoord",{dataType:DataType.HASH});this.defineProp("oldCoord",{dataType:DataType.HASH});this.defineProp("coordMode",{dataType:DataType.INT});this.defineProp("useAbsBaseCoord",{dataType:DataType.BOOL})},setObjCoord:function(c,e,b){if(c&&e&&b){var d=false;if(this.getUseAbsBaseCoord()){if(c.setAbsBaseCoord){c.setAbsBaseCoord(e,b,this.getAllowCoordBorrow());d=true}}else{if(c.setCoordOfMode){c.setCoordOfMode(e,b);d=true}}if(!d){var a=c.getClassName?c.getClassName():(typeof c);Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_COORD_OF_CLASS").format(a))}}},getObjCoord:function(b,a){if(this.getUseAbsBaseCoord()){if(b.getAbsBaseCoord){return b.getAbsBaseCoord(a,this.getAllowCoordBorrow())}}else{if(b.getCoordOfMode){return b.getCoordOfMode(a,this.getAllowCoordBorrow())}}return null},doExecute:function(){var a=this.getTarget();if(!this.getOldCoord()){this.setOldCoord(this.getObjCoord(a,this.getCoordMode()))}if(this.getNewCoord()){this.setObjCoord(this.getTarget(),this.getNewCoord(),this.getCoordMode())}},doReverse:function(){if(this.getOldCoord()){this.setObjCoord(this.getTarget(),this.getOldCoord(),this.getCoordMode())}}});Kekule.ChemObjOperation.MoveAndResize=Class.create(Kekule.ChemObjOperation.MoveTo,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResize",initialize:function($super,f,b,a,d,e,c){$super(f,a,d,e,c)},initProperties:function(){this.defineProp("newDimension",{dataType:DataType.HASH});this.defineProp("oldDimension",{dataType:DataType.HASH})},setObjSize:function(d,c,b){if(d&&c){if(d.setSizeOfMode){d.setSizeOfMode(c,b)}else{var a=d.getClassName?d.getClassName():(typeof d);Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_DIMENSION_OF_CLASS").format(a))}}},getObjSize:function(b,a){if(b.getSizeOfMode){return b.getSizeOfMode(a,this.getAllowCoordBorrow())}else{return null}},doExecute:function($super){$super();var a=this.getTarget();if(!this.getOldDimension()){this.setOldDimension(this.getObjSize(a,this.getCoordMode()))}if(this.getNewDimension()){this.setObjSize(this.getTarget(),this.getNewDimension(),this.getCoordMode())}},doReverse:function($super){if(this.getOldDimension()){this.setObjSize(this.getTarget(),this.getOldDimension(),this.getCoordMode())}$super()}});Kekule.ChemObjOperation.Add=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Add",initialize:function($super,d,c,a,b){$super(d,b);this.setParentObj(c);this.setRefSibling(a)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:false})},doExecute:function(){var b=this.getParentObj();var c=this.getTarget();if(b&&c){var a=this.getRefSibling()||null;this.notifyBeforeAddingByEditor(c,b,a);b.insertBefore(c,a);this.notifyAfterAddingByEditor(c,b,a)}},doReverse:function(){var c=this.getTarget();var b=this.getParentObj();if(b&&c){var a=this.getRefSibling();if(!a){a=c.getNextSibling();this.setRefSibling(a)}this.notifyBeforeRemovingByEditor(c,b);b.removeChild(c);this.notifyAfterRemovingByEditor(c,b)}}});Kekule.ChemObjOperation.Remove=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Remove",initialize:function($super,d,c,a,b){$super(d,b);this.setParentObj(c);this.setRefSibling(a)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("ownerObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:false})},_isInEditorSelection:function(b){var a=this.getEditor();return((a&&a.getSelection&&a.getSelection())||[]).indexOf(b)>=0},doExecute:function(){var f=this.getTarget();var e=this.getParentObj();var a=this.getOwnerObj();if(!e&&f.getParent){e=f.getParent();this.setParentObj(e)}if(!a&&f.getOwner){a=f.getOwner();this.setOwnerObj(a)}if(e&&f){if(!this.getRefSibling()){var d=f.getNextSibling?f.getNextSibling():null;this.setRefSibling(d)}var c=this.getEditor();var b=this._isInEditorSelection(f);if(b){c.beginUpdateSelection()}this.notifyBeforeRemovingByEditor(f,e);e.removeChild(f);this.notifyAfterRemovingByEditor(f,e);if(b){c.removeFromSelection(f);c.endUpdateSelection()}}},doReverse:function(){var c=this.getParentObj();var a=this.getOwnerObj();var d=this.getTarget();if(c&&d){var b=this.getRefSibling();if(a){d.setOwner(a)}this.notifyBeforeAddingByEditor(d,c,b);c.insertBefore(d,b);this.notifyAfterAddingByEditor(d,c,b)}}});Kekule.ChemStructOperation={};Kekule.ChemStructOperation.AddNode=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddNode"});Kekule.ChemStructOperation.RemoveNode=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveNode",initProperties:function(){this.defineProp("linkedConnectors",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){if(!this.getLinkedConnectors()){this.setLinkedConnectors(Kekule.ArrayUtils.clone(this.getTarget().getLinkedConnectors()))}$super()},doReverse:function($super){$super();var d=this.getLinkedConnectors();if(d&&d.length){var c=this.getTarget();for(var b=0,a=d.length;b<a;++b){c.appendLinkedConnector(d[b])}}}});Kekule.ChemStructOperation.ReplaceNode=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemStructOperation.ReplaceNode",initialize:function($super,d,a,c,b){$super();this.setOldNode(d);this.setNewNode(a);this.setParentObj(c);this.setEditor(b)},initProperties:function(){this.defineProp("oldNode",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("newNode",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("parentObj",{dataType:"Kekule.ChemStructureFragment",serializable:false});this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false})},_isInEditorSelection:function(b){var a=this.getEditor();return((a&&a.getSelection&&a.getSelection())||[]).indexOf(b)>=0},doExecute:function(){var e=this.getOldNode();var a=this.getNewNode();if(e&&a){var d=this.getParentObj();if(!d){d=e.getParent();this.setParentObj(d)}if(d.replaceNode){var c=this.getEditor();var b=this._isInEditorSelection(e);if(b){c.beginUpdateSelection()}d.replaceNode(e,a);if(b){c.removeFromSelection(e);c.addObjToSelection(a);c.endUpdateSelection()}}}},doReverse:function(){var e=this.getOldNode();var a=this.getNewNode();if(e&&a){var d=this.getParentObj()||a.getParent();if(d.replaceNode){var c=this.getEditor();var b=this._isInEditorSelection(a);if(b){c.beginUpdateSelection()}d.replaceNode(a,e);if(b){c.removeFromSelection(a);c.addObjToSelection(e);c.endUpdateSelection()}}}}});Kekule.ChemStructOperation.AddConnector=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddConnector",initialize:function($super,e,c,a,d,b){$super(e,c,a,b);this.setConnectedObjs(d)},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){$super();var a=Kekule.ArrayUtils.clone(this.getConnectedObjs());if(a&&a.length){this.getTarget().setConnectedObjs(a)}},doReverse:function($super){$super()}});Kekule.ChemStructOperation.RemoveConnector=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveConnector",initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){if(!this.getConnectedObjs()){this.setConnectedObjs(Kekule.ArrayUtils.clone(this.getTarget().getConnectedObjs()))}$super()},doReverse:function($super){$super();var a=this.getConnectedObjs();if(a&&a.length){this.getTarget().setConnectedObjs(a)}}});Kekule.ChemStructOperation.MergeNodesBase=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesBase",initialize:function($super,d,b,a,c){$super(d,c);this.setDest(b);this.setEnableStructFragmentMerge(a||false);this._refSibling=null;this._nodeParent=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL})},getCommonSiblings:function(c,b){var a=c.getLinkedObjs();var d=b.getLinkedObjs();return Kekule.ArrayUtils.intersect(a,d)},doExecute:function(){},doReverse:function(){}});Kekule.ChemStructOperation.MergeNodes=Class.create(Kekule.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodes",initialize:function($super,d,b,a,c){$super(d,b,a,c);this._refSibling=null;this._nodeParent=null;this._structFragmentMergeOperation=null;this._removeConnectorOperations=[];this._removeNodeOperation=null},initProperties:function(){this.defineProp("changedConnectors",{dataType:DataType.ARRAY,serializable:false});this.defineProp("removedConnectors",{dataType:DataType.ARRAY,serializable:false})},doExecute:function(){var o=this.getTarget();var h=this.getDest();var n=o.getParentFragment();var p=h.getParentFragment();if(n!==p){if(this.getEnableStructFragmentMerge()){this._structFragmentMergeOperation=new Kekule.ChemStructOperation.MergeStructFragment(n,p,this.getEditor());this._structFragmentMergeOperation.execute();n=p}else{return null}}this._nodeParent=n;n.beginUpdate();try{var k=this.getEditor();var f=this.getRemovedConnectors();if(!f){var b=this.getCommonSiblings(o,h);var f=[];if(b.length){for(var g=0,e=b.length;g<e;++g){var q=b[g];var d=o.getConnectorTo(q);if(d&&(d.getConnectedObjCount()==2)){f.push(d)}}}var m=o.getConnectorTo(h);if(m){f.push(m)}this.setRemovedConnectors(f)}var a=this.getChangedConnectors();if(!a){var a=Kekule.ArrayUtils.clone(o.getLinkedConnectors())||[];a=Kekule.ArrayUtils.exclude(a,f);this.setChangedConnectors(a)}this._refSibling=o.getNextSibling();for(var g=0,e=a.length;g<e;++g){var d=a[g];var j=d.indexOfConnectedObj(o);d.removeConnectedObj(o);d.insertConnectedObjAt(h,j)}this._removeConnectorOperations=[];for(var g=0,e=f.length;g<e;++g){var d=f[g];var c=new Kekule.ChemStructOperation.RemoveConnector(d,null,null,k);c.execute();this._removeConnectorOperations.push(c)}this._removeNodeOperation=new Kekule.ChemStructOperation.RemoveNode(o,null,null,k);this._removeNodeOperation.execute()}finally{n.endUpdate()}},doReverse:function(){var j=this.getTarget();var f=this.getDest();var h=this._nodeParent;h.beginUpdate();try{this._removeNodeOperation.reverse();if(this._removeConnectorOperations.length){for(var e=this._removeConnectorOperations.length-1;e>=0;--e){var b=this._removeConnectorOperations[e];b.reverse()}}this._removeConnectorOperations=[];var a=this.getChangedConnectors();for(var e=0,c=a.length;e<c;++e){var d=a[e];var g=d.indexOfConnectedObj(f);d.removeConnectedObj(f);d.insertConnectedObjAt(j,g)}}finally{h.endUpdate()}if(this._structFragmentMergeOperation){this._structFragmentMergeOperation.reverse()}}});Kekule.ChemStructOperation.MergeNodes.canMerge=function(e,b,g,d){if((e instanceof Kekule.StructureFragment)||(b instanceof Kekule.StructureFragment)){return false}if(!((e instanceof Kekule.ChemStructureNode)&&(b instanceof Kekule.ChemStructureNode))){return false}var f=e.getParent();var c=b.getParent();var a=(f===c)||g;if(!d){a=a&&(!e.getConnectorTo(b))}return a};Kekule.ChemStructOperation.MergeNodesPreview=Class.create(Kekule.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesPreview",initialize:function($super,d,b,a,c){$super(d,b,a,c);this._nodeParent=null},doExecute:function(){this._moveNodeOperations=[];var j=this.getTarget();var g=this.getDest();var h=j.getParentFragment();var e=Kekule.CoordMode;var d=[e.COORD2D,e.COORD3D];if(h){h.beginUpdate()}try{for(var f=0,b=d.length;f<b;++f){var c=g.getAbsBaseCoord(d[f],false);var a=new Kekule.ChemObjOperation.MoveTo(j,c,d[f],true,this.getEditor());a.execute();this._moveNodeOperations.push(a)}this._nodeParent=h}finally{if(h){h.endUpdate()}}},doReverse:function(){var c=this._nodeParent;if(c){c.beginUpdate()}try{var b=this._moveNodeOperations;for(var a=b.length-1;a>=0;--a){b[a].reverse()}}finally{if(c){c.endUpdate()}}this._moveNodeOperations=null}});Kekule.ChemStructOperation.MergeNodesPreview.canMerge=Kekule.ChemStructOperation.MergeNodes.canMerge;Kekule.ChemStructOperation.MergeConnectorsBase=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectorsBase",initialize:function($super,e,b,d,a,c){$super(e,c);this.setDest(b);this.setCoordMode(d||Kekule.CoordMode.COORD2D);this.setEnableStructFragmentMerge(a||false);this._refSibling=null;this._nodeParent=null;this._nodeMergeOperations=[]},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureConnector",serializable:false});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL});this.defineProp("coordMode",{dataType:DataType.INT})},getMergeNodeOperationClass:function(){},doExecute:function(){var o=Kekule.ChemStructOperation.MergeConnectors.canMerge(this.getTarget(),this.getDest(),this.getEnableStructFragmentMerge());if(!o){Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_MERGE_CONNECTORS"))}var r=this.getCoordMode();var n=[this.getTarget(),this.getDest()];var g=Kekule.ArrayUtils;var e=g.clone(this.getTarget().getConnectedObjs());var f=g.clone(this.getDest().getConnectedObjs());var t=this.getAllowCoordBorrow();for(var q=0,m=n.length;q<m;++q){var a=n[q];var d=a.getConnectedObjAt(0).getAbsCoordOfMode(r,t);var c=a.getConnectedObjAt(1).getAbsCoordOfMode(r,t);var s=Kekule.CoordUtils.substract(d,c);var h=Math.abs(s.x)>Math.abs(s.y)?"x":"y";if(Kekule.ObjUtils.notUnset(d.z)){if(Math.abs(s.z)>Math.abs(s.x)){h="z"}}var k=(q===0)?e:f;k.sort(function(l,i){var v=l.getAbsCoordOfMode(r,t);var u=i.getAbsCoordOfMode(r,t);return(v[h]-u[h])||0})}var b=g.intersect(e,f);e=g.exclude(e,b);f=g.exclude(f,b);this._nodeMergeOperations=[];var p=this.getMergeNodeOperationClass();for(var q=0,m=e.length;q<m;++q){if(e[q]!==f[q]){var j=new p(e[q],f[q],this.getEnableStructFragmentMerge());j.execute()}this._nodeMergeOperations.push(j)}},doReverse:function(){for(var a=this._nodeMergeOperations.length-1;a>=0;--a){var b=this._nodeMergeOperations[a];b.reverse()}this._nodeMergeOperations=[]}});Kekule.ChemStructOperation.MergeConnectors=Class.create(Kekule.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return Kekule.ChemStructOperation.MergeNodes}});Kekule.ChemStructOperation.MergeConnectors.canMerge=function(d,c,e){if(!e&&(d.getParent()!==c.getParent())){return false}if(d.isConnectingConnector()||c.isConnectingConnector()){return false}var a=d.getConnectedExposedObjs();var b=c.getConnectedObjs();if(a.length!==b.length){return false}if(a.length!==2){return false}if(Kekule.ArrayUtils.intersect(a,b).length>=1){return false}return true};Kekule.ChemStructOperation.MergeConnectorsPreview=Class.create(Kekule.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return Kekule.ChemStructOperation.MergeNodesPreview}});Kekule.ChemStructOperation.MergeConnectorsPreview.canMerge=Kekule.ChemStructOperation.MergeConnectors.canMerge;Kekule.ChemStructOperation.MergeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeStructFragment",initialize:function($super,c,a,b){$super(c,b);this.setDest(a);this._removeOperation=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("mergedNodes",{dataType:DataType.ARRAY,serializable:false});this.defineProp("mergedConnectors",{dataType:DataType.ARRAY,serializable:false})},moveChildBetweenStructFragment:function(d,c,b,a){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(d,c,b,a)},doExecute:function(){var e=this.getTarget();var c=this.getDest();if(e&&c){var b=Kekule.ArrayUtils.clone(e.getNodes());this.setMergedNodes(b);var a=Kekule.ArrayUtils.clone(e.getConnectors());this.setMergedConnectors(a);this.moveChildBetweenStructFragment(e,c,b,a);var d=e.getParent();if(d){this._removeOperation=new Kekule.ChemObjOperation.Remove(e,d,null,this.getEditor());this._removeOperation.execute()}}},doReverse:function(){var d=this.getTarget();var c=this.getDest();if(d&&c){if(this._removeOperation){this._removeOperation.reverse();this._removeOperation=null}var b=this.getMergedNodes();var a=this.getMergedConnectors();this.moveChildBetweenStructFragment(c,d,b,a)}}});Kekule.ChemStructOperation.SplitStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.SplitStructFragment",initialize:function($super,b,a){$super(b,a)},initProperties:function(){this.defineProp("splittedFragments",{dataType:DataType.ARRAY,serializable:false,setter:null})},doExecute:function(){var f=Kekule.ChemStructureUtils.splitStructFragment(this.getTarget());if(f.length>1){this.setPropStoreFieldValue("splittedFragments",f);var c=this.getTarget().getParent();var d=this.getTarget().getNextSibling();c.beginUpdate();try{if(c){for(var b=1,a=f.length;b<a;++b){var e=f[b];c.insertBefore(e,d)}}}finally{c.endUpdate()}}else{this.setPropStoreFieldValue("splittedFragments",null)}},doReverse:function(){var a=this.getSplittedFragments();if(a&&a.length){var e=this.getTarget();for(var c=0,b=a.length;c<b;++c){var f=a[c];if(f!==e){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(f,e,Kekule.ArrayUtils.clone(f.getNodes()),Kekule.ArrayUtils.clone(f.getConnectors()));var d=f.getParent();if(d){d.removeChild(f)}f.finalize()}}}}});Kekule.ChemStructOperation.StandardizeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.StandardizeStructFragment",initialize:function($super,b,a){$super(b,a);this.setEnableSplit(true);this.setEnableRemove(true);this._concreteOper=null},initProperties:function(){this.defineProp("enableRemove",{dataType:DataType.BOOL});this.defineProp("enableSplit",{dataType:DataType.BOOL})},doExecute:function(){var c=this.getTarget();var a=c.getNodeCount();this._concreteOper=null;var b=this.getEditor();if(a<=0){if(this.getEnableRemove()){this._concreteOper=new Kekule.ChemObjOperation.Remove(c,null,null,b)}}else{if(this.getEnableSplit()){this._concreteOper=new Kekule.ChemStructOperation.SplitStructFragment(c,b)}}if(this._concreteOper){return this._concreteOper.execute()}else{return null}},doReverse:function(){return this._concreteOper?this._concreteOper.reverse():null}})})();(function(){Kekule.Editor.StructureUtils={getCascadeDeleteObjs:function(a){return Kekule.ChemStructureUtils.getCascadeDeleteObjs(a)},getSurroundingObjs:function(c){var b=c.getLinkedObjs();if(c instanceof Kekule.ChemStructureConnector){var a=c.getConnectedObjs();Kekule.ArrayUtils.pushUnique(b,a)}return b},calcMostEmptyDirectionAngleOfChemObj:function(h,d,e){var n=[];if(!d){d=h.getLinkedObjs()}var p=h.getAbsBaseCoord2D(e);for(var j=0,g=d.length;j<g;++j){var m=d[j].getAbsBaseCoord2D(e);m=Kekule.CoordUtils.substract(m,p);var f=Math.atan2(m.y,m.x);if(f<0){f=Math.PI*2+f}n.push(f)}n.sort();var g=n.length;if(g===0){return 0}else{if(g===1){return -n[0]}else{var o=0;var k=0;for(var j=0;j<g;++j){var b=n[j];var a=n[(j+1)%g];var q=a-b;if(q<0){q+=Math.PI*2}if(q>o){o=q;k=j}}var r=n[k]+o/2;return r}}},calcPreferred2DBondGrowingDirection:function(e,b,d){var c=e.getAbsBaseCoord2D(d);var f=Kekule.Editor.StructureUtils.getSurroundingObjs(e);var m=f?f.length:0;switch(m){case 0:return b;case 1:var a=f[0];var n=a.getAbsBaseCoord2D(d);var o=Kekule.CoordUtils.substract(n,c);var l=Math.atan2(o.y,o.x);var i=l-b;var h=l+b;if(i<0){i+=Math.PI*2}if(h<0){h+=Math.PI*2}var g;if(i!==h){var k=Math.min((i>Math.PI)?Math.abs(i-Math.PI*2):i,Math.abs(i-Math.PI));var j=Math.min((h>Math.PI)?Math.abs(h-Math.PI*2):h,Math.abs(h-Math.PI));g=(k<=j)?i:h}else{g=i}return g;default:var g=Kekule.Editor.StructureUtils.calcMostEmptyDirectionAngleOfChemObj(e,f,d);return g}},calcPreferred2DBondGrowingLocation:function(a,e,f,b){var c=a.getAbsBaseCoord2D(b);var d=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(a,f,b);return Kekule.CoordUtils.add(c,{x:e*Math.cos(d),y:e*Math.sin(d)})},isBondPropsMatch:function(c,b,e){var d=["bondType","bondOrder","stereo"];var a=true;if(a&&e.indexOf("bondType")>=0){a=(c.bondType==b.bondType||(!c.bondType&&!b.bondType))}if(a&&c.bondType===Kekule.BondType.COVALENT){if(a&&e.indexOf("bondOrder")>=0||(!c.bondOrder&&!b.bondOrder)){a=(c.bondOrder==b.bondOrder)}if(a&&e.indexOf("stereo")>=0){a=(c.stereo==b.stereo||(!c.stereo&&!b.stereo))}}if(a){a=Kekule.ObjUtils.equal(c,b,d)}return a},getChemStructureNodeLabel:function(b,d){if(b.getIsotopeId){return b.getIsotopeId()}else{if(b instanceof Kekule.SubGroup){var c=b.getAbbr()||b.getFormulaText();if(d){c=c||d.getRgroup()}return c}else{var a=b.getCoreDisplayRichTextItem(null,null,d);return Kekule.Render.RichTextUtils.toText(a)}}},getAllChemStructureNodesLabel:function(b,e){var g;for(var c=0,a=b.length;c<a;++c){var d=b[c];var f=Kekule.Editor.StructureUtils.getChemStructureNodeLabel(d,e);if(!g){g=f}else{if(g!==f){return null}}}return g},getAllChemStructureNodesHtmlCode:function(b,j,g,a){var k;for(var e=0,d=b.length;e<d;++e){var c=b[e];var h=c.getCoreDisplayRichTextItem(j,g,a);var f=Kekule.Render.RichTextUtils.toSimpleHtmlCode(h);if(!k){k=f}else{if(k!==f){return null}}}return k},getStructureCenterAbsBaseCoord:function(g,d,b){var j=null;var h=Kekule.CoordUtils.add;var c=g.getNodeCount();for(var e=0;e<c;++e){var a=g.getNodeAt(e);var f=a.getAbsBaseCoord(d,b);if(!j){j=f}else{j=h(j,f)}}j=Kekule.CoordUtils.divide(j,c);return j}};Kekule.Editor.RepositoryStructureUtils={_calcNodeMergeAdjustRotateAngle:function(d,u,j){var h=0;var t=d.getCoordMode();if(t!==Kekule.CoordMode.COORD3D){var v=d.getAllowCoordBorrow();var k=d.getEditorConfigs().getStructureConfigs();var f=Kekule.Editor.StructureUtils.getSurroundingObjs(u);var e=Kekule.Editor.StructureUtils.getSurroundingObjs(j);if(f.length===1){var a=u.getLinkedConnectorAt(0);var o=a.getBondOrder?a.getBondOrder():0;var r=k.getNewBondDefAngle(j,o);w=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(j,r,v);var b=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(u,f[0],t,v);var c=Math.atan2(b.y,b.x);h=w-c}else{if(e.length===1){var a=j.getLinkedConnectorAt(0);var o=a.getBondOrder?a.getBondOrder():0;var r=k.getNewBondDefAngle(u,o);var w=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(u,r,v);var b=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(j,e[0],t,v);var n=Math.atan2(b.y,b.x);h=n-w}else{var r=k.getNewBondDefAngle(j,null);var w=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(j,r,v);var m={};for(var q=0,p=f.length;q<p;++q){var b=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(u,f[q],t,v);var s=Math.atan2(b.y,b.x);if(Kekule.ObjUtils.isUnset(m.min)||(s<m.min)){m.min=s}if(Kekule.ObjUtils.isUnset(m.max)||(s>m.max)){m.max=s}}var g=(m.max+m.min)/2;h=w-g}}}return h},_calcConnectorMergeTransformParams:function(d,b,i){var f=b.getConnectedObjAt(0);var e=b.getConnectedObjAt(1);var h=i.getConnectedObjAt(0);var g=i.getConnectedObjAt(1);var c=d.getObjCoord(f);var a=d.getObjCoord(e);var l=d.getObjCoord(h);var j=d.getObjCoord(g);var k=Kekule.CoordUtils.calcCoordGroup2DTransformParams(c,a,j,l);return k},calcRepObjInitialTransformParams:function(k,f,c,g,d){var i=c.baseObjCoord;var b=k.getDefBondLength();var j=b/f.getRefLength();var h;var a=i;if(c.mergeObj){var g=c.mergeDest||g;if(g){d=k.getObjectScreenCoord(g);if((c.mergeObj instanceof Kekule.ChemStructureNode)&&(g instanceof Kekule.ChemStructureNode)){h=Kekule.Editor.RepositoryStructureUtils._calcNodeMergeAdjustRotateAngle(k,c.mergeObj,g)}else{if((c.mergeObj instanceof Kekule.ChemStructureConnector)&&(g instanceof Kekule.ChemStructureConnector)){return Kekule.Editor.RepositoryStructureUtils._calcConnectorMergeTransformParams(k,c.mergeObj,g)}}}}var e=k.translateCoord(d,Kekule.Editor.CoordSys.SCREEN,Kekule.Editor.CoordSys.CHEM);if(i){e=Kekule.CoordUtils.substract(e,i)}var l={scale:j,translateX:e.x,translateY:e.y,translateZ:e.z,rotateAngle:h,center:a};return l},transformChemObjectsCoordAndSize:function(h,m,k){var e=h.getCoordMode();var c=h.getAllowCoordBorrow();var j=(e===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(k):Kekule.CoordUtils.calcTransform2DMatrix(k);var a=Object.extend({},k);a=Object.extend(a,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});var b=(e===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(a):Kekule.CoordUtils.calcTransform2DMatrix(a);for(var g=0,d=m.length;g<d;++g){var f=m[g];f.transformAbsCoordByMatrix(j,b,e,true,c);f.scaleSize(k.scale,e,true,c)}}}})();(function(){var a=Class.PropertyScope;Kekule.Editor.BaseEditorConfigs=Class.create(Kekule.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.Editor.BaseEditorConfigs",initProperties:function(){this.addConfigProp("uiMarkerConfigs","Kekule.EditorConfigs.UiMarkerConfigs");this.addConfigProp("interactionConfigs","Kekule.EditorConfigs.InteractionConfigs");this.addConfigProp("structureConfigs","Kekule.Editor.StructureConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("uiMarkerConfigs",new Kekule.Editor.UiMarkerConfigs());this.setPropStoreFieldValue("interactionConfigs",new Kekule.Editor.InteractionConfigs());this.setPropStoreFieldValue("structureConfigs",new Kekule.Editor.StructureConfigs())}});Kekule.Editor.ChemSpaceEditorConfigs=Class.create(Kekule.Editor.BaseEditorConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditorConfigs",initProperties:function(){this.addConfigProp("chemSpaceConfigs","Kekule.Editor.ChemSpaceConfigs");this.addConfigProp("styleSetterConfigs","Kekule.Editor.StyleSetterConfigs",undefined,{scope:a.PUBLIC})},initPropValues:function($super){$super();this.setPropStoreFieldValue("chemSpaceConfigs",new Kekule.Editor.ChemSpaceConfigs());this.setPropStoreFieldValue("styleSetterConfigs",new Kekule.Editor.StyleSetterConfigs())}});Kekule.ClassUtils.makeSingleton(Kekule.Editor.ChemSpaceEditorConfigs);Kekule.Editor.InteractionConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.InteractionConfigs",initProperties:function(){var b=Math.PI/180;this.addBoolConfigProp("enableTrackOnNearest",true);this.addBoolConfigProp("enableHotTrack",true);this.addBoolConfigProp("autoSelectNewlyInsertedObjects",true);this.addIntConfigProp("objBoundTrackMinInflation",5);this.addIntConfigProp("objBoundTrackMinInflationMouse",null);this.addIntConfigProp("objBoundTrackMinInflationPen",null);this.addIntConfigProp("objBoundTrackMinInflationTouch",10);this.addIntConfigProp("objBoundTrackInflationRatio",0.2);this.addIntConfigProp("objBoundTrackInflationRatioMouse",null);this.addIntConfigProp("objBoundTrackInflationRatioPen",null);this.addIntConfigProp("objBoundTrackInflationRatioTouch",0.33);this.addBoolConfigProp("enablePartialAreaSelecting",false);this.addFloatConfigProp("selectingBrushWidth",12);this.addBoolConfigProp("enableOffSelectionManipulation",true);this.addIntConfigProp("offSelectionManipulationActivatingTimeThreshold",800);this.addFloatConfigProp("unmovePointerDistanceThreshold",5,{scope:a.PUBLIC});this.addIntConfigProp("selectingCurveSimplificationDistanceThreshold",2,{scope:a.PUBLIC});this.addIntConfigProp("selectionMarkerInflation",5);this.addIntConfigProp("selectionMarkerEdgeInflation",5);this.addIntConfigProp("selectionMarkerDefPulseDuration",500);this.addIntConfigProp("selectionMarkerDefPulseCount",2);this.addFloatConfigProp("constrainedResizeStep",0.25);this.addIntConfigProp("rotationRegionInflation",10);this.addFloatConfigProp("constrainedRotateStep",b*15);this.addIntConfigProp("rotationLocationPointDistanceThreshold",10);this.addIntConfigProp("directedMoveDistanceThreshold",10);this.addBoolConfigProp("enableMergePreview",true);this.addBoolConfigProp("enableGestureManipulation",true);this.addBoolConfigProp("enableGestureZoomOnEditor",true);this.addIntConfigProp("clonedObjectScreenOffset",10);this.addIntConfigProp("atomSetterFontSize",14);this.addBoolConfigProp("allowUnknownAtomSymbol",true);this.addIntConfigProp("trackSimplifierDistanceThreshold",8);this.addIntConfigProp("trackSimplifierIgnoreSegmentThreshold",10);this.addIntConfigProp("trackMergeDistanceThreshold",20);this.addFloatConfigProp("trackOptimizationAngleConstraint",b*30);this.addConfigProp("trackOptimizationDistanceConstraints",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addIntConfigProp("trackOptimizationPrimaryDistanceConstraint",1);this.addFloatConfigProp("trackTouchRefLength",0.5,{scope:a.PUBLIC});this.addBoolConfigProp("autoAdjustZoomLevelOnTrackTouching",!true,{scope:a.PUBLIC});this.addFloatConfigProp("editorInitialZoom",1.5)},initPropValues:function($super){$super();this.setTrackOptimizationDistanceConstraints([0.5,1,3,4,5])}});Kekule.Editor.UiMarkerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.UiMarkerConfigs",initProperties:function(){this.addStrConfigProp("hotTrackerColor","#0000FF");this.addFloatConfigProp("hotTrackerOpacity",0.5);this.addStrConfigProp("selectionMarkerStrokeColor","#0000FF");this.addFloatConfigProp("selectionMarkerStrokeWidth",2);this.addStrConfigProp("selectionMarkerFillColor","#0000FF");this.addFloatConfigProp("selectionMarkerOpacity",0.2);this.addFloatConfigProp("selectionMarkerEmphasisOpacity",0.4);this.addFloatConfigProp("selectionTransformMarkerSize",8,{scope:a.PUBLIC});this.addFloatConfigProp("selectionTransformMarkerOpacity",0.4,{scope:a.PUBLIC});this.addStrConfigProp("selectingMarkerStrokeColor","#000000");this.addFloatConfigProp("selectingMarkerStrokeWidth",1);this.addStrConfigProp("selectingMarkerStrokeDash",true);this.addStrConfigProp("selectingMarkerFillColor",null);this.addFloatConfigProp("selectingMarkerOpacity",0.7);this.addStrConfigProp("selectingBrushMarkerStrokeColor","#0000FF");this.addStrConfigProp("selectingBrushMarkerStrokeDash",false);this.addFloatConfigProp("selectingBrushMarkerStrokeLineCap","round");this.addFloatConfigProp("selectingBrushMarkerStrokeLineJoin","round");this.addFloatConfigProp("selectingBrushMarkerOpacity",0.3);this.addStrConfigProp("trackMarkerStrokeColor","#0000AA");this.addFloatConfigProp("trackMarkerStrokeWidth",2);this.addStrConfigProp("trackMarkerStrokeDash",false);this.addFloatConfigProp("trackMarkerOpacity",0.5);this.addStrConfigProp("flexStructureAssocMarkerColor","#0000AA");this.addFloatConfigProp("flexStructureAssocMarkerOpacity",0.5);this.addIntConfigProp("flexStructureAssocMarkerFontSize",14);this.addStrConfigProp("flexStructureAssocMarkerFontFamily","Arial, Helvetica, sans-serif")}});Kekule.Editor.StructureConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StructureConfigs",initProperties:function(){this.addStrConfigProp("defBondType",Kekule.BondType.DEFAULT,{enumSource:Kekule.BondType});this.addIntConfigProp("defBondOrder",Kekule.BondOrder.SINGLE,{enumSource:Kekule.BondOrder});this.addFloatConfigProp("defBondLength",0.8);this.addConfigProp("defBondAngles",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addFloatConfigProp("bondConstrainedDirectionDelta",undefined,{scope:a.PUBLIC});this.addConfigProp("bondConstrainedDirectionAngles",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addFloatConfigProp("bondConstrainedDirectionAngleThreshold",undefined,{scope:a.PUBLIC});this.addFloatConfigProp("initialBondDirection",undefined,{scope:a.PUBLIC});this.addStrConfigProp("defIsotopeId","C");this.addConfigProp("primaryOrgChemAtoms",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addIntConfigProp("maxFlexChainAtomCount",0);this.addIntConfigProp("minFlexRingAtomCount",3);this.addIntConfigProp("maxFlexRingAtomCount",18);this.addHashConfigProp("enabledNonAtomNodeTypes",{RGroup:true,pseudoatomDummy:true,pseudoatomHetero:true,pseudoatomAny:true,variableAtomList:true,variableAtomNotList:true});this.addHashConfigProp("enabledBondForms",{single:true,"double":true,triple:true,quad:true,explicitAromatic:true,up:true,upInverted:true,down:true,downInverted:true,upOrDown:true,eOrZ:true,closer:true,ionic:false,coordinate:false,metallic:false,hydrogen:true})},initPropValues:function($super){$super();var b=Math.PI/180;var d=[];var c=Kekule.BondOrder;var e=Math.PI*2/3;d[0]=e;d[c.EXPLICIT_AROMATIC]=[e];d[c.TRIPLE]=[Math.PI];d[c.DOUBLE]=[e];d[c.DOUBLE][c.DOUBLE]=Math.PI;d[c.SINGLE]=[e];this.setDefBondAngles(d);this.setBondConstrainedDirectionDelta(10*Math.PI/180);this.setBondConstrainedDirectionAngles([0,90*b,180*b,270*b]);this.setBondConstrainedDirectionAngleThreshold(b*3);this.setInitialBondDirection(30*b);this.setPrimaryOrgChemAtoms(["C","H","O","N","P","S","F","Cl","Br","I","Si","D","C13"])},getDefAngleOfBonds:function(f,d){var c=f||0;var b=d||0;if(c>b){c=d||0;b=f||0}var h=this.getDefBondAngles();var g=h[b];if(!g){return h[0]}else{var e=g[c];return e||g[0]}},getNewBondDefAngle:function(d,e){if(Kekule.ObjUtils.isUnset(e)){e=this.getDefBondOrder()}var c;var f=Kekule.Editor.StructureUtils.getSurroundingObjs(d);if(f.length===1){var b=d.getLinkedConnectorAt(0);if(b&&(b.getConnectedObjs().indexOf(f[0])>=0)){var g=b.getBondOrder?b.getBondOrder():null;if(Kekule.ObjUtils.notUnset(g)){c=this.getDefAngleOfBonds(e,g)}}}else{if(f.length===0){c=this.getInitialBondDirection()}else{c=this.getDefAngleOfBonds(e,0)}}return c}});Kekule.Editor.ChemSpaceConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceConfigs",initProperties:function(){this.addHashConfigProp("defScreenSize2D");this.addHashConfigProp("defScreenSize3D");this.addNumConfigProp("defPadding",50)},initPropValues:function($super){$super();this.setDefScreenSize2D({x:900,y:1500});this.setDefScreenSize3D({x:600,y:600,z:600})}});Kekule.Editor.StyleSetterConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StyleSetterConfigs",initProperties:function(){this.defineProp("listedFontSizes",{dataType:DataType.ARRAY});this.defineProp("listedFontNames",{dataType:DataType.ARRAY})},initPropValues:function($super){$super();this.setListedFontSizes([8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88,96]);this.setListedFontNames(Kekule.Widget.FontEnumerator.getAvailableFontFamilies())}})})();(function(){Kekule.Editor.RepositoryData={subGroups:[{name:"methyl",inputTexts:["Me","CH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Thu,15 Sep 2016 15:49:02 GMT"},"__type__":"object"},"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Me","__type__":"Kekule.SubGroup"}'},{name:"ethyl",inputTexts:["Et","C2H5"],structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Et","__type__":"Kekule.SubGroup"}'},{name:"n-propyl",inputTexts:["n-Pr","nPr","C3H7"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Pr","formulaText":"C3H7","__type__":"Kekule.SubGroup"}'},{name:"i-propyl",inputTexts:["i-Pr","iPr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Pr","__type__":"Kekule.SubGroup"}'},{name:"n-butyl",inputTexts:["n-Bu","nBu","C4H9"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Bu","formulaText":"C4H9","__type__":"Kekule.SubGroup"}'},{name:"i-butyl",inputTexts:["i-Bu","iBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Bu","__type__":"Kekule.SubGroup"}'},{name:"s-butyl",inputTexts:["s-Bu","sBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"s-Bu","__type__":"Kekule.SubGroup"}'},{name:"t-butyl",inputTexts:["t-Bu","tBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"t-Bu","__type__":"Kekule.SubGroup"}'},{name:"phenyl",inputTexts:["Ph","C6H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ph","formulaText":"C6H5","__type__":"Kekule.SubGroup"}'},{name:"benzyl",inputTexts:["Bn"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bn","__type__":"Kekule.SubGroup"}'},{name:"benzoyl",inputTexts:["Bz"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bz","__type__":"Kekule.SubGroup"}'},{inputTexts:["CF3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CF3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CCl3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CCl3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CBr3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CBr3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CI3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CI3","__type__":"Kekule.SubGroup"}'},{inputTexts:["OMe","OCH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["OEt","OC2H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ot-Bu","OtBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275525,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275454,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.7763568394002505e-15,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ot-Bu","__type__":"Kekule.SubGroup"}'},{inputTexts:["CO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO","__type__":"Kekule.SubGroup"}'},{inputTexts:["CHO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CHO","__type__":"Kekule.SubGroup"}'},{name:"carboxyl",inputTexts:["COOH","CO2H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOH","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOOH","CO3H","CO2OH"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["COONa"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Na"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COONa","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOK"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"K"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOK","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOCH3","COOMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOC2H5","COOEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.039230484541326,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["COCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["COBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COBr","__type__":"Kekule.SubGroup"}'},{inputTexts:["CONH2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CONH2","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ac"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ac","__type__":"Kekule.SubGroup"}'},{inputTexts:["OAc"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OAc","__type__":"Kekule.SubGroup"}'},{inputTexts:["MeCO","COMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.3464101615137771,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.3464101615137771,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["EtCO","COEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COEt","__type__":"Kekule.SubGroup"}'},{name:"hydroxymethyl",inputTexts:["CH2OH"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999968,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CH2OH","__type__":"Kekule.SubGroup"}'},{name:"amino",inputTexts:["NH2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Thu,15 Sep 2016 15:49:26 GMT"},"__type__":"object"},"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NH2","name":"Untitled Document-1","__type__":"Kekule.SubGroup"}'},{inputTexts:["NMe2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NMe2","__type__":"Kekule.SubGroup"}'},{name:"nitro",inputTexts:["NO2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO2","__type__":"Kekule.SubGroup"}'},{name:"nitroso",inputTexts:["NO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO","__type__":"Kekule.SubGroup"}'},{name:"diazo",inputTexts:["N2","NN","N2 +"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2+","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Cl","NNCl","N2 +Cl-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2+Cl-","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Br","NNBr","N2 +Br-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2+Br-","__type__":"Kekule.SubGroup"}'},{name:"nitrile group",inputTexts:["CN"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CN","__type__":"Kekule.SubGroup"}'},{name:"pyridyl",inputTexts:["Py"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Py","__type__":"Kekule.SubGroup"}'},{name:"sulfonic group",inputTexts:["SO3H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000213,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000213,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.399999999999995,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Cl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Cl","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Br"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Br","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgBr","__type__":"Kekule.SubGroup"}'},{inputTexts:["TMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"TMS","__type__":"Kekule.SubGroup"}'},{inputTexts:["OTMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTMS","__type__":"Kekule.SubGroup"}'}],fragments:[{name:"methane",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Sat,25 Feb 2017 04:21:08 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"fischer1",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer2",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer3",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999972,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.6000000000000085,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,10]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"sawhorseStaggered",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:51:35 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34060000000000024,"y":-0.642199999999999,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.37219999999999764,"y":-1.0575999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.0877999999999997,"y":-0.648899999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3686000000000007,"y":-1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34060000000000024,"y":0.6422000000000061,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.0877999999999997,"y":0.6489000000000011,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3686000000000007,"y":1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"zIndex2D":0,"coord2D":{"x":0.3722000000000012,"y":1.0576000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-6","__type__":"Kekule.Molecule"}'},{name:"sawhorseEclipsed",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:50:51 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3022000000000009,"y":0.4405000000000001,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.4229000000000003,"y":0.8340999999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.1265,"y":0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"coord2D":{"x":0.44500000000000206,"y":1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.1265,"y":-1.6214000000000084,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.4015000000000004,"y":-1.2276999999999987,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3013999999999992,"y":-1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.38010000000000055,"y":-0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-5","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:43:26 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.5715736151962387,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9715297072546738,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.20235354281841378,"y":-0.12653156366939555,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.5714766561436155,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9715297072546738,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.20225658376579414,"y":0.1266285227220152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:44:10 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9716412105880998,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.5715992908679759,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.20239696641355032,"y":-0.14362717166194017,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9716412105880998,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.571696270727303,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.20239696641355032,"y":0.14372415152126905,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-2","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:47:35 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4999174283497734,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.4999174283497734,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:47:08 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.49991742834977515,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.49991742834977515,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":10,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:48:11 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.48039814732735664,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4815600495278858,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0006293636919529888,"y":-0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:48:04 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.4804171472781027,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":-1,"coord2D":{"x":-0.48158784071773564,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0005848625620670234,"y":-0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[4,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"substituentMark",dataFormat:"Kekule-JSON",scale:0.7,structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Pseudoatom","coordPos2D":0,"coordPos3D":0,"renderOptions":{"nodeDisplayMode":-1,"__type__":"object"},"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"atomType":"any","symbol":"A"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"renderOptions":{"opacity":0.5,"__type__":"object"},"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'}]}})();(function(){Kekule.Editor.AbstractRepositoryItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.AbstractRepositoryItem",initialize:function($super){$super()},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAvailableCoordModes:function(){return[]},createObjects:function(c,b){},getScale:function(){return this.doGetScale()||1},doGetScale:function(){return 1},getRefLength:function(){return this.doGetRefLength()/(this.getScale()||1)},doGetRefLength:function(){},isOneStructureFragmentObj:function(){return false}});Kekule.Editor.MolRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.MolRepositoryItem2D",initialize:function($super){$super()},initProperties:function(){this.defineProp("molScale",{dataType:DataType.FLOAT});this.defineProp("molManipulationCenterCoord",{dataType:DataType.HASH});this.defineProp("molManipulationDefDirectionCoord",{dataType:DataType.HASH})},doGetScale:function($super){return this.getMolScale()||$super()},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},isOneStructureFragmentObj:function(){return true},createObjects:function(d,c){var f=this.doCreateObjects(d,c);if(!f){return null}var b=null;var g=null;var e={x:0,y:0};if(d){b=(d instanceof Kekule.ChemStructureNode)?this.doGetMergableNode(f,d):(d instanceof Kekule.ChemStructureConnector)?this.doGetMergableConnector(f,d):null;if(b){g=d;e=b.getAbsBaseCoord2D()}}return{objects:[f],mergeObj:b,mergeDest:g,baseObjCoord:e,centerCoord:{x:0,y:0}}},doCreateObjects:function(c,b){return null},doGetMergableNode:function(b,c){return null},doGetMergableConnector:function(b,c){return null}});Kekule.Editor.StoredStructFragmentRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredStructFragmentRepositoryItem2D",initialize:function($super,b,d,c){$super();this.beginUpdate();try{if(d){this.setDataFormat(d)}if(b){this.setStructData(b)}if(c){this.setMolScale(c)}}finally{this.endUpdate()}},initProperties:function(){this.defineProp("structureFragment",{dataType:"Kekule.StructureFragment",setter:null,serializable:false});this.defineProp("structData",{dataType:DataType.STRING});this.defineProp("dataFormat",{dataType:DataType.STRING})},objectChange:function($super,b){$super(b);if((b.indexOf("structData")>=0)||(b.indexOf("dataFormat")>=0)){var c=null;if(this.getStructData()){c=this._createTemplateStructFragment()}this.setPropStoreFieldValue("structureFragment",c)}},_createTemplateStructFragment:function(){var b=null;if(this.getStructData()){b=Kekule.IO.loadFormatData(this.getStructData(),this.getDataFormat()||Kekule.IO.DataFormat.KEKULE_JSON)}if(b){this._adjustTemplateStructureFragmentCoords(b)}return b},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var f=Kekule.Render.ObjUtils.getContainerBox(e,Kekule.CoordMode.COORD2D,true);if(f){var j=e.getCoordOfMode?e.getCoordOfMode(Kekule.CoordMode.COORD2D,true)||{}:{};var h={};h.x=-(f.x2+f.x1)/2;h.y=-(f.y2+f.y1)/2;e.beginUpdate();try{for(var c=0,b=e.getNodeCount();c<b;++c){var d=e.getNodeAt(c);var g=d.getCoord2D(true);g=Kekule.CoordUtils.add(g,h);d.setCoord2D(g)}}finally{e.endUpdate()}}},doGetRefLength:function(){var b=this.getStructureFragment();return b?b.getConnectorLengthMedian(Kekule.CoordMode.COORD2D,true):0},doCreateObjects:function(c,b){var d=this.getStructureFragment();return d?d.clone():null},doGetMergableNode:function(b,c){return b.getAnchorNodeAt(0)||b.getNodeAt(0)},doGetMergableConnector:function(b,c){return null}});Kekule.Editor.StoredSubgroupRepositoryItem2D=Class.create(Kekule.Editor.StoredStructFragmentRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredSubgroupRepositoryItem2D",initialize:function($super,b,d,c){$super(b,d,c)},initProperties:function(){this.defineProp("inputTexts",{dataType:DataType.STRING})},doCreateObjects:function(d,c){var e=this.getStructureFragment();if(e){var b=new Kekule.SubGroup();b.assign(e,false);return b}else{return null}},createObjects:function($super,c){var b=$super(c);return b},_adjustTemplateStructureFragmentCoords:function(f){f.setCoord2D({x:0,y:0});var c=f.getCurrConnectableObj();if(c){var h=Kekule.CoordUtils.substract({x:0,y:0},c.getCoord2D(true));f.beginUpdate();try{for(var d=0,b=f.getNodeCount();d<b;++d){var e=f.getNodeAt(d);var g=e.getCoord2D(true);g=Kekule.CoordUtils.add(g,h);e.setCoord2D(g)}}finally{f.endUpdate()}}}});Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText=function(f){var e=Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[];for(var c=0,b=e.length;c<b;++c){var d=e[c];if((d.getInputTexts()||[]).indexOf(f)>=0){return d}}return null};Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems=function(){return Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[]};Kekule.Editor.MolRingRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolRingRepositoryItem2D",initialize:function($super,c,b){$super();this.setRingAtomCount(c);this.setBondLength(b||1)},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT});this.defineProp("bondLength",{dataType:DataType.FLOAT,setter:function(b){if(b!==this.getBondLength()){this.setPropStoreFieldValue("bondLength",b)}}});this.defineProp("isAromatic",{dataType:DataType.BOOL});this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getEnableCoordCache()){this.setPropStoreFieldValue("enableCoordCache",b);if(b&&!this._coordCache){this._initCoordCache()}}}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(c,b){var d=b&&b.originalStructFragment;return this.generateRing(d)},doGetMergableNode:function(b,c){return b.getNodeAt(0)},doGetMergableConnector:function(b,c){return b.getConnectorAt(0)},generateRing:function(l,m){if(!m){m=Kekule.Molecule}var s;if(l){s=l}else{s=new m()}var t=this.getRingAtomCount();s.beginUpdate();try{s.setCoord2D({x:0,y:0});var k=s.getNodeCount();if(k>t){for(var p=k-1;p>=t;--p){s.removeNodeAt(p)}}var g=s.getConnectorCount();for(var p=g-1;p>=0;--p){s.removeConnectorAt(p)}var q=this.getEnableCoordCache();var h=q&&this._hasCoordCache(t);var c;if(!h){c=this._calcAtomCoords(t)}else{c=this._getCachedCoords(t)}var j=this.getBondLength();var n;var r;var d;for(var p=0;p<t;++p){var b=s.getNodeAt(p);if(!b){b=this._generateAtom(p);s.appendNode(b)}var e;var o=c[p];if(j!==1){o=Kekule.CoordUtils.multiply(o)}b.setCoord2D(o);if(p===0){d=b}if(n){var f=this._generateBond(r,p);s.appendConnector(f);f.appendConnectedObj(n);f.appendConnectedObj(b)}n=b;r=p}var f=this._generateBond(t-1,0);s.appendConnector(f);f.appendConnectedObj(n);f.appendConnectedObj(d)}finally{s.endUpdate()}return s},_generateAtom:function(b){return new Kekule.Atom(null,"C")},_generateBond:function(d,c){var b=Kekule.BondOrder.SINGLE;if(this.getIsAromatic()){if(d%2){b=Kekule.BondOrder.DOUBLE}}return new Kekule.Bond(null,null,b)},_calcAtomCoords:function(b){var d=1;var e=this.getEnableCoordCache();var o=Math.PI/b;var j=Math.sin(o);var c=2*o;var f=d/2/j;var n=((b===4)||(b===8))?-Math.PI/2-c/2:-Math.PI/2;var m=n;var p=[];for(var g=0;g<b;++g){var l=f*Math.cos(m);var k=f*Math.sin(m);var h={x:l,y:k};p.push(h);if(e){this._setCoordToCache(h,b,g)}m+=c}return p},_initCoordCache:function(){this._coordCache=[];for(var b=3;b<13;++b){this._calcAtomCoords(b)}},_clearCoordCache:function(){this._coordCache=[]},_setCoordToCache:function(e,d,c){var b=this._coordCache[d];if(!b){b=[];this._coordCache[d]=b}b[c]=e},_getCachedCoord:function(d,c){var b=this._coordCache[d];return b&&b[c]},_getCachedCoords:function(b){return this._coordCache[b]},_hasCoordCache:function(b){return !!(this._coordCache&&this._coordCache[b])}});Kekule.Editor.MolChainRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolChainRepositoryItem2D",STEP_X_INC:Math.cos(30/180*Math.PI),STEP_Y_INC:Math.sin(30/180*Math.PI),initialize:function($super,c,b){$super();this.setAtomCount(c);this.setBondLength(b||1)},initProperties:function(){this.defineProp("atomCount",{dataType:DataType.INT});this.defineProp("bondLength",{dataType:DataType.FLOAT});this.defineProp("negativeDirection",{dataType:DataType.BOOL});this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getEnableCoordCache()){this.setPropStoreFieldValue("enableCoordCache",b);if(b&&!this._coordCache){this._initCoordCache()}}}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(c,b){var d=b&&b.originalStructFragment;return this.generateChain(d)},doGetMergableNode:function(b,c){return b.getNodeAt(0)},doGetMergableConnector:function(b,c){return null},generateChain:function(m,b){if(!b){b=Kekule.Molecule}var g=m||new b();var c=this.getAtomCount();var d=this.getBondLength()||1;var q=this.getNegativeDirection();g.beginUpdate();try{g.setCoord2D({x:0,y:0});var j=g.getNodeCount();if(j>c){for(var h=j-1;h>=c;--h){g.removeNodeAt(h)}}var o=g.getConnectorCount();if(o>c-1){for(var h=o-1;h>=c-1;--h){g.removeConnectorAt(h)}}var f,p,r;for(var h=0,e=c;h<e;++h){f=p;var n=false;var p=g.getNodeAt(h);if(!p){p=this._generateAtom(h);n=true}var k=this._getCachedCoord(h);if(!k){k=this._calcAtomCoord(h)}if(d!==1){k=Kekule.CoordUtils.multiply(k,d)}if(q){k={x:k.x,y:-k.y}}p.setCoord2D(k);if(n){g.appendNode(p)}if(f&&n){r=this._generateBond(h-1,h);g.appendConnector(r);r.appendConnectedObj(f);r.appendConnectedObj(p)}}}finally{g.endUpdate()}this.setMolManipulationCenterCoord({x:0,y:0});this.setMolManipulationDefDirectionCoord({x:1,y:0});return g},_generateAtom:function(b){return new Kekule.Atom(null,"C")},_generateBond:function(d,c){var b=Kekule.BondOrder.SINGLE;return new Kekule.Bond(null,null,b)},_calcAtomSetCoords:function(b){var e=this.getEnableCoordCache();var d=1;var g={x:this.STEP_X_INC*d,y:this.STEP_Y_INC*d};var n=[];var c={x:0,y:0};n.push(c);this._coordCache[0]=c;var h,k,m;for(var j=1,f=b;j<f;++j){c={x:c.x+g.x,y:(j%2)?g.y:0};n.push(c);if(e){this._coordCache[j]=c}}return n},_calcAtomCoord:function(d){var e=1;var c={x:this.STEP_X_INC*e,y:this.STEP_Y_INC*e};var b={x:c.x*d,y:(d%2)?c.y:0};if(this._coordCache){this._coordCache[d]=b}return b},_initCoordCache:function(){this._coordCache=[];var b=this._calcAtomSetCoords(30)},_clearCoordCache:function(){this._coordCache=[]},_getCachedCoord:function(b){return this._coordCache&&this._coordCache[b]}});Kekule.Editor.PathGlyphRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.PathGlyphRepositoryItem2D",initialize:function($super,c,d,b){$super();this.setGlyphClass(c);this.setGlyphRefLength(d||1);this.setGlyphInitialParams(b)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT});this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:false});this.defineProp("glyphInitialParams",{dataType:DataType.HASH})},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},doGetRefLength:function(){return this.getGlyphRefLength()},createObjects:function(b){var c=this.generateGlyph();var d={x:0,y:0};return{objects:[c],mergeObj:null,mergeDest:null,baseObjCoord:d,centerCoord:d}},generateGlyph:function(){var b=this.getGlyphClass();var c=new b(null,this.getGlyphRefLength(),this.getGlyphInitialParams());return c}});Kekule.Editor.RepositoryItemManager={_itemClassMap:new Kekule.MapEx(true),_itemNameMap:new Kekule.MapEx(true),getAllItems:function(b){return a._itemClassMap.get(b)},getItem:function(b){return a._itemNameMap.get(b)},register:function(e){var d=e.getName();var f;if(d){f=a.getItem();a._itemNameMap.set(d,e)}var c=e.getClass();var b=a.getAllItems(c);if(!b){b=[e];a._itemClassMap.set(c,b)}else{if(f){Kekule.ArrayUtils.replace(b,f,e)}else{Kekule.ArrayUtils.pushUnique(b,e)}}},unregister:function(e){var c=e.getClass();var b=a.getAllItems(c);if(b){Kekule.ArrayUtils.remove(b,e)}var d=e.getName();if(d){a._itemNameMap.remove(d)}}};var a=Kekule.Editor.RepositoryItemManager;Kekule._registerAfterLoadSysProc(function(){if(Kekule.Editor.RepositoryData){var f=Kekule.Editor.RepositoryData.subGroups||[];for(var c=0,b=f.length;c<b;++c){var d=f[c];var e=new Kekule.Editor.StoredSubgroupRepositoryItem2D(d.structData,d.dataFormat,d.scale);e.setInputTexts(d.inputTexts).setName(d.name||d.inputTexts[0]);a.register(e)}var f=Kekule.Editor.RepositoryData.fragments||[];for(var c=0,b=f.length;c<b;++c){var d=f[c];var e=new Kekule.Editor.StoredStructFragmentRepositoryItem2D(d.structData,d.dataFormat,d.scale);e.setName(d.name);a.register(e)}}})})();(function(){var a=Kekule.ArrayUtils;var b=Kekule.Widget.HtmlClassNames;var c=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{STRUCTURE_NODE_SELECT_PANEL:"K-Chem-StructureNodeSelectPanel",STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureNodeSelectPanel-SetButton",STRUCTURE_NODE_SETTER:"K-Chem-StructureNodeSetter",STRUCTURE_NODE_SETTER_INPUTBOX:"K-Chem-StructureNodeSetter-InputBox",STRUCTURE_CONNECTOR_SELECT_PANEL:"K-Chem-StructureConnectorSelectPanel",STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureConnectorSelectPanel-SetButton",CHARGE_SELECT_PANEL:"K-Chem-Charge-SelectPanel",CHARGE_SELECT_PANEL_BTNGROUP:"K-Chem-Charge-SelectPanel-BtnGroup",CHARGE_SELECT_PANEL_CHARGE_BTN:"K-Chem-Charge-SelectPanel-ChargeBtn"});Kekule.ChemWidget.StructureNodeSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSelectPanel",BTN_DATA_FIELD:"__$btn_data__",initialize:function($super,d){this.setPropStoreFieldValue("displayElements",true);this.setPropStoreFieldValue("displayNonElements",true);this.setPropStoreFieldValue("displaySubgroups",true);$super(d);this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("elementSymbols",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC});this.defineProp("nonElementInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC});this.defineProp("subGroupInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC});this.defineProp("subGroupRepItems",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(d){this.setPropStoreFieldValue("subGroupRepItems",d);this._updateSubGroupInfosFromRepItems(d)}});this.defineProp("displayElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED});this.defineProp("displayNonElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED});this.defineProp("displaySubgroups",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED});this.defineProp("activeNode",{dataType:DataType.ARRAY,serializable:false,setter:function(d){this.setPropStoreFieldValue("activeNode",d);this.activeNodeChanged(d)}});this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PRIVATE,serializable:false,setter:null,getter:function(g){var e=this.getPropStoreFieldValue("periodicTableDialog");if(!e&&g){var d=this.getCoreElement();var f=this.getDocument();e=this._createPeriodicTableDialogWidget(f,d);this.setPropStoreFieldValue("periodicTableDialog",e)}return e}})},initPropValues:function($super){return $super()},doFinalize:function($super){var d=this.getPeriodicTableDialog();if(d){d.finalize()}$super()},setSelectableInfos:function(d){this.beginUpdate();try{this.setPropValues(d)}finally{this.endUpdate()}},reactSelButtonExec:function(h){var d=this;var f=h.target;if(this._selButtons.indexOf(f)>=0){var g=f[this.BTN_DATA_FIELD];if(g){if(g.isPeriodicTable){this._openPeriodicTableDialog(f,function(e){if(e===Kekule.Widget.DialogButtons.OK){var i=d._periodicTable.getSelectedSymbol();d.notifyValueChange(d.generateSelectableDataFromElementSymbol(i))}},{isSimpleAtom:true})}else{if(g.isVarList||g.isVarNotList){this._openPeriodicTableDialog(f,function(e){if(e===Kekule.Widget.DialogButtons.OK){var j=d._periodicTable.getSelectedSymbols();var i=Kekule.VariableAtom;var k=g.isVarList?{allowedIsotopeIds:j,disallowedIsotopeIds:null}:{allowedIsotopeIds:null,disallowedIsotopeIds:j};d.notifyValueChange({nodeClass:i,props:k})}},{isVarList:g.isVarList,isVarNotList:g.isVarNotList})}else{this.notifyValueChange(g)}}}}},notifyValueChange:function(d){this.invokeEvent("valueChange",{value:{nodeClass:d.nodeClass,props:d.props,repositoryItem:d.repositoryItem}})},activeNodeChanged:function(d){},doObjectChange:function(d){var e=["elementSymbols","nonElementInfos","subGroupInfos","displayElements","displayNonElements","displaySubGroups"];if(Kekule.ArrayUtils.intersect(d,e).length){this.updatePanelContent(this.getDocument(),this.getCoreElement())}},doGetWidgetClassName:function($super){return $super()+" "+c.STRUCTURE_NODE_SELECT_PANEL},doCreateRootElement:function(e){var d=e.createElement("span");return d},doCreateSubElements:function($super,f,e){var d=$super(f,e);this.updatePanelContent(f,e);return d},_updateSubGroupInfosFromRepItems:function(d){var n=[];if(d&&d.length){for(var j=0,g=d.length;j<g;++j){var h=d[j];var m=h.getStructureFragment();var o=m.getAbbr();if(!o){var p=m.getFormulaText();var k=Kekule.FormulaUtils.textToFormula(p);var e=k.getDisplayRichText();o=Kekule.Render.RichTextUtils._toDebugHtml(e)}var f={text:o,repositoryItem:h,nodeClass:m.getClass(),node:m,hint:h.getName()};n.push(f)}this.setSubGroupInfos(n)}},updatePanelContent:function(m,g){if(this._selButtons){for(var j=this._selButtons.length-1;j>=0;--j){var e=this._selButtons[j];this.removeWidget(e)}}this._selButtons=[];Kekule.DomUtils.clearChildContent(g);var d=this.generateSelectableData();var h=this._getDisplayedTabPageNames();var f=new Kekule.Widget.TabView(this);if(h.indexOf("atom")>=0){var n=f.createNewTabPage(Kekule.$L("ChemWidgetTexts.CAPTION_ATOM"));if(this.getDisplayElements()){var l=this.doCreateSelButtonSection(m,n.getCoreElement(),d.elementData)}if(this.getDisplayNonElements()){var l=this.doCreateSelButtonSection(m,n.getCoreElement(),d.nonElementData,true)}}if(h.indexOf("subgroup")>=0){var k=f.createNewTabPage(Kekule.$L("ChemWidgetTexts.CAPTION_SUBGROUP"));var l=this.doCreateSelButtonSection(m,k.getCoreElement(),d.subGroupData,true)}f.setShowTabButtons(h.length>1)},_getDisplayedTabPageNames:function(){var d=[];if(this.getDisplayElements()||this.getDisplayNonElements()){d.push("atom")}if(this.getDisplaySubgroups()){d.push("subgroup")}return d},generateSelectableDataFromElementSymbol:function(f){var d=f;var e=Kekule.IsotopesDataUtil.getIsotopeInfoById(f);if(e){if(e.isotopeAlias){d=e.isotopeAlias}else{d="<sup>"+e.massNumber+"</sup>"+e.elementSymbol}}return{text:d,nodeClass:Kekule.Atom,props:{isotopeId:f}}},generateSelectableData:function(){var g=this.getElementSymbols()||[];var j=[];for(var h=0,f=g.length;h<f;++h){var k;if(g[h]==="..."){k={text:"\u2026",nodeClass:null,hint:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE"),isPeriodicTable:true}}else{k=this.generateSelectableDataFromElementSymbol(g[h])}j.push(k)}var e=this.getNonElementInfos();var d=this.getSubGroupInfos();return{elementData:j,nonElementData:e,subGroupData:d}},doCreateSelButton:function(j,e,h,g){var f=h.text;if(g&&h.description){f+='<span style="font-size:80%"> '+h.description+"</span>"}var i=Kekule.Widget.Button;var d=new i(j,f);d.addClassName(c.STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON);if(d.setGroup){d.setGroup(this.getClassName())}if(h.hint){d.setHint(h.hint)}d[this.BTN_DATA_FIELD]=h;this._selButtons.push(d);return d},doCreateSectionSelButtons:function(k,h,j,e){if(!j){return}for(var g=0,d=j.length;g<d;++g){var f=this.doCreateSelButton(k,h,j[g],e);f.setParent(this);f.appendToElem(h)}},doCreateSection:function(f,e){var d=f.createElement("div");d.className=b.SECTION;if(e){e.appendChild(d)}return d},doCreateSelButtonSection:function(h,d,f,e){var g=this.doCreateSection(h,d);this.doCreateSectionSelButtons(h,g,f,e);return g},_createPeriodicTableDialogWidget:function(g,d){var e=new Kekule.Widget.Dialog(g,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);var f=new Kekule.ChemWidget.PeriodicTable(g);f.setUseMiniMode(true).setEnableSelect(true);f.setParent(e);f.appendToElem(e.getClientElem());this._periodicTable=f;return e},_openPeriodicTableDialog:function(d,k,h){var f=this.getPeriodicTableDialog(true);var e=h.isVarList||h.isVarNotList;this._periodicTable.setEnableMultiSelect(e).setSelectedSymbol(null);var g=this.getActiveNode();if((h.isVarList||h.isVarNotList)&&g instanceof Kekule.VariableAtom){var i=g.getAllowedIsotopeIds();var j=g.getDisallowedIsotopeIds();this._periodicTable.setSelectedSymbols(h.isVarList?i:j)}if(!e&&g instanceof Kekule.Atom){this._periodicTable.setSelectedSymbol(g.getSymbol())}f.openPopup(k,this||d)}});Kekule.ChemWidget.StructureNodeSetter=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSetter",initialize:function($super,d){$super(d);this._valueSetBySelectPanel=false},initProperties:function(){this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:false,setter:function(e){var d=Kekule.ArrayUtils.toArray(e);this.setPropStoreFieldValue("nodes",d);this.nodesChanged(d)}});this.defineProp("value",{dataType:DataType.HASH,serializable:false,setter:null,getter:function(){var d=this.getPropStoreFieldValue("value");if(!d&&!this._valueSetBySelectPanel){var e=this.getNodeInputBox().getValue();d=this._getValueFromDirectInputText(e)}return d}});this.defineProp("nodeLabel",{dataType:DataType.STRING,serializable:false,setter:null,getter:function(){return this.getNodeInputBox().getValue()}});this.defineProp("nodeInputBox",{dataType:"Kekule.Widget.ButtonTextBox",serializable:false,setter:false});this.defineProp("nodeSelectPanel",{dataType:"Kekule.ChemWidget.StructureNodeSelectPanel",serializable:false,setter:false});this.defineProp("showInputBox",{dataType:DataType.BOOL,getter:function(){return this.getNodeInputBox().getDisplayed()},setter:function(d){this.getNodeInputBox().setDisplayed(d)}});this.defineProp("showSelectPanel",{dataType:DataType.BOOL,getter:function(){return this.getNodeSelectPanel().getDisplayed()},setter:function(d){this.getNodeSelectPanel().setDisplayed(d)}});this.defineProp("useDropDownSelectPanel",{dataType:DataType.BOOL,setter:function(d){if(this.getUseDropDownSelectPanel()!==d){this.setPropStoreFieldValue("useDropDownSelectPanel",d);this._updateDropDownSettings(d)}}});this.defineProp("labelConfigs",{dataType:DataType.OBJECT,serializable:false});this._defineSelectPanelDelegatedProp("selectableElementSymbols","elementSymbols");this._defineSelectPanelDelegatedProp("selectableNonElementInfos","nonElementInfos");this._defineSelectPanelDelegatedProp("selectableSubGroupInfos","subGroupInfos");this._defineSelectPanelDelegatedProp("selectableSubGroupRepItems","subGroupRepItems");this._defineSelectPanelDelegatedProp("displaySelectableElements","displayElements");this._defineSelectPanelDelegatedProp("displaySelectableNonElements","displayNonElements");this._defineSelectPanelDelegatedProp("displaySelectableSubgroups","displaySubgroups")},initPropValues:function($super){$super()},doFinalize:function($super){var d=this.getNodeSelectPanel();d.finalize();$super()},_defineSelectPanelDelegatedProp:function(g,d){if(!d){d=g}var e=ClassEx.getPropInfo(Kekule.ChemWidget.StructureNodeSelectPanel,d);var f=Object.create(e);f.getter=null;f.setter=null;if(e.getter){f.getter=function(){return this.getNodeSelectPanel().getPropValue(d)}}if(e.setter){f.setter=function(h){this.getNodeSelectPanel().setPropValue(d,h)}}return this.defineProp(g,f)},doGetWidgetClassName:function($super){return $super()+" "+c.STRUCTURE_NODE_SETTER},doCreateRootElement:function(e){var d=e.createElement("span");return d},doCreateSubElements:function($super,i,g){var d=$super(i,g);var f=this;var h=new Kekule.Widget.ButtonTextBox(this);this.setPropStoreFieldValue("nodeInputBox",h);h.addClassName(c.STRUCTURE_NODE_SETTER_INPUTBOX);h.appendToElem(this.getCoreElement());h.addEventListener("valueChange",function(j){f._valueSetBySelectPanel=false;j.stopPropagation()});h.addEventListener("keyup",function(l){var j=l.htmlEvent;var k=j.getKeyCode();if(k===Kekule.X.Event.KeyCode.ENTER){f._applyDirectInput()}if(f.getUseDropDownSelectPanel()){if(k===Kekule.X.Event.KeyCode.DOWN){f.showNodeSelectPanel()}else{if(k===Kekule.X.Event.KeyCode.UP){f.hideNodeSelectPanel()}}}});h.addEventListener("blur",function(j){if(j.target===h.getTextBox()&&h.getIsDirty()){f._applyDirectInput()}});h.getButton().addEventListener("execute",function(j){if(f.getUseDropDownSelectPanel()){f.toggleNodeSelectPanel()}else{f._applyDirectInput()}});var e=new Kekule.ChemWidget.StructureNodeSelectPanel(this);this.setPropStoreFieldValue("nodeSelectPanel",e);e.appendToElem(this.getCoreElement());e.addEventListener("valueChange",function(k){var j=Object.extend({},k);k.stopPropagation();f._valueSetBySelectPanel=true;f.notifyValueChange(k.value,true);if(f.getUseDropDownSelectPanel()){e.hide()}});this._updateDropDownSettings(this.getUseDropDownSelectPanel());return d},_updateDropDownSettings:function(d){var e=this.getNodeInputBox();var f=this.getNodeSelectPanel();if(d){e.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);f.removeFromDom()}else{e.setButtonKind(Kekule.Widget.Button.Kinds.ENTER);f.appendToElem(this.getCoreElement());f.setStyleProperty("position","");f.show(null,null,Kekule.Widget.ShowHideType.DEFAULT)}},_indexOfNonElementLabel:function(h){var g=this.getNonAtomLabelInfos();for(var e=0,d=g.length;e<d;++e){var f=g[e];if(f.nodeLabel===h){return e}}return -1},_getNonAtomInfo:function(h){var g=this.getSelectableNonElementInfos();if(g){for(var e=0,d=g.length;e<d;++e){var f=g[e];if(f.text===h){return f}}}return null},_getValueFromDirectInputText:function(l){var d,i,j,g,e;var k=this._getNonAtomInfo(l);if(k){d=k.nodeClass;i=k.props}else{var f=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(l);g=f;if(f){j=f.getStructureFragment();d=j.getClass()}else{if(l){d=Kekule.ChemStructureNodeFactory.getClassByLabel(l,null);if(!d){d=Kekule.Pseudoatom;e=true}i=(d===Kekule.Atom)?{isotopeId:l}:(d===Kekule.Pseudoatom)?{symbol:l}:{}}}}var h={nodeClass:d,props:i,repositoryItem:g,isUnknownPseudoatom:e};return h},_applyDirectInput:function(){this._valueSetBySelectPanel=false;var d=this.getNodeInputBox();var f=d.getValue();var e=this._getValueFromDirectInputText(f);this.notifyValueChange(e);d.setIsDirty(false)},_getVarAtomListLabel:function(){var d=this.getLabelConfigs();return d?d.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var d=this.getLabelConfigs();return"~"+(d?d.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM)},_getAllNodeLabels:function(d){return Kekule.Editor.StructureUtils.getAllChemStructureNodesLabel(d,this.getLabelConfigs())},nodesChanged:function(d){var f=this._getAllNodeLabels(d)||"";var e=f?d[0]:null;this.getNodeSelectPanel().setActiveNode(e);this.getNodeInputBox().setValue(f);this.getNodeInputBox().setIsDirty(false);this.setPropStoreFieldValue("value",null);this._valueSetBySelectPanel=false},notifyValueChange:function(e,d){this.setPropStoreFieldValue("value",e);var f={nodeClass:e.nodeClass,props:e.props,repositoryItem:e.repositoryItem,isUnknownPseudoatom:e.isUnknownPseudoatom};if(d){this.invokeEvent("valueSelect",{value:f})}this.invokeEvent("valueChange",{value:f})},setSelectableInfos:function(d){this.getNodeSelectPanel().setSelectableInfos(d)},showNodeSelectPanel:function(){var d=this.getNodeSelectPanel();if(!d.isShown()){d.show(this.getNodeInputBox(),null,Kekule.Widget.ShowHideType.DROPDOWN)}},hideNodeSelectPanel:function(){var d=this.getNodeSelectPanel();if(d.isShown()){d.hide()}},toggleNodeSelectPanel:function(){var d=this.getNodeSelectPanel();if(d.isShown()){d.hide()}else{d.show(this.getNodeInputBox(),null,Kekule.Widget.ShowHideType.DROPDOWN)}}});Kekule.ChemWidget.StructureConnectorSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureConnectorSelectPanel",BTN_DATA_FIELD:"__$btn_data__",BTN_GROUP:"__$bond_btn_group__",initialize:function($super,d){$super(d);this._selButtons=[];this._activeBtn=null;this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("bondData",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC});this.defineProp("activeBondPropValues",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC,setter:function(d){this.setPropStoreFieldValue("activeBondPropValues",d);this.activeBondPropsChanged(d)}});this.defineProp("activeBondHtmlClass",{dataType:DataType.STRING,scope:Class.PropertyScope.PRIVATE,setter:null,getter:function(){var d=this._activeBtn;if(d){var e=d[this.BTN_DATA_FIELD];return e&&e.htmlClass}return null}});this.defineProp("bondPropNames",{dataType:DataType.ARRAY,serializable:false})},doObjectChange:function(d){var e=["bondData"];if(Kekule.ArrayUtils.intersect(d,e).length){this.updatePanelContent(this.getDocument(),this.getCoreElement())}},doGetWidgetClassName:function($super){return $super()+" "+c.STRUCTURE_CONNECTOR_SELECT_PANEL},doCreateRootElement:function(e){var d=e.createElement("span");return d},doCreateSubElements:function($super,f,e){var d=$super(f,e);this.updatePanelContent(f,e);return d},activeBondPropsChanged:function(h){if(this._activeBtn){this._activeBtn.setChecked(false);this._activeBtn=null}if(h){var f=this._selButtons;for(var e=0,d=f.length;e<d;++e){var g=f[e][this.BTN_DATA_FIELD];if(g&&this._isBondPropsMatch(h,g.bondProps,this.getBondPropNames())){f[e].setChecked(true);this._activeBtn=f[e];break}}}},_isBondPropsMatch:function(e,d,f){return Kekule.Editor.StructureUtils.isBondPropsMatch(e,d,f)},reactSelButtonExec:function(h){var d=this;var f=h.target;if(this._selButtons.indexOf(f)>=0){this._activeBtn=f;var g=f[this.BTN_DATA_FIELD];if(g){this.setPropStoreFieldValue("activeBondPropValues",g.bondProps);this.notifyValueChange(g.bondProps)}}},notifyValueChange:function(d){this.invokeEvent("valueChange",{value:d})},updatePanelContent:function(m,e){if(this._selButtons){for(var j=this._selButtons.length-1;j>=0;--j){var d=this._selButtons[j];this.removeWidget(d)}}var n=[];this._selButtons=[];var g=this.getBondData();if(g){for(var j=0,f=g.length;j<f;++j){var h=g[j];var k=h.bondProps;var d=this._createBondSelButton(m,h);d.appendToElem(e);this._selButtons.push(d);if(k){a.pushUnique(n,Kekule.ObjUtils.getOwnedFieldNames(k))}}}if(!this.getBondPropNames()){this.setPropStoreFieldValue("bondPropNames",n)}},_createBondSelButton:function(f,e){var d=new Kekule.Widget.RadioButton(this);d.addClassName(c.STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON);d.setGroup(this.BTN_GROUP).setShowGlyph(true).setShowText(false);d.setText(e.text||null).setHint(e.hint||e.description||null);if(e.htmlClass){d.addClassName(e.htmlClass)}d[this.BTN_DATA_FIELD]=e;return d}});Kekule.ChemWidget.ChargeSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.ChargeSelectPanel",CHARGE_FIELD:"__$charge__",initialize:function($super,d){this._chargeBtnGroups={};this._selectedButton=null;this._chargeButtonMap=[];$super(d);this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(g){var e=this.getValue();if(g!==e){var d=this._chargeButtonMap[e];if(d){d.setChecked(false);d.blur()}this.setPropStoreFieldValue("value",g);var f=this._chargeButtonMap[g];if(f){f.setChecked(true)}this._selectedButton=f}}});this.defineProp("minCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC});this.defineProp("maxCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC})},initPropValues:function($super){$super();this.setMaxCharge(4).setMinCharge(-4)},doGetWidgetClassName:function($super){return $super()+" "+c.CHARGE_SELECT_PANEL},doCreateSubElements:function($super,f,e){var d=$super(f,e);this.updateChargeButtons(f,e);return d},updateChargeButtons:function(n,f){var g=this._chargeBtnGroups;var q=["zero","positive","negative"];for(var j=0,h=q.length;j<h;++j){var p=g[q[j]];if(p){p.clearWidgets()}else{p=new Kekule.Widget.ButtonGroup(this);p.addClassName(c.CHARGE_SELECT_PANEL_BTNGROUP);p.appendToElem(f);g[q[j]]=p}}var e=Math.floor(this.getMaxCharge());var m=Math.floor(this.getMinCharge());var d;var o=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE");var k=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE");if(e>=1){var p=this._chargeBtnGroups.positive;for(var j=Math.max(m,1);j<=e;++j){d=this._createChargeButton(p,j,j+o)}}if(e>=0&&m<=0){var p=this._chargeBtnGroups.zero;d=this._createChargeButton(p,0,Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NONE"),Kekule.$L("ChemWidgetTexts.HINT_CHARGE_NONE"))}if(m<=-1){var p=this._chargeBtnGroups.negative;for(var j=Math.min(e,-1);j>=m;--j){d=this._createChargeButton(p,j,Math.abs(j)+k)}}},_createChargeButton:function(h,e,g,f){var d=new Kekule.Widget.RadioButton(h,g);d[this.CHARGE_FIELD]=e;this._chargeButtonMap[e]=d;if(f){d.setHint(f)}d.addClassName(c.CHARGE_SELECT_PANEL_CHARGE_BTN);d.appendToWidget(h);if(this.getValue()===e){d.setChecked(true);this._selectedButton=d}return d},reactSelButtonExec:function(g){var f=g.target;var d=f[this.CHARGE_FIELD];if(Kekule.ObjUtils.notUnset(d)){this.setValue(d);this.notifyValueChange(d)}},notifyValueChange:function(d){this.invokeEvent("valueChange",{value:d})}})})();(function(){var a=Kekule.ArrayUtils;var b=Kekule.CoordUtils;var d=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMSPACE_EDITOR:"K-Chem-Space-Editor",CHEMSPACE_EDITOR2D:"K-Chem-Space-Editor2D",CHEMSPACE_EDITOR3D:"K-Chem-Space-Editor3D",CHEMEDITOR_ATOM_SETTER:"K-ChemEditor-Atom-Setter",CHEMEDITOR_TEXT_SETTER:"K-ChemEditor-Text-Setter",CHEMEDITOR_FORMULA_SETTER:"K-ChemEditor-Formula-Setter"});Kekule.Editor.ChemSpaceEditor=Class.create(Kekule.Editor.BaseEditor,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor",initialize:function($super,e,h,g,f){this.setPropStoreFieldValue("allowCreateNewChild",true);this.setPropStoreFieldValue("autoCreateNewStructFragment",true);$super(e,h,g,f);this._containerChemSpace=null},initProperties:function(){this.defineProp("chemSpace",{dataType:"Kekule.ChemSpace",serializable:false,getter:function(){return this.getChemObj()},setter:function(e){this.setChemObj(e)}});this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("autoCreateNewStructFragment")&&this.canCreateNewChild()}});this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL})},canCreateNewChild:function(){return this.getChemSpace()&&(this.getAllowCreateNewChild()||(this.getChemSpace().getChildCount()<=0))},getActualDrawOptions:function($super){var e=$super();e.useExplicitSpaceSize=true;return e},doSetChemObj:function($super,g){var e=this.getChemObj();if(e!==g){if(e&&this._containerChemSpace){e.finalize();this._containerChemSpace=null}if(g){if(g instanceof Kekule.ChemSpace){this._initChemSpaceDefProps(g);return $super(g)}else{var f=this.createContainerChemSpace(null,g);this._containerChemSpace=f;$super(f)}}else{$super(g)}}else{$super(g)}},getExportableClasses:function($super){var e=$super();var h=this.getChemSpace();if(h){for(var g=0,f=h.getChildCount();g<f;++g){var j=h.getChildAt(g);if(j&&j.getClass){Kekule.ArrayUtils.pushUnique(e,j.getClass())}}}return e},exportObjs:function($super,g){var e=$super(g);if((!e||!e.length)&&g){e=[];var j=this.getChemSpace();if(j){for(var h=0,f=j.getChildCount();h<f;++h){var k=j.getChildAt(h);if(k&&(k instanceof g)){e.push(k)}}}}return e},getSavingTargetObj:function($super){var f=this.getChemSpace();var e=f.getChildCount();if(e===1){return f.getChildAt(0)}else{return $super()}},createDefaultConfigs:function(){return Kekule.Editor.ChemSpaceEditorConfigs.getInstance()},doCreateNewDocObj:function(){return this.createContainerChemSpace()},doLoad:function($super,e){this._supplyChemMarkersOnObj(e);$super(e)},doLoadEnd:function($super,i){var e=$super(i);var g=null;if(i){var f=i.getAllContainingConnectors();if(f&&f.length){var h=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;g=Kekule.ChemStructureUtils.getConnectorLengthMedian(f,h,this.getAllowCoordBorrow())}}this.setDefBondLength(g);return e},resetDisplay:function($super){$super();var h=this.getChemObj();if(h){var f=h.getScreenSize();this.changeClientSize(f.x,f.y,this.getCurrZoom());var g=this.getEditClientElem().parentNode;var e=Kekule.HtmlElementUtils.getElemClientDimension(g);this.scrollClientTo(0,(f.x*this.getCurrZoom()-e.width)/2)}},zoomChanged:function($super,g){$super();var f=this.getChemObj();if(f){var e=f.getScreenSize();this.changeClientSize(e.x,e.y,g)}},createNewBoundInfoRecorder:function($super,f){$super(f);var e=this.getBoundInfoRecorder();if(e){e.addEventListener("updateBasicDrawObject",this.reactUpdateBasicDrawObject,this)}},reactUpdateBasicDrawObject:function(h){var g=h.obj;if(g&&(g instanceof Kekule.TextBlock)){var f=h.boundInfo;this.updateTextBlockSize(g,f)}},objectChanged:function($super,f,e){return $super(f,e)},updateTextBlockSize:function(f,g){if(this.getCoordMode()!==Kekule.CoordMode.COORD2D){return}if(!f.getNeedRecalcSize()){return}var e=g.shapeType;if(e===Kekule.Render.BoundShapeType.RECT){}},createContainerChemSpace:function(e,h){var p=new Kekule.ChemDocument(e);this._initChemSpaceDefProps(p,h);if(h){p.appendChild(h);var g=p.getSizeOfMode(this.getCoordMode(),this.getAllowCoordBorrow());var k,l;var i=Kekule.Render.ObjUtils.getContainerBox(h,this.getCoordMode(),this.getAllowCoordBorrow());if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var n=this.getEditorConfigs().getChemSpaceConfigs().getDefPadding();var l=p.getObjScreenLengthRatio()}var j=h.getAbsBaseCoord?h.getAbsBaseCoord(this.getCoordMode(),this.getAllowCoordBorrow())||{}:{};if(l&&i){k=Kekule.CoordUtils.divide(g,2);var f={x:(i.x1+i.x2)/2,y:(i.y1+i.y2)/2};var o={x:k.x,y:g.y-n*l-(i.y2-i.y1)/2};var m=Kekule.CoordUtils.substract(o,f);k=Kekule.CoordUtils.add(j,m)}else{k=Kekule.CoordUtils.divide(g,2)}if(h.setAbsBaseCoord){h.setAbsBaseCoord(k,this.getCoordMode())}}return p},_initChemSpaceDefProps:function(h,i){var j=this.getEditorConfigs();var e=j.getChemSpaceConfigs();if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var f=h.getScreenSize();if(!f.x&&!f.y){f=e.getDefScreenSize2D();h.setScreenSize(f)}if(!h.getDefAutoScaleRefLength()){var m;if(i&&i.getAllAutoScaleRefLengths){var g=i.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow());m=g&&g.length?Kekule.ArrayUtils.getMedian(g):null}else{var g=h.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow());m=g.length?Kekule.ArrayUtils.getMedian(g):null}if(!m){m=j.getStructureConfigs().getDefBondLength()}h.setDefAutoScaleRefLength(m)}if(!h.getSize2D()){var l=this.getRenderConfigs().getLengthConfigs().getDefBondLength();var k=h.getDefAutoScaleRefLength()/l;h.setObjScreenLengthRatio(k);h.setSize2D({x:f.x*k,y:f.y*k})}}},createNewStructFragmentAnchor:function(f){if(this.getAutoCreateNewStructFragment()){var e=new Kekule.Molecule(f);this.getChemSpace().appendChild(e);return e}else{return null}},createStructStartingAtom:function(g,i,e,f){this.beginUpdateObject();try{if(g){if(!f){f=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId()}var h=new Kekule.Atom(null,f);g.appendNode(h);h.setAbsCoordOfMode(e,this.getCoordMode());return h}else{return null}}finally{this.endUpdateObject()}},createNewStructFragmentAndStartingAtom:function(h,e,f){this.beginUpdateObject();try{var g;g=this.createNewStructFragmentAnchor(h);if(g){return this.createStructStartingAtom(g,h,e,f)}else{return null}}finally{this.endUpdateObject()}},hasOnlyOneBlankStructFragment:function(){var e=false;if(this.getChemSpace().getChildCount()===1){var f=this.getChemSpace().getChildAt(0);if(f instanceof Kekule.StructureFragment){if(f.getNodeCount()<=0&&f.getConnectorCount()<=0&&!f.hasFormula()){e=true}}}return e},getOnlyOneBlankStructFragment:function(){if(this.hasOnlyOneBlankStructFragment()){return this.getChemSpace().getChildAt(0)}},canAddNewStandaloneObject:function(){return this.getAllowCreateNewChild()||(this.getChemSpace().getChildCount()<=0)},canAddUnconnectedStructFragment:function(){return this.canAddNewStandaloneObject()||this.hasOnlyOneBlankStructFragment()},canCloneObjects:function(){return this.getAllowCreateNewChild()},cloneObjects:function(e,f,m){if(!this.getChemSpace()){return null}var u=this.getAllowCreateNewChild();var q=function(F,E){for(var D=0,C=E.length;D<C;++D){var G=E[D];if((G.isChildOf(F))){return true}}return false};var p=function(F,E,C){if(C.indexOf(E)>=0){a.remove(C,E);return}if(F.getChildAt&&E.getChildAt){var l=E.getChildCount();for(var D=l-1;D>=0;--D){var H=F.getChildAt(D);if(!C.length){F.removeChild(H);continue}var G=E.getChildAt(D);if(C.indexOf(G)>=0){a.remove(C,G)}else{if(q(G,C)){if(G.getChildObjs){p(H,G,C)}}else{F.removeChild(H)}}}}};var z=Kekule.ArrayUtils.toArray(e);var A=[];var r=new Kekule.MapEx();for(var v=0,t=z.length;v<t;++v){var o=z[v];var B=o.getStandaloneAncestor?o.getStandaloneAncestor():o;if(B.clone){Kekule.ArrayUtils.pushUnique(A,B);var n=r.get(B);if(!n){n=[];r.set(B,n)}n.push(o)}}var x=this.getChemSpace();var j=[];var w=this.getCoordMode();var y=this.getAllowCoordBorrow();var g=A.length;for(var v=0;v<g;++v){var o=A[v];var h=o.clone();if(h.clearIds){h.clearIds()}p(h,o,r.get(o));if(m&&u){x.appendChild(h);if(f){var s=this.getObjectScreenCoord(h);var k=Kekule.CoordUtils.add(s,f);this.setObjectScreenCoord(h,k)}}j.push(h)}r.finalize();return j},cloneSelection:function(g,f){if(g===undefined){g=this.getDefaultCloneScreenCoordOffset()}var h=this.getSelection();var e=this.cloneObjects(h,g,f);if(f){this.setSelection(e)}return e},getDefaultCloneScreenCoordOffset:function(){var g=this.getEditorConfigs().getInteractionConfigs().getClonedObjectScreenOffset()||0;var e=this.getCoordMode();var f={x:g,y:g};if(e===Kekule.CoordMode.COORD3D){f.z=g}return f},_supplyChemMarkersOnObj:function(h){if(h){var g=Kekule.ChemStructureUtils.getAllStructFragments(h,true);if(g||g.length){for(var f=0,e=g.length;f<e;++f){this._createLosingChemMarkerOnStructFragment(g[f])}}}},_createLosingChemMarkerOnStructFragment:function(j){j.beginUpdate();try{if(j.getCharge&&j.getCharge()){j.fetchChargeMarker(true)}var f=j.getNodes();for(var g=0,e=j.getNodeCount();g<e;++g){var h=j.getNodeAt(g);h.beginUpdate();try{if(h.getCharge()){h.fetchChargeMarker(true)}if(h.getRadical()){h.fetchRadicalMarker(true)}if(h.getNodeAt){this._createLosingChemMarkerOnStructFragment(h)}}finally{h.endUpdate()}}}finally{j.endUpdate()}},getEnabledNonAtomInputData:function(){var e=[];var g=this.getRenderConfigs().getDisplayLabelConfigs();var f=this.getEditorConfigs().getStructureConfigs().getEnabledNonAtomNodeTypes();if(f.RGroup){e.push({text:g.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")})}if(f.pseudoatomDummy){e.push({text:g.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")})}if(f.pseudoatomHetero){e.push({text:g.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")})}if(f.pseudoatomAny){e.push({text:g.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")})}if(f.variableAtomList){e.push({text:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,isVarList:true,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")})}if(f.variableAtomNotList){e.push({text:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,isNotVarList:true,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")})}return e},_getVarAtomListLabel:function(){var e=this.getRenderConfigs().getDisplayLabelConfigs();return e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var e=this.getRenderConfigs().getDisplayLabelConfigs();return"~"+(e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM)},getEnabledBondFormData:function(){var h=Kekule.BondType;var n=Kekule.BondOrder;var k=Kekule.BondStereo;var f=Kekule.$L;var e="K-Chem-MolBondIaController-";var m={single:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),htmlClass:e+"Single",isDefault:true,bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.NONE}},"double":{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),htmlClass:e+"Double",bondProps:{bondType:h.COVALENT,bondOrder:n.DOUBLE,stereo:k.NONE}},triple:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),htmlClass:e+"Triple",bondProps:{bondType:h.COVALENT,bondOrder:n.TRIPLE,stereo:k.NONE}},quad:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_QUAD"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_QUAD"),htmlClass:e+"Quad",bondProps:{bondType:h.COVALENT,bondOrder:n.QUAD,stereo:k.NONE}},explicitAromatic:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_EXPLICIT_AROMATIC"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_EXPLICIT_AROMATIC"),htmlClass:e+"Aromatic",bondProps:{bondType:h.COVALENT,bondOrder:n.EXPLICIT_AROMATIC,stereo:k.NONE}},up:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),htmlClass:e+"WedgeUp",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.UP}},upInverted:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP_INVERTED"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP_INVERTED"),htmlClass:e+"WedgeUpInverted",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.UP_INVERTED}},down:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),htmlClass:e+"WedgeDown",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.DOWN}},downInverted:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN_INVERTED"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN_INVERTED"),htmlClass:e+"WedgeDownInverted",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.DOWN_INVERTED}},upOrDown:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),htmlClass:e+"WedgeUpOrDown",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.UP_OR_DOWN}},closer:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),htmlClass:e+"Closer",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.CLOSER}},eOrZ:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),htmlClass:e+"Double-Either",bondProps:{bondType:h.COVALENT,bondOrder:n.DOUBLE,stereo:k.E_OR_Z}},ionic:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_IONIC"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_IONIC"),htmlClass:e+"Ionic",bondProps:{bondType:h.IONIC}},coordinate:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_COORDINATE"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_COORDINATE"),htmlClass:e+"Coordinate",bondProps:{bondType:h.COORDINATE}},metallic:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_METALLIC"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_METALLIC"),htmlClass:e+"Metallic",bondProps:{bondType:h.METALLIC}},hydrogen:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_HYDROGEN"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_HYDROGEN"),htmlClass:e+"Hydrogen",bondProps:{bondType:h.HYDROGEN}}};var p={single:{},"double":{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE")}};var o=this.getEditorConfigs().getStructureConfigs().getEnabledBondForms();var r=Kekule.ObjUtils.getOwnedFieldNames(o,false);var s=[];for(var j=0,g=r.length;j<g;++j){var q=r[j];if(o[q]){if(DataType.isObjectValue(o[q])){s.push(o[q])}else{if(m[q]){s.push(m[q])}}}}return s}});Kekule.Editor.ChemSpaceEditor.Settings=Class.create(Kekule.Editor.BaseEditor.Settings,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor.Settings",initProperties:function(){this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getAllowCreateNewChild()},setter:function(e){this.getEditor().setAllowCreateNewChild(e)}})}});Kekule.Editor.BasicMolEraserIaController=Class.create(Kekule.Editor.BasicEraserIaController,{CLASS_NAME:"Kekule.Editor.BasicMolEraserIaController",initialize:function($super,e){$super(e)},doGetActualRemovedObjs:function(j){var e=[];Kekule.ArrayUtils.pushUnique(e,j);for(var h=0,g=j.length;h<g;++h){var f=j[h].getCascadeDeleteObjs?j[h].getCascadeDeleteObjs():[];if(f){Kekule.ArrayUtils.pushUnique(e,f)}}return e},doRemoveObjs:function(n){if(!n.length){return}var e=new Kekule.MacroOperation();var p=[];for(var m=0,g=n.length;m<g;++m){var k=n[m];var q=k.getParent();var o=this.getEditor();var f;if(k instanceof Kekule.BaseStructureNode){f=new Kekule.ChemStructOperation.RemoveNode(k,null,null,o);Kekule.ArrayUtils.pushUnique(p,k.getParent())}else{if(k instanceof Kekule.BaseStructureConnector){f=new Kekule.ChemStructOperation.RemoveConnector(k,null,null,o);Kekule.ArrayUtils.pushUnique(p,k.getParent())}else{f=new Kekule.ChemObjOperation.Remove(k,null,null,o)}}if(f){e.add(f)}}for(var m=0,g=p.length;m<g;++m){var j=p[m];if(j&&(j instanceof Kekule.StructureFragment)){var h=new Kekule.ChemStructOperation.StandardizeStructFragment(j,o);h.setEnableSplit(this.getEditor().canCreateNewChild());e.add(h)}}o.execOperation(e)}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolEraserIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.BasicMolManipulationIaController=Class.create(Kekule.Editor.BasicManipulationIaController,{CLASS_NAME:"Kekule.Editor.BasicMolManipulationIaController",initialize:function($super,e){$super(e);this.setEnableMagneticMerge(true);this.setEnableNodeMerge(true);this.setEnableNeighborNodeMerge(true);this.setEnableConnectorMerge(true);this.setEnableStructFragmentMerge(true);this.setEnableConstrainedMove(true);this.setEnableConstrainedRotate(true);this.setEnableConstrainedResize(true);this.setEnableDirectedMove(true);this._suppressConstrainedMoving=false;this._suppressConstrainedRotating=false;this._isInDirectedMoving=false;this._directedMovingDirection=null},initProperties:function(){this.defineProp("enableMagneticMerge",{dataType:DataType.BOOL});this.defineProp("enableNodeMerge",{dataType:DataType.BOOL});this.defineProp("enableNeighborNodeMerge",{dataType:DataType.BOOL});this.defineProp("enableConnectorMerge",{dataType:DataType.BOOL});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL});this.defineProp("allManipulateObjsMerged",{dataType:DataType.BOOL,serializable:false});this.defineProp("isMergeDone",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableConstrainedMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableConstrainedRotate",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableConstrainedResize",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableDirectedMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("mergeOperations",{dataType:DataType.ARRAY,serializable:false});this.defineProp("mergePreviewOperations",{dataType:DataType.ARRAY,serializable:false});this.defineProp("mergingDests",{dataType:DataType.ARRAY,serializable:false})},canInteractWithObj:function($super,e){return $super(e)||(this._isMerging&&e)},doSetManipulateObjs:function($super,e){var f=e?a.clone(e):[];if(this.getMergingDests()&&!this.useMergePreview()){a.pushUnique(f,this.getMergingDests())}this.setPropStoreFieldValue("manipulateObjs",e);if(!e){this.getEditor().endOperatingObjs()}else{this.getEditor().prepareOperatingObjs(f)}},isConstrainedRotate:function(){return this.getEnableConstrainedMove()},isConstrainedResize:function(){return this.getEnableConstrainedResize()},isConstrainedMove:function(){if(!this.getEnableConstrainedMove()){return false}var g=this.getManipulateObjs();if(g.length===1){var f=g[0];var e=this.getEditor().getSelection();if(e&&(e.indexOf(f)<0)){return f.getConstraintManipulationBaseObj&&f.getConstraintManipulationBaseObj()}}return false},isInActualConstrainedRotation:function(){return(this.isConstrainedRotate()&&(!this._suppressConstrainedRotating))},isDirectedMove:function(){return(this.getEnableDirectedMove()&&(!this.isConstrainedMove())&&this._isInDirectedMoving)},useMergePreview:function(){return this._useMergePreview},setUseMergePreview:function(e){this._useMergePreview=e},getMergeOperationsInManipulating:function(){return this._useMergePreview?this.getMergePreviewOperations():this.getMergeOperations()},createManipulateObjInfo:function($super,g,e,h){var i=this.getEditor();var f=$super(g,e,h);var j=this.isConstrainedMove();if(j){var k=g.getConstraintManipulationBaseObj();if(k){f.isConstrained=true;if(!f.hasNoCoord){f.originScreenCoord=i.getObjectScreenCoord(g);f.refScreenCoord=i.getObjectScreenCoord(k);f.connectorScreenLength=Kekule.CoordUtils.getDistance(f.screenCoord,f.refScreenCoord);f.connectorObjLength=Kekule.CoordUtils.getDistance(i.getObjCoord(g),i.getObjCoord(k));var l=Kekule.CoordUtils.substract(f.originScreenCoord,f.refScreenCoord);f.originBondDirectionAngle=Math.atan2(l.y,l.x);f.constrainedBondDirectionDelta=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionDelta();f.constrainedBondDirectionAngles=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngles();f.constrainedBondDirectionAngleThreshold=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngleThreshold()}}}return f},_calcActualMovedScreenCoord:function($super,m,u,j){var n=Kekule.CoordUtils;var k;var s=j;if(u.isConstrained&&(!this._suppressConstrainedMoving)){var p=u.constrainedBondDirectionDelta||null;var q=u.constrainedBondDirectionAngles||null;var f=u.constrainedBondDirectionAngleThreshold||null;var e=false;var w;var v=n.substract(j,u.refScreenCoord);var o=Math.atan2(v.y,v.x);if(q&&f){for(var t=0,r=q.length;t<r;++t){var h=q[t];if(Math.abs(h-o)<=f){e=true;w=h}}}if(!e&&p){var g=Math.round((o-u.originBondDirectionAngle)/p);w=u.originBondDirectionAngle+g*p;e=true}if(!e){w=o}k=n.add(u.refScreenCoord,{x:u.connectorScreenLength*Math.cos(w),y:u.connectorScreenLength*Math.sin(w)})}else{k=s}return k},_calcActualRotateAngle:function($super,k,i,g,h){var e=(this.isConstrainedRotate()&&(!this._suppressConstrainedRotating));var f=e?this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;if(f){var j=Math.round(i/f);return j*f}else{return $super(k,i)}},_calcActualResizeScales:function(i,k){var e=(this.isConstrainedResize()&&(!this._suppressConstrainedResize));if(!e){return k}else{var f=this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep();if(f){var j=(Math.round(k.scaleX/f)||1)*f;var h=(Math.round(k.scaleY/f)||1)*f;var g={scaleX:j,scaleY:h};return g}else{return k}}},prepareManipulating:function($super,i,f,e,j,h,g){this.setUseMergePreview(this.getEditorConfigs().getInteractionConfigs().getEnableMergePreview());this.setMergeOperations([]);this.setMergePreviewOperations([]);$super(i,f,e,j,h,g);this._directedMovingDirection=null;this.setManuallyHotTrack(true)},manipulateEnd:function($super){$super();this.getEditor().hideHotTrack();this.setManuallyHotTrack(false)},createManipulateOperation:function($super){$super();this.setMergeOperations([]);this.setMergePreviewOperations([])},getAllObjOperations:function($super,n){var e;if(n&&this.useMergePreview()){var o=this.getMergePreviewOperations();if(o&&o.length){var k=this.getMergeOperations();for(var m=0,j=o.length;m<j;++m){var h=o[m];if(h){var f=(h instanceof Kekule.ChemStructOperation.MergeConnectorsBase);var g=f?this.createConnectorMergeOperation(h.getTarget(),h.getDest()):this.createNodeMergeOperation(h.getTarget(),h.getDest());k.push(g)}}this.executeMergeOpers(k)}e=k}else{e=this.getMergeOperationsInManipulating()}var p=$super()||[];if(e&&e.length){Kekule.ArrayUtils.pushUnique(p,e)}return p},_canMergeNodes:function(g,h){var f=this.getEnableStructFragmentMerge();var e=this.getEnableNeighborNodeMerge();if(this.getEnableNodeMerge()){return Kekule.ChemStructOperation.MergeNodes.canMerge(g,h,f,e)}else{return false}},_canMergeConnectors:function(f,g){var e=this.getEnableStructFragmentMerge();if(this.getEnableConnectorMerge()){return Kekule.ChemStructOperation.MergeConnectors.canMerge(f,g,e)}else{return false}},_findSuitableMergeTargetBoundInfo:function(f,j,h,e){for(var g=f.length-1;g>=0;--g){var l=f[g];var k=l.obj;if(j.indexOf(k)>=0){continue}if(!(k instanceof h)){continue}if(e&&!e(k)){continue}return l}return null},_getMagneticNodeMergeDest:function(j,l,i){var h=this.getEditor();var f=this;var k=function(m){var n=m.obj;return(j!==n)&&(i.indexOf(n)<0)&&(n instanceof Kekule.ChemStructureNode)&&f._canMergeNodes(j,n)};if(l){var e=h.getBoundInfosAtCoord(l,k,this.getCurrBoundInflation());var g=e.length?e[e.length-1]:null;return g?g.obj:null}else{return null}},moveManipulatedObjs:function($super,i){var e;if(this.isDirectedMove()){var h=Kekule.CoordUtils;var g=this.getStartCoord();var k=h.getDistance(g,i);var j=h.substract(i,g);var f=this._directedMovingDirection;if(this._directedMovingDirection){}else{f=(Math.abs(j.x)>=Math.abs(j.y))?"x":"y";if(k<this.getEditor().getEditorConfigs().getInteractionConfigs().getDirectedMoveDistanceThreshold()){}else{this._directedMovingDirection=f}}e=Object.extend({},g);e[f]=i[f]}else{e=i}return $super(e)},applyManipulatingObjsInfo:function($super,n){this.setAllManipulateObjsMerged(false);var W=this.useMergePreview();var f=this.getEditor();f.hotTrackOnObj(null);var ak=Kekule.Editor.BasicManipulationIaController.ManipulationType;var H=this.getManipulationType();var v=this.getManipulateOriginObjs();var s=this.getManipulateObjs();var ab=[].concat(v);Kekule.ArrayUtils.pushUnique(ab,s);var u=this.getMergeOperationsInManipulating();var r=this;var D=function(i){if(i instanceof Kekule.StructureFragment){return false}else{return(i instanceof Kekule.ChemStructureNode)||(i instanceof Kekule.ChemStructureConnector)}};var X=(v.length===1)&&(v[0] instanceof Kekule.ChemStructureConnector);var ah=(s.length===1)&&(s[0] instanceof Kekule.ChemStructureNode)&&D(s[0]);if(!X&&this.getEnableMagneticMerge()){var e=this.getManipulateObjCurrInfoMap();var g=this.getManipulateObjInfoMap();var r=this;var y=[];var ac=[];var h=[];for(var ae=0,ad=s.length;ae<ad;++ae){var m=s[ae];if(!D(m)){continue}var F=e.get(m);var K=F.screenCoord;if(K){var U=f.getBoundInfosAtCoord(K,null,this.getCurrBoundInflation());var Q=this._getMagneticNodeMergeDest(m,K,ab);if(Q){y.push(ae);ac.push(m);h.push(Q)}else{}}}if(ac.length){var ai=ac.length;this.setAllManipulateObjsMerged(ai===s.length);var B=(ai<=1);var aj=false;if(!aj){var z=[];for(var ae=0,ad=ac.length;ae<ad;++ae){var m=ac[ae];var R=h[ae];var T=y[ae];var I=u[T];if(!I||!this.isSameNodeMerge(I,m,R)){aj=true;break}else{z.push(I)}}for(var ae=0,ad=u.length;ae<ad;++ae){var I=u[ae];if(I){var T=z.indexOf(I);if(T<0){aj=true;break}else{z.splice(T,1)}}}}if(aj||B){if(aj){this.reverseMergeOpers(this.getMergeOperationsInManipulating())}var t=Kekule.CoordUtils;if((ai===1)||(f.getCoordMode()===Kekule.CoordMode.COORD3D)){var F=e.get(ac[0]);var K=F.screenCoord;var Y=f.getObjectScreenCoord(h[0]);var aa=t.substract(Y,K);var ag=false;var k=Kekule.NumUtils.isFloatEqual;var j=1e-10;if(!k(aa.x,0,j)||!k(aa.y,0,j)){for(var ae=0,ad=s.length;ae<ad;++ae){var m=s[ae];if(m!==ac[0]){var af=e.get(m);if(af.screenCoord){var C=t.add(af.screenCoord,aa);af.screenCoord=C;if(this._getMagneticNodeMergeDest(m,C,ab)){ag=true}}}}}if(ag){return this.applyManipulatingObjsInfo(n)}else{for(var ae=0,ad=s.length;ae<ad;++ae){var m=s[ae];var af=e.get(m);this.applySingleManipulatingObjInfo(ae,m,af,n)}}}else{if((ai>1)&&(f.getCoordMode()!==Kekule.CoordMode.COORD3D)){var p=ac[0];var o=ac[1];var P=g.get(p).screenCoord;var N=g.get(o).screenCoord;var S=f.getObjectScreenCoord(h[0]);var O=f.getObjectScreenCoord(h[1]);var Z=t.calcCoordGroup2DTransformParams(P,N,S,O);var M=t.calcTransform2DMatrix(Z);var ag=false;for(var ae=0,ad=s.length;ae<ad;++ae){var m=s[ae];if(ac.indexOf(m)<0){var af=g.get(m);var F=e.get(m);if(af.screenCoord){var C=t.transform2DByMatrix(af.screenCoord,M);F.screenCoord=C;if(this._getMagneticNodeMergeDest(m,C,ab)){ag=true}}if(af.size){F.size=t.multiply(af.size,Z.scale)}}}if(ag){return this.applyManipulatingObjsInfo(n)}else{for(var ae=0,ad=s.length;ae<ad;++ae){var m=s[ae];if(ac.indexOf(m)<0){var F=e.get(m);this.applySingleManipulatingObjInfo(ae,m,F,n)}}}}}if(aj){for(var ae=0,ad=ai;ae<ad;++ae){var m=ac[ae];var R=h[ae];var T=y[ae];if(W){var x=this.createNodeMergeOperation(m,R,true);this.getMergePreviewOperations()[T]=x}else{var E=this.createNodeMergeOperation(m,R);this.getMergeOperations()[T]=E}}this.executeMergeOpers(this.getMergeOperationsInManipulating())}}f.hotTrackOnObj(h);return}}if(H===ak.MOVE){var A=false;if((X&&this.getEnableConnectorMerge())||(ah&&this.getEnableNodeMerge())){var J;var U=f.getBoundInfosAtCoord(n,null,this.getCurrBoundInflation());var L=X?Kekule.ChemStructureConnector:Kekule.ChemStructureNode;var q=X?v[0]:s[0];var V=X?function(i){return r._canMergeConnectors(q,i)}:function(i){return r._canMergeNodes(q,i)};var G=this._findSuitableMergeTargetBoundInfo(U,ab,L,V);if(G){var w=G.obj;if(w){this.setAllManipulateObjsMerged(true);f.hotTrackOnObj(w);var I=u[0];if((X&&this.isSameConnectorMerge(I,q,w))||(ah&&this.isSameNodeMerge(I,q,w))){return}else{if(I){this.reverseMergeOpers(this.getMergeOperationsInManipulating())}if(W){var E=X?this.createConnectorMergeOperation(q,w,W):this.createNodeMergeOperation(q,w,W);this.getMergePreviewOperations()[0]=E}else{var E=X?this.createConnectorMergeOperation(q,w):this.createNodeMergeOperation(q,w);this.getMergeOperations()[0]=E}this.executeMergeOpers(this.getMergeOperationsInManipulating());return}}}}}this.reverseMergeOpers(this.getMergeOperationsInManipulating());$super(n)},doMoveManipulatedObj_old:function($super,p,m,j,h){var f=this.getEditor();var y=this.getManipulateObjInfoMap().get(m);var u=j;var e=this.getManipulateOriginObjs();var t=this.getManipulationType();var q=(t===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE)&&(e.length===1)&&(e[0] instanceof Kekule.ChemStructureConnector);var s=u;var o=null;var A=this.getMergeOperations();var k=A[p];var B=this.getManipulateObjs();if(!q&&this.getEnableMagneticMerge()&&(m instanceof Kekule.ChemStructureNode)){var g=f.getBoundInfosAtCoord(s);if(g&&g.length){for(var v=g.length-1;v>=0;--v){var y=g[v];var r=y.obj;if(r===m){continue}if(B.indexOf(r)>=0){continue}if(r instanceof Kekule.ChemStructureNode){if(this._canMergeNodes(m,r)){f.addHotTrackedObj(r);if(this.isSameNodeMerge(k,m,r)){return}o=this.createNodeMergeOperation(m,r);break}}}if(!o){f.hotTrackOnObj(null)}else{if(k){this.reverseMergeOpers(p)}this.getMergeOperations()[p]=o;this.executeMergeOpers()}}}var s=h;var z=false;if((t===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE)){var n=e[0];if(e&&(e.length===1)){var x=f.getTopmostBoundInfoAtCoord(s,[n]);if(x){var l=x.obj;if(l&&(B.indexOf(l)<0)){if(q&&(n instanceof Kekule.ChemStructureConnector)&&(l instanceof Kekule.ChemStructureConnector)){if(this.getEnableConnectorMerge()){f.hotTrackOnObj(l);if(this.getEnableStructFragmentMerge()){z=true}else{z=(n.getParent()===l.getParent())}if(z){o=this.createConnectorMergeOperation(n,l)}}}else{if((n instanceof Kekule.ChemStructureNode)&&(l instanceof Kekule.ChemStructureNode)){if(this._canMergeNodes(n,l)){f.hotTrackOnObj(l);if(this.isSameNodeMerge(k,n,l)){return}else{}o=this.createNodeMergeOperation(n,l)}}}if(o){var k=A[p];if(k){this.reverseMergeOpers(p)}this.getMergeOperations()[p]=o;this.executeMergeOpers();return}}}}}if(!o){f.hideHotTrack();var w=!!this.getMergeOperations().length;if(w){this.reverseMergeOpers(p)}$super(p,m,j,h)}},createNodeMergeOperation:function(h,g,f){var e=this.getEnableStructFragmentMerge();if(!Kekule.ChemStructOperation.MergeNodes.canMerge(h,g,e,this.getEnableNeighborNodeMerge())){return null}else{var i=f?(new Kekule.ChemStructOperation.MergeNodesPreview(h,g,e,this.getEditor())):(new Kekule.ChemStructOperation.MergeNodes(h,g,e,this.getEditor()));return i}},createConnectorMergeOperation:function(i,g,f){var e=this.getEnableStructFragmentMerge();if(!Kekule.ChemStructOperation.MergeConnectors.canMerge(i,g,e)){return null}else{var h=f?Kekule.ChemStructOperation.MergeConnectorsPreview:Kekule.ChemStructOperation.MergeConnectors;var j=new h(i,g,this.getEditor().getCoordMode(),e,this.getEditor());return j}},isSameConnectorMerge:function(f,g,e){return f&&(f instanceof Kekule.ChemStructOperation.MergeConnectorsBase)&&(g===f.getTarget())&&(e===f.getDest())},isSameNodeMerge:function(f,g,e){return f&&(f instanceof Kekule.ChemStructOperation.MergeNodesBase)&&(g===f.getTarget())&&(e===f.getDest())},executeMergeOpers:function(j){var m=this.getEditor();var k=Kekule.ArrayUtils.toUnique(j||this.getMergeOperationsInManipulating());var f=[];m.beginUpdateObject();try{for(var h=0,e=k.length;h<e;++h){if(k[h]){k[h].execute();var g=k[h].getDest?k[h].getDest():null;if(g){a.pushUnique(f,g)}}}this.setMergingDests(f.length?f:null);this.refreshManipulateObjs();this._mergeJustReversed=false}finally{m.endUpdateObject()}},reverseMergeOpers:function(j){var h=this.getEditor();this.setMergingDests(null);var e=j||this.getMergeOperationsInManipulating();var g=Kekule.ArrayUtils.toUnique(e);if(!g||!g.length){}else{h.beginUpdateObject();try{for(var f=g.length-1;f>=0;--f){if(g[f]){g[f].reverse()}}e.length=0;this._mergeJustReversed=true;this.refreshManipulateObjs()}finally{h.endUpdateObject()}}},react_pointermove:function($super,f){this._suppressConstrainedMoving=f.getAltKey();this._suppressConstrainedRotating=f.getAltKey();this._isInDirectedMoving=f.getShiftKey();return $super(f)}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolManipulationIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.StructureInsertIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.StructureInsertIaController",initialize:function($super,e){$super(e);this._manipulatedBasicObjs=null},getInsertedObjs:function(){return this._manipulatedBasicObjs},doSetManipulateOriginObjs:function($super,e){this._manipulatedBasicObjs=this._getManipulatedBasicObjects(e);return $super(e)},_getManipulatedBasicObjects:function(j){var e=[];for(var h=0,f=j.length;h<f;++h){var k=j[h];if(k instanceof Kekule.ChemStructureObject){if(k instanceof Kekule.StructureFragment&&k.isExpanded()){var g=[].concat(k.getNodes()).concat(k.getConnectors());a.pushUnique(e,g)}else{a.pushUnique(e,k)}}else{a.pushUniqueEx(e,k)}}return e},stopManipulate:function($super){if(this.getEditorConfigs().getInteractionConfigs().getAutoSelectNewlyInsertedObjects()){var e=this.getInsertedObjs();this.doneInsertOrModifyBasicObjects(e)}return $super()}});Kekule.Editor.MolBondIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.MolBondIaController",initialize:function($super,e){$super(e);this.setState(c.State.INITIAL);this.setBondOrder(Kekule.BondOrder.SINGLE);this.setAllowBondingToBond(false);this.setEnableBondModification(true);this.setEnableSelect(false);this.setEnableMove(true);this.setAutoSwitchBondOrder(false);this.setEnableNeighborNodeMerge(false)},initProperties:function(){this.defineProp("allowBondingToBond",{dataType:DataType.BOOL,serializable:false});this.defineProp("state",{dataType:DataType.INT,serializable:false});this.defineProp("enableBondModification",{dataType:DataType.BOOL,serializable:false});this.defineProp("autoSwitchBondOrder",{dataType:DataType.BOOL,serializable:false});this.defineProp("startingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("endingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("structFragment",{dataType:"Kekule.ChemStructureFragment",serializable:false});this.defineProp("autoCreatedStructFragment",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("autoCreatedStartingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("bond",{dataType:"Kekule.Bond",serializable:false});this.defineProp("bondType",{dataType:DataType.STRING,serializable:false});this.defineProp("bondOrder",{dataType:DataType.INT,serializable:false});this.defineProp("bondStereo",{dataType:DataType.INT,serializable:false});this.defineProp("initialBondDirection",{dataType:DataType.FLOAT})},_isBondDifferent:function(g){var e=this.getBondStereo();var f=Kekule.BondStereo;if(e===f.UP||e===f.UP_INVERTED||e===f.DOWN||e===f.DOWN_INVERTED){return true}else{return(g.getBondType()!==this.getBondType())||(g.getBondOrder()!==this.getBondOrder())||(g.getStereo()!==this.getBondStereo())}},canInteractWithObj:function($super,f){var e=this.getState();if(e===c.State.INITIAL){if(f instanceof Kekule.ChemStructureNode){return true}else{if(f instanceof Kekule.ChemStructureConnector){if(this.getAllowBondingToBond()){return true}else{if(this.getEnableBondModification()){if(f instanceof Kekule.Bond){return this._isBondDifferent(f)}}else{return false}}}}}else{return $super(f)}},doTestMouseCursor:function(g,f){return""},getInsertedObjs:function($super){var e=this.getBond();return e?[e]:$super()},isObjValidBondTerminator:function(e){if(!e){return false}if(!this.getAllowBondingToBond()){return(e instanceof Kekule.ChemStructureNode)}else{return((e instanceof Kekule.ChemStructureNode)||(e instanceof Kekule.ChemStructureConnector))}},isBond:function(e){return(e instanceof Kekule.Bond)},getNewBondDefAngle:function(e,f){var g=this.getEditorConfigs().getStructureConfigs();return g.getNewBondDefAngle(e,f)},addDefBond:function(r,i,j){var u;var l=this.getEditor();l.beginUpdateObject();try{if(!i){if(!this.getEditor().canAddUnconnectedStructFragment()){return null}var g=this.getEditor().screenCoordToObj(r);var s=this.getEditor().getOnlyOneBlankStructFragment();if(!s){i=this.getEditor().createNewStructFragmentAndStartingAtom(null,g);this.setAutoCreatedStartingObj(null);this.setAutoCreatedStructFragment(i?i.getParent():null)}else{i=this.getEditor().createStructStartingAtom(s,null,g);this.setAutoCreatedStructFragment(null);this.setAutoCreatedStartingObj(i)}}else{this.setAutoCreatedStartingObj(null);this.setAutoCreatedStructFragment(null)}if(this.isObjValidBondTerminator(i)){var l=this.getEditor();this.setStartingObj(i);var o=i.getParent();this.setStructFragment(o);var e=this.getEditorConfigs().getStructureConfigs();var m=Kekule.oneOf(this.getBondType(),e.getDefBondType());var q=Kekule.oneOf(this.getBondOrder(),e.getDefBondOrder());var n=Kekule.oneOf(this.getBondStereo(),Kekule.BondStereo.NONE);var f=l.getDefBondLength?l.getDefBondLength():e.getDefBondLength();var p=this.getNewBondDefAngle(i,q);var k=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingLocation(i,f,p,this.getEditor().getAllowCoordBorrow());var h=this.getEditor().createDefaultNode(k,Kekule.Editor.CoordSys.OBJ,o);this.setEndingObj(h);var t=new Kekule.Bond();t.setBondType(m);t.setBondOrder(q);t.setStereo(n);o.appendConnector(t);t.appendConnectedObj(i);t.appendConnectedObj(h);this.setBond(t);if(j){this.getEditor().objectsChanged([{obj:t},{obj:h}])}u=k}else{u=null}}finally{l.endUpdateObject()}return u},addOperationToEditor:function($super){return $super()},getAllObjOperations:function($super,f){var e=$super(f)||[];var g=this.getAddBondOperation();if(g){e.unshift(g)}return e},getAddBondOperation:function(){var n=new Kekule.MacroOperation();var j=this.getEditor();var i=this.getAutoCreatedStructFragment();if(i){var e=new Kekule.ChemObjOperation.Add(i,this.getEditor().getChemObj(),null,this.getEditor());n.add(e)}var h=this.getStartingObj();var m=this.getEndingObj();var o=this.getBond();var l=this.getStructFragment();var j=this.getEditor();var g=this.getAutoCreatedStartingObj();if(g){var f=new Kekule.ChemStructOperation.AddNode(g,l,null,j);n.add(f)}var f=new Kekule.ChemStructOperation.AddNode(m,l,null,j);n.add(f);var k=new Kekule.ChemStructOperation.AddConnector(o,l,null,[h,m],j);n.add(k);return n},modifyBond:function(k){var x=this.getBondType();var s;var v=Kekule.BondOrder;var w=[v.SINGLE,v.DOUBLE,v.TRIPLE];if(this.getAutoSwitchBondOrder()&&(x===Kekule.BondType.COVALENT)&&(k.getBondType===Kekule.BondType.COVALENT)){var r=k.getBondOrder();var m=w.indexOf(r);if(m>=0){m=(++m)%w.length}else{m=0}s=w[m]}else{s=this.getBondOrder()}var f=k.getStereo();var g=this.getBondStereo();if(f===g){g=Kekule.BondStereo.getInvertedDirection(g)}var y={bondType:x,bondOrder:s,stereo:g};var o=false;for(var e in y){var q=k.getPropValue(e);if(q!==y[e]){o=true;break}}if(o){var h=this.getEditor();h.beginUpdateObject();try{var n=new Kekule.ChemObjOperation.Modify(k,y,this.getEditor());n.execute();h.pushOperation(n);var j=[k].concat(k.getConnectedObjs());var p=[];for(var u=0,t=j.length;u<t;++u){p.push({obj:j[u]})}this.getEditor().objectsChanged(p)}finally{h.endUpdateObject()}}},react_pointerdown:function(k){if(k.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var h=c.State;var l=this._getEventMouseCoord(k);var i=this.getState();if(i===h.INITIAL){var f=this.getEditor().getTopmostBoundInfoAtCoord(l,null,this.getCurrBoundInflation());if(f){var j=f.obj;if(this.isObjValidBondTerminator(j)){var g=this.addDefBond(l,j,true);if(g){this.startDirectManipulate(null,this.getEndingObj(),l);this.moveManipulatedObjs(l)}return true}else{if(this.isBond(j)&&this.getEnableBondModification()){this.modifyBond(j);return true}}k.preventDefault()}else{if(this.getEditor().canAddUnconnectedStructFragment()){var g=this.addDefBond(l,null,true);if(g){this.startDirectManipulate(null,this.getEndingObj(),l);this.moveManipulatedObjs(l)}k.preventDefault();return true}}}}},react_pointerup:function($super,j){var i=this.getState();var h=this.getStartCoord();var f=this._getEventMouseCoord(j);var g=Kekule.Editor.BasicManipulationIaController.State;if((i===g.MANIPULATING)&&(j.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT)){j.preventDefault();if(Kekule.CoordUtils.isEqual(h,f)){this.addOperationToEditor();this.stopManipulate();this.setState(g.NORMAL);return true}}return $super(j)}});Kekule.Editor.MolBondIaController.State={INITIAL:0,START_NODE_SET:21,ADJUSTING:22};var c=Kekule.Editor.MolBondIaController;Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolBondIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolAtomIaController_OLD=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController_OLD",initialize:function($super,e){$super(e);this._createNonAtomLabelInfos();this._setterShown=false},finalize:function($super){if(this.getAtomSetter()){this.getAtomSetter().finalize()}$super()},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:false});this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:false});this.defineProp("periodicTable",{dataType:DataType.OBJECT,serializable:false});this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,serializable:false});this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:false})},canInteractWithObj:function($super,e){if(this.isValidNode(e)){return true}else{return false}},isValidNode:function(e){return e instanceof Kekule.ChemStructureNode},getNodeLabel:function(g){var f=this.getEditor();var j=f.getRenderConfigs().getDisplayLabelConfigs();if(g.getIsotopeId){return g.getIsotopeId()}else{if(g instanceof Kekule.SubGroup){var i=g.getAbbr()||g.getFormulaText();return i||j.getRgroup()}else{if(g instanceof Kekule.VariableAtom){var h=g.getAllowedIsotopeIds();var k=g.getDisallowedIsotopeIds();return(h&&h.length)?this._getVarAtomListLabel():(k&&k.length)?this._getVarAtomNotListLabel():this._getVarAtomListLabel()}else{var e=g.getCoreDisplayRichTextItem(null,null,j);return Kekule.Render.RichTextUtils.toText(e)}}}},_getVarAtomListLabel:function(){var e=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return e.getVariableAtom()},_getVarAtomNotListLabel:function(){var e=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return"~"+e.getVariableAtom()},_createNonAtomLabelInfos:function(){var e=[];var f=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();e.push({nodeLabel:f.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")});e.push({nodeLabel:f.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")});e.push({nodeLabel:f.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")});e.push({nodeLabel:f.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")});e.push({nodeLabel:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")});e.push({nodeLabel:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")});this.setNonAtomLabelInfos(e);return e},_indexOfNonAtomLabel:function(j){var h=this.getNonAtomLabelInfos();for(var f=0,e=h.length;f<e;++f){var g=h[f];if(g.nodeLabel===j){return f}}return -1},_getNonAtomInfo:function(f){var e=this._indexOfNonAtomLabel(f);return(e<0)?null:this.getNonAtomLabelInfos()[e]},getAtomSetterWidget:function(h){var f=this.getAtomSetter();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createAtomSetterWidget(g,e);this.setAtomSetter(f)}return f},_createAtomSetterWidget:function(o,n){var q=new Kekule.Widget.ComboBox(o);var g=this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms();var j=[];for(var m=0,k=g.length;m<k;++m){j.push({value:g[m],data:{props:{isotopeId:g[m]}}})}j.push({value:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")});var f=this.getNonAtomLabelInfos();for(var m=0,k=f.length;m<k;++m){var h=f[m];var e={value:h.nodeLabel,data:{props:h.props}};if(h.description){e.text=h.nodeLabel+" - "+h.description}j.push(e)}q.setItems(j);q.appendToElem(n);var p=this;q.addEventListener("keyup",function(l){var i=l.htmlEvent;if(i.getKeyCode()===Kekule.X.Event.KeyCode.ENTER){p.applySetter(q);q.dismiss()}});q.addEventListener("valueSelect",function(i){p.applySetter(q);q.dismiss()});q.addEventListener("showStateChange",function(i){if(!i.isShown&&!i.isDismissed){if(p.getAtomSetter()&&p.getAtomSetter().isShown()){p.applySetter(q)}}});return q},getPeriodicTableDialogWidget:function(h){var f=this.getPeriodicTableDialog();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createPeriodicTableDialogWidget(g,e);this.setPeriodicTableDialog(f)}return f},_createPeriodicTableDialogWidget:function(h,e){var f=new Kekule.Widget.Dialog(h,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);var g=new Kekule.ChemWidget.PeriodicTable(h);g.setUseMiniMode(true);g.setEnableSelect(true);g.appendToElem(f.getClientElem());this.setPeriodicTable(g);return f},openSetterUi:function(l,i){var j=this.getAtomSetter();if(!this.isValidNode(i)){return}this.setCurrAtom(i);var h=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0;var f=h/1.5;var e=this.getNodeLabel(i);var k=this.getAtomSetterWidget(true);k.setValue(e);k.setIsDirty(false);var g=k.getElement().style;g.position="absolute";g.fontSize=h;g.left=(l.x-f)+"px";g.top=(l.y-f)+"px";k._applied=false;k.show(null,null,Kekule.Widget.ShowHideType.POPUP);(function(){k.focus();k.selectAll()}).defer()},applySetter:function(j,m){if(j._applied){return}if(!j.getIsDirty()){return}if(!m){m=this.getCurrAtom()}var e;var n=null;var s=j.getValue();var k;if(s===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){var k=this.getPeriodicTableDialogWidget(true);k.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var i=m.getSymbol?m.getSymbol():null;this.getPeriodicTable().setEnableSelect(true).setEnableMultiSelect(false).setSelectedSymbol(i)}else{if(s===this._getVarAtomListLabel()||s===this._getVarAtomNotListLabel()){var l=s===this._getVarAtomNotListLabel();var k=this.getPeriodicTableDialogWidget(true);k.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var o=m.getAllowedIsotopeIds?m.getAllowedIsotopeIds():null;var f=m.getDisallowedIsotopeIds?m.getDisallowedIsotopeIds():null;this.getPeriodicTable().setEnableSelect(true).setEnableMultiSelect(true).setSelectedSymbols(l?f:o)}}if(k){var u=this;k.openModal(function(v){if(v===Kekule.Widget.DialogButtons.OK){var y;var x;if(s===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){var z=u.getPeriodicTable().getSelectedSymbol();y=Kekule.Atom;x={isotopeId:z}}if(s===u._getVarAtomListLabel()){var w=u.getPeriodicTable().getSelectedSymbols();y=Kekule.VariableAtom;x={allowedIsotopeIds:w,disallowedIsotopeIds:null}}if(s===u._getVarAtomNotListLabel()){var w=u.getPeriodicTable().getSelectedSymbols();y=Kekule.VariableAtom;x={allowedIsotopeIds:null,disallowedIsotopeIds:w}}u.applyModification(m,null,y,x)}},this);return}var q=null;var p=this._getNonAtomInfo(s);if(p){e=p.nodeClass;n=p.props}else{var h=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(s);if(h){var g=h.createObjects(m)||{};var t=g.objects;var r=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),h,g,m,null);this.getEditor().transformCoordAndSizeOfObjects(t,r);q=t[0];e=q.getClass()}else{e=Kekule.ChemStructureNodeFactory.getClassByLabel(s,null);if(!e){if(this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()){e=Kekule.Pseudoatom}}n=(e===Kekule.Atom)?{isotopeId:s}:(e===Kekule.Pseudoatom)?{symbol:s}:{}}}if(!e){Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL"))}else{this.applyModification(m,q,e,n);j._applied=true}},applyModification:function(g,o,q,m){var o;var h,i;var f=g.getClass();if(o&&!q){q=o.getClass()}if(o||q!==f){h=new Kekule.MacroOperation();if(!o){o=new q()}var j=new Kekule.ChemStructureNode();j.assign(g);o.assign(j);var p=new Kekule.ChemStructOperation.ReplaceNode(g,o,null,this.getEditor());h.add(p)}else{o=g}if(m){i=new Kekule.ChemObjOperation.Modify(o,m,this.getEditor());if(h){h.add(i)}}var k=h||i;if(k){var l=this.getEditor();l.beginUpdateObject();try{k.execute()}catch(n){throw (n)}finally{l.endUpdateObject()}if(l&&l.getEnableOperHistory()&&k){l.pushOperation(k)}}},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var j=this._getEventMouseCoord(i);var f=this.getEditor().getTopmostBoundInfoAtCoord(j,null,this.getCurrBoundInflation());if(f){var h=f.obj;if(this.isValidNode(h)){var g=this.getEditor().getObjectScreenCoord(h);i.preventDefault();i.stopPropagation();this.openSetterUi(g,h);this.getEditor().setSelection([h])}return true}}}});Kekule.Editor.MolAtomIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController",initialize:function($super,e){$super(e);this._createNonAtomLabelInfos();this._setterShown=false},finalize:function($super){if(this.getAtomSetter()){this.getAtomSetter().finalize()}$super()},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:false});this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:false});this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:false})},canInteractWithObj:function($super,e){if(this.isValidNode(e)){return true}else{return false}},isValidNode:function(e){return(e instanceof Kekule.ChemStructureNode)&&!(e instanceof Kekule.StructureFragment&&e.isStandalone())},_createNonAtomLabelInfos:function(){var f=this.getEditor();var e=f&&f.getEnabledNonAtomInputData&&f.getEnabledNonAtomInputData();this.setNonAtomLabelInfos(e);return e},_indexOfNonAtomLabel:function(j){var h=this.getNonAtomLabelInfos();for(var f=0,e=h.length;f<e;++f){var g=h[f];if(g.nodeLabel===j){return f}}return -1},_getNonAtomInfo:function(f){var e=this._indexOfNonAtomLabel(f);return(e<0)?null:this.getNonAtomLabelInfos()[e]},getAtomSetterWidget:function(h){var f=this.getAtomSetter();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createAtomSetterWidget(g,e);this.setAtomSetter(f)}return f},_createAtomSetterWidget:function(j,f){var e=new Kekule.ChemWidget.StructureNodeSetter(this.getEditor());e.setUseDropDownSelectPanel(true);e.addClassName(d.CHEMEDITOR_ATOM_SETTER);var i=a.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());i.push("...");var h=this.getNonAtomLabelInfos();e.setSelectableInfos({elementSymbols:i,nonElementInfos:h,subGroupRepItems:Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()});var g=this;e.addEventListener("keyup",function(l){var k=l.htmlEvent;if(k.getKeyCode()===Kekule.X.Event.KeyCode.ENTER){g.applySetter(e);e.dismiss()}});e.addEventListener("valueSelect",function(k){if(g.getAtomSetter()&&g.getAtomSetter().isShown()){g.applySetter(e);e.dismiss()}});e.addEventListener("showStateChange",function(k){if(k.target===e&&!k.byDomChange){if(!k.isShown&&!k.isDismissed){if(g.getAtomSetter()&&g.getAtomSetter().isShown()){g.applySetter(e)}}}});e.appendToElem(f);return e},getPeriodicTableDialogWidget:function(h){var f=this.getPeriodicTableDialog();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createPeriodicTableDialogWidget(g,e);this.setPeriodicTableDialog(f)}return f},_createPeriodicTableDialogWidget:function(h,e){var f=new Kekule.Widget.Dialog(h,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);var g=new Kekule.ChemWidget.PeriodicTable(h);g.setUseMiniMode(true);g.setEnableSelect(true);g.appendToElem(f.getClientElem());this.setPeriodicTable(g);return f},openSetterUi:function(k,i){var g=this.getAtomSetter();if(g&&g.isShown()){g.hide();g._haltPrevShowHideProcess()}if(!this.isValidNode(i)){return}this.setCurrAtom(i);var m=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0;m*=this.getEditor().getZoom()||1;var l=m/1.5;var f=this.getAtomSetterWidget(true);f.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs());f.setNodes([i]);var j=this.getEditor().getCoreElement();f.appendToElem(j);var h=f.getNodeInputBox();var e=f.getElement().style;e.position="absolute";e.left=(k.x-l)+"px";e.top=(k.y-l)+"px";h.getElement().style.fontSize=m+"px";f._applied=false;f.show(null,null,Kekule.Widget.ShowHideType.POPUP);(function(){h.focus();h.selectAll()}).defer()},applySetter:function(g,i){if(g._applied){return}if(!i){i=this.getCurrAtom()}var n=g.getValue();if(!n){return}var e=n.nodeClass;var j=n.props;var h=n.repositoryItem;var k;if(h){var f=h.createObjects(i)||{};var m=f.objects;var l=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),h,f,i,null);this.getEditor().transformCoordAndSizeOfObjects(m,l);k=m[0];e=k.getClass()}if(n.isUnknownPseudoatom&&!this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()){e=null}if(!e){Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL"))}else{this.applyModification(i,k,e,j);g._applied=true}},applyModification:function(g,o,q,m){var o;var h,i;var f=g.getClass();if(o&&!q){q=o.getClass()}if(o||q!==f){h=new Kekule.MacroOperation();if(!o){o=new q()}var j=new Kekule.ChemStructureNode();j.assign(g);o.assign(j);var p=new Kekule.ChemStructOperation.ReplaceNode(g,o,null,this.getEditor());h.add(p)}else{o=g}if(m){i=new Kekule.ChemObjOperation.Modify(o,m,this.getEditor());if(h){h.add(i)}}var k=h||i;if(k){var l=this.getEditor();l.beginUpdateObject();try{k.execute()}catch(n){throw (n)}finally{l.endUpdateObject()}if(l&&l.getEnableOperHistory()&&k){l.pushOperation(k)}}},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var j=this._getEventMouseCoord(i);var f=this.getEditor().getTopmostBoundInfoAtCoord(j,null,this.getCurrBoundInflation());if(f){var h=f.obj;if(this.isValidNode(h)){var g=this.getEditor().getObjectScreenCoord(h);i.preventDefault();i.stopPropagation();this.openSetterUi(g,h);this.doneInsertOrModifyBasicObjects([h])}return true}}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolAtomIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.RepositoryIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.RepositoryIaController",initialize:function($super,e){$super(e);this.setEnableSelect(false);this._repObjStartingScreenCoord=null},initProperties:function(){this.defineProp("repositoryItem",{dataType:"Kekule.AbstractRepositoryItem",serializable:false});this.defineProp("addRepObjsOper",{dataType:"Kekule.MacroOperation",serializable:false});this.defineProp("initialTransformParams",{dataType:DataType.HASH,serializable:false});this.defineProp("currRepositoryObjects",{dataType:"Kekule.ChemObject",serializable:false})},doTestMouseCursor:function(g,f){return""},canInteractWithObj:function($super,e){return $super(e)},isValidStartingObj:function(e){return true},calcInitialTransformParams:function(g,f,e,h){return Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),g,f,e,h)},getRepObjCreationOptions:function(){return null},createObjFromRepositoryItem:function(f,g){var e=g.createObjects(f,this.getRepObjCreationOptions())||{};return e},addRepositoryObj:function(h,u,z){var g=this.getEditor();this.setAddRepObjsOper(null);var y=null;g.beginUpdateObject();try{var m=g.getChemSpace();var s=this.getRepositoryItem();var y=this.createObjFromRepositoryItem(h,s);var v=y.objects;this.setCurrRepositoryObjects(v);var e=s.isOneStructureFragmentObj();var f=false;var r=this.getEditor().getOnlyOneBlankStructFragment();if(!g.canCreateNewChild()&&!y.mergeObj&&!z){if(!e||!g.canAddUnconnectedStructFragment()){return null}else{f=true}}var p=new Kekule.MacroOperation();for(var w=0,t=v.length;w<t;++w){var n=v[w];var k;if(f){k=new Kekule.ChemStructOperation.MergeStructFragment(n,r,g)}else{k=new Kekule.ChemObjOperation.Add(n,m,null,g)}p.add(k)}p.execute();this.setAddRepObjsOper(p);var x=f?[r]:v;var j=this.calcInitialTransformParams(s,y,h,u);this._transformObjectsCoordAndSize(x,j);this.setInitialTransformParams(j);y.objects=x;var o=s.getMolManipulationCenterCoord&&s.getMolManipulationCenterCoord();if(o){y.manipulationCenterCoord=Kekule.CoordUtils.transform2D(o,j)}var q=s.getMolManipulationDefDirectionCoord&&s.getMolManipulationDefDirectionCoord();if(q){y.manipulationDefDirectionCoord=Kekule.CoordUtils.transform2D(q,j)}}finally{g.endUpdateObject()}return y},doRefreshRepositoryObj:function(f,e,i,h,g){this.doPrepareManipulatingObjects(f,e);this.doPrepareManipulatingStartingCoords(e,i,h,g);this.doCreateManipulateMoveAndResizeOperation()},_transformObjectsCoordAndSize:function(e,f){return this.getEditor().transformCoordAndSizeOfObjects(e,f)},getAllObjOperations:function($super,g){var f=$super(g)||[];var e=this.getAddRepObjsOper();if(e){f.unshift(e)}return f},addOperationToEditor:function($super){return $super()},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE},doInsertRepositoryObjToEditor:function(j,e,h,n){if(!n){this._initialStartingObj=h;this._repObjStartingScreenCoord=e}var g=j;if(g){var f=g.objects;var l=null,m=null;var i=this.getInitManipulationType();if(g.mergeObj){l=this.getEditor().getObjectScreenCoord(g.mergeObj);i=Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE}else{if(g.manipulationCenterCoord){l=this.getEditor().objCoordToScreen(g.manipulationCenterCoord)}}if(g.manipulationDefDirectionCoord){m=this.getEditor().objCoordToScreen(g.manipulationDefDirectionCoord)}var k=this.getEditor().getObjectsContainerBox(f);return{objects:f,manipulateType:i,coord:e,box:k,rotateCenter:l,rotateRefCoord:m,startingObj:h}}else{return null}},insertRepositoryObjToEditor:function(f,e,h){var g=this.addRepositoryObj(e,f);return this.doInsertRepositoryObjToEditor(g,f,e,h)},updateRepositoryObjInEditor:function(){var h=this.getEditor();h.beginUpdateObject();try{if(!this.useMergePreview()){this.reverseActiveOperation()}var o=this.getCurrRepositoryObjects();var k=this.addRepositoryObj(this._initialStartingObj,this._repObjStartingScreenCoord,true);var m=a.exclude(o,(k||{}).objects);for(var g=0,e=m.length;g<e;++g){var f=m[g];var j=f.getParent();if(j){j.removeChild(f)}}if(!this.useMergePreview()||m.length){this.setMergeOperations([]);this.setMergePreviewOperations([])}var n=this.doInsertRepositoryObjToEditor(k,this._repObjStartingScreenCoord,this._initialStartingObj,true);if(n){this.doRefreshRepositoryObj(n.objects,n.coord,n.box,n.rotateCenter,n.rotateRefCoord);this.moveManipulatedObjs(this._repObjStartingScreenCoord)}}finally{h.endUpdateObject()}return n},react_pointerdown:function(j){if(j.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var g=c.State;var l=this._getEventMouseCoord(j);var i=this.getState();if(i===g.INITIAL){var f=this.getEditor().getTopmostBoundInfoAtCoord(l,null,this.getCurrBoundInflation());var k=f?f.obj:null;var h=this.insertRepositoryObjToEditor(l,k);if(h){this.startDirectManipulate(h.manipulateType,h.objects,h.coord,h.box,h.rotateCenter);this.moveManipulatedObjs(l)}j.preventDefault();return true}}},react_pointerup:function($super,j){var i=this.getState();var h=this.getStartCoord();var f=this._getEventMouseCoord(j);var g=Kekule.Editor.BasicManipulationIaController.State;if((i===g.MANIPULATING)&&(j.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT)){if(Kekule.CoordUtils.isEqual(h,f)){this.addOperationToEditor();this.stopManipulate();this.setState(g.NORMAL);j.preventDefault();return true}}return $super(j)}});Kekule.Editor.MolRingIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.MolRingIaController",initialize:function($super,e){$super(e);this.setRepositoryItem(new Kekule.Editor.MolRingRepositoryItem2D())},getActualManipulatingObjects:function(f){var e=this.getCurrRepositoryObjects()[0];return e?a.clone(e.getNodes()):[]},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getRingAtomCount()},setter:function(e){this.getRepositoryItem().setRingAtomCount(e)}});this.defineProp("isAromatic",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getIsAromatic()},setter:function(e){this.getRepositoryItem().setIsAromatic(e)}})}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolRingIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.RepositoryStructureFragmentIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.RepositoryStructureFragmentIaController",initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("repItemName",{dataType:DataType.STRING,setter:function(f){if(f!==this.getRepItemName()){var e=Kekule.Editor.RepositoryItemManager.getItem(f);if(e){this.setRepositoryItem(e);this.setPropStoreFieldValue("repItemName",f)}}}})}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.RepositoryStructureFragmentIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolFlexStructureIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.MolFlexStructureIaController",initialize:function($super,e){$super(e);this.setEnableSelect(false)},initProperties:function(){this.defineProp("assocMarker",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var e=this.getPropStoreFieldValue("assocMarker");if(!e){e=new Kekule.ChemWidget.TextUiMarker();this.setPropStoreFieldValue("assocMarker",e)}return e}})},manipulateEnd:function($super){$super();this.hideAssocMarker()},initAssocMarker:function(){var e=this.getAssocMarker();var f=this.getEditorConfigs().getUiMarkerConfigs();var g={color:f.getFlexStructureAssocMarkerColor(),opacity:f.getFlexStructureAssocMarkerOpacity(),fontSize:f.getFlexStructureAssocMarkerFontSize(),fontFamily:f.getFlexStructureAssocMarkerFontFamily(),textBoxXAlignment:Kekule.Render.BoxXAlignment.CENTER,textBoxYAlignment:Kekule.Render.BoxYAlignment.CENTER};e.setDrawStyles(g);e.setVisible(true);this.getEditor().getUiMarkers().addMarker(e);return e},hideAssocMarker:function(){var e=this.getPropStoreFieldValue("assocMarker");if(e){e.setVisible(false);this.getEditor().getUiMarkers().removeMarker(e);this.repaintMarker()}},updateAssocMarker:function(h,f,g){var e=this.getAssocMarker();if(h){e.setCoord(h)}if(f){e.setPropValues(f)}if(!g){this.repaintMarker()}},repaintMarker:function(){this.getEditor().repaintUiMarker()}});Kekule.Editor.MolFlexChainIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexChainIaController",initialize:function($super,e){$super(e);this.setEnableSelect(false);this._deltaDistance=null;this._deltaCount=0;this._lastDeltaCount=1;this._repObjStartingScreenCoord=null;this._repObjNeedUpdate=false;this._isForceReversedChainDirection=false;this._assocMarkerInitCoord=null;this._manipulateObjInfoCache=[];this._chain=null;var f=new Kekule.Editor.MolChainRepositoryItem2D(2);f.setEnableCoordCache(true);this.setRepositoryItem(f)},updateAssocMarker:function($super,o,i,u){var j=this.getEditor();var s=this.getAssocMarker().getDrawStyles();var r=this._chain;var g=o;if(!g&&r){var p=r.getNodeAt(0);var k=r.getNodeAt(r.getNodeCount()-1);var l=j.getObjectContextCoord(p);g=j.getObjectContextCoord(k);var m=b.substract(g,l);if(m){var h=s.fontSize||10;var n=h/2;var q={x:0,y:0};if(g){var t=b.getDistance(m);var f=m.x/t;var e=m.y/t;var q={x:n*f,y:n*e};g=Kekule.CoordUtils.add(g,q)}}}$super(g,i,u)},getChainMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexChainAtomCount(),0)},manipulateEnd:function($super){this._clearManipulateObjInfoCache();$super()},createManipulateObjInfo:function($super,i,j,f){var e=this.getRepositoryItem().getNegativeDirection();var h=this._getCachedManipulateObjInfo(j,e);if(h){return h}else{var g=$super(i,j,f);this._setCachedManipulateObjInfo(g,j,e);return g}},canInteractWithObj:function($super,e){return $super(e)&&(e instanceof Kekule.ChemStructureNode)},getActualManipulatingObjects:function(f){var e=this.getCurrRepositoryObjects()[0];return e?a.clone(e.getNodes()):[]},_setCachedManipulateObjInfo:function(i,h,e){var g=e?1:0;var f=this._manipulateObjInfoCache[g];if(!f){f=[];this._manipulateObjInfoCache[g]=f}f[h]=i},_getCachedManipulateObjInfo:function(h,e){var g=e?1:0;var f=this._manipulateObjInfoCache[g];return f&&f[h]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var i=this.getRepositoryItem().getBondLength();var j=this.getInitialTransformParams();var f=this.getEditor();var h=f.objCoordToScreen(Kekule.CoordUtils.transform2D({x:0,y:0},j));var g=f.objCoordToScreen(Kekule.CoordUtils.transform2D({x:i*Math.cos(Math.PI/6),y:0},j));var e=Kekule.CoordUtils.getDistance(h,g);return e},getRepObjCreationOptions:function(){if(this._isUpdateRepObj){var e=this.getCurrRepositoryObjects()[0];return{originalStructFragment:e}}else{return null}},addRepositoryObj:function($super,g,f,h){var e=$super(g,f,h);this._deltaDistance=this._calcStepDeltaDistance();this._repObjNeedUpdate=false;return e},insertRepositoryObjToEditor:function($super,h,g,i){if(!i){this._deltaDistance=null;this._deltaCount=0;this._lastDeltaCount=1;var j=2;this.getRepositoryItem().setAtomCount(j)}this._isUpdateRepObj=i;var e=$super(h,g,i);this._chain=e&&e.objects[0];if(e&&!i){var f=this.initAssocMarker();this.updateAssocMarker(null,{text:""+j})}return e},_updateChain:function(){this._isUpdateRepObj=true;var e=this.updateRepositoryObjInEditor();this._chain=e.objects[0];this._repObjNeedUpdate=false;return e},doTransformManipulatedObjs:function($super,p,r,g){var m=r;var f=this.getState();if(f===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){var n=this.getBaseCoord();if(n){var o=Kekule.CoordUtils.getDistance(m,n);var h=Math.max(Math.round(o/this._deltaDistance),1);if(!this._lastDeltaCount||h!==this._lastDeltaCount){this._deltaCount=h;var v=this.getChainMaxAtomCount();var u=v?Math.min(v,h+1):h+1;if(this.getRepositoryItem().getAtomCount()!==u){this.getRepositoryItem().setAtomCount(u);this._repObjNeedUpdate=true;this.updateAssocMarker(null,{text:""+u},true)}this._lastDeltaCount=h}var e=this._calcRotateAngle(m);var s=e&&e.angle;var i=this.isInActualConstrainedRotation();var w;if(i){var l=i?this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep()*2:null;var j=Math.round(s/l);var t=j*l-s;w=t<0}else{w=false}if(this._isForceReversedChainDirection){w=!w}if(!!this.getRepositoryItem().getNegativeDirection()!==w){this.getRepositoryItem().setNegativeDirection(w);this._repObjNeedUpdate=true}}}if(this._repObjNeedUpdate){this._updateChain()}var q=this.getCurrRepositoryObjects()[0];q.beginUpdate();try{var k=$super(p,r,g);this.updateAssocMarker(null,null,false)}finally{q.endUpdate()}return k},react_pointermove:function($super,g){this._isForceReversedChainDirection=!!g.getShiftKey();var f=$super(g);return f}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolFlexChainIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolFlexRingIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexRingIaController",initialize:function($super,e){$super(e);this.setEnableSelect(false);this._deltaDistance=null;this._lastDeltaCount=1;this._repObjStartingScreenCoord=null;this._repObjNeedUpdate=false;this._manipulateObjInfoCache=[];var f=new Kekule.Editor.MolRingRepositoryItem2D(3);f.setEnableCoordCache(true);this.setRepositoryItem(f)},getRingMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexRingAtomCount(),0)},getRingMinAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount(),3)},getActualManipulatingObjects:function(f){var e=this.getCurrRepositoryObjects()[0];return e?a.clone(e.getNodes()):[]},manipulateEnd:function($super){this._clearManipulateObjInfoCache();$super()},createManipulateObjInfo:function($super,h,j,e){var i=this.getRepositoryItem().getRingAtomCount();var g=this._getCachedManipulateObjInfo(j,i);if(g){return g}else{var f=$super(h,j,e);this._setCachedManipulateObjInfo(f,j,i);return f}},_setCachedManipulateObjInfo:function(g,f,h){var e=this._manipulateObjInfoCache[h];if(!e){e=[];this._manipulateObjInfoCache[h]=e}e[f]=g},_getCachedManipulateObjInfo:function(f,g){var e=this._manipulateObjInfoCache[g];return e&&e[f]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var i=this.getRepositoryItem().getBondLength();var j=this.getInitialTransformParams();var f=this.getEditor();var h=f.objCoordToScreen(Kekule.CoordUtils.transform2D({x:0,y:0},j));var g=f.objCoordToScreen(Kekule.CoordUtils.transform2D({x:i,y:0},j));var e=Kekule.CoordUtils.getDistance(h,g)/3;return e},getRepObjCreationOptions:function(){if(this._isUpdateRepObj){var e=this.getCurrRepositoryObjects()[0];return{originalStructFragment:e}}else{return null}},addRepositoryObj:function($super,g,f,h){var e=$super(g,f,h);this._deltaDistance=this._calcStepDeltaDistance();this._repObjNeedUpdate=false;return e},insertRepositoryObjToEditor:function($super,h,f,i){if(!i){this._deltaDistance=null;this._lastDeltaCount=1;var j=this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount();this.getRepositoryItem().setRingAtomCount(j)}this._isUpdateRepObj=i;var e=$super(h,f);if(e&&!i){var g=e.objects[0];this.initAssocMarker();this.updateAssocMarker(this._getRingCenterAbsContextCoord(g),{text:""+j})}return e},updateAssocMarker:function($super,h,e,f){if(!h){var g=this._getManipulateObjsCenterCoord();h=this.getEditor().objCoordToContext(g)}return $super(h,e,f)},_getRingCenterAbsContextCoord:function(e){var g=this.getEditor();var f=Kekule.Editor.StructureUtils.getStructureCenterAbsBaseCoord(e,g.getCoordMode(),g.getAllowCoordBorrow());return g.objCoordToContext(f)},_updateRing:function(){this._isUpdateRepObj=true;var e=this.updateRepositoryObjInEditor();this._repObjNeedUpdate=false;return e},doTransformManipulatedObjs:function($super,g,p,i){var l=p;var f=this.getState();if(f===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){var o=this.getBaseCoord();if(o){var m=this.getRingMinAtomCount();var h=Kekule.CoordUtils.getDistance(l,o);var j=Math.round(h/this._deltaDistance)+m;if(!this._lastDeltaCount||j!==this._lastDeltaCount){var n=this.getRingMaxAtomCount();var e=n?Math.min(n,j):j;e=m?Math.max(e,m):e;if(this.getRepositoryItem().getRingAtomCount()!==e){this.getRepositoryItem().setRingAtomCount(e);this._repObjNeedUpdate=true;this.updateAssocMarker(null,{text:""+e},true)}this._lastDeltaCount=j}}}if(this._repObjNeedUpdate){this._updateRing()}var k=this.getCurrRepositoryObjects()[0];k.beginUpdate();try{var q=$super(g,p,i);this.updateAssocMarker(null,null,false)}finally{k.endUpdate()}return q}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolFlexRingIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.ArrowLineIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.ArrowLineIaController",initialize:function($super,e){$super(e);this.setRepositoryItem(new Kekule.Editor.PathGlyphRepositoryItem2D())},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT,getter:function(){return this.getRepositoryItem().getGlyphRefLength()},setter:function(e){this.getRepositoryItem().setGlyphRefLength(e)}});this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:false,getter:function(){return this.getRepositoryItem().getGlyphClass()},setter:function(e){this.getRepositoryItem().setGlyphClass(e)}});this.defineProp("glyphInitialParams",{dataType:DataType.HASH,getter:function(){return this.getRepositoryItem().getGlyphInitialParams()},setter:function(e){this.getRepositoryItem().setGlyphInitialParams(e)}})},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE},addRepositoryObj:function($super,f,e,g){this.getRepositoryItem().setGlyphRefLength(this.getEditor().getChemSpace().getDefAutoScaleRefLength());return $super(f,e,g)}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.ArrowLineIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.FormulaIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.FormulaIaController",initialize:function($super,e){$super(e);this._operAddMol=null},initProperties:function(){this.defineProp("currMol",{dataType:DataType.OBJECT,serializable:false});this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:false})},canInteractWithObj:function($super,e){if(e&&this.isValidMol(e)){return true}else{return false}},isValidMol:function(e){return(e instanceof Kekule.StructureFragment)&&e.hasFormula()&&!e.hasCtab()},getFormulaText:function(e){return e.hasFormula()?e.getFormula().getText():""},createNewMol:function(h,i){var g;var f=this.getEditor();if(!f.canCreateNewChild()){g=f.getOnlyOneBlankStructFragment();if(!g){return null}}f.beginUpdateObject();try{if(!g){var g=new Kekule.Molecule()}g.getFormula(true);h.appendChild(g);f.setObjectScreenCoord(g,i);var e=new Kekule.ChemObjOperation.Add(g,h,null,f);this._operAddBlock=e}finally{f.endUpdateObject()}return g},getTextSetterWidget:function(h){var f=this.getTextSetter();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createTextSetterWidget(g,e);this.setTextSetter(f)}return f},_createTextSetterWidget:function(h,f){var e=new Kekule.Widget.TextBox(this.getEditor());e.addClassName(d.CHEMEDITOR_FORMULA_SETTER);e.appendToElem(f);var g=this;e.addEventListener("keyup",function(k){var i=k.htmlEvent;var j=i.getKeyCode();if(j===Kekule.X.Event.KeyCode.ENTER){g.applySetter(e);e.dismiss()}else{if(j===Kekule.X.Event.KeyCode.ESC){e.dismiss();g.cancelSetter()}}});e.addEventListener("showStateChange",function(i){if(!i.byDomChange){if(!i.isShown&&!i.isDismissed){g.applySetter(e)}if(i.isShown){e._applied=false}}});return e},cancelSetter:function(){if(this._operAddBlock){this._operAddBlock.reverse();this._operAddBlock=null}},applySetter:function(j,f){if(j._applied){return}if(!f){f=this.getCurrMol()}var i;var h=j.getText();if(!h){if(this._operAddBlock){this.cancelSetter()}else{i=new Kekule.ChemObjOperation.Remove(f,f.getParent(),null,this.getEditor())}}else{var i=new Kekule.ChemObjOperation.Modify(f.getFormula(),{text:h},this.getEditor())}if(i){i.execute();var e=this.getEditor();if(e&&e.getEnableOperHistory()){if(this._operAddBlock){var g=new Kekule.MacroOperation();g.add(this._operAddBlock);g.add(i);e.pushOperation(g);this._operAddBlock=null}else{e.pushOperation(i)}this.doneInsertOrModifyBasicObjects([f])}}j._applied=true},openSetterUi:function(l,j){var i=this.getTextSetter();if(i&&i.isShown()){this.applySetter(i,this.getCurrMol());i.hide();i._haltPrevShowHideProcess()}if(!j){j=this.createNewMol(this.getEditor().getChemObj(),l)}if(!this.isValidMol(j)){return}this.setCurrMol(j);this.getEditor().setSelection([j]);var n=j.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();n*=this.getEditor().getZoom()||1;var g=j.getCascadedRenderOption("fontFamily")||"";var m=this.getFormulaText(j);var h=this.getTextSetterWidget(true);var k=this.getEditor().getCoreElement();h.appendToElem(k);var e=m||"";h.setValue(e);var f=h.getElement().style;f.position="absolute";f.fontSize=n+"px";f.left=l.x+"px";f.top=l.y+"px";f.fontFamily=g;h._applied=false;h.show(null,null,Kekule.Widget.ShowHideType.POPUP);h.selectAll();h.focus()},react_pointerup:function(j){if(j.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var k=this._getEventMouseCoord(j);var h;var f=this.getEditor().getTopmostBoundInfoAtCoord(k,null,this.getCurrBoundInflation());if(f){var i=f.obj;if(this.isValidMol(i)){h=i}}var g;if(f&&f.boundInfo){g=f.boundInfo.coords[0]}else{g=k}j.preventDefault();j.stopPropagation();this.openSetterUi(g,h);return true}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.FormulaIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.ContentBlockIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ContentBlockIaController",initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("currBlock",{dataType:DataType.OBJECT,serializable:false})},canInteractWithObj:function($super,e){return(e&&this.isValidBlock(e))},isValidBlock:function(e){return e instanceof Kekule.ContentBlock},execute:function(f,e,g){},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MouseButton.LEFT){this.getEditor().setSelection(null);var k=this._getEventMouseCoord(i);var j;var f=this.getEditor().getTopmostBoundInfoAtCoord(k,null,this.getCurrBoundInflation());if(f){var h=f.obj;if(this.isValidBlock(h)){j=h}}var g=j?this.getEditor().getObjectScreenCoord(j):k;i.preventDefault();i.stopPropagation();this.execute(this.getEditor().getChemObj(),g,j);return true}}});Kekule.Editor.TextBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.TextBlockIaController",initialize:function($super,e){$super(e);this._operAddBlock=null},initProperties:function(){this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:false})},isValidBlock:function(e){return e instanceof Kekule.TextBlock},createNewBlock:function(g,i){var f=this.getEditor();if(!f.canCreateNewChild()){return null}f.beginUpdateObject();try{var h=new Kekule.TextBlock();if(h){g.appendChild(h);f.setObjectScreenCoord(h,i,Kekule.Render.CoordPos.CORNER_TL);var e=new Kekule.ChemObjOperation.Add(h,g,null,f);this._operAddBlock=e}}finally{f.endUpdateObject()}return h},getBlockText:function(e){return e.getText()},execute:function(f,e,g){this.openSetterUi(e,g)},getTextSetterWidget:function(h){var f=this.getTextSetter();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createTextSetterWidget(g,e);this.setTextSetter(f)}return f},_createTextSetterWidget:function(h,f){var e=new Kekule.Widget.TextArea(this.getEditor());e.setAutoSizeX(true);e.setAutoSizeY(true);e.setDisplayed(false);e.addClassName(d.CHEMEDITOR_TEXT_SETTER);e.appendToElem(f);var g=this;e.addEventListener("keyup",function(k){var i=k.htmlEvent;var j=i.getKeyCode();if((j===Kekule.X.Event.KeyCode.ENTER)&&(i.getCtrlKey())){g.applySetter(e);e.dismiss()}else{if(j===Kekule.X.Event.KeyCode.ESC){e.dismiss();g.cancelSetter()}}});e.addEventListener("showStateChange",function(i){if(!i.byDomChange){if(!i.isShown&&!i.isDismissed){g.applySetter(e)}if(i.isShown){e._applied=false}}});return e},cancelSetter:function(){if(this._operAddBlock){this._operAddBlock.reverse();this._operAddBlock=null}},applySetter:function(j,h){if(j._applied){return}if(!h){h=this.getCurrBlock()}var g=j.getText();var i;if(!g){if(this._operAddBlock){this.cancelSetter()}else{i=new Kekule.ChemObjOperation.Remove(h,h.getParent(),null,this.getEditor())}}else{i=new Kekule.ChemObjOperation.Modify(h,{text:g},this.getEditor())}if(i){i.execute();var e=this.getEditor();if(e&&e.getEnableOperHistory()){if(this._operAddBlock){var f=new Kekule.MacroOperation();f.add(this._operAddBlock);f.add(i);e.pushOperation(f);this._operAddBlock=null}else{e.pushOperation(i)}}this.doneInsertOrModifyBasicObjects([h])}j._applied=true},openSetterUi:function(l,i){var j=this.getTextSetter();if(j&&j.isShown()){this.applySetter(j,this.getCurrBlock());j._haltPrevShowHideProcess()}if(!i){i=this.createNewBlock(this.getEditor().getChemObj(),l)}if(!this.isValidBlock(i)){return}this.setCurrBlock(i);var n=this.getEditor().getObjectScreenCoord(i,Kekule.Render.CoordPos.CORNER_TL);var o=i.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();o*=(this.getEditor().getZoom()||1);var g=i.getCascadedRenderOption("fontFamily")||"";var m=this.getBlockText(i);var h=this.getTextSetterWidget(true);h._applied=false;h.setValue(m);var e=m||Kekule.$L("ChemWidgetTexts.CAPTION_TEXTBLOCK_INIT");h.setPlaceholder(e);var k=this.getEditor().getCoreElement();h.appendToElem(k);var f=h.getElement().style;f.position="absolute";f.fontSize=o+"px";f.left=n.x+"px";f.top=n.y+"px";f.fontFamily=g;h.show(null,null,Kekule.Widget.ShowHideType.POPUP);(function(){h.selectAll();h.focus()}).defer()}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.TextBlockIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.ImageBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.ImageBlockIaController",initialize:function($super,e){$super(e);this._operAddBlock=null;this._imgProbeElem=null;this._actionOpenFile=this.createOpenAction()},doFinalize:function(){if(this._actionOpenFile){this.actionOpenFile.finalize()}},initProperties:function(){},isValidBlock:function(e){return e instanceof Kekule.ImageBlock},createNewBlock:function(h,k,f,j){var g=this.getEditor();if(!g.canCreateNewChild()){return null}g.beginUpdateObject();try{var i=new Kekule.ImageBlock();if(j){i.setSrc(j)}if(f){i.setSize2D(f)}g.setObjectScreenCoord(i,k,Kekule.Render.CoordPos.CORNER_TL);var e=new Kekule.ChemObjOperation.Add(i,h,null,g);this._operAddBlock=e}finally{g.endUpdateObject()}return i},_getImgFilters:function(){var e=[{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_PNG"),filter:".png"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_JPG"),filter:".jpg,.jpeg"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_GIF"),filter:".gif"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_SVG"),filter:".svg"},Kekule.NativeServices.FILTER_ALL_SUPPORT,Kekule.NativeServices.FILTER_ANY];return e},createOpenAction:function(){var e=new Kekule.ActionFileOpen();e.setFilters(this._getImgFilters());e.on("open",this.reactImageFileOpen,this);return e},reactImageFileOpen:function(i){var h=i.file;if(h){var g=this;var f=new FileReader();f.addEventListener("load",function(){var k=g._getImageProbeElem();var m=k.ownerDocument;try{delete k.width;delete k.height}catch(l){}k.src=f.result;var j=g.getEditor();(function(){var u={x:k.width,y:k.height};if(u.x<=0||u.y<=0){Kekule.error(Kekule.$L("ErrorMsg.INVALID_OR_EMPTY_IMAGE"));return}var q=g._currCoord;var s=j.objCoordToContext(q);var r=Kekule.CoordUtils.add(s,u);var p=j.contextCoordToObj(r);var u=Kekule.CoordUtils.substract(p,q);u=Kekule.CoordUtils.absValue(u);var t=g.getCurrBlock();var n;var e=j.getChemObj();if(t){n=new Kekule.ChemObjOperation.Modify(t,{src:f.result,size2D:u})}else{var o=g.createNewBlock(g.getEditor().getChemObj(),g._currCoord,u,f.result);g.setCurrBlock(o);n=new Kekule.ChemObjOperation.Add(o,e,null,j)}if(n){try{n.execute();if(j&&j.getEnableOperHistory()){j.pushOperation(n)}g.doneInsertOrModifyBasicObjects([g.getCurrBlock()])}finally{}}}).defer()});f.readAsDataURL(h)}},_getImageProbeElem:function(){if(!this._imgProbeElem){var e=this.getEditor().getElement().ownerDocument;this._imgProbeElem=e.createElement("img")}return this._imgProbeElem},execute:function(f,e,g){this.setCurrBlock(g);this._currCoord=e;this._actionOpenFile.execute(this.getEditor())}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.ImageBlockIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.AttachedMarkerIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.AttachedMarkerIaController",initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("markerClass",{dataType:DataType.CLASS,serializable:false});this.defineProp("targetClass",{dataType:DataType.CLASS,serializable:false});this.defineProp("markerClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getMarkerClass())},setter:function(e){this.setMarkerClass(ClassEx.findClass(e))}});this.defineProp("targetClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getTargetClass())},setter:function(e){this.setTargetClass(ClassEx.findClass(e))}});this.defineProp("initialPropValues",{dataType:DataType.HASH})},canInteractWithObj:function($super,e){return this.isValidTarget(e)},isValidTarget:function(f){var e=this.getTargetClass();return(f instanceof e)||!e},createMarker:function(){var e;var g=this.getMarkerClass();if(g){e=new g();var f=this.getInitialPropValues();if(f&&e&&e.setPropValues){e.setPropValues(f)}}return e},createOperations:function(g){var e;var f=this.createMarker();if(f){e=new Kekule.ChemObjOperation.Add(f,g,null,this.getEditor())}return[e]},apply:function(f){var e=this.createOperations(f);var h=(e.length<=0)?null:(e.length===1)?e[0]:new Kekule.MacroOperation(e);if(h){h.execute();var g=this.getEditor();if(g&&g.getEnableOperHistory()){g.pushOperation(h)}}},react_pointerup:function(h){if(h.getButton()===Kekule.X.Event.MouseButton.LEFT){var i=this._getEventMouseCoord(h);var f=this.getEditor().getTopmostBoundInfoAtCoord(i,null,this.getCurrBoundInflation());if(f){var g=f.obj;if(this.isValidTarget(g)){this.apply(g);h.preventDefault();h.stopPropagation()}return true}}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.AttachedMarkerIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolNodeChargeIaController=Class.create(Kekule.Editor.AttachedMarkerIaController,{CLASS_NAME:"Kekule.Editor.MolNodeChargeIaController",initialize:function($super,e){$super(e);this.setChargeInc(1)},initProperties:function(){this.defineProp("chargeInc",{dataType:DataType.NUMBER,serializable:false});this.defineProp("charge",{dataType:DataType.NUMBER,serializable:false});this.defineProp("radical",{dataType:DataType.INT,serializable:false});this.defineProp("currNode",{dataType:DataType.OBJECT,serializable:false})},initPropValues:function($super){$super();this.setTargetClass(Kekule.ChemStructureNode)},createOperations:function(i){var q;var g=false;var f=false;var m={};var n=i.getCharge();if(Kekule.ObjUtils.notUnset(this.getCharge())){if(n!==this.getCharge()){m.charge=this.getCharge();g=true}}else{if(this.getChargeInc()){n+=this.getChargeInc();m.charge=n;g=true}}var o=i.getRadical();if(this.getRadical()!==o){m.radical=this.getRadical();f=true}var q=[];var e=[];var j;var l=this.getEditor();if(g){var k=i.fetchChargeMarker(false);if(m.charge!==0&&!k){j=new Kekule.ChemMarker.Charge();j.setValue(m.charge);e.push(new Kekule.ChemObjOperation.Add(j,i,null,l))}if(m.charge===0&&k){e.push(new Kekule.ChemObjOperation.Remove(k,null,null,l))}}if(f){var p=i.fetchRadicalMarker(false);if(m.radical!==0&&!p){j=new Kekule.ChemMarker.Radical();j.setValue(m.radical);e.push(new Kekule.ChemObjOperation.Add(j,i,null,l))}if(m.radical===0&&p){e.push(new Kekule.ChemObjOperation.Remove(p,null,null,l))}}q=q.concat(e);var h;if(g||f){h=new Kekule.ChemObjOperation.Modify(i,m,this.getEditor());q.push(h)}return q}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolNodeChargeIaController,Kekule.Editor.ChemSpaceEditor)})();(function(){Kekule.Editor.EditorNexus=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.EditorNexus",initialize:function($super,a){$super();this._currInvoker=null;if(a){if(a.editor){this.setEditor(a.editor)}if(a.structureTreeView){this.setStructureTreeView(a.structureTreeView)}if(a.objectInspector){this.setObjectInspector(a.objectInspector)}}},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("editor");this.setPropStoreFieldValue("editor",b);this.editorChanged(b,a)}});this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("structureTreeView");this.setPropStoreFieldValue("structureTreeView",b);this.structureTreeViewChanged(b,a)}});this.defineProp("objectInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("objectInspector");this.setPropStoreFieldValue("objectInspector",b);this.objectInspectorChanged(b,a)}})},editorChanged:function(b,a){if(a){this._uninstallEditorEventHandler(a)}if(b){this._installEditorEventHandler(b)}},structureTreeViewChanged:function(b,a){if(a){this._uninstallStructureTreeViewEventHandler(a)}if(b){this._installStructureTreeViewEventHandler(b);this._updateByEditor()}},objectInspectorChanged:function(c,a){var b=this.getEditor();if(b){if(a){if(a.getOperHistory()===b.getOperHistory()){a.setOperHistory(null)}}if(c){c.setOperHistory(b.getOperHistory());c.setEnableOperHistory(b.getEnableOperHistory());this._updateByEditor()}}},_installEditorEventHandler:function(a){a.addEventListener("change",this._reactEditorChanged,this);a.addEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this);a.addEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_uninstallEditorEventHandler:function(a){a.removeEventListener("change",this._reactEditorChanged,this);a.removeEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this);a.removeEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_installStructureTreeViewEventHandler:function(a){a.addEventListener("change",this._reactStructureTreeViewChanged,this)},_uninstallStructureTreeViewEventHandler:function(a){a.removeEventListener("change",this._reactStructureTreeViewChanged,this)},_reactEditorChanged:function(b){if(this._currInvoker){return}var a=b.target;if(a!==this.getEditor()){return}var d=b.changedPropNames;if(d.indexOf("chemObj")>=0){this.changeRootObj(a.getChemObj(),a)}if(d.indexOf("selection")>=0){this.changeSelection(a.getSelection(),a)}if((d.indexOf("operHistory")>=0)||(d.indexOf("enableOperHistory")>=0)){var c=this.getObjectInspector();if(c){c.setOperHistory(a.getOperHistory());c.setEnableOperHistory(a.getEnableOperHistory())}}},_reactEditorBeginUpdateObject:function(a){this.pauseLiveUpdate()},_reactEditorEndUpdateObject:function(a){this.resumeLiveUpdate()},_updateByEditor:function(){this._reactEditorChanged({target:this.getEditor(),changedPropNames:["chemObj","selection","operHistory"]})},_reactStructureTreeViewChanged:function(b){if(this._currInvoker){return}var a=b.target;if(a!==this.getStructureTreeView()){return}var d=b.changedPropNames;if(d.indexOf("selection")>=0){var c=a.getSelectedChemObjs();this.changeSelection(c,a)}},pauseLiveUpdate:function(){var a=this.getStructureTreeView();if(a){a.pauseLiveUpdate()}},resumeLiveUpdate:function(){var a=this.getStructureTreeView();if(a){a.resumeLiveUpdate()}},changeSelection:function(d,b){this._currInvoker=b;try{var c=this.getEditor();if(c){if(this._currInvoker!==c){c.setSelection(d)}}var a=this.getStructureTreeView();if(a){if(this._currInvoker!==a){a.selectChemObjs(d)}}var e=this.getObjectInspector();if(e){if(this._currInvoker!==e){e.setObjects(d)}}}finally{this._currInvoker=null}},changeRootObj:function(a,c){this._currInvoker=c;try{var d=this.getEditor();if(d&&this._currInvoker!==d){d.setChemObj(a)}var b=this.getStructureTreeView();if(b&&this._currInvoker!==b){b.setRootObj(a)}}finally{this._currInvoker=null}}})})();(function(){var g=Class.PropertyScope;var a=Kekule.ArrayUtils;var c=Kekule.ChemWidget;var e=Kekule.Editor;var b=Kekule.Widget.HtmlClassNames;var f=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER:"K-Chem-Composer",COMPOSER_EDITOR_STAGE:"K-Chem-Composer-Editor-Stage",COMPOSER_ADV_PANEL:"K-Chem-Composer-Adv-Panel",COMPOSER_TOP_REGION:"K-Chem-Composer-Top-Region",COMPOSER_LEFT_REGION:"K-Chem-Composer-Left-Region",COMPOSER_BOTTOM_REGION:"K-Chem-Composer-Bottom-Region",COMPOSER_TOOLBAR:"K-Chem-Composer-Toolbar",COMPOSER_COMMON_TOOLBAR:"K-Chem-Composer-Common-Toolbar",COMPOSER_ZOOM_TOOLBAR:"K-Chem-Composer-Zoom-Toolbar",COMPOSER_CHEM_TOOLBAR:"K-Chem-Composer-Chem-Toolbar",COMPOSER_ASSOC_TOOLBAR:"K-Chem-Composer-Assoc-Toolbar",COMPOSER_STYLE_TOOLBAR:"K-Chem-Composer-Style-Toolbar",COMPOSER_OBJMODIFIER_TOOLBAR:"K-Chem-Composer-ObjModifier-Toolbar",COMPOSER_FONTNAME_BOX:"K-Chem-Composer-FontName-Box",COMPOSER_FONTSIZE_BOX:"K-Chem-Composer-FontSize-Box",COMPOSER_COLOR_BOX:"K-Chem-Composer-Color-Box",COMPOSER_TEXTDIRECTION_BUTTON:"K-Chem-Composer-TextDirection-Button",COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT:"K-Chem-Composer-TextDirection-Button-Default",COMPOSER_TEXTDIRECTION_BUTTON_LTR:"K-Chem-Composer-TextDirection-Button-LTR",COMPOSER_TEXTDIRECTION_BUTTON_RTL:"K-Chem-Composer-TextDirection-Button-RTL",COMPOSER_TEXTDIRECTION_BUTTON_TTB:"K-Chem-Composer-TextDirection-Button-TTB",COMPOSER_TEXTDIRECTION_BUTTON_BTT:"K-Chem-Composer-TextDirection-Button-BTT",COMPOSER_TEXTALIGN_BUTTON:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL:"K-Chem-Composer-TextAlign-Button-Horizontal",COMPOSER_TEXTALIGN_BUTTON_VERTICAL:"K-Chem-Composer-TextAlign-Button-Vertical",COMPOSER_TEXTALIGN_BUTTON_DEFAULT:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_LEADING:"K-Chem-Composer-TextAlign-Button-Leading",COMPOSER_TEXTALIGN_BUTTON_TRAILING:"K-Chem-Composer-TextAlign-Button-Trailing",COMPOSER_TEXTALIGN_BUTTON_CENTER:"K-Chem-Composer-TextAlign-Button-Center",COMPOSER_TEXTALIGN_BUTTON_LEFT:"K-Chem-Composer-TextAlign-Button-Left",COMPOSER_TEXTALIGN_BUTTON_RIGHT:"K-Chem-Composer-TextAlign-Right",COMPOSER_TEXTALIGN_BUTTON_TOP:"K-Chem-Composer-TextAlign-Top",COMPOSER_TEXTALIGN_BUTTON_BOTTOM:"K-Chem-Composer-TextAlign-Bottom",COMPOSER_DIALOG:"K-Chem-ComposerDialog",COMPOSER_FRAME:"K-Chem-ComposerFrame",COMPOSER_FRAME_CONTENT_DOC:"K-Chem-ComposerFrame-ContentDoc",COMPOSER_FRAME_CONTENT_BODY:"K-Chem-ComposerFrame-ContentBody"});Kekule.globalOptions.add("chemWidget.composer",{commonToolButtons:[d.newDoc,d.loadData,d.saveData,d.undo,d.redo,d.copy,d.cut,d.paste,d.zoomIn,d.zoomOut,d.config,d.objInspector],chemToolButtons:[d.manipulate,d.erase,d.molBond,d.molAtomAndFormula,d.molRing,d.molCharge,d.glyph,d.textImage],styleToolComponentNames:[d.fontName,d.fontSize,d.color,d.textDirection,d.textAlign]});Kekule.Editor.ComposerStyleToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerStyleToolbar",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:Kekule.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:b.COLORPICKER_SPEC_COLOR_MIXED},LINKED_VALUE_FIELD:"__$value__",initialize:function($super,h){$super(h);this.setPropStoreFieldValue("composer",h);this.createChildWidgets();this.appendToWidget(h);this._relatedPropNames=(h.getCoordMode()===Kekule.CoordMode.COORD3D)?["renderOptions","render3DOptions"]:["renderOptions"];this.getEditor().addEventListener("selectionChange",function(i){if(!this._isApplying){this.updateStyleValues()}},this);this.getEditor().addEventListener("editObjChanged",function(i){var j=i.propNames;if(!j||!j.length||!Kekule.ArrayUtils.intersect(this._relatedPropNames,j).length){return}if(!this._isApplying){this.updateStyleValues()}},this);this._isApplying=false},doFinalize:function($super){this.clearWidgets();$super()},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false,setter:null});this.defineProp("fontNameBox",{dataType:"Kekule.Widget.ComboBox",serializable:false,setter:null});this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.ComboBox",serializable:false,setter:null});this.defineProp("colorBox",{dataType:"Kekule.Widget.ColorDropButton",serializable:false,setter:null});this.defineProp("textDirectionButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("textHorizontalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("textVerticalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("fontName",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getFontNameBox()?this.getFontNameBox().getValue():null},setter:function(h){if(this.getFontNameBox()){this.getFontNameBox().setValue(h)}}});this.defineProp("fontSize",{dataType:DataType.NUMBER,serializable:false,getter:function(){return this.getFontSizeBox()?parseFloat(this.getFontSizeBox().getValue()):null},setter:function(h){if(this.getFontSizeBox()){this.getFontSizeBox().setValue(h)}}});this.defineProp("color",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getColorBox()?this.getColorBox().getValue():undefined},setter:function(h){if(this.getColorBox()){this.getColorBox().setValue(h)}}});this.defineProp("textDirection",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextDirectionButtonSet())},setter:function(h){this._setButtonSetLinkedValue(this.getTextDirectionButtonSet(),h)}});this.defineProp("textHorizontalAlign",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet())},setter:function(h){this._setButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet(),h)}});this.defineProp("textVerticalAlign",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextVerticalAlignButtonSet())},setter:function(h){this._setButtonSetLinkedValue(this.getTextVerticalAlignButtonSet(),h)}});this.defineProp("componentNames",{dataType:DataType.ARRAY,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("componentNames");if(!h){h=this.getDefaultComponentNames();this.setPropStoreFieldValue("componentNames",h)}return h},setter:function(h){this.setPropStoreFieldValue("componentNames",h);this.recreateComponents()}})},initPropValues:function($super){$super();this.setShowGlyph(true)},removeWidget:function($super,i,h){if(i===this.getFontNameBox()){this.setPropStoreFieldValue("fontNameBox",null)}if(i===this.getFontSizeBox()){this.setPropStoreFieldValue("fontSizeBox",null)}if(i===this.getColorBox()){this.setPropStoreFieldValue("colorBox",null)}if(i===this.getTextDirectionButtonSet()){this.setPropStoreFieldValue("textDirectionButtonSet",null)}if(i===this.getTextHorizontalAlignButtonSet()){this.setPropStoreFieldValue("textHorizontalAlignButtonSet",null)}if(i===this.getTextVerticalAlignButtonSet()){this.setPropStoreFieldValue("textVerticalAlignButtonSet",null)}$super(i,h)},doGetWidgetClassName:function($super){var h=$super()+" "+f.COMPOSER_TOOLBAR+" "+f.COMPOSER_STYLE_TOOLBAR;return h},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},createChildWidgets:function(n){if(!n){n=this.getComponentNames()}for(var m=0,k=n.length;m<k;++m){var h=n[m];if(h===d.fontName){var r=new Kekule.Widget.ComboBox(this);this.fillFontNameBox(r);r.addClassName(f.COMPOSER_FONTNAME_BOX);r.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME"));r.addEventListener("valueChange",function(i){this.applyFontName()},this);this.setPropStoreFieldValue("fontNameBox",r)}else{if(h===d.fontSize){r=new Kekule.Widget.ComboBox(this);this.fillFontSizeBox(r);r.addClassName(f.COMPOSER_FONTSIZE_BOX);r.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE"));r.addEventListener("valueChange",function(i){this.applyFontSize()},this);this.setPropStoreFieldValue("fontSizeBox",r)}else{if(h===d.color){var p=new Kekule.Widget.ColorDropButton(this);p.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR"));p.setShowText(false);p.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]);p.addClassName(f.COMPOSER_COLOR_BOX);p.addEventListener("valueChange",function(i){this.applyColor()},this);this.setPropStoreFieldValue("colorBox",p)}else{if(h===d.textDirection){var q=Kekule.Render.TextDirection;var o=[{value:q.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT},{value:q.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_LTR},{value:q.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_RTL},{value:q.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_TTB},{value:q.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_BTT}];var j=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION"),f.COMPOSER_TEXTDIRECTION_BUTTON,o);j.addEventListener("select",function(i){this.applyTextDirection()},this);this.setPropStoreFieldValue("textDirectionButtonSet",j)}else{if(h===d.textAlign){var s=Kekule.Render.TextAlign;var o=[{value:s.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:f.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:s.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:f.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:s.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:f.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:s.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:f.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:s.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT"),className:f.COMPOSER_TEXTALIGN_BUTTON_LEFT},{value:s.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT"),className:f.COMPOSER_TEXTALIGN_BUTTON_RIGHT}];var j=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN"),f.COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL,o);j.addEventListener("select",function(i){this.applyTextHorizontalAlign()},this);this.setPropStoreFieldValue("textHorizontalAlignButtonSet",j);var s=Kekule.Render.TextAlign;var o=[{value:s.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:f.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:s.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:f.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:s.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:f.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:s.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:f.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:s.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP"),className:f.COMPOSER_TEXTALIGN_BUTTON_TOP},{value:s.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM"),className:f.COMPOSER_TEXTALIGN_BUTTON_BOTTOM}];var j=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN"),f.COMPOSER_TEXTALIGN_BUTTON_VERTICAL,o);j.addEventListener("select",function(i){this.applyTextVerticalAlign()},this);this.setPropStoreFieldValue("textVerticalAlignButtonSet",j)}}}}}}this.updateStyleValues()},_createStyleButtonSet:function(r,n,p,q){var j=new Kekule.Widget.CompactButtonSet(this);j.setText(r);j.setHint(n);j.addClassName(p);j.setShowText(false);j.setShowCompactMark(false);j.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);j.getButtonSet().addClassName(f.COMPOSER_STYLE_TOOLBAR);j.getButtonSet().setShowText(true);if(q){for(var o=0,m=q.length;o<m;++o){var k=q[o];var h=new Kekule.Widget.RadioButton(j,k.text||"");h.setHint(k.hint||"");h.addClassName(k.className);h[this.LINKED_VALUE_FIELD]=k.value;j.append(h,k.selected)}}return j},_getButtonSetLinkedValue:function(h){var i=h?h.getSelected():null;return i?i[this.LINKED_VALUE_FIELD]:undefined},_setButtonSetLinkedValue:function(j,n){if(j){var o=j.getButtonSet();var m=o.getChildWidgets();j.setSelected(null);for(var k=0,h=m.length;k<h;++k){var p=m[k];if(p.hasOwnProperty(this.LINKED_VALUE_FIELD)){if(p[this.LINKED_VALUE_FIELD]==n){j.setSelected(p);break}}}}},getDefaultComponentNames:function(){return Kekule.globalOptions.chemWidget.composer.styleToolComponentNames},recreateComponents:function(){var h=this.getComponentNames();this.clearWidgets();this.createChildWidgets(h)},fillFontSizeBox:function(n){var m=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes();var j=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:undefined}];for(var k=0,h=m.length;k<h;++k){j.push({text:m[k]+" px",value:m[k]})}n.setItems(j)},fillFontNameBox:function(n){var m=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames();var j=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}];for(var k=0,h=m.length;k<h;++k){j.push({text:m[k],value:m[k]})}n.setItems(j)},applyStyle:function(h,j,k){this._isApplying=true;try{var i=this.getEditor();i.modifyObjectsRenderOptions(h,j,k,true)}finally{this._isApplying=false}},getStyleValue:function(h,j,i){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(h,j,i)},applyStyleToEditorSelection:function(h,i){var j=this.getEditor().getSelection();if(j&&j.length){return this.applyStyle(j,h,i)}},applyFontName:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getFontName();this.applyStyle(i,{fontFamily:h})}},applyFontSize:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getFontSize();this.applyStyle(i,{fontSize:h})}},applyColor:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getColor();if(h===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value){this.applyStyle(i,{useAtomSpecifiedColor:true,color:undefined})}else{if(h==Kekule.Widget.ColorPicker.SpecialColors.UNSET){h=undefined}this.applyStyle(i,{useAtomSpecifiedColor:false,color:h})}}},applyTextDirection:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getTextDirection();this.applyStyle(i,{charDirection:h})}},applyTextHorizontalAlign:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getTextHorizontalAlign();this.applyStyle(i,{horizontalAlign:h})}},applyTextVerticalAlign:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getTextVerticalAlign();this.applyStyle(i,{verticalAlign:h})}},updateStyleValues:function(h){if(!h){h=this.getEditor().getSelection()}if(h&&h.length){this.updateFontName(h);this.updateFontSize(h);this.updateColor(h);this.updateTextDirection(h);this.updateTextHorizontalAlign(h);this.updateTextVerticalAlign(h)}},updateFontName:function(i){if(i&&i.length&&this.getFontNameBox()){var h=this.getStyleValue(i,"fontFamily");this.setFontName(h||"")}},updateFontSize:function(i){if(i&&i.length&&this.getFontSizeBox()){var h=this.getStyleValue(i,"fontSize");this.setFontSize(h||undefined)}},updateColor:function(j){if(j&&j.length&&this.getColorBox()){var h;var i=this.getStyleValue(j,"useAtomSpecifiedColor");var h=this.getStyleValue(j,"color");this.getColorBox().setColorClassName(null);if(h){this.getColorBox().setColorClassName(null)}else{if(i){h=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value;this.getColorBox().setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className)}}this.setColor(h||undefined)}},updateTextDirection:function(i){if(i&&i.length&&this.getTextDirectionButtonSet()){var h=this.getStyleValue(i,"charDirection");this.setTextDirection(h)}},updateTextHorizontalAlign:function(i){if(i&&i.length&&this.getTextHorizontalAlignButtonSet()){var h=this.getStyleValue(i,"horizontalAlign");this.setTextHorizontalAlign(h)}},updateTextVerticalAlign:function(i){if(i&&i.length&&this.getTextVerticalAlignButtonSet()){var h=this.getStyleValue(i,"verticalAlign");this.setTextVerticalAlign(h)}},updateState:function(){var i=this.getEditor();var h=(i&&i.hasSelection());if(this.getFontNameBox()){this.getFontNameBox().setEnabled(h)}if(this.getFontSizeBox()){this.getFontSizeBox().setEnabled(h)}if(this.getColorBox()){this.getColorBox().setEnabled(h)}if(this.getTextDirectionButtonSet()){this.getTextDirectionButtonSet().setEnabled(h)}if(this.getTextHorizontalAlignButtonSet()){this.getTextHorizontalAlignButtonSet().setEnabled(h)}if(this.getTextVerticalAlignButtonSet()){this.getTextVerticalAlignButtonSet().setEnabled(h)}}});Kekule.Editor.ComposerObjModifierToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerObjModifierToolbar",initialize:function($super,h){$super(h);this.setPropStoreFieldValue("modifiers",[]);this.setPropStoreFieldValue("modifierMap",new Kekule.MapEx());this.setPropStoreFieldValue("composer",h);this.appendToWidget(h);h.addEventListener("selectionChange",function(i){if(!this._isApplying){this.updateModifierValues()}},this);h.addEventListener("selectedObjsUpdated",function(i){if(!this._isApplying){if(h.getEditor().isManipulatingObject()){this._suppressUpdateModifierValuesInManipulation=true}else{this.updateModifierValues()}}},this);h.addEventListener("endManipulateObject",function(i){if(this._suppressUpdateModifierValuesInManipulation){this.updateModifierValues();this._suppressUpdateModifierValuesInManipulation=false}},this);this._isApplying=false},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false,setter:null});this.defineProp("modifierMap",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("modifiers",{dataType:DataType.ARRAY,serializable:false,setter:null})},initPropValues:function($super){$super();this.setShowGlyph(true)},doFinalize:function($super){this.clearWidgets();this.getModifierMap().finalize();var j=this.getModifiers();for(var k=0,h=j.length;k<h;++k){j[k].finalize()}$super()},doGetWidgetClassName:function($super){var h=$super()+" "+f.COMPOSER_TOOLBAR+" "+f.COMPOSER_OBJMODIFIER_TOOLBAR;return h},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getAllowedModifierCategories:function(){var h=this.getComposer();return h&&h.getAllowedObjModifierCategories()},getTargetObjs:function(){return this.getEditor().getSelection()},getAvailableModifierClasses:function(){var m=[];var k=this.getTargetObjs();for(var n=0,j=k.length;n<j;++n){if(k[n].getClass){a.pushUnique(m,k[n].getClass())}}var h=[];var p=this.getAllowedModifierCategories();for(var n=0,j=m.length;n<j;++n){var o=Kekule.Editor.ObjModifierManager.getModifierClasses(m[n],p);if(o){a.pushUnique(h,o)}}if(h.length){h.sort(function(l,i){var t=l&&ClassEx.getPrototype(l);var s=i&&ClassEx.getPrototype(i);var r=t&&t.getModifierName&&t.getModifierName();var q=s&&s.getModifierName&&s.getModifierName();return(r===q)?0:(r<q)?-1:1})}return h},getModifierInstanceOfClass:function(i,j){var k=this.getModifierMap();var h=k.get(i);if(!h&&j){h=new i(this.getEditor());k.set(i,h)}return h},updateModifierWidgets:function(){var k=[];this.clearWidgets(true);var p=this.getAvailableModifierClasses();for(var m=0,j=p.length;m<j;++m){var n=p[m];var h=this.getModifierInstanceOfClass(n,true);var o=h.getWidget();if(o){this.appendWidget(o);k.push(h)}}this.setPropStoreFieldValue("modifiers",k);this.updateModifierValues();if(this._isAllModifierWidgetButtons(k)){this.removeClassName(b.TOOLBAR).addClassName(b.BUTTON_GROUP)}else{this.removeClassName(b.BUTTON_GROUP).addClassName(b.TOOLBAR)}},updateState:function(){this.updateModifierWidgets()},updateModifierValues:function(){var j=this.getModifiers();for(var k=0,h=j.length;k<h;++k){j[k].loadFromTargets()}},_isAllModifierWidgetButtons:function(n){for(var o=0,k=n.length;o<k;++o){var h=n[o];var j=h&&h.getWidget();if(!j||!j.getDisplayed()||j instanceof Kekule.Widget.Button){continue}else{return false}}return true}});Kekule.Editor.Composer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.Composer",BINDABLE_TAG_NAMES:["div"],CHEM_TOOL_CHILD_FIELDS:"__$children__",initialize:function($super,h,i){this.updateSelectionAssocToolbarStateBind=this.updateSelectionAssocToolbarState.bind(this);this.setPropStoreFieldValue("enableStyleToolbar",true);this.setPropStoreFieldValue("enableObjModifierToolbar",true);this.setPropStoreFieldValue("editor",i);this.setPropStoreFieldValue("editorNexus",new Kekule.Editor.EditorNexus());$super(h);this.bindEditor(i);if(!this.getCommonBtnGroup()){this.createCommonToolbar()}if(!this.getChemBtnGroup()){this.createChemToolbar()}if(!this.getZoomBtnGroup()){this.createZoomToolbar()}this.uiLayoutChanged()},doFinalize:function($super){var h=this.getCommonBtnGroup();if(h){h.finalize()}var h=this.getChemBtnGroup();if(h){h.finalize()}var i=this.getPropStoreFieldValue("editor");if(i){i.finalize()}this.getEditorNexus().finalize();$super()},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("editor");if(!h){h=this.createDefaultEditor();this.setPropStoreFieldValue("editor",h)}return h}});this.defineProp("showInspector",{dataType:DataType.BOOL,setter:function(h){if(this.getShowInspector()!==h){this.setPropStoreFieldValue("showInspector",h);this.showInspectorChanged()}}});this.defineProp("autoSetMinDimension",{dataType:DataType.BOOL});this.defineProp("editorStageElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("advPanelElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("topRegionElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("leftRegionElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("bottomRegionElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("editorNexus",{dataType:"Kekule.Editor.EditorNexus",serializable:false,setter:null});this.defineProp("objInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:false,setter:null});this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:false,setter:null});this.defineProp("commonBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("zoomBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("chemBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("assocBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("styleToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:false,getter:function(){var h=this.getPropStoreFieldValue("styleToolbar");if(!h){if(this.getEnableStyleToolbar()){h=this.createStyleToolbar();this.setPropStoreFieldValue("styleToolbar",h)}}return h}});this.defineProp("styleToolComponentNames",{dataType:DataType.ARRAY,serializable:false,getter:function(){var h=this.getStyleToolbar();return h?h.getComponentNames():null},setter:function(i){var h=this.getStyleToolbar();if(h){h.setComponentNames(i)}return this}});this.defineProp("enableStyleToolbar",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableStyleToolbar")&&!this.getEnableObjModifierToolbar()},setter:function(h){this.setPropStoreFieldValue("enableStyleToolbar",h);this.updateSelectionAssocToolbarState()}});this.defineProp("objModifierToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:false,getter:function(){var h=this.getPropStoreFieldValue("objModifierToolbar");if(!h){if(this.getEnableObjModifierToolbar()){h=this.createObjModifierToolbar();this.setPropStoreFieldValue("objModifierToolbar",h)}}return h}});this.defineProp("enableObjModifierToolbar",{dataType:DataType.BOOL,setter:function(h){this.setPropStoreFieldValue("enableObjModifierToolbar",h);this.updateSelectionAssocToolbarState()}});this.defineProp("allowedObjModifierCategories",{dataType:DataType.ARRAY});this.defineProp("commonToolButtons",{dataType:DataType.HASH,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("commonToolButtons");if(!h){h=this.getDefaultCommonToolBarButtons();this.setPropStoreFieldValue("commonToolButtons",h)}return h},setter:function(h){this.setPropStoreFieldValue("commonToolButtons",h);this.updateCommonToolbar();this.updateZoomToolbar()}});this.defineProp("chemToolButtons",{dataType:DataType.HASH,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("chemToolButtons");if(!h){h=this.getDefaultChemToolBarButtons();this.setPropStoreFieldValue("chemToolButtons",h)}return h},setter:function(h){this.setPropStoreFieldValue("chemToolButtons",h);this.updateChemToolbar()}});this.defineProp("styleBarComponents",{dataType:DataType.ARRAY,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("styleBarComponents");if(!h){h=null;this.setPropStoreFieldValue("styleBarComponents",h)}return h},setter:function(h){this.setPropStoreFieldValue("styleBarComponents",h);if(this.getStyleToolbar()){this.getStyleToolbar().setComponentNames(h)}}});this.defineProp("commonActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("commonActions");if(!h){h=new Kekule.ActionList();this.setPropStoreFieldValue("commonActions",h)}return h}});this.defineProp("zoomActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("zoomActions");if(!h){h=new Kekule.ActionList();this.setPropStoreFieldValue("zoomActions",h)}return h}});this.defineProp("chemActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("chemActions");if(!h){h=new Kekule.ActionList();this.setPropStoreFieldValue("chemActions",h)}return h}});this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("actionMap");if(!h){h=new Kekule.MapEx();this.setPropStoreFieldValue("actionMap",h)}return h}});this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,getter:function(){var h=this.getEditor();return(h&&h.getAllowCreateNewChild)?h.getAllowCreateNewChild():null},setter:function(i){var h=this.getEditor();if(h.setAllowCreateNewChild){h.setAllowCreateNewChild(i)}return this}});this._defineEditorDelegatedProp("chemObj");this._defineEditorDelegatedProp("chemObjLoaded");this._defineEditorDelegatedProp("renderType");this._defineEditorDelegatedProp("renderConfigs");this._defineEditorDelegatedProp("drawOptions");this._defineEditorDelegatedProp("allowCoordBorrow");this._defineEditorDelegatedProp("editorConfigs");this._defineEditorDelegatedProp("operHistory");this._defineEditorDelegatedProp("enableOperHistory");this._defineEditorDelegatedProp("selection");this._defineEditorDelegatedProp("hotTrackedObjs");this._defineEditorDelegatedProp("enableOperContext");this._defineEditorDelegatedProp("enableCreateNewDoc");this._defineEditorDelegatedProp("enableLoadNewFile");this._defineEditorDelegatedProp("initOnNewDoc")},_defineEditorDelegatedProp:function(k,h){if(!h){h=k}var j=ClassEx.getPropInfo(Kekule.Editor.BaseEditor,h);var i=Object.create(j);i.getter=null;i.setter=null;if(j.getter){i.getter=function(){return this.getEditor().getPropValue(h)}}if(j.setter){i.setter=function(l){this.getEditor().setPropValue(h,l)}}return this.defineProp(k,i)},loadPredefinedResDataToProp:function(i,h,k){if(i==="chemObj"){if(k){try{var l=Kekule.IO.loadTypedData(h.data,h.resType,h.resUri);this.setChemObj(l)}catch(j){Kekule.raise(j,Kekule.ExceptionLevel.ERROR)}}else{Kekule.throwException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+h.resUri||"")}}},initPropValues:function($super){$super()},doCreateRootElement:function(i){var h=i.createElement("div");return h},doCreateSubElements:function(k,i){var h=[];var j=this._doCreateSubElement(k,i,"div",f.COMPOSER_EDITOR_STAGE,"editorStageElem");h.push(j);j=this._doCreateSubElement(k,i,"div",f.COMPOSER_ADV_PANEL,"advPanelElem");h.push(j);h.push(this._doCreateSubElement(k,i,"div",f.COMPOSER_TOP_REGION,"topRegionElem"));h.push(this._doCreateSubElement(k,i,"div",f.COMPOSER_LEFT_REGION,"leftRegionElem"));h.push(this._doCreateSubElement(k,i,"div",f.COMPOSER_BOTTOM_REGION,"bottomRegionElem"));return h},_doCreateSubElement:function(m,i,l,j,k){var h=m.createElement(l);h.className=j;if(i){i.appendChild(h)}if(k){this.setPropStoreFieldValue(k,h)}return h},doGetWidgetClassName:function($super){var h=$super()+" "+f.COMPOSER;return h},doWidgetShowStateChanged:function($super,h){$super(h);if(h){this.adjustComponentPositions()}},getResizerElement:function(){return this.getEditorStageElem()},getChildActionClass:function($super,i,j){var h=$super(i,j);if(!h){h=this.getEditor().getChildActionClass(i,j)}return h},getCoordMode:function(){return this.getEditor().getCoordMode()},isDirty:function(){return this.getEditor().isDirty()},newDoc:function(){return this.getEditor().newDoc()},load:function(h){return this.getEditor().load(h)},getSavingTargetObj:function(){var h=this.getEditor();if(h){return h.getSavingTargetObj()}else{return null}},getExportableClasses:function(){return this.getEditor().getExportableClasses()},exportObj:function(h){return this.getEditor().exportObj(h)},exportObjs:function(h){return this.getEditor().exportObjs(h)},undo:function(){return this.getEditor().undo()},redo:function(){return this.getEditor().redo()},undoAll:function(){return this.getEditor().undoAll()},canUndo:function(){return this.getEditor().canUndo()},canRedo:function(){return this.getEditor().canRedo()},repaint:function(h){this.getEditor().repaint(h);return this},uiLayoutChanged:function(){this.adjustComponentPositions()},doResize:function($super){this.adjustComponentPositions()},adjustComponentPositions:function(){var u=this.getCommonBtnGroup()?this.getCommonBtnGroup().getElement():null;var w=this.getZoomBtnGroup()?this.getZoomBtnGroup().getElement():null;var i=this.getChemBtnGroup()?this.getChemBtnGroup().getElement():null;if(!u||!i){return}if(u){var s=Kekule.HtmlElementUtils.getElemPageRect(u)}if(w){var o=Kekule.HtmlElementUtils.getElemPageRect(w)}if(i){var v=Kekule.HtmlElementUtils.getElemPageRect(i)}if(!s.width||!v.width){return}var p=s.height;var B=v.width;var A=(o&&o.height)||p;var y=this.getTopRegionElem();var x=y.style;x.top="0px";x.left=B+"px";x.right="0px";x.height=p+"px";y=this.getBottomRegionElem();x=y.style;x.bottom="0px";x.height=A+"px";x.left=B+"px";x.right="0px";var t=Kekule.HtmlElementUtils.getElemPageRect(y);var j=t.width-(o?o.width:0);y=this.getLeftRegionElem();x=y.style;x.left="0px";x.top=p+"px";x.bottom="0px";x.width=B+"px";var m=Kekule.HtmlElementUtils.getElemPageRect(y);var l=m.height-v.height;if(l/j>0.9){this.changeAssocToolbarRegion(true)}else{this.changeAssocToolbarRegion(false)}var r=p,k=B,n=A,z;if(!this.getShowInspector()){z=0}else{var y=this.getAdvPanelElem();var h=Kekule.HtmlElementUtils.getElemPageRect(y);z=h.width}var C=this.getEditorStageElem();var x=C.style;x.position="absolute";x.top=r+"px";x.left=k+"px";x.bottom=n+"px";x.right=z+"px";y=this.getAdvPanelElem();x=y.style;x.position="absolute";x.top=r+"px";x.bottom=n+"px";if(this.getAutoSetMinDimension()){var q={width:B+s.width,height:p+v.height};if(q.width&&q.height){this.setMinDimension(q)}}},adjustAssocToolbarPositions:function(){this.adjustStyleAndObjModifierToolbarPosition()},adjustStyleAndObjModifierToolbarPosition:function(){},bindEditor:function(k){if(!k){k=this.getEditor()}else{k.setParent(this)}k.setTouchAction("none");var i=this;var h=this.getCommonActions();var j=this.getChemActions();this.createIaControllers(k);k.addEventListener("load",function(m){this.updateAllActions();this.updateUiWidgets();var n=this.getChemActions();var l=n.getActionAt(0);if(l){l.execute()}},this);k.addEventListener("operChange",function(l){h.updateAll();this.updateUiWidgets()},this);k.addEventListener("selectionChange",function(l){h.updateAll();this.updateUiWidgets()},this);k.appendToElem(this.getEditorStageElem());this.getEditorNexus().setEditor(k)},createDefaultEditor:function(){var h=new Kekule.Editor.ChemSpaceEditor(this,null,Kekule.Render.RendererType.R2D);h.addClassName(b.DYN_CREATED);return h},createIaControllers:function(n){var m=Kekule.Editor.IaControllerManager.getAvailableControllerClasses(n.getClass());for(var k=0,j=m.length;k<j;++k){var o=m[k];var h=new o(n);n.addIaController(h.getDefId(),h)}},showInspectorChanged:function(){var h=this.getShowInspector();if(h){if(!this.getObjInspector()){this.createAdvControls()}this.showAdvPanel()}else{this.hideAdvPanel()}this.uiLayoutChanged()},createAdvControls:function(h){if(!h){h=this.getAdvPanelElem()}var k=this.getDocument();var i=new Kekule.ChemWidget.StructureTreeView(k);i.setItemInitialExpanded(true);i.appendToElem(h);this.setPropStoreFieldValue("structureTreeView",i);var l=new Kekule.Widget.ObjectInspector(k);l.setShowPropInfoPanel(false);l.appendToElem(h);this.setPropStoreFieldValue("objInspector",l);var j=this.getEditorNexus();j.setObjectInspector(l);j.setStructureTreeView(i)},showAdvPanel:function(){this.getAdvPanelElem().style.display="block"},hideAdvPanel:function(){this.getAdvPanelElem().style.display="none"},getDefaultCommonToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.commonToolButtons},getZoomButtonNames:function(){return[d.zoomIn,d.zoomOut,d.reset,d.resetZoom]},getDefaultChemToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.chemToolButtons},getCompActionClass:function(h){return this.getChildActionClass(h,true)},_getActionTargetWidget:function(h){if(ClassEx.isOrIsDescendantOf(h,Kekule.Editor.ActionOnComposer)||ClassEx.isOrIsDescendantOf(h,Kekule.Widget.ActionOpenConfigWidget)){return this}else{return this.getEditor()}},createToolButton:function(p,n,k,o){var r=null;var i=DataType.isObjectValue(p)?p.name:p;var l=this.getCompActionClass(i);var j=this._createToolButtonAction(p,k,o);if(DataType.isObjectValue(p)&&!l){if(!l){var m=Object.extend({widget:Kekule.Widget.Button},p)}r=Kekule.Widget.Utils.createFromHash(n,m)}else{var q=j.getPreferredWidgetClass&&j.getPreferredWidgetClass();var h=q?q:(p===d.objInspector)?Kekule.Widget.CheckButton:(!!o)?Kekule.Widget.RadioButton:Kekule.Widget.Button;r=new h(n)}if(j){r.setAction(j)}return r},_createActionButton:function(l,h){var k=l.getCheckGroup();var j=l.getPreferredWidgetClass&&l.getPreferredWidgetClass();var m=j?j:(!!k)?Kekule.Widget.RadioButton:Kekule.Widget.Button;var i=new m(h);i.setAction(l);return i},_createToolButtonAction:function(w,D,B){var r=null;var E=DataType.isObjectValue(w)?w.name:w;var o=DataType.isObjectValue(w)?w.attached:null;var k=this.getCompActionClass(E);var r;if(DataType.isObjectValue(w)&&!k){var n=w;var k=n.actionClass;if(k){if(typeof(k)==="string"){k=ClassEx.findClass(n.actionClass)}}}if(k){var j=this.getActionMap();var r=j.get(k);if(!r){var r=new k(this._getActionTargetWidget(k));j.set(k,r)}var t=B||"";var x=r.getExplicitGroup&&r.getExplicitGroup();if(Kekule.ObjUtils.notUnset(x)){t=x}if(t){r.setCheckGroup(t)}if(r&&D){D.add(r)}if(r&&r.addAttachedAction){var A=r.getClassName();var C=Kekule.ArrayUtils.clone(r.getAttachedActions().getActions()||[]);var m=function(G,F,i,l,I){if(!F){return null}var H=i.indexOf(F);if(H>=0){i[H]=null}else{G.addAttachedAction(F,l)}if(Kekule.ObjUtils.notUnset(I)){G.setAttachedActionIndex(F,I)}};if(o){for(var z=0,y=o.length;z<y;++z){var q=o[z];var p=this._createToolButtonAction(q,null,A);m(r,p,C,z===0,z)}}else{var u=r.getAttachedActionClasses();if(u){for(var z=0,y=u.length;z<y;++z){var v=u[z];var p=j.get(v);if(!p){p=new v(this._getActionTargetWidget(v));var h=(p.getExplicitGroup&&p.getExplicitGroup());if(Kekule.ObjUtils.notUnset(h)){p.setCheckGroup(h)}else{p.setCheckGroup(A)}j.set(v,p)}m(r,p,C,z===0,z)}}}if(C.length){for(var z=0,y=C.length;z<y;++z){var s=C[z];if(s){r.removeAttachedAction(s);j.remove(s.getClass())}}}}}return r},createInnerToolbar:function(h){var i=new Kekule.Widget.ButtonGroup(this);i.addClassName(f.COMPOSER_TOOLBAR);i.addClassName(f.INNER_TOOLBAR);i.addClassName(b.DYN_CREATED);i.setShowText(false);i.doSetShowGlyph(true);i.appendToElem(h||this.getElement());return i},createCommonToolbar:function(){var p=this.getTopRegionElem();var r=this.createInnerToolbar(p);r.addClassName(f.COMPOSER_COMMON_TOOLBAR);var n=this.getCommonToolButtons();n=Kekule.ArrayUtils.exclude(n,this.getZoomButtonNames());var m=this.getCommonActions();var q=this.getEditor();m.clear();for(var o=0,k=n.length;o<k;++o){var h=n[o];var j=this.createToolButton(h,r,m)}this.setCommonBtnGroup(r);r.addClassName(b.DYN_CREATED);this.updateZoomToolbar();this.adjustComponentPositions();return r},createZoomToolbar:function(){var n=Kekule.ArrayUtils.intersect(this.getCommonToolButtons(),this.getZoomButtonNames());if(n.length){var p=this.getBottomRegionElem();var r=this.createInnerToolbar(p);r.addClassName(f.COMPOSER_ZOOM_TOOLBAR);var m=this.getZoomActions();var q=this.getEditor();m.clear();for(var o=0,k=n.length;o<k;++o){var h=n[o];var j=this.createToolButton(h,r,m)}this.setZoomBtnGroup(r);r.addClassName(b.DYN_CREATED);this.adjustComponentPositions();return r}else{this.setZoomBtnGroup(null);return null}},updateCommonToolbar:function(){var h=this.getCommonBtnGroup();if(h){h.finalize()}this.createCommonToolbar()},updateZoomToolbar:function(){var h=this.getZoomBtnGroup();if(h){h.finalize()}this.createZoomToolbar()},createChemToolbar:function(){var q=this.getLeftRegionElem();var t=this.createInnerToolbar(q);t.addClassName(f.COMPOSER_CHEM_TOOLBAR);t.setLayout(Kekule.Widget.Layout.VERTICAL);var o=this.getChemToolButtons();var n=this.getChemActions();n.clear();var s="chemTools";var r;for(var p=0,k=o.length;p<k;++p){var h=o[p];var j=this.createToolButton(h,t,n,s);if(p===0){r=j}}this.setChemBtnGroup(t);t.addClassName(b.DYN_CREATED);this.adjustComponentPositions();if(r){var m=r.getAction();if(m){m.setChecked(true);var u=m.getAttachedActions&&m.getAttachedActions();this.bindAssocActions(u||null)}}return t},updateChemToolbar:function(){var h=this.getChemBtnGroup();if(h){h.finalize()}this.createChemToolbar()},createAssocToolbar:function(){var h=this.getBottomRegionElem();var i=this.createInnerToolbar(h);i.addClassName(f.COMPOSER_ASSOC_TOOLBAR);this.setAssocBtnGroup(i);this.adjustAssocToolbarPositions();i.addClassName(b.DYN_CREATED);return i},changeAssocToolbarRegion:function(i){var k=this.getAssocBtnGroup();if(!k){k=this.createAssocToolbar()}var j;if(i){j=this.getLeftRegionElem();if(k.getElement().parentNode!==j){k.setLayout(Kekule.Widget.Layout.VERTICAL);k.appendToElem(j)}}else{j=this.getBottomRegionElem();if(k.getElement().parentNode!==j){k.setLayout(Kekule.Widget.Layout.HORIZONTAL);var h=Kekule.DomUtils.getFirstChildElem(j);j.insertBefore(k.getElement(),h)}}},showAssocToolbar:function(){var i=this.getAssocBtnGroup();if(!i){i=this.createAssocToolbar()}var h=this;i.show(null,function(){h.uiLayoutChanged();setTimeout(h.updateSelectionAssocToolbarStateBind,0)});return this},hideAssocToolbar:function(){var i=this.getAssocBtnGroup();if(i){var h=this;i.hide(null,function(){h.uiLayoutChanged();setTimeout(h.updateSelectionAssocToolbarStateBind,0)})}return this},isAssocToolbarShown:function(){var h=this.getAssocBtnGroup();return h&&h.isShown()},bindAssocActions:function(o){var m=this.getAssocBtnGroup();if(!m){m=this.createAssocToolbar()}m.clearWidgets();if(o){for(var k=0,h=o.getActionCount();k<h;++k){var n=o.getActionAt(k);var j=this._createActionButton(n,m)}}},createObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var h=new Kekule.Editor.ComposerObjModifierToolbar(this);h.appendToElem(this.getBottomRegionElem());this.setObjModifierToolbar(h);this.adjustAssocToolbarPositions();this.updateObjModifierToolbarState();return h}else{return null}},showObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var i=this.getObjModifierToolbar();if(!i.isShown()){var h=this;i.show(null,function(){h.uiLayoutChanged()})}}return this},hideObjModifierToolbar:function(){var i=this.getPropStoreFieldValue("objModifierToolbar");if(i){if(i.isShown()){var h=this;i.hide(null,function(){h.uiLayoutChanged()},null,{instantly:true})}}return this},isObjModifierToolbarShown:function(){var h=this.getPropStoreFieldValue("objModifierToolbar");return(h&&h.isShown())},updateObjModifierToolbarState:function(){var h=false;if(this.getEnableObjModifierToolbar()&&this.needShowSelectionAssocToolbar()){h=true}if(h){this.showObjModifierToolbar();this.getObjModifierToolbar().updateState()}else{this.hideObjModifierToolbar()}},createStyleToolbar:function(){if(this.getEnableStyleToolbar()){var h=new Kekule.Editor.ComposerStyleToolbar(this);h.setComponentNames(this.getStyleBarComponents());h.appendToElem(this.getBottomRegionElem());this.setStyleToolbar(h);this.adjustAssocToolbarPositions();this.updateStyleToolbarState();return h}else{return null}},showStyleToolbar:function(){if(this.getEnableStyleToolbar()){var i=this.getStyleToolbar();if(!i.isShown()){var h=this;i.show(null,function(){h.uiLayoutChanged()})}}return this},hideStyleToolbar:function(){var i=this.getPropStoreFieldValue("styleToolbar");if(i){if(i.isShown()){var h=this;i.hide(null,function(){h.uiLayoutChanged()})}}return this},isStyleToolbarShown:function(){var h=this.getPropStoreFieldValue("styleToolbar");return(h&&h.isShown())},updateStyleToolbarState:function(){if(this.getEnableStyleToolbar()&&this.needShowSelectionAssocToolbar()){this.showStyleToolbar();this.getStyleToolbar().updateState()}else{this.hideStyleToolbar()}},needShowSelectionAssocToolbar:function(){var h=this.getEditor();return h&&h.hasSelection()},updateSelectionAssocToolbarState:function(){this.adjustStyleAndObjModifierToolbarPosition();this.updateStyleToolbarState();this.updateObjModifierToolbarState()},updateAllActions:function(){this.getCommonActions().updateAll();this.getZoomActions().updateAll();this.getChemActions().updateAll()},updateUiWidgets:function(){this.updateStyleToolbarState();this.updateObjModifierToolbarState()},createConfigurator:function($super){var h=$super();h.addEventListener("configChange",function(i){this.getEditor().repaint()},this);return h}});Kekule.Editor.Composer.getMinPreferredDimension=function(){return{width:630,height:350}};Kekule.Editor.Composer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.Editor.Composer.Settings",initialize:function($super,h){$super(h)},initProperties:function(){this.defineDelegatedProps(["enableCreateNewDoc","enableLoadNewFile","initOnNewDoc","enableOperHistory","allowCreateNewChild","enableStyleToolbar"])}});Kekule.Editor.Composer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.Editor.Composer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function($super,h){$super(h)},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function($super){var w=$super();var h=this.getComposer();var t=h.getEditor();var p=[t.getDisplayerConfigs(),t.getRenderConfigs()];for(var q=0,o=p.length;q<o;++q){var m=p[q];var v=m.getPropListOfScopes([Class.PropertyScope.PUBLISHED]);for(var s=0,n=v.getLength();s<n;++s){var u=v.getPropInfoAt(s);var r=m.getPropValue(u.name);if(r){w.push({obj:r,name:u.name,title:u.title,description:u.description})}}}return w},getComposer:function(){return this.getWidget()},getEditor:function(){return this.getComposer().getEditor()}});Kekule._registerAfterLoadSysProc(function(){var i=Kekule.Editor.ObjModifier.Category;var h=Kekule.ObjPropSettingManager;h.register("Kekule.Editor.Composer.fullFunc",{enableStyleToolbar:true,enableOperHistory:true,enableLoadNewFile:true,enableCreateNewDoc:true,allowCreateNewChild:true,commonToolButtons:null,chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null});h.register("Kekule.Editor.Composer.molOnly",{enableStyleToolbar:true,enableOperHistor:true,enableLoadNewFile:true,enableCreateNewDoc:true,allowCreateNewChild:true,commonToolButtons:null,chemToolButtons:[d.manipulate,d.erase,d.molBond,d.molAtom,d.molRing,d.molCharge],styleToolComponentNames:null,allowedObjModifierCategories:[i.GENERAL,i.CHEM_STRUCTURE]});h.register("Kekule.Editor.Composer.compact",{enableStyleToolbar:false,commonToolButtons:[d.newDoc,d.loadData,d.saveData,d.undo,d.redo,d.zoomIn,d.zoomOut],chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null});h.register("Kekule.Editor.Composer.singleObj",{allowCreateNewChild:false})});Kekule.Editor.ComposerDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.Editor.ComposerDialog",initialize:function($super,h,i,j){$super(h,i,j||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false,setter:null});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,getter:function(){var h=this.getComposer();return h&&h.getChemObj()},setter:function(h){var i=this.getComposer();if(i){i.setChemObj(h)}}})},initPropValues:function($super){$super()},doGetWidgetClassName:function($super){return $super()+" "+f.COMPOSER_DIALOG},doCreateClientContents:function($super,i){$super();var h=this.doCreateComposerWidget();this.setPropStoreFieldValue("composer",h);h.appendToElem(i)},getSavingTargetObj:function(){var h=this.getComposer();if(h){return h.getSavingTargetObj()}else{return null}},doCreateComposerWidget:function(){var h=new Kekule.Editor.Composer(this);h.addClassName(b.DYN_CREATED);if(h.setResizable){h.setResizable(true)}var i=h.getEditor();i.addClassName(b.DYN_CREATED);return h}});Kekule.Editor.ComposerFrame=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.ComposerFrame",BINDABLE_TAG_NAMES:["iframe"],initialize:function($super,h){$super(h)},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null});this.defineProp("frameDocument",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null,getter:function(){return this.getElement().contentDocument}});this.defineProp("frameWindow",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null,getter:function(){return Kekule.DocumentUtils.getDefaultView(this.getFrameDocument())}})},initPropValues:function($super){$super();this.setMinDimension({width:550,height:350});this.setEnableDimensionTransform(true)},doGetWidgetClassName:function($super){return $super()+" "+f.COMPOSER_FRAME},doCreateRootElement:function(i){var h=i.createElement("iframe");return h},doBindElement:function($super,h){$super(h);var i=!h.parentNode;if(i){this.setDisplayed(false);var j=h.ownerDocument;j.body.appendChild(h)}this._createComposerWidgetInFrame()},_initFrame:function(){var h="<!DOCTYPE html><html><head></head><body></body></html>";var i=this.getFrameDocument();i.open("text/htmlreplace");i.write(h);i.close()},_createComposerWidgetInFrame:function(j){this._initFrame();var h=this;var i=this.getFrameDocument();i.documentElement.className=f.COMPOSER_FRAME_CONTENT_DOC;i.body.className=f.COMPOSER_FRAME_CONTENT_BODY;Kekule.X.Event.addListener(i.body,"kekuleload",function(l){var k=new Kekule.Editor.Composer(i);k.appendToElem(i.body);h.setPropStoreFieldValue("composer",k);if(j){j(k)}});this._insertKekuleScriptAndStyleSheetFiles(i)},_insertKekuleScriptAndStyleSheetFiles:function(h,l){var k=Kekule.scriptSrcInfo;var j=h.head;var i=h.createElement("link");i.setAttribute("rel","stylesheet");i.setAttribute("type","text/css");i.setAttribute("href",Kekule.getStyleSheetUrl());j.appendChild(i);Kekule.ScriptFileUtils.appendScriptFile(h,Kekule.getScriptSrc(),l)}})})();(function(){var a=Kekule.ArrayUtils;var c=Kekule.ChemWidget.ComponentWidgetNames;var e=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ActionManager;var b=[];Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{ACTION_UNDO:"K-Chem-Undo",ACTION_REDO:"K-Chem-Redo",ACTION_NEWDOC:"K-Chem-NewDoc",ACTION_CLONE_SELECTION:"K-Chem-Clone-Selection",ACTION_COPY:"K-Chem-Copy",ACTION_CUT:"K-Chem-Cut",ACTION_PASTE:"K-Chem-Paste",ACTION_TOGGLE_SELECT:"K-Chem-Toggle-Select-State",ACTION_TOGGLE_INSPECTOR:"K-Chem-Toggle-Inspector"});Object.extend(Kekule.ChemWidget.ComponentWidgetNames,{manipulateMarquee:"manipulateMarquee",manipulateLasso:"manipulateLasso",manipulateBrush:"manipulateBrush",manipulateAncestor:"manipulateAncestor",molBondSingle:"bondSingle",molBondDouble:"bondDouble",molBondTriple:"bondTriple",molBondCloser:"bondCloser",molBondWedgeUp:"bondWedgeUp",molBondWedgeDown:"bondWedgeDown",molBondWedgeUpOrDown:"bondWedgeUpOrDown",molBondDoubleEither:"bondDoubleEither",molChargeClear:"chargeClear",molChargePositive:"chargePositive",molChargeNegative:"chargeNegative",molRadicalSinglet:"radicalSinglet",molRadicalTriplet:"radicalTriplet",molRadicalDoublet:"radicalDoublet",molElectronLonePair:"electronLonePair",molChain:"chain",molRing3:"ring3",molRing4:"ring4",molRing5:"ring5",molRing6:"ring6",molRing7:"ring7",molRing8:"ring8",molRingAr6:"ringAr6",molRingAr5:"ringAr5",molFlexRing:"flexRing",molRepCyclopentaneHaworth1:"repCyclopentaneHaworth1",molRepCyclopentaneHaworth2:"repCyclopentaneHaworth2",molRepCyclohexaneHaworth1:"repCyclohexaneHaworth1",molRepCyclohexaneHaworth2:"repCyclohexaneHaworth2",molRepCyclohexaneChair1:"repCyclohexaneChair1",molRepCyclohexaneChair2:"repCyclohexaneChair2",molRepSubBondMark:"subBondMark",molRepMethane:"methane",molRepFischer1:"repFischer1",molRepFischer2:"repFischer2",molRepFischer3:"repFischer3",molRepSawhorseStaggered:"repSawhorseStaggered",molRepSawhorseEclipsed:"repSawhorseEclipsed",glyphRepLine:"repLine",glyphRepOpenArrowLine:"repOpenArrowLine",glyphRepTriangleArrowLine:"repTriangleArrowLine",glyphRepDiOpenArrowLine:"repDiOpenArrowLine",glyphRepDiTriangleArrowLine:"repDiTriangleArrowLine",glyphRepReversibleArrowLine:"repReversibleArrowLine",glyphRepOpenArrowDiLine:"repOpenArrowDiLine",glyphRepHeatSymbol:"repHeatSymbol",glyphRepAddSymbol:"repAddSymbol"});Kekule.Editor.ActionOperUtils={addObjectsToChemSpaceEditor:function(p,n,f){var g=p.getChemSpace&&p.getChemSpace();if(p&&g&&p.canAddNewStandaloneObject&&p.canAddNewStandaloneObject()){p.beginUpdateObject();try{var r=new Kekule.MacroOperation();for(var m=0,j=n.length;m<j;++m){var k=n[m];var h=new Kekule.ChemObjOperation.Add(n[m],g,null,p);r.add(h)}r.execute();if(f){for(var m=0,j=n.length;m<j;++m){var k=n[m];var o=p.getObjectScreenCoord(k);var q=Kekule.CoordUtils.add(o,f);p.setObjectScreenCoord(k,q)}}p.pushOperation(r);p.select(n)}finally{p.endUpdateObject()}}}};Kekule.Editor.ActionOnEditor=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.Editor.ActionOnEditor",initialize:function($super,g,f,h){$super(g,f,h)},initProperties:function(){this.defineProp("explicitGroup",{dataType:DataType.STRING})},getPreferredWidgetClass:function(){return null},doUpdate:function(){var f=this.getDisplayer();this.setEnabled(f&&f.getChemObj()&&f.getChemObjLoaded()&&f.getEnabled())},getEditor:function(){var f=this.getDisplayer();return(f instanceof Kekule.Editor.BaseEditor)?f:null}});Kekule.Editor.ActionEditorUndo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorUndo",HTML_CLASSNAME:e.ACTION_UNDO,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_UNDO"),Kekule.$L("ChemWidgetTexts.HINT_UNDO"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().canUndo())}},doExecute:function(){var f=this.getEditor();if(f){f.undo()}}});Kekule.Editor.ActionEditorRedo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorRedo",HTML_CLASSNAME:e.ACTION_REDO,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_REDO"),Kekule.$L("ChemWidgetTexts.HINT_REDO"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().canRedo())}},doExecute:function(){var f=this.getEditor();if(f){f.redo()}}});Kekule.Editor.ActionEditorNewDoc=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorNewDoc",HTML_CLASSNAME:e.ACTION_NEWDOC,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_NEWDOC"),Kekule.$L("ChemWidgetTexts.HINT_NEWDOC"))},doUpdate:function(){var f=this.getDisplayer();this.setEnabled(f&&f.getEnabled()&&f.getEnableCreateNewDoc())},doExecute:function(){var f=this.getEditor();if(f){f.newDoc()}}});Kekule.Editor.ActionCloneSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCloneSelection",HTML_CLASSNAME:e.ACTION_CLONE_SELECTION,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_CLONESELECTION"),Kekule.$L("ChemWidgetTexts.HINT_CLONE_SELECTION"))},_hasCloneMethod:function(){var f=this.getEditor();return f&&f.cloneSelection},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this._hasCloneMethod()&&this.getEditor().hasSelection())}this.setDisplayed(this._hasCloneMethod()&&this.getEditor().canCloneObjects())},doExecute:function(){var f=this.getEditor();if(f&&f.getChemSpace){var g=f.getDefaultCloneScreenCoordOffset&&f.getDefaultCloneScreenCoordOffset();var h=f.cloneSelection();Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(f,h,g)}}});Kekule.Editor.ActionCopySelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCopySelection",HTML_CLASSNAME:e.ACTION_COPY,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_COPY"),Kekule.$L("ChemWidgetTexts.HINT_COPY"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().hasSelection())}},doExecute:function(){var f=this.getEditor();var g=f.getChemSpace&&f.getChemSpace();if(f&&g){var h=f.cloneSelection();Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,h)}}});Kekule.Editor.ActionCutSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCutSelection",HTML_CLASSNAME:e.ACTION_CUT,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_CUT"),Kekule.$L("ChemWidgetTexts.HINT_CUT"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().hasSelection())}},doExecute:function(){var g=this.getEditor();var h=g.getChemSpace&&g.getChemSpace();if(g&&h){var i=g.cloneSelection();Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,i);var f=g.getIaController("BasicMolEraserIaController");if(f){f.removeSelection()}}}});Kekule.Editor.ActionPaste=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionPaste",HTML_CLASSNAME:e.ACTION_PASTE,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_PASTE"),Kekule.$L("ChemWidgetTexts.HINT_PASTE"));Kekule.Widget.clipboard.addEventListener("setData",this._reactClipboardChange,this)},finalize:function($super){Kekule.Widget.clipboard.removeEventListener("setData",this._reactClipboardChange,this);$super()},_reactClipboardChange:function(){this.update()},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(Kekule.Widget.clipboard.hasData(Kekule.IO.MimeType.JSON)&&this.getEditor().canAddNewStandaloneObject())}},getObjsCenterScreenCoord:function(m,o){var h=Kekule.BoxUtils;var r=Kekule.CoordUtils;var f=null;for(var j=0,g=o.length;j<g;++j){var k=Kekule.Render.ObjUtils.getContainerBox(o[j],m.getCoordMode(),m.getAllowCoordBorrow());if(!f){f=k}else{f=h.getContainerBox(k,f)}}var n=h.getMinMaxCoords(f);var q={min:m.objCoordToScreen(n.min),max:m.objCoordToScreen(n.max)};var p=r.add(q.min,q.max);var p=r.divide(p,2);return p},doExecute:function(){var i=this.getEditor();if(i&&i.getChemSpace){var l=Kekule.Widget.clipboard.getObjects(Kekule.IO.MimeType.JSON);var k=null;var m=i.getSelection();if(m&&m.length){k=i.getDefaultCloneScreenCoordOffset?i.getDefaultCloneScreenCoordOffset():null;var j=a.clone(m);if(j&&j.length&&k){var g=this.getObjsCenterScreenCoord(i,j);var h=this.getObjsCenterScreenCoord(i,l);var f=Kekule.CoordUtils.substract(g,h);k=Kekule.CoordUtils.add(k,f)}}Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(i,l,k)}}});Kekule.Editor.ActionToggleSelectState=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionToggleSelectState",HTML_CLASSNAME:e.ACTION_TOGGLE_SELECT,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_SELECT"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_SELECT"));this.setExplicitGroup("")},getPreferredWidgetClass:function(){return Kekule.Widget.CheckButton},doUpdate:function($super){$super();this.setChecked(this.getEditor().getIsToggleSelectOn())},checkedChanged:function($super){$super()},doExecute:function($super,i,f){$super(i,f);var h=this.getChecked();var g=this.getEditor();g.setIsToggleSelectOn(!h);this.setChecked(!h)}});Kekule.Editor.ActionOnComposer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Editor.ActionOnComposer",initialize:function($super,g,f,h){$super();this.setText(f);this.setHint(h);this.setComposer(g)},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false})},doUpdate:function(){var f=this.getComposer();var g=this.getEditor();this.setEnabled(f&&f.getEnabled()&&g&&g.getChemObj()&&g.getChemObjLoaded()&&g.getEnabled())},getEditor:function(){var f=this.getComposer();return f?f.getEditor():null}});Kekule.Editor.ActionOnComposerAdv=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionOnComposerAdv",initialize:function($super,g,f,i){var h=new Kekule.ActionList();h.setOwnActions(true);this.setPropStoreFieldValue("attachedActions",h);$super(g,f,i)},finalize:function($super){this.getAttachedActions().finalize();$super()},initProperties:function(){this.defineProp("attachedActionClasses",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("attachedActions",{dataType:"Kekule.ActionList",serializable:false,setter:null});this.defineProp("defaultAttachedAction",{dataType:"Kekule.Action",serializable:false})},checkedChanged:function($super){$super();var h=this.getChecked();if(this.hasAttachedActions()){var g=this.getComposer();if(g){if(h){var f=this.getAttachedActions();g.bindAssocActions(f);g.showAssocToolbar();var i=f.getCheckedAction(this.getClassName());if(!i){i=this.getDefaultAttachedAction()}if(i){i.setChecked(false);i.execute()}}else{g.hideAssocToolbar()}}}},hasAttachedActions:function(){return !!this.getAttachedActions().getActionCount()},setAttachedActionIndex:function(g,f){var h=this.getAttachedActions();if(h){h.setActionIndex(g,f)}return this},addAttachedAction:function(g,f){this.getAttachedActions().add(g);if(f){this.setDefaultAttachedAction(g)}return this},removeAttachedAction:function(f){if(this.getDefaultAttachedAction()===f){this.setDefaultAttachedAction(null)}this.getAttachedActions().remove(f);return this},clearAttachedActions:function(){this.setDefaultAttachedAction(null);var f=this.getAttachedActions();f.clear()},doExecute:function(){},update:function($super){$super();this.getAttachedActions().updateAll()}});Kekule.Editor.ActionComposerToggleInspector=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleInspector",HTML_CLASSNAME:e.ACTION_TOGGLE_INSPECTOR,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_INSPECTOR"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_INSPECTOR"))},doUpdate:function(){var f=this.getComposer();if(f){this.setChecked(f.getShowInspector())}},doExecute:function(){var f=this.getComposer();if(f){this.setChecked(!this.getChecked());f.setShowInspector(this.getChecked())}}});Kekule.Editor.ActionComposerSetIaController=Class.create(Kekule.Editor.ActionOnComposerAdv,{CLASS_NAME:"Kekule.Editor.ActionComposerSetIaController",initialize:function($super,g,f,i,h){$super(g,f,i);this.setPropStoreFieldValue("iaControllerId",h)},initProperties:function(){this.defineProp("iaControllerId",{dataType:DataType.STRING,serializable:false,setter:null})},doExecute:function(){this.getEditor().setActiveIaControllerId(this.getIaControllerId())}});Kekule.Editor.createComposerIaControllerActionClass=function(o,p,j,m,l,i,f,g,n,h){if(!l){l=m}if(!l.startsWith(Kekule.ChemWidget.HtmlClassNames.PREFIX)){l=Kekule.ChemWidget.HtmlClassNames.PREFIX+l}var k={CLASS_NAME:o,HTML_CLASSNAME:l,initialize:function($super,s){$super(s,p,j,m);if(this.initAttachedActions){this.initAttachedActions()}}};if(g){k=Object.extend(k,g)}if(i){var r;if(k.doExecute){r=k.doExecute}k.doExecute=function($super){var t=this.getEditor();var s=t.getIaController(m);if(s){s.setPropValues(i)}if(r){r.apply(this,[$super])}else{$super()}}}if(f){k.initAttachedActions=function(){this.setPropStoreFieldValue("attachedActionClasses",f)}}var q=Class.create(Kekule.Editor.ActionComposerSetIaController,k);if(n){b.push({name:n,actionClass:q,widgetClass:h})}return q};Kekule.Editor.ActionComposerClientDragScrollController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerClientDragScrollController",Kekule.$L("ChemWidgetTexts.CAPTION_CLIENT_DRAGSCROLL"),Kekule.$L("ChemWidgetTexts.HINT_CLIENT_DRAGSCROLL"),"ClientDragScrollIaController",null,null,null,null,c.dragScroll);Kekule.Editor.ActionComposerSetManipulateControllerMarquee=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerMarquee",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_MARQUEE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_MARQUEE"),"BasicMolManipulationIaController","BasicMolManipulationIaController-Marquee",{enableSelect:true,enableGestureManipulation:true,selectMode:Kekule.Editor.SelectMode.RECT},null,{doExecute:function($super){$super();var f=this.getEditor();f.setSelectMode(Kekule.Editor.SelectMode.RECT)}},c.manipulateMarquee);Kekule.Editor.ActionComposerSetManipulateControllerLasso=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerLasso",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_LASSO"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_LASSO"),"BasicMolManipulationIaController","BasicMolManipulationIaController-Lasso",{enableSelect:true,enableGestureManipulation:true,selectMode:Kekule.Editor.SelectMode.POLYGON},null,{doExecute:function($super){$super();var f=this.getEditor();f.setSelectMode(Kekule.Editor.SelectMode.POLYGON)}},c.manipulateLasso);Kekule.Editor.ActionComposerSetManipulateControllerBrush=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerBrush",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_BRUSH"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_BRUSH"),"BasicMolManipulationIaController","BasicMolManipulationIaController-Brush",{enableSelect:true,enableGestureManipulation:true,selectMode:Kekule.Editor.SelectMode.POLYLINE},null,{doExecute:function($super){$super();var f=this.getEditor();f.setSelectMode(Kekule.Editor.SelectMode.POLYLINE)}},c.manipulateBrush);Kekule.Editor.ActionComposerSetManipulateControllerAncestor=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerAncestor",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_ANCESTOR"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_ANCESTOR"),"BasicMolManipulationIaController","BasicMolManipulationIaController-Ancestor",{enableSelect:true,enableGestureManipulation:true,selectMode:Kekule.Editor.SelectMode.ANCESTOR},null,{doExecute:function($super){$super();var f=this.getEditor();f.setSelectMode(Kekule.Editor.SelectMode.ANCESTOR)}},c.manipulateAncestor);Kekule.Editor.ActionComposerSetManipulateController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateController",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE"),"BasicMolManipulationIaController",null,null,[Kekule.Editor.ActionComposerSetManipulateControllerMarquee,Kekule.Editor.ActionComposerSetManipulateControllerLasso,Kekule.Editor.ActionComposerSetManipulateControllerBrush,Kekule.Editor.ActionComposerSetManipulateControllerAncestor,Kekule.Editor.ActionComposerClientDragScrollController,Kekule.Editor.ActionToggleSelectState],null,c.manipulate);Kekule.Editor.ActionComposerSetEraserController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetEraserController",Kekule.$L("ChemWidgetTexts.CAPTION_ERASE"),Kekule.$L("ChemWidgetTexts.HINT_ERASE"),"BasicMolEraserIaController",null,null,null,{doExecute:function($super){$super();var f=this.getEditor();if(f.hasSelection()){f.getActiveIaController().removeSelection()}}},c.erase);Kekule.Editor.ActionComposerSetTrackController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTrackController",Kekule.$L("ChemWidgetTexts.CAPTION_TRACK_INPUT"),Kekule.$L("ChemWidgetTexts.HINT_TRACK_INPUT"),"TrackInputIaController",null,null,null,null,c.trackInput);Kekule.Editor.ActionComposerSetBondControllerSingle=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerSingle",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),"MolBondIaController","MolBondIaController-Single",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.NONE},null,null,c.molBondSingle);Kekule.Editor.ActionComposerSetBondControllerDouble=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDouble",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),"MolBondIaController","MolBondIaController-Double",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.NONE},null,null,c.molBondDouble);Kekule.Editor.ActionComposerSetBondControllerTriple=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerTriple",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),"MolBondIaController","MolBondIaController-Triple",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.TRIPLE,bondStereo:Kekule.BondStereo.NONE},null,null,c.molBondTriple);Kekule.Editor.ActionComposerSetBondControllerCloser=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerCloser",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),"MolBondIaController","MolBondIaController-Closer",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.CLOSER},null,null,c.molBondCloser);Kekule.Editor.ActionComposerSetBondControllerWedgeUp=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUp",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),"MolBondIaController","MolBondIaController-WedgeUp",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP},null,null,c.molBondWedgeUp);Kekule.Editor.ActionComposerSetBondControllerWedgeDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),"MolBondIaController","MolBondIaController-WedgeDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.DOWN},null,null,c.molBondWedgeDown);Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),"MolBondIaController","MolBondIaController-WedgeUpOrDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP_OR_DOWN},null,null,c.molBondWedgeUpOrDown);Kekule.Editor.ActionComposerSetBondControllerDoubleEither=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDoubleEither",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),"MolBondIaController","MolBondIaController-Double-Either",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.E_OR_Z},null,null,c.molBondDoubleEither);Kekule.Editor.ActionComposerSetRepositoryFischer1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer1",{repItemName:"fischer1"},null,null,c.molRepFischer1);Kekule.Editor.ActionComposerSetRepositoryFischer2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer2",{repItemName:"fischer2"},null,null,c.molRepFischer2);Kekule.Editor.ActionComposerSetRepositoryFischer3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER3"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer3",{repItemName:"fischer3"},null,null,c.molRepFischer3);Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_STAGGERED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_STAGGERED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseStaggered",{repItemName:"sawhorseStaggered"},null,null,c.molRepSawhorseStaggered);Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_ECLIPSED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_ECLIPSED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseEclipsed",{repItemName:"sawhorseEclipsed"},null,null,c.molRepSawhorseEclipsed);Kekule.Editor.ActionComposerSetRepositoryMethaneController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMethaneController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_METHANE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_METHANE"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Methane",{repItemName:"methane"},null,null,c.molRepMethane);Kekule.Editor.ActionComposerSetRepositorySubBondMarkController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySubBondMarkController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SUBBOND_MARK"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SUBBOND_MARK"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SubBondMark",{repItemName:"substituentMark"},null,null,c.molRepSubBondMark);Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FLEXCHAIN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FLEXCHAIN"),"MolFlexChainIaController","MolFlexChainIaController",null,null,null,c.molChain);Kekule.Editor.ActionComposerSetBondController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND"),"MolBondIaController",null,null,[Kekule.Editor.ActionComposerSetBondControllerSingle,Kekule.Editor.ActionComposerSetBondControllerDouble,Kekule.Editor.ActionComposerSetBondControllerTriple,Kekule.Editor.ActionComposerSetBondControllerWedgeUp,Kekule.Editor.ActionComposerSetBondControllerWedgeDown,Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController,Kekule.Editor.ActionComposerSetTrackController,Kekule.Editor.ActionComposerSetRepositoryFischer1Controller,Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController,Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController],null,c.molBond);Kekule.Editor.ActionComposerSetAtomController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM"),"MolAtomIaController",null,null,null,null,c.molAtom);Kekule.Editor.ActionComposerSetFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FORMULA"),"FormulaIaController",null,null,null,null,c.molFormula);Kekule.Editor.ActionComposerSetAtomAndFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomAndFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM_AND_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM_AND_FORMULA"),"MolAtomIaController",null,null,[Kekule.Editor.ActionComposerSetAtomController,Kekule.Editor.ActionComposerSetFormulaController],null,c.molAtomAndFormula);Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ELECTRON_LONEPAIR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ELECTRON_LONEPAIR"),"AttachedMarkerIaController","AttachedMarkerIaController-LonePair",{markerClassName:"Kekule.ChemMarker.UnbondedElectronSet",targetClassName:"Kekule.AbstractAtom",initialPropValues:{electronCount:2}},null,null,c.molElectronLonePair);Kekule.Editor.ActionComposerSetNodeChargeControllerClear=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerClear",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_CLEAR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_CLEAR"),"MolNodeChargeIaController","MolNodeChargeIaController-Clear",{charge:0,chargeInc:0,radical:Kekule.RadicalOrder.NONE},null,null,c.molChargeClear);Kekule.Editor.ActionComposerSetNodeChargeControllerPositive=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerPositive",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_POSITIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_POSITIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Positive",{charge:null,chargeInc:1,radical:Kekule.RadicalOrder.NONE},null,null,c.molChargePositive);Kekule.Editor.ActionComposerSetNodeChargeControllerNegative=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerNegative",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_NEGATIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_NEGATIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Negative",{charge:null,chargeInc:-1,radical:Kekule.RadicalOrder.NONE},null,null,c.molChargeNegative);Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_SINGLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_SINGLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Singlet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.SINGLET},null,null,c.molRadicalSinglet);Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_TRIPLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_TRIPLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Triplet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.TRIPLET},null,null,c.molRadicalTriplet);Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_DOUBLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_DOUBLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Doublet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.DOUBLET},null,null,c.molRadicalDoublet);Kekule.Editor.ActionComposerSetNodeChargeController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE"),"MolNodeChargeIaController",null,null,[Kekule.Editor.ActionComposerSetNodeChargeControllerClear,Kekule.Editor.ActionComposerSetNodeChargeControllerPositive,Kekule.Editor.ActionComposerSetNodeChargeControllerNegative,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet,Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair],null,c.molCharge);Kekule.Editor.ActionComposerSetTextBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_BLOCK"),"TextBlockIaController",null,null,null,null,c.textBlock);Kekule.Editor.ActionComposerSetImageBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetImageBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_IMAGE_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_IMAGE_BLOCK"),"ImageBlockIaController",null,null,null,null,c.imageBlock);Kekule.Editor.ActionComposerSetTextImageController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextImageController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_IMAGE"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_IMAGE"),"TextImageIaController","TextImageIaController",null,[Kekule.Editor.ActionComposerSetTextBlockController,Kekule.Editor.ActionComposerSetImageBlockController],null,c.textImage);Kekule.Editor.ActionComposerSetRepositoryRing3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_3"),"MolRingIaController","MolRingIaController-3",{ringAtomCount:3,isAromatic:false},null,null,c.molRing3);Kekule.Editor.ActionComposerSetRepositoryRing4Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing4Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_4"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_4"),"MolRingIaController","MolRingIaController-4",{ringAtomCount:4,isAromatic:false},null,null,c.molRing4);Kekule.Editor.ActionComposerSetRepositoryRing5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_5"),"MolRingIaController","MolRingIaController-5",{ringAtomCount:5,isAromatic:false},null,null,c.molRing5);Kekule.Editor.ActionComposerSetRepositoryRing6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_6"),"MolRingIaController","MolRingIaController-6",{ringAtomCount:6,isAromatic:false},null,null,c.molRing6);Kekule.Editor.ActionComposerSetRepositoryRing7Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing7Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_7"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_7"),"MolRingIaController","MolRingIaController-7",{ringAtomCount:7,isAromatic:false},null,null,c.molRing7);Kekule.Editor.ActionComposerSetRepositoryRing8Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing8Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_8"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_8"),"MolRingIaController","MolRingIaController-8",{ringAtomCount:8,isAromatic:false},null,null,c.molRing8);Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_6"),"MolRingIaController","MolRingIaController-Ar-6",{ringAtomCount:6,isAromatic:true},null,null,c.molRingAr6);Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_5"),"MolRingIaController","MolRingIaController-Ar-5",{ringAtomCount:5,isAromatic:true},null,null,c.molRingAr5);Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FLEXRING"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FLEXRING"),"MolFlexRingIaController","MolFlexRingIaController",null,null,null,c.molFlexRing);Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth1",{repItemName:"cyclopentaneHaworth1"},null,null,c.molRepCyclopentaneHaworth1);Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth2",{repItemName:"cyclopentaneHaworth2"},null,null,c.molRepCyclopentaneHaworth2);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth1",{repItemName:"cyclohexaneHaworth1"},null,null,c.molRepCyclohexaneHaworth1);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth2",{repItemName:"cyclohexaneHaworth2"},null,null,c.molRepCyclohexaneHaworth2);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair1",{repItemName:"cyclohexaneChair1"},null,null,c.molRepCyclohexaneChair1);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair2",{repItemName:"cyclohexaneChair2"},null,null,c.molRepCyclohexaneChair2);Kekule.Editor.ActionComposerSetRepositoryRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING"),"MolRingIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryRing3Controller,Kekule.Editor.ActionComposerSetRepositoryRing4Controller,Kekule.Editor.ActionComposerSetRepositoryRing5Controller,Kekule.Editor.ActionComposerSetRepositoryRing6Controller,Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController,Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller,Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller],null,c.molRing);Kekule.Editor.ActionComposerSetRepositoryPathLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathGlyphLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:null,lineLength:1.5},null,null,c.glyphRepLine);Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepOpenArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-TriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepTriangleArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiOpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepDiOpenArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiTriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.TRIANGLE,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepDiTriangleArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_REV_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-ReversibleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowSide:Kekule.Glyph.ArrowSide.REVERSED,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowSide:Kekule.Glyph.ArrowSide.SINGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5,lineGap:0.1,lineCount:2}},null,null,c.glyphRepReversibleArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowDiLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5,lineGap:0.1,lineCount:2}},null,null,c.glyphRepOpenArrowDiLine);Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_HEAT_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_HEAT_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-HeatSymbol",{glyphClass:Kekule.Glyph.HeatSymbol,glyphInitialParams:{lineLength:1}},null,null,c.glyphRepHeatSymbol);Kekule.Editor.ActionComposerSetRepositoryAddSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryAddSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ADD_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ADD_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-AddSymbol",{glyphClass:Kekule.Glyph.AddSymbol,glyphInitialParams:{lineLength:1}},null,null,c.glyphRepAddSymbol);Kekule.Editor.ActionComposerSetRepositoryGlyphController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryGlyphController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ARROWLINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ARROWLINE"),"ArrowLineIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController,Kekule.Editor.ActionComposerSetRepositoryPathLineController,Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController,Kekule.Editor.ActionComposerSetRepositoryAddSymbolController],null,c.glyph);Kekule._registerAfterLoadSysProc(function(){var m=Kekule.ActionManager;var g=Kekule.ChemWidget;var o=Kekule.Editor;var n=Kekule.Editor.ChemSpaceEditor;var j=m.registerNamedActionClass;j(c.newDoc,o.ActionEditorNewDoc,n);j(c.loadFile,g.ActionDisplayerLoadFile,n);j(c.loadData,g.ActionDisplayerLoadData,n);j(c.saveData,g.ActionDisplayerSaveFile,n);j(c.zoomIn,g.ActionDisplayerZoomIn,n);j(c.zoomOut,g.ActionDisplayerZoomOut,n);j(c.resetZoom,g.ActionDisplayerResetZoom,n);j(c.reset,g.ActionDisplayerReset,n);j(c.config,Kekule.Widget.ActionOpenConfigWidget,n);j(c.undo,o.ActionEditorUndo,n);j(c.redo,o.ActionEditorRedo,n);j(c.cloneSelection,o.ActionCloneSelection,n);j(c.copy,o.ActionCopySelection,n);j(c.cut,o.ActionCutSelection,n);j(c.paste,o.ActionPaste,n);j(c.objInspector,o.ActionComposerToggleInspector,n);for(var h=0,f=b.length;h<f;++h){var k=b[h];j(k.name,k.actionClass,k.widgetClass||n)}})})();(function(){var a=Kekule.ArrayUtils;var b=Kekule.CoordUtils;Kekule.Editor.PointerTrackConstraint={NONE:0,LEADING:1,BOTH:2,CIRCLE:5};Kekule.Editor.TrackParser=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackParser",simplifyCurveToLineSegments:function(d,c){return Kekule.GeometryUtils.simplifyCurveToLineSegments(d,c)},addLineCrossPoints:function(m){var n=[];var c=m.length;for(var g=0;g<c-1;++g){var d={coord1:m[g],coord2:m[g+1]};for(var f=g+2;f<c-1;++f){var l={coord1:m[f],coord2:m[f+1]};var h=Kekule.GeometryUtils.getCrossPointOfLines(d.coord1,d.coord2,l.coord1,l.coord2);if(h){this._addInsertedPoint(g,h,n);this._addInsertedPoint(f,h,n)}}}for(var g=0;g<c-1;++g){if(n[g]){this._sortInsertedPointsInLine(n[g],m[g],m[g+1])}}var o=[];for(var g=0;g<c-1;++g){o.push(m[g]);if(n[g]){for(var f=0,e=n[g].length;f<e;++f){o.push(n[g][f])}}}o.push(m[c-1]);return o},addVertexToLineMergePoint:function(o,g){if(g<=0){return o}var c=o.length;var p=[];for(var l=0;l<c-1;++l){var e=o[l];for(var h=0;h<c-1;++h){if(h<l-1||h>l+1){var m=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(e,o[h],o[h+1],false);if(m){var n=Kekule.CoordUtils.getDistance(e,m);if(n<=g){e.x=m.x;e.y=m.y;this._addInsertedPoint(h,e,p)}}}}}var q=[];for(var l=0;l<c-1;++l){q.push(o[l]);if(p[l]){this._sortInsertedPointsInLine(p[l],o[l],o[l+1]);for(var h=0,f=p[l].length;h<f;++h){q.push(p[l][h])}}}q.push(o[c-1]);return q},_addInsertedPoint:function(d,c,e){if(!e[d]){e[d]=[]}e[d].push(c)},_sortInsertedPointsInLine:function(g,f,d){if(!g){return}var e=d.x-f.x;var c=d.y-f.y;g.sort(function(i,h){if(Math.abs(c)>Math.abs(e)){return -(h.y-i.y)*c}else{return -(h.x-i.x)*e}})},mergeNearbyTrackPoints:function(p,h){if(h<=0){return p}var f="__$merge_handled__";var r="__$merge_weight__";var e=p.length;var t=p.concat([]);for(var m=0;m<e;++m){var c=t[m];if(!c[f]){for(var l=m+1;l<e;++l){var g=t[l];if(!g[f]){var s=c[r]||1;var k=g[r]||1;var o=Kekule.CoordUtils.getDistance(c,g);if(o<=h){var q;var n=s+k;c[r]=n;if(c.boundObj){q=c}else{if(g.boundObj){q=g;c.boundObj=g.boundObj}else{q=(s===1)?c:b.multiply(c,s);q=b.add(q,(k===1)?g:b.multiply(g,k));q=b.divide(q,n)}}c.x=q.x;c.y=q.y;t.splice(l,1,c)}}}}c[f]=true}return t},mergeCloseVertexes:function(d,c){c=c||this.getVertexMergeRadius();if(c<=0){return d}return this._doMergeCloseVertexes(d,c)},_doMergeCloseVertexes:function(q,k){var h=q.getVertexes();var g=h.length;var f=false;for(var n=0;n<g;++n){var e=h[n];var p=h[n].getData("coord");for(var l=n+1;l<g;++l){var m=h[l];var c=m.getData("coord");var o=Kekule.CoordUtils.getDistance(p,c);if(o<=k){this._doMergeVertex(q,e,m);f=true;break}}if(f){break}}if(f){return this._doMergeCloseVertexes(q,k)}else{return q}},_doMergeVertex:function(n,c,f){var j=c.getData("coord");var g=c.getData("weight")||1;var m=f.getData("coord");var p=f.getData("weight")||1;var o=a.clone(f.getEdges());for(var h=0,e=o.length;h<e;++h){var d=o[h];d.replaceVertex(f,c)}n.removeVertex(f);var k=(g===1)?j:b.multiply(j,g);k+=(p===1)?m:b.multiply(m,p);k=b.divide(k,g+p);c.setData("coord",k)},removeRepetitivePoints:function(e){var c=[];var g=null;for(var f=0,d=e.length;f<d;++f){if(e[f]!==g){c.push(e[f]);g=e[f]}}return c},refineTrack:function(d,e,f){var c=this.simplifyCurveToLineSegments(d,e);c=this.addLineCrossPoints(c);c=this.addVertexToLineMergePoint(c,f);c=this.mergeNearbyTrackPoints(c,f);c=this.removeRepetitivePoints(c);return c},convertTrackToStructure:function(l,m,c,n){if(!m||!m.length){return null}var f=m.length;if(f<2){return null}var o=n||new Kekule.StructureFragment();var d="__$structure_node__";var e;for(var j=0;j<f;++j){var k=m[j];var g=k[d];if(!g){g=new Kekule.Atom();g.setIsotopeId(c);l.setObjectScreenCoord(g,k);k[d]=g;o.appendNode(g)}if(e&&e!==g){if(!g.getConnectorTo(e)){var h=new Kekule.Bond(null,[e,g]);h.setBondOrder(1);o.appendConnector(h)}}e=g}return o},convertLinesToGraph:function(h){if(!h||!h.length){return null}else{var k="__$graph_vertex__";var l=new Kekule.Graph();var d=h.length;var g,e;for(var f=0;f<d;++f){var j=h[f];var g=j[k];if(!g){g=new Kekule.GraphVertex();g.setData("coord",j);j[k]=g;l.addVertex(g)}if(e){if(!g.getEdgeTo(e)){var c=new Kekule.GraphEdge();l.addEdge(c,e,g)}}e=g}return l}}});Kekule.Editor.TrackLayoutOptimizer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackLayoutOptimizer",OPTIMIZED_COORD_FIELD:"__$optimizedCoord__",COORD_INDEX_FIELD:"__$coordIndex__",RING_END_INDEX_FIELD:"__$ringEndIndex__",initialize:function($super){$super()},initProperties:function(){},initPropValues:function($super){$super()},splitTrackByRings:function(d){var n=[];var f=function(u,t){for(var s=0,q=n.length;s<q;++s){var r=n[s];if(r.startIndex>t||r.endIndex<u){continue}else{return false}}return true};for(var h=0,e=d.length;h<e;++h){var m=d[h];if(m[this.COORD_INDEX_FIELD]===undefined){m[this.COORD_INDEX_FIELD]=h}else{var o=m[this.COORD_INDEX_FIELD];var k=h;m[this.RING_END_INDEX_FIELD]=k;if(f(o,k)){n.push({startIndex:o,endIndex:k})}}}var p=[];var c=n.length;if(c>0){var g=0;for(var h=0;h<c;++h){var j=n[h];if(j.startIndex>g){p.push({track:d.slice(g,j.startIndex+1),isRing:false})}p.push({track:d.slice(j.startIndex,j.endIndex+1),isRing:true});g=j.endIndex}if(g<d.length-1){p.push({track:d.slice(g,d.length),isRing:false})}return p}else{return[{track:d,isRing:false}]}},optimize:function(f,m){var j=f;var c=Kekule.Editor.PointerTrackConstraint;var d;var k=f[0];var e=k.boundObj;var l=f[f.length-1];var g=l.boundObj;if(e&&g){d=(e===g)?c.CIRCLE:c.BOTH}else{if(e||g){d=c.LEADING;if(g){j=a.reverse(f)}}else{if(k===l){d=c.CIRCLE}else{d=c.LEADING}}}var i=Object.extend({},m);i.preferredStartingAngles=m.preferredStartingAngles||[0];i.segmentsInfo=this._calcTrackSegmentsInfo(j);i.distanceMedian=a.getMedian(i.segmentsInfo.distances);var h=(d===c.CIRCLE)?this.doOptimizeOnCircleConstraint(j,i):(d===c.BOTH)?this.doOptimizeOnBothConstraint(j,i):this.doOptimizeOnLeadingConstraint(j,i);return h},_calcTrackSegmentsInfo:function(d){var m=[],k=[];for(var g=0,f=d.length;g<f-1;++g){var j=d[g];var h=d[g+1];var c=b.getDistance(j,h);var n=b.substract(h,j);var e=Math.atan2(n.y,n.x);m.push(c);k.push(e)}return{distances:m,angles:k}},doOptimizeOnLeadingConstraint:function(y,g,H){var p=Kekule.GeometryUtils;var t=[];if(H){var w=Kekule.Editor.PointerTrackConstraint;var q=this.splitTrackByRings(y);if(q.length===1){return q[F].isRing?this.doOptimizeOnCircleConstraint(c,g,true):this.doOptimizeOnLeadingConstraint(c,g,true)}var f;for(var F=0,A=q.length;F<A;++F){var c=q[F].track;var v=q[F].isRing?this.doOptimizeOnCircleConstraint(c,g,true):this.doOptimizeOnLeadingConstraint(c,g,true);if(!f){f=v[v.length-1];t=t.concat(v)}else{var z=v[0];var I=b.substract(f,z);for(var E=0,B=v.length;E<B;++E){v[E]=b.add(v[E],I)}f=v[v.length-1];v.shift();t=t.concat(v)}}return t}var o=g.preferredStartingAngles;var n;t.push(y[0]);var u=[g.preferredIncludeAngle,-g.preferredIncludeAngle];for(var F=1,A=y.length;F<A;++F){if(y[F][this.OPTIMIZED_COORD_FIELD]){t.push(y[F][this.OPTIMIZED_COORD_FIELD])}else{var e=y[F-1];var m=t[F-1];var d=y[F];var I=b.substract(d,e);var G=b.getDistance(e,d);var s=this._optimizeLineSegmentDistance(G,g);var D=Math.atan2(I.y,I.x);var x;x=this._optimizeDirectionAngle(D,o,g,n);n=x;var J=Math.PI-g.preferredIncludeAngle;var o=[p.standardizeAngle(x-J),p.standardizeAngle(x+J)];var r={x:s*Math.cos(x),y:s*Math.sin(x)};var h=b.add(m,r);t.push(h);y[F][this.OPTIMIZED_COORD_FIELD]=h}}return t},doOptimizeOnBothConstraint:function(s,g,w){var t=s.length;var h=this.doOptimizeOnLeadingConstraint(s,g,w);var f=h[t-1];var c=s[t-1];var r=s[0];var q=b.substract(c,r);var p=Math.atan2(q.y,q.x);var v=b.substract(f,r);var d=Math.atan2(v.y,v.x);var x=b.getDistance(q)/b.getDistance(v);if(x<=2){var l=b.calcTransform2DMatrix({rotateAngle:-d,center:r});var k=b.calcTransform2DMatrix({scale:x,center:r});var j=b.calcTransform2DMatrix({rotateAngle:p,center:r});var m=Kekule.MatrixUtils.multiply(l,k);m=Kekule.MatrixUtils.multiply(m,j);var o=[h[0]];for(var u=1;u<t-1;++u){o.push(b.transform2DByMatrix(h[u],m))}o.push(s[t-1])}else{var e=b.divide(b.substract(c,f),t-1);var o=[h[0]];var n={x:0,y:0};for(var u=0;u<t-1;++u){n=b.add(n,e);o.push(b.add(h[u],n))}o.push(s[t-1])}return o},doOptimizeOnCircleConstraint:function(e,q,g){var c=e.length-1;var k=Object.create(q);if(c<=8){var h=(1-2/c)*Math.PI;var k=Object.create(q);k.preferredIncludeAngle=h}var d=e.length;var l=this.doOptimizeOnLeadingConstraint(e,k,g);var o=l[d-1];var n=e[d-1];var m=b.divide(b.substract(n,o),d-1);var p=[l[0]];var f={x:0,y:0};for(var j=1;j<d-1;++j){f=b.add(f,m);p.push(b.add(l[j],f))}p.push(e[d-1]);return p},_optimizeIncludeAngle:function(d,e,c){return this._optimizeDirectionAngle(d,e,c)},_optimizeDirectionAngle:function(m,f,t,c){var n=Kekule.GeometryUtils;var u=null,s=null;if(f&&f.length){var r=null;for(var j=0,h=f.length;j<h;++j){var e=Math.abs(n.standardizeAngle(m)-f[j]);if(r===null||e<r){s=f[j];r=e}}if(r<=Math.PI/6){u=s}}if(u===null){var o=t.angleConstraint;if(!o){return m}if(s===null){s=0}var e=m-s;var d=Math.round(e/o);u=s+d*o;if(c){var k=5*Math.PI/180;var q=Math.abs(n.standardizeAngle(u-c,-Math.PI));if(Kekule.NumUtils.isFloatEqual(q,0,k)||Kekule.NumUtils.isFloatEqual(q,Math.PI,k)){var g=u+o;var p=u-o;if(Math.abs(m-g)<Math.abs(m-p)){u=g}else{u=p}}}}return u},_optimizeLineSegmentDistance:function(g,o){var l=o.defBondScreenLength;var j=o.distanceConstraints||[];if(!j){return g}var f=j[j.length-1]*l;if(g>f){var c=Math.round(g/l);return c*l}else{var m=o.primaryDistanceConstraint;var e=j.length;var k=j.indexOf(m);if(k<0){k=0}var n;for(var h=e-1;h>=k;--h){var d=j[h];n=d*l;if(g>n){return n}}for(var h=0;h<=k;++h){n=d*l;if(g<n){return n}}return n}}});Kekule.Editor.TrackInputIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.TrackInputIaController",initialize:function($super,c){$super(c);this.setEnableSelect(false);this._isTracking=false;this._trackCoordToObjBindings=null;this._trackParser=new Kekule.Editor.TrackParser();this._trackLayoutOptimizer=new Kekule.Editor.TrackLayoutOptimizer();this._addStructureOperation=null;this._editorScaled=false;this._editorOriginalZoomLevel=1;this._lastRenderedMarkerCoord=null;this._debugMarkers={}},doFinalize:function($super){this._trackLayoutOptimizer.finalize();this._trackParser.finalize();var c=this.getPropStoreFieldValue("trackMarker");if(c){c.finalize()}$super()},initProperties:function(){this.defineProp("trackMarker",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var c=this.getPropStoreFieldValue("trackMarker");if(!c){c=new Kekule.ChemWidget.MetaShapeUIMarker({shapeType:Kekule.Render.MetaShapeType.POLYLINE,coords:[]});this.setPropStoreFieldValue("trackMarker",c)}return c}})},initPropValues:function($super){$super()},getEditorUiMarkers:function(){return this.getEditor().getUiMarkers()},refineTrackCoords:function(r){var m=this.getEditor();var o=this.getEditorConfigs();var k={angleConstraint:o.getInteractionConfigs().getTrackOptimizationAngleConstraint(),distanceConstraints:o.getInteractionConfigs().getTrackOptimizationDistanceConstraints(),primaryDistanceConstraint:o.getInteractionConfigs().getTrackOptimizationPrimaryDistanceConstraint(),preferredIncludeAngle:Math.PI*2/3};var u=m.getDefBondLength?m.getDefBondLength():o.getStructureConfigs().getDefBondLength();var q=m.objCoordToScreen({x:0,y:0});var p=m.objCoordToScreen({x:u,y:0});var s=b.getDistance(q,p);k.defBondScreenLength=s;var e=this.getEditorConfigs().getInteractionConfigs().getTrackSimplifierDistanceThreshold();var j=this.getEditorConfigs().getInteractionConfigs().getTrackMergeDistanceThreshold();var h=this._mergeCoordsToBoundNodesAndSplitTrack(r);var t=[];for(var g=0,f=h.length;g<f;++g){var c=h[g];c=this._trackParser.refineTrack(c,e,j);var d=c[0].obj||c[c.length-1].obj;var n=d?o.getStructureConfigs.getNewBondDefAngle(d,1):-Math.PI/6;k.preferredStartingAngles=[n];c=this._trackLayoutOptimizer.optimize(c,k);t.push(c)}return t},_mergeCoordsToBoundNodesAndSplitTrack:function(p){var c=this._trackCoordToObjBindings;var d=c.length;if(d){var o=this.getEditor();var g=[];var e=c[0].obj;var r=c[0].coordIndex;var q=0;for(var m=1;m<=d;++m){var k=c[m];if((m<d&&k&&(e!==k.obj||(k.coordIndex-r>10))||m===d)){if(r>q){g.push(p.slice(q,r))}var f=o.getObjectScreenCoord(e);f.boundObj=e;var n=c[m-1].coordIndex;q=n+1;g.push([f]);if(m!==d){e=k.obj;r=k.coordIndex}}}if(p.length-1>c[d-1].coordIndex){g.push(p.slice(c[d-1].coordIndex))}var t=[];var s=[];for(var m=0,h=g.length;m<h;++m){var j=g[m];t=t.concat(j);if(m===h-1){s.push(t)}else{if(j[0].boundObj&&m>0){s.push(t);t=j}}}return s}else{return[p]}},convertTracksToStructure:function(e,h){var c=new Kekule.Molecule();c.setCoord2D({x:0,y:0});var g=this.getEditor();for(var f=0,d=e.length;f<d;++f){this._trackParser.convertTrackToStructure(g,e[f],h,c)}if(c.getNodeCount()<2){return null}else{return c}},getStructureSelectableChildren:function(c){return[].concat(c.getNodes()).concat(c.getConnectors())},addStructureToEditor:function(c){var d=this.getEditor();this._addStructureOperation=null;d.beginUpdateObject();try{var f;var e=d.getChemSpace();if(this._targetMol){f=new Kekule.ChemStructOperation.MergeStructFragment(c,this._targetMol,d);this._targetMol=null}else{f=new Kekule.ChemObjOperation.Add(c,e,null,d)}f.execute();this._addStructureOperation=f}finally{d.endUpdateObject()}},getTrackCoords:function(){return this.getTrackMarker().getShapeInfo().coords},clearTrackCoords:function(){var c=this.getTrackMarker();c.getShapeInfo().coords=[]},startTracking:function(c,h){this._targetMol=null;var m=this.getEditor();var g=this._getMergeDestObjAtCoord(h);if(!m.canCreateNewChild()&&!g){if(!m.canAddUnconnectedStructFragment()){return null}else{var n=m.getOnlyOneBlankStructFragment();this._targetMol=n}}this._isTracking=true;this._trackCoordToObjBindings=[];this.setManuallyHotTrack(true);this.clearTrackCoords();var i=this.getTrackMarker();this.getEditorUiMarkers().addMarker(i);var d=this.getEditorConfigs().getUiMarkerConfigs();var l={strokeColor:d.getTrackMarkerStrokeColor(),strokeWidth:d.getTrackMarkerStrokeWidth(),strokeDash:d.getTrackMarkerStrokeDash(),opacity:d.getTrackMarkerOpacity()};i.setDrawStyles(l);i.setVisible(true);this.addTrackCoord(h,false);if(this.getEditorConfigs().getInteractionConfigs().getAutoAdjustZoomLevelOnTrackTouching()){var m=this.getEditor();var f=this.getEditorConfigs().getInteractionConfigs().getTrackTouchRefLength();if(f){var p=m.getDocument();var r=m.getDefBondScreenLength();var e=Kekule.DocumentUtils.getDevicePPI(p)*f/Kekule.DocumentUtils.getClientScaleLevel(p);var k=e/r;if(k>0.9){var q=m.getCurrZoom();m.setZoomCenter(h);m.zoomTo(q*k);var j=this._getEventMouseCoord(c);var o=this.getTrackCoords();var s=o[o.length-1];h=j;Object.extend(s,j);this._editorScaled=true;this._editorOriginalZoomLevel=q;this._autoScaleStartCoord=j}else{this._editorScaled=false;this._editorOriginalZoomLevel=null}}}this.repaintMarker();this._lastRenderedMarkerCoord=h},endTracking:function(g){var f=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId()||"C";this._isTracking=false;this.addTrackCoord(g);var c=this.refineTrackCoords(this.getTrackCoords());if(c.length){var e=this.convertTracksToStructure(c,f);if(e){this.addStructureToEditor(e);this.startDirectManipulate(null,e,g);this.moveManipulatedObjs(g);this.stopManipulate();var d=this.getStructureSelectableChildren(e);this.doneInsertOrModifyBasicObjects(d)}}this.doneTracking()},cancelTracking:function(){this._isTracking=false;this.getEditorUiMarkers().removeMarker(this.getTrackMarker());this.doneTracking()},doneTracking:function(){if(this._editorScaled){var d=this.getTrackCoords();var c=d[d.length-1];this._editorScaled=false;this.getEditor().zoomTo(this._editorOriginalZoomLevel,null,this._autoScaleStartCoord);this._editorOriginalZoomLevel=null;this._autoScaleStartCoord=null}this.setManuallyHotTrack(false);this.getEditor().hideHotTrack();this.clearTrackCoords();this.repaintMarker()},_getMergeDestObjAtCoord:function(c){var d=this.getEditor().getTopmostBasicObjectAtCoord(c,this.getCurrBoundInflation());if(this.isValidMergeDestObj(d)){return d}else{return null}},addTrackCoord:function(c,g){var e=this.getTrackCoords();var d=e&&e[e.length-1];if(d&&Kekule.CoordUtils.isEqual(c,d)){return}var f=this._getMergeDestObjAtCoord(c);if(f){this._trackCoordToObjBindings.push({coord:c,obj:f,coordIndex:this.getTrackCoords().length});this.getEditor().addHotTrackedObj(f)}e.push(c);if(!g){var h;if(this._lastRenderedMarkerCoord){h=Kekule.CoordUtils.getDistance(this._lastRenderedMarkerCoord,c);if(h>5){this.repaintMarker();this._lastRenderedMarkerCoord=c}}else{this.repaintMarker();this._lastRenderedMarkerCoord=c}}},repaintMarker:function(){this.getEditor().repaintUiMarker()},isValidMergeDestObj:function(c){return c instanceof Kekule.ChemStructureNode},canInteractWithObj:function(c){return c instanceof Kekule.ChemStructureNode},getAllObjOperations:function($super,d){var c=$super(d)||[];var e=this._addStructureOperation;if(e){c.unshift(e)}return c},react_pointerdown:function($super,c){this.getEditor().setCurrPointerType(c.pointerType);if(c.getButton()===Kekule.X.Event.MouseButton.LEFT){var d=this._getEventMouseCoord(c);this.startTracking(c,d);c.preventDefault()}else{if(c.getButton()===Kekule.X.Event.MouseButton.RIGHT){this.cancelTracking();c.preventDefault()}}},react_pointerup:function($super,c){if(c.getButton()===Kekule.X.Event.MouseButton.LEFT){if(this._isTracking){var d=this._getEventMouseCoord(c);this.endTracking(d);this.addOperationToEditor()}this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL);c.preventDefault()}},react_pointermove:function($super,c){$super(c);if(this._isTracking){var d=this._getEventMouseCoord(c);this.addTrackCoord(d);c.preventDefault()}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.TrackInputIaController,Kekule.Editor.ChemSpaceEditor)})();(function(){var a=Kekule.ArrayUtils;var e=Kekule.Editor;var c=Kekule.Widget.HtmlClassNames;var f=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ChemWidget.ComponentWidgetNames;Kekule.Editor.ObjModifier={};Kekule.Editor.ObjModifier.Category={GENERAL:"general",CHEM_STRUCTURE:"chemStruct",GLYPH:"glyph",STYLE:"style",MISC:"misc"};Kekule.Editor.ObjModifier.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.ObjModifier.Base",initialize:function($super,g){$super();this.setEditor(g);this.modifierWidgetValueChangedBind=this.modifierWidgetValueChanged.bind(this)},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false});this.defineProp("targetObjs",{dataType:DataType.ARRAY,serializable:false,getter:function(){return this.getEditor().getSelection()}});this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("widget");if(!g){g=this.createWidget();this.setPropStoreFieldValue("widget",g)}return g}})},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getModifierName:function(){return this.getClassLocalName().toLowerCase()},createWidget:function(){var g=this.doCreateWidget();if(g){this.installValueChangeEventHandler(g)}return g},doCreateWidget:function(){return null},installValueChangeEventHandler:function(g){g.on("valueChange",this.modifierWidgetValueChangedBind)},modifierWidgetValueChanged:function(){this.applyToTargets()},loadFromTargets:function(){var h=this.getEditor();if(h){var g=this.getTargetObjs();if(g){this.doLoadFromTargets(h,g)}}return this},doLoadFromTargets:function(h,g){},applyToTargets:function(){var h=this.getEditor();if(h){var g=this.getTargetObjs();if(g){this.doApplyToTargets(h,g)}}return this},doApplyToTargets:function(h,g){var i=this.createModificationOper();if(i){h.execOperation(i)}},createModificationOper:function(j){var k=[];if(target&&j.length){for(var m=0,h=j.length;m<h;++m){var n=this.createModificationOperOnTarget(j[m]);if(n){k.push(n)}}}var g=k.length;if(g<=0){return null}else{if(g===1){return k[0]}else{return new Kekule.MacroOperation(k)}}},createModificationOperOnTarget:function(h){var g=this.getModifiedPropValues();if(g){return this.createModificationOperation(h,g)}else{return null}},getModifiedPropValues:function(){return null},createModificationOperation:function(g,h){return new Kekule.ChemObjOperation.Modify(g,h,this.getEditor())}});Kekule.Editor.ObjModifierManager={_modifierMap:new Kekule.MapEx(true),register:function(o,n){if(!n||!o){return}var m=a.toArray(n);var k=a.toArray(o);for(var j=0,g=k.length;j<g;++j){var h=k[j];var p=b._modifierMap.get(h);if(!p){p=m;b._modifierMap.set(h,p)}else{a.pushUnique(p,m)}}},unregister:function(m){if(!m){return}var j=a.toArray(m);var k=b._modifierMap.getKeys();for(var h=0,g=k.length;h<g;++h){var n=b._modifierMap.get(k[h]);if(n&&n.length){b._modifierMap.set(k[h],a.exclude(n,j))}}},getModifierCategories:function(h){var g=(h.getCategories&&h.getCategories())||[];var i=ClassEx.getSuperClass(h);if(i){a.pushUnique(g,b.getModifierCategories(i))}return g},getModifierClasses:function(j,p){var g=b._modifierMap.get(j)||[];var n=ClassEx.getSuperClass(j);if(n){a.pushUnique(g,b.getModifierClasses(n,p))}if(p&&p.length){var o=g;g=[];for(var m=0,h=o.length;m<h;++m){var k=b.getModifierCategories(o[m]);if(a.intersect(k,p).length){g.push(o[m])}}}return g}};var b=Kekule.Editor.ObjModifierManager})();(function(){var a=Kekule.ArrayUtils;var e=Kekule.Editor;var c=Kekule.Widget.HtmlClassNames;var f=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ChemWidget.ComponentWidgetNames;Kekule.Editor.ObjModifier.BaseRenderOptionModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.BaseRenderOptionModifier",getRenderOptionValue:function(g,i,h){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(g,i,h)}});Kekule.Editor.ObjModifier.BaseRenderOptionModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.STYLE]};Kekule.Editor.ObjModifier.Color=Class.create(Kekule.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Color",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:Kekule.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:c.COLORPICKER_SPEC_COLOR_MIXED},initProperties:function(){this.defineProp("colorBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},doCreateWidget:function(){var g=new Kekule.Widget.ColorDropButton(this.getEditor());g.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR"));g.setShowText(false);g.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]);g.addClassName(f.COMPOSER_COLOR_BOX);this.setPropStoreFieldValue("colorBox",g);return g},doLoadFromTargets:function(j,h){if(h&&h.length){var g=this.getColorBox();if(g){var i;var k=this.getRenderOptionValue(h,"useAtomSpecifiedColor");var i=this.getRenderOptionValue(h,"color");if(k){i=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value;g.setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className);g.setValue(i)}else{g.setColorClassName(null);g.setValue(i)}}}},doApplyToTargets:function($super,i,g){var h=this.getWidget().getValue();if(h===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value){i.modifyObjectsRenderOptions(g,{useAtomSpecifiedColor:true,color:undefined},false,true)}else{if(h==Kekule.Widget.ColorPicker.SpecialColors.UNSET){h=undefined}i.modifyObjectsRenderOptions(g,{useAtomSpecifiedColor:false,color:h},false,true)}}});var b=Kekule.Editor.ObjModifierManager;b.register(Kekule.ChemObject,[Kekule.Editor.ObjModifier.Color])})();(function(){var d=Kekule.DomUtils;var e=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;var f=Kekule.ChemWidget.HtmlClassNames;var c=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_TEXTFORMAT_BUTTON:"K-Chem-Composer-TextFormat-Button",COMPOSER_MODIFIER_RICHTEXT_PANEL:"K-Chem-Composer-Modifier-RichText-Panel",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP:"K-Chem-Composer-Modifier-RichText-Panel-Group",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-LabelCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-CtrlCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABEL:"K-Chem-Composer-Modifier-RichText-Panel-Group-Label",COMPOSER_TEXTDIRECTION_BOX:"K-Chem-Composer-TextDirection-Box",COMPOSER_TEXTALIGN_BOX:"K-Chem-Composer-TextAlign-Box"});Kekule.globalOptions.add("chemWidget.composer.objModifier.richText",{componentNames:[c.fontName,c.fontSize,c.textDirection,c.textAlign]});Kekule.Editor.ObjModifier.RichText=Class.create(Kekule.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.RichText",initialize:function($super,g){$super(g);this._valueStorage={}},initProperties:function(){this.defineProp("fontPanel",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("fontNameBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("textDirectionBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("textHorizontalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("textVerticalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},_createCtrlGroup:function(m,h,k,l){var g=m.createElement("tr");g.className=f.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP;var i=m.createElement("td");i.className=f.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL;var j=m.createElement("label");j.className=f.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUPLABEL;d.setElementText(j,k);i.appendChild(j);g.appendChild(i);var i=m.createElement("td");i.className=f.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL;l.appendToElem(i);g.appendChild(i);h.appendChild(g);return g},_doCreateDropDownPanel:function(){var h=new Kekule.Widget.Panel(this.getEditor());h.addClassName(f.COMPOSER_MODIFIER_RICHTEXT_PANEL).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT"));var o=Kekule.globalOptions.chemWidget.composer.objModifier.richText.componentNames;var n,l;var k=this.getEditor().getDocument();var i=k.createElement("table");h.getContainerElement().appendChild(i);if(o.indexOf(c.fontName)>=0){var n=new Kekule.Widget.ComboBox(h);this.fillFontNameBox(n);n.addClassName(f.COMPOSER_FONTNAME_BOX);n.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME"));n.addEventListener("valueChange",function(q){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontFamily:this.getFontNameBox().getValue()},false,true)},this);this.setPropStoreFieldValue("fontNameBox",n);this._createCtrlGroup(k,i,Kekule.$L("ChemWidgetTexts.CAPTION_FONTNAME"),n)}if(o.indexOf(c.fontSize)>=0){n=new Kekule.Widget.ComboBox(h);this.fillFontSizeBox(n);n.addClassName(f.COMPOSER_FONTSIZE_BOX);n.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE"));n.addEventListener("valueChange",function(q){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontSize:this.getFontSizeBox().getValue()},false,true)},this);this.setPropStoreFieldValue("fontSizeBox",n);this._createCtrlGroup(k,i,Kekule.$L("ChemWidgetTexts.CAPTION_FONTSIZE"),n)}if(o.indexOf(c.textDirection)>=0){l=new Kekule.Widget.SelectBox(h);var m=Kekule.Render.TextDirection;var j=[{value:m.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT")},{value:m.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR")},{value:m.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL")},{value:m.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB")},{value:m.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT")}];l.setItems(j);n.addClassName(f.COMPOSER_TEXTDIRECTION_BOX);l.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION"));l.addEventListener("valueChange",function(q){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{charDirection:this.getTextDirectionBox().getValue()},false,true)},this);this.setPropStoreFieldValue("textDirectionBox",l);this._createCtrlGroup(k,i,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),l)}if(o.indexOf(c.textAlign)>=0){l=new Kekule.Widget.SelectBox(h);var p=Kekule.Render.TextAlign;var j=[{value:p.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:p.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:p.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:p.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:p.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT")},{value:p.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT")}];l.setItems(j);n.addClassName(f.COMPOSER_TEXTALIGN_BOX);l.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN"));l.addEventListener("valueChange",function(q){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{horizontalAlign:this.getTextHorizontalAlignBox().getValue()},false,true)},this);this.setPropStoreFieldValue("textHorizontalAlignBox",l);this._createCtrlGroup(k,i,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),l);l=new Kekule.Widget.SelectBox(h);var p=Kekule.Render.TextAlign;var j=[{value:p.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:p.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:p.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:p.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:p.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP")},{value:p.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM")}];l.setItems(j);n.addClassName(f.COMPOSER_TEXTALIGN_BOX);l.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN"));l.addEventListener("valueChange",function(q){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{verticalAlign:this.getTextVerticalAlignBox().getValue()},false,true)},this);this.setPropStoreFieldValue("textVerticalAlignBox",l);this._createCtrlGroup(k,i,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),l)}this.setPropStoreFieldValue("fontPanel",h);var g=this._valueStorage;if(g){this.getFontNameBox().setValue(g.fontName);this.getFontSizeBox().setValue(g.fontSize);this.getTextDirectionBox().setValue(g.textDirection);this.getTextHorizontalAlignBox().setValue(g.textHAlign);this.getTextVerticalAlignBox().setValue(g.textVAlign)}return h},doCreateWidget:function(){var g=new Kekule.Widget.DropDownButton(this.getEditor());g.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_FORMAT"));g.setText(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT"));g.setShowText(false);g.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);g.addClassName(f.COMPOSER_TEXTFORMAT_BUTTON);g.setDropDownWidgetGetter(this._doCreateDropDownPanel.bind(this));return g},doLoadFromTargets:function(i,g){if(g&&g.length){var h=this._valueStorage;h.fontName=this.getRenderOptionValue(g,"fontFamily")||"";h.fontSize=this.getRenderOptionValue(g,"fontSize")||undefined;h.textDirection=this.getRenderOptionValue(g,"charDirection")||Kekule.Render.TextDirection.DEFAULT;h.textHAlign=this.getRenderOptionValue(g,"horizontalAlign")||Kekule.Render.TextAlign.DEFAULT;h.textVAlign=this.getRenderOptionValue(g,"verticalAlign")||Kekule.Render.TextAlign.DEFAULT;if(this.getFontPanel()){this.getFontNameBox().setValue(h.fontName);this.getFontSizeBox().setValue(h.fontSize);this.getTextDirectionBox().setValue(h.textDirection);this.getTextHorizontalAlignBox().setValue(h.textHAlign);this.getTextVerticalAlignBox().setValue(h.textVAlign)}}},doApplyToTargets:function($super,h,g){},fillFontSizeBox:function(m){var k=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes();var h=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:undefined}];for(var j=0,g=k.length;j<g;++j){h.push({text:k[j]+" px",value:k[j]})}m.setItems(h)},fillFontNameBox:function(m){var k=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames();var h=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}];for(var j=0,g=k.length;j<g;++j){h.push({text:k[j],value:k[j]})}m.setItems(h)}});var a=Kekule.Editor.ObjModifierManager;a.register(Kekule.ChemObject,[Kekule.Editor.ObjModifier.RichText])})();(function(){var a=Kekule.ArrayUtils;var e=Kekule.DomUtils;var f=Kekule.HtmlElementUtils;var c=Kekule.Widget.HtmlClassNames;var g=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_ATOM_MODIFIER_BUTTON:"K-Chem-Composer-AtomModifier-Button",COMPOSER_ATOM_MODIFIER_DROPDOWN:"K-Chem-Composer-AtomModifier-DropDown",COMPOSER_BOND_MODIFIER_BUTTON:"K-Chem-Composer-BondModifier-Button",COMPOSER_BOND_MODIFIER_DROPDOWN:"K-Chem-Composer-BondModifier-DropDown",COMPOSER_CHARGE_MODIFIER_BUTTON:"K-Chem-Composer-ChargeModifier-Button",COMPOSER_CHARGE_MODIFIER_DROPDOWN:"K-Chem-Composer-ChargeModifier-DropDown"});Kekule.Editor.ObjModifier.ChemStructureModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.ChemStructureModifier",installValueChangeEventHandler:function(h){}});Kekule.Editor.ObjModifier.ChemStructureModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.CHEM_STRUCTURE]};Kekule.Editor.ObjModifier.Atom=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Atom",initialize:function($super,h){$super(h);this._valueStorage={}},initProperties:function(){this.defineProp("atomSetter",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},doCreateWidget:function(){var h=new Kekule.Widget.DropDownButton(this.getEditor());h.setHint(Kekule.$L("ChemWidgetTexts.HINT_ATOM_MODIFIER"));h.setText(Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER"));h.setShowText(true);h.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);h.addClassName(g.COMPOSER_ATOM_MODIFIER_BUTTON);h.setDropDownWidgetGetter(this._createAtomSetter.bind(this));return h},_createAtomSetter:function(j){if(!j){j=this.getEditor()}var m=this.getEditor();var i=new Kekule.ChemWidget.StructureNodeSetter(j);i.addClassName([c.PANEL,g.COMPOSER_ATOM_MODIFIER_DROPDOWN,c.CORNER_ALL]);i.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs());var o=j.getDocument().createElement("div");o.className=c.PANEL_CAPTION;e.setElementText(o,Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER"));var h=i.getElement();h.insertBefore(o,Kekule.DomUtils.getFirstChildElem(h));var n=a.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());n.push("...");var l=m&&m.getEnabledNonAtomInputData&&m.getEnabledNonAtomInputData();i.setSelectableInfos({elementSymbols:n,nonElementInfos:l,subGroupRepItems:Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()});var k=this;i.addEventListener("valueChange",function(p){k.applyToTargets();i.dismiss()});this.setPropStoreFieldValue("atomSetter",i);if(this._valueStorage.nodes){i.setNodes(this._valueStorage.nodes)}return i},_filterStructureNodes:function(j){var k=[];for(var m=0,h=j.length;m<h;++m){var n=j[m];if(n instanceof Kekule.ChemStructureNode){k.push(n)}}return k},_getActualModificationNodes:function(m,k){var h=[];for(var o=0,j=m.length;o<j;++o){var p=m[o];if(p instanceof Kekule.StructureFragment&&p.isExpanded()){var n=this._getActualModificationNodes(p.getNodes(),true);a.pushUnique(h,n)}else{h.push(p)}}if(!k){h=this._filterStructureNodes(h)}return h},doLoadFromTargets:function(j,h){var k;var i=this._getActualModificationNodes(h);this._valueStorage.nodes=i;if(this.getAtomSetter()){this.getAtomSetter().setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs());this.getAtomSetter().setNodes(i)}k=Kekule.Editor.StructureUtils.getAllChemStructureNodesHtmlCode(i,null,null,this.getEditor().getRenderConfigs().getDisplayLabelConfigs());this.getWidget().setText(k||Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER_MIXED")).setShowText(true).setDisplayed(!!i.length)},doApplyToTargets:function($super,q,r){var m=this.getAtomSetter().getValue();var n=[];var h=this._getActualModificationNodes(r);for(var o=0,j=h.length;o<j;++o){var s=h[o];if(s instanceof Kekule.ChemStructureNode){var p=this._createNewDataToAtomOperation(m,s);if(p){n.push(p)}}}var k;if(n.length>1){k=new Kekule.MacroOperation(n)}else{k=n[0]}if(k){var q=this.getEditor();q.execOperation(k)}},_createNewDataToAtomOperation:function(p,k){if(!p){return}var h=p.nodeClass;var l=p.props;var j=p.repositoryItem;var m;if(j){var i=j.createObjects(k)||{};var o=i.objects;var n=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),j,i,k,null);this.getEditor().transformCoordAndSizeOfObjects(o,n);m=o[0];h=m.getClass()}if(p.isUnknownPseudoatom&&!this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()){h=null}if(!h){Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL"));return null}else{return this._createModificationOperation(k,m,h,l)}},_createModificationOperation:function(i,o,q,n){var o;var j,k;var h=i.getClass();if(o&&!q){q=o.getClass()}if(o||q!==h){j=new Kekule.MacroOperation();if(!o){o=new q()}var l=new Kekule.ChemStructureNode();l.assign(i);o.assign(l);var p=new Kekule.ChemStructOperation.ReplaceNode(i,o,null,this.getEditor());j.add(p)}else{o=i}if(n){k=new Kekule.ChemObjOperation.Modify(o,n,this.getEditor());if(j){j.add(k)}}var m=j||k;return m}});Kekule.Editor.ObjModifier.Bond=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Bond",initialize:function($super,h){$super(h);this._activeSelBtnHtmlClass=null;this._defaultBondTypeData=null;this._valueStorage={};var i=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=i[0]},initProperties:function(){this.defineProp("bondSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},doCreateWidget:function(){var h=new Kekule.Widget.DropDownButton(this.getEditor());h.setHint(Kekule.$L("ChemWidgetTexts.HINT_BOND_MODIFIER"));h.setText(Kekule.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER"));h.setShowText(false);h.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);h.addClassName(g.COMPOSER_BOND_MODIFIER_BUTTON);h.setDropDownWidgetGetter(this._createBondSelector.bind(this));if(this._defaultBondTypeData.htmlClass){h.addClassName(this._defaultBondTypeData.htmlClass)}return h},_filterBond:function(k){var h=[];for(var m=0,j=k.length;m<j;++m){var n=k[m];if(n instanceof Kekule.Bond){h.push(n)}}return h},_getActualModificationBonds:function(k,m){var h=[];for(var o=0,j=k.length;o<j;++o){var p=k[o];if(p instanceof Kekule.StructureFragment&&p.isExpanded()){var n=this._getActualModificationBonds(p.getNodes(),true);a.pushUnique(h,n);a.pushUnique(h,p.getConnectors())}else{if(p instanceof Kekule.Bond){h.push(p)}}}if(!m){h=this._filterBond(h)}return h},_createBondSelector:function(i){if(!i){i=this.getEditor()}var h=new Kekule.ChemWidget.StructureConnectorSelectPanel(i);h.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER"));h.addClassName(g.COMPOSER_BOND_MODIFIER_DROPDOWN);if(this.getEditor().getEnabledBondFormData){var k=this.getEditor().getEnabledBondFormData();h.setBondPropNames(this._getBondComparePropNames(k));h.setBondData(k)}if(this._valueStorage.bondsPropValues){h.setActiveBondPropValues(this._valueStorage.bondsPropValues)}this.setPropStoreFieldValue("bondSelector",h);var j=this;h.addEventListener("valueChange",function(l){j.applyToTargets();h.dismiss()});return h},_setActiveBondHtmlClass:function(i){var h=this._activeSelBtnHtmlClass;if(h){this.getWidget().removeClassName(h)}this._activeSelBtnHtmlClass=i;if(!i){i=this._defaultBondTypeData.htmlClass}if(i){this.getWidget().addClassName(i)}},_extractBondPropValues:function(h,i){return h.getPropValues(i)},_extractBondsPropValues:function(n,o){var h;var m;for(var k=0,j=n.length;k<j;++k){m=this._extractBondPropValues(n[k],o);if(!h){h=m}else{if(!Kekule.Editor.StructureUtils.isBondPropsMatch(h,m,o)){h=null;break}}}return h},_getBondComparePropNames:function(m){var j=[];for(var n=0,k=m.length;n<k;++n){var o=m[n];var h=o.bondProps;if(h){a.pushUnique(j,Kekule.ObjUtils.getOwnedFieldNames(h))}}return j},_getMatchedBondData:function(o,k,j){if(!o){return null}for(var m=0,h=k.length;m<h;++m){var n=k[m];if(n&&Kekule.Editor.StructureUtils.isBondPropsMatch(o,n.bondProps,j)){return n}}return null},doLoadFromTargets:function(k,i){var n=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=n[0];var h=this._getActualModificationBonds(i);this._valueStorage.connectors=h;if(this.getBondSelector()){this.getBondSelector().setBondData(n);var m=this.getBondSelector().getBondPropNames();var l=this._extractBondsPropValues(h,m);this.getBondSelector().setActiveBondPropValues(l);this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())}else{this._valueStorage.bondPropNames=this._getBondComparePropNames(n);this._valueStorage.bondsPropValues=this._extractBondsPropValues(h,this._valueStorage.bondPropNames);var j=this._getMatchedBondData(this._valueStorage.bondsPropValues,n,this._valueStorage.bondPropNames);this._setActiveBondHtmlClass(j&&j.htmlClass)}this.getWidget().setDisplayed(!!h.length)},doApplyToTargets:function($super,p,q){var k=this.getBondSelector().getActiveBondPropValues();var m=[];var r=this._getActualModificationBonds(q);for(var n=0,h=r.length;n<h;++n){var s=r[n];var o=this._createBondModificationOperation(k,s);if(o){m.push(o)}}var j;if(m.length>1){j=new Kekule.MacroOperation(m)}else{j=m[0]}if(j){var p=this.getEditor();p.execOperation(j)}this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())},_createBondModificationOperation:function(h,i){var j=new Kekule.ChemObjOperation.Modify(i,h,this.getEditor());return j}});Kekule.Editor.ObjModifier.Charge=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Charge",initialize:function($super,h){$super(h);this._valueStorage={}},initProperties:function(){this.defineProp("chargeSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},doCreateWidget:function(){var h=new Kekule.Widget.DropDownButton(this.getEditor());h.setHint(Kekule.$L("ChemWidgetTexts.HINT_CHARGE_MODIFIER")).setText(Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN")).setShowText(true).setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);h.addClassName(g.COMPOSER_CHARGE_MODIFIER_BUTTON);h.setDropDownWidgetGetter(this._createChargeSelector.bind(this));return h},_createChargeSelector:function(i){if(!i){i=this.getEditor()}var h=new Kekule.ChemWidget.ChargeSelectPanel(i);h.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_CHARGE_MODIFIER"));h.addClassName(g.COMPOSER_CHARGE_MODIFIER_DROPDOWN);if(Kekule.ObjUtils.notUnset(this._valueStorage.charge)){h.setValue(this._valueStorage.charge)}this.setPropStoreFieldValue("chargeSelector",h);var j=this;h.addEventListener("valueChange",function(k){j.applyToTargets();h.dismiss()});return h},_filterStructureNodes:function(j){var k=[];for(var m=0,h=j.length;m<h;++m){var n=j[m];if(n instanceof Kekule.ChemStructureNode&&n.getCharge){k.push(n)}}return k},_getActualModificationNodes:function(m,k){var h=[];for(var o=0,j=m.length;o<j;++o){var p=m[o];if(p instanceof Kekule.StructureFragment&&p.isExpanded()){var n=this._getActualModificationNodes(p.getNodes(),true);a.pushUnique(h,n)}else{h.push(p)}}if(!k){h=this._filterStructureNodes(h)}return h},_getChargeOfNodes:function(k){var h=null;for(var m=0,j=k.length;m<j;++m){var p=k[m];if(p.getCharge){var o=p.getCharge()||0;if(h===null){h=o}else{if(h!==o){return null}}}}return h},doLoadFromTargets:function(k,l){var i;var h=this._getActualModificationNodes(l);var o=(h.length>=0)&&(h.length<=1);if(o){var m=this._getChargeOfNodes(h);this._valueStorage.charge=m;if(this.getChargeSelector()){this.getChargeSelector().setValue(m)}var p;if(m){var j=(m>0)?Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE"):Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE");var n=Kekule.NumUtils.toDecimals(m,1);p=Math.abs(n)+j}else{p=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN")}this.getWidget().setText(p).setShowText(true)}this.getWidget().setDisplayed(o)},doApplyToTargets:function($super,p,q){var s=this.getChargeSelector().getValue();var m=[];var h=this._getActualModificationNodes(q);var p=this.getEditor();for(var n=0,j=h.length;n<j;++n){var r=h[n];if(r instanceof Kekule.ChemStructureNode){var o=new Kekule.ChemObjOperation.Modify(r,{charge:s},p);if(o){m.push(o)}}}var k;if(m.length>1){k=new Kekule.MacroOperation(m)}else{k=m[0]}if(k){var p=this.getEditor();p.execOperation(k)}}});var b=Kekule.Editor.ObjModifierManager;b.register(Kekule.ChemStructureNode,[Kekule.Editor.ObjModifier.Atom]);b.register(Kekule.ChemStructureNode,[Kekule.Editor.ObjModifier.Charge]);b.register([Kekule.Bond,Kekule.StructureFragment],[Kekule.Editor.ObjModifier.Bond])})();(function(){var a=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.ChemIdEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemIdEditor",getAttributes:function($super){var b=$super();if(b&a.MULTIOBJS){b=b^a.MULTIOBJS}return b}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemIdEditor,null,Kekule.ChemObject,"id");Kekule.PropertyEditor.ChemCoordSizeFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordSizeFieldEditor",initProperties:function(){this.defineProp("parentObjects",{dataType:DataType.Object,serializable:false});this.defineProp("parentPropName",{dataType:DataType.STRING,serializable:false})},getCoordFieldValue:function(j,g,h){if(!j.length){return undefined}var e=j[0].getPropValue(g);if(!e){return undefined}var b=e[h];for(var f=1,c=j.length;f<c;++f){var d=j[f].getPropValue(g)[h];if(d!==b){return undefined}}return b},getValue:function($super){var b=this.getParentObjects();var c=this.getParentPropName();if(b&&c){return this.getCoordFieldValue(b,c,this.getPropertyName())}else{return $super()}}});Kekule.PropertyEditor.ChemCoordEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordEditor",is3DCoord:function(){var b=this.getPropertyName();return(b.indexOf("3")>=0)},getFieldEditorClass:function(b,c){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function($super,d,c){var b=$super(d,c);if(b.setParentObjects){b.setParentObjects(this.getObjects())}if(b.setParentPropName){b.setParentPropName(this.getPropertyName())}return b},getFieldValueType:function(b,c){return DataType.FLOAT},getObjFields:function(b){return this.is3DCoord()?["x","y","z"]:["x","y"]},getValueText:function($super){var f=Kekule.Widget.ValueListEditor.ValueDisplayMode;var d=this.getValueTextMode();if(d===f.JSON){return $super()}var g=this.getValue();if(g){var e=this.getObjFields();var j="";for(var c=0,b=e.length;c<b;++c){var h=g[e[c]];if(Kekule.ObjUtils.notUnset(h)){if(!!j){j+=", "}j+=e[c]+": "+h}}return"{"+j+"}"}else{return""}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord3D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord3D");Kekule.PropertyEditor.ChemSizeEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemSizeEditor",is3DSize:function(){var b=this.getPropertyName();return(b.indexOf("3")>=0)},getFieldEditorClass:function(b,c){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function($super,d,c){var b=$super(d,c);if(b.setParentObjects){b.setParentObjects(this.getObjects())}if(b.setParentPropName){b.setParentPropName(this.getPropertyName())}return b},getFieldValueType:function(b,c){return DataType.FLOAT},getObjFields:function(b){return this.is3DSize()?["x","y","z"]:["x","y"]},getValueText:function($super){var f=Kekule.Widget.ValueListEditor.ValueDisplayMode;var d=this.getValueTextMode();if(d===f.JSON){return $super()}var g=this.getValue();if(g){var e=this.getObjFields();var j="";for(var c=0,b=e.length;c<b;++c){var h=g[e[c]];if(Kekule.ObjUtils.notUnset(h)){if(!!j){j+=", "}j+=e[c]+": "+h}}return"{"+j+"}"}else{return""}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size3D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"screenSize");Kekule.PropertyEditor.ChemOptionObjectEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemOptionObjectEditor",CHILD_FIELD_INFOS:null,initialize:function($super){$super();this.setAllowEmpty(true)},getObjFieldInfos:function(g){var e=ClassEx.getCommonSuperClass(this.getObjects());var b=[];var h=this.CHILD_FIELD_INFOS;for(var d=0,c=h.length;d<c;++d){var f=h[d];if(!f.targetClass||!e||ClassEx.isOrIsDescendantOf(e,f.targetClass)){b.push(f)}}b.sort(function(j,i){return(j.name>i.name)?1:(j.name<i.name)?-1:0});return b},notifyChildEditorValueChange:function($super,d,c){var b=this.getValue()||this._initialObjValue;b=Object.extend({},b);if(Kekule.ObjUtils.notUnset(c)){b[d]=c}else{delete b[d]}this.setValue(b)}});Kekule.PropertyEditor.ChemRender2DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender2DOptionsEditor",CHILD_FIELD_INFOS:[{name:"expanded",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"unitLength",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"moleculeDisplayType",dataType:DataType.INT,enumSource:Kekule.Render.MoleculeDisplayType,targetClass:Kekule.StructureFragment},{name:"renderType",dataType:DataType.INT,enumSource:Kekule.Render.BondRenderType,targetClass:Kekule.ChemStructureConnector},{name:"nodeDisplayMode",dataType:DataType.INT,enumSource:Kekule.Render.NodeLabelDisplayMode,targetClass:Kekule.ChemStructureNode},{name:"hydrogenDisplayLevel",dataType:DataType.INT,enumSource:Kekule.Render.HydrogenDisplayLevel,targetClass:Kekule.ChemStructureNode},{name:"showCharge",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkType",dataType:DataType.INT,enumSource:Kekule.Render.ChargeMarkRenderType,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkFontSize",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkMargin",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chemMarkerFontSize",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chemMarkerMargin",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"distinguishSingletAndTripletRadical",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"fontSize",dataType:DataType.NUMBER},{name:"fontFamily",dataType:DataType.STRING},{name:"supFontSizeRatio",dataType:DataType.FLOAT},{name:"subFontSizeRatio",dataType:DataType.FLOAT},{name:"superscriptOverhang",dataType:DataType.FLOAT},{name:"subscriptOversink",dataType:DataType.FLOAT},{name:"textBoxXAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxXAlignment},{name:"textBoxYAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxYAlignment},{name:"horizontalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"verticalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"charDirection",dataType:DataType.INT,enumSource:Kekule.Render.TextDirection},{name:"customLabel",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"boldBondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"hashSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingAbs",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondMaxAbsSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowLength",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeHashMinWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondLengthScaleRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"opacity",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"fillColor",dataType:DataType.STRING},{name:"strokeColor",dataType:DataType.STRING},{name:"strokeWidth",dataType:DataType.NUMBER},{name:"atomRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender2DOptionsEditor,null,Kekule.ChemObject,"renderOptions");Kekule.PropertyEditor.ChemRender3DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender3DOptionsEditor",CHILD_FIELD_INFOS:[{name:"displayMultipleBond",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"useVdWRadius",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"nodeRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"nodeRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"connectorLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"hideHydrogens",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"bondSpliceMode",dataType:DataType.INT,enumSource:Kekule.Render.Bond3DSpliceMode,targetClass:Kekule.ChemStructureObject}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender3DOptionsEditor,null,Kekule.ChemObject,"render3DOptions");Kekule.PropertyEditor.GlyphPathParamsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathParamsEditor",CHILD_FIELD_INFOS:[{name:"lineCount",dataType:DataType.INT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"lineGap",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowType",dataType:DataType.STRING,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowType",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.GlyphPathParamsEditor,null,Kekule.Glyph.PathGlyphConnector,"pathParams")})();