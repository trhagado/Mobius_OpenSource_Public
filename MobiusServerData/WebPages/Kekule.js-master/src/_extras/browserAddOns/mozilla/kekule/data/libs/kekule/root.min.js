var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());"use strict";var $jsRoot=this;function emptyFunction(){}function $A(c){if(!c){return[]}if(c.toArray){return c.toArray()}var b=c.length||0,a=new Array(b);while(b--){a[b]=c[b]}return a}var Class={createCore:function(){var e=null,d=$A(arguments);if(Object.isFunction(d[0])){e=d.shift()}function a(){this.initialize.apply(this,arguments)}Object.extend(a,Class.Methods);a.superclass=e;a.subclasses=[];if(e){var b=function(){};b.prototype=e.prototype;a.prototype=new b;e.subclasses.push(a)}for(var c=0;c<d.length;c++){a.addMethods(d[c])}if(!a.prototype.initialize){a.prototype.initialize=emptyFunction}a.prototype.constructor=a;return a},create:function(){var a=Class.createCore.apply(this,arguments);return a},free:function(a){if(a.finalize){a.finalize()}a=null}};Class.Methods={addMethods:function(b){if(!b){return this}var f=this.superclass&&this.superclass.prototype;var h=Object.keys(b);if(!Object.keys({toString:true}).length){h.push("toString","valueOf")}var g=function(){};for(var e=0,d=h.length;e<d;e++){var k=h[e];var j=b[k];var c=Object.isFunction(j);if(f&&c&&j.argumentNames().first()=="$super"){var a=j;j=(function(i){return function(){return(f[i]||g).apply(this,arguments)}})(k).wrap(a);j.valueOf=a.valueOf.bind(a);j.toString=a.toString.bind(a)}this.prototype[k]=j}return this}};Object.extend=function(a,e,f,d){for(var c in e){var b=e[c];if(f&&((b===undefined)||(b===null))){continue}if(d&&(b==="")){continue}a[c]=b}return a};Object.getCascadeFieldValue=function(f,c){var a;var e;if(f.length&&f.splice){e=f}else{e=f.split(".")}if(!c){var c=this}for(var d=0,b=e.length;d<b;++d){a=c[e[d]];if(!a){break}else{c=a}}return a};Object.setCascadeFieldValue=function(k,h,f,g){var e;if(k.length&&k.splice){e=k}else{e=k.split(".")}var j=f;for(var d=0,b=e.length;d<b;++d){var a=e[d];if(d===b-1){j[a]=h;return true}else{var c=j[a];if(!c&&g){c={};j[a]=c}if(!c){return false}else{j=c}}}};Object._inherit=function(b){if(b===null){b={}}var a=typeof(b);if(!(DataType.isFunctionType(a)||DataType.isObjectType(a))){throw TypeError()}function c(){}c.prototype=b;return new c()};if(!Object.create){Object.create=Object._inherit}Object.copyValues=function(b,e,g){if(!g){return Object.extend(b,source)}else{for(var c=0,a=g.length;c<a;++c){var f=g[c];var d=e[f];if(d!==undefined){b[f]=d}}return b}};Object.extend(Object,{keys:function(a){var b=[];for(var c in a){b.push(c)}return b},isFunction:function(a){return typeof a=="function"},isUndefined:function(a){return typeof a=="undefined"}});Object.extend(Function.prototype,{argumentNames:function(){var a=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return a.length==1&&!a[0]?[]:a},wrap:function(b){var a=this;return function(){return b.apply(this,[a.bind(this)].concat($A(arguments)))}},methodize:function(){if(this._methodized){return this._methodized}var a=this;return this._methodized=function(){var b=Array.prototype.slice.call(arguments);b.unshift(this);return a.apply(null,b)}}});if(!Function.prototype.bind){Object.extend(Function.prototype,{bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var a=this,c=$A(arguments),b=c.shift();return function(){return a.apply(b,c.concat($A(arguments)))}}})}Object.extend(Array.prototype,{first:function(){return this[0]},last:function(){return this[this.length-1]},clear:function(){this.length=0;return this},without:function(){var a=$A(arguments);return this.select(function(b){return !a.include(b)})},removeAt:function(a){this.splice(a,1)},remove:function(b){var a=this.indexOf(b);if(a>=0){return this.removeAt(a)}}});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,a){a||(a=0);var b=this.length;if(a<0){a=b+a}for(;a<b;a++){if(this[a]===c){return a}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(b,a){a=isNaN(a)?this.length:(a<0?this.length+a:a)+1;var c=this.slice(0,a).reverse().indexOf(b);return(c<0)?c:a-c-1}}Object.extend(String.prototype,{truncate:function(b,a){b=b||30;a=Object.isUndefined(a)?"...":a;return this.length>b?this.slice(0,b-a.length)+a:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var b=new RegExp(Prototype.ScriptFragment,"img");var a=new RegExp(Prototype.ScriptFragment,"im");return(this.match(b)||[]).map(function(c){return(c.match(a)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var a=arguments.callee;a.text.data=this;return a.div.innerHTML},unescapeHTML:function(){var a=new Element("div");a.innerHTML=this.stripTags();return a.childNodes[0]?(a.childNodes.length>1?$A(a.childNodes).inject("",function(b,c){return b+c.nodeValue}):a.childNodes[0].nodeValue):""},toQueryParams:function(b){var a=this.strip().match(/([^?#]*)(#.*)?$/);if(!a){return{}}return a[1].split(b||"&").inject({},function(e,f){if((f=f.split("="))[0]){var c=decodeURIComponent(f.shift());var d=f.length>1?f.join("="):f[0];if(d!=undefined){d=decodeURIComponent(d)}if(c in e){if(!Object.isArray(e[c])){e[c]=[e[c]]}e[c].push(d)}else{e[c]=d}}return e})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(a){return a<1?"":new Array(a+1).join(this)},camelize:function(){var d=this.split("-"),a=d.length;if(a==1){return d[0]}var c=this.charAt(0)=="-"?d[0].charAt(0).toUpperCase()+d[0].substring(1):d[0];for(var b=1;b<a;b++){c+=d[b].charAt(0).toUpperCase()+d[b].substring(1)}return c},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},capitalizeFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(b){var a=this.gsub(/[\x00-\x1f\\]/,function(c){var d=String.specialChar[c[0]];return d?d:"\\u00"+c[0].charCodeAt().toPaddedString(2,16)});if(b){return'"'+a.replace(/"/g,'\\"')+'"'}return"'"+a.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(a){return this.sub(a||Prototype.JSONFilter,"#{1}")},isJSON:function(){var a=this;if(a.blank()){return false}a=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(a)},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(a){return this.indexOf(a)>-1},startsWith:function(a){return this.indexOf(a)===0},endsWith:function(a){var b=this.length-a.length;return b>=0&&this.lastIndexOf(a)===b},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(a,b){return new Template(this,b).evaluate(a)}});Object.extend(String.prototype,{upperFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},format:function(){var c=this;for(var a=0;a<arguments.length;a++){var b=new RegExp("\\{"+a+"\\}","gi");c=c.replace(b,arguments[a])}return c},ltrim:function(){return this.replace(/^\s+/,"")},rtrim:function(){return this.replace(/\s+$/,"")},pad:function(g,f,e){var h=f||" ";var c=[];for(var d=0,b=g-this.length;d<b;++d){c.push(h)}var j=this;if(e){return j+c.join("")}else{return c.join("")+j}},lpad:function(b,a){return this.pad(b,a,false)},rpad:function(b,a){return this.pad(b,a,true)},reverse:function(){var d=this.length;var b=[];for(var c=d-1;c>=0;--c){b.push(this.charAt(c))}return b.join("")},toCharArray:function(){var c=[];for(var d=0,b=this.length;d<b;++d){c.push(this.charAt(d))}return c},hyphenize:function(f){if(!f){f="-"}var b=this.length;var d=[];for(var e=0;e<b;++e){var g=this.charAt(e);if((e!==0)&&(g>="A")&&(g<="Z")){d.push(f+g.toLowerCase())}else{d.push(g)}}return d.join("")}});if(!String.prototype.trim){Object.extend(String.prototype,{trim:function(){return this.replace(/^\s*|\s*$/g,"")}})}if(!String.prototype.trimLeft){String.prototype.trimLeft=String.prototype.ltrim}if(!String.prototype.trimRight){String.prototype.trimLeft=String.prototype.rtrim}var StringUtils={STRUE:"$TRUE",SFALSE:"$FALSE",SUNDEFINED:"$UNDEFINED",SNULL:"$NULL",SNAN:"$NAN",SPOSITIVE:"+",SNEGATIVE:"-",SDATEPREFIX:"@",isAllDigitalChar:function(e){for(var b=0,a=e.length;b<a;++b){var f=e.charAt(b);var d=(f>="0")&&(f<="9");if((!d)&&(f!=".")){return false}}return true},serializeValue:function(b,e){var d=e||[];var c=DataType.getType(b);if(d.indexOf(c)>=0){return b.toString()}if(b===null){return StringUtils.SNULL}else{if(typeof(b)=="undefined"){return StringUtils.SUNDEFINED}else{if(b!=b){return StringUtils.SNAN}else{switch(c){case"boolean":return b?StringUtils.STRUE:StringUtils.SFALSE;break;case"number":var a=(b>=0)?StringUtils.SPOSITIVE:"";return a+b;break;case DataType.DATE:return StringUtils.SDATEPREFIX+b.toString();default:return b.toString()}}}}},deserializeValue:function(d,a){if(typeof(d)!=="string"){return d}switch(d){case StringUtils.STRUE:return true;break;case StringUtils.SFALSE:return false;break;case StringUtils.SNULL:return null;break;case StringUtils.SUNDEFINED:return undefined;break;case StringUtils.SNAN:return NaN;break;default:if(a){switch(a){case DataType.FLOAT:return parseFloat(d);break;case DataType.INT:return parseInt(d);break;case"number":return parseFloat(d);break;case"boolean":return !!d;break;default:return d}}else{var c=d.charAt(0);switch(c){case StringUtils.SPOSITIVE:case StringUtils.SNEGATIVE:var b=d.substring(1);if(StringUtils.isAllDigitalChar(b)){return parseFloat(d)}else{return d}break;case StringUtils.SDATEPREFIX:var b=d.substr(1);return new Date(b);default:return d}}}}};Object.extend(Date.prototype,{copyFrom:function(a){this.setFullYear(a.getFullYear(),a.getMonth(),a.getDate());this.setTime(a.getTime())}});Math.sqr=function(a){return a*a};if(!Math.sign){Math.sign=function(a){return(a>0)?1:(a<0)?-1:0}}if(!this.Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}Class.PropertyScope={DEFAULT:3,PUBLISHED:3,PUBLIC:2,PRIVATE:1};Class.PropList=function(){this.props=[]};Class.PropList.prototype={addProperty:function(c,b){if(!b){b={}}var a;a=this.getPropInfo(c);if(!a){a={};this.props.push(a)}a=Object.extend(a,b);if(a.serializable===undefined){a.serializable=true}a.name=c;return a},removeProperty:function(b){var a=this.indexOf(b);if(a>=0){this.props.splice(a,1)}},removePropAt:function(a){if(a>=0){var b=this.props[a];if(b){this.props.splice(a,1)}}},getLength:function(){return this.props.length},indexOf:function(c){for(var b=0,a=this.props.length;b<a;++b){if(this.props[b].name===c){return b}}return -1},getPropInfoAt:function(a){if(a>=0){return this.props[a]}else{return null}},getPropInfo:function(c){var a;var b=this.indexOf(c);var a=this.getPropInfoAt(b);return a},hasProperty:function(a){return(this.indexOf(a)>=0)},clear:function(){this.props.clear()},clone:function(){var a=new Class.PropList();a.props=this.props.slice();return a},appendList:function(a){for(var c=0,b=a.props.length;c<b;++c){this.props.push(a.props[c])}}};Class.PropList.prototype.constructor=Class.PropList;Class.EventHandlerList=function(){this.handlers=[];this._$flag_="KekuleEventList"};Class.EventHandlerList.prototype={add:function(b,a){if(!a){a=null}this.handlers.push({thisArg:a,handler:b})},remove:function(d,a){var b=this.indexesOf(d,a);if(b.length>0){for(var c=b.length-1;c>=0;--c){this.removeAt(b[c])}}},removeAt:function(b){for(var c=b,a=this.handlers.length;c<a;++c){this.handlers[c]=this.handlers[c+1]}this.handlers.length=this.handlers.length-1},clear:function(){this.handlers=[]},getHandlerInfo:function(a){return this.handlers[a]},indexOf:function(d,b){for(var c=0,a=this.handlers.length;c<a;++c){if(this.handlers[c].handler==d){if((b!==undefined)&&(this.handlers[c].thisArg===b)){return c}else{if(b===undefined){return c}}}}return -1},indexesOf:function(e,c){var a=[];for(var d=0,b=this.handlers.length;d<b;++d){if(this.handlers[d].handler==e){if((c!==undefined)&&(this.handlers[d].thisArg===c)){a.push(d)}else{if(c===undefined){a.push(d)}}}}return a},getLength:function(){return this.handlers.length}};Class.EventHandlerList.constructor=Class.EventHandlerList;var DataType={UNKNOWN:null,VARIANT:null,PRIMARY:"primary",UNDEFINED:"undefined",BOOL:"boolean",BOOLEAN:"boolean",NUMBER:"number",INT:"int",INTEGER:"int",FLOAT:"float",STRING:"string",ARRAY:"array",FUNCTION:"function",DATE:"date",HASH:"object",OBJECT:"object",OBJECTEX:"objectex",CLASS:"class",isSimpleType:function(a){return(a==DataType.STRING)||(a==DataType.NUMBER)||(a==DataType.INT)||(a==DataType.FLOAT)||(a==DataType.BOOL)||(a==DataType.UNDEFINED)||(a==DataType.PRIMARY)},isComplexType:function(a){return !(DataType.isSimpleType(a)||DataType.isFunctionType(a))},isFunctionType:function(a){return a==DataType.FUNCTION},isObjectType:function(a){return a==DataType.OBJECT},isDateType:function(a){return a==DataType.DATE},isObjectExType:function(b){var a=DataType.isComplexType(b)&&(!DataType.isObjectType(b))&&(!DataType.isDateType(b));if(a){var c=ClassEx.findClass(b);a=c&&ClassEx.isOrIsDescendantOf(c,ObjectEx)}return a},getType:function(b){var a=typeof(b);switch(a){case"undefined":return DataType.UNDEFINED;case"function":return DataType.FUNCTION;case"boolean":return DataType.BOOL;case"string":return DataType.STRING;case"number":if(Math.floor(b)==b){return DataType.INT}else{return DataType.FLOAT}case"object":if(this.isDateValue(b)){return DataType.DATE}else{if(DataType.isArrayValue(b)){return DataType.ARRAY}else{if(ClassEx.isClass(b)){return DataType.CLASS}else{if(DataType.isObjectExValue(b)&&b.getClassName){return b.getClassName()}else{return DataType.OBJECT}}}}default:return a}},isSimpleValue:function(a){return DataType.isSimpleType(typeof(a))},isUndefinedValue:function(a){return typeof(a)=="undefined"},isNullValue:function(a){return(a===null)},isFunctionValue:function(a){return typeof(a)=="function"},isObjectValue:function(a){if(a){return(typeof(a)=="object")&&(!DataType.isArrayValue(a))&&(!DataType.isDateValue(a))}else{return false}},isDateValue:function(a){if(a){return((typeof(a)=="object")&&(a.getFullYear!==undefined))}return false},isArrayValue:function(a){if(a){return((typeof(a)=="object")&&(a.length!==undefined))}else{return false}},isObjectExValue:function(a){return(a instanceof ObjectEx)},createInstance:function(a){switch(a){case DataType.UNDEFINED:return undefined;case DataType.DATE:return new Date();case DataType.ARRAY:return new Array();case DataType.OBJECT:return new Object();case DataType.FUNCTION:return new Function();default:var b=ClassEx.findClass(a.capitalizeFirst());return new b()}}};var ClassEx={isClass:function(a){if(!a){return false}return(a.superclass&&a.subclasses)},findClass:function(b,a){return Object.getCascadeFieldValue(b,a||$jsRoot)},getClassName:function(a){return a.prototype.CLASS_NAME},getPrototype:function(a){return a.prototype},getSuperClass:function(a){return a.superclass||a.constructor.superclass},getSuperClassPrototype:function(a){if(a.superclass){return a.superclass.prototype}else{return null}},_getCommonSuperClass2:function(c,b){var a=c;while(a&&(!ClassEx.isOrIsDescendantOf(b,a))){a=ClassEx.getSuperClass(a)}return a},getCommonSuperClass:function(e){if(!e||!e.length){return null}var a=e[0].getClass?e[0].getClass():null;if(!a){return null}for(var c=1,b=e.length;c<b;++c){var d=e[c].getClass?e[c].getClass():null;if(!d){return null}a=ClassEx._getCommonSuperClass2(a,d)}return a},isDescendantOf:function(c,b){var a=ClassEx.getSuperClass(c);while(a&&(a!==b)){a=ClassEx.getSuperClass(a)}return !!a},isOrIsDescendantOf:function(b,a){return(b===a)||ClassEx.isDescendantOf(b,a)},isOrIsDescendantOfClasses:function(c,d){for(var b=0,a=d.length;b<a;++b){if(ClassEx.isOrIsDescendantOf(c,d[b])){return true}}return false},_ensurePropertySystem:function(c){var b=ClassEx.getPrototype(c);if(!b){return}if(!b.hasOwnProperty("properties")){var a=ClassEx.getSuperClass(c);if(a){ClassEx._ensurePropertySystem(a)}ClassEx._createPropertyList(c);if(b.hasOwnProperty("initProperties")){b.initProperties.apply(b)}}},_createPropertyList:function(a){if(!ClassEx.getPrototype(a).hasOwnProperty("properties")){ClassEx.getPrototype(a).properties=new Class.PropList()}},getOwnPropList:function(b){var a=ClassEx.getPrototype(b);if(a){a._initPropertySystem();return a.properties}else{return null}},getAllPropList:function(c){var a;var b=ClassEx.getSuperClassPrototype(c);if(b){a=b.getAllPropList().clone();a.appendList(ClassEx.getOwnPropList(c))}else{a=ClassEx.getOwnPropList(c)}return a},getPropListOfScopes:function(e,d){var b=function(j,h){var l=ClassEx.getOwnPropList(j).clone();if(l){for(var g=l.getLength()-1;g>=0;--g){var f=l.getPropInfoAt(g);var k=f.scope||Class.PropertyScope.DEFAULT;if(h.indexOf(k)<0){l.removePropAt(g)}}}return l};var a;var c=ClassEx.getSuperClass(e);if(c){a=ClassEx.getPropListOfScopes(c,d).clone();a.appendList(b(e,d))}else{a=b(e,d)}return a},defineProp:function(b,c,a){ClassEx._ensurePropertySystem(b);return ClassEx.getPrototype(b).defineProp(c,a)},defineProps:function(g,a){ClassEx._ensurePropertySystem(g);var f=ClassEx.getPrototype(g);for(var d=0,b=a.length;d<b;++d){var e=a[d];var h=e.name;var c=e;f.defineProp(h,c)}},getPropInfo:function(a,b){return ClassEx.getPrototype(a).getPropInfo(b)},defineEvent:function(b,a){return ClassEx.getPrototype(b).defineEvent(a)},getUnusedMethodName:function(e,d,c){var g=c||0;var b=g;var f=ClassEx.getPrototype(e);var a=d+Number(b).toString();while(f[a]){++b;a=d+Number(b).toString()}return a},extendMethod:function(d,b,g){var c=ClassEx.getPrototype(d);var f=c[b];var a=ClassEx.getUnusedMethodName(d,"__$changed$_"+b+"__");c[a]=f;var e=(function(h){return function(){return c[h].apply(this,arguments)}})(a).wrap(g);c[b]=e;e.valueOf=g.valueOf.bind(g);e.toString=g.toString.bind(g)},extend:function(o,m){var f=ClassEx.getPrototype(o);var g=ClassEx.getSuperClassPrototype(o);var k=Object.keys(m);if(!Object.keys({toString:true}).length){k.push("toString","valueOf")}for(var d=0,c=k.length;d<c;d++){var n=k[d],l=m[n];if(typeof(l)=="function"){var j=l.argumentNames();var e=j.first();if(e=="$origin"){var a=l;var b=f[n];var h=ClassEx.getUnusedMethodName(o,"__$changed$_"+n+"__");f[h]=b;l=(function(i){return function(){return f[i].apply(this,arguments)}})(h).wrap(a);l.valueOf=a.valueOf.bind(a);l.toString=a.toString.bind(a);j.shift();e=j.first()}if(e=="$super"){var a=l;l=(function(i){return function(){return g[i].apply(this,arguments)}})(n).wrap(a);l.valueOf=a.valueOf.bind(a);l.toString=a.toString.bind(a)}}f[n]=l}return o}};var ObjectEx=Class.create({CLASS_NAME:"ObjectEx",initialize:function(){this._initPropertySystem();this.initPropValues();this._updateStatus=0;this._childChangeEventSuppressed=false;this._modifiedProps=[];this._finalized=false;this.afterInitialization()},afterInitialization:function(){},finalize:function(){if(!this._finalized){this.doFinalize();this.invokeEvent("finalize",{obj:this});this.setPropStoreFieldValue("eventHandlers",null);this._finalized=true}},doFinalize:function(){},initProperties:function(){this.defineProp("enablePropValueGetEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("enablePropValueSetEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("bubbleEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("suppressChildChangeEventInUpdating",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("eventHandlers",{dataType:DataType.HASH,serializable:false,scope:Class.PropertyScope.PRIVATE,getter:function(){var a=this.getPropStoreFieldValue("eventHandlers");if(!a){a={};this.setPropStoreFieldValue("eventHandlers",a)}return a}})},initPropValues:function(){},getHigherLevelObj:function(){return null},saved:function(){},loaded:function(){},_initPropertySystem:function(){if(!this.getPrototype().hasOwnProperty("properties")){var a=this.getSuperClassPrototype();if(a){a._initPropertySystem.apply(a)}this._createPropertyList();if(this.getPrototype().hasOwnProperty("initProperties")){this.getPrototype().initProperties.apply(this.getPrototype())}}},_createPropertyList:function(){if(!this.getPrototype().hasOwnProperty("properties")){this.getPrototype().properties=new Class.PropList()}},getClass:function(){return this.constructor},getSuperClass:function(){return this.getClass().superclass},getClassName:function(){return this.getPrototype().CLASS_NAME},getSerializationName:function(){return this.getClassName()},getPrototype:function(){if(this.prototype){return this.prototype}else{return this.constructor.prototype}},getSuperClassPrototype:function(){if(this.constructor&&this.constructor.superclass){return this.constructor.superclass.prototype}else{return null}},getOwnPropList:function(){this._initPropertySystem();return this.getPrototype().properties},getAllPropList:function(){var a;var b=this.getSuperClassPrototype();if(b){a=b.getAllPropList().clone();a.appendList(this.getOwnPropList())}else{a=this.getOwnPropList().clone()}return a},getPropListOfScopes:function(a){return ClassEx.getPropListOfScopes(this.getClass(),a)},getPropInfoHashKey:function(a){return ObjectEx._PROPINFO_HASHKEY_PREFIX+a},getDefPropStoreFieldName:function(a){return ObjectEx._PROP_STOREFIELD_PREFIX+a},defineProp:function(c,a){if(!a){a={}}if(a.serializable===undefined){a.serializable=true}if(!a.storeField){a.storeField=this.getDefPropStoreFieldName(c)}var b=this.getOwnPropList();var d=b.addProperty(c,a);if(a.getter!==null){d.getter=this.createPropGetter(d,a.getter)}if(a.setter!==null){d.setter=this.createPropSetter(d,a.setter)}this[this.getPropInfoHashKey(c)]=d;return d},createPropGetter:function(f,a){var d=f.name.toString().upperFirst();var c="get"+d;var b="doGet"+d;var e=this[b];if(!e){e=a||new Function('return this["'+f.storeField+'"];');this.getPrototype()[b]=e}this.getPrototype()[c]=function(){var g=Array.prototype.slice.call(arguments);return this[b].apply(this,g)};return b},createPropSetter:function(g,f){var d=g.name.toString();var c=d.upperFirst();var b="set"+c;var a="doSet"+c;var e=this[a];if(!this[a]){e=f||new Function("value",'this["'+g.storeField+'"] = value;');this.getPrototype()[a]=e}this.getPrototype()[b]=function(){var h=Array.prototype.slice.call(arguments);var i=h[0];this[a].apply(this,h);this.notifyPropSet(d,i);return this};return a},hasProperty:function(a){return(this.getPropInfo(a)!=null)},getPropInfo:function(e){var b=e||"";var d=this.getPropInfoHashKey(b)||"";var a=this[d];if(!a){a=this.getOwnPropList().getPropInfo(b);if(!a){var c=this.getSuperClassPrototype();if(c&&c.getPropInfo){a=c.getPropInfo(b)}else{a=null}}}return a},getPropertyDataType:function(a){var b=this.getPropInfo(a);return b?b.dataType:null},isPropertySerializable:function(b){var c=this.getPropInfo(b);var a=c.serializable;return(a===undefined)||(!!a)},getPropStoreFieldValue:function(a){var b=this.getPropInfo(a);if(b.storeField){return this[b.storeField]}else{return undefined}},getPropValue:function(c){var a;var d=this.getPropInfo(c);if(d){if(d.getter){var b=Array.prototype.slice.call(arguments);b.shift();a=this[d.getter].apply(this,b)}else{a=this[d.storeField]}return a}else{return null}},setPropStoreFieldValue:function(c,b){var a;var d=this.getPropInfo(c);if(d.storeField){this[d.storeField]=b}},setPropValue:function(c,b,a){var d=this.getPropInfo(c);if(d){if(d.setter){this[d.setter].apply(this,[b])}else{if(a){this[d.storeField]=b}}this.notifyPropSet(c,b)}return this},setPropValueX:function(){var a=Array.prototype.slice.call(arguments);var b=a.shift();var c=this.getPropInfo(b);if(c){if(c.setter){this[c.setter].apply(this,a)}this.notifyPropSet(b,this.getPropValue(b))}return this},setPropValues:function(c,a){for(var b in c){if(c.hasOwnProperty(b)){if(this.hasProperty(b)){var d=c[b];this.setPropValue(b,d,a)}}}return this},_isPropGetOrSetEvent:function(a){return(a=="propValueGet")||(a=="propValueSet")},notifyPropSet:function(a,b,c){if(this.isUpdating()){if(this._modifiedProps.indexOf(a)<0){this._modifiedProps.push(a)}return}if(this._isPropGetOrSetEvent(a)||this.isEventPropName(a)){return}this.doPropChanged(a,b);if(this.getPropStoreFieldValue("enablePropValueSetEvent")){this.invokeEvent("propValueSet",{propName:a,propValue:b})}if(!c){this.objectChange([a])}},objectChange:function(a){this.doObjectChange(a);this.invokeEvent("change",{changedPropNames:a})},doObjectChange:function(a){},doPropChanged:function(a,b){},defineEvent:function(b){return;var c=this.eventNameToPropName(b);var a=this.defineProp(c,{serializable:false,setter:null});return a},eventNameToPropName:function(a){return"__event_"+a},isEventPropName:function(a){return((typeof(a)=="string")&&(a.indexOf("__event_")>=0))},isEventHandlerList:function(a){return(a&&(typeof(a)=="object")&&(a instanceof Class.EventHandlerList))},getEventHandlerList:function(b){var c=this.getEventHandlers();var a=c[b];if(!a){a=new Class.EventHandlerList();c[b]=a}return a},addEventListener:function(b,d,a){var c=this.getEventHandlerList(b);if(this.isEventHandlerList(c)){return c.add(d,a)}else{return null}},addOnceEventListener:function(c,d,a){var b=this;var e=function(f){b.removeEventListener(c,e,a);d(f)};return this.addEventListener(c,e,a)},removeEventListener:function(b,d,a){var c=this.getEventHandlerList(b);if(this.isEventHandlerList(c)){return c.remove(d,a)}},invokeEvent:function(a,b){if(!b){b={}}b.name=a;b.target=this;b.stopPropagation=this._eventStopPropagation;this.dispatchEvent(a,b)},relayEvent:function(a,b){b.currentTarget=this;if(a==="change"&&this.getSuppressChildChangeEventInUpdating()&&this.isUpdating()){this._childChangeEventSuppressed=true}else{this.dispatchEvent(a,b)}},dispatchEvent:function(b,e){var f=this.getEventHandlerList(b);if(this.isEventHandlerList(f)){for(var c=0,a=f.getLength();c<a;++c){var g=f.getHandlerInfo(c);if(g.handler){g.handler.apply(g.thisArg,[e])}}}else{console.log(b,this.getClassName(),f._$flag_)}var d=this.getHigherLevelObj();if(!e.cancelBubble&&this.getBubbleEvent()&&d){if(d.relayEvent){d.relayEvent(b,e)}}},stopEventPropagation:function(a){a.cancelBubble=true},assign:function(a){return a.assignTo(this)},assignTo:function(a){var b={};this.saveObj(b,"json");a.loadObj(b,"json")},clone:function(){var b=this.getClass();var a=new b();this.assignTo(a);return a},beginUpdate:function(){++this._updateStatus},endUpdate:function(){--this._updateStatus;this.checkUpdateStatus();if(!this.isUpdating()){var a=this._modifiedProps||[];this._modifiedProps=[];if(this._childChangeEventSuppressed){a.push("[children]")}this.doEndUpdate(a);this._childChangeEventSuppressed=false}},doEndUpdate:function(c){if(c.length){if(this.getPropStoreFieldValue("enablePropValueSetEvent")){for(var b=0,a=c.length;b<a;++b){var d=c[b];var e=this.getPropValue(d);this.notifyPropSet(d,e,true)}}this.objectChange(c)}},isUpdating:function(){return this._updateStatus>0},isPropUpdated:function(a){return(this._modifiedProps.indexOf(a)>=0)},checkUpdateStatus:function(){if(this._updateStatus<=0){this._updateStatus=0}},copyPropsTo:function(b){var d=this.getAllPropList();for(var c=0,a=d.getLength();c<a;++c){var e=d.getPropInfoAt(c).name;if(b.hasProperty(e)){var f=this.getPropValue(e);b.setPropValue(e,f,true)}}}});ObjectEx._PROPINFO_HASHKEY_PREFIX="__$propInfo__";ObjectEx._PROP_STOREFIELD_PREFIX="__$";var JsonUtility={DEF_LOAD_TIMEOUT:20000,FILE_EXT_JSON:".json",FILE_EXT_JSON_JS_WRAPPER:".jsonjs",DEF_SERIALIZE_TO_JSCODE_VARNAME:"__jsonvar__",parse:function(a){return JSON.parse(a)},parseFromJsWrappedCode:function(code,jsVarName){if(!jsVarName){jsVarName=JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}eval(code);return JsonUtility.parse(eval(jsVarName))},load:function(b,d,a){var c=WebShow.URL.getFileExt(b);if(c.toLowerCase()==JsonUtility.FILE_EXT_JSON_JS_WRAPPER){return JsonUtility.loadJsWrapper(b,d,a)}else{return JsonUtility.loadJson(b,d,a)}},loadJsWrapper:function(url,callback,options){var loptions=options||{};var wrapperVarName=loptions.wrapperVarName||JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME;if(!loptions.timeout){loptions.timeout=JsonUtility.DEF_LOAD_TIMEOUT}var runCallBack=function(jsonObj,isSuccess){if(callback){callback(jsonObj,isSuccess)}};var wrapperCallback=function(src,isSuccess){var jsonObj=null;if(isSuccess){var wrapperVar=eval(wrapperVarName);if(wrapperVar){if(typeof(wrapperVar)=="string"){jsonObj=JsonUtility.parse(wrapperVar)}else{jsonObj=wrapperVar}}runCallBack(jsonObj,true)}else{runCallBack(null,false)}};WebShow.ScriptLoader.load(url,wrapperCallback,loptions)},loadJson:function(c,e,b){loptions=b||{};if(!loptions.timeout){loptions.timeout=JsonUtility.DEF_LOAD_TIMEOUT}loptions.resultType=WebShow.FileLoader.ResultType.TEXT;loptions.extractBody=false;var d=function(h,f,g){if(f){var i=JsonUtility.parse(h);e(i,true)}else{e(null,false)}};var a=new WebShow.XHRLoader();a.load(c,d,loptions)},serializeToStr:function(b,a){if(a&&a.prettyPrint){return JSON.stringify(b,null,a.indentSpaces||2)}else{return JSON.stringify(b)}},serializeToJsCode:function(d,b,e){if(!e){e="'"}if(!b){b=JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}var a=JsonUtility.serializeToStr(d);var c=new RegExp(e,"g");a=a.replace(c,"\\"+e);return"var "+b+" = "+e+a+e}};var XmlUtility={DEF_INCLUDE_TAG_NAME:"include",DEF_INCLUDE_SRC_ATTRIB:"src",DEF_LOAD_TIMEOUT:20000,DEF_BYPASS_ROOT_ELEM:true,DEF_SERIALIZE_TO_JSCODE_VARNAME:"__xmlStr__",FILE_EXT_XML:".xml",FILE_EXT_XML_JS_WRAPPER:".xmljs",newDocument:function(b,a){if(!b){b=""}if(!a){a=""}if(document.implementation&&document.implementation.createDocument){var f=document.implementation.createDocument(a,b,null);return f}else{var f=new ActiveXObject("MSXML2.DOMDocument");if(b){var d="";var c=b;var e=b.indexOf(":");if(e!=-1){d=b.substring(0,e);c=b.substring(e+1)}var g="<"+(d?(d+":"):"")+c+(a?((d?" xmlns:":" xmlns")+d+'="'+a+'"'):"")+"/>";f.loadXML(g)}return f}},parse:function(d){if(typeof DOMParser!="undefined"){return(new DOMParser()).parseFromString(d,"application/xml")}else{if(typeof ActiveXObject!="undefined"){var c=XmlUtility.newDocument();c.loadXML(d);return c}else{var a="data:text/xml;charset=utf-8,"+encodeURIComponent(d);var b=new XMLHttpRequest();b.open("GET",a,false);b.send(null);return b.responseXML}}},load:function(b,d,a){var c=WebShow.URL.getFileExt(b);if(c.toLowerCase()==XmlUtility.FILE_EXT_XML_JS_WRAPPER){return XmlUtility.loadHelper.loadJsWrapper(b,d,a)}if(!a){a={disableInclude:false}}if(!a.disableInclude){return XmlUtility.loadHelper.loadAndHandleIncludeElement(b,d,a)}else{return XmlUtility.loadHelper.loadSimple(b,d,a.timeout)}},loadHelper:{loadSimple:function(a,h,f){var b=(h!=null);if((f===null)||(f===undefined)){f=XmlUtility.DEF_LOAD_TIMEOUT}if(!(document.implementation&&document.implementation.createDocument)){return XmlUtility.loadHelper.loadSimpleViaDoc(a,h)}else{var d=new XMLHttpRequest();var i=null;if(f){i=setTimeout(function(){j(null,false)},f)}var j=function(k,e){if(i){clearTimeout(i)}if(h){h(k,e)}};if(b){d.onreadystatechange=function(){if(d.readyState==4){var e=d.responseXML;if(e&&e.documentElement){j(e,true)}else{j(null,false)}}}}try{d.open("get",a,b);d.send(null)}catch(c){WebShow.reportError(c);j(null,false)}var g=d.responseXML;if(g&&g.documentElement){return g}else{return null}}},loadSimpleViaDoc:function(c,e){var b="dummy_dummy_dummy_dummy";var d=(e!=null);var a=XmlUtility.newDocument(b);a.async=d;if(d){a.onreadystatechange=function(){if(a.readyState==4){if((!a.documentElement)||(a.documentElement.tag==b)){e(a,false)}else{e(a,true)}}}}a.load(c);return a},loadAndHandleIncludeElement:function(c,f,b){var e;if(b){e=b.timeout}else{e=null}var d=(f==null);if(d){var a=XmlUtility.loadHelper.loadSimple(c,null,e);if(a&&a.documentElement){XmlUtility.loadHelper.handleIncludedXmlInElement(a.documentElement,null,b);return a}else{return null}}else{return XmlUtility.loadHelper.loadSimple(c,function(h,g){if(!g){f(h,false)}else{XmlUtility.loadHelper.handleIncludedXmlInElement(h.documentElement,function(i){f(h,true)},b)}},e)}},loadJsWrapper:function(url,callback,options){options=options||{};var wrapperVarName=options.wrapperVarName||XmlUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME;var loadTimeout=options.timeout;if((loadTimeout===null)||(loadTimeout===undefined)){loadTimeout=XmlUtility.DEF_LOAD_TIMEOUT}var runCallBack=function(xmldoc,isSuccess){if(callback){callback(xmldoc,isSuccess)}};var wrapperCallback=function(src,isSuccess){if(isSuccess){var xmlContent=eval(wrapperVarName);var doc=XmlUtility.parse(xmlContent);runCallBack(doc,true)}else{runCallBack(null,false)}};options.timeout=loadTimeout;WebShow.ScriptLoader.load(url,wrapperCallback,options)},getIncludeElements:function(b,c){var a=[];if(!c){c=XmlUtility.DEF_INCLUDE_TAG_NAME}return b.getElementsByTagName(c)},handleIncludedXmlInElement:function(b,n,p){if(!p){p={}}var j=p.includeTagName||XmlUtility.DEF_INCLUDE_TAG_NAME;var o=p.srcAttribName||XmlUtility.DEF_INCLUDE_SRC_ATTRIB;var a=(p.bypassRootElem!=null)?p.bypassRootElem:XmlUtility.DEF_BYPASS_ROOT_ELEM;var k=(n==null);var m=XmlUtility.getXmlDocUrl(b.ownerDocument);var h=XmlUtility.loadHelper.getIncludeElements(b,j);if(!o){var d=null}var e=null;var l=0;var c=h.length;if(c<=0){if(n){n(0)}return null}var f;for(var g=h.length-1;g>=0;--g){e=h[g];d=e.getAttribute(o);if(d){d=WebShow.URL.mergePath(d,m);if(k){f=XmlUtility.loadHelper.loadSimple(d);if(f){XmlUtility.loadHelper.insertIncludedSection(f,e,a)}}else{XmlUtility.loadHelper.loadSimple(d,(function(r,q,i){if(i&&q){f=q;XmlUtility.loadHelper.insertIncludedSection(f,r,a)}l++;if(l==c){n(l)}}).bind(this,e))}}}return b},insertIncludedSection:function(j,h,a){var c=[];if(a){var d=j.documentElement.firstChild;while(d){if(d.nodeType==Node.ELEMENT_NODE){c.push(d)}d=d.nextSibling}}else{c.push(j.documentElement)}var f;var b=h.ownerDocument;var e=b.documentElement;for(var k=0,g=c.length;k<g;++k){var f=c[k];if(b.importNode){f=b.importNode(f,true)}h.parentNode.insertBefore(f,h)}h.parentNode.removeChild(h);return b}},serializeNode:function(b,a){if(a&&a.prettyPrint){return XmlUtility.serializeNodePretty(b)}if(typeof XMLSerializer!="undefined"){return(new XMLSerializer()).serializeToString(b)}else{if(b.xml){return b.xml}else{throw"XML.serialize is not supported or can't serialize "+b}}},serializeNodePretty:function(a){try{return XML((new XMLSerializer()).serializeToString(a)).toXMLString()}catch(b){return XmlUtility.serializeNode(a)}},serializeNodeToJsCode:function(d,a,c){if(!c){c="'"}if(!a){a=XmlUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}var e=XmlUtility.serializeNode(d);var b=new RegExp(c,"g");e=e.replace(b,"\\"+c);return"var "+a+" = "+c+e+c+";"},parseFromJsWrappedCode:function(code,jsVarName){eval(code);var xmlText=eval(jsVarName);return XmlUtility.parse(xmlText)},getXmlDocUrl:function(a){return a.url||a.documentURI||a.URL||a.location}};var ObjSerializer=Class.create({CLASS_NAME:"ObjSerializer",serializeValue:function(a){return a},deserializeValue:function(b,a){return b},propNameToStorageName:function(a){return a},storageNameToPropName:function(a){return a},getObjCustomSaveMethod:function(a){return(a.doSaveObj)},getObjCustomLoadMethod:function(a){return(a.doLoadObj)},getObjCustomPropSaveMethod:function(a){return(a.doSaveProp)},getObjCustomPropLoadMethod:function(a){return(a.doLoadProp)},isUndefined:function(a){return DataType.isUndefinedValue(a)},isNull:function(a){return(a===null)},isNaN:function(a){return a!=a},isFunction:function(a){return DataType.isFunctionValue(a)},isArray:function(a){return DataType.isArrayValue(a)},isDate:function(a){return DataType.isDateValue(a)},isObject:function(a){return DataType.isObjectValue(a)},isObjectEx:function(a){return DataType.isObjectExValue(a)},isSimpleType:function(b){var a=typeof(b);return(a=="string")||(a=="number")||(a=="boolean")||(a=="undefined")||(this.isNull(b))},isComplexType:function(a){return(!this.isSimpleType(a))},createChildStorageNode:function(c,b,a){},appendArrayItemStorageNode:function(b,c,a){},getNameForArrayItemStorageNode:function(a){var b=this.getDefaultArrayItemStorageName();return b},getChildStorageNode:function(a,b){},getAllArrayItemStorageNodes:function(a){},getAllStoredStorageNames:function(a){},setStorageNodeExplicitType:function(a,b){},getStorageNodeExplicitType:function(a){},getStorageNodeName:function(a){},isComplexStorageNode:function(a){},isComplexArrayItemStorageNode:function(a){},isSimpleStorageNode:function(a){},getValueExplicitType:function(a){if(a instanceof ObjectEx){return a.getClassName()}else{if(this.isObject(a)){return DataType.OBJECT}else{if(this.isArray(a)){return DataType.ARRAY}else{if(this.isDate(a)){return DataType.DATE}else{return(typeof a)}}}}},getDefaultArrayItemStorageName:function(){return"item"},getDefaultDateStorageName:function(){return"date"},save:function save(d,c,b){if(typeof(d)=="object"){var e=this.getObjCustomSaveMethod(d);if(e){return e(d,c,this)}}var a=this.doSave(d,c,b||{});if(a&&this.isFunction(d.saved)){d.saved()}return a},doSave:function(c,b,a){if(typeof(c)=="object"){if(c instanceof ObjectEx){this.doSaveObjectEx(c,b,a)}else{if(this.isArray(c)){this.doSaveArray(c,b)}else{if(this.isDate(c)){this.doSaveDate(c,b)}else{this.doSaveSimpleObject(c,b)}}}}this.setStorageNodeExplicitType(b,this.getValueExplicitType(c));return c},doSaveSimpleObject:function(d,b){for(var e in d){if(!d.hasOwnProperty(e)){continue}var a=d[e];var c;if(this.isComplexType(a)){c=this.getValueExplicitType(a)}this.doSaveFieldValue(d,e,a,b,c)}},doSaveArray:function(b,e){for(var c=0,a=b.length;c<a;++c){var d=b[c];var g=this.getNameForArrayItemStorageNode(d);if(this.isComplexType(d)){var f=this.appendArrayItemStorageNode(e,this.propNameToStorageName(g),this.isArray(d));this.setStorageNodeExplicitType(f,this.getValueExplicitType(d));this.save(d,f)}else{this.doAppendArrayItemSimpleValue(this.serializeValue(d),typeof(d),e)}}},doSaveDate:function(c,b){var a=c.toUTCString();this.doSaveSimpleValue(c,this.propNameToStorageName(this.getDefaultDateStorageName()),this.serializeValue(a),DataType.DATE,b)},doSaveObjectEx:function(f,b,m){var j=f.getAllPropList();var h=m.propFilter;for(var g=0,c=j.getLength();g<c;++g){var a=j.getPropInfoAt(g);var d=h?h(a,f):true;if(!d){continue}var e=this.getObjCustomPropSaveMethod(f);var k=false;if(e){k=e(f,a,b,this)}if(!!k){continue}if(a.serializable){this.doSaveObjectExProp(f,a,b,m)}}},doSaveObjectExProp:function(e,h,c,a){var b=h.name;var g=h.dataType;var f=e.getPropValue(b);if(a.saveDefaultValues||(f!==h.defaultValue)){var d;if(f instanceof ObjectEx){if(f.getClassName()!=g){d=f.getClassName()}}else{if(this.isComplexType(f)){d=this.getValueExplicitType(f);if(d==g){d=undefined}}}this.doSaveFieldValue(e,b,f,c,d)}},doSaveFieldValue:function(d,e,b,a,c){if(typeof(b)!="function"){if(this.isComplexType(b)){subNode=this.createChildStorageNode(a,this.propNameToStorageName(e),this.isArray(b));if(c){this.setStorageNodeExplicitType(subNode,c)}this.save(b,subNode)}else{this.doSaveSimpleValue(d,this.propNameToStorageName(e),this.serializeValue(b),this.getValueExplicitType(b),a)}}},doSaveSimpleValue:function(d,a,c,e,b){},doAppendArrayItemSimpleValue:function(b,c,a){},load:function(c,b){if(!c){var e=this.getStorageNodeExplicitType(b);if(e){c=DataType.createInstance(e)}else{if(this.doLoadUntypedNode){return this.doLoadUntypedNode(b)}else{return null}}}if(typeof(c)==="object"){var d=this.getObjCustomLoadMethod(c);if(d){return d(c,b,this)}}var a=this.doLoad(c,b);if(a&&this.isFunction(c.loaded)){c.loaded()}return a},doLoad:function(c,a){var b=this.getStorageNodeExplicitType(a);if(typeof(c)=="object"){if(c instanceof ObjectEx){c=this.doLoadObjectEx(c,a)}else{if(this.isArray(c)){c=this.doLoadArray(c,a)}else{if(this.isDate(c)){c=this.doLoadDate(c,a)}else{c=this.doLoadSimpleObject(c,a)}}}}return c},doLoadArray:function(j,a){var g=this.getAllArrayItemStorageNodes(a);for(var f=0,c=g.length;f<c;++f){var b=g[f];if(this.isComplexArrayItemStorageNode(b)){var e;var d=this.getStorageNodeExplicitType(b)||this.getStorageNodeName(b);if(d){e=DataType.createInstance(d);this.load(e,b)}else{e={};this.load(e,b)}j.push(e)}else{var h=this.deserializeValue(this.doGetArrayItemSimpleStorageValue(b));j.push(h)}}return j},doLoadDate:function(e,d){var a=this.propNameToStorageName(this.getDefaultDateStorageName());var b=this.doLoadSimpleValue(e,a,DataType.DATE,d);if(b){var c=new Date(b);e.copyFrom(c);return e}else{return undefined}},doLoadSimpleObject:function(d,a){var b=this.getAllStoredStorageNames(a);for(var e=0,c=b.length;e<c;++e){var k=b[e];var j=this.storageNameToPropName(k);var f=this.getChildStorageNode(a,k);if(f){var m;var h=this.getStorageNodeExplicitType(f);if(h){m=DataType.createInstance(h)}else{m={}}this.load(m,f);d[j]=m}else{var g=this.doLoadSimpleValue(d,k,null,a);d[j]=g}}return d},doLoadObjectEx:function(f,e){var d=f.getAllPropList();for(var c=0,a=d.getLength();c<a;++c){var h=d.getPropInfoAt(c);if(!h.serializable){continue}var g=this.getObjCustomPropLoadMethod(f);var b=false;if(g){b=g(f,h,e,this)}if(!!b){continue}this.doLoadObjectExProp(f,h,e)}return f},doLoadObjectExProp:function(c,f,b){var a=f.name;var e=f.dataType;var d=this.doLoadFieldValue(c,a,b,e);if((d!==null)&&(d!==undefined)){c.setPropValue(a,d,true)}},doLoadFieldValue:function(f,h,c,b){var a;var e=false;if(DataType.isComplexType(b)){var g=this.getChildStorageNode(c,this.propNameToStorageName(h));if(g){var d=this.getStorageNodeExplicitType(g);if(d&&(d!=b)){a=DataType.createInstance(d)}else{a=DataType.createInstance(b)}this.load(a,g);e=true}}if(DataType.isSimpleType(b)||(!e)){a=this.doLoadSimpleValue(f,this.propNameToStorageName(h),b,c)}return a},doLoadSimpleValue:function(d,a,e,c){var b=this.doLoadSimpleStorageValue(a,c);return this.deserializeValue(b,e)},doLoadSimpleStorageValue:function(a,b){},doGetArrayItemSimpleStorageValue:function(a){}});var JsonObjSerializer=Class.create(ObjSerializer,{CLASS_NAME:"JsonObjSerializer",TYPE_TAG_NAME:"__type__",createChildStorageNode:function(d,c,b){var a=b?[]:{};d[c]=a;return a},appendArrayItemStorageNode:function(c,d,b){var a=b?[]:{};c.push(a);return a},getChildStorageNode:function(b,c){var a=b[c];if(this.isSimpleType(a)){a=null}return a},getAllArrayItemStorageNodes:function(b){var a=Array.prototype.slice.call(b);return a},getAllStoredStorageNames:function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){if(b!=this.TYPE_TAG_NAME){a.push(b)}}}return a},isComplexStorageNode:function(a){return this.isComplexType(a)},isComplexArrayItemStorageNode:function(a){return this.isComplexStorageNode(a)},isSimpleStorageNode:function(a){return this.isSimpleType(a)},setStorageNodeExplicitType:function(a,b){if(!this.isArray(a)){a[this.TYPE_TAG_NAME]=b}},getStorageNodeExplicitType:function(b){var a=b[this.TYPE_TAG_NAME]||null;if((!a)&&this.isArray(b)){return DataType.ARRAY}else{return a}},doSaveSimpleValue:function(d,a,c,e,b){b[a]=c},doAppendArrayItemSimpleValue:function(b,c,a){return a.push(b)},doLoadSimpleStorageValue:function(a,b){return b[a]},doLoadUntypedNode:function(a){return a},doGetArrayItemSimpleStorageValue:function(a){return a}});var XmlObjSerializer=Class.create(ObjSerializer,{CLASS_NAME:"XmlObjSerializer",TYPE_TAG_NAME:"dataType",getLocalName:function(a){return a.localName||a.baseName||a.nodeName},getElemTextValue:function(d){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==Node.TEXT_NODE){a+=d.childNodes[c].nodeValue}}return a},serializeValue:function(a){return StringUtils.serializeValue(a)},deserializeValue:function(b,a){return StringUtils.deserializeValue(b,a)},createChildStorageNode:function(d,c,b){var a=d.ownerDocument.createElement(c);d.appendChild(a);return a},appendArrayItemStorageNode:function(b,c,a){return this.createChildStorageNode(b,c,a)},getAllArrayItemStorageNodes:function(b){var a=[];for(var d=0,c=b.childNodes.length;d<c;++d){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE){a.push(e)}}return a},getAllStoredStorageNames:function(f){var a=[];for(var c=0,b=f.childNodes.length;c<b;++c){var d=f.childNodes[c];if(d.nodeType==Node.ELEMENT_NODE){if(this.getLocalName(d)!=this.TYPE_TAG_NAME){a.push(this.getLocalName(d))}}}for(var c=0,b=f.attributes.length;c<b;++c){var e=f.attributes[c];if(this.getLocalName(e)!=this.TYPE_TAG_NAME){a.push(this.getLocalName(e))}}return a},getChildStorageNode:function(b,f){var a=null;for(var d=0,c=b.childNodes.length;d<c;++d){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE){if(this.getLocalName(e)==f){a=e}}}return a},isComplexStorageNode:function(a){return a.nodeType==Node.ELEMENT_NODE},isComplexArrayItemStorageNode:function(a){return this.isComplexStorageNode(a)&&(a.attributes.length)&&(!this.getElemTextValue(a).trim())},isSimpleStorageNode:function(a){return a.nodeType==Node.ATTRIBUTE_NODE},setStorageNodeExplicitType:function(a,b){a.setAttribute(this.TYPE_TAG_NAME,b)},getStorageNodeExplicitType:function(a){return a.getAttribute(this.TYPE_TAG_NAME)||null},getStorageNodeName:function(b){var a=b.tagName;if(a==this.getDefaultArrayItemStorageName()){return null}else{return a}},doSaveSimpleObject:function($super,b,a){$super(b,a)},doSaveArray:function($super,a,b){$super(a,b)},doSaveSimpleValue:function(d,a,c,e,b){b.setAttribute(a,c)},doAppendArrayItemSimpleValue:function(c,e,a){var b=this.appendArrayItemStorageNode(a,this.propNameToStorageName(this.getDefaultArrayItemStorageName()),false);var d=b.ownerDocument.createTextNode(c);b.appendChild(d)},doLoadSimpleStorageValue:function(a,b){return b.getAttribute(a)},doGetArrayItemSimpleStorageValue:function(a){return this.getElemTextValue(a)}});var ObjSerializerFactory={_serializerClasses:{},_defaultName:null,registerSerializer:function(a,c,b){var d=(typeof(c)=="string")?ClassEx.findClass(c):c;ObjSerializerFactory._serializerClasses[a]=d;if(b){ObjSerializerFactory._defaultName=a}},getSerializer:function(a){var b=a||ObjSerializerFactory._defaultName;if(b){var c=ObjSerializerFactory._serializerClasses[b];return c?new c():null}else{return null}}};(function(){ObjSerializerFactory.registerSerializer("json",JsonObjSerializer,true);ObjSerializerFactory.registerSerializer("xml",XmlObjSerializer)})();ClassEx.extend(ObjectEx,{saveObj:function(c,a,b){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.save(this,c,b)},loadObj:function(b,a){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.load(this,b)}});var Kekule={LIBNAME:"Kekule.js",LIBNAME_CORE:"Kekule",VERSION:"0.6.0",PROP_AUTO_TITLE:true};var $jsRoot=this;Kekule.scriptSrcInfo=$jsRoot["__$kekule_load_info__"];if($jsRoot&&$jsRoot.addEventListener&&$jsRoot.postMessage){$jsRoot.addEventListener("message",function(a){if(a.data&&a.data.msg==="kekule-sys-info-query"){$jsRoot.postMessage({msg:"kekule-sys-info-result",libName:Kekule.LIBNAME,version:Kekule.VERSION},"*")}},false)};