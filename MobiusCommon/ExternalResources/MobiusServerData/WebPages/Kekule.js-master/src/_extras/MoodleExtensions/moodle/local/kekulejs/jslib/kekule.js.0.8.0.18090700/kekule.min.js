var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());"use strict";(function($jsRoot){function emptyFunction(){}function __$A__(iterable){if(!iterable){return[]}if(iterable.toArray){return iterable.toArray()}var length=iterable.length||0,results=new Array(length);while(length--){results[length]=iterable[length]}return results}var Class={createCore:function(){var parent=null,properties=__$A__(arguments);if(!properties[0]){if(properties.length>1){throw"Can not create new class, base class not found"}}if(Object.isFunction(properties[0])){parent=properties.shift()}function klass(){this.initialize.apply(this,arguments)}Object.extend(klass,Class.Methods);klass.superclass=parent;klass.subclasses=[];if(parent){var subclass=function(){};subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass)}for(var i=0;i<properties.length;i++){klass.addMethods(properties[i])}if(!klass.prototype.initialize){klass.prototype.initialize=emptyFunction}klass.prototype.constructor=klass;return klass},create:function(){var result=Class.createCore.apply(this,arguments);return result},free:function(obj){if(obj.finalize){obj.finalize()}obj=null}};Class.Methods={addMethods:function(source){if(!source){return this}var ancestor=this.superclass&&this.superclass.prototype;var properties=Object.keys(source);if(!Object.keys({toString:true}).length){properties.push("toString","valueOf")}var doNothing=function(){};for(var i=0,length=properties.length;i<length;i++){var property=properties[i];var value=source[property];var isFunction=Object.isFunction(value);if(ancestor&&isFunction&&FunctionUtils.argumentNames(value)[0]==="$super"){var method=value;value=(function(m){return function(){return(ancestor[m]||doNothing).apply(this,arguments)}})(property).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method)}this.prototype[property]=value}return this}};Object.extend=function(destination,source,ignoreUnsetValue,ignoreEmptyString){if(!ignoreUnsetValue&&!ignoreEmptyString){for(var property in source){destination[property]=source[property]}}else{for(var property in source){var value=source[property];if(ignoreUnsetValue&&((value===undefined)||(value===null))){continue}if(ignoreEmptyString&&(value==="")){continue}destination[property]=value}}return destination};Object.extendEx=function(destination,source,options){var ops=options||{};for(var property in source){var value=source[property];if(ops.ignoreUnsetValue&&((value===undefined)||(value===null))){continue}if(ops.ignoreEmptyString&&(value==="")){continue}var oldValue=destination[property];if(options.preserveExisted&&oldValue){continue}var oldProto=oldValue&&oldValue.constructor&&oldValue.constructor.prototype;var newProto=value&&value.constructor&&value.constructor.prototype;if(oldValue&&typeof(oldValue)==="object"&&oldProto===newProto){Object.extendEx(oldValue,value,options)}else{destination[property]=value}}return destination};Object._extendSupportMethods=function(destination,methods){return Object.extendEx(destination,methods,{ignoreUnsetValue:true,preserveExisted:true})};Object.getCascadeFieldValue=function(fieldName,root){var result;var cascadeNames;if(fieldName.length&&fieldName.splice){cascadeNames=fieldName}else{cascadeNames=fieldName.split(".")}if(!root){var root=$jsRoot||this}for(var i=0,l=cascadeNames.length;i<l;++i){result=root[cascadeNames[i]];if(!result){break}else{root=result}}return result};Object.setCascadeFieldValue=function(fieldName,value,root,forceCreateEssentialObjs){var cascadeNames;if(fieldName.length&&fieldName.splice){cascadeNames=fieldName}else{cascadeNames=fieldName.split(".")}var parent=root;for(var i=0,l=cascadeNames.length;i<l;++i){var name=cascadeNames[i];if(i===l-1){parent[name]=value;return value}else{var obj=parent[name];if(!obj&&forceCreateEssentialObjs){obj={};parent[name]=obj}if(!obj){return false}else{parent=obj}}}};Object._inherit=function(proto){if(proto===null){proto={}}var t=typeof(proto);if(!(DataType.isFunctionType(t)||DataType.isObjectType(t))){throw TypeError()}function f(){}f.prototype=proto;return new f()};if(!Object.create){Object.create=Object._inherit}Object.copyValues=function(dest,src,propNames){if(!propNames){return Object.extend(dest,source)}else{for(var i=0,l=propNames.length;i<l;++i){var prop=propNames[i];var value=src[prop];if(value!==undefined){dest[prop]=value}}return dest}};Object._extendSupportMethods(Object,{keys:function(object){var keys=[];for(var property in object){keys.push(property)}return keys},isFunction:function(object){return typeof object=="function"},isUndefined:function(object){return typeof object=="undefined"}});if(!Object.getOwnPropertyNames){Object.getOwnPropertyNames=function(obj){var result=[];for(var k in obj){if(obj.hasOwnProperty(k)){result.push(k)}}return result}}var FunctionUtils={argumentNames:function(f){var names=((f.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)||[])[1]||"").replace(/\s+/g,"").split(",");return names.length==1&&!names[0]?[]:names}};Object._extendSupportMethods(Function.prototype,{argumentNames:function(){var names=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return names.length==1&&!names[0]?[]:names},wrap:function(wrapper){var __method=this;return function(){return wrapper.apply(this,[__method.bind(this)].concat(__$A__(arguments)))}},methodize:function(){if(this._methodized){return this._methodized}var __method=this;return this._methodized=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this);return __method.apply(null,a)}},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var __method=this,args=__$A__(arguments),object=args.shift();return function(){return __method.apply(object,args.concat(__$A__(arguments)))}},delay:function(){var __method=this,args=__$A__(arguments),timeout=args.shift();return window.setTimeout(function(){return __method.apply(__method,args)},timeout)},defer:function(){var __method=this,args=__$A__(arguments),timeout=args.shift();return window.setTimeout(function(){return __method.apply(__method,args)},10)}});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(item,i){i||(i=0);var length=this.length;if(i<0){i=length+i}for(;i<length;i++){if(this[i]===item){return i}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(item,i){i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1}}Object._extendSupportMethods(String.prototype,{gsub:function gsub(pattern,replacement){var result="",source=this,match;while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=replacement;source=source.slice(match.index+match[0].length)}else{result+=source,source=""}}return result},sub:function(pattern,replacement,count){count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0){return match[0]}return replacement(match)})},scan:function(pattern,iterator){this.gsub(pattern,iterator);return String(this)},truncate:function(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?"...":truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var matchAll=new RegExp(Prototype.ScriptFragment,"img");var matchOne=new RegExp(Prototype.ScriptFragment,"im");return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />")},unescapeHTML:function(){return this.replace(/\<br \/\>/g,"\n").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},toQueryParams:function(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match){return{}}return match[1].split(separator||"&").inject({},function(hash,pair){if((pair=pair.split("="))[0]){var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join("="):pair[0];if(value!=undefined){value=decodeURIComponent(value)}if(key in hash){if(!Object.isArray(hash[key])){hash[key]=[hash[key]]}hash[key].push(value)}else{hash[key]=value}}return hash})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(count){return count<1?"":new Array(count+1).join(this)},camelize:function(){var parts=this.split("-"),len=parts.length;if(len==1){return parts[0]}var camelized=this.charAt(0)=="-"?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++){camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1)}return camelized},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},capitalizeFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(useDoubleQuotes){var escapedString=this.gsub(/[\x00-\x1f\\]/,function(match){var character=String.specialChar[match[0]];return character?character:"\\u00"+match[0].charCodeAt().toPaddedString(2,16)});if(useDoubleQuotes){return'"'+escapedString.replace(/"/g,'\\"')+'"'}return"'"+escapedString.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(filter){return this.sub(filter||Prototype.JSONFilter,"#{1}")},isJSON:function(){var str=this;if(str.blank()){return false}str=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str)},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(pattern){return this.indexOf(pattern)>-1},startsWith:function(pattern){return this.indexOf(pattern)===0},endsWith:function(pattern){var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(object,pattern){return new Template(this,pattern).evaluate(object)}});Object._extendSupportMethods(String.prototype,{upperFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},format:function(){var formatted=this;for(var i=0;i<arguments.length;i++){var regexp=new RegExp("\\{"+i+"\\}","gi");formatted=formatted.replace(regexp,arguments[i])}return formatted},trim:function(){return this.replace(/^\s*|\s*$/g,"")},ltrim:function(){return this.replace(/^\s+/,"")},rtrim:function(){return this.replace(/\s+$/,"")},trimLeft:function(){return this.ltrim()},trimRight:function(){return this.rtrim()},pad:function(length,padString,rightPad){var p=padString||" ";var a=[];for(var i=0,l=length-this.length;i<l;++i){a.push(p)}var str=this;if(rightPad){return str+a.join("")}else{return a.join("")+str}},lpad:function(length,padString){return this.pad(length,padString,false)},rpad:function(length,padString){return this.pad(length,padString,true)},reverse:function(){var length=this.length;var a=[];for(var i=length-1;i>=0;--i){a.push(this.charAt(i))}return a.join("")},toCharArray:function(){var a=[];for(var i=0,l=this.length;i<l;++i){a.push(this.charAt(i))}return a},hyphenize:function(hyphen){if(!hyphen){hyphen="-"}var len=this.length;var a=[];for(var i=0;i<len;++i){var c=this.charAt(i);if((i!==0)&&(c>="A")&&(c<="Z")){a.push(hyphen+c.toLowerCase())}else{a.push(c)}}return a.join("")}});var StringUtils={STRUE:"$TRUE",SFALSE:"$FALSE",SUNDEFINED:"$UNDEFINED",SNULL:"$NULL",SNAN:"$NAN",SPOSITIVE:"+",SNEGATIVE:"-",SDATEPREFIX:"@",isAllDigitalChar:function(str){for(var i=0,l=str.length;i<l;++i){var c=str.charAt(i);var isDigital=(c>="0")&&(c<="9");if((!isDigital)&&(c!=".")){return false}}return true},isNumbericStr:function(str){var a=Number(str);return !isNaN(a)},serializeValue:function(value,unchangeTypes){var utypes=unchangeTypes||[];var vtype=DataType.getType(value);if(utypes.indexOf(vtype)>=0){return value.toString()}if(value===null){return StringUtils.SNULL}else{if(typeof(value)=="undefined"){return StringUtils.SUNDEFINED}else{if(value!=value){return StringUtils.SNAN}else{switch(vtype){case"boolean":return value?StringUtils.STRUE:StringUtils.SFALSE;break;case"number":case DataType.INT:case DataType.FLOAT:var sign=(value>=0)?StringUtils.SPOSITIVE:"";return sign+value;break;case DataType.DATE:return StringUtils.SDATEPREFIX+value.toString();default:return value.toString()}}}}},deserializeValue:function(str,preferedType){if(typeof(str)!=="string"){return str}switch(str){case StringUtils.STRUE:return true;break;case StringUtils.SFALSE:return false;break;case StringUtils.SNULL:return null;break;case StringUtils.SUNDEFINED:return undefined;break;case StringUtils.SNAN:return NaN;break;default:if(preferedType){switch(preferedType){case DataType.FLOAT:return parseFloat(str);break;case DataType.INT:return parseInt(str);break;case"number":return parseFloat(str);break;case"boolean":return !!str;break;default:return str}}else{var firstChar=str.charAt(0);switch(firstChar){case StringUtils.SPOSITIVE:case StringUtils.SNEGATIVE:var s=str.substring(1);if(StringUtils.isNumbericStr(s)){return parseFloat(str)}else{return str}break;case StringUtils.SDATEPREFIX:var s=str.substr(1);return new Date(s);default:return str}}}}};Object.extend(Date.prototype,{copyFrom:function(src){this.setFullYear(src.getFullYear(),src.getMonth(),src.getDate());this.setTime(src.getTime())}});if(!Math.sqr){Math.sqr=function(x){return x*x}}if(!Math.sign){Math.sign=function(x){return(x>0)?1:(x<0)?-1:0}}if(!$jsRoot.Node){$jsRoot.Node={}}if(!$jsRoot.Node.ELEMENT_NODE){Object.extend($jsRoot.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}Class.PropertyScope={DEFAULT:3,PUBLISHED:3,PUBLIC:2,PRIVATE:1};Class.PropList=function(){this.props=[]};Class.PropList.prototype={addProperty:function(propName,options){if(!options){options={}}var propInfo;propInfo=this.getPropInfo(propName);if(!propInfo){propInfo={};this.props.push(propInfo)}propInfo=Object.extend(propInfo,options);if(propInfo.serializable===undefined){propInfo.serializable=true}propInfo.name=propName;return propInfo},removeProperty:function(propName){var index=this.indexOf(propName);if(index>=0){this.props.splice(index,1)}},removePropAt:function(index){if(index>=0){var prop=this.props[index];if(prop){this.props.splice(index,1)}}},getLength:function(){return this.props.length},indexOf:function(propName){for(var i=0,l=this.props.length;i<l;++i){if(this.props[i].name===propName){return i}}return -1},getPropInfoAt:function(index){if(index>=0){return this.props[index]}else{return null}},getPropInfo:function(propName){var result;var index=this.indexOf(propName);var result=this.getPropInfoAt(index);return result},hasProperty:function(propName){return(this.indexOf(propName)>=0)},clear:function(){this.props.clear()},clone:function(){var result=new Class.PropList();result.props=this.props.slice();return result},appendList:function(propList){for(var i=0,l=propList.props.length;i<l;++i){this.props.push(propList.props[i])}}};Class.PropList.prototype.constructor=Class.PropList;Class.EventHandlerList=function(){this.handlers=[];this._$flag_="KekuleEventList"};Class.EventHandlerList.prototype={add:function(handler,thisArg){if(!thisArg){thisArg=null}this.handlers.push({thisArg:thisArg,handler:handler})},remove:function(handler,thisArg){var indexes=this.indexesOf(handler,thisArg);if(indexes.length>0){for(var i=indexes.length-1;i>=0;--i){this.removeAt(indexes[i])}}},removeAt:function(index){for(var i=index,l=this.handlers.length;i<l;++i){this.handlers[i]=this.handlers[i+1]}this.handlers.length=this.handlers.length-1},clear:function(){this.handlers=[]},getHandlerInfo:function(index){return this.handlers[index]},indexOf:function(handler,thisArg){for(var i=0,l=this.handlers.length;i<l;++i){if(this.handlers[i].handler==handler){if((thisArg!==undefined)&&(this.handlers[i].thisArg===thisArg)){return i}else{if(thisArg===undefined){return i}}}}return -1},indexesOf:function(handler,thisArg){var result=[];for(var i=0,l=this.handlers.length;i<l;++i){if(this.handlers[i].handler==handler){if((thisArg!==undefined)&&(this.handlers[i].thisArg===thisArg)){result.push(i)}else{if(thisArg===undefined){result.push(i)}}}}return result},getLength:function(){return this.handlers.length}};Class.EventHandlerList.constructor=Class.EventHandlerList;var DataType={UNKNOWN:null,VARIANT:null,PRIMARY:"primary",UNDEFINED:"undefined",BOOL:"boolean",BOOLEAN:"boolean",NUMBER:"number",INT:"int",INTEGER:"int",FLOAT:"float",STRING:"string",ARRAY:"array",FUNCTION:"function",DATE:"date",HASH:"object",OBJECT:"object",OBJECTEX:"objectex",CLASS:"class",isSimpleType:function(typeName){return(typeName==DataType.STRING)||(typeName==DataType.NUMBER)||(typeName==DataType.INT)||(typeName==DataType.FLOAT)||(typeName==DataType.BOOL)||(typeName==DataType.UNDEFINED)||(typeName==DataType.PRIMARY)},isComplexType:function(typeName){return !(DataType.isSimpleType(typeName)||DataType.isFunctionType(typeName))},isFunctionType:function(typeName){return typeName==DataType.FUNCTION},isObjectType:function(typeName){return typeName==DataType.OBJECT},isDateType:function(typeName){return typeName==DataType.DATE},isObjectExType:function(typeName){var result=DataType.isComplexType(typeName)&&(!DataType.isObjectType(typeName))&&(!DataType.isDateType(typeName));if(result){var classObj=ClassEx.findClass(typeName);result=classObj&&ClassEx.isOrIsDescendantOf(classObj,ObjectEx)}return result},getType:function(value){var stype=typeof(value);switch(stype){case"undefined":return DataType.UNDEFINED;case"function":return DataType.FUNCTION;case"boolean":return DataType.BOOL;case"string":return DataType.STRING;case"number":if(Math.floor(value)==value){return DataType.INT}else{return DataType.FLOAT}case"object":if(this.isDateValue(value)){return DataType.DATE}else{if(DataType.isArrayValue(value)){return DataType.ARRAY}else{if(ClassEx.isClass(value)){return DataType.CLASS}else{if(DataType.isObjectExValue(value)&&value.getClassName){return value.getClassName()}else{return DataType.OBJECT}}}}default:return stype}},isSimpleValue:function(value){return DataType.isSimpleType(typeof(value))},isUndefinedValue:function(value){return typeof(value)=="undefined"},isNullValue:function(value){return(value===null)},isFunctionValue:function(value){return typeof(value)=="function"},isObjectValue:function(value){if(value){return(typeof(value)=="object")&&(!DataType.isArrayValue(value))&&(!DataType.isDateValue(value))}else{return false}},isDateValue:function(value){if(value){return((typeof(value)=="object")&&(value.getFullYear!==undefined))}return false},isArrayValue:function(value){if(value){return((typeof(value)=="object")&&(value.length!==undefined))}else{return false}},isObjectExValue:function(value){return(value instanceof ObjectEx)},createInstance:function(typeName){switch(typeName){case DataType.UNDEFINED:return undefined;case DataType.DATE:return new Date();case DataType.ARRAY:return new Array();case DataType.OBJECT:return new Object();case DataType.FUNCTION:return new Function();default:var classInstance=ClassEx.findClass(typeName.capitalizeFirst());return new classInstance()}}};var __definePropertyAvailable__=Object.defineProperty&&(function(){try{Object.defineProperty({},"x",{});return true}catch(e){return false}}());var ClassEx={isClass:function(classObj){if(!classObj){return false}return !!(classObj.superclass||classObj.subclasses)},findClass:function(className,root){return Object.getCascadeFieldValue(className,root||$jsRoot)},getClassName:function(aClass){if(aClass){return aClass.prototype.CLASS_NAME}else{return null}},getClassLocalName:function(aClass){var className=ClassEx.getClassName(aClass);var pos=className.lastIndexOf(".");return(pos>=0)?className.substring(pos+1):className},getPrototype:function(aClass){return aClass.prototype},getSuperClass:function(aClass){return aClass.superclass||aClass.constructor.superclass},getSuperClassPrototype:function(aClass){if(aClass.superclass){return aClass.superclass.prototype}else{return null}},_getCommonSuperClass2:function(class1,class2){var result=class1;while(result&&(!ClassEx.isOrIsDescendantOf(class2,result))){result=ClassEx.getSuperClass(result)}return result},getCommonSuperClass:function(objects){if(!objects||!objects.length){return null}var result=objects[0].getClass?objects[0].getClass():null;if(!result){return null}for(var i=1,l=objects.length;i<l;++i){var classObj=objects[i].getClass?objects[i].getClass():null;if(!classObj){return null}result=ClassEx._getCommonSuperClass2(result,classObj)}return result},isDescendantOf:function(aClass,superClass){var ancestor=ClassEx.getSuperClass(aClass);while(ancestor&&(ancestor!==superClass)){ancestor=ClassEx.getSuperClass(ancestor)}return !!ancestor},isOrIsDescendantOf:function(aClass,superClass){return(aClass===superClass)||ClassEx.isDescendantOf(aClass,superClass)},isOrIsDescendantOfClasses:function(aClass,superClasses){for(var i=0,l=superClasses.length;i<l;++i){if(ClassEx.isOrIsDescendantOf(aClass,superClasses[i])){return true}}return false},_ensurePropertySystem:function(aClass){var proto=ClassEx.getPrototype(aClass);if(!proto){return}if(!proto.hasOwnProperty("properties")){var parent=ClassEx.getSuperClass(aClass);if(parent){ClassEx._ensurePropertySystem(parent)}ClassEx._createPropertyList(aClass);if(proto.hasOwnProperty("initProperties")){proto.initProperties.apply(proto)}}},_createPropertyList:function(aClass){if(!ClassEx.getPrototype(aClass).hasOwnProperty("properties")){ClassEx.getPrototype(aClass).properties=new Class.PropList()}},_remapPropGetters:function(aClass,availableFieldNames){var proto=ClassEx.getPrototype(aClass);var fieldNames=availableFieldNames||Object.getOwnPropertyNames(proto);for(var i=0,l=fieldNames.length;i<l;++i){var fieldName=fieldNames[i];if(fieldName.length>5&&fieldName.startsWith("doGet")){var field=proto[fieldName];if(typeof(field)==="function"){var propName=fieldName.charAt(5).toLowerCase()+fieldName.substr(6);if(proto.hasDirectProperty(propName)){continue}var propInfo=ClassEx.getPropInfo(aClass,propName);if(propInfo&&propInfo.getter){var getterName="get"+propName.capitalizeFirst();proto[getterName]=field;if(__definePropertyAvailable__){var descs=Object.extend({},propInfo.descriptor);descs.get=field;try{Object.defineProperty(proto,propName,descs)}catch(e){throw e}}}}}}},getOwnPropList:function(aClass){var proto=ClassEx.getPrototype(aClass);if(proto){proto._initPropertySystem();return proto.properties}else{return null}},getAllPropList:function(aClass){var result;var s=ClassEx.getSuperClassPrototype(aClass);if(s){result=s.getAllPropList().clone();result.appendList(ClassEx.getOwnPropList(aClass))}else{result=ClassEx.getOwnPropList(aClass)}return result},getPropListOfScopes:function(aClass,scopes){var findOwnList=function(aClass,scopes){var list=ClassEx.getOwnPropList(aClass).clone();if(list){for(var i=list.getLength()-1;i>=0;--i){var propInfo=list.getPropInfoAt(i);var propScope=propInfo.scope||Class.PropertyScope.DEFAULT;if(scopes.indexOf(propScope)<0){list.removePropAt(i)}}}return list};var result;var s=ClassEx.getSuperClass(aClass);if(s){result=ClassEx.getPropListOfScopes(s,scopes).clone();result.appendList(findOwnList(aClass,scopes))}else{result=findOwnList(aClass,scopes)}return result},defineProp:function(aClass,propName,options){ClassEx._ensurePropertySystem(aClass);return ClassEx.getPrototype(aClass).defineProp(propName,options)},defineProps:function(aClass,propDefItems){ClassEx._ensurePropertySystem(aClass);var proto=ClassEx.getPrototype(aClass);for(var i=0,l=propDefItems.length;i<l;++i){var item=propDefItems[i];var propName=item.name;var options=item;proto.defineProp(propName,options)}},getPropInfo:function(aClass,propName,ownPropertyOnly){return ClassEx.getPrototype(aClass).getPropInfo(propName,ownPropertyOnly)},defineEvent:function(aClass,eventName){return ClassEx.getPrototype(aClass).defineEvent(eventName)},getUnusedMethodName:function(aClass,baseName,fromIndex){var start=fromIndex||0;var i=start;var p=ClassEx.getPrototype(aClass);var name=baseName+Number(i).toString();while(p[name]){++i;name=baseName+Number(i).toString()}return name},extendMethod:function(aClass,methodName,method){var proto=ClassEx.getPrototype(aClass);var originMethod=proto[methodName];var newName=ClassEx.getUnusedMethodName(aClass,"__$changed$_"+methodName+"__");proto[newName]=originMethod;var value=(function(m){return function(){return proto[m].apply(this,arguments)}})(newName).wrap(method);proto[methodName]=value;value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method)},extend:function(aClass,extension){var proto=ClassEx.getPrototype(aClass);var ancestor=ClassEx.getSuperClassPrototype(aClass);var properties=Object.keys(extension);if(!Object.keys({toString:true}).length){properties.push("toString","valueOf")}for(var i=0,length=properties.length;i<length;i++){var property=properties[i],value=extension[property];if(typeof(value)=="function"){var args=FunctionUtils.argumentNames(value);var first=args[0];if(first=="$origin"){var method=value;var originMethod=proto[property];var newName=ClassEx.getUnusedMethodName(aClass,"__$changed$_"+property+"__");proto[newName]=originMethod;value=(function(m){return function(){return proto[m].apply(this,arguments)}})(newName).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method);args.shift();first=args.first()}if(first=="$super"){var method=value;value=(function(m){return function(){return ancestor[m].apply(this,arguments)}})(property).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method)}}proto[property]=value}ClassEx._remapPropGetters(aClass,properties);return aClass}};var ObjectEx=Class.create({CLASS_NAME:"ObjectEx",EVENT_HANDLERS_FIELD:"__$__k__eventhandlers__$__",initialize:function(){this._initPropertySystem();this.initPropValues();this._updateStatus=0;this._childChangeEventSuppressed=false;this._modifiedProps=[];this._finalized=false;this.afterInitialization()},afterInitialization:function(){},finalize:function(){if(!this._finalized){this.doFinalize();this.invokeEvent("finalize",{obj:this});this[this.EVENT_HANDLERS_FIELD]=null;this._finalized=true}},doFinalize:function(){},initProperties:function(){this.defineProp("enablePropValueGetEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("enablePropValueSetEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("enableObjectChangeEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("bubbleEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("suppressChildChangeEventInUpdating",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("eventHandlers",{dataType:DataType.HASH,serializable:false,scope:Class.PropertyScope.PRIVATE,setter:null,getter:function(){var r=this[this.EVENT_HANDLERS_FIELD];if(!r){r={};this[this.EVENT_HANDLERS_FIELD]=r}return r}})},initPropValues:function(){},getHigherLevelObj:function(){return null},saved:function(){},loaded:function(){},_initPropertySystem:function(){if(!this.getPrototype().hasOwnProperty("properties")){var parent=this.getSuperClassPrototype();if(parent){parent._initPropertySystem.apply(parent)}this._createPropertyList();this._remapPropGetters();if(this.getPrototype().hasOwnProperty("initProperties")){this.getPrototype().initProperties.apply(this.getPrototype())}}},_createPropertyList:function(){if(!this.getPrototype().hasOwnProperty("properties")){this.getPrototype().properties=new Class.PropList()}},_remapPropGetters:function(){ClassEx._remapPropGetters(this.getClass())},getClass:function(){return this.constructor},getSuperClass:function(){return this.getClass().superclass},getClassName:function(){return this.getPrototype().CLASS_NAME},getClassLocalName:function(){return ClassEx.getClassLocalName(this.getClass())},getSerializationName:function(){return this.getClassName()},getPrototype:function(){if(this.prototype){return this.prototype}else{return this.constructor.prototype}},getSuperClassPrototype:function(){if(this.constructor&&this.constructor.superclass){return this.constructor.superclass.prototype}else{return null}},getOwnPropList:function(){this._initPropertySystem();return this.getPrototype().properties},getAllPropList:function(){var result;var s=this.getSuperClassPrototype();if(s){result=s.getAllPropList().clone();result.appendList(this.getOwnPropList())}else{result=this.getOwnPropList().clone()}return result},getPropListOfScopes:function(scopes){return ClassEx.getPropListOfScopes(this.getClass(),scopes)},getPropInfoHashKey:function(propName){return ObjectEx._PROPINFO_HASHKEY_PREFIX+propName},getDefPropStoreFieldName:function(propName){return ObjectEx._PROP_STOREFIELD_PREFIX+propName},defineProp:function(propName,options){var ops;if(!options){ops={}}else{ops=Object.extend({},options)}if(ops.serializable===undefined){ops.serializable=true}ops.storeField=this.getDefPropStoreFieldName(propName);var list=this.getOwnPropList();var prop=list.addProperty(propName,ops);var propGetterInfo,propSetterInfo;if(ops.getter!==null&&ops.getter!==false){propGetterInfo=this.createPropGetter(prop,ops.getter);prop.getter=propGetterInfo.doGetterName}if(ops.setter!==null&&ops.setter!==false){propSetterInfo=this.createPropSetter(prop,ops.setter);prop.setter=propSetterInfo.doSetterName}this[this.getPropInfoHashKey(propName)]=prop;if(__definePropertyAvailable__){var descs={enumerable:ops.enumerable,configurable:false};if(descs.enumerable===undefined){descs.enumerable=true}if(propGetterInfo){descs.get=this[propGetterInfo.getterName]}if(propSetterInfo){descs.set=this[propSetterInfo.setterName]}prop.descriptor=descs;try{Object.defineProperty(this,propName,descs)}catch(e){throw e}}return prop},createPropGetter:function(prop,getter){var propNameBase=prop.name.toString().upperFirst();var getterName="get"+propNameBase;var doGetterName="doGet"+propNameBase;var actualGetter=this[doGetterName];if(!actualGetter){actualGetter=getter||new Function('return this["'+prop.storeField+'"];');this.getPrototype()[doGetterName]=actualGetter}this.getPrototype()[getterName]=actualGetter;return{getterName:getterName,doGetterName:doGetterName}},createPropSetter:function(prop,setter){var propName=prop.name.toString();var propNameBase=propName.upperFirst();var setterName="set"+propNameBase;var doSetterName="doSet"+propNameBase;var actualSetter=this[doSetterName];if(!this[doSetterName]){actualSetter=setter||new Function("value",'this["'+prop.storeField+'"] = value;');this.getPrototype()[doSetterName]=actualSetter}this.getPrototype()[setterName]=function(){var value=arguments[0];this[doSetterName].apply(this,arguments);this.notifyPropSet(propName,value);return this};return{setterName:setterName,doSetterName:doSetterName}},hasProperty:function(propName){return(this.getPropInfo(propName)!=null)},hasDirectProperty:function(propName){return(this.getPropInfo(propName,true)!=null)},getPropInfo:function(propName,ownPropertyOnly){var pname=propName||"";var result;if(!ownPropertyOnly){var hashKey=this.getPropInfoHashKey(pname)||"";result=this[hashKey]}if(!result){result=this.getOwnPropList().getPropInfo(pname);if(!result&&!ownPropertyOnly){var parent=this.getSuperClassPrototype();if(parent&&parent.getPropInfo){result=parent.getPropInfo(pname)}else{result=null}}}return result},getPropertyDataType:function(propName){var info=this.getPropInfo(propName);return info?info.dataType:null},isPropertySerializable:function(propName){var info=this.getPropInfo(propName);var s=info&&info.serializable;return(s===undefined)||(!!s)},getPropStoreFieldValue:function(propName){var defFieldName=ObjectEx._PROP_STOREFIELD_PREFIX+propName;return this[defFieldName]},getPropValue:function(propName){var result;var info=this.getPropInfo(propName);if(info){if(info.getter){var args=Array.prototype.slice.call(arguments);args.shift();result=this[info.getter].apply(this,args)}else{result=this[info.storeField]}return result}else{return null}},getPropValues:function(propNames){var result={};var names;if(DataType.isArrayValue(propNames)){for(var i=0,l=propNames.length;i<l;++i){var pname=propNames[i];result[pname]=this.getPropValue(pname)}}else{if(DataType.isObjectValue(propNames)){for(var pname in propNames){if(propNames.hasOwnProperty(pname)&&typeof(obj[pname])!=="function"){result[pname]=this.getPropValue(pname)}}}}return result},setPropStoreFieldValue:function(propName,value){var defFieldName=ObjectEx._PROP_STOREFIELD_PREFIX+propName;this[defFieldName]=value},setPropValue:function(propName,value,ignoreReadOnly){var info=this.getPropInfo(propName);if(info){if(info.setter){this[info.setter].apply(this,[value])}else{if(ignoreReadOnly){this[info.storeField]=value}}this.notifyPropSet(propName,value)}return this},setPropValueX:function(){var args=Array.prototype.slice.call(arguments);var propName=args.shift();var info=this.getPropInfo(propName);if(info){if(info.setter){this[info.setter].apply(this,args)}this.notifyPropSet(propName,this.getPropValue(propName))}return this},setPropValues:function(hash,ignoreReadOnly){for(var propName in hash){if(hash.hasOwnProperty(propName)){if(this.hasProperty(propName)){var propValue=hash[propName];this.setPropValue(propName,propValue,ignoreReadOnly)}}}return this},_isPropGetOrSetEvent:function(propName){return(propName=="propValueGet")||(propName=="propValueSet")},notifyPropSet:function(propName,newValue,doNotEvokeObjChange){if(this.isUpdating()){if(this._modifiedProps.indexOf(propName)<0){this._modifiedProps.push(propName)}return}if(this._isPropGetOrSetEvent(propName)||this.isEventPropName(propName)){return}this.doPropChanged(propName,newValue);if(this.getPropStoreFieldValue("enablePropValueSetEvent")){this.invokeEvent("propValueSet",{propName:propName,propValue:newValue})}if(!doNotEvokeObjChange){this.objectChange([propName])}},objectChange:function(modifiedPropNames){this.doObjectChange(modifiedPropNames);if(this.getEnableObjectChangeEvent()){this.invokeEvent("change",{changedPropNames:modifiedPropNames})}},doObjectChange:function(modifiedPropNames){},doPropChanged:function(propName,newValue){},defineEvent:function(eventName){return;var propName=this.eventNameToPropName(eventName);var result=this.defineProp(propName,{serializable:false,setter:null});return result},eventNameToPropName:function(eventName){return"__event_"+eventName},isEventPropName:function(propName){return((typeof(propName)=="string")&&(propName.indexOf("__event_")>=0))},isEventHandlerList:function(value){return(value&&(typeof(value)=="object")&&(value instanceof Class.EventHandlerList))},getEventHandlerList:function(eventName){var hs=this.getEventHandlers();var result=hs[eventName];if(!result){result=new Class.EventHandlerList();hs[eventName]=result}return result},addEventListener:function(eventName,listener,thisArg){var handlerList=this.getEventHandlerList(eventName);if(this.isEventHandlerList(handlerList)){if(eventName==="change"){this.setEnableObjectChangeEvent(true)}return handlerList.add(listener,thisArg)}else{return null}},addOnceEventListener:function(eventName,listener,thisArg){var self=this;var wrapper=function(event){self.removeEventListener(eventName,wrapper,thisArg);listener(event)};return this.addEventListener(eventName,wrapper,thisArg)},removeEventListener:function(eventName,listener,thisArg){var handlerList=this.getEventHandlerList(eventName);if(this.isEventHandlerList(handlerList)){return handlerList.remove(listener,thisArg)}},on:function(eventName,listener,thisArg){return this.addEventListener(eventName,listener,thisArg)},once:function(eventName,listener,thisArg){return this.addOnceEventListener(eventName,listener,thisArg)},off:function(eventName,listener,thisArg){return this.removeEventListener(eventName,listener,thisArg)},invokeEvent:function(eventName,event){if(!event){event={name:eventName,target:this}}else{event.name=eventName;event.target=this}if(!event.stopPropagation){event.stopPropagation=this._eventCancelBubble}this.dispatchEvent(eventName,event)},_eventCancelBubble:function(){this.cancelBubble=true},relayEvent:function(eventName,event){event.currentTarget=this;if(eventName==="change"&&this.getSuppressChildChangeEventInUpdating()&&this.isUpdating()){this._childChangeEventSuppressed=true}else{this.dispatchEvent(eventName,event)}},dispatchEvent:function(eventName,event){var handlerList=this.getEventHandlerList(eventName);for(var i=0,l=handlerList.getLength();i<l;++i){var handlerInfo=handlerList.getHandlerInfo(i);handlerInfo.handler.apply(handlerInfo.thisArg,[event])}if(!event.cancelBubble&&this.getBubbleEvent()){var higherObj=this.getHigherLevelObj();if(higherObj&&higherObj.relayEvent){higherObj.relayEvent(eventName,event)}}},stopEventPropagation:function(event){event.cancelBubble=true},overwriteMethod:function(methodName,newMethod){var self=this;var oldMethod=this[methodName];this[methodName]=function _delegator_(){var args=Array.prototype.slice.call(arguments);args.unshift(oldMethod.bind(self));return newMethod.apply(self,args)};return this},assign:function(srcObj){return srcObj.assignTo(this)},assignTo:function(targetObj){var jsonObj={};this.saveObj(jsonObj,"json");targetObj.loadObj(jsonObj,"json")},clone:function(){var classObj=this.getClass();var result=new classObj();this.assignTo(result);return result},beginUpdate:function(){++this._updateStatus},endUpdate:function(){--this._updateStatus;this.checkUpdateStatus();if(!this.isUpdating()){var modifiedProps=this._modifiedProps||[];this._modifiedProps=[];if(this._childChangeEventSuppressed){modifiedProps.push("[children]");this._childChangeEventSuppressed=false}this.doEndUpdate(modifiedProps)}},doEndUpdate:function(modifiedPropNames){if(modifiedPropNames.length){if(this.getPropStoreFieldValue("enablePropValueSetEvent")){for(var i=0,l=modifiedPropNames.length;i<l;++i){var propName=modifiedPropNames[i];var propValue=this.getPropValue(propName);this.notifyPropSet(propName,propValue,true)}}this.objectChange(modifiedPropNames)}},isUpdating:function(){return this._updateStatus>0},isPropUpdated:function(propName){return(this._modifiedProps.indexOf(propName)>=0)},checkUpdateStatus:function(){if(this._updateStatus<=0){this._updateStatus=0}},copyPropsTo:function(dest){var props=this.getAllPropList();for(var i=0,l=props.getLength();i<l;++i){var propName=props.getPropInfoAt(i).name;if(dest.hasProperty(propName)){var propValue=this.getPropValue(propName);dest.setPropValue(propName,propValue,true)}}}});ObjectEx._PROPINFO_HASHKEY_PREFIX="__$propInfo__";ObjectEx._PROP_STOREFIELD_PREFIX="__$__k__p__";$jsRoot.Class=Class;$jsRoot.ClassEx=ClassEx;$jsRoot.ObjectEx=ObjectEx;$jsRoot.DataType=DataType;DataType.StringUtils=StringUtils})(this);var JsonUtility={DEF_LOAD_TIMEOUT:20000,FILE_EXT_JSON:".json",FILE_EXT_JSON_JS_WRAPPER:".jsonjs",DEF_SERIALIZE_TO_JSCODE_VARNAME:"__jsonvar__",parse:function(a){return JSON.parse(a)},parseFromJsWrappedCode:function(code,jsVarName){if(!jsVarName){jsVarName=JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}eval(code);return JsonUtility.parse(eval(jsVarName))},load:function(b,d,a){var c=WebShow.URL.getFileExt(b);if(c.toLowerCase()==JsonUtility.FILE_EXT_JSON_JS_WRAPPER){return JsonUtility.loadJsWrapper(b,d,a)}else{return JsonUtility.loadJson(b,d,a)}},loadJsWrapper:function(url,callback,options){var loptions=options||{};var wrapperVarName=loptions.wrapperVarName||JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME;if(!loptions.timeout){loptions.timeout=JsonUtility.DEF_LOAD_TIMEOUT}var runCallBack=function(jsonObj,isSuccess){if(callback){callback(jsonObj,isSuccess)}};var wrapperCallback=function(src,isSuccess){var jsonObj=null;if(isSuccess){var wrapperVar=eval(wrapperVarName);if(wrapperVar){if(typeof(wrapperVar)=="string"){jsonObj=JsonUtility.parse(wrapperVar)}else{jsonObj=wrapperVar}}runCallBack(jsonObj,true)}else{runCallBack(null,false)}};WebShow.ScriptLoader.load(url,wrapperCallback,loptions)},loadJson:function(c,e,b){loptions=b||{};if(!loptions.timeout){loptions.timeout=JsonUtility.DEF_LOAD_TIMEOUT}loptions.resultType=WebShow.FileLoader.ResultType.TEXT;loptions.extractBody=false;var d=function(h,f,g){if(f){var i=JsonUtility.parse(h);e(i,true)}else{e(null,false)}};var a=new WebShow.XHRLoader();a.load(c,d,loptions)},serializeToStr:function(b,a){if(a&&a.prettyPrint){return JSON.stringify(b,null,a.indentSpaces||2)}else{return JSON.stringify(b)}},serializeToJsCode:function(d,b,e){if(!e){e="'"}if(!b){b=JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}var a=JsonUtility.serializeToStr(d);var c=new RegExp(e,"g");a=a.replace(c,"\\"+e);return"var "+b+" = "+e+a+e}};var XmlUtility={DEF_INCLUDE_TAG_NAME:"include",DEF_INCLUDE_SRC_ATTRIB:"src",DEF_LOAD_TIMEOUT:20000,DEF_BYPASS_ROOT_ELEM:true,DEF_SERIALIZE_TO_JSCODE_VARNAME:"__xmlStr__",FILE_EXT_XML:".xml",FILE_EXT_XML_JS_WRAPPER:".xmljs",newDocument:function(b,a){if(!b){b=""}if(!a){a=""}if(document.implementation&&document.implementation.createDocument){var f=document.implementation.createDocument(a,b,null);return f}else{var f=new ActiveXObject("MSXML2.DOMDocument");if(b){var d="";var c=b;var e=b.indexOf(":");if(e!=-1){d=b.substring(0,e);c=b.substring(e+1)}var g="<"+(d?(d+":"):"")+c+(a?((d?" xmlns:":" xmlns")+d+'="'+a+'"'):"")+"/>";f.loadXML(g)}return f}},parse:function(d){if(typeof DOMParser!="undefined"){return(new DOMParser()).parseFromString(d,"application/xml")}else{if(typeof ActiveXObject!="undefined"){var c=XmlUtility.newDocument();c.loadXML(d);return c}else{var a="data:text/xml;charset=utf-8,"+encodeURIComponent(d);var b=new XMLHttpRequest();b.open("GET",a,false);b.send(null);return b.responseXML}}},load:function(b,d,a){var c=WebShow.URL.getFileExt(b);if(c.toLowerCase()==XmlUtility.FILE_EXT_XML_JS_WRAPPER){return XmlUtility.loadHelper.loadJsWrapper(b,d,a)}if(!a){a={disableInclude:false}}if(!a.disableInclude){return XmlUtility.loadHelper.loadAndHandleIncludeElement(b,d,a)}else{return XmlUtility.loadHelper.loadSimple(b,d,a.timeout)}},loadHelper:{loadSimple:function(a,h,f){var b=(h!=null);if((f===null)||(f===undefined)){f=XmlUtility.DEF_LOAD_TIMEOUT}if(!(document.implementation&&document.implementation.createDocument)){return XmlUtility.loadHelper.loadSimpleViaDoc(a,h)}else{var d=new XMLHttpRequest();var i=null;if(f){i=setTimeout(function(){j(null,false)},f)}var j=function(k,e){if(i){clearTimeout(i)}if(h){h(k,e)}};if(b){d.onreadystatechange=function(){if(d.readyState==4){var e=d.responseXML;if(e&&e.documentElement){j(e,true)}else{j(null,false)}}}}try{d.open("get",a,b);d.send(null)}catch(c){WebShow.reportError(c);j(null,false)}var g=d.responseXML;if(g&&g.documentElement){return g}else{return null}}},loadSimpleViaDoc:function(c,e){var b="dummy_dummy_dummy_dummy";var d=(e!=null);var a=XmlUtility.newDocument(b);a.async=d;if(d){a.onreadystatechange=function(){if(a.readyState==4){if((!a.documentElement)||(a.documentElement.tag==b)){e(a,false)}else{e(a,true)}}}}a.load(c);return a},loadAndHandleIncludeElement:function(c,f,b){var e;if(b){e=b.timeout}else{e=null}var d=(f==null);if(d){var a=XmlUtility.loadHelper.loadSimple(c,null,e);if(a&&a.documentElement){XmlUtility.loadHelper.handleIncludedXmlInElement(a.documentElement,null,b);return a}else{return null}}else{return XmlUtility.loadHelper.loadSimple(c,function(h,g){if(!g){f(h,false)}else{XmlUtility.loadHelper.handleIncludedXmlInElement(h.documentElement,function(i){f(h,true)},b)}},e)}},loadJsWrapper:function(url,callback,options){options=options||{};var wrapperVarName=options.wrapperVarName||XmlUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME;var loadTimeout=options.timeout;if((loadTimeout===null)||(loadTimeout===undefined)){loadTimeout=XmlUtility.DEF_LOAD_TIMEOUT}var runCallBack=function(xmldoc,isSuccess){if(callback){callback(xmldoc,isSuccess)}};var wrapperCallback=function(src,isSuccess){if(isSuccess){var xmlContent=eval(wrapperVarName);var doc=XmlUtility.parse(xmlContent);runCallBack(doc,true)}else{runCallBack(null,false)}};options.timeout=loadTimeout;WebShow.ScriptLoader.load(url,wrapperCallback,options)},getIncludeElements:function(b,c){var a=[];if(!c){c=XmlUtility.DEF_INCLUDE_TAG_NAME}return b.getElementsByTagName(c)},handleIncludedXmlInElement:function(b,n,p){if(!p){p={}}var j=p.includeTagName||XmlUtility.DEF_INCLUDE_TAG_NAME;var o=p.srcAttribName||XmlUtility.DEF_INCLUDE_SRC_ATTRIB;var a=(p.bypassRootElem!=null)?p.bypassRootElem:XmlUtility.DEF_BYPASS_ROOT_ELEM;var k=(n==null);var m=XmlUtility.getXmlDocUrl(b.ownerDocument);var h=XmlUtility.loadHelper.getIncludeElements(b,j);if(!o){var d=null}var e=null;var l=0;var c=h.length;if(c<=0){if(n){n(0)}return null}var f;for(var g=h.length-1;g>=0;--g){e=h[g];d=e.getAttribute(o);if(d){d=WebShow.URL.mergePath(d,m);if(k){f=XmlUtility.loadHelper.loadSimple(d);if(f){XmlUtility.loadHelper.insertIncludedSection(f,e,a)}}else{XmlUtility.loadHelper.loadSimple(d,(function(r,q,i){if(i&&q){f=q;XmlUtility.loadHelper.insertIncludedSection(f,r,a)}l++;if(l==c){n(l)}}).bind(this,e))}}}return b},insertIncludedSection:function(j,h,a){var c=[];if(a){var d=j.documentElement.firstChild;while(d){if(d.nodeType==Node.ELEMENT_NODE){c.push(d)}d=d.nextSibling}}else{c.push(j.documentElement)}var f;var b=h.ownerDocument;var e=b.documentElement;for(var k=0,g=c.length;k<g;++k){var f=c[k];if(b.importNode){f=b.importNode(f,true)}h.parentNode.insertBefore(f,h)}h.parentNode.removeChild(h);return b}},serializeNode:function(b,a){if(a&&a.prettyPrint){return XmlUtility.serializeNodePretty(b)}if(typeof XMLSerializer!="undefined"){return(new XMLSerializer()).serializeToString(b)}else{if(b.xml){return b.xml}else{throw"XML.serialize is not supported or can't serialize "+b}}},serializeNodePretty:function(a){try{return XML((new XMLSerializer()).serializeToString(a)).toXMLString()}catch(b){return XmlUtility.serializeNode(a)}},serializeNodeToJsCode:function(d,a,c){if(!c){c="'"}if(!a){a=XmlUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}var e=XmlUtility.serializeNode(d);var b=new RegExp(c,"g");e=e.replace(b,"\\"+c);return"var "+a+" = "+c+e+c+";"},parseFromJsWrappedCode:function(code,jsVarName){eval(code);var xmlText=eval(jsVarName);return XmlUtility.parse(xmlText)},getXmlDocUrl:function(a){return a.url||a.documentURI||a.URL||a.location}};var ObjSerializer=Class.create({CLASS_NAME:"ObjSerializer",serializeValue:function(a){return a},deserializeValue:function(b,a){return b},propNameToStorageName:function(a){return a},storageNameToPropName:function(a){return a},getObjCustomSaveMethod:function(a){return(a.doSaveObj)},getObjCustomLoadMethod:function(a){return(a.doLoadObj)},getObjCustomPropSaveMethod:function(a){return(a.doSaveProp)},getObjCustomPropLoadMethod:function(a){return(a.doLoadProp)},isUndefined:function(a){return DataType.isUndefinedValue(a)},isNull:function(a){return(a===null)},isNaN:function(a){return a!=a},isFunction:function(a){return DataType.isFunctionValue(a)},isArray:function(a){return DataType.isArrayValue(a)},isDate:function(a){return DataType.isDateValue(a)},isObject:function(a){return DataType.isObjectValue(a)},isObjectEx:function(a){return DataType.isObjectExValue(a)},isSimpleType:function(b){var a=typeof(b);return(a=="string")||(a=="number")||(a=="boolean")||(a=="undefined")||(this.isNull(b))},isComplexType:function(a){return(!this.isSimpleType(a))},createChildStorageNode:function(c,b,a){},appendArrayItemStorageNode:function(b,c,a){},getNameForArrayItemStorageNode:function(a){var b=this.getDefaultArrayItemStorageName();return b},getChildStorageNode:function(a,b){},getAllArrayItemStorageNodes:function(a){},getAllStoredStorageNames:function(a){},setStorageNodeExplicitType:function(a,b){},getStorageNodeExplicitType:function(a){},getStorageNodeName:function(a){},isComplexStorageNode:function(a){},isComplexArrayItemStorageNode:function(a){},isSimpleStorageNode:function(a){},getValueExplicitType:function(a){if(a instanceof ObjectEx){return a.getClassName()}else{if(this.isObject(a)){return DataType.OBJECT}else{if(this.isArray(a)){return DataType.ARRAY}else{if(this.isDate(a)){return DataType.DATE}else{return(typeof a)}}}}},getDefaultArrayItemStorageName:function(){return"item"},getDefaultDateStorageName:function(){return"date"},save:function save(d,c,b){if(typeof(d)=="object"){var e=this.getObjCustomSaveMethod(d);if(e){return e(d,c,this)}}var a=this.doSave(d,c,b||{});if(a&&this.isFunction(d.saved)){d.saved()}return a},doSave:function(c,b,a){if(typeof(c)=="object"){if(c instanceof ObjectEx){this.doSaveObjectEx(c,b,a)}else{if(this.isArray(c)){this.doSaveArray(c,b)}else{if(this.isDate(c)){this.doSaveDate(c,b)}else{this.doSaveSimpleObject(c,b)}}}}this.setStorageNodeExplicitType(b,this.getValueExplicitType(c));return c},doSaveSimpleObject:function(d,b){for(var e in d){if(!d.hasOwnProperty(e)){continue}var a=d[e];var c;if(this.isComplexType(a)){c=this.getValueExplicitType(a)}this.doSaveFieldValue(d,e,a,b,c)}},doSaveArray:function(b,e){for(var c=0,a=b.length;c<a;++c){var d=b[c];var g=this.getNameForArrayItemStorageNode(d);if(this.isComplexType(d)){var f=this.appendArrayItemStorageNode(e,this.propNameToStorageName(g),this.isArray(d));this.setStorageNodeExplicitType(f,this.getValueExplicitType(d));this.save(d,f)}else{this.doAppendArrayItemSimpleValue(this.serializeValue(d),typeof(d),e)}}},doSaveDate:function(c,b){var a=c.toUTCString();this.doSaveSimpleValue(c,this.propNameToStorageName(this.getDefaultDateStorageName()),this.serializeValue(a),DataType.DATE,b)},doSaveObjectEx:function(f,b,m){var j=f.getAllPropList();var h=m.propFilter;for(var g=0,c=j.getLength();g<c;++g){var a=j.getPropInfoAt(g);var d=h?h(a,f):true;if(!d){continue}var e=this.getObjCustomPropSaveMethod(f);var k=false;if(e){k=e(f,a,b,this)}if(!!k){continue}if(a.serializable){this.doSaveObjectExProp(f,a,b,m)}}},doSaveObjectExProp:function(e,h,c,a){var b=h.name;var g=h.dataType;var f=e.getPropValue(b);if(a.saveDefaultValues||(f!==h.defaultValue)){var d;if(f instanceof ObjectEx){if(f.getClassName()!=g){d=f.getClassName()}}else{if(this.isComplexType(f)){d=this.getValueExplicitType(f);if(d==g){d=undefined}}}this.doSaveFieldValue(e,b,f,c,d)}},doSaveFieldValue:function(d,e,b,a,c){if(typeof(b)!="function"){if(this.isComplexType(b)){subNode=this.createChildStorageNode(a,this.propNameToStorageName(e),this.isArray(b));if(c){this.setStorageNodeExplicitType(subNode,c)}this.save(b,subNode)}else{this.doSaveSimpleValue(d,this.propNameToStorageName(e),this.serializeValue(b),this.getValueExplicitType(b),a)}}},doSaveSimpleValue:function(d,a,c,e,b){},doAppendArrayItemSimpleValue:function(b,c,a){},load:function(c,b){if(!c){var e=this.getStorageNodeExplicitType(b);if(e){c=DataType.createInstance(e)}else{if(this.doLoadUntypedNode){return this.doLoadUntypedNode(b)}else{return null}}}if(typeof(c)==="object"){var d=this.getObjCustomLoadMethod(c);if(d){return d(c,b,this)}}var a=this.doLoad(c,b);if(a&&this.isFunction(c.loaded)){c.loaded()}return a},doLoad:function(c,a){var b=this.getStorageNodeExplicitType(a);if(typeof(c)=="object"){if(c instanceof ObjectEx){c=this.doLoadObjectEx(c,a)}else{if(this.isArray(c)){c=this.doLoadArray(c,a)}else{if(this.isDate(c)){c=this.doLoadDate(c,a)}else{c=this.doLoadSimpleObject(c,a)}}}}return c},doLoadArray:function(j,a){var g=this.getAllArrayItemStorageNodes(a);for(var f=0,c=g.length;f<c;++f){var b=g[f];if(this.isComplexArrayItemStorageNode(b)){var e;var d=this.getStorageNodeExplicitType(b)||this.getStorageNodeName(b);if(d){e=DataType.createInstance(d);this.load(e,b)}else{e={};this.load(e,b)}j.push(e)}else{var h=this.deserializeValue(this.doGetArrayItemSimpleStorageValue(b));j.push(h)}}return j},doLoadDate:function(e,d){var a=this.propNameToStorageName(this.getDefaultDateStorageName());var b=this.doLoadSimpleValue(e,a,DataType.DATE,d);if(b){var c=new Date(b);e.copyFrom(c);return e}else{return undefined}},doLoadSimpleObject:function(d,a){var b=this.getAllStoredStorageNames(a);for(var e=0,c=b.length;e<c;++e){var k=b[e];var j=this.storageNameToPropName(k);var f=this.getChildStorageNode(a,k);if(f){var m;var h=this.getStorageNodeExplicitType(f);if(h){m=DataType.createInstance(h)}else{m={}}this.load(m,f);d[j]=m}else{var g=this.doLoadSimpleValue(d,k,null,a);d[j]=g}}return d},doLoadObjectEx:function(f,e){var d=f.getAllPropList();for(var c=0,a=d.getLength();c<a;++c){var h=d.getPropInfoAt(c);if(!h.serializable){continue}var g=this.getObjCustomPropLoadMethod(f);var b=false;if(g){b=g(f,h,e,this)}if(!!b){continue}this.doLoadObjectExProp(f,h,e)}return f},doLoadObjectExProp:function(c,f,b){var a=f.name;var e=f.dataType;var d=this.doLoadFieldValue(c,a,b,e);if((d!==null)&&(d!==undefined)){c.setPropValue(a,d,true)}},doLoadFieldValue:function(f,h,c,b){var a;var e=false;if(DataType.isComplexType(b)){var g=this.getChildStorageNode(c,this.propNameToStorageName(h));if(g){var d=this.getStorageNodeExplicitType(g);if(d&&(d!=b)){a=DataType.createInstance(d)}else{a=DataType.createInstance(b)}this.load(a,g);e=true}}if(DataType.isSimpleType(b)||(!e)){a=this.doLoadSimpleValue(f,this.propNameToStorageName(h),b,c)}return a},doLoadSimpleValue:function(d,a,e,c){var b=this.doLoadSimpleStorageValue(a,c);return this.deserializeValue(b,e)},doLoadSimpleStorageValue:function(a,b){},doGetArrayItemSimpleStorageValue:function(a){}});var JsonObjSerializer=Class.create(ObjSerializer,{CLASS_NAME:"JsonObjSerializer",TYPE_TAG_NAME:"__type__",createChildStorageNode:function(d,c,b){var a=b?[]:{};d[c]=a;return a},appendArrayItemStorageNode:function(c,d,b){var a=b?[]:{};c.push(a);return a},getChildStorageNode:function(b,c){var a=b[c];if(this.isSimpleType(a)){a=null}return a},getAllArrayItemStorageNodes:function(b){var a=Array.prototype.slice.call(b);return a},getAllStoredStorageNames:function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){if(b!=this.TYPE_TAG_NAME){a.push(b)}}}return a},isComplexStorageNode:function(a){return this.isComplexType(a)},isComplexArrayItemStorageNode:function(a){return this.isComplexStorageNode(a)},isSimpleStorageNode:function(a){return this.isSimpleType(a)},setStorageNodeExplicitType:function(a,b){if(!this.isArray(a)){a[this.TYPE_TAG_NAME]=b}},getStorageNodeExplicitType:function(b){var a=b[this.TYPE_TAG_NAME]||null;if((!a)&&this.isArray(b)){return DataType.ARRAY}else{return a}},doSaveSimpleValue:function(d,a,c,e,b){b[a]=c},doAppendArrayItemSimpleValue:function(b,c,a){return a.push(b)},doLoadSimpleStorageValue:function(a,b){return b[a]},doLoadUntypedNode:function(a){return a},doGetArrayItemSimpleStorageValue:function(a){return a}});var XmlObjSerializer=Class.create(ObjSerializer,{CLASS_NAME:"XmlObjSerializer",TYPE_TAG_NAME:"dataType",getLocalName:function(a){return a.localName||a.baseName||a.nodeName},getElemTextValue:function(d){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==Node.TEXT_NODE){a+=d.childNodes[c].nodeValue}}return a},serializeValue:function(a){return DataType.StringUtils.serializeValue(a)},deserializeValue:function(b,a){return DataType.StringUtils.deserializeValue(b,a)},createChildStorageNode:function(d,c,b){var a=d.ownerDocument.createElement(c);d.appendChild(a);return a},appendArrayItemStorageNode:function(b,c,a){return this.createChildStorageNode(b,c,a)},getAllArrayItemStorageNodes:function(b){var a=[];for(var d=0,c=b.childNodes.length;d<c;++d){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE){a.push(e)}}return a},getAllStoredStorageNames:function(f){var a=[];for(var c=0,b=f.childNodes.length;c<b;++c){var d=f.childNodes[c];if(d.nodeType==Node.ELEMENT_NODE){if(this.getLocalName(d)!=this.TYPE_TAG_NAME){a.push(this.getLocalName(d))}}}for(var c=0,b=f.attributes.length;c<b;++c){var e=f.attributes[c];if(this.getLocalName(e)!=this.TYPE_TAG_NAME){a.push(this.getLocalName(e))}}return a},getChildStorageNode:function(b,f){var a=null;for(var d=0,c=b.childNodes.length;d<c;++d){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE){if(this.getLocalName(e)==f){a=e}}}return a},isComplexStorageNode:function(a){return a.nodeType==Node.ELEMENT_NODE},isComplexArrayItemStorageNode:function(a){return this.isComplexStorageNode(a)&&(a.attributes.length)&&(!this.getElemTextValue(a).trim())},isSimpleStorageNode:function(a){return a.nodeType==Node.ATTRIBUTE_NODE},setStorageNodeExplicitType:function(a,b){a.setAttribute(this.TYPE_TAG_NAME,b)},getStorageNodeExplicitType:function(a){return a.getAttribute(this.TYPE_TAG_NAME)||null},getStorageNodeName:function(b){var a=b.tagName;if(a==this.getDefaultArrayItemStorageName()){return null}else{return a}},doSaveSimpleObject:function($super,b,a){$super(b,a)},doSaveArray:function($super,a,b){$super(a,b)},doSaveSimpleValue:function(d,a,c,e,b){b.setAttribute(a,c)},doAppendArrayItemSimpleValue:function(c,e,a){var b=this.appendArrayItemStorageNode(a,this.propNameToStorageName(this.getDefaultArrayItemStorageName()),false);var d=b.ownerDocument.createTextNode(c);b.appendChild(d)},doLoadSimpleStorageValue:function(a,b){return b.getAttribute(a)},doGetArrayItemSimpleStorageValue:function(a){return this.getElemTextValue(a)}});var ObjSerializerFactory={_serializerClasses:{},_defaultName:null,registerSerializer:function(a,c,b){var d=(typeof(c)=="string")?ClassEx.findClass(c):c;ObjSerializerFactory._serializerClasses[a]=d;if(b){ObjSerializerFactory._defaultName=a}},getSerializer:function(a){var b=a||ObjSerializerFactory._defaultName;if(b){var c=ObjSerializerFactory._serializerClasses[b];return c?new c():null}else{return null}}};(function(){ObjSerializerFactory.registerSerializer("json",JsonObjSerializer,true);ObjSerializerFactory.registerSerializer("xml",XmlObjSerializer)})();ClassEx.extend(ObjectEx,{saveObj:function(c,a,b){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.save(this,c,b)},loadObj:function(b,a){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.load(this,b)}});Object.extend(ClassEx,{saveObj:function(c,d,a,b){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.save(c,d,b)},loadObj:function(c,b,a){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.load(c,b)}});Object.extend(DataType,{valueToJson:function(c,b){if(DataType.isSimpleValue(c)){return JSON.stringify(c)}else{var a=DataType.isArrayValue(c)?[]:{};ClassEx.saveObj(c,a,"json",b);return JSON.stringify(a)}},jsonToValue:function(a){var b=JSON.parse(a);if(!b||DataType.isSimpleValue(b)){return b}else{return ClassEx.loadObj(null,b,"json")}}});var Kekule={LIBNAME:"Kekule.js",LIBNAME_CORE:"Kekule",VERSION:"0.8.0.18090700",LOADED:false,_afterLoadSysProcedures:[],_afterLoadUserProcedures:[],PROP_AUTO_TITLE:true};Kekule._loaded=function(){if(Kekule.LOADED){return}Kekule.LOADED=true;var b=Kekule._afterLoadSysProcedures;while(b.length){var a=b.shift();if(a){a()}}var b=Kekule._afterLoadUserProcedures;while(b.length){var a=b.shift();if(a){a()}}var d=Kekule.$jsRoot&&Kekule.$jsRoot.document;if(d&&d.createEvent&&d.body&&d.body.dispatchEvent){var c=d.createEvent("Event");c.initEvent("kekuleload",true,true);d.body.dispatchEvent(c)}};Kekule._isLoaded=function(){return Kekule.LOADED};Kekule._registerAfterLoadSysProc=function(a){if(a){if(Kekule.LOADED){a()}else{Kekule._afterLoadSysProcedures.push(a)}}};Kekule._ready=function(a){if(a){if(Kekule.LOADED){a()}else{Kekule._afterLoadUserProcedures.push(a)}}};Kekule._registerAfterLoadProc=Kekule._ready;Kekule.$jsRoot=this;Kekule.$document=this.document||null;Kekule.scriptSrcInfo=Kekule.$jsRoot["__$kekule_load_info__"];if(Kekule.scriptSrcInfo&&Kekule.scriptSrcInfo.language){Kekule.language=Kekule.scriptSrcInfo.language}if(!Kekule.scriptSrcInfo&&Kekule.$jsRoot.document){Kekule.scriptSrcInfo=(function(){var g=/^(.*\/?)kekule\..*\.js(\?.*)?$/;var f=document.getElementsByTagName("script");var h;for(var d=f.length-1;d>=0;--d){var e=f[d];if(e.src){var b=e.src.match(g);if(b){var c=b[2];if(c){c=c.substr(1)}var a={src:e.src,path:b[1],paramStr:c,useMinFile:true};return a}}}return null})()}Kekule.getScriptPath=function(){return Kekule.scriptSrcInfo.path};Kekule.getScriptSrc=function(){return Kekule.scriptSrcInfo.src};Kekule.getStyleSheetPath=function(){var b;var a=Kekule.scriptSrcInfo;if(a.useMinFile){b=a.path}else{b=a.path+"widgets/"}return b};Kekule.getStyleSheetUrl=function(){var a=Kekule.getStyleSheetPath();return a+"themes/default/kekule.css"};if(Kekule.$jsRoot&&Kekule.$jsRoot.addEventListener&&Kekule.$jsRoot.postMessage){Kekule.$jsRoot.addEventListener("message",function(a){if(a.data==="kekule-sys-info-query"){Kekule.$jsRoot.postMessage({msg:"kekule-sys-info-result",libName:Kekule.LIBNAME,version:Kekule.VERSION},"*")}},false)}(function(x){function a(y){var z=y.split("-");return{language:z[0],local:z[1]}}var f=Kekule;var l="en-US";var p=Kekule.language||(x.navigator?navigator.language||navigator.browserLanguage:l);f.language=p;var u=a(p);var t=a(l);var m=[u.language+"_"+u.local,u.language,t.language+t.local,t.language];Kekule.Localization={};Kekule.LocalizationRes={};var i=Kekule.LocalizationRes;function o(){var y=[];for(var z in i){y.push(z)}return y}function e(A,B,z){var y=z||i[A];if(!y&&B){y={};i[A]=y}return y}function j(D,z,y){var B=e(z,false,y);if(B){var A=Object.getCascadeFieldValue(D,B);if(A!==undefined){return A}}return undefined}function k(G,E,z){var F=(E?[E]:[]).concat(m);for(var B=0,A=F.length;B<A;++B){var y=F[B];var D=j(G,y,z);if(D!==undefined){return D}}return undefined}function v(B,A,z){var y=k(B,A,z);if(y===undefined){Kekule.error("Can not find localization resource: "+B)}else{return y}}function s(B,A,z,E,y){var D=e(z,E,y);if(D){return Object.setCascadeFieldValue(B,A,D,E)}else{return false}}var n=[];var g;var c=!!(x||x.window).__kekuleMarkLocalizationModuleInfo__;var q={};function w(y){g=y;if(n.indexOf(y)<0){n.push(y)}}function h(z,A){var z=z||"GLOBAL";var y=Object.getCascadeFieldValue(z,q);if(!y&&A){y=Object.setCascadeFieldValue(z,{},q,true)}return y}function r(){return n}function d(B,A,E,y){if(!E){return}var z=j(A,B,y);var D;if(!z){D=JSON.parse(JSON.stringify(E))}else{D=Object.extendEx(z,E,{cascade:true})}s(A,D,B,true,y)}function b(){return q}Kekule.$L=v;Kekule.Localization.getLanguages=o;Kekule.Localization.getValue=v;Kekule.Localization.findValue=k;Kekule.Localization.getModuleInfos=b;Kekule.Localization.setCurrModule=w;Kekule.Localization.getModuleNames=r;Kekule.Localization.addResource=function(A,z,B){d(A,z,B);if(c){var y=h(g,true);d(A,z,B,y)}}})(this);Kekule.LOCAL_RES=true;Kekule.Localization.setCurrModule("general");Kekule.Localization.addResource("en","Texts",{UNNAMED:"unnamed"});Kekule.Localization.addResource("en","ErrorMsg",{MODULE_NOT_LOADED:"Module {0} is not loaded",NON_OWN_PROPERTY_CANNOT_BE_REPLACED:"Only directly owned property of object can be replaced",EMPTY_DOC:"Document is empty",ELEMENT_NOTSET:"Element not set",EMPTY_RESURI:"Resource URI is empty",CANNOT_LOAD_RES_OF_URI:"Can not load resource of URI: ",LIST_ITEM_CLASS_MISMATCH:"Mismatched item class, can not add to list",CANNOT_CLEAR_WEAKMAP:"Can not clear a weak map",CANNOT_GET_KEY_LIST_IN_WEAKMAP:"Can not get key array from a weak map",CANNOT_GET_VALUE_LIST_IN_WEAKMAP:"Can not get value array from a weak map",INVALID_CHEMELEMENT:"Invalid chemical element",INVALID_ISOTOPE:"Invalid isotope",UNABLE_ADD_MISTYPED_NODE:"Unable to link mistyped node to connector",UNABLE_ADD_DIFF_OWNER_OBJ:"Object with different owner can not be linked to connector",CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH:"Mismatched group item class",SORT_FUNC_UNSET:"Sort function is not set",SOURCE_FRAGMENT_NOT_SET:"Source structure fragment not set",UNABLE_ADD_NONMOLECULE_MAP:"Unable to add non-molecule to reactants or products",CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER:"Can not add object other than node or connector to structure object container",REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND:"Can not find registered canonicalization executor",ERROR_LOADING_FILE:"Error loading file: ",READER_ID_ALREADY_EXISTS:"Can not register reader: id already exists",WRITER_ID_ALREADY_EXISTS:"Can not register writer: id already exists",FAIL_TO_READ_FORMAT:"Fail to load data of format: ",NO_SUITABLE_READER_FOR_FORMAT:"Can not read data of format: ",NO_SUITABLE_READER_FOR_MIMETYPE:"Can not read data of MIME type: ",NO_SUITABLE_READER_FOR_FILEEXT:"Can not read data of file extension: ",NO_SUITABLE_WRITER_FOR_FORMAT:"Can not write data of format: ",NO_SUITABLE_WRITER_FOR_MIMETYPE:"Can not write data of MIME type: ",NO_SUITABLE_WRITER_FOR_FILEEXT:"Can not write data of file extension: ",AJAX_FILELOADER_NOT_FOUND:"AJAX file loader not found, can not load URL",FAIL_TO_LOAD_FILE_URL:"Fail to load file of URL: ",CML_ELEM_READER_NOT_FOUND:"Reader for element <{0}> not found",ATOMID_NOT_EXISTS:"Atom id not exists: ",BONDID_NOT_EXISTS:"Bond id not exists: ",CML_ELEM_WRITER_TYPE_INPROPER:"{0} is not a proper CML element writer for {1}",CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT:"Can not output content to empty element",UNABLE_TO_OUTPUT_AS_CML:"Unable to output object <{0}> to CML data",MDL_CTAB_ATOM_CANNOT_CREATE:"Can not create atom from source MDL format data",MDL_CTAB_BOND_CANNOT_CREATE:"Can not create bond from source MDL format data",CAN_NOT_WRITE_NON_MOLECULE_TO_MOL:"Object is not a molecule and can not be output to connection table",MOLECULE_HAS_NO_CTAB_TO_OUTPUT:"Molecule has no connection table and can not be output to MDL format",NOT_MDL2000_FORMAT_DATA:"Data format wrong: not MDL 2000",NOT_MDL_RXN_DATA:"Not MDL Reaction(RXN) data",MALFORMED_MDL3000_COUNTLINE:"Malformed MDL 3000 count line",MDL3000_ATOMBLOCK_NOT_FOUND:"Atom block not found, malformed MDL 3000 data?",NOT_MDL_FORMAT_DATA:"Data format wrong: not MDL 2000 or 3000",NOT_MDL2000_RXN_DATA:"Not MDL RXN 2000 data",NOT_MDL3000_RXN_DATA:"Not MDL RXN 3000 data",NOT_MDL3000_RXN_COUNTLINE:"Error in reading RXN 3000 count line",MDL_OUTPUT_DATATYPE_NOT_TEXT:"MDL data can not be output to non text format",MDL_INPUT_DATATYPE_NOT_TEXT:"Non text format is not a legal MDL source data",UNABLE_TO_OUTPUT_AS_MDL:"Unable to output object <{0}> to MDL data",KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT:"Non text or JSON format data is not a legal KCJ source",KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT:"Can not output as non text or JSON data",KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT:"Non text or DOM data is not a legal KCX source",KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT:"Can not output as non text or DOM data",JSON_SERIALIZER_NOT_EXISTS:"Serializer for JSON not exists",XML_SERIALIZER_NOT_EXISTS:"Serializer for XML not exists",INAVAILABLE_AUTOSCALE_REF_LENGTH:"Can not determine the length for calculation of auto scale",FORMULA_RENDERER_3D_NOT_AVAILABLE:"3D renderer for molecule formula is not available",CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ:"Can not find suitable renderer for object",CALC_TERMINATED_BY_USER:"Calculation terminated by user",CALC_SERVICE_UNAVAILABLE:'Calculation service "{0}" is unavailable'});Kekule.LOCAL_RES=true;Kekule.Localization.setCurrModule("widget");Kekule.Localization.addResource("en","WidgetTexts",{CAPTION_OK:"OK",CAPTION_CANCEL:"Cancel",CAPTION_YES:"Yes",CAPTION_NO:"No",CAPTION_BROWSE_COLOR:"Browse colors",HINT_BROWSE_COLOR:"Browse more colors",S_COLOR_UNSET:"(unset)",S_COLOR_DEFAULT:"(default)",S_COLOR_MIXED:"(mixed)",S_COLOR_TRANSPARENT:"(transparent)",S_OBJECT_UNSET:"(none)",S_ITEMS:"item(s)",S_OBJECT:"object",S_VALUE_UNSET:"(Unset)",CAPTION_MENU:"Menu",HINT_MENU:"Open menu",S_INSPECT_NONE:"(none)",S_INSPECT_OBJECTS:"({0} objects)",S_INSPECT_ID_OBJECT:"{0}: {1}",S_INSPECT_ANONYMOUS_OBJECT:"({0})",CAPTION_TOGGLE_TEXTWRAP:"Toggle text wrapping",CAPTION_INC_TEXT_SIZE:"Increase text size",CAPTION_DEC_TEXT_SIZE:"Decrease text size",HINT_TOGGLE_TEXTWRAP:"Toggle the state of text wrapping",HINT_INC_TEXT_SIZE:"Increase text size",HINT_DEC_TEXT_SIZE:"Decrease text size",HINT_CHOOSE_FONT_FAMILY:"Choose font family",CAPTION_FIRST_PAGE:"First",CAPTION_LAST_PAGE:"Last",CAPTION_PREV_PAGE:"Prev",CAPTION_NEXT_PAGE:"Next",HINT_FIRST_PAGE:"First page",HINT_LAST_PAGE:"Last page",HINT_PREV_PAGE:"Previous page",HINT_NEXT_PAGE:"Next page",HINT_CURR_PAGE:"Current page",MSG_RETRIEVING_DATA:"Loading data...",CAPTION_DATATABLE_EDIT:"Edit",CAPTION_DATATABLE_DELETE:"Delete",CAPTION_DATATABLE_INSERT:"Insert",HINT_DATATABLE_EDIT:"Edit",HINT_DATATABLE_DELETE:"Delete",HINT_DATATABLE_INSERT:"Insert",CAPTION_ADD_CELL:"+",HINT_ADD_CELL:"Add new cell",CAPTION_REMOVE_CELL:"Remove",HINT_REMOVE_CELL:"Remove cell",CAPTION_CONFIG:"Settings...",HINT_CONFIG:"Change settings",TITLE_IMG_FORMAT_PNG:"PNG format image",TITLE_IMG_FORMAT_JPG:"Jpeg format image",TITLE_IMG_FORMAT_GIF:"GIF format image",TITLE_IMG_FORMAT_SVG:"SVG format image"});Kekule.Localization.addResource("en","ChemWidgetTexts",{CAPTION_CLEAROBJS:"Clear",CAPTION_LOADFILE:"Load...",CAPTION_LOADDATA:"Load...",CAPTION_SAVEFILE:"Save...",CAPTION_ZOOMIN:"Zoom In",CAPTION_ZOOMOUT:"Zoom Out",CAPTION_RESETZOOM:"Reset Zoom",CAPTION_RESETVIEW:"Reset",CAPTION_ROTATE:"Rotate",CAPTION_ROTATELEFT:"Left Rotate",CAPTION_ROTATERIGHT:"Right Rotate",CAPTION_ROTATEX:"X Rotate",CAPTION_ROTATEY:"Y Rotate",CAPTION_ROTATEZ:"Z Rotate",CAPTION_MOL_DISPLAY_TYPE:"Molecule Display Style",CAPTION_SKELETAL:"Skeletal",CAPTION_CONDENSED:"Condensed",CAPTION_WIRE:"Wire Frame",CAPTION_STICKS:"Sticks",CAPTION_BALLSTICK:"Ball Stick",CAPTION_SPACEFILL:"Space Fill",CAPTION_HIDEHYDROGENS:"Show/hide hydrogens",CAPTION_OPENEDITOR:"Edit...",CAPTION_EDITOR_DONE:"Done",CAPTION_EDITOR_CANCEL:"Cancel",CAPTION_EDIT_OBJ:"Edit",HINT_CLEAROBJS:"Clear objects",HINT_LOADFILE:"Load from file",HINT_LOADDATA:"Load data",HINT_SAVEFILE:"Save to file",HINT_ZOOMIN:"Zoom in",HINT_ZOOMOUT:"Zoom out",HINT_RESETZOOM:"Reset zoom",HINT_RESETVIEW:"Reset zoom and rotation",HINT_ROTATE:"Rotate",HINT_ROTATELEFT:"Rotate in anticlockwise direction",HINT_ROTATERIGHT:"Rotate in clockwise direction",HINT_ROTATEX:"Rotate around X axis",HINT_ROTATEY:"Rotate around Y axis",HINT_ROTATEZ:"Rotate around Z axis",HINT_MOL_DISPLAY_TYPE:"Change molecule display style",HINT_SKELETAL:"Show molecule in skeletal style",HINT_CONDENSED:"Show molecule in condensed style",HINT_WIRE:"Show molecule in wire frame style",HINT_STICKS:"Show molecule in sticks style",HINT_BALLSTICK:"Show molecule in ball-stick style",HINT_SPACEFILL:"Show molecule in space-fill style",HINT_HIDEHYDROGENS:"Show/hide hydrogen atoms in model",HINT_OPENEDITOR:"Open an editor to modify displayed object",HINT_EDITOR_DONE:"Save the modification",HINT_EDITOR_CANCEL:"Discard the modification",CAPTION_NEWDOC:"New",CAPTION_UNDO:"Undo",CAPTION_REDO:"Redo",CAPTION_COPY:"Copy",CAPTION_CUT:"Cut",CAPTION_PASTE:"Paste",CAPTION_TOGGLE_SELECT:"Toggle select",CAPTION_CLONE_SELECTION:"Clone selection",CAPTION_TOGGLE_INSPECTOR:"Object inspector",CAPTION_MANIPULATE:"Select",CAPTION_MANIPULATE_MARQUEE:"Marquee select",CAPTION_MANIPULATE_LASSO:"Lasso select",CAPTION_MANIPULATE_BRUSH:"Brush select",CAPTION_MANIPULATE_ANCESTOR:"Select molecule",CAPTION_CLIENT_DRAGSCROLL:"Scroll",CAPTION_ERASE:"Erase",CAPTION_TRACK_INPUT:"Track",CAPTION_MOL_BOND:"Bond",CAPTION_MOL_BOND_SINGLE:"Single bond",CAPTION_MOL_BOND_DOUBLE:"Double bond",CAPTION_MOL_BOND_TRIPLE:"Triple bond",CAPTION_MOL_BOND_QUAD:"Quad bond",CAPTION_MOL_BOND_EXPLICIT_AROMATIC:"Aromatic bond",CAPTION_MOL_BOND_WEDGEUP:"Wedge up bond",CAPTION_MOL_BOND_WEDGEUP_INVERTED:"Wedge up bond 2",CAPTION_MOL_BOND_WEDGEDOWN:"Wedge down bond",CAPTION_MOL_BOND_WEDGEDOWN_INVERTED:"Wedge down bond 2",CAPTION_MOL_BOND_CLOSER:"Outer bond",CAPTION_MOL_BOND_WAVY:"Wavy bond",CAPTION_MOL_BOND_DOUBLE_EITHER:"Double Either bond",CAPTION_MOL_BOND_IONIC:"Ionic bond",CAPTION_MOL_BOND_COORDINATE:"Coordinate bond",CAPTION_MOL_BOND_METALLIC:"Metallic bond",CAPTION_MOL_BOND_HYDROGEN:"Hydrogen bond",CAPTION_MOL_ATOM:"Atom",CAPTION_MOL_FORMULA:"Formula",CAPTION_MOL_ATOM_AND_FORMULA:"Atom and formula",CAPTION_MOL_CHARGE:"Charge",CAPTION_MOL_CHARGE_CLEAR:"Charge clear",CAPTION_MOL_CHARGE_POSITIVE:"Positive charge",CAPTION_MOL_CHARGE_NEGATIVE:"Negative charge",CAPTION_MOL_CHARGE_SINGLET:"Singlet radical",CAPTION_MOL_CHARGE_DOUBLET:"Monoradical",CAPTION_MOL_CHARGE_TRIPLET:"Triplet radical",CAPTION_MOL_ELECTRON_LONEPAIR:"Lone pair",CAPTION_TEXT_BLOCK:"Text block",CAPTION_IMAGE_BLOCK:"Image block",CAPTION_TEXT_IMAGE:"Text and image",CAPTION_MOL_FLEXCHAIN:"Flex chain",CAPTION_MOL_FLEXRING:"Flex ring",CAPTION_REPOSITORY_RING:"Rings",CAPTION_REPOSITORY_RING_3:"Cyclopropane",CAPTION_REPOSITORY_RING_4:"Cyclobutane",CAPTION_REPOSITORY_RING_5:"Cyclopentane",CAPTION_REPOSITORY_RING_6:"Cyclohexane",CAPTION_REPOSITORY_RING_7:"Cycloheptane",CAPTION_REPOSITORY_RING_8:"Cyclooctane",CAPTION_REPOSITORY_RING_AR_6:"Benzene",CAPTION_REPOSITORY_RING_AR_5:"Cyclopentadiene",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1:"Cyclohexane chair 1",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2:"Cyclohexane chair 2",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1:"Cyclohexane Haworth 1",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2:"Cyclohexane Haworth 2",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1:"Cyclopentane Haworth 1",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2:"Cyclopentane Haworth 2",CAPTION_REPOSITORY_METHANE:"Methane",CAPTION_REPOSITORY_FISCHER1:"Fischer projection 1",CAPTION_REPOSITORY_FISCHER2:"Fischer projection 2",CAPTION_REPOSITORY_FISCHER3:"Fischer projection 3",CAPTION_REPOSITORY_SAWHORSE_STAGGERED:"Sawhorse staggered",CAPTION_REPOSITORY_SAWHORSE_ECLIPSED:"Sawhorse eclipsed",CAPTION_REPOSITORY_SUBBOND_MARK:"Substituent bond",CAPTION_REPOSITORY_ARROWLINE:"Arrows & lines",CAPTION_REPOSITORY_GLYPH:"Glyphs",CAPTION_REPOSITORY_GLYPH_LINE:"Line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",CAPTION_REPOSITORY_HEAT_SYMBOL:"Heat symbol",CAPTION_REPOSITORY_ADD_SYMBOL:"Add symbol",CAPTION_TEXT_FORMAT:"Text format",CAPTION_PICK_COLOR:"Color",CAPTION_FONTNAME:"Font name",CAPTION_FONTSIZE:"Font size",CAPTION_TEXT_DIRECTION:"Text direction",CAPTION_TEXT_DIRECTION_DEFAULT:"Default",CAPTION_TEXT_DIRECTION_LTR:"Left to right",CAPTION_TEXT_DIRECTION_RTL:"Right to left",CAPTION_TEXT_DIRECTION_TTB:"Top to bottom",CAPTION_TEXT_DIRECTION_BTT:"Bottom to top",CAPTION_TEXT_HORIZONTAL_ALIGN:"Text horizontal alignment",CAPTION_TEXT_VERTICAL_ALIGN:"Text vertical alignment",CAPTION_TEXT_ALIGN_DEFAULT:"Default",CAPTION_TEXT_ALIGN_LEADING:"Leading",CAPTION_TEXT_ALIGN_TRAILING:"Trailing",CAPTION_TEXT_ALIGN_CENTER:"Center",CAPTION_TEXT_ALIGN_LEFT:"Left",CAPTION_TEXT_ALIGN_RIGHT:"Right",CAPTION_TEXT_ALIGN_TOP:"Top",CAPTION_TEXT_ALIGN_BOTTOM:"Bottom",CAPTION_ATOM_MODIFIER:"Atom",CAPTION_ATOM_MODIFIER_MIXED:"[A]",CAPTION_BOND_MODIFIER:"Bond",CAPTION_CHARGE_MODIFIER:"Charge",TEXT_CHARGE_POSITIVE:"+",TEXT_CHARGE_NEGATIVE:"-",TEXT_CHARGE_UNKNOWN:"<sup>+</sup>/<sub>-</sub>",TEXT_CHARGE_NONE:"&#8709;",HINT_NEWDOC:"Create new document",HINT_UNDO:"Undo",HINT_REDO:"Redo",HINT_COPY:"Copy selection to internal clipboard",HINT_CUT:"Cut selection to internal clipboard",HINT_PASTE:"Paste from internal clipboard",HINT_CLONE_SELECTION:"Clone selection",HINT_TOGGLE_SELECT:"Toggle select",HINT_TOGGLE_INSPECTOR:"Show or hide object inspector panel",HINT_MANIPULATE:"Select tool",HINT_MANIPULATE_MARQUEE:"Marquee select",HINT_MANIPULATE_LASSO:"Lasso select",HINT_MANIPULATE_BRUSH:"Brush select",HINT_MANIPULATE_ANCESTOR:"Select molecule",HINT_CLIENT_DRAGSCROLL:"Scroll",HINT_ERASE:"Erase tool",HINT_TRACK_INPUT:"Track tool",HINT_MOL_BOND:"Bond tool",HINT_MOL_BOND_SINGLE:"Single bond",HINT_MOL_BOND_DOUBLE:"Double bond",HINT_MOL_BOND_TRIPLE:"Triple bond",HINT_MOL_BOND_QUAD:"Quad bond",HINT_MOL_BOND_EXPLICIT_AROMATIC:"Explicit aromatic bond",HINT_MOL_BOND_WEDGEUP:"Wedge up bond",HINT_MOL_BOND_WEDGEUP_INVERTED:"Wedge up bond 2",HINT_MOL_BOND_WEDGEDOWN:"Wedge down bond",HINT_MOL_BOND_WEDGEDOWN_INVERTED:"Wedge down bond 2",HINT_MOL_BOND_CLOSER:"Outer bond",HINT_MOL_BOND_WAVY:"Wavy bond",HINT_MOL_BOND_DOUBLE_EITHER:"Double Either bond",HINT_MOL_BOND_IONIC:"Ionic bond",HINT_MOL_BOND_COORDINATE:"Coordinate bond",HINT_MOL_BOND_METALLIC:"Metallic bond",HINT_MOL_BOND_HYDROGEN:"Hydrogen bond",HINT_MOL_ATOM:"Atom tool",HINT_MOL_FORMULA:"Formula tool",HINT_MOL_ATOM_AND_FORMULA:"Atom and formula tool",HINT_MOL_CHARGE:"Charge tool",HINT_MOL_CHARGE_CLEAR:"Clear charge and radical",HINT_MOL_CHARGE_POSITIVE:"Positive charge",HINT_MOL_CHARGE_NEGATIVE:"Negative charge",HINT_MOL_CHARGE_SINGLET:"Singlet radical",HINT_MOL_CHARGE_DOUBLET:"Monoradical",HINT_MOL_CHARGE_TRIPLET:"Triplet radical",HINT_MOL_ELECTRON_LONEPAIR:"Lone pair electrons",HINT_TEXT_BLOCK:"Text block tool",HINT_IMAGE_BLOCK:"Image block tool",HINT_TEXT_IMAGE:"Text and image tool",HINT_MOL_FLEXCHAIN:"Flex carbon chain",HINT_MOL_FLEXRING:"Flex carbon ring",HINT_REPOSITORY_RING:"Ring structures",HINT_REPOSITORY_RING_3:"Cyclopropane",HINT_REPOSITORY_RING_4:"Cyclobutane",HINT_REPOSITORY_RING_5:"Cyclopentane",HINT_REPOSITORY_RING_6:"Cyclohexane",HINT_REPOSITORY_RING_7:"Cycloheptane",HINT_REPOSITORY_RING_8:"Cyclooctane",HINT_REPOSITORY_RING_AR_6:"Benzene",HINT_REPOSITORY_RING_AR_5:"Cyclopentadiene",HINT_REPOSITORY_CYCLOHEXANE_CHAIR1:"Cyclohexane chair 1",HINT_REPOSITORY_CYCLOHEXANE_CHAIR2:"Cyclohexane chair 2",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1:"Cyclohexane Haworth 1",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2:"Cyclohexane Haworth 2",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1:"Cyclopentane Haworth 1",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2:"Cyclopentane Haworth 2",HINT_REPOSITORY_SUBBOND_MARK:"Substituent bond",HINT_REPOSITORY_METHANE:"Methane",HINT_REPOSITORY_FISCHER1:"Fischer projection with one chiral center",HINT_REPOSITORY_FISCHER2:"Fischer projection with two chiral centers",HINT_REPOSITORY_FISCHER3:"Fischer projection with three chiral centers",HINT_REPOSITORY_SAWHORSE_STAGGERED:"Sawhorse staggered",HINT_REPOSITORY_SAWHORSE_ECLIPSED:"Sawhorse eclipsed",HINT_REPOSITORY_ARROWLINE:"Arrows and lines",HINT_REPOSITORY_GLYPH:"Glyphs",HINT_REPOSITORY_GLYPH_LINE:"Line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",HINT_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",HINT_REPOSITORY_HEAT_SYMBOL:"Heat symbol",HINT_REPOSITORY_ADD_SYMBOL:"Add symbol",HINT_TEXT_FORMAT:"Set text format",HINT_FONTNAME:"Set font name",HINT_FONTSIZE:"Set font size",HINT_PICK_COLOR:"Select color",HINT_TEXT_DIRECTION:"Set text direction",HINT_TEXT_HORIZONTAL_ALIGN:"Set text horizontal alignment",HINT_TEXT_VERTICAL_ALIGN:"Set text vertical alignment",HINT_CHARGE_NONE:"No charge",HINT_ATOM_MODIFIER:"Set atom",HINT_BOND_MODIFIER:"Set bond",HINT_CHARGE_MODIFIER:"Set charge",HINT_USE_ATOM_CUSTOM_COLOR:"(use atom custom color)",CAPTION_LOADDATA_DIALOG:"Load data",CAPTION_SAVEDATA_DIALOG:"Save data",CAPTION_DATA_FORMAT:"Data format:",CAPTION_DATA_SRC:"Input or paste data below:",CAPTION_LOADDATA_FROM_FILE:"Load from file",CAPTION_CHOOSEFILEFORMAT:"Choose file format",CAPTION_SELECT_FORMAT:"Select format:",CAPTION_PREVIEW_FILE_CONTENT:"Preview: ",S_DEF_SAVE_FILENAME:"Unnamed",CAPTION_ATOMLIST_PERIODIC_TABLE:"more...",CAPTION_RGROUP:"Sub group",CAPTION_VARIABLE_ATOM:"Variable Atom (list)",CAPTION_VARIABLE_NOT_ATOM:"Variable Atom (not list)",CAPTION_PSEUDOATOM:"Pseudoatom",CAPTION_DUMMY_ATOM:"Dummy Atom",CAPTION_HETERO_ATOM:"Hetero Atom",CAPTION_ANY_ATOM:"Any Atom",CAPTION_ATOM:"Atom",CAPTION_SUBGROUP:"Subgroup",CAPTION_PERIODIC_TABLE_DIALOG:"Periodic table",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM:"Select element",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEMS:"Select elements",CAPTION_TEXTBLOCK_INIT:"Enter text here",LEGEND_CAPTION:"Legend",LEGEND_ELEM_SYMBOL:"Symbol",LEGEND_ELEM_NAME:"name",LEGEND_ATOMIC_NUM:"atomic number",LEGEND_ATOMIC_WEIGHT:"atomic weight",CAPTION_2D:"2D",CAPTION_3D:"3D",CAPTION_AUTOSIZE:"Autosize",CAPTION_AUTOFIT:"Autofit",CAPTION_SHOWSIZEINFO:"Show size info",CAPTION_LABEL_SIZE:"Size: ",CAPTION_BACKGROUND_COLOR:"Background color: ",CAPTION_WIDTH_HEIGHT:"width: {0}, height: {1}",PLACEHOLDER_WIDTH:"width",PLACEHOLDER_HEIGHT:"height",HINT_AUTOSIZE:"Whether graph size is determined by object automatically",HINT_AUTOFIT:"Whether object is zoomed to fullfill the whole graph",S_VALUE_DEFAULT:"(Default)"});Kekule.Localization.addResource("en","ErrorMsg",{WIDGET_CLASS_NOT_FOUND:"Widget class not found",WIDGET_CAN_NOT_BIND_TO_ELEM:"Widget {0} can not be binded to element <{1}>",LOAD_CHEMDATA_FAILED:"Failed to load data",FILE_API_NOT_SUPPORTED:"File operations are not supported by your current web browser. Please update it.",DRAW_BRIDGE_NOT_SUPPORTED:"It seems that your web browser is not modern enough to support the drawing function. Please update it.",COMMAND_NOT_REVERSIBLE:"Command can not be undone",PAGE_INDEX_OUTOF_RANGE:"Page index out of range",FETCH_DATA_TIMEOUT:"Time out to fetch data",RENDER_TYPE_CHANGE_NOT_ALLOWED:"It is not allowed to change render type",CAN_NOT_CREATE_EDITOR:"Creating editor failed",CAN_NOT_SET_COORD_OF_CLASS:"Can not set coordinate of instance of {0}.",CAN_NOT_SET_DIMENSION_OF_CLASS:"Can not set dimension of instance of {0}.",CAN_NOT_MERGE_CONNECTORS:"Specified connectors can not be merged.",NOT_A_VALID_ATOM:"Not a valid atom",INVALID_ATOM_SYMBOL:"Invalid atom symbol",INVALID_OR_EMPTY_IMAGE:"Image is empty or invalidate"});Kekule.LOCAL_RES=true;Kekule.Localization.setCurrModule("objDefines");Kekule.OBJDEF_TEXTS={};Kekule.Localization.addResource("en","OBJDEF_TEXTS",{TITLE_PREFIX:"TITLE_",DESCRIPTION_PREFIX:"DES_",DES_ID:"Unique ID for object.",Render:{GeneralConfigs:{TITLE_drawOpacity:"Opacity",DES_drawOpacity:"Opacity (between 0-1) to draw objects"},Render2DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_displayLabelConfigs:"Display label settings",DES_displayLabelConfigs:"Settings of displayed label in molecule/chem object",TITLE_textFontConfigs:"Text and font settings",DES_textFontConfigs:"Settings about text and font of display",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule/chem object",TITLE_colorConfigs:"Color settings",DES_colorConfigs:"Color settings to display molecule/chem object"},MoleculeDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display mode",DES_defMoleculeDisplayType:"Default display type of molecule: in skeletal or in condensed mode",TITLE_defNodeDisplayMode:"Default atom display mode",DES_defNodeDisplayMode:"Default mode to display atom in molecule",TITLE_defHydrogenDisplayLevel:"Default hydrogen display level",DES_defHydrogenDisplayLevel:"How to display explicit or implicit hydrogens of atom",TITLE_defChargeMarkType:"Default charge mark type",DES_defChargeMarkType:null,TITLE_partialChargeDecimalsLength:"Decimal length of partial charge",DES_partialChargeDecimalsLength:"If an atom has a partical charge (e.g., +1.5), how many digits after decimal point should be displayed"},DisplayLabelConfigs:{TITLE_enableIsotopeAlias:"Enable isotope alias",DES_enableIsotopeAlias:"Whether isotope alias (e.g. D for 2H) is used to display atom label.",TITLE_unsetElement:"Unset element",DES_unsetElement:"Label for unset or unknown element",TITLE_dummyAtom:"Dummy atom",DES_dummyAtom:"Label for dummy atom",TITLE_heteroAtom:"Hetero atom",DES_heteroAtom:"Label for general hetero atom",TITLE_anyAtom:"Any atom",DES_anyAtom:"Label for atom wildcard",TITLE_variableAtom:"Variable atom",DES_variableAtom:"Label for variable atom or atom list",TITLE_rgroup:"RGroup",DES_rgroup:"Label for RGroup",TITLE_isoListLeadingBracket:"Atom list leading bracket",TITLE_isoListTailingBracket:"Atom list tailing bracket",TITLE_isoListDelimiter:"Atom delimiter in list",TITLE_isoListDisallowPrefix:"Prefix of not-atom list"},TextFontConfigs:{TITLE_labelFontFamily:"Label font",DES_labelFontFamily:"Font to draw general label",TITLE_atomFontFamily:"Atom font",DES_atomFontFamily:"Font to draw atom label",TITLE_supFontSizeRatio:"Superscript font size ratio",DES_supFontSizeRatio:"Ratio of Superscript text size to normal text size",TITLE_subFontSizeRatio:"Subscript font size ratio",DES_subFontSizeRatio:"Ratio of Subscript text size to normal text size",TITLE_superscriptOverhang:"Superscript text overhang",DES_superscriptOverhang:null,TITLE_subscriptOversink:"Subscript text oversink",DES_subscriptOversink:null,TITLE_textCharDirection:"Text direction",DES_textCharDirection:"Default text direction",TITLE_textHorizontalAlign:"Horizontal text alignment",DES_textHorizontalAlign:"Default horizontal text alignment of label",TITLE_textVerticalAlign:"Vertical text alignment",DES_textVerticalAlign:"Default vertical text alignment of label"},LengthConfigs:{TITLE_labelFontSize:"Label text size",DES_labelFontSize:"Size of general label text",TITLE_atomFontSize:"Atom text size",DES_atomFontSize:"Size of atom label text",TITLE_allenCenterAtomRadius:"Allen center radius",DES_allenCenterAtomRadius:"Radius to draw dot on center carbon atom in allen",TITLE_chargeMarkFontSize:"Charge mark size",DES_chargeMarkFontSize:"Font size of charge mark",TITLE_chargeMarkMargin:"Charge mark margin",DES_chargeMarkMargin:"Margin between charge mark and atom",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default length of a chemical bond",TITLE_bondLineWidth:"Bond line width",DES_bondLineWidth:"Line width to draw a chemical bond",TITLE_hashSpacing:"Hash spacing",DES_hashSpacing:"Spacing between small lines in hash bond",TITLE_multipleBondSpacingRatio:"Multiple bond spacing ratio",DES_multipleBondSpacingRatio:"Ratio of spacing between two lines in double or triple bond to bond length.",TITLE_multipleBondMaxAbsSpacing:"Max multiple bond spacing",DES_multipleBondMaxAbsSpacing:"Maximum spacing between multiple bond",TITLE_bondArrowLength:"Bond arrow length",DES_bondArrowLength:"The length of end triangle in arrow bond",TITLE_bondArrowWidth:"Bond arrow width",DES_bondArrowWidth:"The width of end triangle in arrow bond",TITLE_bondWedgeWidth:"Bond wedge max width",DES_bondWedgeWidth:"The width of ending point in wedge bond",TITLE_bondWedgeHashMinWidth:"Bond wedge min width",DES_bondWedgeHashMinWidth:"The width of starting point in wedge bond",TITLE_bondWavyRadius:"Bond wavy radius",DES_bondWavyRadius:"Radius to draw arc of wavy bond",TITLE_glyphStrokeWidth:"Glyph stroke width",DES_glyphStrokeWidth:"The default width of glyph strokes",TITLE_autofitContextPadding:"Autofit context padding",DES_autofitContextPadding:"Padding of autofit widget edge and drawn object"},ColorConfigs:{TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element",TITLE_labelColor:"Label color",DES_labelColor:"Default color of general label",TITLE_atomColor:"Atom color",DES_atomColor:"Default color of atom label",TITLE_bondColor:"Bond color",DES_bondColor:"Default color of bond",TITLE_glyphStrokeColor:"Glyph stroke color",DES_glyphStrokeColor:"Default stroke color of glyph",TITLE_glyphFillColor:"Glyph fill color",DES_glyphFillColor:"Default fill color of glyph"},Render3DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_environmentConfigs:"3D environment settings",DES_environmentConfigs:"Settings of 3D environment",TITLE_modelConfigs:"3D model settings",DES_modelConfigs:"Settings to render a 3D molecule model",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule"},Render3DEnvironmentConfigs:{TITLE_graphicQuality:"Graphic quality",DES_graphicQuality:"Quality of 3D graphic"},Molecule3DDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display type",DES_defMoleculeDisplayType:"Draw molecule in wire, stick, ball stick or space fill mode",TITLE_defBondSpliceMode:"Bond splice mode",DES_defBondSpliceMode:"How to draw a splice mode between two atoms with different color",TITLE_defDisplayMultipleBond:"Display multiple bond",DES_defDisplayMultipleBond:"Whether draw multiple bond lines for double or triple bond",TITLE_defBondColor:"Default bond color",DES_defBondColor:"Default bond color",TITLE_defAtomColor:"Default atom color",DES_defAtomColor:"Default atom color",TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element"},Model3DConfigs:{TITLE_hideHydrogens:"Hide hydrogens",DES_hideHydrogens:"Whether hide all hydrogen atoms in 3D model",TITLE_useVdWRadius:"Use von dar Waals radius",DES_useVdWRadius:"Whether use atom's von dar Waals radius to draw 3D model",TITLE_multiConnectorRadiusRatio:"Multi-bond radius ratio",DES_multiConnectorRadiusRatio:"If use multi-cylinder for multibond, this value is the radius ratio between multi and single bond",TITLE_multiConnectorMarginRatio:"Multi-bond margin ratio",DES_multiConnectorMarginRatio:"If multi-cylinder is used for multibond, ratio of margin between cylinders and radius of cylinder"},Length3DConfigs:{TITLE_fixedNodeRadius:"Fixed atom radius",DES_fixedNodeRadius:"If vdW radius of atom is not used, this value will be used for all atom's radius",TITLE_connectorRadius:"Bond radius",DES_connectorRadius:"Bond will be draw based on this radius in stick or ball_stick mode",TITLE_connectorLineWidth:"Bond line width",DES_connectorLineWidth:"Bond will be draw on this width in wire mode"}},Widget:{BaseWidget:{TITLE_settingFacade:"General settings",DES_settingFacade:"General settings"}},ChemWidget:{ChemObjDisplayer:{TITLE_enableLoadNewFile:"Enable load data",DES_enableLoadNewFile:"Whether loading new data is enabled"},ChemObjDisplayerConfigs:{TITLE_ioConfigs:"I/O settings",DES_ioConfigs:"Settings of input/output"},ChemObjDisplayerIOConfigs:{TITLE_canonicalizeBeforeSave:"Canonicalize before save",DES_canonicalizeBeforeSave:"Whether canonicalize molecule before saving it"},Viewer:{TITLE_enableDirectInteraction:"Enable direct interaction",DES_enableDirectInteraction:"Whether interaction with chem object in viewer is enabled",TITLE_enableTouchInteraction:"Enable touch interaction",DES_enableTouchInteraction:"Whether touch interaction is enabled",TITLE_enableToolbar:"Enable toolbar",DES_enableToolbar:"Whether toolbar of viewer is displayed",TITLE_toolbarPos:"Toolbar Position",DES_toolbarPos:"Position of toolbar in viewer",TITLE_toolbarMarginHorizontal:"Toolbar horizontal margin",DES_toolbarMarginHorizontal:"Horizontal margin of toolbar to viewer edge",TITLE_toolbarMarginVertical:"Toolbar vertical margin",DES_toolbarMarginVertical:"Vertical margin of toolbar to viewer edge",TITLE_enableEdit:"Enable editing",DES_enableEdit:"Whether edit chem object in viewer is enabled",TITLE_modalEdit:"Modal editing",DES_modalEdit:"Using modal dialog or popup dialog to edit chem object"}},Editor:{BaseEditorConfigs:{TITLE_uiMarkerConfigs:"UI marker settings",DES_uiMarkerConfigs:"Settings of interaction marker",TITLE_interactionConfigs:"Interaction settings",DES_interactionConfigs:"Settings about interaction of editor",TITLE_structureConfigs:"Structure settings",DES_structureConfigs:"Settings about creating molecule structure"},ChemSpaceEditorConfigs:{TITLE_chemSpaceConfigs:"Chem space settings",DES_chemSpaceConfigs:"Settings about chem space/chem document",TITLE_styleSetterConfigs:"Style setter settings",DES_styleSetterConfigs:"Settings of style toolbar of editor"},InteractionConfigs:{TITLE_enableTrackOnNearest:"Enale track on nearest",DES_enableTrackOnNearest:"If setting to true, hot track or selection will focus on nearest object to current position, otherwise, the topmost object around will be focused.",TITLE_enableHotTrack:"Enable hot track",DES_enableHotTrack:"Whether highlighting objects under mouse position",TITLE_autoSelectNewlyInsertedObjects:"Auto select new inserted objects",DES_autoSelectNewlyInsertedObjects:"Whether select objects newly inserted or modified in editor automatically",TITLE_objBoundTrackMinInflation:"Object bound minimal inflation (default)",DES_objBoundTrackMinInflation:"The default minimal inflation of the bound of object to make it easier to select",TITLE_objBoundTrackMinInflationMouse:"Object bound minimal inflation (mouse)",DES_objBoundTrackMinInflationMouse:"The minimal inflation of the bound of object to make it easier to select when using mouse as pointer device",TITLE_objBoundTrackMinInflationTouch:"Object bound minimal inflation (touch)",DES_objBoundTrackMinInflationTouch:"The minimal inflation of the bound of object to make it easier to select when touching on screen",TITLE_objBoundTrackMinInflationPen:"Object bound minimal inflation (pen)",DES_objBoundTrackMinInflationPen:"The minimal inflation of the bound of object to make it easier to select when using pen as pointer device",TITLE_objBoundTrackInflationRatio:"Object bound inflation ratio (default)",DES_objBoundTrackInflationRatio:"The default inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select",TITLE_objBoundTrackInflationRatioMouse:"Object bound inflation ratio (mouse)",DES_objBoundTrackInflationRatioMouse:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when using mouse as pointer device",TITLE_objBoundTrackInflationRatioPen:"Object bound inflation ratio (pen)",DES_objBoundTrackInflationRatioPen:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when using pen as pointer device",TITLE_objBoundTrackInflationRatioTouch:"Object bound inflation ratio (touch)",DES_objBoundTrackInflationRatioTouch:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when touching on screen",TITLE_selectionMarkerInflation:"Selection marker inflation",DES_selectionMarkerInflation:"Inflation of object selection mark, makes it easier to see the containing objects",TITLE_selectionMarkerEdgeInflation:"Selection edge inflation",DES_selectionMarkerEdgeInflation:"Inflation when judging if a coord is on selection mark edge",TITLE_constrainedRotateStep:"Constrained rotation step",DES_constrainedRotateStep:"Constrained rotation step, in arc",TITLE_rotationLocationPointDistanceThreshold:"Rotation starting min distance",DES_rotationLocationPointDistanceThreshold:"Rotation will occur only when mouse point distance (from rotation center) larger than this value",TITLE_directedMoveDistanceThreshold:"Direct move min distance",DES_directedMoveDistanceThreshold:"Direct moving will only be done if moved distance large than this value",TITLE_enablePartialAreaSelecting:"Enable partial selecting",DES_enablePartialAreaSelecting:"If this value is true, when drag a selecting rubber band, object partly in the band will be totally selected",TITLE_selectingBrushWidth:"Brush selecting Width",DES_selectingBrushWidth:"Width of brush in brush selecting",TITLE_enableOffSelectionManipulation:"Enable off-selection manipulation",DES_enableOffSelectionManipulation:"When setting to true, you can still move, resize or rotate selected objects by holding mouse or touch outside selection for a while",TITLE_offSelectionManipulationActivatingTimeThreshold:"Off-selection manipulation hold time",DES_offSelectionManipulationActivatingTimeThreshold:"The minimal time (in ms) need for holding mouse or touch to invoke off-selection manipulation",TITLE_selectionMarkerDefPulseDuration:"Default selection mark pulse duration",DES_selectionMarkerDefPulseDuration:"The duration (in ms) of selection mark pulse when the selection is been emphasised",TITLE_selectionMarkerDefPulseCount:"Default selection mark pulse count",DES_selectionMarkerDefPulseCount:"The pulse count when the selection is been emphasised",TITLE_rotationRegionInflation:"Rotation region inflation",DES_rotationRegionInflation:"User can rotate the selected objects by pressing and move mouse in this inflated region outside selection",TITLE_enableMergePreview:"Enable merge preview",DES_enableMergePreview:"Whether a preview operation is used rather then the actual merge operation when merge two objects in editor during manipulation. Turn on this option may improve the performance of object manipulation.",TITLE_enableGestureManipulation:"Enable gesture manipulation",DES_enableGestureManipulation:"Whether user can use touch gestures (e.g. pinch) to scale or rotate selected objects in editor",TITLE_enableGestureZoomOnEditor:"Enable gesture zoom on editor",DES_enableGestureZoomOnEditor:"Whether user can use pinch gesture to zoom in or out the editor when there is no selection existed",TITLE_trackSimplifierDistanceThreshold:"Track-input curve simplification threshold",DES_trackSimplifierDistanceThreshold:"Distance threshold in simplifying curve drawn by track-input tool",TITLE_trackSimplifierIgnoreSegmentThreshold:"Track-input ignored segment threshold",DES_trackSimplifierIgnoreSegmentThreshold:"Segment length less than this threshold drawn by track-input will be ignored in parsing",TITLE_trackMergeDistanceThreshold:"Track-input merge distance threshold",DES_trackMergeDistanceThreshold:"If a joint or end point of line segment drawn by track-inpu tool is close to another line segment (less than this threshold), it will be regarded on that line.",TITLE_trackOptimizationAngleConstraint:"Track-input optimization line cross angle constraint",DES_trackOptimizationAngleConstraint:null,TITLE_trackOptimizationDistanceConstraints:"Track-input optimization line length constraint",DES_trackOptimizationDistanceConstraints:null,TITLE_trackOptimizationPrimaryDistanceConstraint:"Track-input optimization primary line length",DES_trackOptimizationPrimaryDistanceConstraint:null,TITLE_autoAdjustZoomLevelOnTrackTouching:null,DES_autoAdjustZoomLevelOnTrackTouching:null,TITLE_editorInitialZoom:"Editor initial zoom level",DES_editorInitialZoom:"The initial zoom level of editor",TITLE_atomSetterFontSize:"Atom setter font size",DES_atomSetterFontSize:"Font size of atom setter",TITLE_allowUnknownAtomSymbol:"Allow unknown atom symbol",DES_allowUnknownAtomSymbol:"Allow inputting unknown symbol and handle it as pseudo atom in atom setter",TITLE_clonedObjectScreenOffset:"Copied object coord offset",DES_clonedObjectScreenOffset:"The distance between copied objects and origin objects when doing paste selection action in editor"},UiMarkerConfigs:{TITLE_hotTrackerColor:"Hot track mark color",DES_hotTrackerColor:"Color of hot track mark",TITLE_hotTrackerOpacity:"Hot track mark opacity",DES_hotTrackerOpacity:"Opacity of hot track marker, value from 0 to 1",TITLE_selectionMarkerStrokeColor:"Selection mark stroke color",DES_selectionMarkerStrokeColor:"Stroke color of selection mark",TITLE_selectionMarkerStrokeWidth:"Selection mark stroke width",DES_selectionMarkerStrokeWidth:"Width of selection mark stroke",TITLE_selectionMarkerFillColor:"Selection mark fill color",DES_selectionMarkerFillColor:"Fill color of selection mark.",TITLE_selectionMarkerOpacity:"Selection mark opacity",DES_selectionMarkerOpacity:"Opacity of selection mark, value from 0 to 1",TITLE_selectionMarkerEmphasisOpacity:"Emphasised selection mark opacity",DES_selectionMarkerEmphasisOpacity:"Opacity of emphasised selection marker, value from 0 to 1",TITLE_selectingMarkerStrokeColor:"Selecting mark stroke color",DES_selectingMarkerStrokeColor:"Stroke color of selecting rubber band mark",TITLE_selectingMarkerStrokeWidth:"Selecting mark stroke width",DES_selectingMarkerStrokeWidth:"Stroke width of selection rubber band",TITLE_selectingMarkerStrokeDash:"Selecting mark dash style",DES_selectingMarkerStrokeDash:"Dash style of selecting rubber band",TITLE_selectingMarkerFillColor:"Selecting mark fill color",DES_selectingMarkerFillColor:"Fill color of selecting mark. Usually this value should be left blank (not filled)",TITLE_selectingMarkerOpacity:"Selecting mark opacity",DES_selectingMarkerOpacity:"Opacity of selecting mark, value from 0 to 1",TITLE_selectingBrushMarkerStrokeColor:"Brush selecting mark stroke color",DES_selectingBrushMarkerStrokeColor:"Stroke color of brush selecting mark",TITLE_selectingBrushMarkerStrokeDash:"Brush selecting mark dash style",DES_selectingBrushMarkerStrokeDash:"Dash style of brush selecting track",TITLE_selectingBrushMarkerStrokeLineCap:"Brushing selecting mark line-cap style",DES_selectingBrushMarkerStrokeLineCap:"Line-cap style of both ends of brush selecting track",TITLE_selectingBrushMarkerStrokeLineJoin:"Brushing selecting mark join point style",DES_selectingBrushMarkerStrokeLineJoin:"Join style of brush selection track segments",TITLE_selectingBrushMarkerOpacity:"Brush selecting mark opacity",DES_selectingBrushMarkerOpacity:"Opacity of brush selecting mark, value from 0 to 1",TITLE_trackMarkerStrokeColor:"Track-input mark stroke color",DES_trackMarkerStrokeColor:"Stroke color of track mark when using track-input tool to draw a structure",TITLE_trackMarkerStrokeWidth:"Track-input mark stroke width",DES_trackMarkerStrokeWidth:"Stroke width of track mark when using track-input tool to draw a structure",TITLE_trackMarkerStrokeDash:"Track-input mark dash style",DES_trackMarkerStrokeDash:"Dash style of track mark when using track-input tool to draw a structure",TITLE_trackMarkerOpacity:"Track-input mark opacity",DES_trackMarkerOpacity:"Opacity of track mark when using track-input tool to draw a structure",TITLE_flexStructureAssocMarkerColor:"Flex structure association mark color",DES_flexStructureAssocMarkerColor:"Color of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerOpacity:"Flex structure association mark opacity",DES_flexStructureAssocMarkerOpacity:"Opacity of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerFontSize:"Flex structure association mark font size",DES_flexStructureAssocMarkerFontSize:"Font size of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerFontFamily:"Flex structure association mark font family",DES_flexStructureAssocMarkerFontFamily:"Font family of mark showing atom count of flex ring/chain tool"},StructureConfigs:{TITLE_defBondType:"Default bond type",DES_defBondType:"Default type of bond",TITLE_defBondOrder:"Default bond order",DES_defBondOrder:"Default bond order",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default bond length",TITLE_defIsotopeId:"Default isotope",DES_defIsotopeId:"Default isotope when adding a new atom",TITLE_maxFlexChainAtomCount:"Maximum flex chain atom count",DES_maxFlexChainAtomCount:"Maximum atom count when inputting with flex chain tool",TITLE_minFlexChainAtomCount:"Minimal flex chain atom count",DES_minFlexChainAtomCount:"Minimal atom count when inputting with flex chain tool",TITLE_maxFlexRingAtomCount:"Maximum flex ring atom count",DES_maxFlexRingAtomCount:"Maximum atom count when inputting with flex ring tool",TITLE_minFlexRingAtomCount:"Minimal flex ring atom count",DES_minFlexRingAtomCount:"Minimal atom count when inputting with flex ring tool",TITLE_enabledNonAtomNodeTypes:"Available non-atom structure node types",DES_enabledNonAtomNodeTypes:"Non-atom structure node types available in editor",TITLE_enabledBondForms:"Available bond forms",DES_enabledBondForms:"Bond forms available in editor"},ChemSpaceConfigs:{TITLE_defScreenSize2D:"Default 2D screen size",TITLE_defScreenSize3D:"Default 3D screen size",TITLE_defPadding:"Default padding",DES_defPadding:"Padding on top when adding an unpositioned object to container chem space"},BaseEditor:{TITLE_enableCreateNewDoc:"Enable create new document",DES_enableCreateNewDoc:"Whether creating a new document is allowed",TITLE_initOnNewDoc:"Starts with a new document",DES_initOnNewDoc:"Whether create a new document automatically when composer is initialized",TITLE_enableOperHistory:"Enable undo",DES_enableOperHistory:"Whether undo/redo is enabled"},Composer:{TITLE_enableStyleToolbar:"Enable style toolbar",DES_enableStyleToolbar:"Whether display style toolbar to set color, font and size of objects",TITLE_allowCreateNewChild:"Enable create new child object",DES_allowCreateNewChild:"Whether new direct child of document can be created"}}});"use strict";(function(){if(Kekule.PROP_AUTO_TITLE){var d=ClassEx.getPrototype(ObjectEx).defineProp;var b="TITLE_";var c="DES_";var a=function(f,m){if(!m.title&&!m.description){var h=this.getClassName();if(h.startsWith("Kekule.")){h=h.substr(7)}var e=b;var k=c;var g=e+f;var i=k+f;var j=Kekule.Localization.findValue("OBJDEF_TEXTS."+h+"."+g);var l=Kekule.Localization.findValue("OBJDEF_TEXTS."+h+"."+i);m.title=j;m.description=l}return d.apply(this,[f,m])};ClassEx.getPrototype(ObjectEx).defineProp=a}Kekule.ExceptionLevel={ERROR:-1,WARNING:-2,NOTE:-3,LOG:-4};Kekule.throwException=function(h,f){if(Kekule.exceptionHandler){return Kekule.exceptionHandler.throwException(h,f)}else{var g=Kekule.ExceptionLevel;if((!f)||(f===g.ERROR)){if(typeof(h)==="string"){h=new Kekule.Exception(h)}throw h}else{if(typeof(console)!=="undefined"){if(typeof(h)!=="string"){h=h.message}var i=(f===g.WARNING)?console.warn:(f===g.NOTE)?console.info:console.log;if(i){i(h)}else{console.log(h)}}}}};Kekule.getExceptionMsg=function(f){if(typeof(f)==="string"){return f}else{if(typeof(f)==="object"){return f.message}else{return""}}};Kekule.raise=Kekule.throwException;Kekule.error=function(f){return Kekule.raise(f,Kekule.ExceptionLevel.ERROR)};Kekule.chemError=function(f){if(typeof(f)=="string"){f=new Kekule.ChemError(f)}return Kekule.error(f)};Kekule.warn=function(f){return Kekule.raise(f,Kekule.ExceptionLevel.WARNING)};Kekule.notify=function(f){return Kekule.raise(f,Kekule.ExceptionLevel.NOTE)};Kekule.log=function(f){return Kekule.raise(f,Kekule.ExceptionLevel.LOG)};Kekule.hasLocalRes=function(){return !!Kekule.LOCAL_RES};Kekule.globalOptions={add:function(f,g){var e=Object.getCascadeFieldValue(f,Kekule.globalOptions);if(e){if(DataType.isObjectValue(e)&&(DataType.isObjectValue(g))){Object.extend(e,g)}}else{Object.setCascadeFieldValue(f,g,Kekule.globalOptions,true)}}};Kekule.HashEx=Class.create({CLASS_NAME:"Kekule.HashEx",PROP_NAME_PREFIX:"__$key$__",initialize:function(){this._map={}},finalize:function(){this._map=null},keyToPropName:function(e){return this.PROP_NAME_PREFIX+e},has:function(e){return this._map.hasOwnProperty(this.keyToPropName(e))},set:function(e,f){this._map[this.keyToPropName(e)]=f;return this},get:function(f,e){var g=this.keyToPropName(f);if(this._map.hasOwnProperty(g)){return this._map[g]}else{return e}},remove:function(e){var f=this.keyToPropName(e);if(this._map.hasOwnProperty(f)){delete this._map[f]}return this},clear:function(){this._map={}}});Kekule.MapEx=Class.create({CLASS_NAME:"Kekule.MapEx",initialize:function(f,g){this.isWeak=!f;if(!Kekule.MapEx._inited){Kekule.MapEx._init()}var e=f?Kekule.MapEx._implementationNonWeak:Kekule.MapEx._implementationWeak;if(!e){this._keys=[];this._values=[]}else{this._implementation=new e()}if(g){this._cache={}}},finalize:function($super){if(!this._implementation){this._keys=null;this._values=null;this._cache=null}},set:function(f,g){if(this._implementation){this._implementation.set(f,g)}else{var e=this._keys.indexOf(f);if(e>=0){this._values[e]=g}else{this._keys.push(f);this._values.push(g)}}if(this._cache&&this._cache.key===f){this._cache.value=g}return this},get:function(h,f){if(this._cache&&this._cache.key===h){return this._cache.value}var e;var i=false;if(this._implementation){if(this._implementation.has(h)){e=this._implementation.get(h);i=true}}else{var g=this._keys.indexOf(h);if(g>=0){e=this._values[g];i=true}}if(i&&this._cache){this._cache.key=h;this._cache.value=e}return i?e:f},has:function(f){if(this._implementation){return this._implementation.has(f)}else{var e=this._keys.indexOf(f);return e>=0}},remove:function(f){if(this._cache&&this._cache.key===f){this._cache={}}if(this._implementation){return this._implementation["delete"](f)}else{var e=this._keys.indexOf(f);if(e>=0){this._keys.splice(e,1);this._values.splice(e,1)}}return this},clear:function(){if(this._cache){this._cache={}}if(!this._implementation||this._debug){this._keys=[];this._values=[]}if(this._implementation){if(this.isWeak){Kekule.error(Kekule.$L("ErrorMsg.CANNOT_CLEAR_WEAKMAP"))}else{this._implementation.clear()}}return this},getKeys:function(){if(!this._implementation){return[].concat(this._keys)}else{if(this.isWeak){Kekule.error(Kekule.$L("ErrorMsg.CANNOT_GET_KEY_LIST_IN_WEAKMAP"));return[]}else{var f=this._implementation.keys();var e;if(Array.from){e=Array.from(f)}else{e=[];for(var g in f){e.push(g)}}return e}}},getValues:function(){if(!this._implementation){return this._values}else{if(this.isWeak){Kekule.error(Kekule.$L("ErrorMsg.CANNOT_GET_VALUE_LIST_IN_WEAKMAP"));return[]}else{var f=this._implementation.values();var e;if(Array.from){e=Array.from(f)}else{e=[];for(var g in f){e.push(g)}}return e}}},getLength:function(){return this.getKeys().length}});Kekule.MapEx._init=function(){Kekule.MapEx._implementationWeak=null;Kekule.MapEx._implementationNonWeak=null;if(Kekule.$jsRoot.WeakMap){Kekule.MapEx._implementationWeak=Kekule.$jsRoot.WeakMap}if(Kekule.$jsRoot.Map&&Kekule.$jsRoot.Map.prototype.keys){Kekule.MapEx._implementationNonWeak=Kekule.$jsRoot.Map}Kekule.MapEx._inited=true};Kekule.MapEx._inited=false;Kekule.TwoTupleMapEx=Class.create({CLASS_NAME:"Kekule.TwoTupleMapEx",initialize:function(e,f){this.nonWeak=e;this.map=new Kekule.MapEx(e,f);if(f){this._level1Cache={}}},finalize:function(){this._level1Cache=null;this.map.finalize()},getSecondLevelMap:function(f,g){if(f&&this._level1Cache&&(f===this._level1Cache.key)&&this._level1Cache.value){return this._level1Cache.value}else{var e=this.map.get(f);if((!e)&&g){e=new Kekule.MapEx(this.nonWeak);this.map.set(f,e)}return e}},set:function(f,e,g){var h=this.getSecondLevelMap(f,true);h.set(e,g);return this},get:function(g,f,e){var h=this.getSecondLevelMap(g,false);if(h){return h.get(f,e)}else{return e}},has:function(f,e){var g=this.getSecondLevelMap(f,false);if(g){return g.has(e)}else{return false}},remove:function(f,e){var g=this.getSecondLevelMap(f,false);if(g){return g.remove(e)}},clear:function(){this.map.clear();if(this._level1Cache){this._level1Cache={}}}});Kekule.CoordMode={UNKNOWN:0,COORD2D:2,COORD3D:3};Kekule.ClassDefineUtils={CommonSizeMethods:{getSizeOfMode:function(f,e){if(f===Kekule.CoordMode.COORD3D){return this.getSize3D(e)}else{return this.getSize2D(e)}},setSizeOfMode:function(f,e){if(e===Kekule.CoordMode.COORD3D){return this.setSize3D(f)}else{return this.setSize2D(f)}},getBoxOfMode:function(f,e){if(f===Kekule.CoordMode.COORD3D){return this.getBox3D(e)}else{return this.getBox2D(e)}}},Size2DMethods:{fetchSize2D:function(){var e=this.getPropStoreFieldValue("size2D");if(!e){e={};this.setPropStoreFieldValue("size2D",e)}return e},notifySize2DChanged:function(e){this.notifyPropSet("size2D",e)},hasSize2D:function(f){var g=this.getPropStoreFieldValue("size2D");var e=(g)&&((typeof(g.x)!="undefined")||(typeof(g.y)!="undefined"));if((!e)&&f){e=this.hasSize3D?this.hasSize3D():false}return e},getBox2D:function(e){var h=this.getCoord2D(e)||{x:0,y:0};var f=this.getSize2D(e);if(f&&(f.x||f.y)){var i={x:f.x,y:-f.y};var g=Kekule.CoordUtils.add(h,i);return{x1:h.x,y1:h.y,x2:g.x,y2:g.y}}else{return{x1:h.x,y1:h.y,x2:h.x,y2:h.y}}},get2DSizeX:function(e){var f=this.getSize2D(e);return f?f.x||0:0},set2DSizeX:function(e){var f=fetchSize2D();if(f.x!=e){f.x=e;notifySize2DChanged(f)}},get2DSizeY:function(e){var f=this.getSize2D(e);return f?f.y||0:0},set2DSizeY:function(f){var e=fetchSize2D();if(e.y!=f){e.y=f;notifySize2DChanged(e)}}},Size3DMethods:{fetchSize3D:function(){var e=this.getPropStoreFieldValue("size3D");if(!e){e={};this.setPropStoreFieldValue("size3D",e)}return e},notifySize3DChanged:function(e){this.notifyPropSet("size3D",e)},hasSize3D:function(f){var g=this.getPropStoreFieldValue("size3D");var e=(g)&&((typeof(g.x)!=="undefined")||(typeof(g.y)!=="undefined")||(typeof(g.z)!=="undefined"));if((!e)&&f){e=this.hasSize2D?this.hasSize2D():false}return e},getBox3D:function(e){var h=this.getCoord3D(e);var f=this.getSize3D(e);if(h&&f){var g=Kekule.CoordUtils.add(h,f);return{x1:h.x,y1:h.y,z1:h.z,x2:g.x,y2:g.y,z2:g.z}}},get3DSizeX:function(e){var f=this.getSize3D(e);return f?f.x||0:0},set3DSizeX:function(e){var f=fetchSize3D();if(f.x!=e){f.x=e;notifySize3DChanged(f)}},get3DSizeY:function(e){var f=this.getSize3D(e);return f?f.y||0:0},set3DSizeY:function(f){var e=fetchSize3D();if(e.y!=f){e.y=f;notifySize3DChanged(e)}},get3DSizeZ:function(e){var f=this.getSize3D(e);return f?f.z||0:0},set3DSizeZ:function(e){var f=fetchSize3D();if(f.z!=e){f.z=e;notifySize3DChanged(f)}}},addStandardSizeSupport:function(f,e){ClassEx.extend(f,Kekule.ClassDefineUtils.CommonSizeMethods);if((!e)||(e.indexOf("size2D")>=0)){ClassEx.defineProp(f,"size2D",{dataType:DataType.HASH,getter:function(h,i){var j=this.getPropStoreFieldValue("size2D");if((!j)&&h){if(this.hasSize3D()){j=this.getSize3D()}}if((!j)&&i){j={x:0,y:0};this.setPropStoreFieldValue("size2D",j)}var g=j?{x:j.x,y:j.y}:undefined;if(g){g=Kekule.CoordUtils.absValue(g)}return g},setter:function(g){var h=this.fetchSize2D();if(g.x!==undefined){h.x=g.x}if(g.y!==undefined){h.y=g.y}this.notifySize2DChanged(h)}});ClassEx.extend(f,Kekule.ClassDefineUtils.Size2DMethods)}if((!e)||(e.indexOf("size3D")>=0)){ClassEx.defineProp(f,"size3D",{dataType:DataType.HASH,getter:function(h,i){var j=this.getPropStoreFieldValue("size3D");if((!j)&&h){if(this.hasSize2D()){j=this.getSize2D();j.z=0}}if((!j)&&i){j={x:0,y:0,z:0};this.setPropStoreFieldValue("size3D",j)}var g=j?{x:j.x,y:j.y,z:j.z}:undefined;return g},setter:function(g){var h=this.fetchSize3D();if(g.x!==undefined){h.x=g.x}if(g.y!==undefined){h.y=g.y}if(g.z!==undefined){h.z=g.z}this.notifySize3DChanged(h)}});ClassEx.extend(f,Kekule.ClassDefineUtils.Size3DMethods)}},CommonCoordMethods:{getCoordOfMode:function(f,e){if(f===Kekule.CoordMode.COORD3D){return this.getCoord3D(e)}else{return this.getCoord2D(e)}},setCoordOfMode:function(f,e){if(e===Kekule.CoordMode.COORD3D){return this.setCoord3D(f)}else{return this.setCoord2D(f)}},getAbsCoordOfMode:function(f,e){if(f===Kekule.CoordMode.COORD3D){return this.getAbsCoord3D(e)}else{return this.getAbsCoord2D(e)}},setAbsCoordOfMode:function(f,e){if(e===Kekule.CoordMode.COORD3D){return this.setAbsCoord3D(f)}else{return this.setAbsCoord2D(f)}}},Coord2DMethods:{fetchCoord2D:function(){var e=this.getPropStoreFieldValue("coord2D");if(!e){e={};this.setPropStoreFieldValue("coord2D",e)}return e},notifyCoord2DChanged:function(e){this.notifyPropSet("coord2D",e)},hasCoord2D:function(f){var g=this.getPropStoreFieldValue("coord2D");var e=(g)&&((typeof(g.x)!="undefined")||(typeof(g.y)!="undefined"));if((!e)&&f){e=this.hasCoord3D?this.hasCoord3D():false}return e},get2DX:function(e){var f=this.getCoord2D(e);return f?f.x||0:0},set2DX:function(e){var f=this.fetchCoord2D();if(f.x!=e){f.x=e;this.notifyCoord2DChanged(f)}},get2DY:function(e){var f=this.getCoord2D(e);return f?f.y||0:0},set2DY:function(f){var e=this.fetchCoord2D();if(e.y!=f){e.y=f;this.notifyCoord2DChanged(e)}}},Coord3DMethods:{fetchCoord3D:function(){var e=this.getPropStoreFieldValue("coord3D");if(!e){e={};this.setPropStoreFieldValue("coord3D",e)}return e},notifyCoord3DChanged:function(e){this.notifyPropSet("coord3D",e)},hasCoord3D:function(f){var g=this.getPropStoreFieldValue("coord3D");var e=(g)&&((typeof(g.x)!="undefined")||(typeof(g.y)!="undefined")||(typeof(g.z)!="undefined"));if((!e)&&f){e=this.hasCoord2D?this.hasCoord2D():false}return e},get3DX:function(e){var f=this.getCoord3D(e);return f?f.x||0:0},set3DX:function(e){var f=this.fetchCoord3D();if(f.x!=e){f.x=e;this.notifyCoord3DChanged(f)}},get3DY:function(e){var f=this.getCoord3D(e);return f?f.y||0:0},set3DY:function(f){var e=this.fetchCoord3D();if(e.y!=f){e.y=f;this.notifyCoord3DChanged(e)}},get3DZ:function(e){var f=this.getCoord3D(e);return f?f.z||0:0},set3DZ:function(e){var f=this.fetchCoord3D();if(f.z!=e){f.z=e;this.notifyCoord3DChanged(f)}}},addStandardCoordSupport:function(f,e){ClassEx.extend(f,Kekule.ClassDefineUtils.CommonCoordMethods);if((!e)||(e.indexOf("coord2D")>=0)){ClassEx.defineProp(f,"coord2D",{dataType:DataType.HASH,getter:function(h,i){var j=this.getPropStoreFieldValue("coord2D");if((!j)&&h){if(this.hasCoord3D()){j=this.getCoord3D()}}if((!j)&&i){j={x:0,y:0};this.setPropStoreFieldValue("coord2D",j)}var g=j?{x:j.x,y:j.y}:undefined;return g},setter:function(g){var h=this.fetchCoord2D();if(g.x!==undefined){h.x=g.x}if(g.y!==undefined){h.y=g.y}this.notifyCoord2DChanged(h)}});ClassEx.extend(f,Kekule.ClassDefineUtils.Coord2DMethods)}if((!e)||(e.indexOf("coord3D")>=0)){ClassEx.defineProp(f,"coord3D",{dataType:DataType.HASH,getter:function(h,i){var j=this.getPropStoreFieldValue("coord3D");if((!j)&&h){if(this.hasCoord2D()){j=this.getCoord2D();j.z=0}}if((!j)&&i){j={x:0,y:0,z:0};this.setPropStoreFieldValue("coord3D",j)}var g=j?{x:j.x,y:j.y,z:j.z}:undefined;return g},setter:function(g){var h=this.fetchCoord3D();if(g.x!==undefined){h.x=g.x}if(g.y!==undefined){h.y=g.y}if(g.z!==undefined){h.z=g.z}this.notifyCoord3DChanged(h)}});ClassEx.extend(f,Kekule.ClassDefineUtils.Coord3DMethods)}if((!e)||(e.indexOf("absCoord2D")>=0)){ClassEx.defineProp(f,"absCoord2D",{dataType:DataType.HASH,serializable:false,getter:function(h){var j=this.getCoord2D(h)||{};var i=this.getParent?this.getParent():null;var g;if(i&&i.getAbsCoord2D){return Kekule.CoordUtils.add(j,i.getAbsCoord2D(h)||{})}else{return{x:j.x,y:j.y}}},setter:function(g){var h=g;if(this.getParent&&this.getParent()&&this.getParent().getAbsCoord2D){h=Kekule.CoordUtils.substract(g,this.getParent().getAbsCoord2D())}this.setCoord2D(h)}})}if((!e)||(e.indexOf("absCoord3D")>=0)){ClassEx.defineProp(f,"absCoord3D",{dataType:DataType.HASH,serializable:false,getter:function(g){var i=this.getCoord3D(g)||{};var h=this.getParent?this.getParent():null;if(h&&h.getAbsCoord3D){return Kekule.CoordUtils.add(i,h.getAbsCoord3D(g)||{})}else{return{x:i.x,y:i.y,z:i.z}}},setter:function(g){var h=g;if(this.getParent&&this.getParent()){h=Kekule.CoordUtils.substract(g,this.getParent().getAbsCoord3D())}this.setCoord3D(h)}})}},ExtraObjMapMethods:{getExtraProp:function(g,e){var f=this.getExtraObjMap().get(g);if(f){return e?f[e]:f}else{return undefined}},setExtraProp:function(g,e,h){var f=this.getExtraProp(g);if(f){f[e]=h}else{var f={};f[e]=h;this.getExtraObjMap().set(g,f)}},removeExtraProp:function(g,e){if(e){var f=this.getExtraProp(g);f[e]=undefined;delete f[e]}else{this.getExtraObjMap().remove(g)}}},addExtraObjMapSupport:function(f){var e="extraObjMap";ClassEx.defineProp(f,e,{dataType:"Kekule.MapEx",serializable:false,getter:function(){var g=this.getPropStoreFieldValue(e);if(!g){g=new Kekule.MapEx(true,true);this.setPropStoreFieldValue(e,g)}return g}});ClassEx.extend(f,Kekule.ClassDefineUtils.ExtraObjMapMethods)},ExtraTwoTupleObjMapMethods:{getExtraProp2:function(h,g,e){var f=(this.__$__k__extraTwoTupleObjMap__$__||this.getExtraTwoTupleObjMap()).get(h,g);if(f){return e?f[e]:f}else{return undefined}},setExtraProp2:function(i,g,e,h){var f=this.getExtraProp2(i,g);if(f){f[e]=h}else{var f={};f[e]=h;(this.__$__k__extraTwoTupleObjMap__$__||this.getExtraTwoTupleObjMap()).set(i,g,f)}},removeExtraProp2:function(h,g,e){if(e){var f=this.getExtraProp2(h,g);f[e]=undefined;delete f[e]}else{this.getExtraTwoTupleObjMap().remove(h,g)}}},addExtraTwoTupleObjMapSupport:function(f){var e="extraTwoTupleObjMap";ClassEx.defineProp(f,e,{dataType:"Kekule.TwoTupleMapEx",serializable:false,getter:function(){var g=this.getPropStoreFieldValue(e);if(!g){g=new Kekule.TwoTupleMapEx(true,true);this.setPropStoreFieldValue(e,g);this.__$__k__extraTwoTupleObjMap__$__=g}return g}});ClassEx.extend(f,Kekule.ClassDefineUtils.ExtraTwoTupleObjMapMethods)}};Kekule.ObjPropSettingManager={_items:new Kekule.MapEx(true),register:function(e,f){Kekule.ObjPropSettingManager._items.set(e,f)},unregister:function(e){Kekule.ObjPropSettingManager._items.remove(e)},getSetting:function(e){return Kekule.ObjPropSettingManager._items.get(e)}};ClassEx.defineProp(ObjectEx,"predefinedSetting",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(k){var n=Kekule.StrUtils.splitTokens(k||"",",");if(n.length){for(var g=0,f=n.length;g<f;++g){var j=this.getClass();var m=n[g];var o=null;var e="";while(j&&!o){var h=ClassEx.getClassName(j);var e=h+"."+m;var o=Kekule.ObjPropSettingManager.getSetting(e);j=ClassEx.getSuperClass(j)}if(!o){o=Kekule.ObjPropSettingManager.getSetting(m)}if(o){this.setPropValues(o)}}this.setPropStoreFieldValue("predefinedSetting",e)}}});Kekule.ChemObjInteractMode={DEFAULT:0,HIDDEN:-1};Kekule.ComparisonMethod={DEFAULT:0,PROPERTIES:1,CHEM_STRUCTURE:10};Kekule.ObjComparer={equal:function(g,f,e){return Kekule.ObjComparer.compare(g,f,e)===0},compare:function(g,f,e){return Kekule.ObjComparer._compareValue(g,f,e)},_compareValue:function(p,n,s){var e=DataType;if(p===n){return 0}if(p<n&&!(p>n)){return -1}else{if(p>n&&!(p<n)){return 1}else{var t=null;var j=e.getType(p);var g=e.getType(n);if(j!==g){var r=[e.UNKNOWN,e.VARIANT,e.UNDEFINED,e.BOOL,e.NUMBER,e.INT,e.FLOAT,e.STRING,e.ARRAY,e.FUNCTION,e.DATE,e.OBJECT,e.OBJECTEX,e.CLASS];var m=r.indexOf(j);var k=r.indexOf(g);if(m<0&&k<0){t=null}else{t=m-k}}else{if(!p&&n){t=-1}else{if(p&&!n){t=1}else{if(p.doCompare){t=p.doCompare(n,s)}else{if(n.doCompare){t=-n.doCompare(p,s)}else{if(j===DataType.ARRAY){t=p.length-n.length;if(!t){for(var h=0,f=p.length;h<f;++h){t=Kekule.ObjComparer._compareValue(p[h],n[h],s);if(!!t){break}}}}else{if(j===DataType.OBJECT){var q=JSON.toString(p);var o=JSON.toString(n);t=(q<o)?-1:(q>o)?1:0}else{t=null}}}}}}}if(t===null){var q=(p.toString&&p.toString())||"";var o=(n.toString&&n.toString())||"";t=(q<o)?-1:(q>o)?1:null;if(t===null){t=-1}}return t}}}};Kekule.ChemObject=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemObject",initialize:function($super,e){$super();if(e){this.setId(e)}this.setBubbleEvent(true);this.addEventListener("change",function(m){var o=this.getPropStoreFieldValue("srcInfo");if(o&&o.data){var k=m.target;var n=m.changedPropNames;var f=false;for(var j=0,g=n.length;j<g;++j){var h=n[j];if(h&&h!=="srcInfo"&&k.isPropertySerializable(h)){f=true;break}else{if(h==="[children]"){f=true;break}}}if(f){o.data=null}}},this)},doFinalize:function($super){this.removeSelf();$super()},initProperties:function(){this.defineProp("id",{dataType:DataType.STRING});this.defineProp("interactMode",{dataType:DataType.INT});this.defineProp("info",{dataType:DataType.HASH,getter:function(f){var e=this.getPropStoreFieldValue("info");if((!e)&&f){e={};this.setPropStoreFieldValue("info",e)}return e}});this.defineProp("scalarAttribs",{dataType:DataType.ARRAY,setter:null});this.defineProp("parent",{dataType:"Kekule.ChemObject",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){var e=this.getParent();if(e===f){return}if(e&&e._removeChildObj){e._removeChildObj(this)}this.setPropStoreFieldValue("parent",f);if(f&&f._appendChildObj){f._appendChildObj(this)}this.parentChanged(f)}});this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){var e=this.getOwner();if(e===f){return}if(e){e._removeOwnedObj(this)}this.setPropStoreFieldValue("owner",f);if(f){f._appendOwnedObj(this)}this.ownerChanged(f)}});this.defineProp("srcInfo",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("srcInfo");if(!e){e={};this.setPropStoreFieldValue("srcInfo",e)}return e}})},initPropValues:function($super){$super();this.setEnableObjectChangeEvent(true)},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},getAutoIdPrefix:function(){return"o"},isSelectable:function(){return this.getInteractMode()!==Kekule.ChemObjInteractMode.HIDDEN},getNearestSelectableObject:function(){return this.isSelectable()?this:this.getParent()?this.getParent().getNearestSelectableObject():null},removeSelf:function(){this.setParent(null);this.setOwner(null)},notifyScalarAttribsChange:function(){this.notifyPropSet("scalarAttribs",this.getPropStoreFieldValue("scalarAttribs"))},notifyInfoChange:function(){this.notifyPropSet("info",this.getPropStoreFieldValue("info"))},ownerChanged:function(f){for(var g=0,e=this.getScalarAttribCount();g<e;++g){this.getScalarAttribAt(g).setOwner(f)}for(var g=0,e=this.getChildCount();g<e;++g){var h=this.getChildAt(g);if(h&&h.setOwner){h.setOwner(f)}}},parentChanged:function(e){},isChildOf:function(f){var e=this.getParent();while(e&&(e!==f)){e=e.getParent?e.getParent():null}return(!!e)},getNextSibling:function(){var e=this.getParent();if(e&&e.getNextSiblingOfChild){return e.getNextSiblingOfChild(this)}else{return null}},getChildCount:function(){return 0},getChildAt:function(e){return null},indexOfChild:function(e){return -1},removeChild:function(e){return null},insertBefore:function(f,e){return -1},appendChild:function(e){return this.insertBefore(e,null)},cascadeOnChildren:function(g){if(!g){return this}for(var f=0,e=this.getChildCount();f<e;++f){var h=this.getChildAt(f);if(h.cascadeOnChildren){h.cascadeOnChildren(g)}g(h)}return this},cascade:function(e){if(!e){return this}this.cascadeOnChildren(e);e(this);return this},isEmpty:function(){return false},clearIds:function(){this.setId(undefined);for(var f=0,e=this.getChildCount();f<e;++f){var g=this.getChildAt(f);if(g.clearIds){g.clearIds()}}},assignTo:function($super,g,f){var e=$super(g);if(!f&&g.clearIds){g.clearIds()}return e},assign:function(f,e){return f.assignTo(this,e)},clone:function(f){var g=this.getClass();var e=new g();this.assignTo(e,f);return e},getScalarAttribCount:function(){var e=this.getScalarAttribs();return e?e.length:0},getScalarAttribAt:function(f){var e=this.getScalarAttribs();return e?e[f]:null},appendScalarAttrib:function(e){if(!this.getScalarAttribs()){this.setPropStoreFieldValue("scalarAttribs",[])}var f=Kekule.ArrayUtils.pushUniqueEx(this.getScalarAttribs(),e);if(f.isPushed){e.setParent(this);this.notifyScalarAttribsChange()}return f.index},removeScalarAttribAt:function(e){if(!this.getScalarAttribs()){return null}else{var f=Kekule.ArrayUtils.removeAt(this.getScalarAttribs(),e);if(f){f.setParent(null);this.notifyScalarAttribsChange()}return f}},removeScalarAttrib:function(e){if(!this.getScalarAttribs()){return null}else{var f=Kekule.ArrayUtils.remove(this.getScalarAttribs(),e);if(f){f.setParent(null);this.notifyScalarAttribsChange()}return f}},getInfoKeys:function(){return this.getInfo()?Kekule.ObjUtils.getOwnedFieldNames(this.getInfo()):[]},getInfoValue:function(e){return this.getInfo()?this.getInfo()[e]:null},setInfoValue:function(e,f){this.doGetInfo(true)[e]=f;this.notifyInfoChange()},getContainerBox:function(i,f){if(this.getAbsCoordOfMode){var j=this.getAbsCoordOfMode(i,f)||{};var h=j;if(this.getSizeOfMode){var g=this.getSizeOfMode(i,f)||{};if(i===Kekule.CoordMode.COORD3D){var h=Kekule.CoordUtils.add(j,this.getSizeOfMode(i,f)||{})}else{h={x:j.x+g.x,y:j.y-g.y}}}var e=Kekule.BoxUtils.createBox(j,h);return e}else{return null}},equal:function(f,e){return this.compare(f,e)===0},compare:function(g,f){if(g===this){return 0}if(!g){return 1}var h=this.doGetActualCompareOptions(f);var e;if(h.customMethod){e=h.customMethod(this,g,h)}else{e=this.doCompare(g,h)}return(e===0)?0:(e<0)?-1:1},doGetActualCompareOptions:function(e){return e||{}},doCompare:function(j,q){if(j===this){return 0}else{var k=this.getClass();var p=j.getClass&&j.getClass();if(k!==p){var o=this.getClassName();var f=(j.getClassName&&j.getClassName())||"";return(o<f)?-1:1}else{var r=this.doCompareOnProperties(j,q);if(!r&&q.extraComparisonProperties){for(var g=0,e=q.extraComparisonProperties.length;g<e;++g){var h=q.extraComparisonProperties[g];if(this.hasProperty(h)&&j.hasProperty&&j.hasProperty(h)){var n=this.getPropValue(h);var m=j.getPropValue(h);r=this.doCompareOnValue(n,m,q);if(!r){break}}}}return r}}},doCompareOnProperties:function(j,g){var k;if(g.properties){k=g.properties}else{k=this.doGetComparisonPropNames(g);if(!k){k=this.doGetDefaultComparisonPropNames()}}var e=0;for(var h=0,f=k.length;h<f;++h){e=this.doCompareProperty(j,k[h],g);if(e!==0){return e}}return 0},doGetComparisonPropNames:function(e){return null},doGetDefaultComparisonPropNames:function(){var j=[];var h=this.getPropListOfScopes([Class.PropertyScope.PUBLIC,Class.PropertyScope.PUBLISHED]);for(var g=0,f=h.getLength();g<f;++g){var e=h.getPropInfoAt(g);j.push(e.name)}return j},doCompareProperty:function(g,h,f){var i=g.getPropValue&&g.getPropValue(h);var j=this.getPropValue(h);if(j===i){return 0}else{var e=this.doCompareOnValue(j,i,f);return e}},doCompareOnValue:function(g,f,e){return Kekule.ObjComparer._compareValue(g,f,e)}});Kekule.Scalar=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Scalar",initialize:function($super,h,e,g,f){$super(h);if(e){this.setName(e)}if(typeof(g)!=="undefined"){this.setValue(g)}if(f){this.setUnit(f)}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING});this.defineProp("value",{dataType:DataType.PRIMARY});this.defineProp("errorValue",{dataType:DataType.PRIMARY});this.defineProp("unit",{dataType:DataType.STRING});this.defineProp("title",{dataType:DataType.STRING})}});Kekule.ChemObjList=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemObjList",initialize:function($super,g,e,f){$super(g);this.setPropStoreFieldValue("itemBaseClass",e);this._transparent=!!f},initProperties:function(){this.defineProp("itemBaseClass",{dataType:DataType.CLASS,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("items",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(f){var e=this.getPropStoreFieldValue("items");if((!e)&&f){e=[];this.setPropStoreFieldValue("items",e)}return e}})},loaded:function($super){this.ownerChanged(this.getOwner());this.parentChanged(this.getParent())},parentChanged:function($super,e){this.changeAllItemsParent();$super(e)},isEmpty:function(){return result&&(this.getItemCount()<=0)},checkItemType:function(f){var g=this.getItemBaseClass();var e=g?f instanceof g:true;if(!e){Kekule.raise(Kekule.$L("ErrorMsg.LIST_ITEM_CLASS_MISMATCH"))}return e},notifyItemsChange:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},getItemOwner:function(){return this.getOwner()},changeAllItemsOwner:function(){var g=this.getItems();if(g){var e=this.getItemOwner();for(var h=0,f=g.length;h<f;++h){var j=g[h];if(j&&j.setOwner){j.setOwner(e)}}}},getItemParent:function(){return this._transparent?this.getParent()||this:this},changeAllItemsParent:function(){var f=this.getItems();if(f){var h=this.getItemParent();for(var g=0,e=f.length;g<e;++g){var j=f[g];if(j&&j.setParent){j.setParent(h)}}}},getItemCount:function(){var e=this.getPropStoreFieldValue("items");return e?e.length:0},getItemAt:function(f){var e=this.getPropStoreFieldValue("items");return e?e[f]:null},indexOf:function(f){var e=this.getPropStoreFieldValue("items");return e?e.indexOf(f):-1},getNextSiblingOfChild:function(f){var e=this.indexOf(f);return(e>=0)?this.getItemAt(e+1):null},getChildCount:function(){return this.getItemCount()},getChildAt:function(e){return this.getItemAt(e)},indexOfChild:function(e){return this.indexOf(e)},append:function(f){this.checkItemType(f);if(f){var e=Kekule.ArrayUtils.pushUniqueEx(this.doGetItems(true),f);if(e.isPushed){this.notifyItemsChange();if(f.setOwner){f.setOwner(this.getItemOwner())}if(f.setParent){f.setParent(this.getItemParent())}}return e.index}else{return -1}},insert:function(g,e){this.checkItemType(g);if(g){var f=Kekule.ArrayUtils.insertUniqueEx(this.doGetItems(true),g,e);if(f.isInserted){this.notifyItemsChange();if(g.setOwner){g.setOwner(this.getItemOwner())}if(g.setParent){g.setParent(this.getItemParent())}}return f.index}else{return -1}},insertBefore:function(g,e){if(!e){return this.append(g)}else{var f=this.indexOf(e);return(f>=0)?this.insert(g,f):this.append(g)}},removeAt:function(e){if(this.getItems()){var f=Kekule.ArrayUtils.removeAt(this.getItems(),e);if(f){if(f.setOwner){f.setOwner(null)}if(f.setParent){f.setParent(null)}this.notifyItemsChange()}return f}},removeChildAt:function(e){return this.removeAt(e)},remove:function(f){if(this.getItems()){var e=Kekule.ArrayUtils.remove(this.getItems(),f);if(e){if(e.setOwner){e.setOwner(null)}if(e.setParent){e.setParent(null)}this.notifyItemsChange()}return e}},removeChild:function($super,e){return this.remove(e)||$super(e)},toArray:function(){return this.getItems()},getContainerBox:function(k,g){var e;var m=this.toArray();for(var h=0,f=m.length;h<f;++h){var n=m[h];var j=n.getContainerBox?n.getContainerBox(k,g):null;if(j){if(!e){e=Kekule.BoxUtils.clone(j)}else{e=Kekule.BoxUtils.getContainerBox(e,j)}}}return e}});Kekule.ChemSpaceElement=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpaceElement",initialize:function($super,f){$super(f);var e=new Kekule.ChemObjList(null,Kekule.ChemObject,true);e.setParent(this);e.addEventListener("change",function(){this.objectChange(["children"])},this);this.setPropStoreFieldValue("children",e)},initProperties:function(){this.defineProp("children",{dataType:"Kekule.ChemObjList",scope:Class.PropertyScope.PUBLIC,setter:function(f){var e=this.getChildren();if(e){e.finalize()}if(f){f.setParent(this);f.setOwner(this.getOwner())}this.setPropStoreFieldValue("children",f)}})},ownerChanged:function($super,e){this.getChildren().setOwner(e)},_removeChildObj:function(f){var e=this.indexOfChild(f);if(e>=0){this.removeChildAt(e)}},getChildCount:function(){return this.getChildren().getItemCount()},getChildAt:function(e){return this.getChildren().getItemAt(e)},indexOfChild:function(e){return this.getChildren().indexOf(e)},getNextSiblingOfChild:function(e){return this.getChildren().getNextSiblingOfChild(e)},appendChild:function(e){return this.getChildren().append(e)},insertChild:function(f,e){return this.getChildren().insert(f,e)},insertBefore:function(f,e){return this.getChildren().insertBefore(f,e)},removeChildAt:function(e){return this.getChildren().removeChildAt(e)},removeChild:function($super,e){return this.getChildren().removeChild(e)||$super(e)}});Kekule.ChemSpace=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpace",initialize:function($super,f){$super(f);this._autoIdMap={};this.setPropStoreFieldValue("enableAutoId",true);this.setPropStoreFieldValue("ownedObjs",[]);var e=new Kekule.ChemSpaceElement();this.setPropStoreFieldValue("root",e);e.setParent(this);e.setOwner(this)},initProperties:function(){this.defineProp("ownedObjs",{dataType:DataType.ARRAY,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("root",{dataType:"Kekule.ChemSpaceElement",setter:null});this.defineProp("enableAutoId",{dataType:DataType.BOOL});this.defineProp("objScreenLengthRatio",{dataType:DataType.FLOAT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("screenSize",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("screenSize")||{};return{x:e.x,y:e.y}},setter:function(e){var f=this.getPropStoreFieldValue("screenSize");if(!f){f={};this.setPropStoreFieldValue("screenSize",f)}f.x=e.x;f.y=e.y}})},loaded:function($super){$super();var e=this.getRoot();if(e){e.setParent(this);e.setOwner(this)}},notifyOwnedObjsChange:function(){this.notifyPropSet("ownedObjs",this.getPropStoreFieldValue("ownedObjs"))},getChildren:function(){return this.getRoot().getChildren().toArray()},getChildCount:function(){return this.getRoot().getChildCount()},getChildAt:function(e){return this.getRoot().getChildAt(e)},indexOfChild:function(e){return this.getRoot().indexOfChild(e)},getNextSiblingOfChild:function(e){return this.getRoot().getNextSiblingOfChild(e)},appendChild:function(e){return this.getRoot().appendChild(e)},insertChild:function(f,e){return this.getRoot().insertChild(f,e)},insertBefore:function(f,e){return this.getRoot().insertBefore(f,e)},removeChildAt:function(e){return this.getRoot().removeChildAt(e)},removeChild:function($super,e){return this.getRoot().removeChild(e)||$super(e)},getObjById:function(h){for(var f=0,e=this.getOwnedObjCount();f<e;++f){var g=this.getOwnedObjAt(f);if(g.getId){if(g.getId()===h){return g}}}return null},getAutoId:function(h,f){var g;if(h){g=h.getAutoIdPrefix?h.getAutoIdPrefix():"o"}else{g="o"}var g=h.getAutoIdPrefix?h.getAutoIdPrefix():"o";var e;if(Kekule.ObjUtils.notUnset(f)){e=f}else{e=1}var e=this._getAutoIdIndex(g,e);this._autoIdMap[g]=e;return g+Number(e).toString()},_getAutoIdIndex:function(g,f){var j=f||0;var e=j;var h=g+Number(e).toString();while(this.getObjById(h)){++e;h=g+Number(e).toString()}return e},assignAutoIdToObj:function(e){if(e.setId){var f=this.getAutoId(e);e.setId(f)}},getOwnedObjCount:function(){return this.getOwnedObjs().length},getOwnedObjAt:function(e){return this.getOwnedObjs()[e]},indexOfOwnedObj:function(e){return this.getOwnedObjs().indexOf(e)},_appendOwnedObj:function(e){if(this.indexOfOwnedObj(e)>=0){return}else{if(this.getEnableAutoId()){if(e.getId&&!e.getId()){this.assignAutoIdToObj(e)}}this.getOwnedObjs().push(e);this.notifyOwnedObjsChange()}},_removeOwnedObjAt:function(e){var f=this.getOwnedObjAt(e);if(f){this.getOwnedObjs().splice(e,1);this.notifyOwnedObjsChange()}},_removeOwnedObj:function(f){var e=this.getOwnedObjs().indexOf(f);if(e>=0){this._removeOwnedObjAt(e)}}});Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.ChemSpace);Kekule.ChemDocument=Class.create(Kekule.ChemSpace,{CLASS_NAME:"Kekule.ChemDocument",initProperties:function(){},getAutoIdPrefix:function(){return"d"}})})();Kekule.ExceptionHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExceptionHandler",initProperties:function(){this.defineEvent("exceptionThrown")},notifyExceptionThrown:function(b,a){var c={exception:b,level:a};this.invokeEvent("exceptionThrown",c);return c},throwException:function(d,b){var c=Kekule.ExceptionLevel;if(!b){b=c.ERROR}var g=this.notifyExceptionThrown(d,b||c.ERROR);if(!g.stop){if((!b)||(b===c.ERROR)){var a=d;if(typeof(d)==="string"){a=new Kekule.Exception(d)}throw a}else{if(typeof(console)!=="undefined"){if(typeof(d)!=="string"){d=d.message}var f=(b===c.WARNING)?"warn":(b===c.NOTE)?"info":"log";if(f){console[f](d)}else{console.log(d)}}}}},raise:function(b,a){return this.throwException(b,a||Kekule.ExceptionLevel.ERROR)}});Kekule.ExceptionHandler.getInstance=function(){if(!this.instance){this.instance=new Kekule.ExceptionHandler()}return this.instance};Kekule.exceptionHandler=Kekule.ExceptionHandler.getInstance();Kekule.Exception=function(b,a){this.message=b;this.name=a};Kekule.Exception.prototype=new Error();Kekule.Exception.prototype.constructor=Kekule.Exception;Object.extend(Kekule.Exception.prototype,{getMessage:function(){return this.message}});Kekule.Error=function(b,a){this.message=b;this.name=a};Kekule.Error.prototype=Kekule.Exception.prototype;Kekule.Error.prototype.constructor=Kekule.Error;Kekule.ChemError=function(b,a){this.message=b;this.name=a};Kekule.ChemError.prototype=Kekule.Error.prototype;Kekule.ChemError.prototype.constructor=Kekule.ChemError;if(typeof(console)=="undefined"){console={log:function(){},warn:function(){},info:function(){},error:function(){}}}Kekule.oneOf=function(){var b=arguments;var d=Kekule.ObjUtils.notUnset;for(var c=0,a=b.length;c<a;++c){if(d(b[c])){return b[c]}}return null};Kekule.ClassUtils={getShortClassName:function(a){var b=a.indexOf(".");if(b>=0){return a.substring(b+1)}else{return a}},getLastClassName:function(a){var b=a.lastIndexOf(".");return(b>=0)?a.substring(b+1):a},makeSingleton:function(a){return Object.extend(a,{_instance:null,getInstance:function(k,j,i,h,g,f,e,d,c,b){if(!a._instance){a._instance=new a(k,j,i,h,g,f,e,d,c,b)}return a._instance}})}};Kekule.NumUtils={isInteger:function(a){return(typeof(a)==="number")&&(parseInt(a,10)===parseFloat(a))},toDecimals:function(a,e){if(Kekule.NumUtils.isInteger(a)){return a.toString()}var g=Math.pow(10,e);var h=Math.round(a*g);h=h/g;var b=parseInt(h);var d=h-b;var c=d.toString();if(c.length>e+2){c=c.substr(2,e);return b.toString()+"."+c}else{return h.toString()}},isFloatEqual:function(b,c,a){if(Kekule.ObjUtils.isUnset(a)){a=1e-100}return Math.abs(b-c)<=a},getPrimes:function(a){var d=[],c,b,e=[];for(c=2;c<=a;++c){if(!d[c]){e.push(c);for(b=c<<1;b<=a;b+=c){d[b]=true}}}return e}};Kekule.ObjUtils={getPrototypeOf:function(a){return Object.getPrototypeOf?Object.getPrototypeOf(a):(a.prototype||a.__proto__)},getOwnedFieldNames:function(c,b){var a=[];for(var d in c){if(c.hasOwnProperty(d)&&(b||typeof(c[d])!="function")){a.push(d)}}return a},replacePropName:function(c,b,a){if(c[b]!==undefined){if(c.hasOwnProperty(b)){c[a]=c[b];delete c[b]}else{Kekule.raise(Kekule.$L("ErrorMsg.NON_OWN_PROPERTY_CANNOT_BE_REPLACED"))}}return c},isUnset:function(a){return(a===null)||(typeof(a)=="undefined")},notUnset:function(a){return(a!==null)&&(typeof(a)!=="undefined")},equal:function(c,a,b){for(var d in c){if(b&&(b.indexOf(d)>=0)){continue}if(c[d]!==a[d]){return false}}return true},match:function(a,c){for(var b in c){if(c.hasOwnProperty(b)){if(a[b]!==c[b]){return false}}}return true},isInstanceOf:function(d,c){if(!DataType.isArrayValue(c)){return(d instanceof c)}else{for(var b=0,a=c.length;b<a;++b){if(d instanceof c[b]){return true}}return false}},getLeafFieldCascadeNames:function(c,b){var d=function(i,g,h,e){for(var j in h){if(h.hasOwnProperty(j)&&(e||typeof(h[j])!="function")){var f=h[j];if(typeof(f)==="object"){d(i,g+j+".",f,e)}else{i.push(g+j)}}}};var a=[];d(a,"",c,b);return a}};Kekule.ArrayUtils={isArray:function(a){if(a){return((typeof(a)=="object")&&(a.length!==undefined))}else{return false}},toArray:function(a){if(Kekule.ArrayUtils.isArray(a)){return a}else{return[a]}},clone:function(a){return a.slice(0)},divide:function(g,c){var a=[];var e=[];var f=0;for(var d=0,b=g.length;d<b;++d){e.push(g[d]);++f;if(f>=c){a.push(e);e=[];f=0}}if(e.length){a.push(e)}return a},pushUnique:function(c,b){var a=Kekule.ArrayUtils.pushUniqueEx(c,b);return a?a.index:null},pushUniqueEx:function(f,e){if(DataType.isArrayValue(e)){var d;for(var c=0,a=e.length;c<a;++c){if(Kekule.ObjUtils.isUnset(d)){d=Kekule.ArrayUtils.pushUniqueEx(f,e[c])}else{Kekule.ArrayUtils.pushUniqueEx(f,e[c])}}return d}else{if(!e){return{index:-1,isPushed:false}}var b=f.indexOf(e);if(b<0){return{index:f.push(e),isPushed:true}}else{return{index:b,isPushed:false}}}},insertUnique:function(c,b,a){return Kekule.ArrayUtils.insertUniqueEx(c,b,a).index},insertUniqueEx:function(d,c,a){if(!c){return{index:-1,isInserted:false}}if(Kekule.ObjUtils.isUnset(a)||(a<0)){a=d.length}var b=d.indexOf(c);if(b<0){d.splice(a,0,c);return{index:a,isInserted:true}}else{if(b!=a){d.splice(b,1);d.splice(a,0,c);return{index:a,isInserted:false}}}},removeAt:function(c,a){var b=c[a];if(typeof(b)!="undefined"){c.splice(a,1);return b}else{return null}},remove:function(d,c,b){var a=d.indexOf(c);if(a>=0){Kekule.ArrayUtils.removeAt(d,a);if(b){Kekule.ArrayUtils.remove(d,c,b)}return c}else{return null}},replace:function(e,b,c,a){var d=e.indexOf(b);if(d>=0){e[d]=c;if(a){Kekule.ArrayUtils.replace(e,b,c,a)}return b}else{return null}},changeIndex:function(c,d,a){if((d>=0)&&(d<=c.length)){var b=c[d];c.splice(d,1);c.splice(a,0,b);return b}else{return null}},changeItemIndex:function(d,c,b){var a=d.indexOf(c);return Kekule.ArrayUtils.changeIndex(d,a,b)},toUnique:function(f){var c=[];for(var g=0,d=f.length;g<d;++g){var h=f[g];if(c.indexOf(h)<0){c.push(h)}}return c},getUniqueElemCount:function(d){var c=Kekule.ArrayUtils.toUnique(d);return c.length},reverse:function(d){var b=[];for(var e=0,c=d.length;e<c;++e){if(Kekule.ObjUtils.notUnset(d[e])){b[c-e-1]=d[e]}}return b},randomize:function(d){if(!d){return null}if(!d.length){return[]}var a=[];var c=d.slice(0);while(c.length>1){var b=Math.round(Math.random()*(c.length-1));a.push(c.splice(b,1)[0])}a.push(c[0]);return a},exclude:function(f,g){var a=[];var e=Kekule.ArrayUtils.toArray(g);for(var c=0,b=f.length;c<b;++c){var d=f[c];if(e.indexOf(d)<0){a.push(d)}}return a},intersect:function(d,b){var a=[];for(var e=0,c=d.length;e<c;++e){if(b.indexOf(d[e])>=0){a.push(d[e])}}return a},compare:function(d,a,g){if(!g){g=function(j,i){return(j>i)?1:(j<i)?-1:0}}var c=Math.min(d.length,a.length);for(var h=0;h<c;++h){var e=d[h];var b=a[h];var f=g(e,b);if(f!==0){return f}}if(d.length>c){return 1}else{if(a.length>c){return -1}else{return 0}}},compareNestedArray:function(c,b,a){var d=Math.min(c.length,b.length);if(!a){a=function(m,l){return m-l}}for(var e=0;e<d;++e){var k=0;var g=c[e];var f=b[e];var j=DataType.isArrayValue(g);var h=DataType.isArrayValue(f);if(j&&h){k=Kekule.ArrayUtils.compareNestedArray(g,f,a)}else{if(j){k=1}else{if(h){k=-1}else{k=a(g,f)}}}if(k!=0){return k}}if(c.length>d){return 1}else{if(b.length>d){return -1}else{return 0}}},group:function(e,a){if(!a){a=function(k,i){return(k<i)?-1:(k>i)?1:0}}var g=Kekule.ArrayUtils.clone(e);g.sort(a);var j=[];var b;for(var d=0,c=g.length;d<c;++d){var h=g[d];if(b&&a(h,b)===0){var f=j.length?j[j.length-1]:null;if(!Kekule.ArrayUtils.isArray(f)){j.pop();f=[b];j.push(f)}f.push(h)}else{j.push(h)}b=h}return j},getMedian:function(b){var d=[].concat(b);var c=d.length;if(c===0){return null}if(c<=1){return d[0]}else{d.sort(function(f,e){return f-e});return(c%2)?d[(c+1)>>1]:(d[c>>1]+d[(c>>1)-1])/2}},sortHashArray:function(g,c){var d="!";var e=[];for(var f=0,b=c.length;f<b;++f){var a={};var h=c[f]||"";if(h.startsWith(d)){a.field=h.substr(1);a.desc=true}else{a.field=h;a.desc=false}e.push(a)}var j=function(r,p){var k=0;for(var n=0,m=e.length;n<m;++n){var o=e[n].field;var s=r[o]||"";var q=p[o]||"";k=(s>q)?1:(s<q)?-1:0;if(e[n].desc){k=-k}if(k!==0){break}}return k};g.sort(j);return g}};Kekule.StrUtils={STR_TRUES:["true","yes","t","y"],STR_FALSES:["false","no","f","n"],trim:function(a){return a.replace(/^\s*|\s*$/g,"")},normalizeSpace:function(a){return a.replace(/^\s*|\s(?=\s)|\s*$/g,"")},convertToStr:function(a){return""+a},convertToType:function(a,b){if(typeof(a)!="string"){return a}switch(b){case DataType.FLOAT:case DataType.NUMBER:return parseFloat(a);break;case DataType.INT:return parseInt(a);break;case DataType.BOOL:return Kekule.StrUtils.strToBool(a);break;default:return a}},boolToStr:function(a){if(a){return Kekule.StrUtils.STR_TRUES[0]}else{return Kekule.StrUtils.STR_FALSES[0]}},strToBool:function(d){var b=d.toLowerCase();for(var c=0,a=Kekule.StrUtils.STR_FALSES.length;c<a;++c){if(b==Kekule.StrUtils.STR_FALSES[c]){return false}}return !!d},removeAroundPair:function(c,b,a){if(c.startsWith(b)&&c.endsWith(a)){return c.substring(b.length,c.length-b.length-a.length+1)}else{return c}},unquote:function(c){var b=Kekule.StrUtils.removeAroundPair;var a=c;a=b(a,"'","'");a=b(a,'"','"');return a},splitTokens:function(c,b){if(!c){return[]}if(DataType.isArrayValue(c)){return c}else{var a=b?new RegExp(b,"g"):/\s+/g;return c.split(a)}},hasToken:function(d,a,c){var b=Kekule.StrUtils.splitTokens(d,c);return(b.indexOf(a)>=0)},addTokens:function(g,e,d){var c=Kekule.StrUtils.splitTokens(g,d);var f=Kekule.StrUtils.splitTokens(e,d);for(var b=0,a=f.length;b<a;++b){if(c.indexOf(f[b])<0){c.push(f[b])}}return c.join(d||" ")},removeTokens:function(h,g,f){var e=Kekule.StrUtils.splitTokens(h,f);var d=Kekule.StrUtils.splitTokens(g,f);for(var c=0,a=d.length;c<a;++c){var b=e.indexOf(d[c]);if(b>=0){e.splice(b,1)}}return e.join(f||" ")},toggleTokens:function(g,h,d){var f=Kekule.StrUtils.splitTokens(g,d);var a=Kekule.StrUtils.splitTokens(h,d);var j=[];for(var c=0,b=a.length;c<b;++c){var e=f.indexOf(a[c]);if(e>=0){f.splice(e,1)}else{j.push(a[c])}}f=f.concat(j);return f.join(d||" ")},getLineCount:function(c,b){if(!b){b="\n"}var a=c.split(b);return a.length},getMaxLineCharCount:function(g,f){if(!f){f="\n"}var d=g.split(f);var a=0;for(var e=0,c=d.length;e<c;++e){var b=d[e];a=Math.max(b.length,a)}return a},isNumbericStr:function(c){var b=Number(c);return !isNaN(b)},splitIndexEndingStr:function(b){var e=b.length-1;var d=b.charAt(e);var a="";while(d&&Kekule.StrUtils.isNumbericStr(d)){--e;a=d+a;d=b.charAt(e)}return a?{prefix:b.substring(0,e+1),index:parseInt(a)}:null}};Kekule.RoleMapUtils={KEY_ITEM:"item",KEY_ROLE:"role",NON_EXPLICIT_ROLE:null,createMap:function(b,c){var a={};c=c||Kekule.RoleMapUtils.NON_EXPLICIT_ROLE;a[Kekule.RoleMapUtils.KEY_ITEM]=b;a[Kekule.RoleMapUtils.KEY_ROLE]=c;return a},getItem:function(a){return a[Kekule.RoleMapUtils.KEY_ITEM]},setItem:function(b,a){b[Kekule.RoleMapUtils.KEY_ITEM]=a},getRole:function(a){return a[Kekule.RoleMapUtils.KEY_ROLE]},setRole:function(a,b){a[Kekule.RoleMapUtils.KEY_ROLE]=b}};Kekule.FactoryUtils={MATCH_EXACTLY:0,MATCH_BY_CLASS:1,DEF_ITEM_STORE_FIELD_NAME:"_items",createSimpleFactory:function(b){var c=Kekule.FactoryUtils;var a={_items:new Kekule.MapEx(true),_matchMethod:b||Kekule.FactoryUtils.MATCH_EXACTLY,register:function(d,e){a._items.set(d,e)},unregister:function(d){a._items.remove(d)},getClass:function(d){if(a._matchMethod===c.MATCH_EXACTLY){return a._items.get(d)}else{if(a._matchMethod===c.MATCH_BY_CLASS){var f=a._items.get(d);if(!f){var e=ClassEx.getSuperClass(d);if(e){f=a.getClass(e)}}return f}}},getInstance:function(m,n,l,j,i,h,g,f,e,d){var k=a.getClass(m);if(k){return new k(n,l,j,i,h,g,f,e,d)}}};return a}};Kekule.UrlUtils={EXT_DELIMITER:".",PATH_DELIMITER:"/",SEARCH_DELIMITER:"?",SEARCH_PAIR_DELIMITER:"&",KEY_VALUE_DELIMITER:"=",HASH_DELIMITER:"#",extractFileName:function(a){if(!a){return null}var b=a.lastIndexOf(Kekule.UrlUtils.PATH_DELIMITER);if(b>=0){return a.substr(b+1)}else{return a}},extractFileExt:function(a){var c=Kekule.UrlUtils.extractFileName(a);if(c){var b=c.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);if(b>=0){return c.substr(b+1)}else{return""}}else{return null}},extractFileCoreName:function(a){var c=Kekule.UrlUtils.extractFileName(a);if(c){var b=c.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);if(b>=0){return c.substr(0,b)}else{return""}}else{return null}},extractSearch:function(a){if(!a){return null}var b=a.lastIndexOf(Kekule.UrlUtils.SEARCH_DELIMITER);if(b>=0){return a.substr(b)}else{return null}},analysisSearch:function(b,e){var j=Kekule.UrlUtils.extractSearch(b)||"";j=j.substr(1);var c=j.split(Kekule.UrlUtils.SEARCH_PAIR_DELIMITER);var k=e?{}:[];for(var g=0,d=c.length;g<d;++g){var f=c[g];var h=f.split(Kekule.UrlUtils.KEY_VALUE_DELIMITER);if(h[0]){if(e){k[h[0]]=h[1]}else{k.push({key:h[0],value:h[1]})}}}return k},generateSearchString:function(h){var b=Kekule.UrlUtils;var g=[];var e=Kekule.ObjUtils.getOwnedFieldNames(h);for(var d=0,a=e.length;d<a;++d){var c=e[d];var f=h[c];if(Kekule.ObjUtils.notUnset(f)){var f=encodeURIComponent(""+f);g.push(c+b.KEY_VALUE_DELIMITER+f)}}return g.join(b.SEARCH_PAIR_DELIMITER)},generateUrl:function(d,f,e){var c=Kekule.UrlUtils;var b=d;if(f){var a=c.generateSearchString(f);b+=c.SEARCH_DELIMITER+a}if(e){b+=c.HASH_DELIMITER+e}return b}};Kekule.MatrixUtils={create:function(n,q,h){var s=false;var p=false;var o=Kekule.ObjUtils;if(o.notUnset(h)){s=true;if(Kekule.ArrayUtils.isArray(h)){p=true}}var g=0;var b=new Array(n);for(var f=0,c=b.length;f<c;++f){var a=new Array(q);if(s){for(var e=0,d=a.length;e<d;++e){if(p&&o.notUnset(h[g])){a[e]=h[g];++g}else{a[e]=h}}}b[f]=a}return b},createIdentity:function(b){var a=Kekule.MatrixUtils.create(b,b,0);for(var c=0;c<b-1;++c){a[c][c]=1}return a},getRowCount:function(a){return a.length},getColCount:function(a){return(Kekule.MatrixUtils.getRowCount(a)>0)?a[0].length:0},getValue:function(a,c,b){return a[c-1][b-1]||0},setValue:function(a,d,b,c){a[d-1][b-1]=c},transpose:function(b){var h=Kekule.MatrixUtils;var c=h.getColCount(b);var g=h.getRowCount(b);var a=h.create(c,g);for(var e=1;e<=c;++e){var f=a[e-1];for(var d=1;d<=g;++d){f[d-1]=h.getValue(b,d,e)}}return a},minus:function(g){var e=Kekule.MatrixUtils;var f=e.getRowCount(g);var h=e.getColCount(g);var k=this.create(f,h);for(var d=0;d<f;++d){var a=k[d];var b=g[d];for(var c=0;c<h;++c){a[c]=-(b[c]||0)}}return k},add:function(e,c){var h=Kekule.MatrixUtils;var b=h.getRowCount(e);var g=h.getColCount(e);var a=this.create(b,g);for(var f=1;f<=b;++f){for(var d=1;d<=g;++d){h.setValue(a,f,d,h.getValue(e,f,d)+h.getValue(c,f,d))}}return a},substract:function(b,a){var c=Kekule.MatrixUtils;return c.add(b,c.minus(a))},multiply:function(l,h){var e=Kekule.MatrixUtils;var f=e.getRowCount(l);var g=e.getColCount(h);var m=e.create(f,g);for(var c=1;c<=f;++c){for(var b=1;b<=g;++b){var d=0;for(var a=1;a<=f;++a){d+=e.getValue(l,c,a)*e.getValue(h,a,b)}e.setValue(m,c,b,d)}}return m}};Kekule.CoordUtils={create:function(b,d,c){var a={x:b,y:d};if(c||(c===0)){a.z=c}return a},clone:function(b){var a={x:b.x,y:b.y};if(b.z||(b.z===0)){a.z=b.z}return a},is3D:function(a){return(a.z||(a.z===0))},isEqual:function(c,b){var a=(c.x===b.x)&&(c.y===b.y);var d=Kekule.ObjUtils;if(a&&(d.notUnset(c.z)||d.notUnset(b.z))){a=(c.z===b.z)}return a},isZero:function(c,b){var a=Kekule.ObjUtils.notUnset(b)?b:0;return(Math.abs(c.x||0)<=a)&&(Math.abs(c.y||0)<=a)&&(Math.abs(c.z||0)<=a)},absValue:function(b){if(b){var a={};if(!Kekule.ObjUtils.isUnset(b.x)){a.x=Math.abs(b.x)}if(!Kekule.ObjUtils.isUnset(b.y)){a.y=Math.abs(b.y)}if(!Kekule.ObjUtils.isUnset(b.z)){a.z=Math.abs(b.z)}return a}},add:function(c,b){var a={};if(!(Kekule.ObjUtils.isUnset(c.x)&&(Kekule.ObjUtils.isUnset(b.x)))){a.x=(c.x||0)+(b.x||0)}if(!(Kekule.ObjUtils.isUnset(c.y)&&(Kekule.ObjUtils.isUnset(b.y)))){a.y=(c.y||0)+(b.y||0)}if(!(Kekule.ObjUtils.isUnset(c.z)&&(Kekule.ObjUtils.isUnset(b.z)))){a.z=(c.z||0)+(b.z||0)}return a},substract:function(c,b){var a={};if(!(Kekule.ObjUtils.isUnset(c.x)&&(Kekule.ObjUtils.isUnset(b.x)))){a.x=(c.x||0)-(b.x||0)}if(!(Kekule.ObjUtils.isUnset(c.y)&&(Kekule.ObjUtils.isUnset(b.y)))){a.y=(c.y||0)-(b.y||0)}if(!(Kekule.ObjUtils.isUnset(c.z)&&(Kekule.ObjUtils.isUnset(b.z)))){a.z=(c.z||0)-(b.z||0)}return a},multiply:function(c,b){var a={};if(!Kekule.ObjUtils.isUnset(c.x)){a.x=c.x*b}if(!Kekule.ObjUtils.isUnset(c.y)){a.y=c.y*b}if(!Kekule.ObjUtils.isUnset(c.z)){a.z=c.z*b}return a},divide:function(b,a){return Kekule.CoordUtils.multiply(b,1/a)},standardize:function(b){var a=Math.sqrt(Math.sqr(b.x||0)+Math.sqr(b.y||0)+Math.sqr(b.z||0));return Kekule.CoordUtils.divide(b,a||1)},toArray:function(b){var a=[];a.push(b.x,b.y);if(Kekule.CoordUtils.is3D(b)){a.push(b.z)}},transform2D:function(d,c){var b=Kekule.CoordUtils.calcTransform2DMatrix(c);var a=Kekule.CoordUtils.transform2DByMatrix(d,b);return a},inverseTransform2D:function(d,c){var b=Kekule.CoordUtils.calcInverseTransform2DMatrix(c);var a=Kekule.CoordUtils.transform2DByMatrix(d,b);return a},transform2DByMatrix:function(d,b){var c=Kekule.MatrixUtils;var a=c.create(3,1,[d.x||0,d.y||0,1]);a=c.multiply(b,a);return{x:a[0][0],y:a[1][0]}},calcTransform2DMatrix:function(c,d){var i=Kekule.MatrixUtils;var j=c||{};var p=j.center;if(p){var q=i.create(3,3,[1,0,-(p.x||0),0,1,-(p.y||0),0,0,1]);var h=i.create(3,3,[1,0,(p.x||0),0,1,(p.y||0),0,0,1])}if(j.rotateAngle){var r=j.rotateAngle;var o=Math.cos(r);var f=Math.sin(r);var b=i.create(3,3,[o,-f,0,f,o,0,0,0,1])}var t=j.scale;var n=j.scaleX;var m=j.scaleY;var l=t||1;if(t||n||m){var e=i.create(3,3);i.setValue(e,1,1,n||l);i.setValue(e,2,2,m||l);i.setValue(e,3,3,1)}var u=j.translateX;var s=j.translateY;if(u||s){var k=i.create(3,3);i.setValue(k,1,1,1);i.setValue(k,2,2,1);i.setValue(k,3,3,1);i.setValue(k,1,3,(u||0));i.setValue(k,2,3,(s||0))}var g=i.create(3,3,[1,0,0,0,1,0,0,0,1]);if(!d){if(q){g=i.multiply(q,g)}if(b){g=i.multiply(b,g)}if(e){g=i.multiply(e,g)}if(k){g=i.multiply(k,g)}if(h){g=i.multiply(h,g)}}else{if(q){g=i.multiply(q,g)}if(k){g=i.multiply(k,g)}if(e){g=i.multiply(e,g)}if(b){g=i.multiply(b,g)}if(h){g=i.multiply(h,g)}}return g},calcInverseTransform2DMatrix:function(a){var b=Object.create(a);if(a.center){b.center={x:a.center.x,y:a.center.y}}if(b.scale){b.scale=1/b.scale}if(b.scaleX){b.scaleX=1/b.scaleX}if(b.scaleY){b.scaleY=1/b.scaleY}if(b.translateX){b.translateX=-b.translateX}if(b.translateY){b.translateY=-b.translateY}if(b.rotateAngle){b.rotateAngle=-b.rotateAngle}return Kekule.CoordUtils.calcTransform2DMatrix(b,true)},transform3D:function(c,b){var a=Kekule.CoordUtils.calcTransform3DMatrix(b);return Kekule.CoordUtils.transform3DByMatrix(c,a)},transform3DByMatrix:function(d,b){var c=Kekule.MatrixUtils;var a=c.create(4,1,[d.x||0,d.y||0,d.z||0,1]);a=c.multiply(b,a);return{x:a[0][0],y:a[1][0],z:a[2][0]}},_calcRotateXYZ3DMatrixCore:function(b){var m=Kekule.MatrixUtils;var o=m.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var q=[];if(b.rotateAngle&&b.rotateAxisVector){var n=Kekule.CoordUtils.standardize(b.rotateAxisVector);q.push({vector:[n.x,n.y,n.z],angle:-b.rotateAngle})}else{var f=b.rotateX;var e=b.rotateY;var d=b.rotateZ;if(f){q.push({vector:[1,0,0],angle:-f})}if(e){q.push({vector:[0,1,0],angle:-e})}if(d){q.push({vector:[0,0,1],angle:-d})}}for(var u=0,r=q.length;u<r;++u){var a=m.create(4,4);var w=q[u].angle;var g=q[u].vector;var x=Math.cos(w);var c=Math.sin(w);var p;for(var u=1;u<=4;++u){for(var t=1;t<=4;++t){if((u<4)&&(t<4)){for(var s=1;s<=3;++s){if((s!==u)&&(s!==t)){break}}var h=g[u-1]*g[t-1];p=(u<t)?h*(1-x)-Math.pow(-1,u+t)*g[s-1]*c:(u>t)?h*(1-x)+Math.pow(-1,u+t)*g[s-1]*c:h+(1-h)*x}else{if(u===t){p=1}else{p=0}}m.setValue(a,u,t,p)}}o=m.multiply(a,o)}return o},calcRotate3DMatrix:function(d){var g=Kekule.MatrixUtils;var f=Object.create(d||{});var e;if(f.rotateMatrix){e=f.rotateMatrix}else{var a=f.center;if(a){var b=g.create(4,4,[1,0,0,-(a.x||0),0,1,0,-(a.y||0),0,0,1,-(a.z||0),0,0,0,1]);var c=g.create(4,4,[1,0,0,(a.x||0),0,1,0,(a.y||0),0,0,1,(a.z||0),0,0,0,1])}var e=Kekule.CoordUtils._calcRotateXYZ3DMatrixCore(d);if(b){e=g.multiply(b,e)}if(c){e=g.multiply(c,e)}}return e},calcTransform3DMatrix:function(b){var g=Kekule.MatrixUtils;var h=b||{};var o=h.center;if(o){var p=g.create(4,4,[1,0,0,-(o.x||0),0,1,0,-(o.y||0),0,0,1,-(o.z||0),0,0,0,1]);var e=g.create(4,4,[1,0,0,(o.x||0),0,1,0,(o.y||0),0,0,1,(o.z||0),0,0,0,1])}var f=["rotateX","rotateY","rotateZ","rotateAngle","rotateAxisVector","rotateMatrix"];var k=Object.copyValues({},h,f);var a=Kekule.CoordUtils.calcRotate3DMatrix(k);var r=h.scale;var n=h.scaleX;var m=h.scaleY;var l=h.scaleZ;if(r||n||m||l){var j=r||1;var c=g.create(4,4);g.setValue(c,1,1,n||j);g.setValue(c,2,2,m||j);g.setValue(c,3,3,l||j);g.setValue(c,4,4,1)}var t=h.translateX;var s=h.translateY;var q=h.translateZ;if(t||s||q){var i=g.create(4,4);g.setValue(i,1,1,1);g.setValue(i,2,2,1);g.setValue(i,3,3,1);g.setValue(i,4,4,1);g.setValue(i,1,4,t||0);g.setValue(i,2,4,s||0);g.setValue(i,3,4,q||0)}var d=g.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(p){d=g.multiply(p,d)}if(a){d=g.multiply(a,d)}if(c){d=g.multiply(c,d)}if(i){d=g.multiply(i,d)}if(e){d=g.multiply(e,d)}return d},calcInverseTransform3DMatrix:function(a){var b=Object.create(a);if(a.center){b.center={x:a.center.x,y:a.center.y,z:a.center.z}}if(b.scale){b.scale=1/b.scale}if(b.scaleX){b.scaleX=1/b.scaleX}if(b.scaleY){b.scaleY=1/b.scaleY}if(b.scaleZ){b.scaleZ=1/b.scaleZ}if(b.translateX){b.translateX=-b.translateX}if(b.translateY){b.translateY=-b.translateY}if(b.translateZ){b.translateZ=-b.translateZ}if(b.rotateAngle){b.rotateAngle=-b.rotateAngle}if(b.rotateX){b.rotateX=-b.rotateX}if(b.rotateX){b.rotateY=-b.rotateY}if(b.rotateZ){b.rotateZ=-b.rotateZ}return Kekule.CoordUtils.calcTransform3DMatrix(b,true)},calcCoordGroup2DTransformParams:function(e,c,l,k){var m=Kekule.CoordUtils;var d=m.getDistance(e,c);var i=m.substract(c,e);var g=Math.atan2(i.y,i.x);var f=m.getDistance(l,k);var b=m.substract(k,l);var h=Math.atan2(b.y,b.x);var a=m.substract(l,e);var j={translateX:a.x,translateY:a.y,scale:f/d,rotateAngle:h-g,center:e};return j},getDistance:function(c,b){if(!b){b={x:0,y:0,z:0}}var a=Math.sqr(b.x-c.x)+Math.sqr(b.y-c.y);if(Kekule.ObjUtils.notUnset(c.z)&&Kekule.ObjUtils.notUnset(b.z)){a+=Math.sqr(b.z-c.z)}return Math.sqrt(a)},getCenter:function(d){var c=d.length;if(c<=0){return null}var b=Object.extend(d[0]);for(var a=1;a<c;++a){b=Kekule.CoordUtils.add(b,d[a])}return Kekule.CoordUtils.divide(b,c)},insideRect:function(c,a,b){return((c.x-a.x)*(c.x-b.x)<=0)&&((c.y-a.y)*(c.y-b.y)<=0)},isInsideBox:function(e,d){var c=d;var a=(Math.sign(e.x-c.x1)*Math.sign(e.x-c.x2)<=0)&&(Math.sign(e.y-c.y1)*Math.sign(e.y-c.y2)<=0);if(Kekule.ObjUtils.notUnset(e.z)){a=a&&(Math.sign(e.z-c.z1)*Math.sign(e.z-c.z2)<=0)}return a},getContainerBox:function(d){var f={};var a={};var b=d.length;if(b>0){f=Kekule.CoordUtils.clone(d[0]);a=Kekule.CoordUtils.clone(d[0])}else{return null}for(var c=1;c<b;++c){var e=d[c];f.x=Math.min(f.x,e.x);f.y=Math.min(f.y,e.y);a.x=Math.max(a.x,e.x);a.y=Math.max(a.y,e.y);if(Kekule.ObjUtils.notUnset(f.z)){f.z=Math.min(f.z,e.z);a.z=Math.max(a.z,e.z)}}return Kekule.BoxUtils.createBox(f,a)}};Kekule.GeometryUtils={standardizeAngle:function(c,d,a){d=d||0;var a=d+Math.PI*2;var b=Math.floor((c-d)/Math.PI/2);return c-b*Math.PI*2},getVectorScalarProduct:function(c,b){var a=(c.x||0)*(b.x||0)+(c.y||0)*(b.y||0)+(c.z||0)*(b.z||0);return a},getVectorCrossProduct:function(c,b){var a={x:(c.y||0)*(b.z||0)-(c.z||0)*(b.y||0),y:(c.z||0)*(b.x||0)-(c.x||0)*(b.z||0),z:(c.x||0)*(b.y||0)-(c.y||0)*(b.x||0)};return a},getVectorIncludedAngle:function(e,d){var c=Kekule.CoordUtils;var h=Kekule.GeometryUtils.getVectorCrossProduct(e,d);var g={x:0,y:0,z:0};var b=(c.getDistance(e,g)*c.getDistance(d,g));var f=c.getDistance(h,g)/b;var a=Math.asin(f);return a},getVectorIncludedAngle2:function(b,a){return Kekule.GeometryUtils.standardizeAngle(Math.atan2(a.y,a.x)-Math.atan2(b.y,b.x))},getDihedralAngleOfVectors:function(j,i,g){var m=Kekule.CoordUtils;var b=Kekule.GeometryUtils;var k=b.getVectorCrossProduct(j,i);var a=b.getVectorCrossProduct(i,g);var e=m.getDistance(i)/100000;if(m.isZero(k,e)||m.isZero(a,e)){return -1}var c=m.standardize(i);var f=b.getVectorScalarProduct(b.getVectorCrossProduct(k,a),c);var h=b.getVectorScalarProduct(k,a);var l=Math.atan2(f,h);if(l<0){l+=Math.PI*2}return l},getDihedralAngleOfPoints:function(e,d,b,a){var c=Kekule.CoordUtils;var h=c.substract(d,e);var g=c.substract(b,d);var f=c.substract(a,b);return Kekule.GeometryUtils.getDihedralAngleOfVectors(h,g,f)},getPerpendicularCrossPointFromCoordToLine:function(h,d,b,f){var a={};if(Math.abs(d.x-b.x)<1e-10){a.x=d.x;a.y=h.y}else{var e=(b.y-d.y)/(b.x-d.x);a.x=(e*e*d.x+e*(h.y-d.y)+h.x)/(e*e+1);a.y=e*(a.x-d.x)+d.y}var g;if(f){g=true}else{var c={x:d.x-b.x,y:d.y-b.y};if(Math.abs(c.y)>Math.abs(c.x)){g=(Math.sign(a.y-d.y)*Math.sign(a.y-b.y)<=0)}else{g=(Math.sign(a.x-d.x)*Math.sign(a.x-b.x)<=0)}}if(!g){return null}else{return a}},getDistanceFromPointToLine:function(h,b,a,c){var d=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(h,b,a,c);if(!d){var f=Kekule.CoordUtils.getDistance(h,b);var e=Kekule.CoordUtils.getDistance(h,a);return Math.min(f,e)}else{var g=Kekule.CoordUtils.getDistance(h,d);return g}},getCrossPointOfLines:function(d,c,b,a){var j=(d.x-b.x)*(c.y-b.y)-(d.y-b.y)*(c.x-b.x);var g=(d.x-a.x)*(c.y-a.y)-(d.y-a.y)*(c.x-a.x);if(j*g>=0){return null}var f=(b.x-d.x)*(a.y-d.y)-(b.y-d.y)*(a.x-d.x);var e=f+j-g;if(f*e>=0){return null}var i=f/(g-j);var k=i*(c.x-d.x),h=i*(c.y-d.y);return{x:d.x+k,y:d.y+h}},simplifyCurveToLineSegments:function(b,a){if(!a){return b}if(b.length<=2){return Kekule.ArrayUtils.clone(b)}return Kekule.GeometryUtils._simplifyCurvePartToLineSegments(b,0,b.length-1,a)},_simplifyCurvePartToLineSegments:function(e,n,j,g){var l=Kekule.GeometryUtils;var o=e[n];var k=e[j];if(j-n<=1){return[o,k]}var b=g,f=null;for(var h=n+1;h<j;++h){var m=Kekule.GeometryUtils.getDistanceFromPointToLine(e[h],o,k);if(m>b){b=m;f=h}}if(f===null){return[o,k]}else{var c=l._simplifyCurvePartToLineSegments(e,n,f,g);var a=l._simplifyCurvePartToLineSegments(e,f,j,g);a.shift();var p=[].concat(c).concat(a);return p}}};Kekule.BoxUtils={createBox:function(g,f){var a={};var c=g.x||0;var e=g.y||0;var b=f.x||0;var d=f.y||0;(c<=b)?(a.x1=c,a.x2=b):(a.x1=b,a.x2=c);(e<=d)?(a.y1=e,a.y2=d):(a.y1=d,a.y2=e);if(Kekule.ObjUtils.notUnset(g.z)&&Kekule.ObjUtils.notUnset(f.z)){(g.z<=f.z)?(a.z1=g.z,a.z2=f.z):(a.z1=f.z,a.z2=g.z)}return a},clone:function(b){var a={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2};if(Kekule.ObjUtils.notUnset(b.z1)&&Kekule.ObjUtils.notUnset(b.z2)){a.z1=b.z1;a.z2=b.z2}return a},convertToRect:function(c){var a=Kekule.BoxUtils.normalize(c);return Kekule.RectUtils.createRect(a.x1,a.y1,a.x2-a.x1,a.y2-a.y1)},normalize:function(b){var a={x1:Math.min(b.x1,b.x2),y1:Math.min(b.y1,b.y2),x2:Math.max(b.x1,b.x2),y2:Math.max(b.y1,b.y2)};if(Kekule.ObjUtils.notUnset(b.z1)&&Kekule.ObjUtils.notUnset(b.z2)){a.z1=Math.min(b.z1,b.z2);a.z2=Math.max(b.z1,b.z2)}return a},shiftBox:function(d,c,b,a){var j=c||0;var h=b||0;var g=a||0;var f={x:d.x1+j,y:d.y1+h};var e={x:d.x2+j,y:d.y2+h};if(Kekule.ObjUtils.notUnset(d.z1)&&Kekule.ObjUtils.notUnset(d.z2)){f.z=d.z1+g;e.z=d.z2+g}var i=Kekule.BoxUtils.createBox(f,e);return i},inflateBox:function(c,e,d,b){if(Kekule.ObjUtils.isUnset(d)){d=e}if(Kekule.ObjUtils.isUnset(b)){b=e}var a=Kekule.BoxUtils.normalize(c);var a={x1:a.x1-e,y1:a.y1-d,x2:a.x2+e,y2:a.y2+d};if(Kekule.ObjUtils.notUnset(a.z1)&&Kekule.ObjUtils.notUnset(a.z2)){a.z1=a.z1-b;a.z2=a.z2+b}return a},getContainerBox:function(d,b){if(!d){return Kekule.BoxUtils.clone(b)}else{if(!b){return Kekule.BoxUtils.clone(d)}}var e=Kekule.BoxUtils.normalize(d);var c=Kekule.BoxUtils.normalize(b);var a={x1:Math.min(e.x1,c.x1),y1:Math.min(e.y1,c.y1),x2:Math.max(e.x2,c.x2),y2:Math.max(e.y2,c.y2)};if(Kekule.ObjUtils.notUnset(e.z1)&&Kekule.ObjUtils.notUnset(e.z2)&&Kekule.ObjUtils.notUnset(c.z1)&&Kekule.ObjUtils.notUnset(c.z2)){a.z1=Math.min(e.z1,c.z1);a.z2=Math.max(e.z2,c.z2)}return a},getIntersection:function(c,a){var d=Kekule.BoxUtils.normalize(c);var b=Kekule.BoxUtils.normalize(a);var e={x1:Math.max(d.x1,b.x1),y1:Math.max(d.y1,b.y1),x2:Math.min(d.x2,b.x2),y2:Math.min(d.y2,b.y2)};if((e.x1>e.x2)||(e.y1>e.y2)){return null}if(Kekule.ObjUtils.notUnset(d.z1)&&Kekule.ObjUtils.notUnset(d.z2)&&Kekule.ObjUtils.notUnset(b.z1)&&Kekule.ObjUtils.notUnset(b.z2)){e.z1=Math.max(d.z1,b.z1);e.z2=Math.min(d.z2,b.z2);if(e.z1>e.z2){return null}}return e},hasIntersection:function(b,a){return !!Kekule.BoxUtils.getIntersection(b,a)},isEqual:function(b,a){return(Math.min(b.x1,b.x2)===Math.min(a.x1,a.x2))&&(Math.max(b.x1,b.x2)===Math.max(a.x1,a.x2))&&(Math.min(b.y1,b.y2)===Math.min(a.y1,a.y2))&&(Math.max(b.y1,b.y2)===Math.max(a.y1,a.y2))},isInside:function(a,c){var d=a;var b=c;return(Math.min(d.x1,d.x2)>=Math.min(b.x1,b.x2))&&(Math.max(d.x1,d.x2)<=Math.max(b.x1,b.x2))&&(Math.min(d.y1,d.y2)>=Math.min(b.y1,b.y2))&&(Math.max(d.y1,d.y2)<=Math.max(b.y1,b.y2))},getCenterCoord:function(b){var a={x:(b.x1||0+b.x2||0)/2,y:(b.y1||0+b.y2||0)/2};if(Kekule.ObjUtils.notUnset(b.z1)||Kekule.ObjUtils.notUnset(b.z2)){a.z=(b.z1||0+b.z2||0)/2}return a},getMinMaxCoords:function(d){var c=Kekule.BoxUtils.normalize(d);var a={min:{x:c.x1,y:c.y1},max:{x:c.x2,y:c.y2}};if(Kekule.ObjUtils.notUnset(c.z1)){a.min.z=c.z1;a.max.z=c.z2}return a},getCornerCoords:function(c){var a=Kekule.BoxUtils.normalize(c);if(Kekule.ObjUtils.isUnset(a.z1)){return[{x:a.x1,y:a.y1},{x:a.x1,y:a.y2},{x:a.x2,y:a.y1},{x:a.x2,y:a.y2}]}else{return[{x:a.x1,y:a.y1,z:a.z1},{x:a.x1,y:a.y2,z:a.z1},{x:a.x2,y:a.y1,z:a.z1},{x:a.x2,y:a.y2,z:a.z1},{x:a.x1,y:a.y1,z:a.z2},{x:a.x1,y:a.y2,z:a.z2},{x:a.x2,y:a.y1,z:a.z2},{x:a.x2,y:a.y2,z:a.z2}]}},transform2D:function(e,b){var f=Kekule.BoxUtils.getCornerCoords(e);var d=[];for(var c=0,a=f.length;c<a;++c){d.push(Kekule.CoordUtils.transform2D(f[c],b))}return Kekule.CoordUtils.getContainerBox(d)},transform3D:function(e,b){var f=Kekule.BoxUtils.getCornerCoords(e);var d=[];for(var c=0,a=f.length;c<a;++c){d.push(Kekule.CoordUtils.transform3D(f[c],b))}return Kekule.CoordUtils.getContainerBox(d)}};Kekule.RectUtils={createRect:function(e,d,c,b){var a={left:e,top:d,width:c,height:b};return a},clone:function(a){return{left:a.left,top:a.top,width:a.width,height:a.height}},isZero:function(a){return(a.width===0)&&(a.height===0)},convertToBox:function(b){var c=Kekule.CoordUtils.create(b.left,b.top);var a=Kekule.CoordUtils.create(b.left+b.width,b.top+b.height);return Kekule.BoxUtils.createBox(c,a)},inflateRect:function(d,c,b){if(Kekule.ObjUtils.isUnset(b)){b=c}var a=Kekule.RectUtils.createRect(d.left,d.top,d.width+c,d.height+b);return a},shiftRect:function(f,d,b){var e=d||0;var c=b||0;var a=Kekule.RectUtils.createRect(f.left+e,f.top+c,f.width,f.height);return a},getContainerRect:function(d,b){var e=Kekule.RectUtils.convertToBox(d);var c=Kekule.RectUtils.convertToBox(b);var a=Kekule.BoxUtils.getContainerBox(e,c);return Kekule.BoxUtils.convertToRect(a)},getIntersection:function(d,b){var e=Kekule.RectUtils.convertToBox(d);var c=Kekule.RectUtils.convertToBox(b);var a=Kekule.BoxUtils.getIntersection(e,c);return a?Kekule.BoxUtils.convertToRect(a):null},hasIntersection:function(b,a){return !!Kekule.RectUtils.getIntersection(b,a)}};Kekule.ZoomUtils={PREDEFINED_ZOOM_RATIOS:[0.1,0.3,0.5,0.66,0.8,0.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5,7,10,15,20],getNearestZoomLevel:function(b,d){var c=d||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS;var a=c.length;if(b>c[a-1]){return c[a-1]}else{if(b<c[0]){return c[0]}else{for(var e=0;e<a-1;++e){var h=c[e];var g=c[e+1];if(b>=h&&b<=g){if(h===1||g===1){return 1}var f=(b-h)/(g-h);return(f<=0.5)?h:g}}}}},getNextZoomInRatio:function(b,f,d){if(!f){f=1}var c=d||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS;var a=c.length;if(b<c[a-1]){for(var e=0;e<a;++e){if(c[e]>b){return c[Math.min(e+f,a)-1]}}}return b},getNextZoomOutRatio:function(b,f,d){if(!f){f=1}var c=d||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS;var a=c.length;if(b>c[0]){for(var e=a-1;e>=0;--e){if(c[e]<b){return c[Math.max(e-f+1,0)]}}}return b}};Kekule.AbstractConfigs=Class.create(ObjectEx,{CLASS_NAME:"Kekule.AbstractConfigs",CONFIG_PROP_FLAG:"__$config_prop__",initialize:function($super,a){$super();if(typeof(a)=="undefined"){a=true}if(a){this.initPropDefValues()}},addConfigProp:function(e,c,b,f){var d={dataType:c};if(f){d=Object.extend(d,f)}if(typeof(b)!="undefined"){d.defaultValue=b}var a=this.defineProp(e,d);a[this.CONFIG_PROP_FLAG]=true;return a},addHashConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.HASH,a,c)},addStrConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.STRING,a,c)},addNumConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.NUM,a,c)},addIntConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.INT,a,c)},addFloatConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.FLOAT,a,c)},addBoolConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.BOOL,a,c)},initPropDefValues:function(){this.beginUpdate();try{var c=this.getAllPropList();for(var b=0,a=c.getLength();b<a;++b){var f=c.getPropInfoAt(b);var e=f.name;var d=f.defaultValue;if(typeof(d)!="undefined"){this.setPropValue(e,d)}}}finally{this.endUpdate()}},assign:function(a){a.copyPropsTo(this)},toHash:function(){var b={};var a=this.CONFIG_PROP_FLAG;this.saveObj(b,"json",{saveDefaultValues:true,propFilter:function(d,c){return d[a]}});return b}});Kekule.ConfigPresetMap=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ConfigPresetMap",initialize:function($super){$super();this.map=new Kekule.MapEx(true)},doFinalize:function($super){this.map=null;$super()},set:function(a,b){this.map.set(a,b)},get:function(a){return this.map.get(a)},getHash:function(a){var b=this.get(a);if(b){if(b.toHash){return b.toHash()}else{return b}}else{return null}},remove:function(a){this.map.remove(a)},has:function(a){return this.map.has(a)},clear:function(){this.map.clear()}});Kekule.ElementSeries={NONMETAL:"Nonmetals",METAL:"Metals",ALKALI_METAL:"Alkali Metals",ALKALI_EARTH_METAL:"Alkali Earth Metals",TRANSITION_METAL:"Transition Metals",METALLOID:"Metalloids",HALOGEN:"Halogens",NOBLE_GAS:"Noble Gases",LANTHANIDE:"Lanthanides",ACTINIDE:"Actinides"};Kekule.Element=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Element",initialize:function($super,a){$super();if(a!=Kekule.Element.UNSET_ELEMENT){var b=this.getElementInfo(a);if(b){this.setPropStoreFieldValue("symbol",b.symbol);this.setPropStoreFieldValue("atomicNumber",b.atomicNumber);this.setPropStoreFieldValue("group",b.group);this.setPropStoreFieldValue("period",b.period);this.setPropStoreFieldValue("series",b.chemicalSerie);this.setPropStoreFieldValue("naturalMass",b.naturalMass);if(b.name){this.setPropStoreFieldValue("name",b.name)}}else{Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.INVALID_CHEMELEMENT")+": "+a:"Invalid chemical element: "+a)}}else{this.setPropStoreFieldValue("symbol",Kekule.Element.UNSET_ELEMENT);this.setPropStoreFieldValue("atomicNumber",Kekule.Element.UNSET_ELEMENT)}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,serializable:false,setter:null});this.defineProp("atomicNumber",{dataType:DataType.INT,serializable:false,setter:null});this.defineProp("symbol",{dataType:DataType.STRING,serializable:false,setter:null});this.defineProp("group",{dataType:DataType.INT,serializable:false,setter:null});this.defineProp("period",{dataType:DataType.INT,serializable:false,setter:null});this.defineProp("series",{dataType:DataType.STRING,serializable:false,setter:null});this.defineProp("naturalMass",{dataType:DataType.FLOAT,serializable:false,setter:null})},getElementInfo:function(a){if(a==Kekule.Element.UNSET_ELEMENT){return{symbol:Kekule.Element.UNSET_ELEMENT,atomicNumber:Kekule.Element.UNSET_ELEMENT}}if(Kekule.Element.isDummyElement(a)){return{symbol:Kekule.Element.DUMMY_ELEMENT,atomicNumber:Kekule.Element.DUMMY_ELEMENT_ATOMICNUM}}else{if(Kekule.Element.isRGroup(a)){return{symbol:Kekule.Element.RGROUP_ELEMENT,atomicNumber:Kekule.Element.RGROUP_ELEMENT_ATMOICNUM}}else{return Kekule.ChemicalElementsDataUtil.getElementInfo(a)}}},getTheoreticValence:function(){if(this.getGroup()){return Kekule.Element.getTheoreticValenceOfGroup(this.getGroup())}else{return null}},isDummyElement:function(){return this.getAtomicNumber()==Kekule.Element.DUMMY_ELEMENT_ATOMICNUM},isRGroupElement:function(){return this.getAtomicNumber()==Kekule.Element.RGROUP_ELEMENT_ATMOICNUM},isNormalElement:function(){return Kekule.Element.isNormalElement(this.getAtomicNumber())},isSameElement:function(a){if(a==Kekule.Element.UNSET_ELEMENT){return this.getAtomicNumber()==Kekule.Element.UNSET_ELEMENT}else{if(typeof(a)=="number"){return this.getAtomicNumber()==a}else{return this.getSymbol()==a}}},isHetero:function(){return((this.getSeries()===Kekule.ElementSeries.NONMETAL)||(this.getSeries()===Kekule.ElementSeries.HALOGEN))&&(this.getAtomicNumber()!==6)&&(this.getAtomicNumber()!==1)},getLabel:function(){return this.getSymbol()}});Object.extend(Kekule.Element,Kekule.ChemicalElementsDataUtil);Kekule.Element.UNSET_ELEMENT=undefined;Kekule.Element.DUMMY_ELEMENT="DU";Kekule.Element.DUMMY_ELEMENT_ATOMICNUM=-1;Kekule.Element.RGROUP_ELEMENT="R";Kekule.Element.RGROUP_ELEMENT_ATOMICNUM=-2;Kekule.Element.DEUTERIUM="D";Kekule.Element.isNormalElement=function(a){return(a!=Kekule.Element.UNSET_ELEMENT)&&(!Kekule.Element.isPseudoElement(a))};Kekule.Element.isPseudoElement=function(a){if(typeof(a)=="string"){return(a==Kekule.Element.DUMMY_ELEMENT)||(a==Kekule.Element.RGROUP_ELEMENT)}else{return(a==Kekule.Element.DUMMY_ELEMENT_ATOMICNUM)||(a==Kekule.Element.RGROUP_ELEMENT_ATMOICNUM)}};Kekule.Element.isDummyElement=function(a){return(a===Kekule.Element.DUMMY_ELEMENT)||(a===Kekule.Element.DUMMY_ELEMENT_ATOMICNUM)};Kekule.Element.isRGroup=function(a){return(a===Kekule.Element.RGROUP_ELEMENT)||(a===Kekule.Element.RGROUP_ELEMENT_ATOMICNUM)};Kekule.Element.getTheoreticValenceOfGroup=function(a){if(a<=2){return a}else{if(a<=12){return null}else{if(a<=17){return a-10}else{return 0}}}};Kekule.Element.getTheoreticValence=function(a){var b=Kekule.ChemicalElementsDataUtil.getElementInfo(a);return b.group?Kekule.Element.getTheoreticValenceOfGroup(b.group):null};Object.extend(Kekule.Element,{isAtomicNumberAvailable:function(a){return Kekule.ChemicalElementsDataUtil.isAtomicNumberAvailable(a)},isElementSymbolAvailable:function(a){return Kekule.ChemicalElementsDataUtil.isElementSymbolAvailable(a)}});Kekule.Isotope=Class.create(Kekule.Element,{CLASS_NAME:"Kekule.Isotope",initialize:function($super,a,b){var f=a;var e=b;var d=Kekule.IsotopesDataUtil.getIsotopeInfo(a,b);if(d){if(d.atomicNumber){f=d.atomicNumber}e=d.massNumber}$super(f);this.setPropStoreFieldValue("massNumber",e);if(d&&d.isotopeAlias){this.setPropStoreFieldValue("isotopeAlias",d.isotopeAlias)}if(Kekule.Element.isNormalElement(f)&&(e!==Kekule.Isotope.UNSET_MASSNUMBER)){var c=Kekule.IsotopesDataUtil.getIsotopeInfo(this.getAtomicNumber(),e);if(c){this.setPropStoreFieldValue("exactMass",c.exactMass);this.setPropStoreFieldValue("naturalAbundance",c.naturalAbundance)}else{Kekule.chemError((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.INVALID_ISOTOPE"):"Invalid isotope")+": "+this.getSymbol()+"/"+b)}}},initProperties:function(){this.defineProp("massNumber",{dataType:DataType.INTEGER,serializable:false,setter:null});this.defineProp("exactMass",{dataType:DataType.FLOAT,serializable:false,setter:null});this.defineProp("naturalAbundance",{dataType:DataType.FLOAT,serializable:false,setter:null});this.defineProp("isotopeAlias",{dataType:DataType.STRING,serializable:false,setter:null})},isSame:function(a){if(a instanceof Kekule.Isotope){return(a===this)||((a.getAtomicNumber()==this.getAtomicNumber())&&(a.getMassNumber()==this.getMassNumber()))}return false},getIsotopeId:function(){return Kekule.IsotopesDataUtil.getIsotopeId(this.getAtomicNumber(),this.getMassNumber())},getLabel:function(){return""+(this.getMassNumber()||"")+this.getSymbol()}});Object.extend(Kekule.Isotope,Kekule.IsotopesDataUtil);Kekule.Isotope.UNSET_MASSNUMBER=undefined;Kekule.Isotope.getIsotopeId=function(a,b){return Kekule.IsotopesDataUtil.getIsotopeId(a,b)};Object.extend(Kekule.Isotope,{isMassNumberAvailable:function(a,b){return Kekule.IsotopesDataUtil.isMassNumberAvailable(a,b)}});Kekule.IsotopeFactory={GENERIC_ELEMENT_ID:"__GENERIC__",_isotopes:{},getIsotopeId:function(a,b){if(!a){return Kekule.IsotopeFactory.GENERIC_ELEMENT_ID}else{return Kekule.IsotopesDataUtil.getIsotopeId(a,b)}},getIsotope:function(a,b){var d=Kekule.IsotopeFactory.getIsotopeId(a,b);if(!Kekule.IsotopeFactory._isotopes[d]){var c=new Kekule.Isotope(a,b);Kekule.IsotopeFactory._isotopes[d]=c}return Kekule.IsotopeFactory._isotopes[d]},getIsotopeById:function(b){if(Kekule.IsotopeFactory._isotopes[b]){return Kekule.IsotopeFactory._isotopes[b]}else{var a=Kekule.IsotopesDataUtil.getIsotopeIdDetail(b);if(a){return Kekule.IsotopeFactory.getIsotope(a.symbol,a.massNumber)}else{return null}}}};Kekule.AtomType={UNSET_ATOMTYPE:undefined};Kekule.ElectronSet=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ElectronSet",initialize:function($super,a){$super();this.setElectronCount(a||Kekule.ElectronSet.UNSET_ELECTRONCOUNT)},initProperties:function(){this.defineProp("electronCount",{dataType:DataType.FLOAT})}});Kekule.ElectronSet.UNSET_ELECTRONCOUNT=null;Kekule.UnbondedElectronSet=Class.create(Kekule.ElectronSet,{CLASS_NAME:"Kekule.UnBondedElectronSet",initialize:function($super,a){$super(a)},initProperties:function(){}});Kekule.BondType={COVALENT:"covalent",IONIC:"ionic",COORDINATE:"coordinate",METALLIC:"metallic",HYDROGEN:"hydrogen",UNKNOWN:null,DEFAULT:"covalent"};Kekule.BondOrder={SINGLE:1,DOUBLE:2,TRIPLE:3,QUAD:4,EXPLICIT_AROMATIC:10,OTHER:20,UNSET:null,DEFAULT:1,getBondValence:function(a){if(a===Kekule.BondOrder.UNSET){return 0}else{if(a==Kekule.BondOrder.EXPLICIT_AROMATIC){return 1.5}else{return a}}}};Kekule.BondForm=Class.create(Kekule.ElectronSet,{CLASS_NAME:"Kekule.BondForm",initialize:function($super,b,c,a){$super(c);this.setBondOrder(b||Kekule.BondOrder.DEFAULT);if(Kekule.ObjUtils.notUnset(a)){this.setBondType(a)}if(Kekule.ObjUtils.notUnset(c)){this.setElectronCount(c)}},initProperties:function(){this.defineProp("bondType",{dataType:DataType.STRING,enumSource:Kekule.BondType,getter:function(){var a=this.getPropStoreFieldValue("bondType");return(a?a:Kekule.BondType.DEFAULT)}});this.defineProp("bondOrder",{dataType:DataType.FLOAT,enumSource:Kekule.BondOrder,setter:function(a){if(this.getPropStoreFieldValue("bondOrder")!=a){this.setPropStoreFieldValue("bondOrder",a);if(a){if(this.getBondType()==Kekule.BondType.COVALENT){this.setElectronCount(this.getBondValence()*2)}}else{if(a===Kekule.BondOrder.UNSET){this.setElectronCount(Kekule.ElectronSet.UNSET_ELECTRONCOUNT)}}}}});this.defineProp("electronCount",{dataType:DataType.FLOAT});this.defineProp("bondValence",{dataType:DataType.FLOAT,serializable:false,getter:function(){return Kekule.BondOrder.getBondValence(this.getBondOrder())},setter:null})}});Kekule.BondFormFactory={_bondForms:{},getBondFormId:function(c,d,b){var a="";if(b){a+=b+"_"}if(c){a+=Number(c).toString()}if(d){a+="_"+Number(d).toString()}return a},getBondForm:function(b,d,a){if((!b)&&(!d)&&(!a)){return undefined}if(!a){a=Kekule.BondType.DEFAULT}if((!d)&&(b)&&(a===Kekule.BondType.COVALENT)){var c=Kekule.BondOrder.getBondValence(b);d=c*2}var e=Kekule.BondFormFactory.getBondFormId(b,d,a);if(!Kekule.BondFormFactory._bondForms[e]){Kekule.BondFormFactory._bondForms[e]=new Kekule.BondForm(b,d,a)}return Kekule.BondFormFactory._bondForms[e]}};Kekule.RadicalOrder={NONE:0,SINGLET:1,DOUBLET:2,TRIPLET:3,DEFAULT:0,getRadicalElectronCount:function(a){var b=Kekule.RadicalOrder;if(Kekule.ObjUtils.isUnset(a)||(a===b.NONE)){return 0}else{if(a===b.DOUBLET){return 1}else{return 2}}}};Kekule.HybridizationType={UNKNOWN:null,SP:1,SP2:2,SP3:3,NONE:0};Kekule.ValenceUtils={getImplicitMdlValence:function(a,b,e){var c=b;var d=e;switch(a){case 1:case 3:case 11:case 19:case 37:case 55:case 87:if(c==0&&d<=1){return 1}break;case 4:case 12:case 20:case 38:case 56:case 88:switch(c){case 0:if(d<=2){return 2}break;case 1:if(d<=1){return 1}break}break;case 5:switch(c){case -4:if(d<=1){return 1}break;case -3:if(d<=2){return 2}break;case -2:if(d<=3){return 3}if(d<=5){return 5}break;case -1:if(d<=4){return 4}break;case 0:if(d<=3){return 3}break;case 1:if(d<=2){return 2}break;case 2:if(d<=1){return 1}break}break;case 6:switch(c){case -3:if(d<=1){return 1}break;case -2:if(d<=2){return 2}break;case -1:if(d<=3){return 3}if(d<=5){return 5}break;case 0:if(d<=4){return 4}break;case 1:if(d<=3){return 3}break;case 2:if(d<=2){return 2}break;case 3:if(d<=1){return 1}break}break;case 7:switch(c){case -2:if(d<=1){return 1}break;case -1:if(d<=2){return 2}break;case 0:if(d<=3){return 3}if(d<=5){return 5}break;case 1:if(d<=4){return 4}break;case 2:if(d<=3){return 3}break;case 3:if(d<=2){return 2}break;case 4:if(d<=1){return 1}break}break;case 8:switch(c){case -1:if(d<=1){return 1}break;case 0:if(d<=2){return 2}break;case 1:if(d<=3){return 3}if(d<=5){return 5}break;case 2:if(d<=4){return 4}break;case 3:if(d<=3){return 3}break;case 4:if(d<=2){return 2}break;case 5:if(d<=1){return 1}break}break;case 9:switch(c){case 0:if(d<=1){return 1}break;case 1:if(d<=2){return 2}break;case 2:if(d<=3){return 3}if(d<=5){return 5}break;case 3:if(d<=4){return 4}break;case 4:if(d<=3){return 3}break;case 5:if(d<=2){return 2}break;case 6:if(d<=1){return 1}break}break;case 13:switch(c){case -4:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -3:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -2:if(d<=3){return 3}if(d<=5){return 5}break;case -1:if(d<=4){return 4}break;case 0:if(d<=3){return 3}break;case 1:if(d<=2){return 2}break;case 2:if(d<=1){return 1}break}break;case 14:switch(c){case -3:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -2:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -1:if(d<=3){return 3}if(d<=5){return 5}break;case 0:if(d<=4){return 4}break;case 1:if(d<=3){return 3}break;case 2:if(d<=2){return 2}break;case 3:if(d<=1){return 1}break}break;case 15:switch(c){case -2:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 0:if(d<=3){return 3}if(d<=5){return 5}break;case 1:if(d<=4){return 4}break;case 2:if(d<=3){return 3}break;case 3:if(d<=2){return 2}break;case 4:if(d<=1){return 1}break}break;case 16:switch(c){case -1:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 0:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 1:if(d<=3){return 3}if(d<=5){return 5}break;case 2:if(d<=4){return 4}break;case 3:if(d<=3){return 3}break;case 4:if(d<=2){return 2}break;case 5:if(d<=1){return 1}break}break;case 17:switch(c){case 0:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 2:if(d<=3){return 3}if(d<=5){return 5}break;case 3:if(d<=4){return 4}break;case 4:if(d<=3){return 3}break;case 5:if(d<=2){return 2}break;case 6:if(d<=1){return 1}break}break;case 31:switch(c){case -4:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -3:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -2:if(d<=3){return 3}if(d<=5){return 5}break;case -1:if(d<=4){return 4}break;case 0:if(d<=3){return 3}break;case 2:if(d<=1){return 1}break}break;case 32:switch(c){case -3:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -2:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -1:if(d<=3){return 3}if(d<=5){return 5}break;case 0:if(d<=4){return 4}break;case 1:if(d<=3){return 3}break;case 3:if(d<=1){return 1}break}break;case 33:switch(c){case -2:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 0:if(d<=3){return 3}if(d<=5){return 5}break;case 1:if(d<=4){return 4}break;case 2:if(d<=3){return 3}break;case 4:if(d<=1){return 1}break}break;case 34:switch(c){case -1:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 0:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 1:if(d<=3){return 3}if(d<=5){return 5}break;case 2:if(d<=4){return 4}break;case 3:if(d<=3){return 3}break;case 5:if(d<=1){return 1}break}break;case 35:switch(c){case 0:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 2:if(d<=3){return 3}if(d<=5){return 5}break;case 3:if(d<=4){return 4}break;case 4:if(d<=3){return 3}break;case 6:if(d<=1){return 1}break}break;case 49:switch(c){case -4:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -3:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -2:if(d<=3){return 3}if(d<=5){return 5}break;case -1:if(d<=2){return 2}if(d<=4){return 4}break;case 0:if(d<=3){return 3}break;case 2:if(d<=1){return 1}break}break;case 50:case 82:switch(c){case -3:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -2:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -1:if(d<=3){return 3}if(d<=5){return 5}break;case 0:if(d<=2){return 2}if(d<=4){return 4}break;case 1:if(d<=3){return 3}break;case 3:if(d<=1){return 1}break}break;case 51:case 83:switch(c){case -2:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 0:if(d<=3){return 3}if(d<=5){return 5}break;case 1:if(d<=2){return 2}if(d<=4){return 4}break;case 2:if(d<=3){return 3}break;case 4:if(d<=1){return 1}break}break;case 52:case 84:switch(c){case -1:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 0:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 1:if(d<=3){return 3}if(d<=5){return 5}break;case 2:if(d<=2){return 2}if(d<=4){return 4}break;case 3:if(d<=3){return 3}break;case 5:if(d<=1){return 1}break}break;case 53:case 85:switch(c){case 0:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 2:if(d<=3){return 3}if(d<=5){return 5}break;case 3:if(d<=2){return 2}if(d<=4){return 4}break;case 4:if(d<=3){return 3}break;case 6:if(d<=1){return 1}break}break;case 81:switch(c){case -4:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -3:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -2:if(d<=3){return 3}if(d<=5){return 5}break;case -1:if(d<=2){return 2}if(d<=4){return 4}break;case 0:if(d<=1){return 1}if(d<=3){return 3}break}break}return d},getImplicitHydValence:function(a,c,g){var d=a;var e=c;var f=g;var b=0;if(d==6){b=4-abs(e)}else{if(d==7||d==15){b=3+e}else{if(d==8||d==16){b=2+e}}}if(b<0){b=0}if(f>b){b=f}return b}};Kekule.ValenceUtils.getImplicitValence=Kekule.ValenceUtils.getImplicitMdlValence;(function(){var a=Kekule.ArrayUtils;Kekule.StructureComparationLevel={SKELETAL:1,CONSTITUTION:2,CONFIGURATION:3,EXACT:4,DEFAULT:4};Kekule.globalOptions.add("algorithm.structureComparation",{structureComparationLevel:Kekule.StructureComparationLevel.DEFAULT});Kekule.globalOptions.add("algorithm.structureClean",{structureCleanOptions:{orphanChemNode:true,hangingChemConnector:true}});Kekule.ObjComparer.compareStructure=function(e,d,b){var c=Object.create(b||{});c.method=Kekule.ComparisonMethod.CHEM_STRUCTURE;return Kekule.ObjComparer.compare(e,d,c)};Kekule.ObjComparer.equalStructure=function(d,c,b){return Kekule.ObjComparer.compareStructure(d,c,b)===0};Kekule.ObjComparer.getStructureComparisonDetailOptions=function(f){var n=Object.extend({},f);if(f){var e=Kekule.StructureComparationLevel;var c=f.structureLevel||f.level||Kekule.globalOptions.algorithm.structureComparation.structureComparationLevel;var h=["atom","mass","linkedConnectorCount","charge","radical","stereo","hydrogenCount","connectedObjCount","bondType","bondOrder"];var k;if(c===e.SKELETAL){k={atom:false,mass:false,linkedConnectorCount:true,charge:false,radical:false,stereo:false,hydrogenCount:false,connectedObjCount:true,bondType:false,bondOrder:false}}else{if(c===e.CONSTITUTION){k={atom:true,mass:false,linkedConnectorCount:true,charge:false,radical:false,stereo:false,hydrogenCount:true,connectedObjCount:true,bondType:true,bondOrder:true}}else{if(c===e.CONFIGURATION){k={atom:true,mass:false,linkedConnectorCount:true,charge:false,radical:false,stereo:true,hydrogenCount:true,connectedObjCount:true,bondType:true,bondOrder:true}}else{if(c===e.EXACT){k={atom:true,mass:true,linkedConnectorCount:true,charge:true,radical:true,stereo:true,hydrogenCount:true,connectedObjCount:true,bondType:true,bondOrder:true}}}}}for(var g=0,d=h.length;g<d;++g){var m=h[g];var j="compare"+m.capitalizeFirst();var b=n[m];if(Kekule.ObjUtils.isUnset(b)){b=n[j]}if(Kekule.ObjUtils.isUnset(b)){n[m]=k[m];n[j]=k[m]}else{n[m]=b;n[j]=b}}}return n};Kekule.ChemStructureObject=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemStructureObject",initProperties:function(){this.defineProp("linkedConnectors",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null});this.defineProp("linkedObjs",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var b=[];for(var g=0,d=this.getLinkedConnectorCount();g<d;++g){var c=this.getLinkedConnectorAt(g);var m=c.getConnectedObjs();for(var f=0,e=m.length;f<e;++f){var h=m[f];if(h!==this&&!(this.hasChildObj&&this.hasChildObj(h))){Kekule.ArrayUtils.pushUnique(b,m[f])}}}return b}});this.defineProp("linkedSiblings",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var n=[];var m=this.getParent();for(var g=0,b=this.getLinkedConnectorCount();g<b;++g){var c=this.getLinkedConnectorAt(g);var h=c.getConnectedObjs();for(var e=0,d=h.length;e<d;++e){var f=h[e];if(f!==this){if(n.indexOf(f)<0){if(f.getParent()!==m){f=m.getDirectChildOfNestedNode(f)}if(f){n.push(f)}}}}}return n}})},initPropValues:function($super){$super();this.setPropStoreFieldValue("linkedConnectors",[]);this.setSuppressChildChangeEventInUpdating(true)},getAutoIdPrefix:function(){return"o"},doGetActualCompareOptions:function($super,c){if(c&&c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){var b=Kekule.ObjComparer.getStructureComparisonDetailOptions(c);if(c.customMethod){b.customMethod=c.customMethod}if(c.extraComparisonProperties){b.extraComparisonProperties=c.extraComparisonProperties}return b}else{return $super(c)}},_getComparisonOptionFlagValue:function(c,e){var d="compare"+e.capitalizeFirst();var b=c[d];if(Kekule.ObjUtils.isUnset(b)){b=c[e]}return b},doGetComparisonPropNames:function($super,b){if(b.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){return[]}else{return $super(b)}},doCompare:function($super,e,c){var b=$super(e,c);if(!b&&c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(c,"linkedConnectorCount")){var f=this.getLinkedNonHydrogenConnectors();var d=e.getLinkedNonHydrogenConnectors&&e.getLinkedNonHydrogenConnectors();b=this.doCompareOnValue(f.length,d&&d.length,c)}}return b},compareStructure:function(c,b){var d=Object.create(b||{});d.method=Kekule.ComparisonMethod.CHEM_STRUCTURE;return this.compare(c,d)},equalStructure:function(c,b){return this.compareStructure(c,b)===0},getParentFragment:function(){var b=this.getParent();return(b instanceof Kekule.StructureFragment)?b:null},getRootFragment:function(){var b=this.getParentFragment();if(b){return b.getRootFragment()||b}else{return b}},notifyLinkedConnectorsChanged:function(){this.notifyPropSet("linkedConnectors",this.getPropStoreFieldValue("linkedConnectors"))},getCurrConnectableObj:function(){return this},getLinkedConnectorCount:function(){return this.getLinkedConnectors().length},getLinkedConnectorAt:function(b){return this.getLinkedConnectors()[b]},indexOfLinkedConnector:function(b){return this.getLinkedConnectors().indexOf(b)},appendLinkedConnector:function(c){var b=this._doAppendLinkedConnector(c);if(c){c._doAppendConnectedObj(this)}return b},_doAppendLinkedConnector:function(b){if(!b){return -1}var d=this.getPropStoreFieldValue("linkedConnectors");var c=Kekule.ArrayUtils.pushUniqueEx(d,b);if(c.isPushed){this.notifyLinkedConnectorsChanged()}return c.index},removeLinkedConnectorAt:function(c){var b=this.getLinkedConnectorAt(c);if(b){b._doRemoveConnectedObjAt(b.indexOfConnectedObj(this))}return this._doRemoveLinkedConnectorAt(c)},_doRemoveLinkedConnectorAt:function(b){var c=Kekule.ArrayUtils.removeAt(this.getLinkedConnectors(),b);if(c){this.notifyLinkedConnectorsChanged()}return c},removeLinkedConnector:function(b){var c=this.getLinkedConnectors().indexOf(b);if(c>=0){this.removeLinkedConnectorAt(c)}},getConnectorTo:function(e){for(var d=0,b=this.getLinkedConnectorCount();d<b;++d){var f=this.getLinkedConnectorAt(d);if(f.hasConnectedObj(e)){return f}}return null},removeThisFromLinkedConnector:function(){for(var b=this.getLinkedConnectorCount()-1;b>=0;--b){var d=this.getLinkedConnectorAt(b);d.removeConnectedObj(this)}},getLinkedObjsOnConnector:function(c){var b=[];var f=c.getConnectedObjs();for(var e=0,d=f.length;e<d;++e){if(f[e]!==this){Kekule.ArrayUtils.pushUnique(b,f[e])}}return b},getLinkedNonHydrogenConnectors:function(){var b=[];for(var e=0,d=this.getLinkedConnectorCount();e<d;++e){var c=this.getLinkedConnectorAt(e);if(!c.isNormalConnectorToHydrogen||!c.isNormalConnectorToHydrogen()){Kekule.ArrayUtils.pushUnique(b,c)}}return b},getLinkedNonHydrogenObjs:function(){var b=[];for(var g=0,d=this.getLinkedConnectorCount();g<d;++g){var c=this.getLinkedConnectorAt(g);var h=c.getConnectedObjs();for(var f=0,e=h.length;f<e;++f){if(h[f]!==this&&(!h[f].isHydrogenAtom||!h[f].isHydrogenAtom())){Kekule.ArrayUtils.pushUnique(b,h[f])}}}return b},getLinkedHydrogenAtoms:function(){var b=[];for(var g=0,d=this.getLinkedConnectorCount();g<d;++g){var c=this.getLinkedConnectorAt(g);var h=c.getConnectedObjs();for(var f=0,e=h.length;f<e;++f){if(h[f]!==this&&(h[f].isHydrogenAtom&&h[f].isHydrogenAtom())){Kekule.ArrayUtils.pushUnique(b,h[f])}}}return b},getStructureRelatedPropNames:function(){return["linkedConnectors"]},structureChange:function(b){this.clearStructureFlags();this.invokeEvent("structureChange",{origin:b||this})},clearStructureFlags:function(){},relayEvent:function($super,b,c){if(b==="structureChange"){this.structureChange(c.origin)}else{$super(b,c)}},doObjectChange:function($super,b){if(Kekule.ArrayUtils.intersect(b||[],this.getStructureRelatedPropNames()).length){this.structureChange()}}});Kekule.BaseStructureNode=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.BaseStructureNode",initialize:function($super,d,b,c){$super(d);if(b){this.setCoord2D(b)}if(c){this.setCoord3D(c)}},initProperties:function(){this.defineProp("zIndex2D",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED})},getStructureRelatedPropNames:function($super){return $super().concat(["coord2D","coord3D"])},getAutoIdPrefix:function(){return"n"},getContainerBox:function(c,b){var d=this.getAbsCoordOfMode(c,b);return Kekule.BoxUtils.createBox(d,d)},getContainerBox2D:function(b){return this.getContainerBox(Kekule.CoordMode.COORD2D,b)},getContainerBox3D:function(b){return this.getContainerBox(Kekule.CoordMode.COORD3D,b)}});Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.BaseStructureNode);Kekule.StereoParity={NONE:null,ODD:1,EVEN:2,UNKNOWN:0};Kekule.ChemStructureNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.ChemStructureNode",initialize:function($super,d,b,c){$super(d);if(b){this.setCoord2D(b)}if(c){this.setCoord3D(c)}},initProperties:function(){this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}});this.defineProp("radical",{dataType:DataType.INT});this.defineProp("parity",{dataType:DataType.INT});this.defineProp("isAnchor",{dataType:DataType.BOOL,serializable:false,getter:function(){var b=this.getParent();if(b&&b.indexOfAnchorNode){return b.indexOfAnchorNode(this)>=0}else{return false}},setter:function(b){if(b!==this.getIsAnchor()){var c=this.getParent();if(c){if(b&&c.appendAnchorNode()){c.appendAnchorNode(this)}else{if(!b&&c.removeAnchorNode){c.removeAnchorNode(this)}}}}}})},getStructureRelatedPropNames:function($super){return $super().concat(["charge","radical"])},getLabel:function(){return null},doGetComparisonPropNames:function($super,c){var b=$super(c);if(c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(c,"charge")){b.push("charge")}if(this._getComparisonOptionFlagValue(c,"radical")){b.push("radical")}}return b},doCompare:function($super,e,c){var b=$super(e,c);if(!b&&c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(c,"stereo")){var f=this.getParity()||Kekule.StereoParity.UNKNOWN;var d=(e.getParity&&e.getParity())||Kekule.StereoParity.UNKNOWN;b=this.doCompareOnValue(f,d,c)}}return b},getPrimaryIsotope:function(){return null},getLinkedChemNodes:function(f){var d=this.getLinkedObjs();var b=[];for(var e=0,c=d.length;e<c;++e){var g=d[e];if(g instanceof Kekule.ChemStructureNode&&(!f||!g.isHydrogenAtom||!g.isHydrogenAtom())){b.push(g)}}return b},getLinkedBonds:function(d){var b=[];for(var f=0,e=this.getLinkedConnectorCount();f<e;++f){var g=this.getLinkedConnectorAt(f);if((g instanceof Kekule.Bond)&&(!d||g.getBondType()===d)){b.push(g)}}return b},getLinkedMultipleBonds:function(){var g=Kekule.BondOrder;var d=[];for(var f=0,e=this.getLinkedConnectorCount();f<e;++f){var h=this.getLinkedConnectorAt(f);if((h instanceof Kekule.Bond)&&(h.getBondType()===Kekule.BondType.COVALENT)){var b=h.getBondOrder();if((b===g.DOUBLE)||(b===g.TRIPLE)||(b===g.QUAD)||(b===g.EXPLICIT_AROMATIC)){d.push(h)}}}return d},getLinkedDoubleBonds:function(){var g=Kekule.BondOrder;var d=[];for(var f=0,e=this.getLinkedConnectorCount();f<e;++f){var h=this.getLinkedConnectorAt(f);if((h instanceof Kekule.Bond)&&(h.getBondType()===Kekule.BondType.COVALENT)){var b=h.getBondOrder();if(b===g.DOUBLE){d.push(h)}}}return d},clearStructureFlags:function(){this.setPropStoreFieldValue("parity",Kekule.StereoParity.NONE)},isHydrogenAtom:function(){return false}});Kekule.RadicalType=Kekule.RadicalOrder;Kekule.AbstractAtom=Class.create(Kekule.ChemStructureNode,{CLASS_NAME:"Kekule.AbstractAtom",initialize:function($super,d,b,c){$super(d,b,c)},initProperties:function(){this.defineProp("explicitHydrogenCount",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED})},getAutoIdPrefix:function(){return"a"},getStructureRelatedPropNames:function($super){return $super().concat(["explicitHydrogenCount"])},doCompare:function($super,e,c){var b=$super(e,c);if(!b&&c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(c,"hydrogenCount")){var f=this.getHydrogenCount(true);var d=e.getHydrogenCount&&e.getHydrogenCount(true);b=this.doCompareOnValue(f,d,c)}}return b},getHydrogenCount:function(d){var b=this.getExplicitHydrogenCount()||0;if(d){var c=this.getLinkedHydrogenAtoms();b+=c.length||0}return b},setHydrogenCount:function(b){return this.setExplicitHydrogenCount(b)},isSaturated:function(){return !this.getLinkedMultipleBonds().length},mayContainElement:function(b){var c;if(typeof(b)==="string"){c=Kekule.ChemicalElementsDataUtil.getAtomicNumber(b)}else{c=b}return this.doMayContainElement(c)},doMayContainElement:function(b){return false}});Kekule.Atom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.Atom",initialize:function($super,f,b,c,d,e){$super(f,d,e);if(b||c){this.changeIsotope(b,c)}},initProperties:function(){this.defineProp("isotope",{dataType:"Kekule.Isotope",serializable:false});this.defineProp("isotopeId",{dataType:DataType.STRING,serializable:true,getter:function(){var b=this.getIsotope();return b?b.getIsotopeId():Kekule.Element.UNSET_ELEMENT},setter:function(c){var b=Kekule.IsotopeFactory.getIsotopeById(c);if(b){this.setIsotope(b)}}});this.defineProp("symbol",{dataType:DataType.STRING,serializable:false,getter:function(){var c=this.getIsotope();var b=c?c.getSymbol():Kekule.Element.UNSET_ELEMENT;return b},setter:function(b){this.changeElement(b)}});this.defineProp("atomicNumber",{dataType:DataType.INTEGER,serializable:false,getter:function(){var b=this.getIsotope();return b?b.getAtomicNumber():0},setter:function(b){this.changeElement(b)}});this.defineProp("massNumber",{dataType:DataType.INTEGER,getter:function(){var b=this.getIsotope();return b?b.getMassNumber():Kekule.Isotope.UNSET_MASSNUMBER},setter:function(b){this.changeMassNumber(b)}});this.defineProp("isotopeAlias",{dataType:DataType.STRING,getter:function(){var b=this.getIsotope();return b?b.getIsotopeAlias():undefined},setter:function(b){this.changeElement(b)}});this.defineProp("atomType",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("atomTypeId",{dataType:DataType.STRING,getter:function(){var b=this.getPropStoreFieldValue("atomType");return b?b.id:Kekule.AtomType.UNSET_ATOMTYPE},setter:function(c){if(this.isNormalAtom()){var b=Kekule.AtomTypeDataUtil.getAtomTypeFromId(this.getAtomicNumber(),c);this.setAtomType(b)}}});this.defineProp("hybridizationType",{dataType:DataType.INT,enumSource:Kekule.HybridizationType})},getAutoIdPrefix:function(){return"a"},getStructureRelatedPropNames:function($super){return $super().concat(["isotope","atomType"])},doGetComparisonPropNames:function($super,c){var b=$super(c);if(c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(c,"atom")){b.push("atomicNumber")}if(this._getComparisonOptionFlagValue(c,"mass")){b.push("massNumber")}}return b},getPrimaryIsotope:function(){return this.getIsotope()},getLabel:function(){return""+(this.getMassNumber()||"")+this.getSymbol()},doMayContainElement:function(b){return this.getAtomicNumber()===b},changeIsotope:function(b,c){if(b===Kekule.Element.UNSET_ELEMENT){c=Kekule.Isotope.UNSET_MASSNUMBER}else{if(!b){b=this.getAtomicNumber()}}if(!c){c=Kekule.Isotope.UNSET_MASSNUMBER}if(this.getAtomicNumber()!==b){this.setAtomType(Kekule.AtomType.UNSET_ATOMTYPE)}var d=Kekule.IsotopeFactory.getIsotope(b,c);this.setIsotope(d)},changeElement:function(b){return this.changeIsotope(b,Kekule.Isotope.UNSET_MASSNUMBER)},changeMassNumber:function(b){return this.changeIsotope(null,b)},isElement:function(b){return(this.getSymbol()===b)||(this.getAtomicNumber()===b)},isNormalAtom:function(){var b=this.getIsotope();return b?b.isNormalElement():false},isHydrogenAtom:function(){return this.isElement(1)&&(!this.getMassNumber()||this.getMassNumber()<=1)},_getCurrCovalentBondsInfo:function(){var g=0;var f=0;for(var e=0,c=this.getLinkedConnectorCount();e<c;++e){var b=this.getLinkedConnectorAt(e);if((b instanceof Kekule.Bond)&&(b.getBondType()==Kekule.BondType.COVALENT)){var d=b.getBondValence();g+=d;if(d>f){f=d}}}return{valenceSum:g,maxValence:f}},_getCurrIonicBondsInfo:function(){var g=0;var f=0;for(var e=0,c=this.getLinkedConnectorCount();e<c;++e){var b=this.getLinkedConnectorAt(e);if((b instanceof Kekule.Bond)&&(b.getBondType()==Kekule.BondType.IONIC)){var d=b.getBondValence();g+=d;if(d>f){f=d}}}return{valenceSum:g,maxValence:f}},guessAtomType:function(){if(this.isNormalAtom()){var d=null,h=null;var g=this._getCurrCovalentBondsInfo();var f=Kekule.AtomTypeDataUtil.getAllAtomTypes(this.getAtomicNumber());if(f){for(var e=0,b=f.length;e<b;++e){var c=f[e];h=c;if(c.bondOrderSum>=g.valenceSum){d=c;if(c.maxBondOrder>=g.maxValence){return c}}}return d?d:h}}return null},getProximalAtomType:function(){return this.getAtomType()||this.guessAtomType()},getImplicitValence:function(){if(this.isNormalAtom()){var d=this._getCurrCovalentBondsInfo();var e=d.valenceSum;var c=Math.round(this.getCharge()||0);var b=Kekule.ValenceUtils.getImplicitValence(this.getAtomicNumber(),c,e);return b}else{return 0}},getImplicitHydrogenCount:function(){if(this.isNormalAtom()){var d=this._getCurrCovalentBondsInfo();var c=this._getCurrIonicBondsInfo();var e=this.getImplicitValence();var b=Kekule.RadicalOrder.getRadicalElectronCount(this.getRadical());e-=b;return Math.max(e-d.valenceSum-c.valenceSum,0)}else{return 0}},getHydrogenCount:function(c){var b;if(Kekule.ObjUtils.isUnset(this.getExplicitHydrogenCount())){b=this.getImplicitHydrogenCount()||0}else{b=this.getExplicitHydrogenCount()||0}if(c){b+=this.getLinkedHydrogenAtoms().length||0}return b},getAtomicMass:function(){var b=null;var c=this.getIsotope();if(c){b=c.getExactMass()||c.getNaturalMass()}return b}});Kekule.PseudoatomType={DUMMY:"dummy",ANY:"any",HETERO:"hetero",CUSTOM:"custom"};Kekule.Pseudoatom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.Pseudoatom",initialize:function($super,f,b,e,c,d){$super(f,c,d);if(b){this.setAtomType(b)}if(e&&(b==Kekule.PseudoatomType.CUSTOM)){this.setSymbol(e)}},initProperties:function(){this.defineProp("atomType",{dataType:DataType.STRING,enumSource:Kekule.PseudoatomType});this.defineProp("symbol",{dataType:DataType.STRING,getter:function(){var c=this.getAtomType();var d=Kekule.PseudoatomType;var b=Kekule.ChemStructureNodeLabels;return(c===d.DUMMY)?b.DUMMY_ATOM:(c===d.ANY)?b.ANY_ATOM:(c===d.HETERO)?b.HETERO_ATOM:this.getPropStoreFieldValue("symbol")||b.CUSTOM_ATOM},setter:function(d){var e=Kekule.PseudoatomType;var b=Kekule.ChemStructureNodeLabels;if(d){var c=(d===b.DUMMY_ATOM)?e.DUMMY:(d===b.ANY_ATOM)?e.ANY:(d===b.HETERO_ATOM)?e.HETERO:e.CUSTOM;this.setAtomType(c)}this.setPropStoreFieldValue("symbol",d)}})},getStructureRelatedPropNames:function($super){return $super().concat(["atomType","symbol"])},getPrimaryIsotope:function(){return null},getLabel:function(){return this.getSymbol()},doGetComparisonPropNames:function($super,c){var b=$super(c);if(c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(c,"atom")){b.push("atomType")}}return b},doCompare:function($super,d,c){var b=$super(d,c);if(!b&&c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(c,"atom")){if(this.getAtomType()===Kekule.PseudoatomType.CUSTOM){var f=this.getSymbol();var e=d.getSymbol&&d.getSymbol();b=this.doCompareOnValue(f,e,c)}}}return b},doMayContainElement:function(e){var d=Kekule.PseudoatomType;var c=this.getAtomType();if(c===d.ANY){return true}else{if(c===d.HETERO){if([1,6].indexOf(e)>=0){return false}else{var b=Kekule.ChemicalElementsDataUtil.getElementInfo(e);return(eleminfo.chemicalSerie==="Nonmetals")}}else{return false}}}});Kekule.VariableAtom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.VariableAtom",initProperties:function(){this.defineProp("allowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(c){var b=this.getPropStoreFieldValue("allowedIsotopeIds");if((!b)&&c){b=[];this.setPropStoreFieldValue("allowedIsotopeIds",b)}return b}});this.defineProp("disallowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(c){var b=this.getPropStoreFieldValue("disallowedIsotopeIds");if((!b)&&c){b=[];this.setPropStoreFieldValue("disallowedIsotopeIds",b)}return b}});this.defineProp("allowedIsotopes",{dataType:DataType.ARRAY,setter:null,getter:function(){return this._getIsotopesFromIds(this.getAllowedIsotopeIds())}});this.defineProp("disallowedIsotopes",{dataType:DataType.ARRAY,setter:null,getter:function(){return this._getIsotopesFromIds(this.getDisallowedIsotopeIds())}})},getStructureRelatedPropNames:function($super){return $super().concat(["allowedIsotopeIds","disallowedIsotopeIds"])},getPrimaryIsotope:function(){if(this.isDisallowedList()){return null}else{var b=this.getAllowedIsotopeIds();var c=b?b[0]:null;return c?Kekule.IsotopeFactory.getIsotopeById(c):null}},getLabel:function(){return Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},doCompare:function($super,f,h){var i=$super(f,h);if(!i&&h.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(h,"atom")){var g=Kekule.ArrayUtils;var c=this.getAllowedIsotopeIds();var b=f.getAllowedIsotopeIds&&f.getAllowedIsotopeIds();if(c){c=g.clone(c).sort();if(b&&b.length){b=g.clone(b).sort()}i=this.doCompareOnValue(c,b,h)}else{if(b){i=1}else{var e=this.getDisallowedIsotopeIds();var d=f.getDisallowedIsotopeIds&&f.getDisallowedIsotopeIds();if(e&&e.length){e=g.clone(e).sort()}if(d&&d.length){d=g.clone(d).sort()}i=this.doCompareOnValue(e,d,h)}}}}return i},doMayContainElement:function(d){var c=function(n,h){if(!h){return false}for(var g=0,e=h.length;g<e;++g){var m=h[g];var k=Kekule.IsotopesDataUtil.getIsotopeIdDetail(m);var j=k.symbol;var f=Kekule.ChemicalElementsDataUtil.getAtomicNumber(j);if(f===n){return true}}return false};var b=this.getAllowedIsotopeIds();if(b){return c(d,b)}else{b=this.getDisallowedIsotopeIds();if(b){return !c(d,b)}}},isDisallowedList:function(){return this.getDisallowedIsotopeIds()&&(!this.getAllowedIsotopeIds())},isListEmpty:function(){var c=this.getAllowedIsotopeIds();var b=!c||!c.length;if(b){c=this.getDisallowedIsotopeIds();b=!c||!c.length}return b},fetchAllowedIsotopeIds:function(){return this.doGetAllowedIsotopeIds(true)},fetchDisallowedIsotopeIds:function(){return this.doGetDisallowedIsotopeIds(true)},_getIsotopesFromIds:function(f){if(!f){return null}var b=[];for(var e=0,c=f.length;e<c;++e){var g=f[e];var d=Kekule.IsotopeFactory.getIsotopeById(g);if(d){b.push(d)}}return b}});Kekule.MolecularFormula=Class.create(ObjectEx,{CLASS_NAME:"Kekule.MolecularFormula",initialize:function($super,b){$super();this.setPropStoreFieldValue("sections",[]);if(b){this.setPropStoreFieldValue("parent",b)}this.setBubbleEvent(true)},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("sections",{dataType:DataType.ARRAY,setter:null});this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}});this.defineProp("radical",{dataType:DataType.INT,getter:function(){return this.getPropStoreFieldValue("radical")||0}})},getHigherLevelObj:function(){return this.getParent()},isEmpty:function(){return this.getSectionCount()<=0},notifySectionsChanged:function(){this.notifyPropSet("sections",this.getPropStoreFieldValue("sections"))},createSectionItem:function(c,e,d){var b={obj:c,count:e||1};if(d){c.setCharge(d)}if(c.setParent){c.setParent(this.getParent())}return b},getTotalCharge:function(){var b=0;var e=this.getSections();for(var d=0,c=e.length;d<c;++d){if(e[d].obj.getCharge){b+=e[d].obj.getCharge()*(section.count||1)}}if(this.getCharge()){b+=this.getCharge()}return b},indexOfObj:function(c){var e=this.getSections();for(var d=0,b=e.length;d<b;++d){if(e[d].obj==c){return d}}return -1},getSectionCount:function(){return this.getSections().length},getSectionAt:function(b){return this.getSections()[b]},getSectionCharge:function(c){var b=0;var d;if(typeof(c)!="object"){d=this.getSectionAt(c)}else{d=c}if(d.obj.getCharge){b+=(d.obj.getCharge()||0)}return b},appendSection:function(c,e,d){var b=this.createSectionItem(c,e,d);this.getSections().push(b);this.notifySectionsChanged();return b},insertSection:function(d,c,f,e){var b=this.createSectionItem(c,f,e);this.getSections().splice(d,0,b);this.notifySectionsChanged();return b},removeSectionAt:function(b){var c=this.getSections().splice(b,1);if(c){this.notifySectionsChanged()}return c},clear:function(){this.beginUpdate();try{this.setCharge(null);this.setRadical(null);this.setPropStoreFieldValue("sections",[]);this.notifySectionsChanged()}finally{this.endUpdate()}},removeObj:function(b){var c=this.indexOfObj(b);if(c>=0){var d=this.removeSectionAt(c);this.notifySectionsChanged()}else{return null}},getMaxNestedLevel:function(){var b=0;for(var e=0,c=this.getSectionCount();e<c;++e){var f=this.getSectionAt(e);if(f.obj instanceof Kekule.MolecularFormula){var d=f.obj.getMaxNestedLevel()+1;if(d>b){b=d}}}return b},getSimpleIsotopeMaps:function(){}});Kekule.StructureConnectionTable=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureConnectionTable",TRAVERS_VISITED_KEY:"__$ctabTraversVisited__",initialize:function($super,b,c){$super();if(b){this.setOwner(b)}if(c){this.setPropStoreFieldValue("parent",c)}},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(b){if(b!=this.getPropStoreFieldValue("owner")){this.setPropStoreFieldValue("owner",b);this.ownerChanged(b)}}});this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(b){if(b!=this.getPropStoreFieldValue("parent")){this.setPropStoreFieldValue("parent",b);this.parentChanged(b)}}});this.defineProp("nodes",{dataType:DataType.ARRAY});this.defineProp("anchorNodes",{dataType:DataType.ARRAY,setter:null});this.defineProp("connectors",{dataType:DataType.ARRAY});this.defineProp("nonHydrogenNodes",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null,getter:function(){var b=[];for(var d=0,c=this.getNodeCount();d<c;++d){var e=this.getNodeAt(d);if(e instanceof Kekule.ChemStructureNode){if(!e.isHydrogenAtom||!e.isHydrogenAtom()){b.push(e)}}}return b}});this.defineProp("nonHydrogenConnectors",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null,getter:function(){var b=[];for(var d=0,c=this.getConnectorCount();d<c;++d){var e=this.getConnectorAt(d);if(!e.isNormalConnectorToHydrogen||!e.isNormalConnectorToHydrogen()){b.push(e)}}return b}})},initPropValues:function($super){$super();this.setPropStoreFieldValue("nodes",[]);this.setPropStoreFieldValue("anchorNodes",[]);this.setPropStoreFieldValue("connectors",[])},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},doSaveProp:function(o,d,h,w){var p=d.name;switch(p){case"anchorNodes":var e=[];for(var v=0,r=o.getAnchorNodeCount();v<r;++v){var q=o.getAnchorNodeAt(v);var f=o.indexOfNode(q);e.push(f)}var g=w.createChildStorageNode(h,w.propNameToStorageName(p),true);w.save(e,g);return true;break;case"connectors":var g=w.createChildStorageNode(h,w.propNameToStorageName(p),true);for(var v=0,r=o.getConnectorCount();v<r;++v){var x=o.getConnectorAt(v);var b=w.getNameForArrayItemStorageNode(x);var n=w.appendArrayItemStorageNode(g,w.propNameToStorageName(b),w.isArray(x));w.setStorageNodeExplicitType(n,w.getValueExplicitType(x));w.save(x,n);var m=[];for(var t=0,s=x.getConnectedObjCount();t<s;++t){var u=x.getConnectedObjAt(t);var f=o.indexOfChild(u);if(f>=0){m.push(f)}else{var c=o.indexStackOfChild(u);if((c!==null)&&(typeof(c)!=="undefined")){m.push(c)}}}if(m.length){var y=w.createChildStorageNode(n,w.propNameToStorageName("connectedObjs"),true);w.save(m,y)}}return true;break;default:return false}},doLoadProp:function(n,c,j,t){var o=c.name;switch(o){case"anchorNodes":var e=[];var f=t.getChildStorageNode(j,t.propNameToStorageName(o));t.load(e,f);n.__load_anchorNodes_indexes=e;return true;break;case"connectors":var f=t.getChildStorageNode(j,t.propNameToStorageName(o));var d=t.getAllArrayItemStorageNodes(f);var b;for(var r=0,q=d.length;r<q;++r){var m=d[r];var u=t.getStorageNodeExplicitType(m)||t.getStorageNodeName(m);if(u){b=DataType.createInstance(u);t.load(b,m);var v=t.getChildStorageNode(m,t.propNameToStorageName("connectedObjs"));if(v){var k=[];t.load(k,v);b.__load_connectedObj_indexes=k}var p=t.getChildStorageNode(m,t.propNameToStorageName("connectedNodes"));if(p){var g=[];t.load(g,p);b.__load_connectedNode_indexes=g}var h=t.getChildStorageNode(m,t.propNameToStorageName("connectedConnectors"));if(h){var s=[];t.load(s,h);b.__load_connectedConnector_indexes=s}n.appendConnector(b)}}return true;break;default:return false}},loaded:function($super){if(this.__load_anchorNodes_indexes){for(var g=0,c=this.__load_anchorNodes_indexes.length;g<c;++g){var f=this.__load_anchorNodes_indexes[g];this.appendAnchorNode(this.getNodeAt(f))}delete this.__load_anchorNodes_indexes}for(var g=0,c=this.getConnectorCount();g<c;++g){var b=this.getConnectorAt(g);if(b.__load_connectedObj_indexes){for(var e=0,d=b.__load_connectedObj_indexes.length;e<d;++e){var f=b.__load_connectedObj_indexes[e];var h;if(typeof(f)=="object"){h=this.getChildAtIndexStack(f)}else{h=this.getChildAt(f)}if(h){b.appendConnectedObj(h)}}delete b.__load_connectedObj_indexes}if(b.__load_connectedNode_indexes){for(var e=0,d=b.__load_connectedNode_indexes.length;e<d;++e){var f=b.__load_connectedNode_indexes[e];if(typeof(f)=="object"){b.appendConnectedObj(this.getNodeAtIndexStack(f))}else{b.appendConnectedObj(this.getNodeAt(f))}}delete b.__load_connectedNode_indexes}if(b.__load_connectedConnector_indexes){for(var e=0,d=b.__load_connectedConnector_indexes.length;e<d;++e){var f=b.__load_connectedConnector_indexes[e];b.appendConnectedObj(this.getConnectorAt(f))}delete b.__load_connectedConnector_indexes}}this.ownerChanged(this.getOwner());this.parentChanged(this.getParent());$super()},notifyNodesChanged:function(){this.notifyPropSet("nodes",this.getPropStoreFieldValue("nodes"))},notifyAnchorNodesChanged:function(){this.notifyPropSet("anchorNodes",this.getPropStoreFieldValue("anchorNodes"))},notifyConnectorsChanged:function(){this.notifyPropSet("connectors",this.getPropStoreFieldValue("connectors"))},ownerChanged:function(c){for(var d=0,b=this.getNodeCount();d<b;++d){this.getNodeAt(d).setOwner(c)}for(var d=0,b=this.getConnectorCount();d<b;++d){this.getConnectorAt(d).setOwner(c)}},parentChanged:function(d){for(var c=0,b=this.getNodeCount();c<b;++c){this.getNodeAt(c).setParent(d)}for(var c=0,b=this.getConnectorCount();c<b;++c){this.getConnectorAt(c).setParent(d)}},isEmpty:function(){return(this.getNodeCount()<=0)&&(this.getConnectorCount()<=0)},getNodeById:function(e){var c=this.getNodes();for(var d=0,b=c.length;d<b;++d){if(c[d].getId()==e){return c[d]}}return null},getConnectorById:function(e){var c=this.getConnectors();for(var d=0,b=c.length;d<b;++d){if(c[d].getId()==e){return c[d]}}return null},getObjectById:function(c){var b=this.getNodeById(c);return b?b:this.getConnectorById(c)},getNodeCount:function(){return this.getNodes().length},getNodeAt:function(b){return this.getNodes()[b]},indexOfNode:function(b){return this.getNodes().indexOf(b)},hasNode:function(e,c){var f=this.indexOfNode(e)>=0;if((!f)&&c){for(var d=0,b=this.getNodeCount();d<b;++d){var g=this.getNodeAt(d);if(g.hasNode){f=g.hasNode(e,true)}if(f){break}}}return f},indexStackOfNode:function(f){var d=this.indexOfNode(f);if(d>=0){return d}else{var b=null;for(var e=0,c=this.getNodeCount();e<c;++e){var g=this.getNodeAt(e);if(g.indexStackOfNode){b=g.indexStackOfNode(f);if(!Kekule.ObjUtils.isUnset(b)){if(typeof(b)!="object"){b=[b]}b.unshift(e);return b}}}return b}},getNodeAtIndexStack:function(d){d=Kekule.ArrayUtils.toArray(d);if(d.length<=0){return null}else{var e=this.getNodeAt(d[0]);for(var c=1,b=d.length;c<b;++c){if(e&&e.getNodeAt){e=e.getNodeAt(d[c])}else{return null}}return e}},appendNode:function(c){var b=Kekule.ArrayUtils.pushUniqueEx(this.getNodes(),c);if(b.isPushed){if(c.setOwner){c.setOwner(this.getOwner())}if(c.setParent){c.setParent(this.getParent())}this.notifyNodesChanged()}return b.index},insertNodeAt:function(e,c){var d=this.indexOfNode(e);var b=this.getNodes();if(Kekule.ObjUtils.isUnset(c)||(c<0)){c=b.length}if(d>=0){b.splice(d,1);b.splice(c,0,e)}else{b.splice(c,0,e);if(e.setOwner){e.setOwner(this.getOwner())}if(e.setParent){e.setParent(this.getParent())}}this.notifyNodesChanged();return c},setNodeIndex:function(e,c){var b=this.getNodes();var d=this.indexOfNode(e);if(d>=0){b.splice(d,1);b.splice(c,0,e)}},removeNodeAt:function(c,b){var d=this.getNodes()[c];if(d){if(!b){d.removeThisFromLinkedConnector()}this.getNodes().splice(c,1);if(d.setOwner){d.setOwner(null)}if(d.setParent){d.setParent(null)}this.notifyNodesChanged()}},removeNode:function(d,b){var c=this.getNodes().indexOf(d);if(c>=0){this.removeNodeAt(c,b)}},replaceNode:function(d,q){if(!this.hasNode(d)){return this}else{this.insertBefore(q,d);var b=this.getAnchorNodes();var p=b.indexOf(d);if(p>=0){b.splice(p,1,[q])}var c=Kekule.ArrayUtils.clone(d.getLinkedConnectors());for(var o=0,e=c.length;o<e;++o){var f=c[o];f.replaceConnectedObj(d,q)}if(d.getNodes&&d.getCrossConnectors){var m=Kekule.ArrayUtils.clone(d.getCrossConnectors());for(var o=0,e=m.length;o<e;++o){var f=m[o];if(this.indexOfConnector(f)>=0){for(var h=0,g=f.getConnectedObjCount();h<g;++h){var n=f.getConnectedObjAt(h);if(d.indexOfChild(n)>=0){f.replaceConnectedObj(n,q)}}}f.replaceConnectedObj(d,q)}}this.removeNode(d)}},clearNodes:function(){this.clearAnchorNodes();this.setPropStoreFieldValue("nodes",[]);this.notifyAnchorNodesChanged();this.notifyNodesChanged()},sortNodes:function(b){if(b){this.getNodes().sort(b);this.notifyNodesChanged()}else{Kekule.error(Kekule.$L("ErrorMsg.SORT_FUNC_UNSET"))}},nodesHasCoord2D:function(d){var c=this.getNodes();for(var e=0,b=c.length;e<b;++e){if(c[e].hasCoord2D(d)){return true}}return false},nodesHasCoord3D:function(d){var c=this.getNodes();for(var e=0,b=c.length;e<b;++e){if(c[e].hasCoord3D(d)){return true}}return false},_createAtom:function(b,c,d,f){var e=new Kekule.Atom(null,b,c,d,f);return e},appendAtom:function(b,c,d,f){var e=this._createAtom(b,c,d,f);if(e){this.appendNode(e)}return e},getAnchorNodeCount:function(){return this.getAnchorNodes().length},indexOfAnchorNode:function(b){return this.getAnchorNodes().indexOf(b)},getAnchorNodeAt:function(b){return this.getAnchorNodes()[b]},appendAnchorNode:function(c){if(!c){return -1}if(this.getNodes().indexOf(c)>=0){var b=Kekule.ArrayUtils.pushUniqueEx(this.getAnchorNodes(),c);if(b.isPushed){this.notifyAnchorNodesChanged()}return b.index}else{return -1}},removeAnchorNodeAt:function(b){var c=this.getAnchorNodes()[b];if(c){this.getAnchorNodes().splice(b,1);this.notifyAnchorNodesChanged()}},removeAnchorNode:function(c){var b=this.getAnchorNodes().indexOf(c);if(b>=0){this.removeAnchorNodeAt(b)}},clearAnchorNodes:function(){this.setPropStoreFieldValue("anchorNodes",[]);notifyAnchorNodesChanged()},getConnectorCount:function(){return this.getConnectors().length},indexOfConnector:function(b){return this.getConnectors().indexOf(b)},getConnectorAt:function(b){return this.getConnectors()[b]},indexStackOfConnector:function(d){var e=this.indexOfConnector(d);if(e>=0){return e}else{var b=null;for(var f=0,c=this.getNodeCount();f<c;++f){var g=this.getNodeAt(f);if(g.indexStackOfConnector){b=g.indexStackOfConnector(d);if(!Kekule.ObjUtils.isUnset(b)){if(typeof(b)!="object"){b=[b]}b.unshift(f);return b}}}return b}},getConnectorAtIndexStack:function(d){d=Kekule.ArrayUtils.toArray(d);if(d.length<=0){return null}else{if(d.length===1){return this.getConnectorAt(d[0])}else{var b=d.length-1;var e=this.getNodeAt(d[0]);for(var c=1;c<b;++c){if(e&&e.getNodeAt){e=e.getNodeAt(d[c])}else{return null}}if(e){return e.getConnectorAt(d[b])}else{return null}}}},appendConnector:function(b){var c=Kekule.ArrayUtils.pushUniqueEx(this.getConnectors(),b);if(c.isPushed){if(b.setOwner){b.setOwner(this.getOwner())}if(b.setParent){b.setParent(this.getParent())}this.notifyConnectorsChanged()}return c.index},insertConnectorAt:function(c,d){var e=this.indexOfConnector(c);var b=this.getConnectors();if(Kekule.ObjUtils.isUnset(d)||(d<0)){d=b.length}if(e>=0){b.splice(e,1);b.splice(d,0,c)}else{b.splice(d,0,c);if(c.setOwner){c.setOwner(this.getOwner())}if(c.setParent){c.setParent(this.getParent())}}this.notifyConnectorsChanged()},setConnectorIndex:function(c,d){var b=this.getConnectors();var e=this.indexOfConnector(c);if(e>=0){b.splice(e,1);b.splice(d,0,c)}},removeConnectorAt:function(d,b){var c=this.getConnectors()[d];if(c){if(!b){c.removeThisFromConnectedObjs()}this.getConnectors().splice(d,1);if(c.setOwner){c.setOwner(null)}if(c.setParent){c.setParent(null)}this.notifyConnectorsChanged()}},removeConnector:function(c,b){var d=this.getConnectors().indexOf(c);if(d>=0){this.removeConnectorAt(d,b)}},clearConnectors:function(){this.setPropStoreFieldValue("connectors",[]);this.notifyConnectorsChanged()},hasConnector:function(c,d){var f=this.indexOfConnector(c)>=0;if((!f)&&d){for(var e=0,b=this.getNodeCount();e<b;++e){var g=this.getNodeAt(e);if(g.hasConnector){f=g.hasConnector(c,true)}if(f){break}}}return f},sortConnectors:function(b){if(b){this.getConnectors().sort(b);this.notifyConnectorsChanged()}else{Kekule.error(Kekule.$L("ErrorMsg.SORT_FUNC_UNSET"))}},_createBond:function(e,d,c){var j=[];for(var h=0,g=e.length;h<g;++h){var f=e[h];if(DataType.isSimpleValue(f)){f=this.getNodeAt(f)}j.push(f)}var b=new Kekule.Bond(null,j,d,null,c);return b},appendBond:function(d,c,b){var e=this._createBond(d,c,b);if(e){this.appendConnector(e)}return e},_getObjsNeedToBeCascadeRemoved:function(m,k){var o=[];var n=m.getLinkedConnectors?m.getLinkedConnectors():[];for(var g=0,c=n.length;g<c;++g){var d=n[g];if((!k)||(k.indexOf(d)<0)){if(d.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(o,d)}}}if(m instanceof Kekule.ChemStructureNode){}else{if(m instanceof Kekule.ChemStructureConnector){var h=m.getConnectedObjs();for(var g=0,c=h.length;g<c;++g){var f=h[g];if((!k)||(k.indexOf(f)<0)){if(f instanceof Kekule.ChemStructureNode){if(f.getLinkedConnectors().length<=1){Kekule.ArrayUtils.pushUnique(o,f)}}}}}else{}}var e=[].concat(o);e.push(m);var j=[];for(var g=0,c=o.length;g<c;++g){var f=o[g];if(f!==m){var b=this._getObjsNeedToBeCascadeRemoved(f,e)}Kekule.ArrayUtils.pushUnique(j,b)}Kekule.ArrayUtils.pushUnique(o,j);return o},removeChildObj:function(h,e,c){var g;if(e){g=this._getObjsNeedToBeCascadeRemoved(h);Kekule.ArrayUtils.pushUnique(g,h)}else{g=[h]}for(var d=0,b=g.length;d<b;++d){var f=g[d];if(f instanceof Kekule.BaseStructureConnector){this.removeConnector(f)}else{if(f instanceof Kekule.BaseStructureNode){this.removeNode(f)}}}if(c){for(var d=g.length-1;d>=0;--d){var f=g[d];if(f.finalize){f.finalize()}}}},removeChild:function($super,b){return this.removeChildObj(b)||$super(b)},deleteChildObj:function(c,b){return this.removeChildObj(c,b,true)},hasChildObj:function(b){return this.hasNode(b)||this.hasConnector(b)},getNextSiblingOfChild:function(c){if(c instanceof Kekule.ChemStructureNode){var b=this.indexOfNode(c);if(b>=0){return this.getNodeAt(b+1)}}else{if(c instanceof Kekule.ChemStructureConnector){var b=this.indexOfConnector(c);if(b>=0){return this.getConnectorAt(b+1)}}}return null},insertBefore:function(d,b){if(d instanceof Kekule.BaseStructureNode){var c=this.indexOfNode(b);return this.insertNodeAt(d,c)}else{if(d instanceof Kekule.BaseStructureConnector){var c=this.indexOfConnector(b);return this.insertConnectorAt(d,c)}else{return -1}}},clear:function(){this.clearNodes();this.clearConnectors()},getChildCount:function(){return this.getNodeCount()+this.getConnectorCount()},getChildAt:function(c){var b=this.getNodeCount();if(c<b){return this.getNodeAt(c)}else{return this.getConnectorAt(c-b)}},indexOfChild:function(d){var b;if(d instanceof Kekule.BaseStructureNode){b=this.indexOfNode(d)}else{if(d instanceof Kekule.BaseStructureConnector){b=this.indexOfConnector(d);if(b>=0){var c=this.getNodeCount();b+=c}}else{b=-1}}return b},indexStackOfChild:function(d){var b;if(d instanceof Kekule.BaseStructureNode){b=this.indexStackOfNode(d)}else{if(d instanceof Kekule.BaseStructureConnector){var c=this.getNodeCount();b=this.indexStackOfConnector(d);if(b.length){b[b.length-1]+=c}else{b+=c}}else{b=-1}}return b},getChildAtIndexStack:function(d){d=Kekule.ArrayUtils.toArray(d);if(d.length<=0){return null}else{var e=this.getChildAt(d[0]);for(var c=1,b=d.length;c<b;++c){if(e&&e.getChildAt){e=e.getChildAt(d[c])}else{return null}}return e}},isSubFragment:function(b){return(b.getNodeCount&&(b.getNodeCount()>0))},getSubFragments:function(){var b=[];for(var d=0,c=this.getNodeCount();d<c;++d){var e=this.getNodeAt(d);if(this.isSubFragment(e)){b.push(e)}}return b},hasSubFragments:function(){var b=this.getSubFragments();return b&&b.length},getLeafNodes:function(){var b=[];for(var e=0,d=this.getNodeCount();e<d;++e){var f=this.getNodeAt(e);if(!this.isSubFragment(f)){b.push(f)}else{if(f.getLeafNodes){var c=f.getLeafNodes();b=b.concat(c)}}}return b},findDirectChildOfObj:function(b){var c=b;while(c&&this.indexOfChild(c)<0){c=c.getParent?c.getParent():null}return c},getAllChildConnectors:function(){var b=[].concat(this.getConnectors());var e=this.getSubFragments();for(var d=0,c=e.length;d<c;++d){if(e[d].getAllChildConnectors){b=b.concat(e[d].getAllChildConnectors())}}return b},getAllContainingConnectors:function(){return this.getAllChildConnectors()},getIsotopeMaps:function(){var b=this.getNodes();if(b.length<=0){return[]}else{var h=function(r,n,q,o){var s=false;for(var l=0,i=r.length;l<i;++l){if(n.isSame(r[l].isotope)){s=true;r[l].count+=q;r[l].charge+=o||0}}if(!s){var p={isotope:n,count:q,charge:d.getCharge()||0};r.push(p)}return r};var m=[];for(var f=0,e=b.length;f<e;++f){var d=b[f];if(d instanceof Kekule.StructureFragment){var j=d.getIsotopeMaps();for(var f=0,e=j.length;f<e;++f){m=h(m,j[f].isotope,j[f].count,j[f].charge||0)}}else{if(d instanceof Kekule.Atom){var k=d.getIsotope();m=h(m,d.getIsotope(),1,d.getCharge()||0);var g=d.getHydrogenCount();if(g>0){var c=Kekule.IsotopeFactory.getIsotope(1);m=h(m,c,g,0)}}}}}return m},calcFormula:function(){var f=this.getIsotopeMaps();if(f.length<=0){return null}var b=new Kekule.MolecularFormula();for(var e=0,c=f.length;e<c;++e){var d=new Kekule.Atom();d.setIsotope(f[e].isotope);b.appendSection(d,f[e].count,f[e].charge)}return b},getNodesContainBox:function(b,f,d){var j=(f===Kekule.CoordMode.COORD3D);var k={};for(var g=0,e=b.length;g<e;++g){var c=b[g];var h=c.getAbsCoordOfMode(f,d);if(g==0){k.x1=k.x2=h.x;k.y1=k.y2=h.y;if(j){k.z1=k.z2=h.z}}else{(h.x<k.x1)?k.x1=h.x:((h.x>k.x2)?k.x2=h.x:null);(h.y<k.y1)?k.y1=h.y:((h.y>k.y2)?k.y2=h.y:null);if(j){(h.z<k.z1)?k.z1=h.z:((h.z>k.z2)?k.z2=h.z:null)}}}return k},getContainerBox:function(c,b){return this.getNodesContainBox(this.getNodes(),c,b)},getContainerBox2D:function(c){var b=this.getContainerBox(Kekule.CoordMode.COORD2D,c);b.width=b.x2-b.x1;b.height=b.y2-b.y1;return b},getContainerBox3D:function(c){var b=this.getContainerBox(Kekule.CoordMode.COORD3D,c);b.deltaX=b.x2-b.x1;b.deltaY=b.y2-b.y1;b.deltaZ=b.z2-b.z1;return b},traverse:function(j,b,f,g){var n={nodes:[],connectors:[]};var h="__$ctabTraverseVisited__";var m=a.clone(g||this.getNodes());for(var e=0,c=m.length;e<c;++e){m[e][this.TRAVERS_VISITED_KEY]=false}while(m.length){var d;if(b&&(m.indexOf(b)>=0)){d=b}else{d=m[0]}var k=this._doTravers(j,d,f,g);n.nodes=n.nodes.concat(k.nodes);n.connectors=n.connectors.concat(k.connectors);m=a.exclude(m,k.nodes)}return n},_doTravers:function(d,g,v,o){var f={nodes:[],connectors:[]};var p=g;if(!p[this.TRAVERS_VISITED_KEY]){f.nodes.push(p);p[this.TRAVERS_VISITED_KEY]=true;if(d){d(p,false)}}var r=a.clone(p.getLinkedConnectors());var h=this.getConnectors();r.sort(function(j,i){return h.indexOf(j)-h.indexOf(i)});var c=[];for(var u=0,q=r.length;u<q;++u){var b=r[u];var w=p.getLinkedObjsOnConnector(b);if(o){w=a.intersect(w,o)}for(var t=0,s=w.length;t<s;++t){var e=w[t];if(e instanceof Kekule.BaseStructureNode){break}}if(!e){continue}if(!e[this.TRAVERS_VISITED_KEY]){f.nodes.push(e);f.connectors.push(b);e[this.TRAVERS_VISITED_KEY]=true;if(d){d(b,true);d(e,false)}if(v){c.push(e)}else{var x=this._doTravers(d,e,v,o);f.nodes=f.nodes.concat(x.nodes);f.connectors=f.connectors.concat(x.connectors)}}}if(v){for(var u=0,q=c.length;u<q;++u){var m=c[u];var x=this._doTravers(d,m,v,o);f.nodes=f.nodes.concat(x.nodes);f.connectors=f.connectors.concat(x.connectors)}}return f}});Kekule.StructureFragment=Class.create(Kekule.ChemStructureNode,{CLASS_NAME:"Kekule.StructureFragment",initialize:function($super,d,b,c){$super(d,b,c)},doFinalize:function($super){if(this.hasFormula()){this.getFormula().finalize()}if(this.hasCtab()){this.getCtab().finalize()}$super()},initProperties:function(){this.defineProp("formula",{dataType:"Kekule.MolecularFormula",getter:function(b){if(!this.getPropStoreFieldValue("formula")){if(b){this.createFormula()}}return this.getPropStoreFieldValue("formula")},setter:function(c){var b=this.getPropStoreFieldValue("formula");if(b){b.finalize();b=null}if(c){c.setPropValue("parent",this,true);c.addEventListener("change",function(d){this.notifyPropSet("formula",this.getFormula())},this)}this.setPropStoreFieldValue("formula",c)}});this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",getter:function(b){if(!this.getPropStoreFieldValue("ctab")){if(b){this.createCtab()}}return this.getPropStoreFieldValue("ctab")},setter:function(c){var b=this.getPropStoreFieldValue("ctab");if(b){b.finalize();b=null}if(c){c.setPropValue("parent",this,true);c.setOwner(this.getOwner());c.addEventListener("propValueSet",function(d){if((d.propName=="nodes")||(d.propName=="anchorNodes")||(d.propName=="connectors")){this.notifyPropSet(d.propName,d.propValue)}},this);c.setEnablePropValueSetEvent(true)}this.setPropStoreFieldValue("ctab",c)}});this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}});this.defineProp("anchorNodes",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getAnchorNodes():[]}});this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}});this.defineProp("crossConnectors",{dataType:DataType.ARRAY,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var b=[].concat(this.getPropStoreFieldValue("linkedConnectors"));for(var g=0,d=this.getNodeCount();g<d;++g){var h=this.getNodeAt(g);var c=h.getLinkedConnectors()||[];for(var f=0,e=c.length;f<e;++f){if(this.indexOfConnector(c[f])<0){Kekule.ArrayUtils.pushUnique(b,c[f])}}}return b}});this.defineProp("nonHydrogenNodes",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNonHydrogenNodes():[]}});this.defineProp("nonHydrogenConnectors",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNonHydrogenConnectors():[]}});this.defineProp("canonicalizationInfo",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("aromaticRings",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var b=this.getPropStoreFieldValue("aromaticRings");if(!b){b=[];this.setPropStoreFieldValue("aromaticRings",b)}return b}});this.defineProp("flattenedShadow",{dataType:"Kekule.StructureFragmentShadow",serializable:false,scope:Class.PropertyScope.PRIVATE,getter:function(e){var b=null;if(Kekule.ObjUtils.isUnset(e)){e=true}var c=this.getFlattenedShadowOnSelf();if(c){return null}else{b=this.getPropStoreFieldValue("flattenedShadow");if(!b&&e){b=new Kekule.StructureFragmentShadow(this);var d=b.getShadowFragment();d.unmarshalAllSubFragments(true);this._copyAdditionalInfoToShadowFragment(d,b.getSourceToShadowMap(),b.getShadowToSourceMap());this.setPropStoreFieldValue("flattenedShadow",b)}}return b}});this.defineProp("flattenedShadowOnSelf",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PROVATE,setter:null,getter:function(){var b=this.setPropStoreFieldValue("flattenedShadowOnSelf");if(Kekule.ObjUtils.isUnset(b)){b=!this.hasSubFragments();this.setPropStoreFieldValue("flattenedShadowOnSelf",b)}return b}})},getAutoIdPrefix:function(){return"f"},getStructureRelatedPropNames:function($super){return $super().concat(["ctab","formula","nodes","anchorNodes","connectors"])},doCompare:function($super,m,e){var n=$super(m,e);if(!n&&e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){var x=this.hasCtab();var w=m.hasCtab&&m.hasCtab();n=x?(w?0:1):(w?-1:0);if(!n){var q=this.hasFormula();var p=m.hasFormula&&m.hasFormula();n=q?(p?0:1):(p?-1:0)}if(!n&&this.hasCtab()){if((n===0)&&(this.getNonHydrogenNodes&&m.getNonHydrogenNodes)){var v=this.getNonHydrogenNodes();var u=m.getNonHydrogenNodes();n=v.length-u.length;if(n===0){for(var t=0,r=v.length;t<r;++t){n=this.doCompareOnValue(v[t],u[t],e);if(n!==0){break}}}}if((n===0)&&(this.getConnectors&&m.getConnectors)){var g=this.getNonHydrogenConnectors();var f=m.getNonHydrogenConnectors();n=g.length-f.length;if(n===0){for(var t=0,r=g.length;t<r;++t){n=this.doCompareOnValue(g[t],f[t],e);if(n!==0){break}}}}if(n===0){var j=this.getNonHydrogenNodes();var o=m.getNonHydrogenNodes();var h=this.traverse(null,j[j.length-1],true,j);var k=m.traverse(null,o[o.length-1],true,o);for(var t=0,r=h.nodes.length;t<r;++t){var d=h.nodes[t];var s=k.nodes[t];n=this.doCompareOnValue(d,s,e);if(n!==0){break}}if(n===0){for(var t=0,r=h.connectors.length;t<r;++t){var b=h.connectors[t];var c=k.connectors[t];n=this.doCompareOnValue(b,c,e);if(n!==0){break}}}}}}return n},structureChange:function($super,b){this.setPropStoreFieldValue("flattenedShadowOnSelf",null);var c=this.getFlattenedShadow(false);if(c){c.finalize();this.setPropStoreFieldValue("flattenedShadow",null)}$super(b)},clearStructureFlags:function($super){$super();this.setPropStoreFieldValue("canonicalizationInfo",null);this.setPropStoreFieldValue("aromaticRings",[]);for(var d=0,b=this.getChildCount();d<b;++d){var e=this.getChildAt(d);if(e.clearStructureFlags){e.clearStructureFlags()}}},ownerChanged:function($super,b){if(this.hasCtab()){this.getCtab().setOwner(b)}$super(b)},_removeChildObj:function(c){if(this.hasFormula()){var d=this.getFormula();if(d===c){this.removeFormula()}}else{if(this.hasCtab()){var b=this.getCtab();if(b===c){this.removeCtab()}else{if(b.hasChildObj(c)){b.removeChildObj(c)}}}}},isEmpty:function(){var b;b=!this.hasFormula();if(b){b=!this.hasCtab();if(!b){b=this.getCtab().isEmpty()}}return b},isCtabEmpty:function(){return !this.hasCtab()||this.getCtab().isEmpty()},doGetLinkedConnectors:function(){return this.getCrossConnectors()},appendLinkedConnector:function($super,b){var c=this.getCurrConnectableObj();if(c&&c!==this){return c.appendLinkedConnector(b)}else{return $super(b)}},getCurrConnectableObj:function(){var k=(this.getAnchorNodeCount()>0)?this.getAnchorNodes():this.getNodes();if(k.length<=0){return this}else{var b=this.getCrossConnectors();var d=null;var h=null;for(var j=0,f=k.length;j<f;++j){var e=k[j];var c=e.getLinkedConnectors();var g=Kekule.ArrayUtils.intersect(c,b);var m=g.length;if(d===null||d>m){d=m;h=e}}return h}},createCtab:function(){var b=new Kekule.StructureConnectionTable(this.getOwner(),this);this.setCtab(b)},createFormula:function(){var b=new Kekule.MolecularFormula(this);this.setFormula(b)},hasCtab:function(){return(!!this.getPropStoreFieldValue("ctab"))},hasFormula:function(){return(!!this.getPropStoreFieldValue("formula"))},removeFormula:function(){var b=this.getPropStoreFieldValue("formula");if(b){b.finalize();b=null;this.setPropStoreFieldValue("formula",null)}return this},removeCtab:function(){var b=this.getPropStoreFieldValue("ctab");if(b){b.finalize();b=null;this.setPropStoreFieldValue("ctab",null)}return this},getContainerBox:function($super,c,b){if(this.hasCtab()){return this.getCtab().getContainerBox(c,b)}else{return $super(c)}},getNodeById:function(b){return this.hasCtab()?this.getCtab().getNodeById(b):null},getConnectorById:function(b){return this.hasCtab()?this.getCtab().getConnectorById(b):null},getObjectById:function(c){var b=this.getNodeById(c);return b?b:this.getConnectorById(c)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(b){return this.hasCtab()?this.getCtab().getNodeAt(b):null},indexOfNode:function(b){return this.hasCtab()?this.getCtab().indexOfNode(b):-1},hasNode:function(c,b){return this.hasCtab()?the.getCtab().hasNode(c,b):null},indexStackOfNode:function(b){return this.hasCtab()?this.getCtab().indexStackOfNode(b):-1},getNodeAtIndexStack:function(b){return this.hasCtab()?this.getCtab().getNodeAtIndexStack(b):null},getDirectChildOfNestedNode:function(b){var d=b.getParent();if(!d){return null}else{if(d===this){return d}else{var c=b;while(d&&(d.getParent)&&(d!==this)){c=d;d=d.getParent()}if(d===this){return c}else{return null}}}},appendNode:function(b){return this.doGetCtab(true).appendNode(b)},insertNodeAt:function(c,b){return this.doGetCtab(true).insertNodeAt(c,b)},removeNodeAt:function(c,b){if(!this.hasCtab()){return null}return this.getCtab().removeNodeAt(c,b)},removeNode:function(c,b){if(!this.hasCtab()){return null}return this.getCtab().removeNode(c,b)},replaceNode:function(c,b){if(!this.hasCtab()){return null}return this.getCtab().replaceNode(c,b)},clearNodes:function(){if(this.hasCtab()){return this.getCtab().clearNodes()}},sortNodes:function(b){if(this.hasCtab()){return this.getCtab().sortNodes(b)}},nodesHasCoord2D:function(b){if(!this.hasCtab()){return false}return this.getCtab().nodesHasCoord2D(b)},nodesHasCoord3D:function(b){if(!this.hasCtab()){return false}return this.getCtab().nodesHasCoord3D(b)},isNodeInAromaticRing:function(e){var f=this.getAromaticRings();for(var d=0,b=f.length;d<b;++d){var c=f[d].nodes;if(c.indexOf(e)>=0){return true}}return false},appendAtom:function(b,c,d,e){return this.doGetCtab(true).appendAtom(b,c,d,e)},getAnchorNodeCount:function(){return this.hasCtab()?this.getCtab().getAnchorNodeCount():0},getAnchorNodeAt:function(b){return this.hasCtab()?this.getCtab().getAnchorNodeAt(b):null},indexOfAnchorNode:function(b){return this.hasCtab()?this.getCtab().indexOfAnchorNode(b):-1},appendAnchorNode:function(b){return this.doGetCtab(true).appendAnchorNode(b)},removeAnchorNodeAt:function(b){if(!this.hasCtab()){return null}return this.getCtab().removeAnchorNodeAt(b)},removeAnchorNode:function(b){if(!this.hasCtab()){return null}return this.getCtab().removeAnchorNode(b)},clearAnchorNodes:function(){if(this.hasCtab()){return this.getCtab().clearAnchorNodes()}},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(b){return this.hasCtab()?this.getCtab().getConnectorAt(b):null},indexOfConnector:function(b){return this.hasCtab()?this.getCtab().indexOfConnector(b):-1},hasConnector:function(b,c){return this.hasCtab()?this.getCtab().hasConnector(b,c):null},appendConnector:function(b){return this.doGetCtab(true).appendConnector(b)},insertConnectorAt:function(b,c){return this.doGetCtab(true).insertConnectorAt(b,c)},removeConnectorAt:function(c,b){if(!this.hasCtab()){return null}return this.getCtab().removeConnectorAt(c,b)},removeConnector:function(c,b){if(!this.hasCtab()){return null}return this.getCtab().removeConnector(c,b)},clearConnectors:function(){if(this.hasCtab()){return this.getCtab().clearConnectors()}},sortConnectors:function(b){if(this.hasCtab()){return this.getCtab().sortConnectors(b)}},isConnectorInAromaticRing:function(d){var f=this.getAromaticRings();for(var e=0,c=f.length;e<c;++e){var b=f[e].connectors;if(b.indexOf(d)>=0){return true}}return false},appendBond:function(d,c,b){return this.doGetCtab(true).appendBond(d,c,b)},insertBefore:function($super,d,c){var b=-1;if(this.hasCtab()&&(d instanceof Kekule.ChemStructureObject)&&(!c||c instanceof Kekule.ChemStructureObject)){b=this.getCtab().insertBefore(d,c)}if(b<0){b=$super(d,c)}return b},_getObjsNeedToBeCascadeRemoved:function(c,b){if(this.hasCtab()){return this.getCtab()._getObjsNeedToBeCascadeRemoved(c,b)}else{return[]}},removeChildObj:function(d,c,b){if(this.hasCtab()){this.getCtab().removeChildObj(d,c,b)}},removeChild:function($super,b){return this.removeChildObj(b)||$super(b)},hasChildObj:function(b){if(this.hasCtab()){return this.getCtab().hasChildObj(b)}else{return false}},getNextSiblingOfChild:function(b){if(this.hasCtab()){return this.getCtab().getNextSiblingOfChild(b)}else{return null}},getChildCount:function(){if(this.hasCtab()){return this.getCtab().getChildCount()}else{return 0}},getChildAt:function(b){if(this.hasCtab()){return this.getCtab().getChildAt(b)}else{return null}},indexOfChild:function(b){if(this.hasCtab()){return this.getCtab().indexOfChild(b)}else{return -1}},isSubFragment:function(b){return(b.getNodeCount&&(b.getNodeCount()>0))},getSubFragments:function(){return this.hasCtab()?this.getCtab().getSubFragments():[]},hasSubFragments:function(){return this.hasCtab()?this.getCtab().hasSubFragments():false},getLeafNodes:function(){return this.hasCtab()?this.getCtab().getLeafNodes():[]},findDirectChildOfObj:function(b){return this.hasCtab()?this.getCtab().findDirectChildOfObj(b):null},getAllChildConnectors:function(){return this.hasCtab()?this.getCtab().getAllChildConnectors():[]},getAllContainingConnectors:function(){return this.hasCtab()?this.getCtab().getAllContainingConnectors():[]},clear:function(){if(this.hasCtab()){this.setCtab(undefined)}if(this.hasFormula()){this.setFormula(undefined)}},clean:function(b){var c=Object.extend({},Kekule.globalOptions.algorithm.structureClean.structureCleanOptions);c=Object.extend(c,b||{});return this.doClean(c)},doClean:function(c){if(c.hangingChemConnector){for(var d=this.getConnectorCount()-1;d>=0;--d){var f=this.getConnectorAt(d);if(f instanceof Kekule.ChemStructureConnector){if(f.getConnectedObjCount()<2){this.removeConnectorAt(d)}}}}var b=this.getNodeCount();for(var d=b-1;d>=0;--d){var e=this.getNodeAt(d);if(e instanceof Kekule.ChemStructureNode){if(this.isSubFragment(e)&&e.doClean){e.doClean(c)}else{if(c.orphanChemNode){if(e.getLinkedConnectorCount()<1&&b>1){this.removeNodeAt(d)}}}}}return this},calcFormula:function(){if(this.hasCtab()){return this.getCtab().calcFormula()}else{if(this.hasFormula()){return this.getFormula()}else{return null}}},marshalSubFragment:function(g,o){if(this.hasCtab()){this.beginUpdate();try{this.appendNode(o);var q=[];var h=[];var c=[];var e=[];for(var x=0,t=g.length;x<t;++x){var r=g[x];if(this.indexOfNode(r)<0){continue}var y=false;var u=r.getLinkedConnectors();for(var w=0,v=u.length;w<v;++w){var b=u[w];var z=false;var d=b.getConnectedObjs();for(var s=0,p=d.length;s<p;++s){var f=d[s];if(f!=r){if(g.indexOf(f)<0){y=true;z=true}}}if(z){Kekule.ArrayUtils.pushUnique(e,b)}else{Kekule.ArrayUtils.pushUnique(c,b)}}Kekule.ArrayUtils.pushUnique(q,r);if(y){Kekule.ArrayUtils.pushUnique(h,r)}}for(var x=c.length-1;x>=0;--x){this.removeConnector(c[x],true)}for(var x=q.length-1;x>=0;--x){this.removeNode(q[x],true)}o.beginUpdate();try{for(var x=0,t=q.length;x<t;++x){o.appendNode(q[x])}for(var x=0,t=h.length;x<t;++x){o.appendAnchorNode(h[x])}for(var x=0,t=c.length;x<t;++x){o.appendConnector(c[x])}}finally{o.endUpdate()}}finally{this.endUpdate()}return o}else{return null}},unmarshalSubFragment:function(d,b){if(this.hasCtab()){this.beginUpdate();try{d.beginUpdate();try{if(b&&d.unmarshalAllSubFragments){d.unmarshalAllSubFragments(b)}var c=this.getCtab();Kekule.StructureFragment.moveChildBetweenStructFragment(d,this,d.getNodes(),d.getConnectors(),true);d.clear();c.removeNode(d)}finally{d.endUpdate();d.finalize()}}finally{this.endUpdate()}}},unmarshalAllSubFragments:function(d){var c=this.getSubFragments();if(c){for(var e=0,b=c.length;e<b;++e){this.unmarshalSubFragment(c[e],d)}}},recalcCoords:function(){if(this.hasCtab()){this.beginUpdate();try{var k={};var f={};var h=this.getAnchorNodeCount();for(var g=0,e=h;g<e;++g){var c=this.getAnchorNodeAt(g);k=Kekule.CoordUtils.add(k,c.getCoord2D()||{});f=Kekule.CoordUtils.add(f,c.getCoord3D()||{})}var j=Kekule.ObjUtils.notUnset;var d=(j(k.x)||j(k.y));var n=(j(f.x)||j(f.y)||j(f.z));if(d){var b=Kekule.CoordUtils.substract({},k);this.setCoord2D(Kekule.CoordUtils.substract(this.fetchCoord2D(),b))}if(n){var m=Kekule.CoordUtils.substract({},f);this.setCoord3D(Kekule.CoordUtils.substract(this.fetchCoord3D(),m))}for(var g=0,e=this.getNodeCount();g<e;++g){var c=this.getNodeAt(g);if(d){c.setCoord2D(Kekule.CoordUtils.add(c.fetchCoord2D(),b))}if(n){c.setCoord3D(Kekule.CoordUtils.add(c.fetchCoord3D(),m))}}}finally{this.endUpdate()}}},_copyAdditionalInfoToShadowFragment:function(s,p,r){var m=this;var g=m.getAromaticRings();if(g&&g.length){var q=[];for(var n=0,e=g.length;n<e;++n){var o=g[n];var d=[],c=[];for(var h=0,f=o.nodes.length;h<f;++h){var b=p.get(o.nodes[h]);if(b){d.push(b)}}for(var h=0,f=o.connectors.length;h<f;++h){var b=p.get(o.connectors[h]);if(b){c.push(b)}}q.push({nodes:d,connectors:c})}s.setAromaticRings(q)}},getFlattenedShadowFragment:function(b){if(this.getFlattenedShadowOnSelf()){return this}else{var c=this.getFlattenedShadow(b);return c?c.getShadowFragment():null}},getFlatternedShadowShadowObj:function(b,c){if(this.getFlattenedShadowOnSelf()){return b}else{var d=this.getFlattenedShadow(c);return d?d.getShadowObj(b):null}},getFlatternedShadowSourceObj:function(c,b){if(this.getFlattenedShadowOnSelf()){return c}else{var d=this.getFlattenedShadow(b);return d?d.getSourceObj(c):null}},getFlatternedShadowShadowObjs:function(c,f){if(this.getFlattenedShadowOnSelf()){return c}else{var g=this.getFlattenedShadow(f);var b=[];if(g){for(var e=0,d=c.length;e<d;++e){b.push(g.getShadowObj(c[e]))}}return b}},getFlatternedShadowSourceObjs:function(c,f){if(this.getFlattenedShadowOnSelf()){return c}else{var g=this.getFlattenedShadow(f);var b=[];if(g){for(var e=0,d=c.length;e<d;++e){b.push(g.getSourceObj(c[e]))}}return b}},traverse:function(e,c,d,b){if(this.hasCtab()){return this.getCtab().traverse(e,c,d)}else{return null}}});Kekule.StructureFragment.moveChildBetweenStructFragment=function(x,m,A,f,d){var y=Kekule.CoordUtils;x.beginUpdate();m.beginUpdate();var b=x.getAnchorNodes();try{var k=x.getAbsCoord2D();var t=x.getAbsCoord3D();var z=m.getAbsCoord2D();var j=m.getAbsCoord3D();var o=y.substract(k,z);var w=y.substract(t,j);var p=Kekule.ArrayUtils.clone(A);var s=Kekule.ArrayUtils.clone(f);for(var u=0,r=p.length;u<r;++u){var q=p[u];var h=x.indexOfNode(q);if(h>=0){x.removeNodeAt(h,true);var v=q.getCoord2D();if(v){var e=y.add(v,o);q.setCoord2D(e)}var g=q.getCoord3D();if(g){var n=y.add(g,w);q.setCoord2D(n)}m.appendNode(q);if(b.indexOf(q)>=0){x.removeAnchorNode(q);if(!d){m.appendAnchorNode(q)}}}}for(var u=0,r=s.length;u<r;++u){var c=s[u];var h=x.indexOfConnector(c);if(h>=0){x.removeConnectorAt(h,true);m.appendConnector(c)}}}finally{m.endUpdate();x.endUpdate()}};Kekule.StructureFragmentShadow=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureFragmentShadow",initialize:function($super,c){if(!c){Kekule.error(Kekule.$L("ErrorMsg.SOURCE_FRAGMENT_NOT_SET"));return}$super();this.setPropStoreFieldValue("shadowToSourceMap",new Kekule.MapEx());this.setPropStoreFieldValue("sourceToShadowMap",new Kekule.MapEx());var b=this._createShadowFragment(c,this.getSourceToShadowMap(),this.getShadowToSourceMap());this.setPropStoreFieldValue("shadowFragment",b)},doFinalize:function($super){this.getShadowToSourceMap().finalize();this.getSourceToShadowMap().finalize();this.getShadowFragment().finalize();this.setPropStoreFieldValue("shadowToSourceMap",null);this.setPropStoreFieldValue("sourceToShadowMap",null);this.setPropStoreFieldValue("shadowFragment",null);$super()},initProperties:function(){this.defineProp("shadowFragment",{dataType:"Kekule.StructureFragment",setter:null});this.defineProp("sourceToShadowMap",{dataType:"Kekule.MapEx",setter:null});this.defineProp("shadowToSourceMap",{dataType:"Kekule.MapEx",setter:null})},_createShadowFragment:function(d,c,e){var b=d.clone();this._mapFragmentChildren(d,b,c,e);return b},_mapFragmentChildren:function(h,j,c,g){for(var e=0,b=h.getChildCount();e<b;++e){var d=h.getChildAt(e);var f=j.getChildAt(e);c.set(d,f);g.set(f,d);if(d.getChildCount&&f.getChildCount){this._mapFragmentChildren(d,f,c,g)}}},getShadowObj:function(b){return this.getSourceToShadowMap().get(b)},getSourceObj:function(b){return this.getShadowToSourceMap().get(b)}});Kekule.SubGroup=Class.create(Kekule.StructureFragment,{CLASS_NAME:"Kekule.SubGroup",initialize:function($super,f,c,b,d,e){$super(f,d,e);this.setPropStoreFieldValue("abbr",c);this.setPropStoreFieldValue("name",b)},initProperties:function(){this.defineProp("abbr",{dataType:DataType.STRING});this.defineProp("formulaText",{dataType:DataType.STRING});this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"g"},doPropChanged:function($super,b,c){if(b=="anchorNodes"){this.recalcCoords()}return $super(b,c)},getLabel:function(){return Kekule.ChemStructureNodeLabels.SUBGROUP}});Kekule.RGroup=Kekule.SubGroup;Kekule.Molecule=Class.create(Kekule.StructureFragment,{CLASS_NAME:"Kekule.Molecule",initialize:function($super,d,b,c){$super(d);this.setPropStoreFieldValue("name",b);if(c){this.setCtab(new Kekule.StructureConnectionTable())}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"m"}});Kekule.BaseStructureConnector=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.BaseStructureConnector",initialize:function($super,c,b){$super(c);this.setConnectedObjs(b||[])},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var g=this.getPropStoreFieldValue("connectedObjs");if(!g){this.setPropStoreFieldValue("connectedObjs",[]);g=this.getPropStoreFieldValue("connectedObjs")}for(var d=0,b=g.length;d<b;++d){g[d].removeLinkedConnector(this)}if(e){for(var d=0,b=e.length;d<b;++d){this.assertConnectedObjLegal(e[d])}for(var d=0,b=e.length;d<b;++d){var f=e[d];var c=f.getCurrConnectableObj?f.getCurrConnectableObj():f;Kekule.ArrayUtils.pushUnique(g,c)}}else{this.setPropStoreFieldValue("connectedObjs",[])}g=this.getPropStoreFieldValue("connectedObjs");for(var d=0,b=g.length;d<b;++d){g[d].appendLinkedConnector(this)}this.notifyConnectedObjsChanged()}})},getAutoIdPrefix:function(){return"c"},getStructureRelatedPropNames:function($super){return $super().concat(["connectedObjs"])},doCompare:function($super,e,c){var b=$super(e,c);if(!b&&c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(c,"connectedObjCount")){var f=this.getConnectedObjCount();var d=e.getConnectedObjCount&&e.getConnectedObjCount();b=this.doCompareOnValue(f,d,c)}}return b},notifyConnectedObjsChanged:function(){this.notifyPropSet("connectedObjs",this.getPropStoreFieldValue("connectedObjs"))},assertConnectedObjLegal:function(b){if((!b)||(!b.getOwner)){Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.UNABLE_ADD_MISTYPED_NODE"):"Unable to link mistyped node to connector")}else{if(b.getOwner()&&b.getOwner()!=this.getOwner()){Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.UNABLE_ADD_DIFF_OWNER_OBJ"):"Object with different owner can not be linked to connector");return false}else{return true}}},connectedObjAdded:function(b){this.notifyConnectedObjsChanged()},getConnectedObjCount:function(){return this.getConnectedObjs().length},indexOfConnectedObj:function(b){return this.getConnectedObjs().indexOf(b)},getConnectedObjAt:function(b){return this.getConnectedObjs()[b]},setConnectedObjAt:function(b,d){this.assertConnectedObjLegal(d);var c=this.getConnectedObjs()[b];if(c){c.removeLinkedConnector(this)}this.insertConnectedObjAt(d,b);this.connectedObjAdded(d)},appendConnectedObj:function(d){this.assertConnectedObjLegal(d);var c=d.getCurrConnectableObj?d.getCurrConnectableObj():d;var b=this._doAppendConnectedObj(c);if(c){c.appendLinkedConnector(this)}return b},_doAppendConnectedObj:function(c){var b=Kekule.ArrayUtils.pushUniqueEx(this.getConnectedObjs(),c);if(b.isPushed){this.connectedObjAdded(c)}return b.index},insertConnectedObjAt:function(e,c){this.assertConnectedObjLegal(e);var b=e.getCurrConnectableObj?e.getCurrConnectableObj():e;var d=this.indexOfConnectedObj(b);var f=this.getConnectedObjs();if(d>=0){f.splice(d,1);f.splice(c,0,b);this.notifyConnectedObjsChanged()}else{f.splice(c,0,b);if(b){b.appendLinkedConnector(this)}this.connectedObjAdded(b)}},removeConnectedObjAt:function(b){var c=this.getConnectedObjs()[b];if(c){this._doRemoveConnectedObjAt(b);c._doRemoveLinkedConnectorAt(c.indexOfLinkedConnector(this));this.notifyConnectedObjsChanged()}},_doRemoveConnectedObjAt:function(b){this.getConnectedObjs().splice(b,1)},removeConnectedObj:function(c){var b=this.getConnectedObjs().indexOf(c);if(b>=0){this.removeConnectedObjAt(b)}},replaceConnectedObj:function(b,c){var d=this.indexOfConnectedObj(b);if(d>=0){this.setConnectedObjAt(d,c)}},clearConnectedObjs:function(){this.setConnectedObjs([])},hasConnectedObj:function(b){return(this.getConnectedObjs().indexOf(b)>=0)},isConnectingWithObj:function(b){return this.hasConnectedObj(b)},sortConnectedObjs:function(b){this.getConnectedObjs().sort(b)},reverseConnectedObjOrder:function(){this.setPropStoreFieldValue("connectedObjs",Kekule.ArrayUtils.reverse(this.getConnectedObjs()));this.notifyConnectedObjsChanged()},removeThisFromConnectedObjs:function(){for(var b=this.getConnectedObjCount()-1;b>=0;--b){var c=this.getConnectedObjAt(b);c.removeLinkedConnector(this)}},getConnectedSiblings:function(){var j=this.getConnectedObjs();var b=[];var f=this.getParent();var e=function(k){if(k.getParent){var i=k.getParent();if(i===f){return i}else{return e(i)}}else{return k}};for(var d=0,c=j.length;d<c;++d){var g=j[d];if(!g.getParent||(g.getParent()===f)){b.push(g)}else{var h=e(g);if(h){b.push(h)}}}return b},isConnectingConnector:function(){for(var c=0,b=this.getConnectedObjCount();c<b;++c){var d=this.getConnectedObjAt(c);if(d instanceof Kekule.ChemStructureConnector){return true}}return false}});Kekule.ChemStructureConnector=Class.create(Kekule.BaseStructureConnector,{CLASS_NAME:"Kekule.ChemStructureConnector",initProperties:function(){this.defineProp("parity",{dataType:DataType.INT});this.defineProp("connectedChemNodes",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var b=[];for(var d=0,c=this.getConnectedObjCount();d<c;++d){var e=this.getConnectedObjAt(d);if(e instanceof Kekule.ChemStructureNode){b.push(e)}}return b}})},doCompare:function($super,e,c){var b=$super(e,c);if(!b&&c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(c,"stereo")){var f=this.getParity()||Kekule.StereoParity.UNKNOWN;var d=(e.getParity&&e.getParity())||Kekule.StereoParity.UNKNOWN;b=this.doCompareOnValue(f,d,c)}}return b},clearStructureFlags:function(){this.setParity(Kekule.StereoParity.NONE)},getConnectedChemNodeCount:function(){return this.getConnectedChemNodes().length},getConnectedNonHydrogenObjs:function(){var b=[];var f=this.getConnectedObjs();for(var d=0,c=f.length;d<c;++d){var e=f[d];if(!e.isHydrogenAtom||!e.isHydrogenAtom()){b.push(e)}}return b},isNormalConnectorToHydrogen:function(){return this.getConnectedNonHydrogenObjs().length<=1}});Kekule.BondStereo={NONE:0,UP:1,UP_INVERTED:2,DOWN:3,DOWN_INVERTED:4,UP_OR_DOWN:8,UP_OR_DOWN_INVERTED:9,CLOSER:10,E_OR_Z:20,E:21,Z:22,E_Z_BY_COORDINATES:23,CIS_OR_TRANS:30,CIS:31,TRANS:32,getInvertedDirection:function(c){var b=Kekule.BondStereo;switch(c){case b.UP:return b.UP_INVERTED;case b.UP_INVERTED:return b.UP;case b.DOWN:return b.DOWN_INVERTED;case b.DOWN_INVERTED:return b.DOWN;case b.UP_OR_DOWN:return b.UP_OR_DOWN_INVERTED;default:return c}}};Kekule.Bond=Class.create(Kekule.ChemStructureConnector,{CLASS_NAME:"Kekule.Bond",initialize:function($super,f,d,c,e,b){$super(f,d||[]);if(c||e||b){this.setBondForm(Kekule.BondFormFactory.getBondForm(c,e,b))}},initProperties:function(){this.defineProp("bondForm",{dataType:"Kekule.BondForm",serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("bondType",{dataType:DataType.STRING,enumSource:Kekule.BondType,getter:function(){var b=this.getBondForm();return b?b.getBondType():Kekule.BondType.DEFAULT},setter:function(b){this.changeBondForm(this.getBondOrder(),Kekule.ElectronSet.UNSET_ELECTRONCOUNT,b)}});this.defineProp("bondOrder",{dataType:DataType.INT,enumSource:Kekule.BondOrder,getter:function(){var b=this.getBondForm();return b?b.getBondOrder():Kekule.BondOrder.UNSET},setter:function(b){this.changeBondForm(b,Kekule.ElectronSet.UNSET_ELECTRONCOUNT,this.getBondType())}});this.defineProp("bondValence",{dataType:DataType.INT,serializable:false,getter:function(){var b=this.getBondForm();return b?b.getBondValence():0},setter:null});this.defineProp("electronCount",{dataType:DataType.FLOAT,getter:function(){if(this.isAromatic()){return 3}var b=this.getBondForm();return b?b.getElectronCount():Kekule.ElectronSet.UNSET_ELECTRONCOUNT},setter:function(c){var b=this.getBondOrder();this.changeBondForm(b,c,this.getBondType())}});this.defineProp("stereo",{dataType:DataType.INT,enumSource:Kekule.BondStereo,defaultValue:Kekule.BondStereo.NONE});this.defineProp("isInAromaticRing",{dataType:DataType.BOOL,setter:null,getter:function(){var b=false;var c=this.getParent();if(c&&c.isConnectorInAromaticRing){return c.isConnectorInAromaticRing(this)}else{return false}}})},initPropValues:function($super){$super();this.setPropStoreFieldValue("stereo",Kekule.BondStereo.NONE)},getAutoIdPrefix:function(){return"b"},getStructureRelatedPropNames:function($super){return $super().concat(["bondForm","stereo"])},clearStructureFlags:function(){this.setPropStoreFieldValue("isInAromaticRing",null)},doGetParity:function($super){if(this.isDoubleBond()){return $super()}else{return null}},doGetComparisonPropNames:function($super,c){var b=$super(c);if(c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(c,"bondType")){b.push("bondType")}}return b},doCompare:function($super,g,e){var c=$super(g,e);if(!c&&e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(e,"connectedObjCount")){var h=this.getConnectedObjCount();var f=g.getConnectedObjCount&&g.getConnectedObjCount();c=this.doCompareOnValue(h,f,e)}if(!c&&this._getComparisonOptionFlagValue(e,"bondOrder")){var d=Math.round(this.getElectronCount());var b=Math.round(g.getElectronCount());c=this.doCompareOnValue(d,b,e)}}return c},changeBondForm:function(c,d,b){this.setBondForm(Kekule.BondFormFactory.getBondForm(c,d,b))},canInvertBondDirection:function(){var b=Kekule.BondType;var c=this.getBondType();return[b.COVALENT,b.IONIC,b.METALLIC,b.HYDROGEN,b.UNKNOWN].indexOf(c)>=0},invertBondDirection:function(){this.setStereo(Kekule.BondStereo.getInvertedDirection(this.getStereo()))},reverseConnectedObjOrder:function($super){if(this.canInvertBondDirection()){$super();this.invertBondDirection()}else{}},normalizeDirection:function(){var c=Kekule.BondStereo;var b=[c.UP_INVERTED,c.DOWN_INVERTED,c.UP_OR_DOWN_INVERTED];var e=this.getBondStereo();if(b.indexOf(e)>=0){this.reverseConnectedObjOrder()}},isSingleBond:function(){return(this.getBondType()===Kekule.BondType.COVALENT)&&(this.getBondOrder()===Kekule.BondOrder.SINGLE)&&(!this.getIsInAromaticRing())},isDoubleBond:function(){return(this.getBondType()===Kekule.BondType.COVALENT)&&(this.getBondOrder()===Kekule.BondOrder.DOUBLE)&&(!this.getIsInAromaticRing())},isTripleBond:function(){return(this.getBondType()===Kekule.BondType.COVALENT)&&(this.getBondOrder()===Kekule.BondOrder.TRIPLE)},isAromatic:function(){return(!!this.getIsInAromaticRing()||(this.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC))&&(this.getBondType()===Kekule.BondType.COVALENT)},isBondBetween:function(f,e){var j=this.getConnectedObjs();if(j.length!==2){return false}var d,c;for(var g=0,b=j.length;g<b;++g){var h=j[g];if(h instanceof Kekule.Atom){if(h.isElement(f)){d=true}else{if(h.isElement(e)){c=true}}if(d&&c){return true}}}return false}});Kekule.ChemStructureObjectGroup=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.ChemStructureObject","Kekule.ChemStructureObjectGroup"],initialize:function($super,b){$super(b);this.setPropStoreFieldValue("items",[]);this.setPropStoreFieldValue("raiseExceptionOnTypeMismatch",[])},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY});this.defineProp("raiseExceptionOnTypeMismatch",{dataType:DataType.BOOL,defaultValue:true,scope:Class.PropertyScope.PUBLIC})},getAutoIdPrefix:function(){return"sg"},getStructureRelatedPropNames:function($super){return $super().concat(["items"])},doGetComparisonPropNames:function($super,c){var b=$super(c);if(c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){b.push("items")}return b},ownerChanged:function($super,c){var d=this.getItems();for(var e=0,b=d.length;e<b;++e){var f=d[e].obj;if(f&&f.setOwner){f.setOwner(c)}}$super(c)},_removeChildObj:function(c){var b=this.indexOfObj(c);if(b<0){b=this.indexOfItem(c)}if(b>=0){this.removeObjAt(b)}},getObjectBaseClasses:function(){return this.getPrototype().ITEM_BASE_CLASSES},ensureItemClass:function(e){var d=this.getObjectBaseClasses();if(d.length>0){for(var c=0,b=d.length;c<b;++c){if(e instanceof ClassEx.findClass(d[c])){return true}}if(this.getRaiseExceptionOnTypeMismatch()){var f=Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH"):"Mismatched group item class";Kekule.raise(f)}return false}else{return true}},notifyItemsChanged:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},indexOfItem:function(b){return this.getItems().indexOf(b)},indexOfObj:function(e){var c=this.getItems();for(var d=0,b=c.length;d<b;++d){if(c[d].obj==e){return d}}return -1},hasObj:function(b){return this.indexOfObj(b)>=0},setAttributesAt:function(d,c){var g=this.getItems()[d];if(g){var f=Kekule.ObjUtils.getOwnedFieldNames(c);for(var e=0,b=f.length;e<b;++e){g[f[e]]=c[f[e]]}}},getItemCount:function(){return this.getItems().length},getItemAt:function(b){return this.getItems()[b]},appendItem:function(b){this.getItems().push(b);return this},insertItem:function(c,b){return Kekule.ArrayUtils.insertUniqueEx(this.getItems(),c,b).index},removeItemAt:function(b){var c=this.getItems()[b];if(c){this.getItems().splice(b,1);this.notifyItemsChanged()}},removeItem:function(c){var b=this.getItems().indexOf(c);if(b>=0){this.removeItemAt(b)}},getObjAt:function(b){var c=this.getItemAt(b);return c?c.obj:null},insertObj:function(f,d,c){if(!f){return}if(this.indexOfObj(f)>=0){}else{if(this.ensureItemClass(f)){var e={obj:f};this.beginUpdate();try{var b=this.insertItem(e,d);if(c){this.setAttributesAt(b,c)}this.notifyItemsChanged()}finally{this.endUpdate()}return b}}},appendObj:function(c,b){return this.insertObj(c,null,b)},removeObjAt:function(b){var c=this.getItems()[b];if(c){this.getItems().splice(b,1);this.notifyItemsChanged()}},removeObj:function(c){var b=this.indexOfObj(c);if(b>=0){this.removeObjAt(b)}},getAllObjs:function(){var b=[];for(var d=0,c=this.getItemCount();d<c;++d){b.push(this.getObjAt(d))}return b},getChildCount:function(){return this.getItemCount()},getChildAt:function(b){return this.getObjAt(b)},indexOfChild:function(c){var b=this.indexOfObj(c);if(b<0){b=this.indexOfItem(c)}return b},getNextSiblingOfChild:function(c){var b=this.indexOfItem(c);if(b<0){b=this.indexOfObj(c)}return(b>=0)?this.getChildAt(index+1):null},appendChild:function(b){if(b instanceof Kekule.ChemObject){return this.appendObj(b)}else{return this.appendItem(b)}},insertChild:function(c,b){if(c instanceof Kekule.ChemObject){return this.insertObj(c,b)}else{return this.insertItem(c,b)}},insertBefore:function(c,b){var d=this.indexOfItem(b);if(d<0){d=this.indexOfObj(b)}return this.insertChild(c,d)},removeChildAt:function(b){return this.removeItemAt(b)},removeChild:function($super,d){var b;var c=this.indexOfItem(d);if(c<=0){c=this.indexOfObj(d)}if(c>=0){b=this.removeItemAt(c)}return b||$super(d)}});Kekule.StructureFragmentGroup=Class.create(Kekule.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.StructureFragment","Kekule.StructureFragmentGroup"]});Kekule.MoleculeGroup=Class.create(Kekule.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.MoleculeGroup",ITEM_BASE_CLASSES:["Kekule.Molecule","Kekule.MoleculeGroup"]});Kekule.CompositeMolecule=Class.create(Kekule.Molecule,{CLASS_NAME:"Kekule.CompositeMolecule",initialize:function($super,c,b){$super(c,b)},initProperties:function(){this.defineProp("subMolecules",{dataType:"Kekule.MoleculeGroup",getter:function(){if(!this.getPropStoreFieldValue("subMolecules")){this.setPropStoreFieldValue("subMolecules",new Kekule.MoleculeGroup())}return this.getPropStoreFieldValue("subMolecules")}})},doGetComparisonPropNames:function($super,c){var b=$super(c);if(c.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){b.push("subMolecules")}return b},ownerChanged:function($super,b){var c=this.getPropStoreFieldValue("subMolecules");if(c){c.setOwner(b)}$super(b)},getSubMoleculeCount:function(){var b=this.getPropStoreFieldValue("subMolecules");return b?b.length:0},hasCtab:function(){return false},hasFormula:function(){return false},getAllContainingConnectors:function(){var g=this.getSubMolecules();var c=[];for(var f=0,e=g.getItemCount();f<e;++f){var b=g.getObjAt(f);if(b.getAllContainingConnectors){var d=b.getAllContainingConnectors();if(d&&d.length){c=c.concat(d)}}}return c},getContainerBox:function(g){var b=null;var e=this.getPropStoreFieldValue("subMolecules");if(e){for(var d=0,c=e.getItemCount();d<c;++d){var h=e.getObjAt(d);var f=h.getContainerBox(g);if(f){if(!b){b=Kekule.BoxUtils.clone(f)}else{b=Kekule.BoxUtils.getContainerBox(b,f)}}}}return b},doGetCtab:function(){return null},doSetCtab:function(){},doGetFormula:function(){return null},doSetFormula:function(){},getChildCount:function(){return this.getSubMolecules().getChildCount()},getChildAt:function(b){return this.getSubMolecules().getChildAt(b)},indexOfChild:function(b){return this.getSubMolecules().indexOfChild(b)},getNextSiblingOfChild:function(b){return this.getSubMolecules().getNextSiblingOfChild(b)},appendChild:function($super,b){return $super(b)},insertChild:function(c,b){return this.getSubMolecules().insertChild(c,b)},insertBefore:function($super,c,b){if(c instanceof Kekule.StructureFragment){return this.getSubMolecules().insertBefore(c,b)}else{return $super(c,b)}},removeChildAt:function(b){return this.getSubMolecules().removeChildAt(b)},removeChild:function($super,b){return this.getSubMolecules().removeChild(b)||$super(b)}});Kekule.MoleculeList=Class.create(Kekule.ChemObjList,{CLASS_NAME:"Kekule.MoleculeList",initialize:function($super,b){$super(b,Kekule.Molecule)}});Kekule.ChemStructureNodeLabels={ENABLE_ISOTOPE_ALIAS:true,UNSET_ELEMENT:"?",DUMMY_ATOM:"Du",HETERO_ATOM:"Q",ANY_ATOM:"A",CUSTOM_ATOM:"@",VARIABLE_ATOM:"L",SUBGROUP:"R",ISO_LIST_LEADING_BRACKET:"[",ISO_LIST_TAILING_BRACKET:"]",ISO_LIST_DELIMITER:",",ISO_LIST_DISALLOW_PREFIX:"NOT"};Kekule.ChemStructureNodeFactory={CANDIDATE_CLASSES:[Kekule.SubGroup,Kekule.VariableAtom,Kekule.Pseudoatom],getClassByLabel:function(n,b){if(b===undefined){b=Kekule.Pseudoatom}var g=Kekule.ChemStructureNodeLabels;var h=[[g.SUBGROUP],[g.VARIABLE_ATOM],[g.DUMMY_ATOM,g.HETERO_ATOM,g.ANY_ATOM,g.CUSTOM_ATOM]];var d=Kekule.ChemStructureNodeFactory.CANDIDATE_CLASSES;var m;for(var f=0,e=d.length;f<e;++f){var k=d[f];var j=h[f];if(j.indexOf(n)>=0){m=k;break}}if(!m){if(Kekule.IsotopesDataUtil.isIsotopeIdAvailable(n)){m=Kekule.Atom}else{m=b}}return m},createByLabel:function(c){var d=Kekule.ChemStructureNodeFactory.getClassByLabel(c);var b=new d();if(b instanceof Kekule.Pseudoatom){b.setSymbol(c)}else{if(b instanceof Kekule.Atom){b.setIsotopeId(c)}}return b}}})();Kekule.ChemStructureBuilder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructureBuilder",initialize:function($super,a){$super();if(a){this.setTarget(a)}},initProperties:function(){this.defineProp("target",{dataType:"Kekule.StructureFragment"})},setNodeCoord:function(){var c=Array.prototype.slice.call(arguments);var e=c.shift();var f=c;for(var d=0,b=f.length;(d<b)&&(d<2);++d){var g=f[d];if(g.z!==undefined){e.setCoordOfMode(g,Kekule.CoordMode.COORD3D)}else{e.setCoordOfMode(g,Kekule.CoordMode.COORD2D)}}},createNode:function(){var c=Array.prototype.slice.call(arguments);var d=c.shift();var f=c.shift();var e=c;var b=new d(f);this.setNodeCoord(b,e);this.appendNode(b);return b},createConnector:function(b,d,c){var a=new b(d);a.setConnectedObjs(c);return a},appendNode:function(a){if(a&&this.getTarget()){return this.getTarget().appendNode(a)}else{return null}},appendConnector:function(a){if(a&&this.getTarget()){return this.getTarget().appendConnector(a)}else{return null}},createAtom:function(){var e=Array.prototype.slice.call(arguments);var f=e.shift();var c=e.shift();var d=e.shift();var b=new Kekule.Atom(f,c,d);e.unshift(b);this.setNodeCoord.apply(this,e);this.appendNode(b);return b},createBond:function(f,e,c,d,b){var a=new Kekule.Bond(f,e,c);a.changeBondForm(c,null,b);if(d){a.setStereo(d)}this.appendConnector(a);return a},deleteNode:function(){},marshalSubGroup:function(a,d){var c=this.getTarget();if(c&&c.hasCtab()){var b=new Kekule.SubGroup(d);c.marshalSubFragment(a,b);return b}else{return null}}});Kekule.ReactionComponent={REACTANT:"reactant",PRODUCT:"product",SUBSTANCE:"substance",CONDITION:"condition"};Kekule.ReactionRole={REAGENT:"reagent",CATALYST:"catalyst",SOLVENT:"solvent",TEMPERATURE:"temperature",DURATION:"duration"};Kekule.ReactionDirection={FORWARD:1,BACKWARD:-1,BIDIRECTION:0};Kekule.Reaction=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Reaction",initialize:function($super,a){$super(a);this.setDirection(Kekule.ReactionDirection.FORWARD)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING});this.defineProp("title",{dataType:DataType.STRING});this.defineProp("reactionType",{dataType:DataType.STRING});this.defineProp("yield",{dataType:DataType.FLOAT});this.defineProp("direction",{dataType:DataType.INT,defaultValue:Kekule.ReactionDirection.FORWARD,enumSource:Kekule.ReactionDirection});this.defineProp("reactants",{dataType:DataType.ARRAY,setter:null,getter:function(b){var a=this.getPropStoreFieldValue("reactants");if((!a)&&b){a=[];this.setPropStoreFieldValue("reactants",a)}return a}});this.defineProp("products",{dataType:DataType.ARRAY,setter:null,getter:function(b){var a=this.getPropStoreFieldValue("products");if((!a)&&b){a=[];this.setPropStoreFieldValue("products",a)}return a}});this.defineProp("substances",{dataType:DataType.ARRAY,setter:null,getter:function(b){var a=this.getPropStoreFieldValue("substances");if((!a)&&b){a=[];this.setPropStoreFieldValue("substances",a)}return a}});this.defineProp("conditions",{dataType:DataType.ARRAY,setter:null,getter:function(b){var a=this.getPropStoreFieldValue("conditions");if((!a)&&b){a=[];this.setPropStoreFieldValue("conditions",a)}return a}})},ownerChanged:function($super,f){var g=["reactants","products","substances","conditions"];for(var e=0,b=g.length;e<b;++e){var h=g[e];var m=this.getComponentArray(h);if(m){for(var d=0,c=m.length;d<c;++d){var n=m[d].item;if(n.setOwner){n.setOwner(f)}}}}$super(f)},assertAddingMolecule:function(a){if(!(a instanceof Kekule.Molecule)){Kekule.chemError(Kekule.$L("ErrorMsg.UNABLE_ADD_NONMOLECULE_MAP"))}},notifyReactantsChange:function(){this.notifyPropSet("reactants",this.getPropStoreFieldValue("reactants"))},notifyProductsChange:function(){this.notifyPropSet("products",this.getPropStoreFieldValue("products"))},notifySubstancesChange:function(){this.notifyPropSet("substances",this.getPropStoreFieldValue("substances"))},notifyConditionsChange:function(){this.notifyPropSet("conditions",this.getPropStoreFieldValue("conditions"))},notifyComponentChange:function(a){var b=this.componentToPropName(a);if(b){this.notifyPropSet(b,this.getPropStoreFieldValue(b))}},componentToPropName:function(a){return a+"s"},getComponentArray:function(a,c){var b=this.componentToPropName(a);if(b){switch(b){case"reactants":return this.doGetReactants(c);break;case"products":return this.doGetProducts(c);break;case"substances":return this.doGetSubstances(c);break;case"conditions":return this.doGetConditions(c);break;default:return null}}else{return null}},getComponentItemCount:function(c){var b=this.getComponentArray(c);return b?b.length:0},getMapAt:function(d,c){var b=this.getComponentArray(d);return b?b[c]:null},getMapItemAt:function(b,a){var c=this.getMapAt(b,a);return c?c.item:null},indexOfMap:function(c,d){var b=this.getComponentArray(c);return b?b.indexOf(d):-1},indexOfItem:function(d,f,g){var c=this.getComponentArray(d);if(c){for(var e=0,b=c.length;e<b;++e){if(c[e].item==f){if(typeof(g)==="undefined"){return e}else{if(g===c[e].role){return e}}}}}return -1},appendMap:function(a,c){if((a==Kekule.ReactionComponent.PRODUCT)||(a==Kekule.ReactionComponent.REACTANT)){this.assertAddingMolecule(c.item)}var b=Kekule.ArrayUtils.pushUniqueEx(this.getComponentArray(a,true),c);if(b.isPushed){this.notifyComponentChange(a)}return b.index},appendItem:function(b,e,g,c){var a=this.indexOfItem(b,e,g);if(a<0){if((b==Kekule.ReactionComponent.PRODUCT)||(b==Kekule.ReactionComponent.REACTANT)){this.assertAddingMolecule(e)}var f=Kekule.RoleMapUtils.createMap(e,g);if(c){Object.extend(f,c)}var d=Kekule.ArrayUtils.pushUniqueEx(this.getComponentArray(b,true),f);this.notifyComponentChange(b);return d.index}else{return a}},removeMapAt:function(d,c){var e=null;var b=this.getComponentArray(d);if(b){e=Kekule.ArrayUtils.removeAt(b,c);if(e){this.notifyComponentChange(d)}}return e},removeMap:function(c,e){var d=null;var b=this.getComponentArray(c);if(b){d=Kekule.ArrayUtils.remove(b,e);if(d){this.notifyComponentChange(c)}}return d},removeItem:function(b,c,d){var a=this.indexOfItem(b,c,d);if(a>=0){return this.removeMapAt(b,a)}else{return null}},clearComponent:function(c){var b=this.getComponentArray(c);b=[];this.notifyComponentChange(c)},getReactantCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.REACTANT)},getProductCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.PRODUCT)},getSubstancesCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.SUBSTANCE)},getConditionCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.CONDITION)},getReactantMapAt:function(a){return this.getMapAt(Kekule.ReactionComponent.REACTANT,a)},getProductMapAt:function(a){return this.getMapAt(Kekule.ReactionComponent.PRODUCT,a)},getSubstanceMapAt:function(a){return this.getMapAt(Kekule.ReactionComponent.SUBSTANCE,a)},getConditionMapAt:function(a){return this.getMapAt(Kekule.ReactionComponent.CONDITION,a)},getReactantItemAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.REACTANT,a)},getReactantAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.REACTANT,a)},getProductItemAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.PRODUCT,a)},getProductAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.PRODUCT,a)},getSubstanceItemAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.SUBSTANCE,a)},getSubstanceAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.SUBSTANCE,a)},getConditionItemAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.CONDITION,a)},indexOfReactantMap:function(a){return this.indexOfMap(Kekule.ReactionComponent.REACTANT,a)},indexOfProductMap:function(a){return this.indexOfMap(Kekule.ReactionComponent.PRODUCT,a)},indexOfSubstanceMap:function(a){return this.indexOfMap(Kekule.ReactionComponent.SUBSTANCE,a)},indexOfConditionMap:function(a){return this.indexOfMap(Kekule.ReactionComponent.CONDITION,a)},indexOfReactant:function(a,b){return this.indexOfItem(Kekule.ReactionComponent.REACTANT,a,b)},indexOfProduct:function(a,b){return this.indexOfItem(Kekule.ReactionComponent.PRODUCT,a,b)},indexOfSubstance:function(a,b){return this.indexOfItem(Kekule.ReactionComponent.SUBSTANCE,a,b)},indexOfCondition:function(a,b){return this.indexOfItem(Kekule.ReactionComponent.CONDITION,a,b)},appendReactantMap:function(a){return this.appendMap(Kekule.ReactionComponent.REACTANT,a)},appendProductMap:function(a){return this.appendMap(Kekule.ReactionComponent.PRODUCT,a)},appendSubstanceMap:function(a){return this.appendMap(Kekule.ReactionComponent.SUBSTANCE,a)},appendConditionMap:function(a){return this.appendMap(Kekule.ReactionComponent.CONDITION,a)},appendReactant:function(c,e,a,b){var d=b||{};if(a){d.amount=a}return this.appendItem(Kekule.ReactionComponent.REACTANT,c,e,d)},appendProduct:function(c,e,a,b){var d=b||{};if(a){d.amount=a}return this.appendItem(Kekule.ReactionComponent.PRODUCT,c,e,d)},appendSubstance:function(c,e,a,b){var d=b||{};if(a){d.amount=a}return this.appendItem(Kekule.ReactionComponent.SUBSTANCE,c,e,d)},appendCondition:function(b,c,a){return this.appendItem(Kekule.ReactionComponent.CONDITION,b,c,info)},removeReactantAt:function(a){return this.removeMapAt(Kekule.ReactionComponent.REACTANT,a)},removeProductAt:function(a){return this.removeMapAt(Kekule.ReactionComponent.PRODUCT,a)},removeSubstanceAt:function(a){return this.removeMapAt(Kekule.ReactionComponent.SUBSTANCE,a)},removeConditionAt:function(a){return this.removeMapAt(Kekule.ReactionComponent.CONDITION,a)},removeReactantMap:function(a){return this.removeMap(Kekule.ReactionComponent.REACTANT,a)},removeProductMap:function(a){return this.removeMap(Kekule.ReactionComponent.PRODUCT,a)},removeSubstanceMap:function(a){return this.removeMap(Kekule.ReactionComponent.SUBSTANCE,a)},removeConditionMap:function(a){return this.removeMap(Kekule.ReactionComponent.CONDITION,a)},removeReactant:function(a,b){return this.removeItem(Kekule.ReactionComponent.REACTANT,a,b)},removeProduct:function(a,b){return this.removeItem(Kekule.ReactionComponent.PRODUCT,a,b)},removeSubstance:function(a,b){return this.removeItem(Kekule.ReactionComponent.SUBSTANCE,a,b)},removeCondition:function(a,b){return this.removeItem(Kekule.ReactionComponent.CONDITION,a,b)},clearReactants:function(){return this.clearComponent(Kekule.ReactionComponent.REACTANT)},clearProducts:function(){return this.clearComponent(Kekule.ReactionComponent.PRODUCT)},clearSubstance:function(){return this.clearComponent(Kekule.ReactionComponent.SUBSTANCE)},clearConditions:function(){return this.clearComponent(Kekule.ReactionComponent.CONDITION)},clearAll:function(){this.clearProducts();this.clearProducts();this.clearSubstance();this.clearConditions()},getAllContainingConnectors:function(){var b=Kekule.ReactionComponent;var c=[b.REACTANT,b.PRODUCT,b.SUBSTANCE];var o=[];for(var g=0,d=c.length;g<d;++g){var h=c[g];for(var f=0,e=this.getComponentItemCount(h);f<e;++f){var n=this.getMapItemAt(h,f);if(n.getAllContainingConnectors){var m=n.getAllContainingConnectors();if(m&&m.length){o=o.concat(m)}}}}return o}});Kekule.ReactionList=Class.create(Kekule.ChemObjList,{CLASS_NAME:"Kekule.ReactionList",initialize:function($super,a){$super(a,Kekule.Reaction)}});(function(){var a=Kekule.ArrayUtils;Kekule.ChemStructureUtils={getConnectorLengthMedian:function(e,k,f){var g=[];for(var m=0,h=e.length;m<h;++m){var j=e[m];if(j&&j.getLength){var d=j.getLength(k,f);if(d){g.push(d)}}}if(h===0){return 1}if(h<=1){return g[0]}else{g.sort();var n=g.length;var o=(n%2)?g[(n+1)>>1]:(g[n>>1]+g[(n>>1)-1])/2;return o}},getChildStructureObjs:function(m,h){var e;if(m instanceof Kekule.CompositeMolecule){e=m.getSubMolecules().getAllObjs()}else{if(m instanceof Kekule.ChemStructureObjectGroup){e=m.getAllObjs()}else{if(m instanceof Kekule.ChemObjList){e=m.getItems()}else{if(m instanceof Kekule.ChemSpaceElement){e=m.getChildren().getItems()}else{if(m instanceof Kekule.ChemSpace){e=m.getChildren()}else{return[m]}}}}}e=[].concat(e);if(h){var g=[];for(var j=0,f=e.length;j<f;++j){var k=e[j];var d=Kekule.ChemStructureUtils.getChildStructureObjs(k,h);if(d.length<=1){Kekule.ArrayUtils.pushUnique(g,k)}else{Kekule.ArrayUtils.pushUnique(g,d)}}e=g}return e},getAllStructFragments:function(j,f){if(j instanceof Kekule.StructureFragment){return[j]}var h=Kekule.ChemStructureUtils.getChildStructureObjs(j,f);var d=[];for(var g=0,e=h.length;g<e;++g){if(h[g] instanceof Kekule.StructureFragment){Kekule.ArrayUtils.pushUnique(d,h[g])}}return d},getTotalStructFragment:function(g,e){var d=Kekule.ChemStructureUtils.getAllStructFragments(g,true);var f=d.length;if(f<=0){return null}else{if(f===1){return d[0]}else{return Kekule.ChemStructureUtils.mergeStructFragments(d,e)}}},getCascadeDeleteObjs:function(j){var n=[];var k=j.getLinkedConnectors?j.getLinkedConnectors():[];for(var g=0,d=k.length;g<d;++g){var e=k[g];if(e.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(n,e);var m=Kekule.ChemStructureUtils.getCascadeDeleteObjs(e);Kekule.ArrayUtils.pushUnique(n,m)}}if(j instanceof Kekule.ChemStructureNode){}else{if(j instanceof Kekule.ChemStructureConnector){var h=j.getConnectedObjs();for(var g=0,d=h.length;g<d;++g){var f=h[g];if(f instanceof Kekule.ChemStructureNode){if(f.getLinkedConnectors().length<=1){Kekule.ArrayUtils.pushUnique(n,f)}}}}else{}}return n},moveChildBetweenStructFragment:function(h,d,e,g,f){return Kekule.StructureFragment.moveChildBetweenStructFragment(h,d,e,g,f)},_getCascadeConnectedNodesAndConnectors:function(g,e){var f=[];var d=[];var n=g.getConnectedObjs();for(var l=0,h=n.length;l<h;++l){var m=n[l];if(m!==g){if(e){m=e.findDirectChildOfObj(m)}if(m instanceof Kekule.ChemStructureNode){Kekule.ArrayUtils.pushUnique(d,m)}else{if(m instanceof Kekule.ChemStructureConnector){Kekule.ArrayUtils.pushUnique(f,m);var i=Kekule.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(m);Kekule.ArrayUtils.pushUnique(f,i.connectors);Kekule.ArrayUtils.pushUnique(d,i.nodes)}}}}return{connectors:f,nodes:d}},mergeStructFragments:function(e,h){if(e.length<=1){return e[0]}else{var j=h||Kekule.Molecule;var d=new j();for(var g=0,f=e.length;g<f;++g){var k=e[g].clone();Kekule.ChemStructureUtils.moveChildBetweenStructFragment(k,d,k.getNodes(),k.getConnectors())}return d}},splitStructFragment:function(t){if(!t.hasCtab()){return[t]}var f=t.getNodes();if(f.length<=0){return[t]}var o=t.getConnectors();var u=[];var s=[f[0]];var k=[];var e=0;do{var j=s[e];var h=j.getLinkedConnectors();if(j.getCrossConnectors){h.concat(j.getCrossConnectors()||[])}Kekule.ArrayUtils.pushUnique(k,h);for(var r=0,m=h.length;r<m;++r){var q=Kekule.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(h[r],t);Kekule.ArrayUtils.pushUnique(k,q.connectors);Kekule.ArrayUtils.pushUnique(s,q.nodes)}++e}while(e<s.length);u.push(t);var g=Kekule.ArrayUtils.exclude(f,s);var n=Kekule.ArrayUtils.exclude(o,k);if(g.length>0){var d=t.getClass();var p=new d();Kekule.ChemStructureUtils.moveChildBetweenStructFragment(t,p,g,n);var v=Kekule.ChemStructureUtils.splitStructFragment(p);u=u.concat(v)}return u},getAbsCoordVectorBetweenObjs:function(i,h,f,d){var g=i.getAbsCoordOfMode(f,d);var e=h.getAbsCoordOfMode(f,d);return Kekule.CoordUtils.substract(e,g)},_getRef2DCoordOfObj:function(e,d){var f=e.getAbsBaseCoord2D?e.getAbsBaseCoord2D(d):e.getAbsCoord2D?e.getAbsCoord2D(d):e.getCoord2D(d);return f},_getStandardizedLinkedObj2DRelCoords:function(q,k,f,n,d){var r=[];var o=Kekule.ChemStructureUtils._getRef2DCoordOfObj(q,f);var e=d?q.getLinkedObjs():q.getLinkedExposedObjs();if(n&&q.getAttachedMarkers){e=e.concat(q.getAttachedMarkers()||[])}if(k&&k.length){e=a.exclude(e,k)}for(var j=0,g=e.length;j<g;++j){var h=e[j];var m=Kekule.ChemStructureUtils._getRef2DCoordOfObj(h,f);var p=Kekule.CoordUtils.substract(m,o);p=Kekule.CoordUtils.standardize(p);r.push(p)}return r},_calcLinkedObj2DAnglesOfObj:function(o,k,e,m,d){var p=[];var h=Kekule.ChemStructureUtils._getStandardizedLinkedObj2DRelCoords(o,k,e,m,d);for(var j=0,g=h.length;j<g;++j){var n=h[j];if(n.x===0&&n.y===0){continue}var f=Math.atan2(n.y,n.x);if(f<0){f=Math.PI*2+f}p.push(f)}p.sort();return p},_getMostEmptyDirectionOfExistingAngles:function(j){var f=j.length;if(f===0){return 0}else{if(f===1){return -j[0]}else{var k=0;var h=0;for(var g=0;g<f;++g){var e=j[g];var d=j[(g+1)%f];var m=d-e;if(m<0){m+=Math.PI*2}if(m>k){k=m;h=g}}var n=j[h]+k/2;return n}}},getMostEmptyDirection2DAngleOfObj:function(e,h,f,k,g,i){var j=Kekule.ChemStructureUtils._calcLinkedObj2DAnglesOfObj(e,h,f,k,g);if(i){j=j.concat(i);j.sort()}var d=Kekule.ChemStructureUtils._getMostEmptyDirectionOfExistingAngles(j);return d}};Kekule.TokenAnalyzer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TokenAnalyzer",initialize:function($super,d){$super();this.setSrcText(d)},initProperties:function(){this.defineProp("srcText",{dataType:DataType.STRING,setter:function(e){var d=e||"";this.setPropStoreFieldValue("srcText",d);this.setPropStoreFieldValue("srcLength",d.length);this.setCurrPos(0)}});this.defineProp("srcLength",{dataType:DataType.INT,setter:null,serializable:false});this.defineProp("currPos",{dataType:DataType.INT,serializable:false})},getCharType:function(d){return 0},isCharTypeMatched:function(e,d){return e===d},nextCharInfo:function(){var d=this.getCurrPos();if(d>=this.getSrcLength()){return null}else{var e=this.getSrcText().charAt(d);this.setCurrPos(d+1);return{"char":e,charType:this.getCharType(e)}}},nextTokenInfo:function(){var f=this.nextCharInfo();if(f){var e=f["char"];var g=f.charType;var d=this.nextCharInfo();while(d&&this.isCharTypeMatched(d.charType,f.charType)){e+=d["char"];f=d;d=this.nextCharInfo()}if(d){this.setCurrPos(this.getCurrPos()-1)}return{token:e,tokenType:g}}else{return null}},getAllTokenInfos:function(){var d=[];var e=this.nextTokenInfo();while(e){d.push(e);e=this.nextTokenInfo()}return d}});Kekule.ChemTextTypes={CT_ATOM_SYMBOL_LEADING:1,CT_ATOM_SYMBOL_FOLLOWING:2,CT_CHARGE_SYMBOL:3,CT_NUMBER:4,CT_BRACKET_LEADING:10,CT_BRACKET_TAILING:11,CT_SEPARATOR:20,CT_UNKNOWN:0};var b=Kekule.ChemTextTypes;Kekule.ChemTextAnalyzer=Class.create(Kekule.TokenAnalyzer,{CLASS_NAME:"Kekule.ChemTextAnalyzer",getCharType:function(d){if(d===" "){return b.CT_SEPARATOR}if(d>="0"&&d<="9"){return b.CT_NUMBER}else{if(["+","-"].indexOf(d)>=0){return b.CT_CHARGE_SYMBOL}else{if(["(","[","{"].indexOf(d)>=0){return b.CT_BRACKET_LEADING}else{if([")","]","}"].indexOf(d)>=0){return b.CT_BRACKET_TAILING}else{if(d>="A"&&d<="Z"){return b.CT_ATOM_SYMBOL_LEADING}else{if(d>="a"&&d<="z"){return b.CT_ATOM_SYMBOL_FOLLOWING}else{return b.CT_UNKNOWN}}}}}}},isCharTypeMatched:function(e,d){if(Kekule.ArrayUtils.intersect([b.CT_BRACKET_LEADING,b.CT_BRACKET_TAILING],[e,d]).length){return false}else{return(e===d&&d!==b.CT_ATOM_SYMBOL_LEADING)||(d===b.CT_ATOM_SYMBOL_LEADING&&e===b.CT_ATOM_SYMBOL_FOLLOWING)}}});Kekule.FormulaUtils={FORMULA_BRACKETS:[["(",")"],["[","]"],["{","}"]],FORMULA_BRACKET_TYPE_COUNT:3,textToFormula:function(r,m,e){var o=e||null;if(o){o.clear()}var z=new Kekule.ChemTextAnalyzer(r);try{var B=z.getAllTokenInfos();if(!o){o=new Kekule.MolecularFormula(m)}var s=B.length;if(s){var w,v,f=null,n;var g=o;v={};var D=function(){v={}};var A=function(){if(v&&v.obj){g.appendSection(v.obj,v.count,v.charge)}};for(var y=0;y<s;++y){var u=B[y];var E=u.tokenType;var h=u.token;var l=false;if(E===b.CT_BRACKET_LEADING){A();var k=new Kekule.MolecularFormula(m);k._parentFormula=g;g=k;D();l=true}else{if(E===b.CT_BRACKET_TAILING){A();D();v.obj=g;g=g._parentFormula;u.asSymbol=true;l=true}else{if([b.CT_ATOM_SYMBOL_LEADING,b.CT_ATOM_SYMBOL_FOLLOWING].indexOf(E)>=0){if(v.obj){A();D()}var d=v.massNum;if(!d){if(f&&!f.handled&&(f.tokenType===b.CT_NUMBER)){d=parseInt(f.token,10)||null}}var p=""+(d||"")+h;v.obj=Kekule.ChemStructureNodeFactory.createByLabel(p);u.asSymbol=true;l=true}else{if(E===b.CT_CHARGE_SYMBOL){n=(h==="+")?+1:-1;u.asCharge=true;if(f.tokenType===b.CT_NUMBER){var x;if(f.asCount){if(f.token.length>1){var q=f.token;x=q.substr(q.length-1);if(f.asCount){v.count=parseInt(q.substring(0,q.length-1),10)}}else{x=f.token;if(f.asCount){v.count=1}}}else{x=f.token;f.asChargeCount=true}n*=parseInt(x,10)}v.charge=n;l=true}else{if(E===b.CT_NUMBER){var j=parseInt(h,10);if(n&&f.tokenType===b.CT_CHARGE_SYMBOL&&f.asCharge){n*=j;v.charge=n;u.asChargeCount=true;l=true}else{if(v.obj&&f.asSymbol){v.count=j;u.asCount=true;l=true}else{if(!v.obj){v.massNum=j;l=true}else{}}}}}}}}u.handled=l;f=u}if(v&&v.obj){A()}}return o}finally{z.finalize()}},formulaToText:function(f,e,d){if(Kekule.ObjUtils.isUnset(e)){e=true}return c._convFormulaToText(f,false,e,d)},_convFormulaToText:function(n,t,p,g){var u="";var r=n.getSections();if(t){var e=n.getMaxNestedLevel()%c.FORMULA_BRACKET_TYPE_COUNT;var o=c.FORMULA_BRACKETS[e][0];var d=c.FORMULA_BRACKETS[e][1];u+=o}for(var j=0,f=r.length;j<f;++j){var h=r[j].obj;var m=n.getSectionCharge(r[j]);var q=null;if(h instanceof Kekule.MolecularFormula){q=c._convFormulaToText(h,true,false,false,g)}else{if(h.getLabel){var q=h.getLabel();if(h.getMassNumber&&h.getMassNumber()){q=(u?" ":"")+q}}}if(q){var k=false;if(r[j].count!=1){q+=r[j].count;k=true}if(p&&m){var s=c._convChargeToText(m,g);q+=(k?" ":"")+s}u+=q}}if(t){u+=d}if(p){var m=n.getCharge();if(m){var s=c._convChargeToText(m,g);u+=s}}return u},_convChargeToText:function(g,d){if(!g){return null}var h=(g>0)?"+":"-";var e=Math.abs(g);var f=h;if(e!=1){f=(d?Kekule.NumUtils.toDecimals(e,d):e.toString())+h}return f}};var c=Kekule.FormulaUtils;ClassEx.defineProp(Kekule.MolecularFormula,"text",{dataType:DataType.STRING,serializable:false,getter:function(){return c.formulaToText(this)},setter:function(d){c.textToFormula(d,this.getParent(),this)}})})();(function(){Kekule.Glyph={};Kekule.Glyph.Base=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Glyph.Base",initialize:function($super,c,a,b){$super(c);if(a){this.setCoord2D(a)}if(b){this.setCoord3D(b)}},initProperties:function(){},getAutoIdPrefix:function(){return"g"}});Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.Glyph.Base)})();(function(){Kekule.Glyph.PathGlyphNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphNode",initialize:function($super,d,a,b,c){$super(d);if(b){this.setCoord2D(b)}if(c){this.setCoord3D(c)}this.setNodeType(a||Kekule.Glyph.NodeType.LOCATION)},initProperties:function(){this.defineProp("nodeType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC})}});Kekule.Glyph.NodeType={LOCATION:"location",HIDDEN:"hidden"};Kekule.Glyph.PathGlyphConnector=Class.create(Kekule.BaseStructureConnector,{CLASS_NAME:"Kekule.Glyph.PathGlyphConnector",initialize:function($super,c,a,b){$super(c,b);this.setPathType(a)},initProperties:function(){this.defineProp("pathType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,enumSource:Kekule.Glyph.PathType});this.defineProp("pathParams",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLISHED,getter:function(){var a=this.getPropStoreFieldValue("pathParams");if(!a){a={};this.setPropStoreFieldValue("pathParams",a)}return a},setter:function(a){if(!a){this.setPropStoreFieldValue("pathParams",null)}else{this.setPropStoreFieldValue("pathParams",Object.extend({},a,true))}}})}});Kekule.Glyph.PathType={LINE:"L"};Kekule.Glyph.ArrowType={NONE:null,OPEN:"open",TRIANGLE:"triangle"};Kekule.Glyph.ArrowSide={BOTH:0,SINGLE:1,REVERSED:-1};Kekule.Glyph.PathGlyph=Class.create(Kekule.Glyph.Base,{CLASS_NAME:"Kekule.Glyph.PathGlyph",initialize:function($super,e,a,b,c,d){$super(e,c,d);this.createDefaultStructure(a||1,b||{})},doFinalize:function($super){if(this.hasCtab()){this.getCtab().finalize()}$super()},initProperties:function(){this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",scope:Class.PropertyScope.PUBLIC,getter:function(a){if(!this.getPropStoreFieldValue("ctab")){if(a){this.createCtab()}}return this.getPropStoreFieldValue("ctab")},setter:function(b){var a=this.getPropStoreFieldValue("ctab");if(a){a.finalize();a=null}if(b){b.setPropValue("parent",this,true);b.setOwner(this.getOwner())}this.setPropStoreFieldValue("ctab",b)}});this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}});this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}})},createDefaultStructure:function(a,b){if(!a){a=1}var e={};var c=["lineGap","startArrowLength","startArrowWidth","endArrowLength","endArrowWidth"];for(var d in b){if(c.indexOf(d)>=0){e[d]=b[d]*a}else{e[d]=b[d]}}return this.doCreateDefaultStructure(a,e)},doCreateDefaultStructure:function(a,b){},getAutoIdPrefix:function(){return"p"},ownerChanged:function($super,a){if(this.hasCtab()){this.getCtab().setOwner(a)}$super(a)},_removeChildObj:function(b){if(this.hasCtab()){var a=this.getCtab();if(a===b){this.removeCtab()}else{if(a.hasChildObj(b)){a.removeChildObj(b)}}}},isEmpty:function(){return this.getCtab().isEmpty()},createCtab:function(){var a=new Kekule.StructureConnectionTable(this.getOwner(),this);this.setPropStoreFieldValue("ctab",a);a.addEventListener("propValueSet",function(b){if(b.propName=="nodes"){this.notifyPropSet(b.propName,b.propValue)}},this);a.setEnablePropValueSetEvent(true)},hasCtab:function(){return(!!this.getPropStoreFieldValue("ctab"))},getContainerBox:function($super,b,a){if(this.hasCtab()){return this.getCtab().getContainerBox(b,a)}else{return $super(b)}},getNodeById:function(a){return this.hasCtab()?this.getCtab().getNodeById(a):null},getConnectorById:function(a){return this.hasCtab()?this.getCtab().getConnectorById(a):null},getObjectById:function(b){var a=this.getNodeById(b);return a?a:this.getConnectorById(b)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(a){return this.hasCtab()?this.getCtab().getNodeAt(a):null},indexOfNode:function(a){return this.hasCtab()?this.getCtab().indexOfNode(a):-1},hasNode:function(b,a){return this.hasCtab()?the.getCtab().hasNode(b,a):null},appendNode:function(a){return this.doGetCtab(true).appendNode(a)},insertNodeAt:function(b,a){return this.doGetCtab(true).insertNodeAt(b,a)},removeNodeAt:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeNodeAt(b,a)},removeNode:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeNode(b,a)},replaceNode:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().replaceNode(b,a)},clearNodes:function(){if(this.hasCtab()){return this.getCtab().clearNodes()}},nodesHasCoord2D:function(a){if(!this.hasCtab()){return false}return this.getCtab().nodesHasCoord2D(a)},nodesHasCoord3D:function(a){if(!this.hasCtab()){return false}return this.getCtab().nodesHasCoord3D(a)},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(a){return this.hasCtab()?this.getCtab().getConnectorAt(a):null},indexOfConnector:function(a){return this.hasCtab()?this.getCtab().indexOfConnector(a):-1},hasConnector:function(a,b){return this.hasCtab()?this.getCtab().hasConnector(a,b):null},appendConnector:function(a){return this.doGetCtab(true).appendConnector(a)},insertConnectorAt:function(a,b){return this.doGetCtab(true).insertConnectorAt(a,b)},removeConnectorAt:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeConnectorAt(b,a)},removeConnector:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeConnector(b,a)},clearConnectors:function(){if(this.hasCtab()){return this.getCtab().clearConnectors()}},insertBefore:function(b,a){if(this.hasCtab()){return this.getCtab().insertBefore(b,a)}},_getObjsNeedToBeCascadeRemoved:function(b,a){if(this.hasCtab()){return this.getCtab()._getObjsNeedToBeCascadeRemoved(b,a)}else{return[]}},removeChildObj:function(c,b,a){if(this.hasCtab()){this.getCtab().removeChildObj(c,b,a)}},removeChild:function($super,a){return this.removeChildObj(a)||$super(a)},hasChildObj:function(a){if(this.hasCtab()){return this.getCtab().hasChildObj(a)}else{return false}},getNextSiblingOfChild:function(a){if(this.hasCtab()){return this.getCtab().getNextSiblingOfChild(a)}else{return null}},getChildCount:function(){if(this.hasCtab()){return this.getCtab().getChildCount()}else{return 0}},getChildAt:function(a){if(this.hasCtab()){return this.getCtab().getChildAt(a)}else{return null}},indexOfChild:function(a){if(this.hasCtab()){return this.getCtab().indexOfChild(a)}else{return -1}}})})();(function(){var a=Kekule.Glyph.NodeType;var b=Kekule.Glyph.PathType;Kekule.Glyph.StraightLine=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.StraightLine",initialize:function($super,g,c,d,e,f){$super(g,c,d,e,f)},doCreateDefaultStructure:function(i,c){var d=Kekule.CoordUtils;var g={x:0,y:0};var f={x:0,y:0,z:0};var h={x:i*(c.lineLength||1)};var k=new Kekule.Glyph.PathGlyphNode(null,null,g,f);var j=new Kekule.Glyph.PathGlyphNode(null,null,d.add(g,h),d.add(f,h));var e=new Kekule.Glyph.PathGlyphConnector(null,b.LINE,[k,j]);this._applyParamsToConnector(e,c);this.appendNode(k);this.appendNode(j);this.appendConnector(e)},_applyParamsToConnector:function(c,d){c.setPathParams(d)}});Kekule.Glyph.Polygon=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.Polygon",initialize:function($super,g,c,d,e,f){$super(g,c,d,e,f)},getRefLengthRatio:function(){return 1},doCreateDefaultStructure:function(h,w){var n=Kekule.CoordUtils;var e={x:0,y:0};var j={x:0,y:0,z:0};var p=w.nodeProps;var l=w.connectorProps;var o=h*(w.lineLength||1)*this.getRefLengthRatio();var u=w.edgeCount||3;var m=Math.PI*2/u;var k=(u%2)?0:-m/2;var f=k;var s,g;for(var t=0;t<u;++t){var v={x:o*Math.sin(f),y:o*Math.cos(f)};var q=new Kekule.Glyph.PathGlyphNode(null,null,n.add(e,v),n.add(j,v));if(p){q.setPropValues(p)}this.appendNode(q);if(t===0){s=q}if(g){var d=new Kekule.Glyph.PathGlyphConnector(null,b.LINE,[g,q]);if(l){d.setPropValues(l)}this._applyParamsToConnector(d,w);this.appendConnector(d)}g=q;f+=m}var d=new Kekule.Glyph.PathGlyphConnector(null,b.LINE,[q,s]);if(l){d.setPropValues(l)}this._applyParamsToConnector(d,w);this.appendConnector(d)},_applyParamsToConnector:function(c,d){c.setPathParams(d)}})})();(function(){var a=Kekule.Glyph.NodeType;var b=Kekule.Glyph.PathType;Kekule.Glyph.HeatSymbol=Class.create(Kekule.Glyph.Polygon,{CLASS_NAME:"Kekule.Glyph.HeatSymbol",initialize:function($super,g,c,d,e,f){$super(g,c,d,e,f);this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return 0.25},doCreateDefaultStructure:function($super,c,d){d.edgeCount=3;d.nodeProps=Object.extend(d.nodeProps||{},{interactMode:Kekule.ChemObjInteractMode.HIDDEN});d.connectorProps=Object.extend(d.connectorProps||{},{interactMode:Kekule.ChemObjInteractMode.HIDDEN});return $super(c,d)},_applyParamsToConnector:function($super,c,d){return $super(c,d)}});Kekule.Glyph.AddSymbol=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.AddSymbol",initialize:function($super,g,c,d,e,f){$super(g,c,d,e,f);this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return 0.5},doCreateDefaultStructure:function(s,c){var o={interactMode:Kekule.ChemObjInteractMode.HIDDEN};var k={interactMode:Kekule.ChemObjInteractMode.HIDDEN};var d=Kekule.CoordUtils;var q={x:0,y:0};var n={x:0,y:0,z:0};var e=s*this.getRefLengthRatio()*(c.lineLength||1)/2;var f=new Kekule.Glyph.PathGlyphNode(null,null,q,n);f.setPropValues(o);this.appendNode(f);var p=[{x:-e,y:0},{x:0,y:-e},{x:e,y:0},{x:0,y:e}];for(var m=0,j=p.length;m<j;++m){var r=p[m];var g=new Kekule.Glyph.PathGlyphNode(null,null,d.add(q,r),d.add(n,r));g.setPropValues(o);var h=new Kekule.Glyph.PathGlyphConnector(null,b.LINE,[f,g]);h.setPropValues(k);this._applyParamsToConnector(h,c);this.appendNode(g);this.appendConnector(h)}},_applyParamsToConnector:function(c,d){c.setPathParams(d)}})})();(function(){var a=Kekule.CoordMode;var b=Kekule.CoordUtils;Kekule.ContentBlock=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ContentBlock",initialize:function($super,e,c,d){$super(e);if(c){this.setCoord2D(c)}if(d){this.setCoord3D(d)}},initProperties:function(){this.defineProp("needRecalcSize",{dataType:DataType.BOOL})},getAutoIdPrefix:function(){return"b"},getCornerCoord1:function(d,c){return this.getCoordOfMode(d,c)},getCornerCoord2:function(e,c){var f=this.getCornerCoord1(e,c);var d=this.getSizeOfMode(e,c);return Kekule.CoordUtils.add(f,d)},getContainerBox:function($super,g,d){var h=this.getAbsCoordOfMode(g,d)||{};var e=this.getSizeOfMode(g,d)||{};if(g===Kekule.CoordMode.COORD3D){var f=Kekule.CoordUtils.add(h,this.getSizeOfMode(g,d)||{})}else{f={x:h.x+e.x,y:h.y-e.y}}var c=Kekule.BoxUtils.createBox(h,f);return c}});Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ContentBlock);Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.ContentBlock);Kekule.TextBlock=Class.create(Kekule.ContentBlock,{CLASS_NAME:"Kekule.TextBlock",initialize:function($super,f,e,c,d){$super(f,c,d);this.setText(e||"")},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"t"},doObjectChange:function($super,c){if(Kekule.ArrayUtils.intersect(["text","renderOptions"],c).length){this.setNeedRecalcSize(true)}}});Kekule.ImageBlock=Class.create(Kekule.ContentBlock,{CLASS_NAME:"Kekule.ImageBlock",initialize:function($super,f,e,c,d){$super(f,c,d);if(e){this.setSrc(e)}},initProperties:function(){this.defineProp("src",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,setter:function(c){if(c!==this.getSrc()){this.setPropStoreFieldValue("src",c);this._clearCacheImg()}}});this.defineProp("cacheImg",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null,getter:function(){var c=this.getPropStoreFieldValue("cacheImg");if(!c&&Kekule.$document){c=this._createCacheImg(this.getSrc())}return c}})},getAutoIdPrefix:function(){return"g"},_createCacheImg:function(e){var c;var d=Kekule.$document;if(d&&d.body&&d.createElement){c=d.createElement("img");c.src=e}return c},_clearCacheImg:function(){var c=this.getPropStoreFieldValue("cacheImg");if(c){c.src="";try{delete c.width;delete c.height}catch(d){}}}})})();(function(){var a=Kekule.ArrayUtils;Kekule.ChemMarker={};ClassEx.extend(Kekule.ChemObject,{isAttachedMarker:function(){var b=this.getParent();return(b&&b.hasMarker(this))},notifyAttachedMarkersChanged:function(){this.notifyPropSet("attachedMarkers",this.getPropStoreFieldValue("attachedMarkers"))},_attachedMarkerAdded:function(b){},_attachedMarkerRemoved:function(b){},getMarkerCount:function(){var b=this.getPropStoreFieldValue("attachedMarkers");return b?b.length:0},getMarkerAt:function(b){var c=this.getPropStoreFieldValue("attachedMarkers");return c?c[b]:null},getMarkerOfType:function(f,e){for(var d=0,c=this.getMarkerCount();d<c;++d){var b=this.getMarkerAt(d);if((e&&b.getClass()===f)||(b instanceof f)){return b}}return null},getMarkersOfType:function(g,f){var b=[];for(var e=0,d=this.getMarkerCount();e<d;++e){var c=this.getMarkerAt(e);if((f&&c.getClass()===g)||(c instanceof g)){b.push(c)}}return b},fetchMarkerOfType:function(e,f,d,c){var b=this.getMarkerOfType(e,d);if(!b&&f){b=new e();b.beginUpdate();try{if(c){b.setPropValues(c)}this.appendMarker(b)}finally{b.endUpdate()}}return b},getUnplacedMarkers:function(f){var b=[];for(var e=0,d=this.getMarkerCount();e<d;++e){var c=this.getMarkerAt(e);if(!c.getCoordOfMode(f)){b.push(c)}}return b},indexOfMarker:function(b){var c=this.getPropStoreFieldValue("attachedMarkers");return c?c.indexOf(b):-1},hasMarker:function(b){return this.indexOfMarker(b)>=0},hasMarkerOfType:function(c,b){return !!this.getMarkerOfType(c,b)},appendMarker:function(c){var d=this.indexOfMarker(c);if(d>=0){return d}else{var b=this.getAttachedMarkers(true).push(c);c.beginUpdate();try{if(c.setOwner){c.setOwner(this.getOwner())}if(c.setParent){c.setParent(this)}this._attachedMarkerAdded(c)}finally{c.endUpdate()}this.notifyAttachedMarkersChanged();return b}},insertMarkerBefore:function(b,c){var d=this.indexOfMarker(c);return this.insertMarkerAt(b,d)},insertMarkerAt:function(b,c){var d=this.indexOfMarker(b);var e=this.getAttachedMarkers(true);if(Kekule.ObjUtils.isUnset(c)||(c<0)){c=e.length}if(d>=0){e.splice(d,1);e.splice(c,0,b)}else{e.splice(c,0,b);if(b.setOwner){b.setOwner(this.getOwner())}if(b.setParent){b.setParent(this)}this._attachedMarkerAdded(b)}this.notifyAttachedMarkersChanged();return c},setMarkerIndex:function(b,c){var d=this.indexOfMarker(b);if(d>=0){var e=this.getPropStoreFieldValue("attachedMarkers");e.splice(d,1);e.splice(c,0,b)}},removeMarkerAt:function(d){var c=this.getMarkerAt(d);if(c){var b=this.getAttachedMarkers(true).splice(d,1);if(c.setOwner){c.setOwner(null)}if(c.setParent){c.setParent(null)}this._attachedMarkerRemoved(c);this.notifyAttachedMarkersChanged();return b}},removeMarker:function(b){var c=this.indexOfMarker(b);if(c>=0){return this.removeMarkerAt(c)}},replaceMarker:function(b,c){var d=this.indexOfMarker(b);if(d<0){return this}else{this.removeMarkerAt(d);this.insertMarkerAt(c,d);return this}},clearMarkers:function(){var e=this.getPropStoreFieldValue("attachedMarkers");if(e){e=a.clone(e)}this.setPropStoreFieldValue("attachedMarkers",null);if(e){for(var d=0,c=e.length;d<c;++d){var b=e[d];if(b.setOwner){b.setOwner(null)}if(b.setParent){b.setParent(null)}this._attachedMarkerRemoved(b)}}this.notifyAttachedMarkersChanged();return this},autoSetMarker2DPos:function(b,f,c,d){if(this.hasMarker(b)){var e=Kekule.ChemStructureUtils.getMostEmptyDirection2DAngleOfObj(this,[b],c,true,false,d);var g={x:f*Math.cos(e),y:f*Math.sin(e)};b.setCoord2D(g)}},_updateAttachedMarkersOwner:function(b){if(!b){b=this.getOwner()}for(var e=0,d=this.getMarkerCount();e<d;++e){var c=this.getMarkerAt(e);if(c.setOwner){c.setOwner(b)}}},_updateAttachedMarkersParent:function(e){if(!e){e=this}for(var d=0,c=this.getMarkerCount();d<c;++d){var b=this.getMarkerAt(d);if(b.setParent){b.setParent(e)}}}});ClassEx.extendMethod(Kekule.ChemObject,"ownerChanged",function(c,b){c(b);this._updateAttachedMarkersOwner(b)});ClassEx.extendMethod(Kekule.ChemObject,"removeChild",function(c,d){var b=c(d);if(!b){b=this.removeMarker(d)||c(d)}return b});ClassEx.extendMethod(Kekule.ChemObject,"insertBefore",function(d,e,c){var b=d(e,c);if(b<0){if(c&&this.hasMarker(c)||e instanceof Kekule.ChemMarker.BaseMarker){b=this.insertMarkerBefore(e,c)}}return b});ClassEx.defineProp(Kekule.ChemObject,"attachedMarkers",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLISHED,getter:function(c){var b=this.getPropStoreFieldValue("attachedMarkers");if(!b&&c){b=[];this.setPropStoreFieldValue("attachedMarkers",b)}return b},setter:function(b){this.clearMarkers();this.setPropStoreFieldValue("attachedMarkers",b);this._updateAttachedMarkersOwner();this._updateAttachedMarkersParent()}})})();(function(){Kekule.ChemMarker.BaseMarker=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemMarker.BaseMarker",initialize:function a($super,d,b,c){$super(d,b,c)},getAutoIdPrefix:function(){return"marker"}});Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ChemMarker.BaseMarker);Kekule.ChemMarker.UnbondedElectronSet=Class.create(Kekule.ChemMarker.BaseMarker,{CLASS_NAME:"Kekule.ChemMarker.UnbondedElectronSet",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.VARIANT})},initPropValues:function($super){$super();this.setElectronCount(2)}});Kekule.ChemMarker.ChemPropertyMarker=Class.create(Kekule.ChemMarker.BaseMarker,{CLASS_NAME:"Kekule.ChemMarker.ChemPropertyMarker",initProperties:function(){this.defineProp("value",{dataType:DataType.VARIANT,serializable:false,getter:function(){var b;var d=this.getParent();var c=this.getPropertyName();if(d&&c){b=d.getPropValue(c);this.setPropStoreFieldValue("value",b)}else{b=this.getPropStoreFieldValue("value")}return b},setter:function(b){this.setPropStoreFieldValue("value",b);this.setParentPropValue(b)}})},initPropValues:function($super){$super()},setParentPropValue:function(c){var d=this.getParent();if(d){var b=this.getPropertyName();if(b&&d){d.setPropValue(b,c)}}return this},resetParentPropValue:function(){return this.setParentPropValue(undefined)},getPropertyName:function(){return null},beforAddingByEditor:function(c,b){if(c){var d=this.getPropStoreFieldValue("value");if(Kekule.ObjUtils.notUnset(d)){this.setParentPropValue(d)}}$super()},beforeRemovingByEditor:function(b){this.setPropStoreFieldValue("value",this.getValue());this.resetParentPropValue()}});Kekule.ChemMarker.Charge=Class.create(Kekule.ChemMarker.ChemPropertyMarker,{CLASS_NAME:"Kekule.ChemMarker.Charge",getPropertyName:function(){return"charge"}});Kekule.ChemMarker.Radical=Class.create(Kekule.ChemMarker.ChemPropertyMarker,{CLASS_NAME:"Kekule.ChemMarker.Radical",getPropertyName:function(){return"radical"}});ClassEx.extend(Kekule.ChemStructureNode,{fetchChargeMarker:function(c,b){return this.fetchMarkerOfType(Kekule.ChemMarker.Charge,c,false,b)},fetchRadicalMarker:function(c,b){return this.fetchMarkerOfType(Kekule.ChemMarker.Radical,c,false,b)}});ClassEx.defineProp(Kekule.AbstractAtom,"lonePairCount",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED,serializable:false,setter:null,getter:function(){var c=0;var e=this.getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet);for(var f=0,d=e.length;f<d;++f){var b=e[f];if(b.getElectronCount()===2){++c}}return c}});ClassEx.extendMethod(Kekule.AbstractAtom,"doCompare",function(h,g,e){var c=h(g,e);if(!c&&e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(e,"lonePair")||this._getComparisonOptionFlagValue(e,"unbondedElectron")){var f=function(p){var k=[];if(p.getMarkersOfType){var n=p.getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet);for(var o=0,m=n.length;o<m;++o){var j=n[o];k.push(j.getElectronCount())}}k.sort();return k};var d=f(this);var b=f(g);return Kekule.ArrayUtils.compare(d,b)}}return c})})();(function(i,j){var h=i;if(!h.Kekule){Kekule={}}Kekule.Browser={IE:!!(i.attachEvent&&!i.opera),Opera:!!i.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("like Gecko")<0&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),language:navigator.language||navigator.browserLanguage};Kekule.BrowserFeature={typedArray:(typeof(ArrayBuffer)!=="undefined"),svg:!!i.SVGSVGElement,canvas:!!i.CanvasRenderingContext2D,webgl:(function(){var o=(function(){try{var p=j.createElement("canvas");return !!i.WebGLRenderingContext&&(p.getContext("webgl")||p.getContext("experimental-webgl"))}catch(q){return false}})();return !!o})(),downloadHref:(function(o){return"download" in o.createElement("a")})(j),blob:!!i.Blob,workers:!!i.Worker,fileapi:!!(i.File&&i.FileReader&&i.FileList&&i.Blob),sessionStorage:(function(){try{return !!i.sessionStorage}catch(o){return false}})(),localStorage:(function(){try{return !!i.localStorage}catch(o){return false}})(),cssTransition:(function(o){return"transition" in o||"WebkitTransition" in o||"MozTransition" in o||"msTransition" in o||"OTransition" in o})(j.createElement("div").style),cssTranform:(function(o){return"transform" in o||"WebkitTransform" in o||"MozTransform" in o||"msTransform" in o||"OTransform" in o})(j.createElement("div").style),cssFlex:(function(o){return"flex" in o||"WebkitFlex" in o||"MozFlex" in o||"msFlex" in o||"OFlex" in o})(j.createElement("div").style),html5Form:{placeholder:(function(o){return"placeholder" in o})(j.createElement("input")),supportType:function(p){var q=j.createElement("input");q.setAttribute("type",p);var o=q.type===p;var s=["text","url","search"];if(o&&(s.indexOf(p.toLowerCase())<0)){var r=":)";q.value=r;o=q.value!==r}return o}},mutationObserver:i.MutationObserver||i.MozMutationObserver||i.WebkitMutationObserver,touchEvent:!!i.touchEvent,pointerEvent:!!i.PointerEvent};(function(){var p=0;var q=["ms","moz","webkit","o"];for(var o=0;o<q.length&&!i.requestAnimationFrame;++o){i.requestAnimationFrame=i[q[o]+"RequestAnimationFrame"];i.cancelAnimationFrame=i[q[o]+"CancelAnimationFrame"]||i[q[o]+"CancelRequestAnimationFrame"]}if(!i.requestAnimationFrame){i.requestAnimationFrame=function(v,s){var r=new Date().getTime();var t=Math.max(0,16-(r-p));var u=i.setTimeout(function(){v(r+t)},t);p=r+t;return u}}if(!i.cancelAnimationFrame){i.cancelAnimationFrame=function(r){clearTimeout(r)}}}());Kekule.X={};var b=Kekule.X;var l=function(p){return((p===null)||(typeof(p)==="undefined"))};var k=function(p){return !l(p)};var m=function(o){var p=i.getComputedStyle?i.getComputedStyle(o,null).position:o.currentStyle?o.currentStyle.position:null;if(!p){return false}else{if(!p){return false}else{p=p.toString().toLowerCase();return(p==="relative")||(p==="absolute")}}};b.MutationObserver=i.MutationObserver||i.MozMutationObserver||i.WebkitMutationObserver;b.Event={MOUSE_BTN_LEFT:0,MOUSE_BTN_RIGHT:2,MOUSE_BTN_MID:1,MOUSE_BTN_LR:3};b.Event.PointerType={MOUSE:"mouse",TOUCH:"touch",PEN:"pen"};b.Event.MouseButton={LEFT:0,RIGHT:2,MID:1,LR:3};b.Event.KeyCode={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRTSC:44,INS:45,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145};b.Event.isSupported=(function(){var o={};return function(q){if(q.indexOf("touch")===0){return Kekule.BrowserFeature.touchEvent}if(q.indexOf("pointer")===0){return Kekule.BrowserFeature.pointerEvent}var s={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img",unload:"win",resize:"win"},t=q.replace(/^on/,"");if(o[t]){return o[t]}var r=s[t]=="win"?i:j.createElement(s[t]||"div");q="on"+t;var p=(q in r);if(!p){r.setAttribute(q,"return;");p=typeof r[q]=="function"}r=null;o[t]=p;return p}})();b.Event.Methods={getType:function(o){return o.__$type__||o.type},setType:function(o,p){o.__$type__=p;try{o.type=p}catch(q){}},getPointerType:function(o){return o.pointerType},getTarget:function(o){var p=o.__$target__||o.target||o.srcElement;if(p.nodeType==3){p=p.parentNode}return p},setTarget:function(o,q){o.__$target__=q;try{o.target=q}catch(p){}},getCurrentTarget:function(o){return o.currentTarget},getEventPhase:function(o){return o.eventPhase},getAltKey:function(o){return o.altKey},getCtrlKey:function(o){return o.ctrlKey},getShiftKey:function(o){return o.shiftKey},getCharCode:function(o){return k(o.charCode)?o.charCode:o.keyCode},getKeyCode:function(o){return o.keyCode},getClientX:function(p){var o;if(p.touches){var q=p.touches[0];o=q&&q.clientX}if(o===undefined){o=p.clientX}return o},getClientY:function(p){var o;if(p.touches){var q=p.touches[0];o=q&&q.clientY}if(o===undefined){o=p.clientY}return o},getScreenX:function(p){var o;if(p.touches){var q=p.touches[0];o=q&&q.screenX}if(o===undefined){o=p.screenX}return o},getScreenY:function(p){var o;if(p.touches){var q=p.touches[0];o=q&&q.screenY}if(o===undefined){o=p.screenY}return o},getPageX:function(q){var p;if(q.touches){var s=q.touches[0];if(s&&k(s.pageX)){p=s.pageX}}if(p===undefined&&k(q.pageX)){p=q.pageX}if(p===undefined){var r=b.Event.getTarget(q).ownerDocument||b.Event.getTarget(q);var o=r?r.body:null;p=b.Event.getClientX(q)+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0)}return p},getPageY:function(q){var p;if(q.touches){var s=q.touches[0];if(s&&k(s.pageY)){return s.pageY}}else{if(p===undefined&&k(q.pageY)){return q.pageY}}if(p===undefined){var r=b.Event.getTarget(q).ownerDocument||b.Event.getTarget(q);var o=r?r.body:null;p=b.Event.getClientY(q)+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)}return p},getOffsetX:function(q){if(k(q.offsetX)){return q.offsetX}else{var p=b.Event.getTarget(q);if((p.defaultView||p.parentWindow)&&p.body){p=p.body}if(k(q.layerX)&&m(p)&&!q.touches){return q.layerX}else{var o=b.Event.getClientX(q);return Math.round(o-Kekule.HtmlElementUtils.getElemPagePos(p,true).x)}}},getOffsetY:function(q){if(k(q.offsetY)){return q.offsetY}else{var p=b.Event.getTarget(q);if((p.defaultView||p.parentWindow)&&p.body){p=p.body}if(k(q.layerY)&&m(p)&&!q.touches){return q.layerY}else{var o=b.Event.getClientY(q);return Math.round(o-Kekule.HtmlElementUtils.getElemPagePos(p,true).y)}}},getOffsetCoord:function(o,w){var s=b.Event.getTarget(o);var t;if(w&&Kekule.ObjUtils.isUnset(o.offsetX)){t=Kekule.StyleUtils.getTotalTransformMatrix(s)}if(t){var q=b.Event.getClientX(o);var p=b.Event.getClientY(o);var u={x:q-Kekule.HtmlElementUtils.getElemBoundingClientRect(s).x,y:p-Kekule.HtmlElementUtils.getElemBoundingClientRect(s).y};var v=Kekule.StyleUtils.calcInvertTransformMatrix(t);if(v){var r=Kekule.MatrixUtils.create(3,1);r[0][0]=u.x;r[1][0]=u.y;r[2][0]=1;var x=Kekule.MatrixUtils.multiply(v,r);u.x=x[0][0];u.y=x[1][0];return u}}return{x:b.Event.getOffsetX(o),y:b.Event.getOffsetY(o)}},getWindowX:function(p){var o=b.Event.getPageX(p);var r=p.target.ownerDocument||p.target;var q=r&&(r.defaultView||r.parentWindow);var s=(q&&q.scrollX)||0;return o-s},getWindowY:function(o){var s=b.Event.getPageY(o);var q=o.target.ownerDocument||o.target;var p=q&&(q.defaultView||q.parentWindow);var r=(p&&p.scrollY)||0;return s-r},getRelXToCurrTarget:function(q){var p=b.Event.getCurrentTarget(q);if((p.defaultView||p.parentWindow)&&p.body){p=p.body}var o=b.Event.getClientX(q);return Math.round(o-Kekule.HtmlElementUtils.getElemPagePos(p,true).left)},getRelYToCurrTarget:function(q){var p=b.Event.getCurrentTarget(q);if((p.defaultView||p.parentWindow)&&p.body){p=p.body}var o=b.Event.getClientY(q);return Math.round(o-Kekule.HtmlElementUtils.getElemPagePos(p,true).top)},getTouches:function(o){return o.touches}};b.Event._MouseEventEx={isMouseEnterLeaveEvent:function(o){return(o==="mouseenter")||(o==="mouseleave")},addMouseEnterLeaveListener:function(s,r,t,o){var q=((r==="mouseenter")&&b.Event.isSupported("mouseenter"))||((r==="mouseleave")&&b.Event.isSupported("mouseleave"));if(q){return s.addEventListener(r,t,o)}else{var u=function(z){var y=z.getTarget?z.getTarget():z.target;var v=z.getCurrentTarget?z.getCurrentTarget():z.currentTarget;if((y===v)||(Kekule.DomUtils.isDescendantOf(y,v))){var x=z.getRelatedTarget?z.getRelatedTarget():z.relatedTarget;if((!x)||(!Kekule.DomUtils.isDescendantOf(x,v))){var w=new MouseEvent(r,{view:i,bubbles:false,cancelable:true,target:v,currentTarget:v,relatedTarget:x});t.call(v,w)}}};t.__$mouseExListenerWrapper__=u;var p=(r==="mouseenter")?"mouseover":"mouseout";return s.addEventListener(p,u,o)}},removeMouseEnterLeaveListener:function(r,q,s){var p=((q==="mouseenter")&&b.Event.isSupported("mouseenter"))||((q==="mouseleave")&&b.Event.isSupported("mouseleave"));if(p){return r.removeEventListener(q,s,useCapture)}else{var o=(q==="mouseenter")?"mouseover":"mouseout";return r.removeEventListener(o,s.__$mouseExListenerWrapper__||s)}}};b.Event._W3C={addListener:function(q,p,r,o){if(b.Event._MouseEventEx.isMouseEnterLeaveEvent(p)){return b.Event._MouseEventEx.addMouseEnterLeaveListener(q,p,r,o)}else{return q.addEventListener(p,r,o)}},removeListener:function(q,p,r,o){if(b.Event._MouseEventEx.isMouseEnterLeaveEvent(p)&&r.__$listenerWrapper__){return b.Event._MouseEventEx.removeMouseEnterLeaveListener(q,p,r.__$listenerWrapper__)}else{return q.removeEventListener(p,r,o)}},stopPropagation:function(o){o.stopPropagation()},preventDefault:function(o){o.preventDefault()}};b.Event._W3CMethods={getRelatedTarget:function(o){return o.relatedTarget},getButton:function(o){return o.button}};b.Event._Gecko={addListener:function(q,p,r,o){if(b.Event._MouseEventEx.isMouseEnterLeaveEvent(p)){return b.Event._MouseEventEx.addMouseEnterLeaveListener(q,p,r,o)}if((p==="mousewheel")){var s=function(t){t.wheelDeltaY=t.wheelDelta=-t.detail*40;t.__$type__="mousewheel";r.call(q,t)};r.__$mousewheelListenerWrapper__=s;q.addEventListener("DOMMouseScroll",s,o)}else{q.addEventListener(p,r,o)}},removeListener:function(q,p,r,o){if((p==="mousewheel")&&r.__$mousewheelListenerWrapper__){q.removeEventListener("DOMMouseScroll",r.__$mousewheelListenerWrapper__,o)}else{q.removeEventListener(p,r,o)}}};b.Event._IE={_handlers:{},WIN_UNLOAD_FLAG_FIELD:"__$win_unload_linked__",addListener:function(q,p,r,o){if(b.Event.findHandlerIndex(q,p,r)>=0){return}var u=(function(v){if(!v){v=i.event}v.currentTarget=q;v.eventPhase=(v.srcElement===q)?2:3;if(!d){Object.extend(v,g)}r.call(q,v)});q.attachEvent(b.Event.getEventName(p),u);b.Event.registerHandler(q,p,r,u);var t=q.ownerDocument||q;var s=t.parentWindow||t;b.Event._linkUnloadEvent(s)},removeListener:function(r,q,s,o){var p=b.Event.findHandlerIndex(r,q,s);if(p>=0){var t=b.Event._handlers[q][p].wrapper;r.detachEvent(b.Event.getEventName(q),t);b.Event._handlers[q].splice(p,1)}},stopPropagation:function(o){o.cancelBubble=true},preventDefault:function(o){o.returnValue=false},removeAllListeners:function(t){var u=b.Event._handlers;if(!u){return}for(var s in u){if(u.hasOwnProperty(s)){var q=u[s];if(q&&q.length){var o=b.Event.getEventName(s);for(var p=q.length-1;p>=0;--p){var r=q[p];if((!t)||(r.element.ownerDocument===t)){r.element.detachEvent(o,r.wrapper);q.splice(p,1)}}}}}},getEventName:function(o){return"on"+o},registerHandler:function(r,q,s,t){var o=b.Event._handlers;if(!o[q]){o[q]=[]}var p=o[q];p.push({element:r,handler:s,wrapper:t})},unregisterHandler:function(r,q,s){if(!handlers[q]){return}var p=handlers[q];var o=b.Event.findHandlerIndex(r,q,s);if(o>=0){p.splice(o,1)}},findHandlerIndex:function(s,r,u){var q=b.Event._handlers[r];if(!q){return -1}for(var p=0,o=q.length;p<o;++p){var t=q[p];if((t.element===s)&&(t.handler===u)){return p}}return -1},_linkUnloadEvent:function(o){var p=b.Event.WIN_UNLOAD_FLAG_FIELD;if(o[p]){return}else{o.attachEvent("onunload",b.Event.reactWinUnload);o[p]=true}},reactWinUnload:function(){var o=this.ownerDocument;b.Event.removeAllListeners(o)}};b.Event._IEMethods={getRelatedTarget:function(o){return o.fromElement||o.toElement},getButton:function(o){switch(o.button){case 1:return 0;case 2:return 2;case 4:return 1;case 3:return 3;default:return o.button}},stopPropagation:function(o){o.cancelBubble=true},preventDefault:function(o){o.returnValue=false}};if(j.addEventListener){b.Event=Object.extend(b.Event,b.Event._W3C);b.Event.Methods=Object.extend(b.Event.Methods,b.Event._W3CMethods);if(Kekule.Browser.Gecko){b.Event=Object.extend(b.Event,b.Event._Gecko)}}else{if(j.attachEvent){b.Event=Object.extend(b.Event,b.Event._IE);b.Event.Methods=Object.extend(b.Event.Methods,b.Event._IEMethods);if(i.Element){var f=i.Element.prototype;f.addEventListener=b.Event.addListener.methodize();f.removeEventListener=b.Event.removeListener.methodize()}}}Object.extend(b.Event,b.Event.Methods);var e=null;if(i.Event){e=i.Event.prototype}if(!e){if(j.createEvent){e=j.createEvent("HTMLEvents").__proto__}}var d=!!e;var g={};var c=b.Event.Methods;for(var a in c){if(c.hasOwnProperty(a)&&(typeof(c[a])==="function")){g[a]=c[a].methodize()}}if(e){Object.extend(e,g)}b.Ajax={XMLHttpFactories:[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],_availableFactoryIndex:-1,createXMLHTTPObject:function(){var q=false;var r=b.Ajax.XMLHttpFactories;var o=b.Ajax._availableFactoryIndex;if(o>=0){q=r[o]()}else{for(var p=0;p<r.length;p++){try{q=r[p]();b.Ajax._availableFactoryIndex=p}catch(s){continue}break}}return q},preparePostData:function(p){var o=p;if(typeof(p)==="object"){o=Kekule.UrlUtils.generateSearchString(p)}return o},sendRequest:function(q,x,s,u,r){var p=false;var t=true;var w=b.Ajax.createXMLHTTPObject();if(!w){return}var o=(s)?"POST":"GET";w.open(o,q,true);w.setRequestHeader("User-Agent","XMLHTTP/1.0");if(s){w.setRequestHeader("Content-type","application/x-www-form-urlencoded")}if(u){try{w.responseType=u}catch(v){}if((u==="arraybuffer")||(u==="blob")){p=true}if(w.responseType!==u){t=false}}if(p&&(!t)&w.overwriteMimeType){w.overrideMimeType("text/plain; charset=x-user-defined")}if(r&&w.overwriteMimeType){w.overwriteMimeType(r)}w.onreadystatechange=function(){if(w.readyState!=4){return}if(w.status!=200&&w.status!=304){x(null,w,false);throw"HTTP error "+w.status;return}x(w.response||w.responseText,w,true)};if(w.readyState==4){return}w.send(b.Ajax.preparePostData(s));return w},getResponseMimeType:function(o){return o.getResponseHeader("content-type")||""}};Kekule.Ajax=Kekule.X.Ajax;Kekule.X.DomReady={isReady:false,suspendFlag:0,funcs:[],domReady:function(p){n.initReady();if(!n.isReady){var o=j&&j.readyState;if(o==="complete"||o==="loaded"||(o==="interactive"&&!Kekule.Browser.IE)){n.isReady=true}}if(n.isReady){p()}else{n.funcs.push(p)}},fireReady:function(){if(n.isReady){return}n.isReady=true;n._execFuncs()},_execFuncs:function(){var o=n.funcs;if(o&&o.length){while(o.length&&!n.isSuspending()){var p=o.shift();if(p){p()}}}},suspend:function(){++n.suspendFlag},resume:function(){if(n.suspendFlag>0){--n.suspendFlag}if(!n.isSuspending()){n._execFuncs()}},isSuspending:function(){return n.suspendFlag>0},initReady:function(){if(j.addEventListener){j.addEventListener("DOMContentLoaded",function(){j.removeEventListener("DOMContentLoaded",arguments.callee,false);n.fireReady()},false)}else{if(j.getElementById){j.write('<script id="ie-domReady" defer="defer" src="//:"><\/script>');j.getElementById("ie-domReady").onreadystatechange=function(){if(this.readyState==="complete"){n.fireReady();this.onreadystatechange=null;this.parentNode.removeChild(this)}}}}}};var n=Kekule.X.DomReady;Kekule.X.domReady=n.domReady})(window,document);(function(){Kekule.NativeServices={MODE_OPEN:"open",MODE_SAVE:"save",FILTER_ALL_SUPPORT:"all",FILTER_ANY:"any",showFilePickerDialog:function(c,d,b){if(Kekule.NativeServices.doShowFilePickerDialog){return Kekule.NativeServices.doShowFilePickerDialog(c,d,b)}},canLoadFileData:function(b){return !!a.doLoadFileData||!!a.doShowFilePickerDialog},loadFileData:function(e,f,c){if(Kekule.NativeServices.doLoadFileData){return Kekule.NativeServices.doLoadFileData(e,f,c)}var d=Object.create(c||{});d.multiple=false;d.mode=a.MODE_OPEN;var b=function(h,i,j){if(!h||!i){f(h,null,null)}else{if(Kekule.BrowserFeature.fileapi){var l=i.name;var k=d.binaryDetector&&d.binaryDetector(l,i);var g=new FileReader();g.onload=function(n){var m=g.result;if(f){f(true,m,l)}};g.onerror=function(){if(f){f(false)}Kekule.error(Kekule.$L("ErrorMsg.ERROR_LOADING_FILE"+l))};if(k){g.readAsArrayBuffer(i)}else{g.readAsText(i)}}else{Kekule.error(Kekule.$L("ErrorMsg.FILE_API_NOT_SUPPORTED"))}}};a.showFilePickerDialog(e,b,d)},canSaveFileData:function(b){return !!a.doSaveFileData},saveFileData:function(d,c,e,b){if(Kekule.NativeServices.doSaveFileData){return Kekule.NativeServices.doSaveFileData(d,c,e,b)}}};var a=Kekule.NativeServices;Kekule.HtmlNativeServiceImpl={doShowFilePickerDialog:function(d,e,b){var c=Kekule.HtmlNativeServiceImpl._createFileInputElem(d,e,b||{});c.click()},_createFileInputElem:function(k,m,o){var p=k.createElement("input");p.setAttribute("type","file");var c=o||{};if(c.multiple){p.setAttribute("multiple","multiple")}if(c.filters){var d=[];for(var h=0,f=c.filters.length;h<f;++h){var e=c.filters[h];if(e===Kekule.NativeServices.FILTER_ALL_SUPPORT||e===Kekule.NativeServices.FILTER_ANY){continue}var g=e.filter;if(g){d.push(g)}}var n=d.join(",");p.setAttribute("accept",n)}var b=p.style;b.position="absolute";b.left="-100000px";b.opacity=0;k.body.appendChild(p);var j=function(r){var q=r.getTarget();var l=q.files;var i=l&&l[0];if(m){m(true,i,l)}Kekule.X.Event.removeListener(q,"change",j);q.ownerDocument.body.focus();if(q.parentNode){}};Kekule.X.Event.addListener(p,"change",j);return p},doSaveFileData:function(e,d,g,c){var f=c.initialFileName||null;var b=Kekule.HtmlNativeServiceImpl._createDataElem(e,d,f);b.click();b.parentNode.removeChild(b);if(g){g(null,null)}},_createDataElem:function(f,e,g){var c=f.createElement("a");var d="data:application/octet-stream,"+encodeURIComponent(e);c.setAttribute("href",d);c.setAttribute("download",g||"");var b=c.style;c.position="absolute";c.left="-100000px";c.opacity=0;f.body.appendChild(c);return c},doSaveFileDataIe:function(f,e,h,d){var g=d.initialFileName||null;if(Kekule.BrowserFeature.blob&&window.navigator.msSaveOrOpenBlob){var b=new Blob([e]);window.navigator.msSaveBlob(b,g)}else{var c=Kekule.HtmlNativeServiceImpl._createAndExecDataIframe(f,e,g);c.parentNode.removeChild(c)}if(h){h(null,null)}},_createAndExecDataIframe:function(f,e,g){var b=f.createElement("iframe");f.body.appendChild(b);var d=b.contentWindow||b.contentDocument;d.document.open("text/html","replace");var c=e.toString();d.document.write(c);d.document.close();d.focus();d.document.execCommand("SaveAs",true,Kekule.UrlUtils.extractFileCoreName(g));return b}};if(Kekule.BrowserFeature.fileapi){a.doShowFilePickerDialog=Kekule.HtmlNativeServiceImpl.doShowFilePickerDialog}if(Kekule.Browser.IE||window.navigator.msSaveOrOpenBlob){a.doSaveFileData=Kekule.HtmlNativeServiceImpl.doSaveFileDataIe}else{if(Kekule.BrowserFeature.downloadHref){a.doSaveFileData=Kekule.HtmlNativeServiceImpl.doSaveFileData}}})();Kekule.PredefinedResLoader=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PredefinedResLoader",initialize:function($super,c,b,a){$super();if(!b){Kekule.Error(Kekule.$L("ErrorMsg.EMPTY_RESURI"))}else{this.setPropStoreFieldValue("resUri",b);this.setDoc(c);if(a){this.setResType(a)}}},initProperties:function(){this.defineProp("doc",{dataType:DataType.OBJECT,serializable:false});this.defineProp("resUri",{dataType:DataType.STRING,serializable:false,setter:null});this.defineProp("resType",{dataType:DataType.STRING,serializable:false})},getLinkedResUrl:function(b){var a=b.tagName.toLowerCase();if(a==="link"){return b.getAttribute("href")}else{if(a==="script"){return b.getAttribute("src")}else{return null}}},getElemResType:function(a){return a.getAttribute("type")},load:function(k){var e=this.getResUri();var h,a;var d=Kekule.PredefinedResReferer.ID_MARK;if(e.startsWith(d)){var c=e.substr(d.length).trim();h=this.getDoc().getElementById(c);if(h){a=this.getLinkedResUrl(h);var j=this.getElemResType(h);if(j){this.setResType(j)}}}else{a=e}var f={resType:this.getResType(),resUri:e};if(a){Kekule.X.Ajax.sendRequest(a,function(o,n,p){if(p){f=Object.extend(f,{data:o,text:n.responseText,success:true});if(!f.resType){f.resType=Kekule.X.Ajax.getResponseMimeType(n);if(f.resType===Kekule.IO.MimeType.OCTSTREAM){var m=Kekule.UrlUtils.extractFileExt(a);if(m){var l=Kekule.IO.DataFormatsManager.findFormat(null,m);if(l){f.resType=l.mimeType}}}}k(f,p)}else{k(f,false)}},null,null,this.getResType()||null)}else{if(h){var i=h.innerHTML;var g=2;var b=i.indexOf("\r\n");if(b<0){b=i.indexOf("\n");g=1}if(b===0){i=i.substring(g)}f=Object.extend(f,{data:i,text:i,resType:f.resType||"text/plain",success:true});k(f,true)}else{k(f,false)}}}});Kekule.PredefinedResReferer={REFER_PATTERN:/^\s*url\((\S+)\)\s*$/,ID_MARK:"#",isResValue:function(a){return Kekule.PredefinedResReferer.isResReferrer(a)},isResReferrer:function(a){return Kekule.PredefinedResReferer.REFER_PATTERN.test(a)},extractReferedValue:function(c){var a=Kekule.PredefinedResReferer.REFER_PATTERN.exec(c);if(a){var b=a[1];if(b){b=Kekule.StrUtils.unquote(b);return b}}return null},loadResource:function(d,g,b,e){if(!e){e=document}var c=Kekule.PredefinedResReferer;var a=c.extractReferedValue(d);var f;f=new Kekule.PredefinedResLoader(e,a);if(f){if(b){f.setResType(b)}f.load(g)}}};Kekule._registerAfterLoadSysProc(function(){if(Kekule.IO){Kekule.IO.loadResourceData=function(b,d,a,c){Kekule.PredefinedResReferer.loadResource(b,function(e,f){var g;if(f){g=Kekule.IO.loadTypedData(e.data,e.resType,e.resUri)}if(d){d(g,f)}},a,c)}}});(function(){Kekule.DomUtils={namespaceMatched:function(b,a,c){if(c===undefined){c=true}return((b.namespaceURI==a)||(c&&(!b.namespaceURI)))},isElement:function(a){return(a&&a.tagName&&a.nodeType)},getElementText:function(d){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==3){a+=d.childNodes[c].nodeValue}}return a},setElementText:function(d,f){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==3){d.childNodes[c].nodeValue=f;return f}}var e=d.ownerDocument.createTextNode(f);d.appendChild(e);return f},getLocalName:function(a){return a.localName||a.baseName||a.nodeName},getChildNodesOfTypes:function(f,b){var a=[];var e=Kekule.ArrayUtils.toArray(b);for(var d=0,c=f.childNodes.length;d<c;++d){var g=f.childNodes[d];if(!b||(e.indexOf(g.nodeType)>=0)){a.push(g)}}return a},getFirstChildElem:function(g,e,b,c){for(var d=0,a=g.childNodes.length;d<a;++d){var f=g.childNodes[d];if(f.nodeType===Node.ELEMENT_NODE){if((e&&(e.toLowerCase()===f.tagName.toLowerCase()))||(b&&(b.toLowerCase()===Kekule.DomUtils.getLocalName(f).toLowerCase()))||((!e)&&(!b))){if((!c)||Kekule.DomUtils.namespaceMatched(f,c)){return f}}}}},getDirectChildElems:function(h,f,c,d){var a=[];for(var e=0,b=h.childNodes.length;e<b;++e){var g=h.childNodes[e];if(g.nodeType===Node.ELEMENT_NODE){if((f&&(f.toLowerCase()===g.tagName.toLowerCase()))||(c&&(c.toLowerCase()===Kekule.DomUtils.getLocalName(g).toLowerCase()))||((!f)&&(!c))){if((!d)||Kekule.DomUtils.namespaceMatched(g,d)){a.push(g)}}}}return a},getDirectChildElemsOfAttribValues:function(e,p,c,g,b){var a=Kekule.DomUtils.getDirectChildElems(e,c,g,b);var q=[];for(var n=0,f=a.length;n<f;++n){var o=true;for(var m=0,h=p.length;m<h;++m){var d=Kekule.ObjUtils.getOwnedFieldNames(p[m])[0];if(a[n].getAttribute(d)!=p[m][d]){o=false;break}}if(o){q.push(a[n])}}return q},isDescendantOf:function(b,a){try{if(b&&a){if(b.documentElement){return false}if(b.ownerDocument===a){return true}var c=b.parentNode;while(c){if(c===a){return true}c=c.parentNode}}return false}catch(d){return false}},isOrIsDescendantOf:function(b,a){return(b===a)||Kekule.DomUtils.isDescendantOf(b,a)},getNearestAncestorByTagName:function(e,d,c){var b=d.toLowerCase();if(c&&e.tagName&&(e.tagName.toLowerCase()===b)){return e}var a=e.parentNode;while(a&&a.tagName){if(a.tagName.toLowerCase()===b){return a}a=a.parentNode}return null},getSameNSAttributeValue:function(d,c,b){var a=d.getAttribute(c);return a},setSameNSAttributeValue:function(d,c,e,b){var a=d.setAttribute(c,e);return a},fetchAttributeValuesToArray:function(c,b,d){var k=[];for(var h=0,f=c.attributes.length;h<f;++h){var g=c.attributes[h];if(b&&(!Kekule.DomUtils.namespaceMatched(g,b,true))){continue}var a;if(d){try{a=Kekule.DomUtils.getLocalName(g)}catch(j){a=g.name}}else{a=g.name}k.push({name:a,value:g.value})}return k},fetchAttributeValuesToJson:function(c,b,d){var k={};for(var h=0,f=c.attributes.length;h<f;++h){var g=c.attributes[h];if(b&&(!Kekule.DomUtils.namespaceMatched(g,b,true))){continue}var a;if(d){try{a=Kekule.DomUtils.getLocalName(g)}catch(j){a=g.name}}else{a=g.name}k[a]=g.value}return k},hasAttribute:function(b,a){if(b.hasAttribute){return b.hasAttribute(a)}else{var c=b.getAttribute(a);return !!c}},isDataAttribName:function(a){return a.toString().startsWith("data-")},getDataAttribCoreName:function(a){if(Kekule.DomUtils.isDataAttribName(a)){return a.substr(5)}else{return null}},getDataAttrib:function(b,a){if(b.dataset){return b.dataset[a]}else{return b.getAttribute("data-"+a.toString().hyphenize())}},setDataAttrib:function(b,a,c){if(b.dataset){b.dataset[a]=c}else{b.setAttribute("data-"+a.toString().hyphenize(),c)}},getDataset:function(e){if(e.dataset){return e.dataset}else{var a={};var g=e.attributes;for(var d=0,b=g.length;d<b;++d){var f=g[d];var c=f.name;if(c.toLowerCase().indexOf("data-")===0){var h=c.substring(5).camelize();a[h]=f.value}}return a}},clearChildContent:function(a){var c=Kekule.ArrayUtils.toArray(a.childNodes);for(var b=c.length-1;b>=0;--b){var d=c[b];if(d.nodeType===Node.ATTRIBUTE_NODE){continue}a.removeChild(d)}return a},replaceTagName:function(c,d){if(c.tagName.toLowerCase()!==d.toLowerCase()){var h=c.ownerDocument.createElement(d);var a=Kekule.DomUtils.fetchAttributeValuesToArray(c);for(var f=0,e=a.length;f<e;++f){h.setAttribute(a[f].name,a[f].value)}var b=Kekule.DomUtils.getDirectChildElems(c);for(var f=0,e=b.length;f<e;++f){h.appendChild(b[f])}var g=c.parentNode;var j=c.nextSibling;g.removeChild(c);if(j){g.insertBefore(h,j)}else{g.appendChild(h)}return h}else{return c}},setElemAttributes:function(d,f){var c=Kekule.ObjUtils.getOwnedFieldNames(f);for(var b=0,a=c.length;b<a;++b){var g=c[b];var e=f[g];if(g&&e){d.setAttribute(g,e)}}return d},isInDomTree:function(b,c){if(!b){return false}if(!c){c=b.ownerDocument}if(c){var a=c.documentElement;return Kekule.DomUtils.isDescendantOf(b,a)||b===a}else{return false}}};Kekule.StyleUtils={removeStyleProperty:function(a,b){if(a.removeProperty){a.removeProperty(b)}else{if(a.removeAttribute){a.removeAttribute(b)}else{a[b]=null}}},analysisUnitsValue:function(e){var d={};d.total=e;d.value=parseFloat(e);var a;if(e&&e.length&&(d.value!==undefined)&&(d.value!==NaN)){a="";for(var b=e.length-1;b>=0;--b){var g=e.charAt(b);var f=(g>="0")&&(g<="9");if((!f)&&(g!==".")&&(g!=="-")){a=g+a}}}d.units=a||"";return d},multiplyUnitsValue:function(b,c){var a=Kekule.StyleUtils.analysisUnitsValue(b);a.value*=c;return""+a.value+a.units},colorStrToValue:function(f){var b=f.length>4;var d=b?f.substr(1,2):f.substr(1,1);var c=b?f.substr(3,2):f.substr(2,1);var e=b?f.substr(5,2):f.substr(3,1);if(!b){d+=d;c+=c;e+=e}var a=(parseInt(d,16)<<16)+(parseInt(c,16)<<8)+parseInt(e,16);return a},getComputedStyle:function(c,d){var b;var e=c.ownerDocument;if(!e){return null}var a=e.defaultView;if(a&&a.getComputedStyle){b=a.getComputedStyle(c,null)}else{if(c.currentStyle){b=c.currentStyle}}if(b){return d?b[d]:b}else{return null}},isShown:function(b){var a=Kekule.StyleUtils;return(a.isDisplayed(b)&&a.isVisible(b))},isDisplayed:function(a){return(Kekule.StyleUtils.getComputedStyle(a,"display")||"").toLowerCase()!=="none"},getDisplayed:function(a){return Kekule.StyleUtils.getComputedStyle(a,"display")},setDisplay:function(a,b){if(a){if(typeof(b)==="string"){a.style.display=b}else{a.style.display=(!!b)?"":"none"}}},isVisible:function(a){return(Kekule.StyleUtils.getComputedStyle(a,"visibility")||"").toLowerCase()!=="hidden"},getVisibility:function(a){return Kekule.StyleUtils.getComputedStyle(a,"visibility")},setVisibility:function(a,b){if(a){if(typeof(b)==="string"){a.style.visibility=b}else{a.style.visibility=(!!b)?"":"hidden"}}},isBlockElem:function(a){var b=Kekule.StyleUtils.getComputedStyle(a,"display");return["block","list-item","table","flex","grid"].indexOf(b)>=0},isAbsOrFixPositioned:function(b){var a=Kekule.StyleUtils.getComputedStyle(b,"position")||"";a=a.toLowerCase();return(a==="absolute")||(a==="fixed")},_fillAbsOrFixedPositionStyleStack:function(d,b){var a=Kekule.StyleUtils.getComputedStyle(d,"position")||"";a=a.toLowerCase();if((a==="absolute")||(a==="fixed")){b.push(a.toLocaleLowerCase())}var c=d.parentNode;if(c&&c.ownerDocument){Kekule.StyleUtils._fillAbsOrFixedPositionStyleStack(c,b)}return b},isAncestorPositionFixed:function(b){var a=b.parentNode;if(a){return Kekule.StyleUtils.isSelfOrAncestorPositionFixed(b)}else{return false}},isSelfOrAncestorPositionFixed:function(c){var a=[];Kekule.StyleUtils._fillAbsOrFixedPositionStyleStack(c,a);if(!a.length){return null}for(var b=a.length-1;b>=0;--b){var d=a[b];if(d==="fixed"){return true}}return false},setCursor:function(d,e){if(DataType.isArrayValue(e)){for(var c=0,a=e.length;c<a;++c){var b=e[c];d.style.cursor=b;if(d.style.cursor===b){return b}}return d.style.cursor}else{d.style.cursor=e;return d.style.cursor}},_cssTransformValuesToMatrix:function(b){var a=Kekule.MatrixUtils.create(3,3,0);a[0][0]=b.a;a[1][0]=b.b;a[0][1]=b.c;a[1][1]=b.d;a[0][2]=b.tx;a[1][2]=b.ty;return a},_matrixToCssTransformValues:function(b){var a={a:b[0][0],b:b[1][0],c:b[0][1],d:b[1][1],tx:b[0][2],ty:b[1][2]};return a},hasTransform:function(b){var a=Kekule.StyleUtils.getComputedStyle(b,"transform");return a&&(a!=="none")},getTransformMatrixValues:function(c){var b=Kekule.StyleUtils.getComputedStyle(c,"transform")||"";var a=b.match(/-?[\d\.]+/g);if(a){return{a:a[0],b:a[1],c:a[2],d:a[3],tx:a[4],ty:a[5]}}else{return null}},setTransformMatrixArrayValues:function(c,a){if(a){var b="matrix("+a.join(",")+")";c.style.transform=b}},getTransformMatrix:function(b){var a=Kekule.StyleUtils.getTransformMatrixValues(b);if(a){return Kekule.StyleUtils._cssTransformValuesToMatrix(a)}else{return null}},getCascadeTranformMatrixes:function(d){var c=[];var b=d;while(b){var a=Kekule.StyleUtils.getTransformMatrix(b);if(a){c.unshift(a)}b=b.parentNode}return c},getTotalTransformMatrix:function(d){var e=Kekule.StyleUtils.getCascadeTranformMatrixes(d);var b=null;for(var c=e.length-1;c>=0;--c){var a=e[c];if(!b){b=a}else{b=Kekule.MatrixUtils.multiply(b,a)}}return b},calcInvertTransformMatrix:function(c){var d=Kekule.StyleUtils._matrixToCssTransformValues(c);var b=d;var e=b.a*b.d-b.b*b.c;if(Math.abs(e)<0.000001){return false}var f={a:b.d/e,b:-b.b/e,c:-b.c/e,d:b.a/e,tx:(b.c*b.ty-b.d*b.tx)/e,ty:(b.b*b.tx-b.a*b.ty)/e};var a=Kekule.StyleUtils._cssTransformValuesToMatrix(f);return a}};Kekule.HtmlElementUtils={getClassNames:function(a){return Kekule.StrUtils.splitTokens(a.className)},hasClass:function(b,a){var c=Kekule.HtmlElementUtils.getClassNames(b);return(c.indexOf(a)>=0)},addClass:function(e,d){var b=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);for(var c=0,a=f.length;c<a;++c){if(!b.hasClass(e,f[c])){e.className+=" "+f[c]}}return b},removeClass:function(e,d){var a=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);var g=a.getClassNames(e);for(var c=g.length;c>=0;--c){var b=f.indexOf(g[c]);if(b>=0){g.splice(c,1)}}e.className=g.join(" ");return a},toggleClass:function(e,d){var b=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);for(var c=0,a=f.length;c<a;++c){if(b.hasClass(e,f[c])){b.removeClass(e,f[c])}else{b.addClass(e,f[c])}}return b},getInnerText:function(a){return a.innerText||a.textContent},resizeElem:function(d,b,a,c){d.style.width=b+(c||"px");d.style.height=a+(c||"px")},getElemClientDimension:function(a){return{width:a.clientWidth,height:a.clientHeight}},getElemScrollDimension:function(a){return{width:a.scrollWidth,height:a.scrollHeight}},getElemComputedDimension:function(e){var c=Kekule.StyleUtils;var f={width:c.getComputedStyle(e,"width"),height:c.getComputedStyle(e,"height")};var d=c.analysisUnitsValue(f.width);var b=c.analysisUnitsValue(f.height);var a={};if(d.units==="px"){a.width=d.value}if(b.units==="px"){a.height=d.value}return a},getElemOffsetDimension:function(a){return{width:a.offsetWidth,height:a.offsetHeight}},getViewportDimension:function(b){var a;if(b){if(b.ownerDocument){a=Kekule.DocumentUtils.getDefaultView(b.ownerDocument)}else{if(b.defaultView){a=b.defaultView}else{if(b.parentWindow){a=b.parentWindow}else{a=b}}}}a=a||window;if(a.innerWidth!=null){return{width:a.innerWidth,height:a.innerHeight}}var c=a.document;if(c.compatMode=="CSS1Compat"){return{width:c.documentElement.clientWidth,height:c.documentElement.clientHeight}}return{width:c.body.clientWidth,height:c.body.clientHeight}},getViewportVisibleBox:function(c){var b;if(c){if(c.ownerDocument){b=Kekule.DocumentUtils.getDefaultView(c.ownerDocument)}else{if(c.defaultView){b=c.defaultView}else{if(c.parentWindow){b=c.parentWindow}else{b=c}}}}b=b||window;var e=b.document;var d=Kekule.HtmlElementUtils.getViewportDimension(b);var f=Kekule.DocumentUtils.getScrollPosition(e);var a={x1:f.left,y1:f.top,x2:d.width,y2:d.height};a.left=a.x1;a.top=a.y1;a.right=a.x2;a.bottom=a.y2;return a},getElemBoundingClientRect:function(d,c){var b=Object.extend({},d.getBoundingClientRect());if(Kekule.ObjUtils.isUnset(b.width)){b.width=b.right-b.left}if(Kekule.ObjUtils.isUnset(b.height)){b.height=b.bottom-b.top}if(c){var f=d.ownerDocument;var e=f.documentElement.scrollTop||f.body.scrollTop||0;var g=f.documentElement.scrollLeft||f.body.scrollLeft||0;b.left+=g;b.right+=g;b.top+=e;b.bottom+=e}var a=b;a.x=a.left;a.y=a.top;return a},getElemPagePos:function(c,e){var d=0;var b=0;var a=c;while(a){d+=(a.offsetLeft-a.scrollLeft+a.clientLeft);b+=(a.offsetTop-a.scrollTop+a.clientTop);a=a.offsetParent}if(e){var g=c.ownerDocument;var f=g.documentElement.scrollTop||g.body.scrollTop||0;var h=g.documentElement.scrollLeft||g.body.scrollLeft||0;d-=h;b-=f}return{x:d,y:b}},getElemPageRect:function(a,b){var d=Kekule.HtmlElementUtils.getElemPagePos(a,b);var c=Kekule.HtmlElementUtils.getElemClientDimension(a);return{x:d.x,y:d.y,left:d.x,top:d.y,right:d.x+c.width,bottom:d.y+c.height,width:c.width,height:c.height}},getElemViewportPos:function(b){var a=Kekule.HtmlElementUtils.getElemPagePos(b,true);return{x:a.left,y:left.top}},makePositioned:function(a){var b=Kekule.StyleUtils.getComputedStyle(a,"position");if(!b||b.toLowerCase()==="static"){a.style.position="relative"}},isFormCtrlElement:function(b){var c=["input","button","textarea","select"];var a=b&&b.tagName.toLowerCase();return !!a&&c.indexOf(a)>=0},requestFullScreen:function(b){var a=b.requestFullScreen||b.mozRequestFullScreen||b.webkitRequestFullScreen||b.msRequestFullScreen;return a?a.apply(b):null},exitFullScreen:function(b){var a=b.exitFullScreen||b.mozExitFullScreen||b.webkitExitFullScreen||b.msExitFullScreen;return a?a.apply(b):null}};Kekule.DocumentUtils={getDefaultView:function(a){return a.defaultView||a.parentWindow},getScrollPosition:function(b){var c=Kekule.DocumentUtils.getDefaultView(b);var a={left:((c.pageXOffset!==undefined)?c.pageXOffset:(b.documentElement||b.body.parentNode||b.body).scrollLeft)||0,top:((c.pageYOffset!==undefined)?c.pageYOffset:(b.documentElement||b.body.parentNode||b.body).scrollTop)||0};a.x=a.left;a.y=a.top;return a},getClientDimension:function(a){if(a.compatMode=="BackCompat"){return{width:a.body.clientWidth,height:a.body.clientHeight}}else{return{width:a.documentElement.clientWidth,height:a.documentElement.clientHeight}}},getClientVisibleBox:function(b){var d=Kekule.DocumentUtils.getScrollPosition(b);var c=Kekule.DocumentUtils.getInnerClientDimension(b);var a={};a.left=a.x1=d.left;a.top=a.y1=d.top;a.right=a.x2=c.width+d.left;a.bottom=a.y2=c.height+d.top;a.width=c.width;a.height=c.height;return a},getWindowInnerDimension:function(a){var b=Kekule.DocumentUtils.getDefaultView(a);return{width:Math.min(b.innerWidth,b.outerWidth),height:Math.min(b.innerHeight,b.outerHeight)}},getInnerClientDimension:function(a){var c=Kekule.DocumentUtils.getClientDimension(a);var b=Kekule.DocumentUtils.getWindowInnerDimension(a);return{width:b.width?Math.min(b.width,c.width):c.width,height:b.height?Math.min(b.height,c.height):c.height}},getClientScaleLevel:function(a){return(a.compatMode=="BackCompat")?a.body.clientWidth/window.innerWidth:a.documentElement.clientWidth/window.innerWidth},getPixelZoomLevel:function(a){var b=Kekule.DocumentUtils.getClientScaleLevel(a);return b*(Kekule.DocumentUtils.getDefaultView(a).devicePixelRatio||1)},getDevicePPI:function(a){var e=Kekule.DocumentUtils.getDefaultView(a);if(e.matchMedia){var d=0;var c=0;var f=200;var b=[];while(!c||((c-d)>1)){if(e.matchMedia("(min-resolution: "+f+"dpi)").matches){if(c){d=f;f=Math.round((d+c)/2)}else{d=f;f=2*f}}else{c=f;f=Math.round((d+c)/2)}}return f}else{return 96}}};Kekule.DataSrcAttribUtils={isUrlBasedValue:function(b){var a=b.toLowerCase().indexOf("url(");return(a===0)},getUrl:function(d){var a=d.trim();var c=a.toLowerCase().indexOf("url(");if(c===0){var b=a.lastIndexOf(")");a=a.substring(4,b);return a}else{return null}},getElementContent:function(b){if(!b){return null}var a=b.innerHTML;a=a.ltrim();return a},getElementMimeType:function(a){return a.getAttribute("type")}};Kekule.ScriptFileUtils={_existedScriptUrls:new Kekule.MapEx(),appendScriptFile:function(d,b,e){var c=Kekule.ScriptFileUtils._existedScriptUrls.get(d);if(!c){c=[];Kekule.ScriptFileUtils._existedScriptUrls.set(d,c)}if(c.indexOf(b)>=0){if(e){e()}return}var a=d.createElement("script");a.src=b;a.onload=a.onreadystatechange=function(g){if(a._loaded){return}var f=a.readyState;if(f===undefined||f==="loaded"||f==="complete"){a._loaded=true;a.onload=a.onreadystatechange=null;c.push(b);if(e){e()}}};(d.getElementsByTagName("head")[0]||d.body).appendChild(a);return a},appendScriptFiles:function(d,c,e){var b=[].concat(c);var a=function(h,g,i){if(g.length<=0){if(i){i()}return}var f=g.shift();Kekule.ScriptFileUtils.appendScriptFile(h,f,function(){Kekule.ScriptFileUtils.appendScriptFiles(h,g,i)})};a(d,b,e)}}})();Kekule.DomHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DomHelper",NAMESPACE_DEFINE_PREFIX:"xmlns",NAMESPACE_DELIMITER:":",ERR_EMPTY_DOC:"Document is empty",ERR_ELEMENT_NOTSET:"Element not set",initialize:function($super,a){$super();this._supportNsMethods=null;if(a){this.setDocument(a)}},initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("document");if(!a){var b=this.getPropStoreFieldValue("rootElement");a=b?b.ownerDocument:null}return a},setter:function(a){if(a!=this.getPropStoreFieldValue("document")){this.setPropStoreFieldValue("document",a);this.analysisRootElem()}}});this.defineProp("rootElement",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("rootElement");if(!a){var b=this.getPropStoreFieldValue("document");a=b?b.documentElement:null}return a},setter:function(a){this.setPropStoreFieldValue("rootElement",a);this.analysisRootElem()}});this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:false,getter:function(){if(!this.getPropStoreFieldValue("namespaces")){this.setPropStoreFieldValue("namespaces",[])}return this.getPropStoreFieldValue("namespaces")}});this.defineProp("defNamespaceURI",{dataType:DataType.STRING,serializable:false});this.defineProp("forceAnalysisDoc",{dataType:DataType.BOOL})},analysisRootElem:function(){this.setNamespaces([]);this.setDefNamespaceURI(null);var b=this.getRootElement();if(!b){return}var j=b.ownerDocument;this._supportNsMethods=!!j.getElementsByTagNameNS;if((!this._supportNsMethods)||(this.getForceAnalysisDoc())){for(var f=0,d=b.attributes.length;f<d;++f){var e=b.attributes[f];var c=e.name;if(c&&c.indexOf(this.NAMESPACE_DEFINE_PREFIX)>=0){var h=e.value;var a=c.indexOf(this.NAMESPACE_DELIMITER);var g=(a>=0)?c.substring(a+1):null;this.getNamespaces().push({namespaceURI:h,prefix:g});if(!g){this.setDefNamespaceURI(h)}}}}},_getEmptyDocErrorMsg:function(){return !Kekule.hasLocalRes()?this.ERR_EMPTY_DOC:Kekule.$L("ErrorMsg.EMPTY_DOC")},_getElementNotSetErrorMsg:function(){return !Kekule.hasLocalRes()?this.ELEMENT_NOTSET:Kekule.$L("ErrorMsg.ELEMENT_NOTSET")},assertDocAvailable:function(a){if(!a){Kekule.raise(this._getEmptyDocErrorMsg());return false}else{return true}},assertElementAvailable:function(a){if(!a){Kekule.raise(this._getElementNotSetErrorMsg());return false}else{return true}},getNsPrefix:function(b){if(b==this.getDefNamespaceURI()){return""}var d=this.getNamespaces();for(var c=0,a=d.length;c<a;++c){if(d[c].namespaceURI==b){return d[c].prefix}}return null},getQualifiedName:function(b,a){var c=this.getNsPrefix(b);if(c===null){return null}else{return c?c+this.NAMESPACE_DELIMITER+a:a}},createElementNS:function(a,c){var b=this.getDocument();if(!this.assertDocAvailable(b)){return null}if(this._supportNsMethods){return b.createElementNS(a,c)}else{return b.createElement(c)}},getElementsByTagNameNS:function(c,b,d){var a=this.getPropStoreFieldValue("document")||this.getPropStoreFieldValue("rootElement");var f=this.getDocument();if(!this.assertDocAvailable(f)){return null}if(this._supportNsMethods){if(d){return d.getElementsByTagNameNS(c,b)}else{return a.getElementsByTagNameNS(c,b)}}else{var e=this.getQualifiedName(c,b);if(e===null){return[]}else{if(d){return d.getElementsByTagName(e)}else{return a.getElementsByTagName(e)}}}},getAttributeNodeNS:function(b,a,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.getAttributeNodeNS(b,a)}else{var d=this.getQualifiedName(b,a);if(d===null){return null}else{return c.getAttributeNode(d)}}},getAttributeNS:function(b,a,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.getAttributeNS(b,a)}else{var d=this.getQualifiedName(b,a);if(d===null){return null}else{return c.getAttribute(d)}}},setAttributeNS:function(b,a,d,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.setAttributeNS(b,a,d)}else{var e=this.getQualifiedName(b,a);if(e===null){return null}else{return c.setAttribute(e,d)}}}});Kekule.TextLinesBuffer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TextLinesBuffer",LINEBREAK:"\n",initialize:function($super,a){$super();this.setPropStoreFieldValue("lines",[]);if(a){if(typeof(a)=="string"){this.setText(a)}else{this.setLines(a)}}this.setCurrLineNo(0)},initProperties:function(){this.defineProp("lines",{dataType:DataType.ARRAY,serializable:false});this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getLines().join(this.LINEBREAK)},setter:function(a){this.setPropStoreFieldValue("lines",[]);this.reset();this.appendText(a)}});this.defineProp("currLineNo",{dataType:DataType.INT,serializable:false})},getUnreadLines:function(){var a=[].concat(this.getLines());a.splice(0,this.getCurrLineNo());return a},getUnreadText:function(){return this.getUnreadLines().join(this.LINEBREAK)},appendText:function(b){var a=b.split(this.LINEBREAK);this.appendLines(a)},appendLines:function(a){this.setPropStoreFieldValue("lines",this.getLines().concat(a));this.notifyPropSet("lines",this.getPropStoreFieldValue("lines"))},clear:function(){this.setLines([]);this.setCurrLineNo(0)},incCurrLineNo:function(b){if((b===null)||(typeof(b)=="undefined")){b=1}var a=this.getCurrLineNo();a+=b;this.setCurrLineNo(a)},getLineAt:function(a){var b=this.getLines()[a];if(b&&b.length&&(b.charAt(b.length-1)==="\r")){b=b.substring(0,b.length-1)}return b},getCurrLine:function(){return this.getLineAt(this.getCurrLineNo())},readLine:function(){var a=this.getLineAt(this.getCurrLineNo());this.incCurrLineNo();return a},writeLine:function(b){var a=this.getLines();a.splice(this.getCurrLineNo(),0,b);this.incCurrLineNo()},writeLines:function(b){for(var c=0,a=b.length;c<a;++c){this.writeLine(b[c])}},writeText:function(b){var a=b.split(this.LINEBREAK);this.writeLines(a)},eof:function(){return this.getCurrLineNo()>=this.getLines().length},reset:function(){this.setCurrLineNo(0)}});(function(){Kekule.globalOptions.add("IO",{});Kekule.IO={};Kekule.IO.ChemDataType={TEXT:"text",DOM:"dom",JSON:"json",BINARY:"bin",OTHER:"other",UNKNOWN:"unknown",isBinaryType:function(b){var c=Kekule.IO.ChemDataType;return(!b)||(b===c.BINARY)||(b===c.OTHER)||(b===c.UNKNOWN)}};Kekule.IO.DataFormat={};Kekule.IO.MimeType={TEXT:"text/plain",HTML:"text/html",XML:"text/xml",JSON:"application/json",JAVASCRIPT:"application/javascript",GIF:"image/gif",JPEG:"image/jpeg",PNG:"image/png",XPNG:"image/x-png",OCTSTREAM:"application/octet-stream"};Kekule.IO.DataFormatsManager={_formats:{},register:function(b,c,e,g,f,h,i){var j=null;if(!j){j=a._formats[b]}if(!j){j={id:b};a._formats[b]=j}j.mimeType=c;var d=DataType.isArrayValue(e)?e:[e];if(!j.fileExts){j.fileExts=d}else{Kekule.ArrayUtils.pushUnique(j.fileExts,d)}if(g&&(g!==Kekule.IO.ChemDataType.UNKNOWN)){j.dataType=g}j.title=f;j.description=h;if(i){j=Object.extend(j,i)}return j},unregister:function(b){if(a._formats[b]){delete a._formats[b]}},getAllIds:function(){return Kekule.ObjUtils.getOwnedFieldNames(a._formats)},getFormatInfo:function(b){return a._formats[b]||null},getMimeType:function(c){var b=a.getFormatInfo(c);return b?b.mimeType:null},getFileExts:function(c){var b=a.getFormatInfo(c);return b?b.fileExts:null},findFormat:function(h,d){if(!h&&!d){return null}var f=a.getAllIds();var b=false;for(var e=0,c=f.length;e<c;++e){var g=a.getFormatInfo(f[e]);b=(h&&(h===g.mimeType));if(!b){b=(d&&(g.fileExts.indexOf(d)>=0))}if(b){return g}}return null},findFormatId:function(d,b){var c=Kekule.IO.DataFormatsManager.findFormat(d,b);return c?c.id:null}};var a=Kekule.IO.DataFormatsManager;Kekule.IO.dataFormatsManager=Kekule.IO.DataFormatsManager;Kekule.IO.ChemDataReader=Class.create(ObjectEx,{initialize:function($super,b){$super()},CLASS_NAME:"Kekule.IO.ChemDataReader",readData:function(g,d,i,e){if(!d){var f=Kekule.IO.DataFormatsManager.getFormatInfo(i);d=f?f.dataType:null;if(!d){d=(typeof(g)==="string")?Kekule.IO.ChemDataType.TEXT:(g.getElementsByTagName?Kekule.IO.ChemDataType.DOM:Kekule.IO.ChemDataType.BINARY)}}var b=this.doReadData(g,d,i,e||{});if((b instanceof Kekule.ChemObject)&&(b.getSrcInfo)){var h=b.getSrcInfo();h.data=g;h.dataType=d;var c=Kekule.IO.DataFormatsManager.getFormatInfo(i);if(c){h.format=i;h.mimeType=c.mimeType;h.possibleFileExts=c.fileExts}}return b},doReadData:function(d,b,e,c){}});Kekule.IO.ChemDataWriter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.ChemDataWriter",initialize:function($super,b){$super()},writeData:function(f,b,e,c){if(!b){var d=Kekule.IO.DataFormatsManager.getFormatInfo(e);b=d?d.dataType:null}return this.doWriteData(f,b,e,c||{})},doWriteData:function(e,b,d,c){}});Kekule.IO.ChemDataReaderManager={_readers:[],register:function(f,d,e,b){if(!f||!d||!e||(DataType.isArrayValue(e)&&!e.length)){return}if(Kekule.IO.ChemDataReaderManager.getReaderInfoById(f)){Kekule.raise(Kekule.$L("ErrorMsg.READER_ID_ALREADY_EXISTS"));return null}var c={id:f,readerClass:d,formatId:DataType.isArrayValue(e)?e:[e]};c=Object.extend(c,b);Kekule.IO.ChemDataReaderManager._readers.push(c);return c},getAllReadableFormatIds:function(){var b=[];var e=Kekule.IO.ChemDataReaderManager._readers;for(var d=0,c=e.length;d<c;++d){var f=e[d];var g=f.formatId;Kekule.ArrayUtils.pushUnique(b,g)}return b},getAllReadableFormats:function(){var b=[];var e=Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds();for(var d=0,c=e.length;d<c;++d){var f=a.getFormatInfo(e[d]);if(f){b.push(f)}}return b},getAvailableReaderInfos:function(e){var b=[];var c=Kekule.IO.ChemDataReaderManager._readers;for(var d=c.length-1;d>=0;--d){if(Kekule.ObjUtils.match(c[d],e)){b.push(c[d])}}return b},getReaderInfo:function(d){var b=Kekule.IO.ChemDataReaderManager._readers;for(var c=b.length-1;c>=0;--c){if(Kekule.ObjUtils.match(b[c],d)){return b[c]}}return null},getReaderInfoById:function(b){return Kekule.IO.ChemDataReaderManager.getReaderInfo({id:b})},getReaderInfoByFormat:function(e,b){var c=Kekule.IO.ChemDataReaderManager._readers;for(var d=c.length-1;d>=0;--d){if((!b)||Kekule.ObjUtils.match(c[d],b)){if(c[d].formatId.indexOf(e)>=0){return c[d]}}}return null},getReaderInfoByFileExt:function(c,b){var d=Kekule.IO.DataFormatsManager.findFormatId(null,c);return d?Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(d,b):null},createReaderOfInfo:function(b){return new b.readerClass(b.createOptions)},getReaderOfInfo:function(b){if(!b.instance){b.instance=Kekule.IO.ChemDataReaderManager.createReaderOfInfo(b)}return b.instance},createReader:function(c){var b=Kekule.IO.ChemDataReaderManager.getReaderInfo(c);if(b){return Kekule.IO.ChemDataReaderManager.createReaderOfInfo(b)}},getReader:function(c){var b=Kekule.IO.ChemDataReaderManager.getReaderInfo(c);if(b){return Kekule.IO.ChemDataReaderManager.getReaderOfInfo(b)}},createReaderById:function(b){return Kekule.IO.ChemDataReaderManager.createReader({id:b})},getReaderById:function(b){return Kekule.IO.ChemDataReaderManager.getReader({id:b})},createReaderByFormat:function(d,b){var c=Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(d,b);return c?IO.ChemDataReaderManager.createReaderOfInfo(c):null},getReaderByFormat:function(d,b){var c=Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(d,b);return c?Kekule.IO.ChemDataReaderManager.getReaderOfInfo(c):null},createReaderByFileExt:function(c,b){var d=Kekule.IO.ChemDataReaderManager.getReaderInfoByFileExt(c,b);return d?Kekule.IO.ChemDataReaderManager.createReaderOfInfo(d):null},getReaderByFileExt:function(c,b){var d=Kekule.IO.ChemDataReaderManager.getReaderInfoByFileExt(c,b);return d?Kekule.IO.ChemDataReaderManager.getReaderOfInfo(d):null},createReaderByMimeType:function(c){var b=Kekule.IO.DataFormatsManager.findFormatId(c,null);return b?Kekule.IO.ChemDataReaderManager.createReaderByFormat(b):null},getReaderByMimeType:function(c){var b=Kekule.IO.DataFormatsManager.findFormatId(c,null);return b?Kekule.IO.ChemDataReaderManager.getReaderByFormat(b):null}};Kekule.IO.ChemDataWriterManager={_writers:[],register:function(g,b,c,f,d){if(!g||!b||!f||(DataType.isArrayValue(f)&&!f.length)){return}if(Kekule.IO.ChemDataWriterManager.getWriterInfoById(g)){Kekule.raise(Kekule.$L("ErrorMsg.WRITER_ID_ALREADY_EXISTS"));return null}var e={id:g,writerClass:b,srcClasses:c,formatId:DataType.isArrayValue(f)?f:[f]};e=Object.extend(e,d);Kekule.IO.ChemDataWriterManager._writers.push(e);return e},getAllWritableFormatIds:function(){var b=[];var e=Kekule.IO.ChemDataWriterManager._writers;for(var d=0,c=e.length;d<c;++d){var f=e[d];var g=f.formatId;Kekule.ArrayUtils.pushUnique(b,g)}return b},getAllWritableFormats:function(){var b=[];var e=Kekule.IO.ChemDataWriterManager.getAllWritableFormatIds();for(var d=0,c=e.length;d<c;++d){var f=a.getFormatInfo(e[d]);if(f){b.push(f)}}return b},getAvailableWriterInfos:function(l,g){var b=[];var h=ClassEx.isClass(g)?g:g.getClass?g.getClass():g?null:undefined;var c=Kekule.IO.ChemDataWriterManager._writers;for(var f=c.length-1;f>=0;--f){if(Kekule.ObjUtils.match(c[f],l)){if(h!==undefined){if(h){for(var e=0,d=c[f].srcClasses.length;e<d;++e){if(ClassEx.isOrIsDescendantOf(h,c[f].srcClasses[e])){b.push(c[f])}}}}else{b.push(c[f])}}}return b},getWriterInfo:function(g,e){var b=Kekule.IO.ChemDataWriterManager._writers;for(var f=b.length-1;f>=0;--f){if(Kekule.ObjUtils.match(b[f],g)){if(e){for(var d=0,c=b[f].srcClasses.length;d<c;++d){if(e instanceof b[f].srcClasses[d]){return b[f]}}return null}else{return b[f]}}}return null},getWriterInfoById:function(c,b){return Kekule.IO.ChemDataWriterManager.getWriterInfo({id:c},b)},getWriterInfoByFormat:function(h,b,f){var c=Kekule.IO.ChemDataWriterManager._writers;for(var g=c.length-1;g>=0;--g){if((!b)||Kekule.ObjUtils.match(c[g],b)){if(c[g].formatId.indexOf(h)>=0){if(f){for(var e=0,d=c[g].srcClasses.length;e<d;++e){if(f instanceof c[g].srcClasses[e]){return c[g]}}return null}return c[g]}}}return null},getWriterInfoByFileExt:function(d,b,c){var e=Kekule.IO.DataFormatsManager.findFormatId(null,d);return e?Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,b,c):null},createWriterOfInfo:function(b){return new b.writerClass(b.createOptions)},getWriterOfInfo:function(b){if(!b.instance){b.instance=Kekule.IO.ChemDataWriterManager.createWriterOfInfo(b)}return b.instance},createWriter:function(d,b){var c=Kekule.IO.ChemDataWriterManager.getWriterInfo(d,b);if(c){return Kekule.IO.ChemDataWriterManager.createWriterOfInfo(c)}else{return null}},getWriter:function(d,b){var c=Kekule.IO.ChemDataWriterManager.getWriterInfo(d,b);if(c){return Kekule.IO.ChemDataWriterManager.getWriterOfInfo(c)}else{return null}},createWriterById:function(c,b){return Kekule.IO.ChemDataWriterManager.createWriter({id:c},b)},getWriterById:function(c,b){return Kekule.IO.ChemDataWriterManager.getWriter({id:c},b)},createWriterByFormat:function(e,b,c){var d=Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,b,c);return d?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(d):null},getWriterByFormat:function(e,b,c){var d=Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,b,c);return d?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(d):null},createWriterByFileExt:function(d,b,c){var e=Kekule.IO.ChemDataWriterManager.getWriterInfoByFileExt(d,b,c);return e?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(e):null},getWriterByFileExt:function(d,b,c){var e=Kekule.IO.ChemDataWriterManager.getWriterInfoByFileExt(d,b,c);return e?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(e):null},createWriterByMimeType:function(d,b){var c=Kekule.IO.DataFormatsManager.findFormatId(d,null);return c?Kekule.IO.ChemDataWriterManager.createWriterByFormat(c,null,b):null},getWriterByMimeType:function(c){var b=Kekule.IO.DataFormatsManager.findFormatId(c,null);return b?Kekule.IO.ChemDataWriterManager.getWriterByFormat(b,null,srcObj):null}};Kekule.IO.loadFormatData=function(e,g,d){var c=Kekule.IO.ChemDataReaderManager.getReaderByFormat(g);if(c){var b=c.readData(e,null,g,d);if(b===false){var f=Kekule.$L("ErrorMsg.FAIL_TO_READ_FORMAT")+g;Kekule.raise(f)}return b}else{var f=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FORMAT")+g;Kekule.raise(f);return null}};Kekule.IO.loadMimeData=function(c,d,b){return Kekule.IO.loadTypedData(c,d,null,b)};Kekule.IO.loadTypedData=function(f,c,b,h){var i;if(b){i=Kekule.UrlUtils.extractFileExt(b)}var g=Kekule.IO.DataFormatsManager.findFormatId(c,c?null:i);var j;if(g){j=Kekule.IO.loadFormatData(f,g,h)}if(j!==false){if((j instanceof Kekule.ChemObject)&&(j.getSrcInfo)){var e=j.getSrcInfo();if(c){e.mimeType=c}if(i){e.fileExt=i}if(b){e.url=b;e.fileName=b}}return j}else{var d=c?(Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_MIMETYPE")+c):(Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+i);Kekule.raise(d);return null}};Kekule.IO.loadFileData=function(e,i,h,k){if(Kekule.BrowserFeature.fileapi){var f=e.name;var c=Kekule.UrlUtils.extractFileExt(f);var j;if(!h){j=Kekule.IO.DataFormatsManager.findFormat(null,c)}else{j=Kekule.IO.DataFormatsManager.getFormatInfo(h)}if(!j){var d=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+c;Kekule.raise(d);return}var b=Kekule.IO.ChemDataType.isBinaryType(j.dataType);var g=new FileReader();g.onload=function(n){var l=g.result;var p=Kekule.IO.loadFormatData(l,j.id,k);var m=p.getSrcInfo();m.fileName=f;var o=(p!==false);i(p,o)};if(b){g.readAsArrayBuffer(e)}else{g.readAsText(e)}}else{Kekule.error(Kekule.$L("ErrorMsg.FILE_API_NOT_SUPPORTED"))}};Kekule.IO.loadUrlData=function(b,e,d,c){if(Kekule.Ajax){Kekule.Ajax.sendRequest(b,function(k,f,n){if(k&&n){var l;if(d){l=Kekule.IO.DataFormatsManager.getFormatInfo(d)}if(!d){var g=Kekule.Ajax.getResponseMimeType(f);l=Kekule.IO.DataFormatsManager.findFormat(g)}if(!d){var h=Kekule.UrlUtils.extractFileExt(b);l=Kekule.IO.DataFormatsManager.findFormat(null,h)}if(!l){var j=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+h;Kekule.raise(j);return}var m=Kekule.IO.loadFormatData(k,l.id,c);var i=m.getSrcInfo();i.fileName=b;var n=(m!==false);e(m,n)}else{Kekule.raise(Kekule.$L("ErrorMsg.FAIL_TO_LOAD_FILE_URL")+b)}})}else{Kekule.raise(Kekule.$L("ErrorMsg.AJAX_FILELOADER_NOT_FOUND"));return null}};Kekule.IO.saveFormatData=function(g,f,c){var d=Kekule.IO.ChemDataWriterManager.getWriterByFormat(f,null,g);if(d){var b=d.writeData(g,null,f,c);return b}else{var e=Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")+f;Kekule.raise(e);return null}};Kekule.IO.saveMimeData=function(d,c,b){return Kekule.IO.saveTypedData(d,c,null,b)};Kekule.IO.saveTypedData=function(i,h,e,d){var c;if(e){c=Kekule.UrlUtils.extractFileExt(e);if(!c){c=e}}var g=Kekule.IO.DataFormatsManager.findFormatId(h,h?null:c);var b;if(g){b=Kekule.IO.saveFormatData(i,g,d)}if(Kekule.ObjUtils.isUnset(b)){var f=h?(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_MIMETYPE")+h):(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FILEEXT")+c);Kekule.raise(f);return null}else{return b}}})();Kekule.globalOptions.add("IO.cml",{prettyPrint:true});Kekule.IO.CML={CML2CORE_NAMESPACE_URI:"http://www.xml-cml.org/schema/cml2/core",CML3_SCHEMA_NAMESPACE_URI:"http://www.xml-cml.org/schema",ARRAY_VALUE_DELIMITER:" ",TYPED_ELEM_NAMES:["string","integer","float"],TYPED_ARRAY_ELEM_NAMES:["stringArray","integerArray","floatArray"],ATOMS_REF_ATTRIBS:["atomRef","atomRefs2","atomRefs3","atomRefs4","atomRefs","atomRefArray"],BONDS_REF_ATTRIBS:["bondRef","bondRefs","bondRefArray"]};Kekule.IO.CML.LEGAL_CORE_NAMESPACE_URIS=[Kekule.IO.CML.CML2CORE_NAMESPACE_URI,Kekule.IO.CML.CML3_SCHEMA_NAMESPACE_URI];Kekule.IO.CmlUtils={cmlBondOrderToKekule:function(b){var a=parseInt(b);if(a!==a){switch(b.toUpperCase()){case"A":a=Kekule.BondOrder.EXPLICIT_AROMATIC;break;case"D":a=Kekule.BondOrder.DOUBLE;break;case"T":a=Kekule.BondOrder.TRIPLE;break;case"S":default:a=Kekule.BondOrder.SINGLE;break}}return a},kekuleBondOrderToCml:function(a){switch(a){case Kekule.BondOrder.EXPLICIT_AROMATIC:return"A";case Kekule.BondOrder.QUAD:return"4";case Kekule.BondOrder.DOUBLE:return"D";case Kekule.BondOrder.TRIPLE:return"T";default:return"S"}},cmlBondStereoToKekule:function(b){var a;switch(b.toUpperCase()){case"E":a=Kekule.BondStereo.E;break;case"Z":a=Kekule.BondStereo.Z;break;case"C":a=Kekule.BondStereo.CIS;break;case"T":a=Kekule.BondStereo.TRANS;break;case"W":a=Kekule.BondStereo.UP;break;case"H":a=Kekule.BondStereo.DOWN;break;default:a=Kekule.BondStereo.NONE;break}return a},kekuleBondStereoToCml:function(a){switch(a){case Kekule.BondStereo.UP:return{value:"W"};case Kekule.BondStereo.UP_INVERTED:return{value:"W",invert:true};case Kekule.BondStereo.DOWN:return{value:"H"};case Kekule.BondStereo.DOWN_INVERTED:return{value:"H",invert:true};case Kekule.BondStereo.E:return{value:"E"};case Kekule.BondStereo.Z:return{value:"Z"};case Kekule.BondStereo.CIS:return{value:"C"};case Kekule.BondStereo.TRANS:return{value:"T"};default:return{value:null}}},reagentRoleToKekule:function(a){var b=Kekule.ReactionRole;switch(a){case"reagent":return b.REAGENT;case"catalyst":return b.CATALYST;case"solvent":return b.CATALYST;default:return a}},kekuleReagentRoleToCml:function(a){var b=Kekule.ReactionRole;switch(a){case b.REAGENT:return"reagent";case b.CATALYST:return"catalyst";case b.CATALYST:return"solvent";default:return a}},isDummyElementType:function(a){return((a=="Du")||(a=="Dummy"))},isRGroupElementType:function(a){return(a=="R")},isAtomListElementType:function(a){return(a=="L")},getNodeElementType:function(a){if(a instanceof Kekule.Atom){return a.getSymbol()}else{if(a instanceof Kekule.Pseudoatom){switch(a.getAtomType()){case Kekule.PseudoatomType.DUMMY:return"Du";case Kekule.PseudoatomType.ANY:return"A";case Kekule.PseudoatomType.HETERO:return"Q";case Kekule.PseudoatomType.CUSTOM:default:return a.getSymbol()}}else{if(a instanceof Kekule.VariableAtom){return"R"}else{if(a instanceof Kekule.StructureFragment){return"R"}else{if(a.getSymbol){return a.getSymbol()}else{return"*"}}}}}},createNodeByCmdElementType:function(c,b,a){if(Kekule.IO.CmlUtils.isDummyElementType(b)){result=new Kekule.Pseudoatom(c,Kekule.PseudoatomType.DUMMY)}else{if(Kekule.IO.CmlUtils.isRGroupElementType(b)){result=new Kekule.RGroup(c)}else{if(Kekule.IO.CmlUtils.isAtomListElementType(b)){result=new Kekule.VariableAtom(c)}else{if(Kekule.Element.isElementSymbolAvailable(b)||(b==Kekule.Element.UNSET_ELEMENT)){result=new Kekule.Atom(c,b,Math.round(a))}else{result=new Kekule.Pseudoatom(c,Kekule.PseudoatomType.CUSTOM,b)}}}}return result}};Kekule.IO.CmlDomUtils={splitCmlArrayValue:function(b){if((typeof(b)=="object")&&(b.length)){return b}var a=Kekule.StrUtils.normalizeSpace(Kekule.StrUtils.trim(b));return a.split(Kekule.IO.CML.ARRAY_VALUE_DELIMITER)},mergeToCmlArrayValue:function(a){return a.join(" ")},analysisCmlFormulaConciseValue:function(h){var f=Kekule.IO.CmlDomUtils.splitCmlArrayValue(h);var d=0;var c=f.length;var j=[];var g=null;var a;while(d<c){var b=f[d];var e=parseFloat(b);if(e!=e){if(g){j.push(g)}g={elementType:b}}else{if(g){g.count=e;j.push(g);g=null}else{if(d==c-1){a=e}}}++d}return{isotopes:j,formalCharge:a}},getCmlBuiltinElemInfo:function(c,b,a){var d;d=c.getAttribute("builtin");if((!d)&&b){if(c.getAttributeNS){d=c.getAttributeNS(b,"builtin")}else{if(a){d=a.getAttributeNS(b,"builtin",c)}}}if(d){var e=Kekule.DomUtils.getElementText(node);return{name:d,value:e}}else{return null}},readCmlTypedPropertyElem:function(c,b,a){var d;d=c.getAttribute("builtin");if((!d)&&b){if(c.getAttributeNS){d=c.getAttributeNS(b,"builtin")}else{if(a){d=a.getAttributeNS(b,"builtin",c)}}}if(d){var e=Kekule.DomUtils.getElementText(c);switch(Kekule.DomUtils.getLocalName(c)){case"float":e=parseFloat(e);break;case"integer":e=parseInt(e);break;default:}return{name:d,value:e}}else{return null}},readCmlTypedPropertyArrayElem:function(f,d,c){var g;g=f.getAttribute("builtin");if((!g)&&d){if(f.getAttributeNS){g=f.getAttributeNS(d,"builtin")}else{if(c){g=c.getAttributeNS(d,"builtin",f)}}}if(g){var h=Kekule.DomUtils.getElementText(node);var b=Kekule.IO.CmlDomUtils.splitCmlArrayValue(h);switch(Kekule.DomUtils.getLocalName(f)){case"float":for(var e=0,a=b.length;e<a;++e){b[e]=parseFloat(b[e])}break;case"integer":for(var e=0,a=b.length;e<a;++e){b[e]=parseInt(b[e])}break;default:}return{name:g,values:b}}else{return null}},hasDirectCmlTypedElemChildren:function(f,c){for(var e=0,a=Kekule.IO.CML.TYPED_ELEM_NAMES.length;e<a;++e){var b=Kekule.IO.CML.TYPED_ELEM_NAMES[e];var d=Kekule.DomUtils.getDirectChildElems(f,null,b,c);if(d.length>0){return true}}return false},hasDirectCmlTypedArrayElemChildren:function(f,c){for(var e=0,a=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES.length;e<a;++e){var b=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES[e];var d=Kekule.DomUtils.getDirectChildElems(f,null,b,c);if(d.length>0){return true}}return false},isCmlTypedElem:function(c,b){var a=(Kekule.IO.CML.TYPED_ELEM_NAMES.indexOf(Kekule.DomUtils.getLocalName(c))>=0);if(b){a=a&&(c.namespaceURI==b)}return a},isCmlTypedArrayElem:function(c,b){var a=(Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES.indexOf(Kekule.DomUtils.getLocalName(c))>=0);if(b){a=a&&(c.namespaceURI==b)}return a},isCmlBuiltInMarkedElem:function(c,b){var a=Kekule.DomUtils.hasAttribute(c,"builtin");if(b&&a){a=c.namespaceURI===b}return a},FILTER_TYPED_ELEM:1,FILTER_TYPEDARRAY_ELEM:2,FILTER_ALL:3,getCmlTypedElem:function(e,d,c){var f=e.namespaceURI;var a=Kekule.DomUtils.getDirectChildElemsOfAttribValues(e,[{builtin:d}],null,null,f);if(a&&(a.length>0)){for(var b=a.length-1;b>=0;--b){if((c&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM)&&Kekule.IO.CmlDomUtils.isCmlTypedElem(a[b],f)){return a[b]}else{if((c&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM)&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(a[b],f)){return a[b]}}}}return null},getCmlTypedElems:function(f,e,d){var a=[];var g=f.namespaceURI;var b=Kekule.DomUtils.getDirectChildElemsOfAttribValues(f,[{builtin:e}],null,null,g);if(b&&(b.length>0)){for(var c=b.length-1;c>=0;--c){if((d&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM)&&Kekule.IO.CmlDomUtils.isCmlTypedElem(b[c],g)){a.push(b[c])}else{if((d&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM)&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(b[c],g)){a.push(b[c])}}}}return a.length?a:null},getCmlTypedElemValue:function(d,c,b,a){if(!b){b=Kekule.IO.CmlDomUtils.FILTER_ALL}var e=Kekule.IO.CmlDomUtils.getCmlTypedElem(d,c,b);if(e){return Kekule.DomUtils.getElementText(e)}},getMultipleCmlTypedElemValues:function(h,g,f,d){if(!f){f=Kekule.IO.CmlDomUtils.FILTER_ALL}var c=Kekule.IO.CmlDomUtils.getCmlTypedElems(h,g,f);if(c){var a=[];for(var e=0,b=c.length;e<b;++e){a.push(Kekule.DomUtils.getElementText(c[e]))}return a}else{return null}},getCmlElemAttribute:function(e,d,c,b){if(!c){c=Kekule.IO.CmlDomUtils.FILTER_ALL}var a=Kekule.DomUtils.getSameNSAttributeValue(e,d,b);if((a===null)||(a===undefined)){a=Kekule.IO.CmlDomUtils.getCmlTypedElemValue(e,d,c,b)}return a},getMultipleCmlElemAttribute:function(e,d,c,b){if(!c){c=Kekule.IO.CmlDomUtils.FILTER_ALL}var a=Kekule.DomUtils.getSameNSAttributeValue(e,d,b);if((a===null)||(a===undefined)){a=Kekule.IO.CmlDomUtils.getMultipleCmlTypedElemValues(e,d,c,b)}return a},setCmlElemAttribute:function(c,b,d,a){return Kekule.DomUtils.setSameNSAttributeValue(c,b,d,a)},fetchCmlElemAttributeValuesToJson:function(d,b,k,h){if(!b){b=Kekule.IO.CmlDomUtils.FILTER_ALL}var c=d.namespaceURI;var m=Kekule.DomUtils.fetchAttributeValuesToJson(d,c,true);var j=Kekule.DomUtils.getDirectChildElems(d,null,null,c);for(var g=0,e=j.length;g<e;++g){var a=j[g];if((b&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM)&&(Kekule.IO.CmlDomUtils.isCmlTypedElem(a,c)||Kekule.IO.CmlDomUtils.isCmlBuiltInMarkedElem(a,c))){var f=Kekule.IO.CmlDomUtils.readCmlTypedPropertyElem(a,c,h);if(f){if(m[f.name]&&k){m[f.name]+=Kekule.IO.CML.ARRAY_VALUE_DELIMITER+f.value}else{m[f.name]=f.value}}}else{if((b&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM)&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(a,c)){var f=Kekule.IO.CmlDomUtils.getCmlBuiltinElemInfo(a,c,h);if(f){if(m[f.name]&&k){m[f.name]+=Kekule.IO.CML.ARRAY_VALUE_DELIMITER+f.value}else{m[f.name]=f.value}}}}}return m},isScalarElem:function(c,b){var a=(Kekule.DomUtils.getLocalName(c)=="scalar");if(b){a=a&&(c.namespaceURI==b)}return a},getCmlId:function(b,a){return Kekule.IO.CmlDomUtils.getCmlElemAttribute(b,"id",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,a)},setCmlId:function(b,c,a){return Kekule.IO.CmlDomUtils.setCmlElemAttribute(b,"id",c,a)},getCmlTitle:function(b,a){return Kekule.IO.CmlDomUtils.getCmlElemAttribute(b,"title",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,a)},setCmlTitle:function(b,c,a){return Kekule.IO.CmlDomUtils.setCmlElemAttribute(b,"title",c,a)}};Kekule.IO.CmlElementReaderFactory={_readers:{},register:function(a,d){if(Kekule.ArrayUtils.isArray(a)){for(var c=0,b=a.length;c<b;++c){Kekule.IO.CmlElementReaderFactory.register(a[c],d)}}else{Kekule.IO.CmlElementReaderFactory._readers[a]=d}},getReader:function(c){var a;if(typeof(c)!="string"){a=Kekule.DomUtils.getLocalName(c)}else{a=c}var b=Kekule.IO.CmlElementReaderFactory._readers[a];if(b){return new b()}else{return null}}};Kekule.IO.CmlElementWriterFactory={_writers:{},register:function(d,a){if(Kekule.ArrayUtils.isArray(d)){for(var c=0,b=d.length;c<b;++c){Kekule.IO.CmlElementWriterFactory.register(d[c],a)}}else{Kekule.IO.CmlElementWriterFactory._writers[d]=a}},getWriter:function(objOrTypeName){var name;if(typeof(objOrTypeName)!="string"){name=DataType.getType(objOrTypeName)}else{name=objOrTypeName}var writerClass=Kekule.IO.CmlElementWriterFactory._writers[name];if((!writerClass)&&(objOrTypeName.getClassName)){var obj=objOrTypeName;var typeNames=Kekule.ObjUtils.getOwnedFieldNames(Kekule.IO.CmlElementWriterFactory._writers);for(var i=typeNames.length-1;i>=0;--i){if(obj instanceof eval(typeNames[i])){writerClass=Kekule.IO.CmlElementWriterFactory._writers[typeNames[i]];break}}}if(writerClass){return new writerClass()}else{return null}}};Kekule.IO.CmlElementHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.CmlElementHandler",initProperties:function(){this.defineProp("domHelper",{dataType:"Kekule.DomHelper",serializable:false,getter:function(){if(!this.getPropStoreFieldValue("domHelper")){this.setPropStoreFieldValue("domHelper",new Kekule.DomHelper())}return this.getPropStoreFieldValue("domHelper")}});this.defineProp("coreNamespaceURI",{dataType:DataType.STRING,serializable:false})},matchCoreNamespace:function(a){var b;if(!a){b=""}else{if(typeof(a)!="string"){b=a.namespaceURI}else{b=a}}return((!this.getCoreNamespaceURI())&&(!b)||(this.getCoreNamespaceURI()&&(this.getCoreNamespaceURI()==b)))},copySettingsToChildHandler:function(a){a.setDomHelper(this.getDomHelper());a.setCoreNamespaceURI(this.getCoreNamespaceURI())}});Kekule.IO.CmlElementReader=Class.create(Kekule.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementReader",readElement:function(b,c){var a=this.doReadElement(b,c);if(a&&a.getId&&(!a.getId())){if(a.setId){var d=Kekule.IO.CmlDomUtils.getCmlId(b,this.getDomHelper);if(d){a.setId(d)}}}return a},doReadElement:function(a,b){},readChildElement:function(a,b){return this.doReadChildElement(a,b)},doReadChildElement:function(a,b){return this.doReadChildElementDef(a,b)},readChildElementDef:function(a,b){return this.doReadChildElementDef(a,b)},doReadChildElementDef:function(b,c){var a=Kekule.IO.CmlElementReaderFactory.getReader(b);if(a){this.copySettingsToChildHandler(a);return a.readElement(b,c)}else{return null}},iterateChildElements:function(d,e){var c=Kekule.DomUtils.getDirectChildElems(d,null,null,this.getCoreNamespaceURI());for(var b=0,a=c.length;b<a;++b){this.readChildElement(c[b],e)}}});Kekule.IO.CmlElementWriter=Class.create(Kekule.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementWriter",writeObject:function(e,b,d){if(!(b)&&(!d)){Kekule.error(Kekule.$L("ErrorMsg.CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT"));return null}if((!b)&&d){b=d.documentElement}else{if(!d){d=b.ownerDocument}}if(this.getDomHelper().getDocument!=d){this.getDomHelper().setDocument(d)}var c=this.doCreateElem(e,b,d);if(c){b.appendChild(c)}else{c=b}var a=this.doWriteObject(e,c)||c;if(a&&e){this.writeObjId(e,a);this.writeObjAdditionalInfo(e,a)}return a},writeObjId:function(b,a){if(b.getId&&b.getId()){Kekule.IO.CmlDomUtils.setCmlId(a,b.getId(),this.getDomHelper())}},writeScalarAttribs:function(e,c){if(e.getScalarAttribs){var d=Kekule.IO.CmlElementWriterFactory.getWriter("Kekule.Scalar");if(d){this.copySettingsToChildHandler(d);for(var b=0,a=e.getScalarAttribCount();b<a;++b){d.writeObject(e.getScalarAttribAt(b),c)}}}},writeObjInfoValues:function(c,a){if(c.getInfo){var j=c.getInfoKeys();var e;for(var d=0,b=j.length;d<b;++d){var g=j[d];var f=c.getInfoValue(j[d]);if(g&&f&&(!Kekule.IO.CmlDomUtils.getCmlElemAttribute(a,g,this.getDomHelper()))){if(!e){e=this.createChildElem("metaDataList",a)}var h=this.createChildElem("metaData",e);Kekule.IO.CmlDomUtils.setCmlElemAttribute(h,"name",g,this.getDomHelper());Kekule.IO.CmlDomUtils.setCmlElemAttribute(h,"content",DataType.StringUtils.serializeValue(f),this.getDomHelper())}}}},writeObjAdditionalInfo:function(b,a){this.writeScalarAttribs(b,a);this.writeObjInfoValues(b,a)},doCreateElem:function(b,a){},createChildElem:function(e,b,c){var d=c||this.getCoreNamespaceURI();var a=this.getDomHelper().createElementNS(d,e);if(b){b.appendChild(a)}return a},doWriteObject:function(b,a){},reportTypeMismatchError:function(a){Kekule.error(Kekule.$L("ErrorMsg.CML_ELEM_WRITER_TYPE_INPROPER").format(this.getClassName(),DataType.getType(a)))}});Kekule.IO.CmlNameReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlNameReader",initialize:function($super){$super()},doReadElement:function(d,e){var c=Kekule.DomUtils.getElementText(d);var b=Kekule.IO.CmlDomUtils.getCmlElemAttribute(d,"convention");if(c){var a={};a.name=c;if(b){a.convention=b}else{if(e.setName){e.setName(c)}}return a}return null}});Kekule.IO.CmlScalarReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlScalarReader",doReadElement:function(b,c){var a=this.readScalar(b);if(c&&c.appendScalarAttrib){c.appendScalarAttrib(a)}else{}return a},readScalar:function(f){var h=Kekule.DomUtils.fetchAttributeValuesToJson(f,this.getCoreNamespaceURI(),true);var g=Kekule.DomUtils.getElementText(f);if(g){h.value=g}if(h.value){if(h.dataType){switch(h.dataType){case"xsd:boolean":h.value=Kekule.StrUtils.strToBool(h.value);break;case"xsd:float":case"xsd:double":case"xsd:duration":case"xsd:decimal":case"xsd:integer":case"xsd:nonPositiveInteger":case"xsd:negativeInteger":case"xsd:long":case"xsd:int":case"xsd:short":case"xsd:byte":case"xsd:nonNegativeInteger":case"xsd:unsignedLong":case"xsd:unsignedInt":case"xsd:unsignedShort":case"xsd:unsignedByte":case"xsd:positiveInteger":h.value=parseFloat(h.value);if(h.errorValue){h.errorValue=parseFloat(h.errorValue)}break}}}var a;if(h){a=new Kekule.Scalar();var e=Kekule.ObjUtils.getOwnedFieldNames(h);for(var d=0,b=e.length;d<b;++d){var c=e[d];var g=h[c];switch(c){case"value":a.setValue(g);break;case"errorValue":a.setErrorValue(g);break;case"units":a.setUnit(g);break;case"title":a.setTitle(g);break;case"dictRef":a.setName(g);break;default:a.setInfoValue(c,g)}}}return a}});Kekule.IO.CmlScalarWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlScalarWriter",doCreateElem:function(b,a){return this.createChildElem("scalar",a)},doWriteObject:function(d,c){if(!(d instanceof Kekule.Scalar)){this.reportTypeMismatchError(d);return null}var b;if(!Kekule.ObjUtils.isUnset(d.getValue())){Kekule.DomUtils.setElementText(c,d.getValue());b=DataType.getType(d.getValue())}if(d.getName()){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"dictRef",d.getName(),this.getDomHelper())}if(d.getErrorValue()){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"errorValue",d.getErrorValue(),this.getDomHelper())}if(d.getUnit()){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"units",d.getUnit(),this.getDomHelper())}if(d.getTitle()){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"title",d.getTitle(),this.getDomHelper())}if(b){var a=(b==DataType.INT)?"xsd:integer":(b==DataType.FLOAT)?"xsd:float":(b==DataType.BOOL)?"xsd:boolean":null;if(a){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"datatype",a,this.getDomHelper())}}}});Kekule.IO.CmlMetaDataReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlMetaReader",doReadElement:function(a,b){var c=this.readMeta(a);if(b&&b.setInfoValue){if(c.key&&c.value){b.setInfoValue(c.key,c.value)}}else{}return c},readMeta:function(b){var c=Kekule.DomUtils.fetchAttributeValuesToJson(b,this.getCoreNamespaceURI(),true);var a={key:c.name,value:DataType.StringUtils.deserializeValue(c.content)};return a}});Kekule.IO.CmlMetaDataListReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlMetaListReader",doReadElement:function(e,g){var f=Kekule.DomUtils.getDirectChildElems(e,null,"metaData",this.getCoreNamespaceURI());for(var d=0,c=f.length;d<c;++d){var b=f[d];var a=Kekule.IO.CmlElementReaderFactory.getReader(b);if(a){this.copySettingsToChildHandler(a);a.readElement(b,g)}}}});Kekule.IO.CmlChemStructureReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlChemStructureReader",initialize:function($super){$super()},hasAtomChildren:function(c,a){var b=a.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",c);return b.length},getAtomChildren:function(c,a){var b=a.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",c);return b},atomInfoToJSON:function(c,b){var a;var d={};d=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(c,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,true,b);return d},arrayedAtomInfosToJSON:function(b,n){var c=["id","atomID","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"];var g=["id","id","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"];var h=[];for(var m=0,d=c.length;m<d;++m){var a;var o=[];a=Kekule.IO.CmlDomUtils.getCmlElemAttribute(b,c[m],Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,n);if(a){o=Kekule.IO.CmlDomUtils.splitCmlArrayValue(a)}for(var f=0,e=o.length;f<e;++f){if(!h[f]){h[f]={}}if(o[f]){h[f][g[m]]=o[f]}}}return h}});Kekule.IO.CmlFormulaReader=Class.create(Kekule.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlFormulaReader",doReadElement:function(a,b){return this.readFormula(a,this.getDomHelper())},readFormula:function(g,d){var b=new Kekule.MolecularFormula();var f=Kekule.IO.CmlDomUtils.getCmlElemAttribute(g,"formalCharge",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,d);if(f){b.setCharge(parseFloat(f))}var a=Kekule.IO.CmlDomUtils.getCmlElemAttribute(g,"concise",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,d);if(a){this.setConcise(b,a)}else{var h=Kekule.DomUtils.getDirectChildElems(g,null,null,this.getCoreNamespaceURI());for(var e=0,c=h.length;e<c;++e){switch(Kekule.DomUtils.getLocalName(h[e])){case"formula":this.readSubFormula(b,h[e],d);break;case"atomArray":this.readAtomArray(b,h[e],d);break;default:if(Kekule.IO.CmlDomUtils.isCmlTypedElem(node)||Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(node)){}else{this.readChildElementDef(node,b)}}}}return b},readConsice:function(b){var a=null;if(b){a=new Kekule.MolecularFormula();this.setConcise(a,b)}return a},setConcise:function(c,a){var b=Kekule.IO.CmlDomUtils.analysisCmlFormulaConciseValue(a);if(b.isotopes&&b.isotopes.length){this.createSectionsFromAtomAttribs(c,b.isotopes)}if(b.formalCharge){c.setCharge(b.formalCharge)}return c},readAtomArray:function(a,b,g){var d=[];var f=this.getAtomChildren(b,g);if(f.length>0){for(var e=0,c=f.length;e<c;++e){var j=f[e];var h=this.atomInfoToJSON(j,g);d.push(h)}}else{d=this.arrayedAtomInfosToJSON(b,g)}this.createSectionsFromAtomAttribs(a,d);return a},createSectionsFromAtomAttribs:function(h,g){for(var b=0,a=g.length;b<a;++b){var f=g[b].elementType;if(f){var e=Kekule.IO.CmlUtils.createNodeByCmdElementType(null,f);var c=(g[b].formalCharge)||0;var d=g[b].count;h.appendSection(e,d,c)}}},readSubFormula:function(d,c,a){var e=this.readElement(c,a);var b=Kekule.IO.CmlDomUtils.getCmlElemAttribute(c,"count",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,a);d.appendSection(e,parseFloat(b)||1,e.getCharge()||0)}});Kekule.IO.CmlFormulaWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlFormulaWriter",doCreateElem:function(b,a){return this.createChildElem("formula",a)},doWriteObject:function(b,f){if(!(b instanceof Kekule.MolecularFormula)){this.reportTypeMismatchError(b);return null}var e=[];var h=[];var g=[];for(var c=0,a=b.getSectionCount();c<a;++c){var j=b.getSectionAt(c);if(j.obj instanceof Kekule.MolecularFormula){this.createAtomArrayElem(e,h,g,f);e=[];h=[];g=[];var d=this.writeSubFormula(j.obj,j.count||1,f)}else{e.push(Kekule.IO.CmlUtils.getNodeElementType(j.obj));h.push(j.count||1);g.push(b.getSectionCharge(j)||0);if(c==a-1){this.createAtomArrayElem(e,h,g,f)}}}if(b.getCharge()){Kekule.IO.CmlDomUtils.setCmlElemAttribute(f,"formalCharge",b.getCharge(),this.getDomHelper())}},writeSubFormula:function(d,c,b){var a=this.createChildElem("formula",b);this.doWriteObject(d,a);if(c>1){Kekule.IO.CmlDomUtils.setCmlElemAttribute(a,"count",c,this.getDomHelper())}return a},createAtomArrayElem:function(e,h,g,f){if(e.length<=0){return}var m=this.createChildElem("atomArray",f);var b=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(e);var a=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(h);Kekule.IO.CmlDomUtils.setCmlElemAttribute(m,"elementType",b,this.getDomHelper());Kekule.IO.CmlDomUtils.setCmlElemAttribute(m,"count",a,this.getDomHelper());var j=false;for(var d=0,c=g.length;d<c;++d){if(g[d]){j=true;break}}if(j){var k=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(h);Kekule.IO.CmlDomUtils.setCmlElemAttribute(m,"formalCharge",k,this.getDomHelper())}return m}});Kekule.IO.CmlMoleculeReader=Class.create(Kekule.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlMoleculeReader",initialize:function($super){$super()},initProperties:function(){this.defineProp("structureBuilder",{dataType:"Kekule.ChemStructureBuilder",serializable:false,getter:function(){if(!this.getPropStoreFieldValue("structureBuilder")){this.setPropStoreFieldValue("structureBuilder",new Kekule.ChemStructureBuilder())}return this.getPropStoreFieldValue("structureBuilder")},setter:null})},doReadElement:function(a,b){return this.readMolecule(a,this.getDomHelper())},doReadChildElement:function($super,d,e){if((Kekule.DomUtils.getLocalName(d)=="molecule")&&(this.matchCoreNamespace(d))){if(e.getSubMolecules){var a=this.readElement(d,e);if(a){var c=Kekule.IO.CmlDomUtils.getCmlElemAttribute(d,"amount",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM)||Kekule.IO.CmlDomUtils.getCmlElemAttribute(d,"count",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM);var b=c?{amount:parseFloat(c)}:null;e.getSubMolecules().appendObj(a,b)}return a}else{return null}}else{return $super(d,e)}},hasSubMolecule:function(b){var a=Kekule.DomUtils.getDirectChildElems(b,null,"molecule",this.getCoreNamespaceURI());return(a.length>0)},readMolecule:function(c,b){var a;if(this.hasSubMolecule(c)){a=new Kekule.CompositeMolecule();this.iterateChildElements(c,a)}else{a=this.readMoleculeCore(c,b)}this.readMoleculeAttribs(a,c,b);return a},readMoleculeAttribs:function(f,c,g){var a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(c,null,true,g);var b=Kekule.ObjUtils.getOwnedFieldNames(a);for(var e=0,d=b.length;e<d;++e){var j=b[e];var h=a[j];switch(j){case"id":f.setId(h);break;case"title":f.setInfoValue("title",h);break;case"formalCharge":if(h){f.setCharge(parseFloat(h))}break;case"formula":this.readFormulaAttrib(f,h);break;case"amount":case"count":break;default:f.setInfoValue(j,h)}}},readMoleculeCore:function(f,d){var b=new Kekule.Molecule();this.getStructureBuilder().setTarget(b);var e=f.firstChild;while(e){if(e.nodeType!=Node.ELEMENT_NODE){}else{if(!this.matchCoreNamespace(e)){}else{switch(Kekule.DomUtils.getLocalName(e)){case"atomArray":this.readMoleculeAtomArray(b,e,this.getStructureBuilder(),d);break;case"bondArray":this.readMoleculeBondArray(b,e,this.getStructureBuilder(),d);break;case"formula":this.readFormula(b,e,d);break;case"atom":this.getStructureBuilder().setTarget(b);var a=this.readAtom(e,d);this.getStructureBuilder().appendNode(a);break;case"bond":this.getStructureBuilder().setTarget(b);var c=this.readBond(b,e,d);this.getStructureBuilder().appendConnector(c);break;case"molecule":break;default:if(Kekule.IO.CmlDomUtils.isCmlTypedElem(e)||Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(e)){}else{this.readChildElementDef(e,b)}}}}e=e.nextSibling}if(b.hasCtab()){this.connectUpBondAndAtom(b)}return b},connectUpBondAndAtom:function(g){var h=g.getConnectors();for(var f=0,c=h.length;f<c;++f){var o=h[f];var b=o[this._BOND_ATOM_REF_TEMP_FIELD];if(b&&b.length){for(var e=0,d=b.length;e<d;++e){var m=g.getNodeById(b[e]);if(m){o.appendConnectedObj(m)}else{Kekule.raise((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.ATOMID_NOT_EXISTS"):"Atom id not exists: ")+b[e])}}}delete o[this._BOND_ATOM_REF_TEMP_FIELD];var n=o[this._BOND_BOND_REF_TEMP_FIELD];if(n&&n.length){for(var e=0,d=n.length;e<d;++e){var a=g.getConnectorById(n[e]);if(a){o.appendConnectedObj(a)}else{Kekule.raise((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.BONDID_NOT_EXISTS"):"Bond id not exists: ")+n[e])}}}delete o[this._BOND_BOND_REF_TEMP_FIELD]}},readMoleculeAtomArray:function(f,a,j,g){j.setTarget(f);var e=this.getAtomChildren(a,g);if(e.length>0){for(var c=0,b=e.length;c<b;++c){var h=e[c];var k=this.readAtom(h,g);j.appendNode(k)}}else{var d=this.readArrayedAtoms(a,g);for(var c=0,b=d.length;c<b;++c){j.appendNode(d[c])}}},readAtom:function(f,c){var a;hasChildInfoElems=!Kekule.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(f,this.getCoreNamespaceURI());var g=this.atomInfoToJSON(f,c);a=this.createStructureNodeOfAttribs(g);if(hasChildInfoElems){var e=Kekule.DomUtils.getDirectChildElems(f,null,null,this.getCoreNamespaceURI());for(var d=0,b=e.length;d<b;++d){var f=e[d];this.readChildElementDef(f,a)}}return a},readArrayedAtoms:function(f,c){var g=this.arrayedAtomInfosToJSON(f,c);var a=[];for(var d=0,b=g.length;d<b;++d){var e=this.createStructureNodeOfAttribs(g[d]);if(e){a.push(e)}}return a},createStructureNodeOfAttribs:function(b){var i;if(!b.elementType){b.elementType=Kekule.Element.UNSET_ELEMENT}var c=null;if(b.id!==undefined){c=b.id}delete b.id;var a=b.isotope?Math.round(b.isotope):null;i=Kekule.IO.CmlUtils.createNodeByCmdElementType(c,b.elementType,a);delete b.elementType;if(b.hydrogenCount!==undefined){if(i.setExplicitHydrogenCount){i.setExplicitHydrogenCount(parseInt(b.hydrogenCount,10))}}delete b.hydrogenCount;if(b.formalCharge){i.setCharge(parseInt(b.formalCharge))}delete b.formalCharge;if(b.title){i.setInfoValue("title",b.title)}delete b.title;if(b.role){i.setInfoValue("role",b.role)}delete b.role;var f,d;if((b.x2!==undefined)&&(b.y2!==undefined)){f={x:parseFloat(b.x2),y:parseFloat(b.y2)}}else{if(b.xy2){var h=Kekule.IO.CmlDomUtils.splitCmlArrayValue(b.xy2);if(h.length==2){f={x:parseFloat(h[0]),y:parseFloat(h[1])}}}}delete b.x2;delete b.y2;delete b.xy2;if((b.x3!==undefined)&&(b.y3!==undefined)&&(b.z3!==undefined)){d={x:parseFloat(b.x3),y:parseFloat(b.y3),z:parseFloat(b.z3)}}else{if(b.xyz3){var e=Kekule.IO.CmlDomUtils.splitCmlArrayValue(b.xyz3);if(e.length==3){f={x:parseFloat(e[0]),y:parseFloat(e[1]),z:parseFloat(e[2])}}}}delete b.x3;delete b.y3;delete b.z3;delete b.xyz3;if(f){i.setCoord2D(f)}if(d){i.setCoord3D(d)}for(var g in b){if(b.hasOwnProperty(g)&&(typeof(b[g])=="string")){i.setInfoValue(g,b[g])}}return i},_BOND_ATOM_REF_TEMP_FIELD:"__cml_atomRefs",_BOND_BOND_REF_TEMP_FIELD:"__cml_bondRefs",readMoleculeBondArray:function(f,b,k,h){k.setTarget(f);var j=h.getElementsByTagNameNS(this.getCoreNamespaceURI(),"bond",b);if(j.length>0){for(var e=0,d=j.length;e<d;++e){var a=j[e];var c=this.readBond(f,a,h);k.appendConnector(c)}}else{var g=this.readArrayedBonds(f,b,h);for(var e=0,d=g.length;e<d;++e){k.appendConnector(g[e])}}},readBond:function(h,c,j){var m;var a=[];var f=false;f=!Kekule.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(c,this.getCoreNamespaceURI());a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(c,Kekule.IO.CmlUtils.FILTER_TYPED_ELEM,true,j);m=this.createStructureConnectorOfAttribs(h,a);if(f){var b=Kekule.DomUtils.getDirectChildElems(c,null,null,this.getCoreNamespaceURI());for(var e=0,d=b.length;e<d;++e){var c=b[e];if(Kekule.DomUtils.getLocalName(c)=="bondStereo"){var g=Kekule.DomUtils.getElementText(c);if(!g){g=Kekule.IO.CmlDomUtils.getCmlElemAttribute(c,"conversionValue",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,j)}var k=Kekule.IO.CmlUtils.cmlBondStereoToKekule(g);if((k!=Kekule.BondStereo.NONE)&&m.setStereo){m.setStereo(k)}}else{this.readChildElementDef(c,m)}}}return m},readArrayedBonds:function(o,b,p){var c=["id","bondID","atomRef1","atomRef2","order","bondStereo"];var m=["id","id","atomRefs2","atomRefs2","order","bondStereo"];var d=[];var h=Kekule.IO.CmlDomUtils.getMultipleCmlElemAttribute(b,"atomRefs",Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,p);if(h&&h.length){for(var n=0,e=h.length;n<e;++n){var a=h[n];var q=Kekule.IO.CmlDomUtils.splitCmlArrayValue(a);for(var g=0,f=q.length;g<f;++g){if(!d[g]){d[g]={}}if(d[g]["atomRefs"]==undefined){d[g]["atomRefs"]=[]}(d[g]["atomRefs"]).push(q[g])}}}for(var n=0,e=c.length;n<e;++n){var a;var q=[];a=Kekule.IO.CmlDomUtils.getCmlElemAttribute(b,c[n],Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,p);if(a){q=Kekule.IO.CmlDomUtils.splitCmlArrayValue(a)}for(var g=0,f=q.length;g<f;++g){if(!d[g]){d[g]={}}if(q[g]){if((c[n]=="atomRef1")||(c[n]=="atomRef2")){if(d[g]["atomRefs2"]==undefined){d[g]["atomRefs2"]=[]}if(c[n]=="atomRef1"){d[g]["atomRefs2"][0]=q[g]}else{d[g]["atomRefs2"][1]=q[g]}}else{d[g][m[n]]=q[g]}}}}var s=[];for(var n=0,e=d.length;n<e;++n){var r=this.createStructureConnectorOfAttribs(o,d[n]);if(r){s.push(r)}}return s},createStructureConnectorOfAttribs:function(g,a){var n;var b,j;if(a.id){b=a.id}delete a.id;if(a.order!==undefined){j=Kekule.IO.CmlUtils.cmlBondOrderToKekule(a.order)}delete a.order;n=new Kekule.Bond(b,null,j);if(a.bondStereo){var m=Kekule.IO.CmlUtils.cmlBondStereoToKekule(a.bondStereo);if((m!=Kekule.BondStereo.NONE)&&n.setStereo){n.setStereo(m)}}delete a.bondStereo;for(var f=0,e=Kekule.IO.CML.ATOMS_REF_ATTRIBS.length;f<e;++f){var d=Kekule.IO.CML.ATOMS_REF_ATTRIBS[f];if(a[d]!=undefined){var c=Kekule.IO.CmlDomUtils.splitCmlArrayValue(a[d]);if(c.length>0){n[this._BOND_ATOM_REF_TEMP_FIELD]=c}delete a[d];break}}for(var f=0,e=Kekule.IO.CML.BONDS_REF_ATTRIBS.length;f<e;++f){var d=Kekule.IO.CML.BONDS_REF_ATTRIBS[f];if(a[d]!=undefined){var h=Kekule.IO.CmlDomUtils.splitCmlArrayValue(a[d]);if(h.length>0){n[this._BOND_BOND_REF_TEMP_FIELD]=h}delete a[d];break}}for(var k in a){if(a.hasOwnProperty(k)&&(typeof(a[k])=="string")){n.setInfoValue(k,a[k])}}return n},readFormula:function(b,d,c){var a=Kekule.IO.CmlElementReaderFactory.getReader(d);if(a){this.copySettingsToChildHandler(a);var e=a.readElement(d,b);if(e){b.setFormula(e)}}},readFormulaAttrib:function(c,b){var a=Kekule.IO.CmlElementReaderFactory.getReader("formula");if(a){var d=a.readConsice?a.readConsice(b):null;if(d){c.setFormula(d)}}}});Kekule.IO.CmlMoleculeWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlMoleculeWriter",initProperties:function(){this.defineProp("allowCascadeGroup",{dataType:DataType.BOOL})},doCreateElem:function(b,a){return this.createChildElem("molecule",a)},doWriteObject:function(b,a){return this.writeMolecule(b,a)},writeMolecule:function(b,c){var a;this.writeMoleculeAttribs(b,c);if(b instanceof Kekule.CompositeMolecule){a=this.writeCompositeMolecule(b,c)}else{a=this.writeMoleculeCore(b,c)}return a},writeMoleculeAttribs:function(a,g){var h=[];if(a.getCharge()){h.push({key:"formalCharge",value:a.getCharge()})}var e=["title","dictRef","chirality","ref","spinMultiplicity","symmetryOriented","role"];for(var d=0,b=e.length;d<b;++d){var c=e[d];var f=a.getInfoValue(c);if(!Kekule.ObjUtils.isUnset(f)){h.push({key:c,value:a.getInfoValue(c)})}}for(var d=0,b=h.length;d<b;++d){Kekule.IO.CmlDomUtils.setCmlElemAttribute(g,h[d].key,h[d].value,this.getDomHelper())}},writeCompositeMolecule:function(c,e){var h=c.getSubMolecules();for(var d=0,b=h.getItemCount();d<b;++d){var g=h.getItemAt(d);var a=g.obj;var f=this.writeObject(a,e);if(g.amount){Kekule.IO.CmlDomUtils.setCmlElemAttribute(f,"amount",g.amount,this.getDomHelper())}}return e},writeMoleculeCore:function(a,b){if(a.hasFormula()){var d=a.getFormula();var c=Kekule.IO.CmlElementWriterFactory.getWriter(d);this.copySettingsToChildHandler(c);c.writeObject(d,b)}if(a.hasCtab()){this.writeCtab(a.getCtab(),a,b)}},writeCtab:function(f,j,c){this.identifyObjsInCtab(f,j);var a=this.getAllowCascadeGroup()?f.getNodes():f.getLeafNodes();if(a.length>0){var d=this.createChildElem("atomArray",c);for(var h=0,e=a.length;h<e;++h){this.writeCtabNode(a[h],d)}}var b=this.getAllowCascadeGroup()?f.getConnectors():f.getAllChildConnectors();if(b.length>0){var g=this.createChildElem("bondArray",c);for(var h=0,e=b.length;h<e;++h){this.writeCtabConnector(b[h],g)}}},writeCtabNode:function(b,c){var s=this.createChildElem("atom",c);this.writeObjId(b,s);var m=Kekule.IO.CmlUtils.getNodeElementType(b);Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"elementType",m,this.getDomHelper());var a=b.getMassNumber?b.getMassNumber():null;if(a){Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"isotope",a,this.getDomHelper())}var j=b.getExplicitHydrogenCount?b.getExplicitHydrogenCount():null;if(!Kekule.ObjUtils.isUnset(j)){Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"hydrogenCount",j,this.getDomHelper())}var k=b.getCharge?b.getCharge():null;if(k){Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"formalCharge",k,this.getDomHelper())}var e=b.getParity?b.getParity():null;if(e){}var o=b.getInfoValue?b.getInfoValue("title"):null;if(o){Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"title",o,this.getDomHelper())}var h=b.getInfoValue?b.getInfoValue("role"):null;if(h){Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"role",h,this.getDomHelper())}if(b.hasCoord2D&&b.hasCoord2D()){var n=b.getAbsCoord2D();Kekule.ObjUtils.isUnset(n.x)?null:Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"x2",n.x,this.getDomHelper());Kekule.ObjUtils.isUnset(n.y)?null:Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"y2",n.y,this.getDomHelper())}if(b.hasCoord3D&&b.hasCoord3D()){var g=b.getAbsCoord3D();Kekule.ObjUtils.isUnset(g.x)?null:Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"x3",g.x,this.getDomHelper());Kekule.ObjUtils.isUnset(g.y)?null:Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"y3",g.y,this.getDomHelper());Kekule.ObjUtils.isUnset(g.z)?null:Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"z3",g.z,this.getDomHelper())}var r=["occupancy","xFract","xyzFract","yFract","convention","dictRef","ref"];for(var f=0,d=r.length;f<d;++f){var q=r[f];var p=b.getInfoValue(q);if(p){Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,q,p,this.getDomHelper())}}this.writeObjAdditionalInfo(b,s);return s},writeCtabConnector:function(a,u){var o=false;var g=this.createChildElem("bond",u);this.writeObjId(a,g);var p=a.getBondOrder?a.getBondOrder():null;if(p){var k=Kekule.IO.CmlUtils.kekuleBondOrderToCml(p);if(k){Kekule.IO.CmlDomUtils.setCmlElemAttribute(g,"order",k,this.getDomHelper())}}var s=a.getStereo?a.getStereo():null;if(s){var e=Kekule.IO.CmlUtils.kekuleBondStereoToCml(s);if(e.value){var t=this.createChildElem("bondStereo",g);Kekule.DomUtils.setElementText(t,e.value);if(e.invert){o=true}}}var f=[];var d=[];for(var q=0,n=a.getConnectedObjCount();q<n;++q){var h=a.getConnectedObjAt(q);if(h.getId&&h.getId()){var j=h.getId();if(h instanceof Kekule.ChemStructureNode){if(o){f.unshift(j)}else{f.push(j)}}else{if(h instanceof Kekule.ChemStructureConnector){d.push(j)}}}}var c=f.length;if(c){var b=(c==1)?"atomRefs":((c>=2)&&(c<=4))?"atomRefs"+c:"atomRefs";Kekule.IO.CmlDomUtils.setCmlElemAttribute(g,b,Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(f),this.getDomHelper())}var c=d.length;if(c){var b="bondRefs";Kekule.IO.CmlDomUtils.setCmlElemAttribute(g,b,Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(d),this.getDomHelper())}var r=["convention","dictRef","ref"];for(var q=0,n=r.length;q<n;++q){var v=r[q];var m=a.getInfoValue(v);if(m){Kekule.IO.CmlDomUtils.setCmlElemAttribute(g,v,m,this.getDomHelper())}}this.writeObjAdditionalInfo(a,g);return g},identifyObjsInCtab:function(e,a){for(var d=0,c=e.getNodeCount();d<c;++d){var f=e.getNodeAt(d);if(!f.getId()){this.autoIdentifyForObj(f,a)}if(e.isSubFragment(f)&&f.hasCtab&&f.hasCtab()){this.identifyObjsInCtab(f.getCtab(),a)}}for(var d=0,c=e.getConnectorCount();d<c;++d){var b=e.getConnectorAt(d);if(!b.getId()){this.autoIdentifyForObj(b,a)}}},autoIdentifyForObj:function(b,a){if(!b.getId()){if(b.getOwner&&b.getOwner()&&b.getOwner().getAutoId){b.setId(b.getOwner().getAutoId(b))}else{b.setId(this.getAutoIdForObj(b,a))}}},getAutoIdForObj:function(e,a){var d=e.getAutoIdPrefix?e.getAutoIdPrefix():"obj";if(!Kekule.IO.CmlMoleculeWriter._UID_SEED){Kekule.IO.CmlMoleculeWriter._UID_SEED=(new Date()).getTime()}++Kekule.IO.CmlMoleculeWriter._UID_SEED;var b=Kekule.IO.CmlMoleculeWriter._UID_SEED.toString();var c=""+d+b;return c}});Kekule.IO.CmlMoleculeWriter._UID_SEED=null;Kekule.IO.CmlReactionReagentReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReagentReader",doReadElement:function(a,b){return this.readReagent(a,this.getDomHelper())},readReagent:function(e,d){var f=null;var g=Kekule.DomUtils.getDirectChildElems(e,null,"molecule",this.getCoreNamespaceURI());if(g&&g.length){var c=g[g.length-1];var b=Kekule.IO.CmlElementReaderFactory.getReader(c);this.copySettingsToChildHandler(b);var a=b.readElement(c,null);if(a){f={};Kekule.RoleMapUtils.setItem(f,a);this.readReagentAttribs(f,e,d)}}else{}return f},readReagentAttribs:function(b,c,f){var a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(c,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,true,f);var j=Kekule.ObjUtils.getOwnedFieldNames(a);for(var e=0,d=j.length;e<d;++e){var h=j[e];var g=a[h];switch(h){case"role":b.role=Kekule.IO.CmlUtils.reagentRoleToKekule(g);break;case"amount":case"count":b.amount=parseFloat(g);break;default:b[h]=g}}return b}});Kekule.IO.CmlReactionReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReader",doReadElement:function(a,b){return this.readReaction(a,this.getDomHelper())},readReaction:function(d,g){var k=new Kekule.Reaction();var c=Kekule.DomUtils.getDirectChildElems(d,null,null,this.getCoreNamespaceURI());for(var f=0,e=c.length;f<e;++f){if(this.isComponentListElem(c[f])){this.readComponentList(k,c[f],g)}else{this.readChildElement(c[f],k)}}var a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(d,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,null,this.getDomHelper());var b=Kekule.ObjUtils.getOwnedFieldNames(a);for(var f=0,e=b.length;f<e;++f){var j=b[f];var h=a[j];switch(j){case"name":k.setName(h);break;case"title":k.setTitle(h);break;case"type":k.setReactionType(h);break;case"yield":k.setYield(parseFloat(h));break;default:k.setInfoValue(j,h)}}return k},readComponentList:function(f,b,g){var e=this.getListElemComponentName(b);var j=f.getComponentArray(e,true);if(j){var a=Kekule.DomUtils.getDirectChildElems(b,null,null,this.getCoreNamespaceURI());for(var d=0,c=a.length;d<c;++d){var h=this.readChildElement(a[d],j);if(h){if((e==Kekule.ReactionComponent.CONDITION)&&(h instanceof ObjectEx)){f.appendItem(e,h)}else{f.appendMap(e,h)}}}}},isComponentListElem:function(a){return["reactantList","productList","substanceList","conditionList"].indexOf(Kekule.DomUtils.getLocalName(a))>=0},getListElemComponentName:function(a){switch(Kekule.DomUtils.getLocalName(a)){case"reactantList":return Kekule.ReactionComponent.REACTANT;case"productList":return Kekule.ReactionComponent.PRODUCT;case"conditionList":return Kekule.ReactionComponent.CONDITION;default:return Kekule.ReactionComponent.SUBSTANCE}}});Kekule.IO.CmlReactionWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlReactionWriter",doCreateElem:function(b,a){return this.createChildElem("reaction",a)},doWriteObject:function(b,a){return this.writeReaction(b,a)},writeReaction:function(c,d){var e=[Kekule.ReactionComponent.REACTANT,Kekule.ReactionComponent.PRODUCT,Kekule.ReactionComponent.SUBSTANCE,Kekule.ReactionComponent.CONDITION];for(var b=0,a=e.length;b<a;++b){this.writeCompList(c,e[b],d)}this.writeReactionAttribs(c,d);return d},writeReactionAttribs:function(d,e){var f=[];d.getName()?f.push({key:"name",value:d.getName()}):null;d.getTitle()?f.push({key:"title",value:d.getTitle()}):null;d.getReactionType()?f.push({key:"type",value:d.getReactionType()}):null;d.getYield()?f.push({key:"yield",value:d.getYield()}):null;var c=["dictRef","convention","format","ref","role","type","state","yield","atomMap","electronMap"];for(var b=0,a=c.length;b<a;++b){if(!Kekule.ObjUtils.isUnset(d.getInfoValue(c[b]))){f.push({key:c[b],value:d.getInfoValue(c[b])})}}for(var b=0,a=f.length;b<a;++b){Kekule.IO.CmlDomUtils.setCmlElemAttribute(e,f[b].key,f[b].value,this.getDomHelper())}},writeCompList:function(m,j,k){if(m.getComponentItemCount(j)<=0){return null}else{var a=this.getReactionComponentCmlName(j);var f=this.createChildElem(a+"List",k);for(var h=0,e=m.getComponentItemCount(j);h<e;++h){var b=m.getMapAt(j,h);var g=m.getMapItemAt(j,h);if(b&&g){var c;if(j!=Kekule.ReactionComponent.CONDITION){c=this.createChildElem(a,f);if(!Kekule.ObjUtils.isUnset(b.amount)){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"amount",b.amount,this.getDomHelper())}if(b.role){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"role",Kekule.IO.CmlUtils.kekuleReagentRoleToCml(b.role),this.getDomHelper())}}else{c=f}var d=Kekule.IO.CmlElementWriterFactory.getWriter(g);if(d){this.copySettingsToChildHandler(d);d.writeObject(g,c)}}}}},getReactionComponentCmlName:function(a){switch(a){case Kekule.ReactionComponent.REACTANT:return"reactant";case Kekule.ReactionComponent.PRODUCT:return"product";case Kekule.ReactionComponent.CONDITION:return"condition";default:return"substance"}}});Kekule.IO.CmlListReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlListReader",doReadElement:function(b,c){var a=this.createList(b);a=this.readList(a,b,this.getDomHelper());return a},createList:function(a){switch(Kekule.DomUtils.getLocalName(a)){case"moleculeList":return new Kekule.MoleculeList();break;case"reactionList":return new Kekule.ReactionList();break;default:return new Kekule.ChemObjList()}},readList:function(h,c,j){var b=Kekule.DomUtils.getDirectChildElems(c,null,null,this.getCoreNamespaceURI());if(b){for(var f=0,d=b.length;f<d;++f){var a=b[f];var g=Kekule.IO.CmlElementReaderFactory.getReader(a);if(g){this.copySettingsToChildHandler(g);var e=g.readElement(a,null);if(e){h.append(e)}}}}return h}});Kekule.IO.CmlListWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlListWriter",doCreateElem:function(c,a){var b;switch(DataType.getType(c)){case"Kekule.MoleculeList":b="moleculeList";break;case"Kekule.ReactionList":b="reactionList";break;default:b="list"}return this.createChildElem(b,a)},doWriteObject:function(c,b){var a=Kekule.ChemStructureUtils.getChildStructureObjs(c,false);return this.writeList(a,b)},writeList:function(f,d){for(var b=0,a=f.length;b<a;++b){var c=f[b];if(c){var e=Kekule.IO.CmlElementWriterFactory.getWriter(c);if(e){this.copySettingsToChildHandler(e);e.writeObject(c,d)}}}return d}});Kekule.IO.CmlRootReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlRootReader",doReadElement:function(e,f){this.analysisElem(e);var a;if(Kekule.DomUtils.getLocalName(e)!="cml"){a=this.getReader(e)}if(a){return a.readElement(e,null)}else{var d=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI());if(d){for(var c=0,b=d.length;c<b;++c){a=this.getReader(d[c]);if(a){return a.readElement(d[c],null);break}}}}return null},getReader:function(b){var a=Kekule.IO.CmlElementReaderFactory.getReader(b);if(a){this.copySettingsToChildHandler(a);return a}return null},analysisElem:function(c){var d=this.getDomHelper();d.setForceAnalysisDoc(true);this.getDomHelper().setRootElement(c);var g=d.getNamespaces();var a=null;for(var e=0,b=g.length;e<b;++e){var f=g[e].namespaceURI;if(Kekule.IO.CML.LEGAL_CORE_NAMESPACE_URIS.indexOf(f)>=0){a=f;break}}this.setCoreNamespaceURI(a||null)}});Kekule.IO.CmlRootWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlRootWriter",getWriter:function(b){var a=Kekule.IO.CmlElementWriterFactory.getWriter(b);if(a){this.copySettingsToChildHandler(a);return a}return null},writeObject:function(e,a,d){var b=this.getDomHelper();b.setForceAnalysisDoc(true);this.getDomHelper().setRootElement(a);var f;if(e instanceof Kekule.ChemSpace){f=e.getRoot()}else{f=e}var c=this.getWriter(f);if(c){return c.writeObject(f,a)}else{return null}}});Kekule.IO.CmlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.CmlReader",doReadData:function(d,c,f){var b;if(c!=Kekule.IO.ChemDataType.DOM){var e=XmlUtility.parse(d);b=e.documentElement}else{if(d.documentElement){b=d.documentElement}else{b=d}}var a=Kekule.IO.CmlElementReaderFactory.getReader("cml");return a.readElement(b,null)}});Kekule.IO.CmlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.CmlWriter",initialize:function($super,a){$super(a);var b=a||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(b.prettyPrint)?Kekule.globalOptions.IO.cml.prettyPrint:b.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:true})},doWriteData:function(f,b,e){var g=Kekule.IO.CML.CML3_SCHEMA_NAMESPACE_URI;var d=XmlUtility.newDocument("cml",g);var c=Kekule.IO.CmlElementWriterFactory.getWriter("Kekule.ChemDocument");if(c){c.setCoreNamespaceURI(g);var a=c.writeObject(f,d.documentElement);if(b==Kekule.IO.ChemDataType.TEXT){a=XmlUtility.serializeNode(d.documentElement,{prettyPrint:this.getPrettyPrint()})}return a}else{Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_OUTPUT_AS_CML").format(DataType.getType(f)));return null}}});(function(){Kekule.IO.MimeType.CML="chemical/x-cml";var c=Kekule.IO.CmlElementReaderFactory;c.register("name",Kekule.IO.CmlNameReader);c.register("scalar",Kekule.IO.CmlScalarReader);c.register("metaData",Kekule.IO.CmlMetaDataReader);c.register("metaDataList",Kekule.IO.CmlMetaDataListReader);c.register("formula",Kekule.IO.CmlFormulaReader);c.register("molecule",Kekule.IO.CmlMoleculeReader);c.register(["reactant","product","substance"],Kekule.IO.CmlReactionReagentReader);c.register("reaction",Kekule.IO.CmlReactionReader);c.register(["list","moleculeList","reactionList"],Kekule.IO.CmlListReader);c.register("cml",Kekule.IO.CmlRootReader);var b=Kekule.IO.CmlElementWriterFactory;b.register("Kekule.Scalar",Kekule.IO.CmlScalarWriter);b.register("Kekule.MolecularFormula",Kekule.IO.CmlFormulaWriter);b.register(["Kekule.ChemStructureFragment","Kekule.Molecule","Kekule.CompositeMolecule"],Kekule.IO.CmlMoleculeWriter);b.register("Kekule.Reaction",Kekule.IO.CmlReactionWriter);b.register(["Kekule.ChemObjList","Kekule.ChemStructureObjectGroup","Kekule.ChemSpaceElement","Kekule.ChemSpace"],Kekule.IO.CmlListWriter);b.register("Kekule.ChemDocument",Kekule.IO.CmlRootWriter);Kekule.IO.DataFormatsManager.register("cml",Kekule.IO.MimeType.CML,"cml",Kekule.IO.ChemDataType.TEXT,"Chemical Markup Language");var a=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.CML);Kekule.IO.ChemDataReaderManager.register("cml",Kekule.IO.CmlReader,[a]);Kekule.IO.ChemDataWriterManager.register("cml",Kekule.IO.CmlWriter,[Kekule.Scalar,Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemSpace],[a])})();Kekule.IO.MdlVersion={V2000:2,V3000:3};Kekule.IO.MDL={VER2000:"V2000",VER3000:"V3000",SYMBOL_ANYATOM:"A",SYMBOL_STARATOM:"*",SYMBOL_HETEROATOM:"Q",SYMBOL_RGROUP:"R",SYMBOL_RGROUP2:"R#",SYMBOL_LONEPAIR:"LP",SYMBOL_ATOMLIST:"L",SYMBOL_DUMMYATOM:"Du",SD_DATA_HEAD_PREFIX:">",MOL_DELIMITER:"$$$$"};Kekule.IO.MdlUtils={isUnspecifiedAtomSymbol:function(a){return((a===Kekule.IO.MDL.SYMBOL_ANYATOM)||(a===Kekule.IO.MDL.SYMBOL_STARATOM))},isHeteroAtomSymbol:function(a){return(a===Kekule.IO.MDL.SYMBOL_HETEROATOM)},isRGroupSymbol:function(a){return(a===Kekule.IO.MDL.SYMBOL_RGROUP)||((a===Kekule.IO.MDL.SYMBOL_RGROUP2))},isLonePairSymbol:function(a){return(a===Kekule.IO.MDL.SYMBOL_LONEPAIR)},isAtomListSymbol:function(a){return(a===Kekule.IO.MDL.SYMBOL_ATOMLIST)},analysisMdlDateTimeStr:function(h,b){var c=new Date();var f=0,a=2;var g=(parseInt(h.substr(f,a).trim(),10)||1)-1;f+=a;var j=parseInt(h.substr(f,a).trim(),10)||0;f+=a;a=b?4:2;var i=parseInt(h.substr(f,a),10)||0;if(!b){if(i>=70){i+=1900}else{i+=2000}}c.setFullYear(i,g,j);f+=a;a=2;var e=parseInt(h.substr(f,a),10)||0;f+=a;var d=parseInt(h.substr(f,a),10)||0;c.setHours(e,d);return c},generateMdlDateTimeStr:function(b,a){var c="";c+=b.getMonth().toString().lpad(2,"0");c+=b.getDate().toString().lpad(2,"0");if(a){c+=b.getFullYear().toString().lpad(4,"0")}else{c+=(b.getFullYear()%100).toString().lpad(2,"0")}c+=b.getHours().toString().lpad(2,"0");c+=b.getMinutes().toString().lpad(2,"0");return c},mdlRadicalToKekule:function(a){return a},kekuleRadicalToMdl:function(a){return a},bondTypeToKekuleOrder:function(a){switch(a){case 1:return Kekule.BondOrder.SINGLE;break;case 2:return Kekule.BondOrder.DOUBLE;break;case 3:return Kekule.BondOrder.TRIPLE;break;case 4:return Kekule.BondOrder.EXPLICIT_AROMATIC;break;default:return Kekule.BondOrder.UNSET}},kekuleBondOrderToMdlType:function(a){switch(a){case Kekule.BondOrder.SINGLE:return 1;break;case Kekule.BondOrder.DOUBLE:return 2;break;case Kekule.BondOrder.TRIPLE:return 3;break;case Kekule.BondOrder.EXPLICIT_AROMATIC:return 4;break;default:return 1}},getRxnMarkVersion:function(a){var b=a.substr(0,4);if(b!="$RXN"){return null}else{b=a.substr(4).trim();return(b==Kekule.IO.MDL.VER3000)?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000}},assertIlegalForCtabOutput:function(a){if(!(a instanceof Kekule.StructureFragment)){Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_WRITE_NON_MOLECULE_TO_MOL"));return false}else{if(!a.hasCtab()){Kekule.error(Kekule.$L("ErrorMsg.MOLECULE_HAS_NO_CTAB_TO_OUTPUT"));return false}else{return true}}}};Kekule.IO.MdlStructureUtils={fillFragment:function(m,q,d){m.clear();if(q){var r;if(d&&(d!=Kekule.CoordMode.UNKNOWN)){r=d==Kekule.CoordMode.COORD3D}else{r=q.atomInfos.isCoord3D}if(q.atomInfos){for(var f=0,b=q.atomInfos.length;f<b;++f){var a=q.atomInfos[f];if(a){var h=Kekule.IO.MdlStructureUtils.createStructureNode(m,a,r);if(h){m.appendNode(h)}else{Kekule.raise(Kekule.$L("ErrorMsg.MDL_CTAB_ATOM_CANNOT_CREATE"))}}}}if(q.bondInfos){for(var f=0,b=q.bondInfos.length;f<b;++f){var a=q.bondInfos[f];if(a){var s=Kekule.IO.MdlStructureUtils.createStructureConnector(m,a);if(s){m.appendConnector(s)}else{Kekule.raise(Kekule.$L("ErrorMsg.MDL_CTAB_BOND_CANNOT_CREATE"))}}}}if(q.sgInfos&&q.sgInfos.length){var o=[];for(var f=0,b=q.sgInfos.length;f<b;++f){var a=q.sgInfos[f];if(a&&(a.sgType=="SUP")){var g=[];for(var e=0,c=a.atomIndexes.length;e<c;++e){g.push(m.getNodeAt(a.atomIndexes[e]))}if(g.length){o.push({atoms:g,text:a.label})}}}for(var f=0,b=o.length;f<b;++f){var g=o[f].atoms;if(g.length){var n=m.marshalSubFragment(g,new Kekule.SubGroup());var p=o[f].text;if(n.setFormulaText&&p.match(/.+\d/)){n.setFormulaText(o[f].text)}else{n.setAbbr(o[f].text)}}}}}return m},createStructureNode:function(g,h,i){var j;if(h.atomListInfo||Kekule.IO.MdlUtils.isAtomListSymbol(h.symbol)){j=new Kekule.VariableAtom();var f=[];if(h.atomListInfo&&h.atomListInfo.symbols){f=f.concat(h.atomListInfo.symbols);if(h.atomListInfo.isAllowList){j.setAllowedIsotopeIds(f)}else{j.setDisallowedIsotopeIds(f)}}}else{if(Kekule.IO.MdlUtils.isRGroupSymbol(h.symbol)){j=new Kekule.RGroup()}else{if(Kekule.IO.MdlUtils.isHeteroAtomSymbol(h.symbol)){j=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.HETERO)}else{if(Kekule.IO.MdlUtils.isUnspecifiedAtomSymbol(h.symbol)){j=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY)}else{var e=Kekule.ChemicalElementsDataUtil.getElementInfo(h.symbol);if(e){var b=null;if(h.massNumber){b=h.massNumber}else{if(h.massDiff){if(e){var d=e.naturalMass;var b=Math.round(d+h.massDiff);var c=Kekule.IsotopesDataUtil.getIsotopeInfo(e.atomicNumber,b);if(!c){b=Math.floor(d+h.massDiff);c=Kekule.IsotopesDataUtil.getIsotopeInfo(e.atomicNumber,b)}if(!c){b=Math.ceil(d+h.massDiff);c=Kekule.IsotopesDataUtil.getIsotopeInfo(e.atomicNumber,b)}if(!c){b=null}}}}j=new Kekule.Atom(null,h.symbol,b)}else{var a=Kekule.IsotopesDataUtil.getIsotopeInfo(h.symbol);if(a){j=new Kekule.Atom(null,a.atomicNumber,a.massNumber)}else{j=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY)}}}}}}if(h.charge){j.setCharge(h.charge)}if(h.radical){j.setRadical(h.radical)}if(h.parity&&j.setParity){j.setParity(h.parity)}if(typeof(h.hydrongenCount)!="undefined"){if(j.setExplicitHydrogenCount){j.setExplicitHydrogenCount(h.hydrongenCount)}}if(i){j.setCoord3D({x:h.x,y:h.y,z:h.z})}else{j.setCoord2D({x:h.x,y:h.y})}return j},createStructureConnector:function(h,a){var d=h.getNodeAt(a.atomIndex1);var c=h.getNodeAt(a.atomIndex2);if(d&&c){var f=[d,c];if(a.endAtomIndexes){for(var e=0,b=a.endAtomIndexes.length;e<b;++e){var g=h.getNodeAt(a.endAtomIndexes[e]);if(g){f.push(g)}}}var j=new Kekule.Bond(null,f,a.order);if(typeof(a.stereo)!="undefined"){j.setStereo(a.stereo)}return j}else{return null}},isNodeVariableAtom:function(a){return a instanceof Kekule.VariableAtom},getAtomTypeStr:function(d,h){if(d instanceof Kekule.Atom){return d.getSymbol()}else{if(d instanceof Kekule.Pseudoatom){switch(d.getAtomType()){case Kekule.PseudoatomType.ANY:return Kekule.IO.MDL.SYMBOL_ANYATOM;case Kekule.PseudoatomType.HETERO:return Kekule.IO.MDL.SYMBOL_HETEROATOM;default:return Kekule.IO.MDL.SYMBOL_DUMMYATOM}}else{if(d instanceof Kekule.RGroup){return Kekule.IO.MDL.SYMBOL_RGROUP}else{if(d instanceof Kekule.VariableAtom){if(h){return Kekule.IO.MDL.SYMBOL_ATOMLIST}else{var j="[";var a=d.getAllowedIsotopeIds();if(a&&a.length){}else{j="NOT[";a=d.getDisallowedIsotopeIds()}if(a&&a.length){var b=[];for(var f=0,e=a.length;f<e;++f){var g=Kekule.IsotopesDataUtil.getIsotopeIdDetail(a[f]);if(g&&g.symbol){b.push(g.symbol)}}var c=b.join(",");j=j+c+"]";return j}else{return Kekule.IO.MDL.SYMBOL_ATOMLIST}}}else{return"?"}}}}},getMoleculeCtabStructureInfo:function(f){var a={};a.atoms=f.getLeafNodes();a.bonds=f.getAllChildConnectors();a.subGroups=f.getSubFragments();var c=0,d=0;for(var e=0,b=a.atoms.length;e<b;++e){if(a.atoms[e].hasCoord3D()){++d}if(a.atoms[e].hasCoord2D()){++c}}a.coordMode=(c>d)?Kekule.CoordMode.COORD2D:Kekule.CoordMode.COORD3D;return a},splitConnectedNodes:function(c){var a={primaryNodes:[]};var e=0;var f=c.getConnectedObjs();for(var d=0,b=f.length;d<b;++d){if(f[d] instanceof Kekule.ChemStructureNode){if(e<2){a.primaryNodes.push(f[d]);++e}else{if(!a.remainNodes){a.remainNodes=[]}a.remainNodes.push(f[d])}}}return a},generateClassicStyleCountLine:function(d,a){if(a==Kekule.IO.MdlVersion.V3000){return"  0  0  0     0  0              0 V3000"}else{var c="";c+=d.atoms.length.toString().lpad(3);c+=d.bonds.length.toString().lpad(3);c+="0".lpad(3);c+="0".lpad(3);c+="0".lpad(3);c+="0".lpad(3);for(var b=0;b<4;++b){c+="0".lpad(3)}c+="999";c+=Kekule.IO.MDL.VER2000.lpad(6);return c}}};Kekule.IO.MdlBlockHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.MdlBlockHandler",initProperties:function(){this.defineProp("textBuffer",{dataType:"Kekule.TextLinesBuffer",serializable:false,getter:function(){var a=this.getPropStoreFieldValue("textBuffer");if(!a){a=this.createTextBuffer();this.setPropStoreFieldValue("textBuffer",a)}return a},setter:null})},createTextBuffer:function(){return new Kekule.TextLinesBuffer()}});Kekule.IO.MdlBlockReader=Class.create(Kekule.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockReader",readBlock:function(a,b){if(typeof(a)=="string"){this.getTextBuffer().setText(a)}else{this.getTextBuffer().setLines(a)}this.getTextBuffer().reset();return this.doReadBlock(this.getTextBuffer())},doReadBlock:function(b,a){}});Kekule.IO.MdlBlockWriter=Class.create(Kekule.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockWriter",writeBlock:function(a){this.getTextBuffer().clear();this.doWriteBlock(a,this.getTextBuffer());return this.getTextBuffer().getText()},doWriteBlock:function(a,b){}});Kekule.IO.Mdl2kUtils={atomLineChargeToKekule:function(a){switch(a){case 1:return 3;break;case 2:return 2;break;case 3:return 1;break;case 5:return -1;break;case 6:return -2;break;case 7:return -3;break;default:return 0}},chargeToMdlAtomLineValue:function(a){switch(a){case 1:return 3;break;case 2:return 2;break;case 3:return 1;break;case -1:return 5;break;case -2:return 6;break;case -3:return 7;break;default:return 0}},atomLineChargeToRadical:function(a){if(a==4){return Kekule.RadicalOrder.DOUBLET}else{return 0}},radicalToMdlAtomLineValue:function(a){return(a==Kekule.RadicalOrder.DOUBLET)?4:0},chargeOrRadicalToMdlAtomLineValue:function(b,a){if(b){return Kekule.IO.Mdl2kUtils.chargeToMdlAtomLineValue(b)}else{if(a){return Kekule.IO.Mdl2kUtils.radicalToMdlAtomLineValue(b)}else{return 0}}},bondStereoToKekule:function(b,a){if(a==Kekule.BondOrder.SINGLE){switch(b){case 1:return Kekule.BondStereo.UP;break;case 4:return Kekule.BondStereo.UP_OR_DOWN;break;case 6:return Kekule.BondStereo.DOWN;break;default:return Kekule.BondStereo.NONE}}else{if(a==Kekule.BondOrder.DOUBLE){switch(b){case 3:return Kekule.BondStereo.E_Z_BY_COORDINATES;break;default:return Kekule.BondStereo.NONE}}else{return Kekule.BondStereo.NONE}}},bondStereoToMdlBondLineValue:function(b,a){if(a==Kekule.BondOrder.SINGLE){switch(b){case Kekule.BondStereo.UP:return 1;case Kekule.BondStereo.UP_OR_DOWN:return 4;case Kekule.BondStereo.DOWN:return 6;default:return 0}}else{if(a==Kekule.BondOrder.DOUBLE){switch(b){case Kekule.BondStereo.E_Z_BY_COORDINATES:return 3;default:return 0}}else{return 0}}},coordToStr:function(a){return(a||0).toFixed(4)},getMassDiff:function(b){var a=Kekule.ChemicalElementsDataUtil.getElementInfo(b.getAtomicNumber());var c=a.naturalMass;return Math.round(b.getMassNumber()-c)},getAtomListPropLineValue:function(h){var g="";var f=h.getAllowedIsotopeIds();if(f&&f.length){g=" F "}else{g=" T ";f=h.getDisallowedIsotopeIds()}if(f&&f.length){var c=[];for(var d=0,b=f.length;d<b;++d){var e=Kekule.IsotopesDataUtil.getIsotopeIdDetail(f[d]);if(e&&e.symbol){c.push(e.symbol.rpad(4))}}var a=c.join("");g=c.length.toString().lpad(3)+g+a;return g}else{return null}},getCtabPropLineTag:function(b,a){return(a||"M")+"  "+b},getCtabPropLineCountTag:function(d,a,c){var b=(c||"M")+"  "+d;if(a){b+=(a).toString().lpad(3)}return b},generateCtabPropLine:function(b,e,c,d){var a=Kekule.IO.Mdl2kUtils.getCtabPropLineCountTag(e,c,d);return a+" "+b.join(" ")}};Kekule.IO.Mdl2kCTabReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl2kCTabReader",doReadBlock:function(b,a){return this.analysisCTab(b)},analysisCTab:function(d){var n={};var m=d.readLine();var j=this.analysisCountLine(m);var e=[];e.isCoord3D=false;for(var h=0;h<j.atomCount;++h){m=d.readLine();var k=this.analysisAtomLine(m);if(k.z){e.isCoord3D=true}e.push(k)}var g=[];for(var h=0;h<j.bondCount;++h){m=d.readLine();var b=this.analysisBondLine(m);g.push(b)}for(var h=0;h<j.atomListCount;++h){m=d.readLine();var f=this.analysisAtomListInfoLine(m);if(e[f.atomIndex]){e[f.atomIndex].atomListInfo=f}}for(var h=0;h<j.stextCount;++h){m=d.readLine();m=d.readLine()}var l=[];while(!d.eof()){m=d.readLine();var c=this.analysisPropertyLine(m,e,l);if(c.prop==="END"){break}if(c.prop==="SKP"){for(var h=0;h<c.count;++h){if(d.eof()){break}m=d.readLine()}}else{if(c.leading==="A"){if(d.eof()){break}var a=c.atomIndex;m=d.readLine();e[a].symbol=m.trim()}}}n.countInfo=j;n.atomInfos=e;n.bondInfos=g;n.sgInfos=l;return n},analysisCountLine:function(b){var a={};var c=b.substr(33,6).trim();if(c&&c!=Kekule.IO.MDL.VER2000){Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL2000_FORMAT_DATA"));return null}c=b.substr(0,3);a.atomCount=parseInt(c,10);c=b.substr(3,3);a.bondCount=parseInt(c,10);c=b.substr(12,3);a.isChiral=(parseInt(c,10)!=0);c=b.substr(15,3);a.stextCount=parseInt(c,10);return a},analysisAtomLine:function(c){var b={};var e=c.substr(0,10);b.x=parseFloat(e);e=c.substr(10,10);b.y=parseFloat(e);e=c.substr(20,10);b.z=parseFloat(e);e=c.substr(31,3);b.symbol=e.trim();e=c.substr(34,2);b.massDiff=parseInt(e,10);e=c.substr(36,3);var d=parseInt(e,10);var a=Kekule.IO.Mdl2kUtils.atomLineChargeToRadical(d);if(a){b.radical=a}else{b.charge=Kekule.IO.Mdl2kUtils.atomLineChargeToKekule(d)}e=c.substr(39,3);var d=parseInt(e,10);if(d){b.parity=d}e=c.substr(42,3);var d=parseInt(e,10);if(d>0){b.hydrongenCount=d-1}return b},analysisBondLine:function(b){var a={};var d=b.substr(0,3);a.atomIndex1=parseInt(d,10)-1;d=b.substr(3,3);a.atomIndex2=parseInt(d,10)-1;d=b.substr(6,3);a.order=Kekule.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(d,10));d=b.substr(9,3);var c=Kekule.IO.Mdl2kUtils.bondStereoToKekule(parseInt(d,10),a.order);if(c){a.stereo=c}return a},analysisAtomListInfoLine:function(b){var a={};var f=b.substr(0,3);a.atomIndex=parseInt(f,10)-1;f=b.substr(4,1);a.isAllowList=(f.toLowerCase()=="f");f=b.substr(9,1);var e=Math.min(parseInt(f,10),5);a.atomicNumbers=[];var g=11;for(var d=0;d<e;++d){g+=4*d;f=b.substr(g,3);var c=parseInt(f,10);if(c){a.atomicNumbers.push(c)}}return a},analysisPropertyLine:function(o,p,j){var n={};var x=o.substr(0,1);n.leading=x;if(x=="M"){var y=o.substr(3,3).trim();n.prop=y;var A,h,u;if(y==="END"){return n}if(["CHG","RAD","ISO"].indexOf(y)>=0){var e=parseInt(o.substr(6,3).trim());n.entryCount=e;n.entries=[];propName=(y==="CHG")?"charge":(y==="RAD")?"radical":"massNumber";var m=10;for(var v=0;v<e;++v){var A=parseInt(o.substr(m,3).trim(),10)-1;var l=parseInt(o.substr(m+4,3).trim(),10);m+=8;n.entries.push({atomIndex:A,propName:l});p[A][propName]=l}}else{if(["STY","SLB"].indexOf(y)>=0){h=parseInt(o.substr(10,3),10)-1;u=j[h]}else{if(["SAL","SBL","SMT","SCL","SAP","SBV"].indexOf(y)>=0){h=parseInt(o.substr(7,3),10)-1;u=j[h]}}}var d=14;switch(y){case"ALS":var t={};var a=o.substr(7,3).trim();t.atomIndex=parseInt(a,10)-1;n.atomIndex=t.atomIndex;var k=parseInt(o.substr(10,3));var r=o.substr(14,1);t.isAllowList=(r.toLowerCase()=="f");t.symbols=[];for(var v=0;v<k;++v){r=o.substr(16+v*4,4).trim();t.symbols.push(r)}n.atomListInfo=t;var w=p[t.atomIndex].atomListInfo;if(!w){p[t.atomIndex].atomListInfo=t}else{if(w.isAllowList!==t.isAllowList){p[t.atomIndex].atomListInfo=t}else{w.symbols=Kekule.ArrayUtils.pushUnique(w.symbols,t.symbols)}}break;case"STY":var c=o.substr(14,3);if(c=="SUP"){j[h]={sgType:"SUP"}}break;case"SLB":if(u){u.labelId=o.substr(14).trim()}break;case"SAL":if(u){var z=parseInt(o.substr(10,3));if(!u.atomIndexes){u.atomIndexes=[]}for(var v=0;v<z;++v){var r=o.substr(14+v*4,3);var A=parseInt(r)-1;u.atomIndexes.push(A)}}break;case"SBL":if(u&&(u.sgType=="SUP")){var g=parseInt(o.substr(10,3));if(!u.crossBondIndexes){u.crossBondIndexes=[]}for(var v=0;v<g;++v){var r=o.substr(14+v*4,3);var f=parseInt(r)-1;u.crossBondIndexes.push(f)}}break;case"SMT":if(u){if(u.sgType=="SUP"){u.label=o.substr(11).trim()}else{u.subscript=o.substr(11).trim()}}break;case"SCL":if(u){u.sgClass=o.substr(11).trim()}break;case"SBV":if(u){var b=parseInt(o.substr(11,3),10)-1;vectorX=parseFloat(o.substr(14,10));vectorY=parseFloat(o.substr(24,10));if(!u.bondVectors){u.bondVectors=[]}u.bondVectors[b]={bondIndex:b,x:vectorX,y:vectorY};var q=o.substr(34,10).trim();if(q){vectorZ=parseFloat(q)||0;u.bondVectors[b].z=vectorZ}}break}}else{if(x==="A"){var m=3;var A=parseInt(o.substr(m,3).trim(),10)-1;n.atomIndex=A}else{if(x==="V"){}else{if(x==="G"){}else{if(x==="S"){var y=o.substr(3,3).trim();n.prop=y;n.count=parseInt(o.substr(6,3),10)}}}}}return n}});Kekule.IO.Mdl2kCTabWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl2kCTabWriter",initialize:function($super,a){$super();this.setCoordMode(a||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:Kekule.CoordMode.UNKNOWN})},doWriteBlock:function(a,b){Kekule.IO.MdlUtils.assertIlegalForCtabOutput(a);return this.outputCtab(a,b)},outputCtab:function(d,f){var e=[];var c=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(d);if(this.getCoordMode()!=Kekule.CoordMode.UNKNOWN){c.coordMode=this.getCoordMode()}f.writeLine(this.generateCountLine(c));this.outputAtomBlock(d,c,f,e);this.outputBondBlock(d,c,f);if(e.length){for(var b=0,a=e.length;b<a;++b){f.writeLine(e[b])}}this.outputSubgroupsPropLines(d,c,f);f.writeLine(Kekule.IO.Mdl2kUtils.getCtabPropLineTag("END"))},generateCountLine:function(a){return Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(a,Kekule.IO.MdlVersion.V2000)},outputAtomBlock:function(f,d,h,g){for(var c=0,b=d.atoms.length;c<b;++c){var e=d.atoms[c];var a=this.generateAtomLine(c,d.coordMode,e,g);h.writeLine(a)}},generateAtomLine:function(j,b,h,o){var a=Kekule.IO.Mdl2kUtils.coordToStr;var q="";var l=(j+1).toString().lpad(3);var g=(b==Kekule.CoordMode.COORD3D)?h.getAbsCoord3D():h.getAbsCoord2D();q+=a(g.x).lpad(10)+a(g.y).lpad(10)+a(g.z).lpad(10);q+=" "+Kekule.IO.MdlStructureUtils.getAtomTypeStr(h,true).rpad(3);if(Kekule.IO.MdlStructureUtils.isNodeVariableAtom(h)){var n=Kekule.IO.Mdl2kUtils.getAtomListPropLineValue(h);if(n){var d=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("ALS")+" "+l+n;o.push(d)}}if(h.getMassNumber&&h.getMassNumber()){var k=Kekule.IO.Mdl2kUtils.getMassDiff(h.getIsotope())||0;q+=k.toString().lpad(2);var d=Kekule.IO.Mdl2kUtils.generateCtabPropLine([l,h.getMassNumber().toString().lpad(3)],"ISO",1);o.push(d)}else{q+="0".lpad(2)}q+=Kekule.IO.Mdl2kUtils.chargeOrRadicalToMdlAtomLineValue(h.getCharge?h.getCharge():null,h.getRadical?h.getRadical():null).toString().lpad(3);if(h.getCharge&&h.getCharge()){var d=Kekule.IO.Mdl2kUtils.generateCtabPropLine([l,h.getCharge().toString().lpad(3)],"CHG",1);o.push(d)}if(h.getRadical&&h.getRadical()){var d=Kekule.IO.Mdl2kUtils.generateCtabPropLine([l,Kekule.IO.MdlUtils.kekuleRadicalToMdl(h.getRadical()).toString().lpad(3)],"RAD",1);o.push(d)}var c=h.getParity?(h.getParity()||0):0;q+=c.toString().lpad(3);var f=h.getExplicitHydrogenCount?h.getExplicitHydrogenCount():null;var m=Kekule.ObjUtils.isUnset(f)?"0":(f+1).toString();q+=m.lpad(3);for(var e=0,p="0".lpad(3);e<8;++e){q+=p}return q},outputBondBlock:function(e,d,g){for(var c=0,b=d.bonds.length;c<b;++c){var f=d.bonds[c];var a=this.generateBondLine(c,f,d.atoms);g.writeLine(a)}},generateBondLine:function(a,e,d){var c="";var b=Kekule.IO.MdlStructureUtils.splitConnectedNodes(e);c+=(d.indexOf(b.primaryNodes[0])+1).toString().lpad(3);c+=(d.indexOf(b.primaryNodes[1])+1).toString().lpad(3);if(e.getBondOrder){c+=Kekule.IO.MdlUtils.kekuleBondOrderToMdlType(e.getBondOrder()).toString().lpad(3)}else{c+="0".lpad(3)}if(e.getStereo&&e.getBondOrder){c+=Kekule.IO.Mdl2kUtils.bondStereoToMdlBondLineValue(e.getStereo(),e.getBondOrder()).toString().lpad(3)}else{c+="0".lpad(3)}c+="0".lpad(3);c+="0".lpad(3);c+="0".lpad(3);return c},outputSubgroupsPropLines:function(g,f,h){for(var e=0,b=f.subGroups.length;e<b;++e){var a=this.generateSgroupLines(e,f.subGroups[e],f);for(var d=0,c=a.length;d<c;++d){h.writeLine(a[d])}}},generateSgroupLines:function(g,A,u){var k=[];var q=(g+1).toString().lpad(3);var o=Kekule.IO.Mdl2kUtils.generateCtabPropLine([q,"SUP"],"STY",1);k.push(o);o=Kekule.IO.Mdl2kUtils.generateCtabPropLine([q,q],"SLB",1);k.push(o);var m=(A.getAbbr&&A.getAbbr())||(A.getFormulaText&&A.getFormulaText())||(A.getName&&A.getName());if(m){o=Kekule.IO.Mdl2kUtils.generateCtabPropLine([q,m],"SMT");k.push(o)}var z=[];var d=A.getLeafNodes();for(var t=0,r=d.length;t<r;++t){var g=u.atoms.indexOf(d[t]);if(g>=0){z.push((g+1).toString().lpad(3))}}z=z.sort();var f=Kekule.ArrayUtils.divide(z,15);for(var t=0,r=f.length;t<r;++t){var y=f[t];o=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SAL")+" "+q+y.length.toString().lpad(3)+" "+y.join(" ");k.push(o)}var e=A.getCrossConnectors();var b=[];var p=[];var n=Kekule.IO.Mdl2kUtils.coordToStr;for(var t=0,r=e.length;t<r;++t){var g=u.bonds.indexOf(e[t]);if(g>=0){b.push((g+1).toString().lpad(3));var x=[g+1];var w=Kekule.IO.MdlStructureUtils.splitConnectedNodes(e[t]);var d=w.primaryNodes;var c={};if(d.length==2){if(u.coordMode==Kekule.CoordMode.COORD2D){c=Kekule.CoordUtils.substract(d[0].getAbsCoord2D(),d[1].getAbsCoord2D());x=x.concat([n(c.x).lpad(10),n(c.y).lpad(10)])}else{c=Kekule.CoordUtils.substract(d[0].getAbsCoord3D(),d[1].getAbsCoord3D());x=x.concat([n(c.x),n(c.y),n(c.z)])}}p.push(x)}}b=b.sort();var j=Kekule.ArrayUtils.divide(b,15);for(var t=0,r=j.length;t<r;++t){var a=j[t];o=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SBL")+" "+q+a.length.toString().lpad(3)+" "+a.join(" ");k.push(o)}for(var t=0,r=p.length;t<r;++t){var v=p[t].shift();var h=p[t].join("");o=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SBV")+" "+q+" "+v.toString().lpad(3)+h;k.push(o)}return k}});Kekule.IO.Mdl3kUtils={get3kBlockStartTag:function(a){return"BEGIN "+a.toUpperCase()},get3kBlockEndTag:function(a){return"END "+a.toUpperCase()},isAtomList:function(b){var a=/\[.+\]/;return b.search(a)>=0},analysisAtomList:function(g){var e=/\[(.+)\]/g;var f=e.exec(g);if(f&&(f.length>=2)){var d=f[1];f=d.split(",");var a={};a.isAllowList=!(g.trim().indexOf("NOT")==0);a.symbols=[];for(var c=0,b=f.length;c<b;++c){a.symbols.push(f[c].trim())}return a}else{return null}},bondCfgToKekule:function(a){switch(a){case 0:return Kekule.BondStereo.NONE;case 1:return Kekule.BondStereo.UP;case 2:return Kekule.BondStereo.UP_OR_DOWN;case 3:return Kekule.BondStereo.DOWN;default:return Kekule.BondStereo.NONE}},bondStereoToMdlCfg:function(a){switch(a){case Kekule.BondStereo.UP:return 1;case Kekule.BondStereo.UP_OR_DOWN:return 2;case Kekule.BondStereo.DOWN:return 3;default:return 0}},coordToStr:function(a){return(a||0).toFixed(6)}};Kekule.IO.Mdl3kValueUtils={SEPARATOR:" ",KEYVALUE_CONNECTOR:"=",STR_QUOTE:'"',ESC_QUOTE:'""',VALUELIST_PATTERN:/\(.+\)/g,split:function(j,g){var n=g||Kekule.IO.Mdl3kValueUtils.SEPARATOR;var d=Kekule.IO.Mdl3kValueUtils.STR_QUOTE;var o=[];var f=false;var a=false;var k=false;var m="";for(var e=0,b=j.length;e<b;++e){var h=j.charAt(e);if(h==d){if(((!f)&&(j.charAt(e+1)==d))||(f&&(j.charAt(e-1)==d))){}else{f=!f}}else{if(h=="["){a=true}else{if(h=="]"){a=false}else{if(h=="("){k=true}else{if(h==")"){k=false}}}}}if(h==n){if((!f)&&(!a)&&(!k)&&m){o.push(m);m=""}else{m+=h}}else{m+=h}}if(m){o.push(m)}return o},merge:function(b,c){var a=c||Kekule.IO.Mdl3kValueUtils.SEPARATOR;return b.join(a)},isKeyValuePair:function(a){return a.indexOf(Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR)>=0},splitKeyValue:function(d){var a={};var b=Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR;var c=d.indexOf(b);if(c<0){a.value=d}else{a.key=d.substr(0,c);a.value=d.substr(c+b.length)}return a},mergeKeyValue:function(b,a){if(!a){return b}else{return""+a+Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR+b}},isValueList:function(b){var a=b.search(Kekule.IO.Mdl3kValueUtils.VALUELIST_PATTERN);return(a>=0)},splitValueList:function(e){var c=/\((.+)\)/;var d=c.exec(e);if(d&&(d.length>1)){var b=d[1];var a=Kekule.IO.Mdl3kValueUtils.split(b);a.shift();return a}else{return[e]}},mergeValueList:function(b){var d="("+b.length;for(var c=0,a=b.length;c<a;++c){d+=Kekule.IO.Mdl3kValueUtils.SEPARATOR+b[c]}d+=")";return d},unquoteValue:function(d){var b=Kekule.IO.Mdl3kValueUtils.STR_QUOTE;var a=d.trim();if(a.substr(0,b.length)==b){a=a.substr(b.length)}if(a.substr(a.length-b.length)==b){a=a.substr(0,a.length-b.length)}var c=new RegExp(b+b,"g");a=a.replace(c,b);if(Kekule.IO.Mdl3kValueUtils.isValueList(a)){a=Kekule.IO.Mdl3kValueUtils.splitValueList(a)}return a},quoteValue:function(d){var b=Kekule.IO.Mdl3kValueUtils.STR_QUOTE;var a=""+d;var c=new RegExp(b,"g");a=a.replace(c,b+b);if(a.indexOf(Kekule.IO.Mdl3kValueUtils.SEPARATOR)>=0){a=b+a+b}return a},splitValues:function(f){var a=[];var d=Kekule.IO.Mdl3kValueUtils.split(f);for(var c=0,b=d.length;c<b;++c){var e=Kekule.IO.Mdl3kValueUtils.splitKeyValue(d[c]);if(e.value){e.value=Kekule.IO.Mdl3kValueUtils.unquoteValue(e.value)}a.push(e)}return a},mergeValues:function(g){var a;for(var d=0,b=g.length;d<b;++d){var h=g[d];var c,f;if((typeof(h)!="object")||Kekule.ArrayUtils.isArray(h)){f=h}else{c=h.key;f=h.value}var e;if(Kekule.ArrayUtils.isArray(f)){e=Kekule.IO.Mdl3kValueUtils.mergeValueList(f)}else{e=Kekule.IO.Mdl3kValueUtils.quoteValue(f)}if(c){e=Kekule.IO.Mdl3kValueUtils.mergeKeyValue(e,c)}a=Kekule.IO.Mdl3kValueUtils.appendToken(a,e)}return a},appendToken:function(a,c,e){var b=e||Kekule.IO.Mdl3kValueUtils.SEPARATOR;var d=a||"";if((!d)||(d.substr(d.length-b.length,b.length)==b)){d=c}else{d+=Kekule.IO.Mdl3kValueUtils.SEPARATOR+c}return d}};Kekule.IO.Mdl3kTextBuffer=Class.create(Kekule.TextLinesBuffer,{CLASS_NAME:"Kekule.Mdl3kTextBuffer",LEADING_TAG:"M  V30 ",LINE_CONTI_MARK:"-",MAX_COL_WIDTH:80,initialize:function($super,a){$super(a)},isStartWithLeadingTag:function(a){return(a.substr(0,this.LEADING_TAG.length)==this.LEADING_TAG)},isEndWithContinueMark:function(a){var b=a.trim();return(b.substr(b.length-this.LINE_CONTI_MARK.length)==this.LINE_CONTI_MARK)},getLineWithout3kTag:function(b){var a=this.LEADING_TAG.length;if(b.substr(0,a)==this.LEADING_TAG){return b.substr(a)}else{return b}},getLineAtEx:function(c){var b=this.getLineAt(c);var e=1;if(b&&this.isEndWithContinueMark(b)&&this.isStartWithLeadingTag(this.getLines()[c])){var f=b.lastIndexOf(this.LINE_CONTI_MARK);b=b.substr(0,f);var d=this.getLineAtEx(c+1);b+=d.line;e+=d.lineCount}var a={line:b,lineCount:e};return a},getLineAt:function($super,b){var a=$super(b);return this.getLineWithout3kTag(a)},readLine:function(){var a=this.getLineAtEx(this.getCurrLineNo());this.incCurrLineNo(a.lineCount);return a.line},writeLine:function($super,h,e){if(!e){var f=h;if(!this.isStartWithLeadingTag(h)){f=this.LEADING_TAG+f}var c;if(f.length>this.MAX_COL_WIDTH){var d=this.LINE_CONTI_MARK;var g=Kekule.IO.Mdl3kValueUtils.SEPARATOR;var b=this.MAX_COL_WIDTH-d.length;c=f.substr(b);f=f.substr(0,b);f+=d}var a=$super(f);if(c){a=this.writeLine(c,e)}return a}else{return $super(h)}},writeLines:function($super,b,d){for(var c=0,a=b.length;c<a;++c){this.writeLine(b[c],d)}},getBlockBuffer:function(d,f){var i;var e=Kekule.IO.Mdl3kUtils.get3kBlockStartTag(d);var b=Kekule.IO.Mdl3kUtils.get3kBlockEndTag(d);var a=this.getCurrLineNo();this.reset();var h=this.readLine().trim();while((h!=e)&&(!this.eof())){h=this.readLine().trim()}if(this.eof()){i=null}else{var c=this.getCurrLineNo();endPos=this.getCurrLineNo();h=this.readLine().trim();while((h!=b)&&(!this.eof())){endPos=this.getCurrLineNo();h=this.readLine().trim()}if(h==b){var g=this.getLines().slice(c,endPos)}else{var g=this.getLines().slice(c)}i=new Kekule.IO.Mdl3kTextBuffer(g)}if(f){this.setCurrLineNo(a)}return i}});Kekule.IO.Mdl3kBlockReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kBlockReader",createTextBuffer:function(){return(new Kekule.IO.Mdl3kTextBuffer())},doReadBlock:function(h,g){var c;var d=!(h instanceof Kekule.IO.Mdl3kTextBuffer);if(d){c=new Kekule.IO.Mdl3kTextBuffer();c.setLines(h.getUnreadLines());c.reset()}else{c=h}var b=c.getCurrLineNo();var a=this.doRead3kBlock(c,g);var f=c.getCurrLineNo();if(d){var e=f-b;h.incCurrLineNo(e)}return a},doRead3kBlock:function(b,a){}});Kekule.IO.Mdl3kBlockWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kBlockWriter",createTextBuffer:function(){return(new Kekule.IO.Mdl3kTextBuffer())},writeStartTag:function(a,b){b.writeLine(Kekule.IO.Mdl3kUtils.get3kBlockStartTag(a))},writeEndTag:function(a,b){b.writeLine(Kekule.IO.Mdl3kUtils.get3kBlockEndTag(a))},doWriteBlock:function(d,e){var b;var c=!(e instanceof Kekule.IO.Mdl3kTextBuffer);if(c){b=new Kekule.IO.Mdl3kTextBuffer();b.setLines(e.getUnreadLines());b.reset()}else{b=e}var a=this.doWrite3kBlock(d,b);if(c){e.appendLines(c.getLines())}return a},doWrite3kBlock:function(a,b){}});Kekule.IO.Mdl3kCTabReader=Class.create(Kekule.IO.Mdl3kBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kCTabReader",doRead3kBlock:function(c,b){var a=c.getBlockBuffer("CTAB");if(!a){a=c}return this.analysisCTab(a)},analysisCTab:function(d){var k={};var j=d.readLine();var g=this.analysisCountLine(j);if(!g){return null}var f=[];var h;var i=d.getBlockBuffer("ATOM");if(i){h=this.analysisAtomBlock(i,f)}else{Kekule.raise(Kekule.$L("ErrorMsg.MDL3000_ATOMBLOCK_NOT_FOUND"));return null}var b;var e=d.getBlockBuffer("BOND");if(e){b=this.analysisBondBlock(e,f)}var c;var a=d.getBlockBuffer("SGROUP");if(a){c=this.analysisSGroupBlock(a,f)}k.countInfo=g;k.atomInfos=h;k.atomIndexMap=f;if(b){k.bondInfos=b}if(c){k.sgInfos=c}return k},analysisCountLine:function(c){var b={};var d=Kekule.IO.Mdl3kValueUtils.splitValues(c);var a=d.shift().value;if(a!="COUNTS"){Kekule.raise(Kekule.$L("ErrorMsg.MALFORMED_MDL3000_COUNTLINE"));return}var e=d.shift().value;b.atomCount=parseInt(e,10);e=d.shift().value;b.bondCount=parseInt(e,10);e=d.shift().value;b.sgroupCount=parseInt(e,10);e=d.shift().value;b.isChiral=(parseInt(e,10)!=0);return b},analysisAtomBlock:function(f,b){var e=Kekule.CoordMode.COORD2D;var a=[];while(!f.eof()){line=f.readLine();var d=this.analysisAtomLine(line);var c=a.push(d)-1;b[d.index]=c;if(d.z){e=Kekule.CoordMode.COORD3D}}a.coordMode=e;a.isCoord3D=(e==Kekule.CoordMode.COORD3D);return a},analysisAtomLine:function(n,e){var o={};var k=Kekule.IO.Mdl3kValueUtils.splitValues(n);o.index=parseInt(k.shift().value,10);var m=k.shift().value.trim();if(Kekule.IO.Mdl3kUtils.isAtomList(m)){var b=Kekule.IO.Mdl3kUtils.analysisAtomList(m);if(b){o.atomListInfo=b;o.symbol="L"}}else{o.symbol=m}o.x=parseFloat(k.shift().value);o.y=parseFloat(k.shift().value);o.z=parseFloat(k.shift().value);k.shift();for(var f=0,a=k.length;f<a;++f){var d=k[f];var j=d.key;var h=d.value;switch(j){case"CHG":var g=parseInt(h,10);if(g){o.charge=g}break;case"RAD":var g=parseInt(h,10);if(g){o.radical=g}break;case"CFG":var g=parseInt(h,10);if(g){o.parity=g}break;case"MASS":o.massNumber=parseFloat(h);break;case"VAL":break;case"HCOUNT":var g=parseInt(h,10);if(g){o.hydrongenCount=(g==-1)?0:g-1}break;case"RGROUPS":var g=parseInt(h,10);if(g){o.rgroupCount=g}break}}return o},analysisBondBlock:function(d,b){var c=[];while(!d.eof()){line=d.readLine();var a=this.analysisBondLine(line,b);c[a.index]=a}return c},analysisBondLine:function(p,e){var q={};var n=Kekule.IO.Mdl3kValueUtils.splitValues(p);q.index=parseInt(n.shift().value,10);var o=n.shift().value;q.order=Kekule.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(o,10));q.atomIndex1=e[parseInt(n.shift().value,10)];q.atomIndex2=e[parseInt(n.shift().value,10)];for(var f=0,a=n.length;f<a;++f){var m=n[f].key;var h=n[f].value;switch(m){case"CFG":var g=parseInt(h,10);q.stereo=Kekule.IO.Mdl3kUtils.bondCfgToKekule(g);break;case"ENDPTS":if(Kekule.ArrayUtils.isArray(h)){q.endAtomIndexes=[];for(var d=0,b=h.length;d<b;++d){q.endAtomIndexes.push(e[parseInt(h[d],10)])}}else{q.endAtomIndexes=[e[parseInt(h,10)]]}case"TOPO":case"RXCTR":case"STBOX":break}}return q},analysisSGroupBlock:function(g,d){var a=[];var e=null;var f=g.getCurrLineNo();line=g.readLine();var b=Kekule.IO.Mdl3kValueUtils.splitValues(line);if(b.shift().value=="DEFAULT"){e=this.fetchSGroupOptionalValues(line,d)}else{g.setCurrLineNo(f)}while(!g.eof()){line=g.readLine();var c=this.analysisSGroupLine(line,d,e);a[c.index]=c}return a},analysisSGroupLine:function(c,e,f){var b={};var d=Kekule.IO.Mdl3kValueUtils.splitValues(c);b.index=parseInt(d.shift().value,10);b.sgType=d.shift().value.trim();b.extIndex=parseInt(d.shift().value,10);var a=this.fetchSGroupOptionalValues(d,e);if(f){a=Object.extend(f,a)}b=Object.extend(b,a);return b},fetchSGroupOptionalValues:function(a,f){var q={};for(var g=0,c=a.length;g<c;++g){var p=a[g].key;var o=a[g].value;switch(p){case"ATOMS":q.atomIndexes=[];for(var e=0,d=o.length;e<d;e++){q.atomIndexes.push(f[o[e]])}break;case"XBONDS":q.crossBondIndexes=[].concat(o);break;case"SUBTYPE":q.subType=o;break;case"LABEL":q.label=o;break;case"CSTATE":if(!q.bondVectors){q.bondVectors=[]}var b=parseInt(o.shift(),10);var n=parseFloat(o.shift())||0;var m=parseFloat(o.shift())||0;var h=parseFloat(o.shift())||0;q.bondVectors[b]={bondIndex:b,x:n,y:m,z:h};break;case"CLASS":q.sgClass=o;break}}return q}});Kekule.IO.Mdl3kCTabWriter=Class.create(Kekule.IO.Mdl3kBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kCTabWriter",initialize:function($super,a){$super();this.setCoordMode(a||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:Kekule.CoordMode.UNKNOWN})},doWrite3kBlock:function(a,b){Kekule.IO.MdlUtils.assertIlegalForCtabOutput(a);return this.outputCtab(a,b)},outputCtab:function(b,c){var a=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(b);this.writeStartTag("CTAB",c);if(this.getCoordMode()!=Kekule.CoordMode.UNKNOWN){a.coordMode=this.getCoordMode()}c.writeLine(this.generateCountLine(a));this.outputAtomBlock(b,a,c);this.outputBondBlock(b,a,c);this.outputSgroupBlock(b,a,c);this.writeEndTag("CTAB",c)},generateCompatibilityCountLine:function(a){return Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(a,Kekule.IO.MdlVersion.V3000)},generateCountLine:function(b){var a=["COUNTS"];a.push(b.atoms.length);a.push(b.bonds.length);a.push(b.subGroups.length);a.push(0);a.push(0);return Kekule.IO.Mdl3kValueUtils.mergeValues(a)},outputAtomBlock:function(f,d,g){this.writeStartTag("ATOM",g);for(var c=0,b=d.atoms.length;c<b;++c){var e=d.atoms[c];var a=this.generateAtomLine(c,d.coordMode,e);g.writeLine(a)}this.writeEndTag("ATOM",g)},generateAtomLine:function(b,d,c){var e=Kekule.IO.Mdl3kUtils.coordToStr;var a=[b+1,Kekule.IO.MdlStructureUtils.getAtomTypeStr(c)];if(d==Kekule.CoordMode.COORD2D){var f=c.getAbsCoord2D();a=a.concat([e(f.x),e(f.y),e(0)])}else{var f=c.getAbsCoord3D();a=a.concat([e(f.x),e(f.y),e(f.z)])}a.push(0);if(c.getCharge&&c.getCharge()){a.push({key:"CHG",value:c.getCharge()})}if(c.getRadical&&c.getRadical()){a.push({key:"RAD",value:c.getRadical()})}if(c.getParity&&c.getParity()){a.push({key:"CFG",value:c.getParity()})}if(c.getMassNumber&&c.getMassNumber()){a.push({key:"MASS",value:c.getMassNumber()})}if(c.getExplicitHydrogenCount&&(!Kekule.ObjUtils.isUnset(c.getExplicitHydrogenCount()))){a.push({key:"HCOUNT",value:c.getExplicitHydrogenCount()+1})}return Kekule.IO.Mdl3kValueUtils.mergeValues(a)},outputBondBlock:function(e,d,g){if(d.bonds.length<=0){return}this.writeStartTag("BOND",g);for(var c=0,b=d.bonds.length;c<b;++c){var f=d.bonds[c];var a=this.generateBondLine(c,f,d.atoms);g.writeLine(a)}this.writeEndTag("BOND",g)},generateBondLine:function(g,k,a){var j=[g+1,Kekule.IO.MdlUtils.kekuleBondOrderToMdlType(k.getBondOrder?k.getBondOrder():Kekule.BondOrder.UNSET)];var f=0;var e=[];var b=[];var h=Kekule.IO.MdlStructureUtils.splitConnectedNodes(k);e=[a.indexOf(h.primaryNodes[0])+1,a.indexOf(h.primaryNodes[1])+1];if(h.remainNodes&&h.remainNodes.length){for(var d=0,c=h.remainNodes.length;d<c;++d){b.push(a.indexOf(h.remainNodes[d])+1)}}j=j.concat(e);if(k.getStereo&&k.getStereo()){j.push({key:"CFG",value:Kekule.IO.Mdl3kUtils.bondStereoToMdlCfg(k.getStereo())})}if(b.length>0){j.push({key:"ENDPTS",value:b});j.push({key:"ATTACH",value:"ALL"})}return Kekule.IO.Mdl3kValueUtils.mergeValues(j)},outputSgroupBlock:function(e,d,f){if(d.subGroups.length<=0){return}this.writeStartTag("SGROUP",f);for(var c=0,b=d.subGroups.length;c<b;++c){var a=this.generateSgroupLine(c,d.subGroups[c],d);f.writeLine(a)}this.writeEndTag("SGROUP",f)},generateSgroupLine:function(f,t,o){var s=o.atoms;var j=o.bonds;var c=[f+1,"SUP",f+1];var r=[];var d=t.getLeafNodes();for(var n=0,m=d.length;n<m;++n){var f=s.indexOf(d[n]);if(f>=0){r.push(f+1)}}r=r.sort();c.push({key:"ATOMS",value:r});var g=(t.getAbbr&&t.getAbbr())||(t.getFormulaText&&t.getFormulaText())||(t.getName&&t.getName());if(g){c.push({key:"LABEL",value:g})}var e=t.getCrossConnectors();var a=[];var k=[];var h=Kekule.IO.Mdl3kUtils.coordToStr;for(var n=0,m=e.length;n<m;++n){var f=j.indexOf(e[n]);if(f>=0){a.push(f+1);var q=[f+1];var p=Kekule.IO.MdlStructureUtils.splitConnectedNodes(e[n]);var d=p.primaryNodes;var b={};if(d.length==2){if(o.coordMode==Kekule.CoordMode.COORD2D){b=Kekule.CoordUtils.substract(d[0].getAbsCoord2D(),d[1].getAbsCoord2D());q=q.concat([h(b.x),h(b.y),0])}else{b=Kekule.CoordUtils.substract(d[0].getAbsCoord3D(),d[1].getAbsCoord3D());q=q.concat([h(b.x),h(b.y),h(b.z)])}}k.push(q)}}a=a.sort();c.push({key:"XBONDS",value:a});for(var n=0,m=k.length;n<m;++n){c.push({key:"CSTATE",value:k[n]})}return Kekule.IO.Mdl3kValueUtils.mergeValues(c)}});Kekule.globalOptions.add("IO.mdl",{mdlVersion:Kekule.IO.MdlVersion.V2000,coordMode:Kekule.CoordMode.UNKNOWN});Kekule.IO.MdlStructureFragmentReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentReader",initialize:function($super,a){$super();this.setCoordMode(a||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},createFragment:function(a){},createCtabReader:function(a){if(a==Kekule.IO.MdlVersion.V3000){return new Kekule.IO.Mdl3kCTabReader()}else{return new Kekule.IO.Mdl2kCTabReader()}},getCtabVersion:function(d){var c=d.getCurrLineNo();var a=d.readLine();d.setCurrLineNo(c);var b=a.substr(33,6).trim();if(b=="V3000"){return Kekule.IO.MdlVersion.V3000}else{if(b=="V2000"){return Kekule.IO.MdlVersion.V2000}else{return Kekule.IO.MdlVersion.V2000}}},createStructureFromJson:function(c,b){var a=this.createFragment();if(a){Kekule.IO.MdlStructureUtils.fillFragment(a,c,this.getCoordMode())}return a},doReadBlock:function($super,f,d){var b=this.getCtabVersion(f);if(!b){return null}var e=this.createCtabReader(b);var c=e.doReadBlock(f,d);if(c.atomInfos.coordMode){this._forceCoordMode=c.atomInfos.coordMode}var a=this.createStructureFromJson(c,d);return a}});Kekule.IO.MdlStructureFragmentWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentWriter",initialize:function($super,a,b){$super();this.setMdlVersion(a||Kekule.IO.MdlVersion.V2000);this.setCoordMode(b||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000});this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},createCtabWriter:function(a){if(a==Kekule.IO.MdlVersion.V3000){return new Kekule.IO.Mdl3kCTabWriter(this.getCoordMode())}else{return new Kekule.IO.Mdl2kCTabWriter(this.getCoordMode())}},doWriteBlock:function($super,b,d){var a=this.createCtabWriter(this.getMdlVersion());var c=a.writeBlock(b);d.writeText(c)}});Kekule.IO.Mdl3kMoleculeCTabReader=Class.create(Kekule.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabReader",createFragment:function(a){return new Kekule.Molecule()},doReadBlock:function($super,d,b){var c=this.createCtabReader(Kekule.IO.MdlVersion.V3000);var a=c.doReadBlock(d,b);return this.createStructureFromJson(a,b)}});Kekule.IO.Mdl3kMoleculeCTabWriter=Class.create(Kekule.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabWriter",initialize:function($super,a){$super(Kekule.IO.MdlVersion.V3000,a)},doWriteBlock:function($super,b,d){var a=new Kekule.IO.Mdl3kCTabWriter(this.getCoordMode());var c=a.writeBlock(b);d.writeText(c)}});Kekule.IO.MdlMoleculeReader=Class.create(Kekule.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.MdlMoleculeReader",createFragment:function(b){var a=new Kekule.Molecule();return a},readHeaderInfo:function(g,d){var b={};var c=g.readLine();if(c){b.name=c}var a=g.readLine();var e=this.readInfoLine(a);if(e){b=Object.extend(b,e)}var f=g.readLine();if(f){b.comment=f}return b},readInfoLine:function(b){var a={};if(b.trim()){var c=b.substr(0,2).trim();if(c){a.userAbbr=c}c=b.substr(2,8).trim();if(c){a.programName=c}c=b.substr(10,10);if(c.trim()){a.date=Kekule.IO.MdlUtils.analysisMdlDateTimeStr(c,false)}c=b.substr(20,2);a.coordMode=(c=="3D")?Kekule.CoordMode.COORD3D:((c=="2D")?Kekule.CoordMode.COORD2D:Kekule.CoordMode.UNKNOWN)}return a},doReadBlock:function($super,e,d){var b=this.readHeaderInfo(e,d);if(b&&(typeof(b.coordMode)!="undefined")){this.setCoordMode(b.coordMode)}var c=$super(e,d);if(c&&b){b.name?c.setName(b.name):null;b.userAbbr?c.setInfoValue("author",b.userAbbr):null;b.programName?c.setInfoValue("generator",b.programName):null;b.date?c.setInfoValue("date",b.date):null;b.comment?c.setInfoValue("comment",b.comment):null}if(!e.eof()){var a=e.getCurrLine();if(a.trim().toUpperCase()==="M  END"){e.readLine()}}return c}});Kekule.IO.MdlMoleculeWriter=Class.create(Kekule.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.MdlMoleculeWriter",writeHeaderInfo:function(b,d){d.writeLine(b.getName()||Kekule.$L("Texts.UNNAMED")||"");var a=this.generateInfoLine(b);d.writeLine(a);var c=b.getInfoValue("comment");d.writeLine(c||"")},generateInfoLine:function(d){var c="";var b=d.getInfoValue("author");c+=b?b.toString().substr(0,2).rpad(2):"  ";var e=d.getInfoValue("generator");c+=e?e.toString().substr(0,8).rpad(8):Kekule.LIBNAME_CORE.rpad(8);var a=d.getInfoValue("date")||new Date();c+=Kekule.IO.MdlUtils.generateMdlDateTimeStr(a,false);c+=(this.getCoordMode()==Kekule.CoordMode.COORD3D)?"3D":"2D";return c},getMolecule:function(a){return Kekule.ChemStructureUtils.getTotalStructFragment(a)},doWriteBlock:function($super,c,d){var b=this.getMolecule(c);if(b){var a=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(b);this.setCoordMode(a.coordMode);this.writeHeaderInfo(b,d);if(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000){d.writeLine(Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(a,this.getMdlVersion()))}$super(b,d);if(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000){d.writeLine("M  END")}}else{}}});Kekule.IO.MdlStructDataReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructDataReader",DATA_HEAD_PREFIX:Kekule.IO.MDL.SD_DATA_HEAD_PREFIX,DATA_DBFIELD_PATTERN:/\bDT(\d+)\b/,DATA_KEY_NAME_PATTERN:/\<(.+)\>/,MOL_DELIMITER:Kekule.IO.MDL.MOL_DELIMITER,doReadBlock:function(c,g){var n=new Kekule.IO.MdlMoleculeReader();try{var o,f;var h;var b=[];while(!c.eof()){try{h=n.doReadBlock(c,null)}catch(m){h=null}if(h){b.push(h);o=null;f=null;while(!c.eof()){var a=this.analysisDataLine(c.readLine());if(a){var k=a.lineType;if(k==="dataheader"){o=a.key}else{if(k==="datavalue"){if(o){f=a.value;h.setInfoValue(o,f)}}else{if(k==="moldelimiter"){break}}}}}}else{break}}if(b.length>1){var p=new Kekule.ChemObjList();for(var j=0,d=b.length;j<d;++j){p.append(b[j])}return p}else{return b[0]}}finally{n.finalize()}},analysisDataLine:function(a){var e,b,d;var c=a.trim();if(c.startsWith(this.DATA_HEAD_PREFIX)){e="dataheader";b=this.getDataHeaderKey(a);if(b){return{lineType:e,key:b}}else{return null}}else{if(c.startsWith(this.MOL_DELIMITER)){return{lineType:"moldelimiter"}}else{if(!c){return null}else{return{lineType:"datavalue",value:a}}}}},getDataHeaderKey:function(b){var c=null;var a=this.DATA_KEY_NAME_PATTERN.exec(b);if(a&&(a.length>1)){c=a[1]}else{a=this.DATA_DBFIELD_PATTERN.exec(b);if(a&&(a.length>1)){c=a[1]}else{c=b}}return c},doReadDataBlock:function(c,b){var a=c.readLine()}});Kekule.IO.MdlStructDataWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructDataWriter",IGNORED_INFO_FIELDS:["generator","author","date","comment"],initialize:function($super,a,b){$super();this.setMdlVersion(a||Kekule.IO.MdlVersion.V2000);this.setCoordMode(b||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000});this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteBlock:function(k,b){var a=this.getChildMols(k);var d=new Kekule.IO.MdlMoleculeWriter();d.setMdlVersion(this.getMdlVersion());d.setCoordMode(this.getCoordMode());for(var h=0,c=a.length;h<c;++h){var f=a[h];try{var m=d.writeBlock(f);b.writeText(m);var g=this.getMolData(f);this.doWriteDataBlock(g,b);b.writeLine(Kekule.IO.MDL.MOL_DELIMITER)}catch(j){}}},doWriteDataBlock:function(f,h){var d=Kekule.ObjUtils.getOwnedFieldNames(f);for(var c=0,a=d.length;c<a;++c){var b=d[c];if(this.IGNORED_INFO_FIELDS.indexOf(b)<0){var g=Kekule.IO.MDL.SD_DATA_HEAD_PREFIX+" <"+b+">";var e=f[b];if(g&&e){h.writeLine(g);h.writeLine(e);h.writeLine("")}}}},getChildMols:function(f){var d=Kekule.ChemStructureUtils.getChildStructureObjs(f,true);var a=[];for(var c=0,b=d.length;c<b;++c){var e=d[c];if(e instanceof Kekule.StructureFragment){a.push(e)}}return a},getMolData:function(a){var b=a.getInfo?a.getInfo()||{}:null;return b}});Kekule.IO.MdlBaseReactionReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlBaseReactionReader",readHeaderBlock:function(e,d){var a={};var c;var b=e.readLine().trim();c=b.substr(0,4);if(c!="$RXN"){Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL_RXN_DATA"));return null}else{c=b.substr(4).trim();if(c=="V3000"){a.version=Kekule.IO.MdlVersion.V3000}else{a.version=Kekule.IO.MdlVersion.V2000}}b=e.readLine().trim();if(b){a.name=b}b=e.readLine();c=b.substr(0,6).trim();if(c){a.userAbbr=c}c=b.substr(6,9).trim();if(c){a.programName=c}c=b.substr(15,10);if(c.trim()){a.date=Kekule.IO.MdlUtils.analysisMdlDateTimeStr(c,true)}b=e.readLine().trim();if(b){a.comment=b}return a},readSubstanceCountLine:function(a){},readMolBlock:function(a){},doReadBlock:function($super,a,c){var f=this.readHeaderBlock(a,null);var e=this.readSubstanceCountLine(a.readLine());var h=new Kekule.Reaction();var g="";for(var d=0;d<e.reactantCount;++d){var b=this.readMolBlock(a);if(b){h.appendReactant(b)}}for(var d=0;d<e.productCount;++d){var b=this.readMolBlock(a);if(b){h.appendProduct(b)}}if(h&&f){f.name?h.setName(f.name):null;f.userAbbr?h.setInfoValue("author",f.userAbbr):null;f.programName?h.setInfoValue("generator",f.programName):null;f.date?h.setInfoValue("date",f.date):null;f.comment?h.setInfoValue("comment",f.comment):null}return h}});Kekule.IO.Mdl2kReactionReader=Class.create(Kekule.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl2kReactionReader",readHeaderBlock:function($super,c,b){var a=$super(c,b);if(a.version!=Kekule.IO.MdlVersion.V2000){Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL2000_RXN_DATA"));return null}else{return a}},readSubstanceCountLine:function(b){var a={};a.reactantCount=parseInt(b.substr(0,3),10)||0;a.productCount=parseInt(b.substr(3,3),10)||0;return a},readMolBlock:function(c){var b=c.readLine();while((b!=="$MOL")&&(!c.eof())){b=c.readLine()}if(c.eof()){return null}var a=[];var b=c.getCurrLine();while((b!=="$MOL")&&(!c.eof())){a.push(b);c.incCurrLineNo();b=c.getCurrLine()}return(new Kekule.IO.MdlMoleculeReader()).readBlock(a,null)}});Kekule.IO.Mdl3kReactionReader=Class.create(Kekule.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl3kReactionReader",createTextBuffer:function(){return(new Kekule.IO.Mdl3kTextBuffer())},readHeaderBlock:function($super,c,b){var a=$super(c,b);if(a.version!=Kekule.IO.MdlVersion.V3000){Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL3000_RXN_DATA"));return null}else{return a}},readSubstanceCountLine:function(b){var a={};var c=Kekule.IO.Mdl3kValueUtils.splitValues(b);if(c.shift().value.trim()!="COUNTS"){Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL3000_RXN_COUNTLINE"));return null}a.reactantCount=parseInt(c.shift().value,10)||0;a.productCount=parseInt(c.shift().value,10)||0;return a},readMolBlock:function(b){if(b.getBlockBuffer){var a=b.getBlockBuffer("CTAB");return(new Kekule.IO.Mdl3kMoleculeCTabReader()).doReadBlock(a)}else{return null}}});Kekule.IO.MdlReactionReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlReactionReader",doReadBlock:function(d,c){var a;var b=Kekule.IO.MdlUtils.getRxnMarkVersion(d.getCurrLine());if(b==Kekule.IO.MdlVersion.V3000){a=new Kekule.IO.Mdl3kReactionReader()}else{a=new Kekule.IO.Mdl2kReactionReader()}return a.readBlock(d.getUnreadLines(),c)}});Kekule.IO.MdlReactionWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlReactionWriter",initialize:function($super,a,b){$super();this.setMdlVersion(a||Kekule.IO.MdlVersion.V2000);this.setCoordMode(b||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000});this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},writeHeaderBlock:function(d,g){var c;c="$RXN"+((this.getMdlVersion()==Kekule.IO.MdlVersion.V3000)?" "+Kekule.IO.MDL.VER3000:"");g.writeLine(c);g.writeLine(d.getName()||"");var b=d.getInfoValue("author")||"";c=b.substr(0,6).rpad(6);var e=d.getInfoValue("generator")||"";c+=e.substr(0,9).rpad(9);var a=d.getInfoValue("date")||new Date();c+=Kekule.IO.MdlUtils.generateMdlDateTimeStr(a,true);g.writeLine(c);var f=d.getInfoValue("comment")||"";g.writeLine(f)},generateSubstanceCountLine:function(a){if(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000){return"M  V30 COUNTS "+Kekule.IO.Mdl3kValueUtils.mergeValues([a.getReactantCount(),a.getProductCount()])}return a.getReactantCount().toString().lpad(3)+a.getProductCount().toString().lpad(3)},writeMolDelimiterLine:function(a){if(this.getMdlVersion()==Kekule.IO.MdlVersion.V2000){a.writeLine("$MOL")}},writeMolBlock:function(b,d){var a=this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kMoleculeCTabWriter(this.getCoordMode()):new Kekule.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode());var c=a.writeBlock(b);d.writeText(c)},doWriteBlock:function($super,c,e){var a=this.getMdlVersion()==Kekule.IO.MdlVersion.V3000;this.writeHeaderBlock(c,e);var d=this.generateSubstanceCountLine(c);e.writeLine(d);if(a){e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockStartTag("REACTANT"))}for(var b=0;b<c.getReactantCount();++b){this.writeMolDelimiterLine(e);this.writeMolBlock(c.getReactantAt(b),e)}if(a){e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockEndTag("REACTANT"))}if(a){e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockStartTag("PRODUCT"))}for(var b=0;b<c.getProductCount();++b){this.writeMolDelimiterLine(e);this.writeMolBlock(c.getProductAt(b),e)}if(a){e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockEndTag("PRODUCT"));e.writeLine("M  END")}}});Kekule.IO.BaseMdlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.BaseMdlReader",doReadData:function(b,a,c){if(a!=Kekule.IO.ChemDataType.TEXT){Kekule.error(Kekule.$L("ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT"));return null}else{return this.doReadMdlData(b)}},doReadMdlData:function(a){return null}});Kekule.IO.BaseMdlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.BaseMdlWriter",initialize:function($super,a){$super(a);if(!a){a={}}this.setMdlVersion(a.mdlVersion||Kekule.globalOptions.IO.mdl.mdlVersion);this.setCoordMode(a.coordMode||Kekule.globalOptions.IO.mdl.coordMode)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000});this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteData:function($super,d,b,c){var a=b||Kekule.IO.ChemDataType.TEXT;if(a!=Kekule.IO.ChemDataType.TEXT){Kekule.error(Kekule.$L("ErrorMsg.MDL_OUTPUT_DATATYPE_NOT_TEXT"));return null}else{return $super(d,a,c)}}});Kekule.IO.MdlMolReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlMolReader",doReadMdlData:function(b){var a=new Kekule.IO.MdlMoleculeReader();return a.readBlock(b,null)}});Kekule.IO.MdlMolWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlMolWriter",doWriteData:function(d,a,c){var b=new Kekule.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode());return b.writeBlock(d)}});Kekule.IO.MdlSdReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlSdReader",doReadMdlData:function(b){var a=new Kekule.IO.MdlStructDataReader();return a.readBlock(b,null)}});Kekule.IO.MdlSdWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlSdWriter",doWriteData:function(d,a,c){var b=new Kekule.IO.MdlStructDataWriter(this.getMdlVersion(),this.getCoordMode());return b.writeBlock(d)}});Kekule.IO.MdlRxnReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlRxnReader",doReadMdlData:function(b){var a=new Kekule.IO.MdlReactionReader();return a.readBlock(b,null)}});Kekule.IO.MdlRxnWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlRxnWriter",doWriteData:function(d,a,c){var b=new Kekule.IO.MdlReactionWriter(this.getMdlVersion(),this.getCoordMode());return b.writeBlock(d)}});Kekule.IO.MdlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.MdlReader",doReadData:function(d,c,e){if(c!=Kekule.IO.ChemDataType.TEXT){Kekule.error(Kekule.$L("ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT"));return null}else{var b;var a=d.substr(0,4);if(a=="$RXN"){b=new Kekule.IO.MdlReactionReader()}else{b=new Kekule.IO.MdlMoleculeReader()}return b.readBlock(d,null)}}});Kekule.IO.MdlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.MdlWriter",initialize:function($super,a){$super(a);var b=a||{};this.setMdlVersion(b.mdlVersion||Kekule.globalOptions.IO.mdl.mdlVersion);this.setCoordMode(b.coordMode||Kekule.globalOptions.IO.mdl.coordMode)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000});this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteData:function(e,a,d){var c;if(e instanceof Kekule.Reaction){c=new Kekule.IO.MdlRxnWriter(this.getMdlVersion(),this.getCoordMode())}else{if(e instanceof Kekule.StructureFragment){c=new Kekule.IO.MdlMolWriter(this.getMdlVersion(),this.getCoordMode())}else{var b=(e&&e.getClassName)?e.getClassName():typeof(e);Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_OUTPUT_AS_MDL").format(b));return null}}if(c){return c.writeData(e)}}});(function(){var d="mol";var c="rxn";var f="sd";var b="mol3k";var a="rxn3k";Kekule.IO.DataFormat.MOL=d;Kekule.IO.DataFormat.RXN=c;Kekule.IO.DataFormat.SD=f;Kekule.IO.DataFormat.MOL3K=b;Kekule.IO.DataFormat.RXN3K=a;Kekule.IO.MimeType.MDL_MOL="chemical/x-mdl-molfile";Kekule.IO.MimeType.MDL_RXN="chemical/x-mdl-rxnfile";Kekule.IO.MimeType.MDL_SD="chemical/x-mdl-sdfile";Kekule.IO.DataFormatsManager.register(d,Kekule.IO.MimeType.MDL_MOL,"mol",Kekule.IO.ChemDataType.TEXT,"MDL Mol 2000 format");Kekule.IO.DataFormatsManager.register(c,Kekule.IO.MimeType.MDL_RXN,"rxn",Kekule.IO.ChemDataType.TEXT,"MDL Reaction 2000 format");Kekule.IO.DataFormatsManager.register(f,Kekule.IO.MimeType.MDL_SD,["sd","sdf"],Kekule.IO.ChemDataType.TEXT,"MDL Structure-Data format");Kekule.IO.DataFormatsManager.register(b,Kekule.IO.MimeType.MDL_MOL,"mol",Kekule.IO.ChemDataType.TEXT,"MDL Mol 3000 format");Kekule.IO.DataFormatsManager.register(a,Kekule.IO.MimeType.MDL_RXN,"rxn",Kekule.IO.ChemDataType.TEXT,"MDL Reaction 3000 format");Kekule.IO.ChemDataReaderManager.register("MDL-mol",Kekule.IO.MdlMolReader,[d,b]);Kekule.IO.ChemDataReaderManager.register("MDL-rxn",Kekule.IO.MdlRxnReader,[c,a]);Kekule.IO.ChemDataReaderManager.register("MDL-general",Kekule.IO.MdlReader,[d,b,c,a]);Kekule.IO.ChemDataReaderManager.register("MDL-sd",Kekule.IO.MdlSdReader,f);var e=[Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.ChemDataWriterManager.register("MDL-mol",Kekule.IO.MdlMolWriter,e,d);Kekule.IO.ChemDataWriterManager.register("MDL-mol3k",Kekule.IO.MdlMolWriter,e,b,{createOptions:{mdlVersion:Kekule.IO.MdlVersion.V3000}});Kekule.IO.ChemDataWriterManager.register("MDL-rxn",Kekule.IO.MdlRxnWriter,[Kekule.Reaction],c);Kekule.IO.ChemDataWriterManager.register("MDL-rxn3k",Kekule.IO.MdlRxnWriter,[Kekule.Reaction],a);Kekule.IO.ChemDataWriterManager.register("MDL-sd",Kekule.IO.MdlSdWriter,e,f)})();(function(){var a=Kekule.ArrayUtils;Kekule.IO.SMILES={ATOM_BRACKET_LEFT:"[",ATOM_BRACKET_RIGHT:"]",ATOM_WILDCARD:"*",ATOM_H:"H",ORGAN_SUBSET_ATOMS:["B","C","N","O","S","P","F","Cl","Br","I"],AROMATIC_SUBSET_ATOMS:["B","C","N","O","S","P"],BOND_SINGLE:"-",BOND_DOUBLE:"=",BOND_TRIPLE:"#",BOND_QUAD:"$",BOND_AROMATIC:":",BOND_FAKE:".",RING_BOND_TWO_DIGIT_NO_PREFIX:"%",BRANCH_BRACKET_LEFT:"(",BRANCH_BRACKET_RIGHT:")",ROTATION_DIR_CLOCKWISE:"@@",ROTATION_DIR_ANTICLOCKWISE:"@",DIRECTION_BOND_SYMBOLS:["/","\\"]};var b=Kekule.IO.SMILES;Kekule.IO.SmilesUtils={createGraphDepthSpanningTreesEx:function(m,e){var k="__$visitedEx__";var p=function(s){var B={vertexes:[],edges:[],longestPath:{vertexes:[],edges:[],length:0}};var x=s;if(!x.getData(k)){B.vertexes.push(x);x.setData(k,true)}var u=x.getEdges();var y=[];var z;for(var v=0,t=u.length;v<t;++v){var r=u[v];var A=x.getNeighborOnEdge(r);if(!A.getData(k)){B.vertexes.push(A);B.edges.push(r);A.setData(k,true);var w=p(A);B.vertexes=B.vertexes.concat(w.vertexes);B.edges=B.edges.concat(w.edges);if(w.longestPath.length>B.longestPath.length||!B.longestPath.length){B.longestPath.vertexes=w.longestPath.vertexes;B.longestPath.edges=w.longestPath.edges;B.longestPath.length=w.longestPath.length;z=r}}}if(z){B.longestPath.edges.unshift(z);B.longestPath.length=(B.longestPath.length||0)+1}B.longestPath.vertexes.unshift(x);return B};var j=a.clone(m.getVertexes());for(var h=0,f=j.length;h<f;++h){j[h].setData(k,false)}var q=[];while(j.length){var g;if(e&&(j.indexOf(e)>=0)){g=e}else{g=j[0]}var n={vertexes:[],edges:[],longestPath:{vertexes:[],edges:[],length:0}};var o=p(g);n.vertexes=n.vertexes.concat(o.vertexes);n.edges=n.edges.concat(o.edges);n.longestPath.length=(n.longestPath.length||0)+o.longestPath.length;n.longestPath.vertexes=n.longestPath.vertexes.concat(o.longestPath.vertexes);n.longestPath.edges=n.longestPath.edges.concat(o.longestPath.edges);j=a.exclude(j,o.vertexes);q.push(n)}return q}};Kekule.IO.SmilesMolWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.SmilesMolWriter",doWriteData:function(i,e,h,f){var g=this.getMolecule(i);return g?this.writeStructFragment(g,f):""},getMolecule:function(e){return Kekule.ChemStructureUtils.getTotalStructFragment(e)},writeStructFragment:function(w,f){if(w.hasCtab()&&!w.isEmpty()){var e=w.clone();if(e.standardize){e.standardize()}var z=[];var s=[];if(e.getAromaticRings){var t=e.getAromaticRings();for(var u=0,q=t.length;u<q;++u){var h=t[u];a.pushUnique(z,h.nodes);a.pushUnique(s,h.connectors)}}var k=Kekule.GraphAdaptUtils.ctabToGraph(e.getCtab(),null,{expandSubStructures:true,ignoreBondedHydrogen:true});var g=k.getVertexes();var v=k.getEdges();var y=g[g.length-1];var j=Kekule.IO.SmilesUtils.createGraphDepthSpanningTreesEx(k,y);var o=[];var m;for(var u=0,q=j.length;u<q;++u){var p=j[u];var r=p.longestPath;var x="";var n=r.vertexes[0];x=this._writeMolVertex(n,null,r.edges,p.edges,o,z,s,f);if(u===0){m=x}else{m+=b.BOND_FAKE+x}}return m}else{return""}},_writeMolVertex:function(t,P,g,k,u,H,m,z){var E=t.getData("object");var p=t.getEdges();var j;var G=[];var I;var e=[];var R=[];var f=[];var n;var w="";var B=z.ignoreStereoBond;if(Kekule.ObjUtils.isUnset(B)){B=z.ignoreStereo||false}for(var L=p.length-1;L>=0;--L){var o=p[L];if(o===P){continue}var h=o.getData("object");if(!B&&h.getParity&&h.getParity()){var D=Kekule.MolStereoUtils.getStereoBondKeyNodes(h);if(D){var x=t.getNeighborOnEdge(o);var A=x.getData("object");var y=this._getStereoDoubleBondInitialDirectionSymbols(h);var K=y[0];if(D.indexOf(A)<0){K=this._getInvertBondDirectionSymbol(K)}}w=K}if(k.indexOf(o)>=0){var x=t.getNeighborOnEdge(o);var F=this._writeMolVertex(x,o,g,k,u,H,m,z);if(g.indexOf(o)>=0){I=x;j=F}else{e.push(x);G.push(F)}}else{var M=u.indexOf(o);if(M<0){M=u.length;u.push(o)}f.push(t.getNeighborOnEdge(o));var Q=this._outputConnectorStr(h,o.getVertexes()[0].getData("object"),o.getVertexes()[1].getData("object"),H,m);M=M+1;Q+=(M<10)?M:b.RING_BOND_TWO_DIGIT_NO_PREFIX+M;R.push(Q)}}var s="";var r;var q="";if(P){if(w){s+=w}var N=t.getNeighborOnEdge(P);r=N.getData("object");var O=P.getData("object");if(!B&&O.getParity&&O.getParity()){var D=Kekule.MolStereoUtils.getStereoBondKeyNodes(O);if(D){var y=this._getStereoDoubleBondInitialDirectionSymbols(O);var K=y[1];if(D.indexOf(r)<0){K=this._getInvertBondDirectionSymbol(K)}}q+=K}s+=this._outputConnectorStr(O,P.getVertexes()[0].getData("object"),P.getVertexes()[1].getData("object"),H,m)}var v=[];for(var L=0,J=f.length;L<J;++L){v.push(f[L].getData("object"))}for(var L=0,J=e.length;L<J;++L){v.push(e[L].getData("object"))}if(I){v.push(I.getData("object"))}s+=this._outputNodeStr(E,H.indexOf(E)>=0,r,v,z);for(var L=0,J=R.length;L<J;++L){s+=R[L]}if(!j&&G.length){j=G.shift()}for(var L=0,J=G.length;L<J;++L){s+=b.BRANCH_BRACKET_LEFT+G[L]+b.BRANCH_BRACKET_RIGHT}s+=q;if(j){s+=j}return s},_outputNodeStr:function(h,n,e,s,t){var u;var j;if(h instanceof Kekule.Atom){j=h.getSymbol();u=j;if(n){u=u.toLowerCase()}}else{u=b.ATOM_WILDCARD}var q=t.ignoreStereoAtom;if(Kekule.ObjUtils.isUnset(q)){q=t.ignoreStereo||false}var r;if(!q&&h.getParity&&h.getParity()){if(s&&s.length){var p=h.getLinkedHydrogenAtoms();if(p&&p.length===1&&s.indexOf(p[0])<0){s.push(p[0])}var l=h.getHydrogenCount?(h.getHydrogenCount(false)||0):0;if(p.length&&l){r=""}else{var g=Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirection(null,h,e,s,!!l,false,{allowExplicitVerticalHydrogen:true});var r=(g===Kekule.RotationDir.CLOCKWISE)?b.ROTATION_DIR_CLOCKWISE:(g===Kekule.RotationDir.ANTICLOCKWISE)?b.ROTATION_DIR_ANTICLOCKWISE:""}if(r){u+=r}}}var i;if(r){i=h.getHydrogenCount?(h.getHydrogenCount(true)||0):0}else{i=h.getExplicitHydrogenCount?h.getExplicitHydrogenCount():0;if(!i&&n&&(j!=="C")&&h.getImplicitHydrogenCount){i=h.getImplicitHydrogenCount()}}if(i){u+=b.ATOM_H;var l=Math.round(i);if(l>1){u+=l}}var m=Math.round(h.getCharge());if(m){var f=(m>0)?"+":"-";if(m>1||m<-1){f=Math.abs(m)+f}u+=f}var k=h.getMassNumber?h.getMassNumber():null;if(k){u=Math.abs(k)+u}var o=false;if(!i&&!m&&!k&&!r){if((!n&&b.ORGAN_SUBSET_ATOMS.indexOf(j)>=0)||(n&&b.AROMATIC_SUBSET_ATOMS.indexOf(j)>=0)){o=true}}if(!o){u=b.ATOM_BRACKET_LEFT+u+b.ATOM_BRACKET_RIGHT}return u},_outputConnectorStr:function(h,i,g,j,l){if(h instanceof Kekule.Bond){if(h.getBondType()===Kekule.BondType.COVALENT){if(l.indexOf(h)>=0){return""}else{var f=(j.indexOf(i)>=0)&&(j.indexOf(g)>=0);var e=h.getBondOrder();var k=Kekule.BondOrder;return(e===k.DOUBLE)?b.BOND_DOUBLE:(e===k.TRIPLE)?b.BOND_TRIPLE:(e===k.QUAD)?b.BOND_QUAD:f?b.BOND_SINGLE:""}}}return b.BOND_FAKE},_getStereoDoubleBondInitialDirectionSymbols:function(f){var e=f.getParity();if(e===Kekule.StereoParity.EVEN){return[b.DIRECTION_BOND_SYMBOLS[0],b.DIRECTION_BOND_SYMBOLS[0]]}else{return[b.DIRECTION_BOND_SYMBOLS[0],b.DIRECTION_BOND_SYMBOLS[1]]}},_getInvertBondDirectionSymbol:function(e){if(e===b.DIRECTION_BOND_SYMBOLS[1]){return b.DIRECTION_BOND_SYMBOLS[0]}else{return b.DIRECTION_BOND_SYMBOLS[1]}}});Kekule.IO.MimeType.SMILES="chemical/x-daylight-smiles";Kekule.IO.DataFormat.SMILES="smi";var d="smi";Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.SMILES,Kekule.IO.MimeType.SMILES,["smi","smiles"],Kekule.IO.ChemDataType.TEXT,"SMILES format");var c=[Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.ChemDataWriterManager.register("SMILES",Kekule.IO.SmilesMolWriter,c,[Kekule.IO.DataFormat.SMILES])})();Kekule.globalOptions.add("IO.kekuleNative",{prettyPrint:true});Kekule.IO.KcjReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcjReader",readData:function($super,c,b){var a=b||Kekule.IO.ChemDataType.TEXT;var d;if(a==Kekule.IO.ChemDataType.JSON){d=c}if(a==Kekule.IO.ChemDataType.TEXT){d=JsonUtility.parse(c)}else{Kekule.error(Kekule.$L("ErrorMsg.KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT"));return null}return $super(d,Kekule.IO.ChemDataType.JSON)},doReadData:function(c,a){var b=ObjSerializerFactory.getSerializer("json");if(!b){Kekule.error(Kekule.$L("ErrorMsg.JSON_SERIALIZER_NOT_EXISTS"));return null}return b.load(null,c)}});Kekule.IO.KcjWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcjWriter",initialize:function($super,a){$super(a);var b=a||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(b.prettyPrint)?Kekule.globalOptions.IO.kekuleNative.prettyPrint:b.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:true})},writeData:function($super,f,c,e,d){var b=c||Kekule.IO.ChemDataType.TEXT;if((b!=Kekule.IO.ChemDataType.JSON)&&(b!=Kekule.IO.ChemDataType.TEXT)){Kekule.error(Kekule.$L("ErrorMsg.KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT"));return null}var a=$super(f,Kekule.IO.ChemDataType.JSON);if(b==Kekule.IO.ChemDataType.JSON){return a}if(b==Kekule.IO.ChemDataType.TEXT){var g=(d&&Kekule.ObjUtils.notUnset(d.prettyPrint))?d.prettyPrint:this.getPrettyPrint();return JsonUtility.serializeToStr(a,{prettyPrint:g})}},doWriteData:function(e,a,d,b){var c=ObjSerializerFactory.getSerializer("json");if(!c){Kekule.error(Kekule.$L("ErrorMsg.JSON_SERIALIZER_NOT_EXISTS"));return null}var f={};c.save(e,f);return f}});Kekule.IO.KcxReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcxReader",readData:function($super,c,b){var a=b||Kekule.IO.ChemDataType.TEXT;var e;if(a==Kekule.IO.ChemDataType.DOM){e=c}if(a==Kekule.IO.ChemDataType.TEXT){var d=XmlUtility.parse(c);e=d.documentElement}else{Kekule.error(Kekule.$L("ErrorMsg.KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT"));return null}return $super(e,Kekule.IO.ChemDataType.DOM)},doReadData:function(c,a){var b=ObjSerializerFactory.getSerializer("xml");if(!b){Kekule.error(Kekule.$L("ErrorMsg.XML_SERIALIZER_NOT_EXISTS"));return null}return b.load(null,c)}});Kekule.IO.KcxWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcxWriter",initialize:function($super,a){$super(a);var b=a||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(b.prettyPrint)?Kekule.globalOptions.IO.kekuleNative.prettyPrint:b.prettyPrint);this.setRootTag(b.rootTag||"kcx")},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:true});this.defineProp("rootTag",{dataType:DataType.STRING})},writeData:function($super,e,c){var b=c||Kekule.IO.ChemDataType.TEXT;if((b!=Kekule.IO.ChemDataType.DOM)&&(b!=Kekule.IO.ChemDataType.TEXT)){Kekule.error(Kekule.$L("ErrorMsg.KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT"));return null}var a=$super(e,Kekule.IO.ChemDataType.DOM);if(b==Kekule.IO.ChemDataType.DOM){return a}if(b==Kekule.IO.ChemDataType.TEXT){var d={prettyPrint:this.getPrettyPrint()};return XmlUtility.serializeNode(a,d)}},doWriteData:function(d,a){var b=ObjSerializerFactory.getSerializer("xml");if(!b){Kekule.error(Kekule.$L("ErrorMsg.XML_SERIALIZER_NOT_EXISTS"));return null}var c=XmlUtility.newDocument(this.getRootTag());b.save(d,c.documentElement);return c.documentElement}});(function(){Kekule.IO.MimeType.KEKULE_JSON="chemical/x-kekule-json";Kekule.IO.MimeType.KEKULE_XML="chemical/x-kekule-xml";Kekule.IO.DataFormat.KEKULE_JSON="Kekule-JSON";Kekule.IO.DataFormat.KEKULE_XML="Kekule-XML";Kekule.IO.DataFormatsManager.register("JSON",Kekule.IO.MimeType.JSON,"json",Kekule.IO.ChemDataType.TEXT,"JSON format");Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.KEKULE_JSON,Kekule.IO.MimeType.KEKULE_JSON,"kcj",Kekule.IO.ChemDataType.TEXT,"Kekule Chemical JSON format");Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.KEKULE_XML,Kekule.IO.MimeType.KEKULE_XML,"kcx",Kekule.IO.ChemDataType.TEXT,"Kekule Chemical XML format");var b=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.JSON);var c=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.KEKULE_JSON);var a=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.KEKULE_XML);Kekule.IO.ChemDataReaderManager.register("json",Kekule.IO.KcjReader,b);Kekule.IO.ChemDataReaderManager.register("kcj",Kekule.IO.KcjReader,c);Kekule.IO.ChemDataReaderManager.register("kcx",Kekule.IO.KcxReader,a);Kekule.IO.ChemDataWriterManager.register("kcj",Kekule.IO.KcjWriter,[Kekule.ChemObject],c,{createOptions:{prettyPrint:!true}});Kekule.IO.ChemDataWriterManager.register("kcx",Kekule.IO.KcxWriter,[Kekule.ChemObject],a,{createOptions:{prettyPrint:true}})})();(function(){var b=Kekule;var c=Kekule.ChemStructureNodeLabels;var a=Kekule.CoordMode;ClassEx.extend(Kekule.ChemObject,{getDefCoordPos:function(e){return Kekule.Render.CoordPos.CENTER},getCoordPos:function(f){var e=(f===Kekule.CoordMode.COORD3D)?this.getPropStoreFieldValue("coordPos3D"):this.getPropStoreFieldValue("coordPos2D");if(Kekule.ObjUtils.isUnset(e)){e=this.getDefCoordPos(f)}return e},getOverrideRenderOptions:function(h){if(h&&h.length){var e={};for(var g=0,f=h.length;g<f;++g){e=Object.extend(e,h[g])}return e}return null},_appendOverrideRenderOptionItem:function(g,e){var h=this.getPropStoreFieldValue(e);if(!h){h=[];this.setPropStoreFieldValue(e,h)}var f=h.indexOf(g);if(f>=0){h.splice(f,1)}h.push(g);this.notifyPropSet(e,h);return this},_deleteOverrideRenderOptionItem:function(g,e){var h=this.getPropStoreFieldValue(e);if(!h){return}var f=h.indexOf(g);if(f>=0){h.splice(f,1);this.notifyPropSet(e,h)}return this},addOverrideRenderOptionItem:function(e){return this._appendOverrideRenderOptionItem(e,"overrideRenderOptionItems")},addOverrideRender3DOptionItem:function(e){return this._appendOverrideRenderOptionItem(e,"overrideRender3DOptionItems")},removeOverrideRenderOptionItem:function(e){return this._deleteOverrideRenderOptionItem(e,"overrideRenderOptionItems")},removeOverrideRender3DOptionItem:function(e){return this._deleteOverrideRenderOptionItem(e,"overrideRender3DOptionItems")},getOverriddenRenderOptions:function(){var f=this.getRenderOptions()||{};var e=f;var g=this.getOverrideRenderOptions(this.getOverrideRenderOptionItems());if(g){e=Object.extend(e,g)}return e},getOverriddenRender3DOptions:function(){var e=Object.create(this.getRender3DOptions()||null);var f=this.getOverrideRenderOptions(this.getOverrideRender3DOptionItems());if(f){e=Object.extend(e,f)}return e},setRenderOption:function(g,e){var f=this.getRenderOptions();if(!f){this.setRenderOptions({})}var f=this.getRenderOptions();if(f[g]!==e){f[g]=e;this.notifyPropSet("renderOptions",f)}},setRender3DOption:function(g,e){var f=this.getRender3DOptions();if(!f){this.setRender3DOptions({})}var f=this.getRender3DOptions();if(f[g]!==e){f[g]=e;this.notifyPropSet("render3DOptions",f)}},getRenderOption:function(g){var f=this.getOverriddenRenderOptions();var e=(f?f[g]:undefined);return e},getRender3DOption:function(g){var f=this.getOverriddenRender3DOptions();var e=(f?f[g]:undefined);return e},getCascadedRenderOption:function(i){var h=this.getOverriddenRenderOptions();var e=(h?h[i]:undefined);if(Kekule.ObjUtils.isUnset(e)){var f=this.getParent?this.getParent():null;var g=f&&f.getCascadedRenderOption?f.getCascadedRenderOption(i):undefined;e=g}return e},getCascadedRender3DOption:function(i){var h=this.getOverriddenRender3DOptions();var e=(h?h[i]:undefined);if(Kekule.ObjUtils.isUnset(e)){var f=this.getParent?this.getParent():null;var g=f&&f.getCascadedRender3DOption?f.getCascadedRender3DOption(i):undefined;e=g}return e},getBaseCoord:function(h,f){var i=this.getCoordPos(h);var e=this.getCoordOfMode?this.getCoordOfMode(h,f):null;if(e&&i!==Kekule.Render.CoordPos.CENTER){if(i===Kekule.Render.CoordPos.CORNER_TL){var g=this.getExposedContainerBox(h,f);var j={x:(g.x2-g.x1)/2,y:(g.y2-g.y1)/2};if(h===a.COORD3D){j.z=(g.z2-g.z1)/2}if(h===a.COORD3D){e=Kekule.CoordUtils.add(e,j)}else{e.x+=j.x;e.y-=j.y}}}return e},getBaseCoord2D:function(e){return this.getBaseCoord(Kekule.CoordMode.COORD2D,e)},getBaseCoord3D:function(e){return this.getBaseCoord(Kekule.CoordMode.COORD3D,e)},getAbsBaseCoord:function(h,f){var i=this.getCoordPos(h);var e=this.getAbsCoordOfMode?this.getAbsCoordOfMode(h,f):null;if(e&&i!==Kekule.Render.CoordPos.CENTER){if(i===Kekule.Render.CoordPos.CORNER_TL){var g=this.getExposedContainerBox(h,f);var j={x:(g.x2-g.x1)/2,y:(g.y2-g.y1)/2};if(h===a.COORD3D){j.z=(g.z2-g.z1)/2}if(h===a.COORD3D){e=Kekule.CoordUtils.add(e,j)}else{e.x+=j.x;e.y-=j.y}}}return e},getAbsBaseCoord2D:function(e){return this.getAbsBaseCoord(Kekule.CoordMode.COORD2D,e)},getAbsBaseCoord3D:function(e){return this.getAbsBaseCoord(Kekule.CoordMode.COORD3D,e)},setAbsBaseCoord:function(i,g,e){var h=this.getCoordPos(g);var k=Kekule.CoordUtils.clone(i);if(i&&h!==Kekule.Render.CoordPos.CENTER){if(h===Kekule.Render.CoordPos.CORNER_TL){var f=this.getExposedContainerBox(g,e);var j={x:(f.x2-f.x1)/2,y:(f.y2-f.y1)/2};if(g===a.COORD3D){j.z=(f.z2-f.z1)/2}if(g===a.COORD3D){k=Kekule.CoordUtils.substract(k,j)}else{k.x-=j.x;k.y+=j.y}}}if(this.setAbsCoordOfMode){this.setAbsCoordOfMode(k,g)}else{if(this.setCoordOfMode){this.setCoordOfMode(k,g)}}return this},setAbsBaseCoord2D:function(f,e){return this.setAbsCoordOfMode(f,Kekule.CoordMode.COORD2D,e)},setAbsBaseCoord3D:function(f,e){return this.setAbsCoordOfMode(f,Kekule.CoordMode.COORD3D,e)},getExposedAncestor:function(){var e=this.getParent();if(!e){return this}else{if(e.isExpanded()){return this}else{return e.getExposedAncestor()}}},isExposed:function(){var e=this.getParent();return(!e)||(e.isExpanded())},isExpanded:function(){return true},setExpanded:function(e){},getLinkedExposedObjs:function(){var e=[];for(var n=0,g=this.getLinkedConnectorCount();n<g;++n){var f=this.getLinkedConnectorAt(n);if(!f.isExposed()){continue}var o=f.getConnectedExposedObjs();for(var m=0,h=o.length;m<h;++m){if(o[m]!==this){Kekule.ArrayUtils.pushUnique(e,o[m])}}}return e},getExposedContainerBox:function(g,f){var e=this.getContainerBox(g,f);return e},getAllAutoScaleRefLengths:function(f,e){return[]},getAllContainingConnectors:function(){if(this.getAllChildConnectors){return this.getAllChildConnectors()}else{return[]}},getConnectorLengthMedian:function(g,f){var e=this.getAllContainingConnectors();return Kekule.ChemStructureUtils.getConnectorLengthMedian(e,g,f)}});ClassEx.defineProps(Kekule.ChemObject,[{name:"coordPos2D",dataType:DataType.INT,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getCoordPos(Kekule.CoordMode.COORD2D)}},{name:"coordPos3D",dataType:DataType.INT,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getCoordPos(Kekule.CoordMode.COORD3D)}},{name:"renderOptions",dataType:DataType.OBJECT},{name:"render3DOptions",dataType:DataType.OBJECT},{name:"overrideRenderOptionItems",dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC},{name:"overrideRender3DOptionItems",dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}]);ClassEx.extend(Kekule.ChemObjList,{getAllContainingConnectors:function(){var e=[];for(var g=0,f=this.getItemCount();g<f;++g){var h=this.getItemAt(g);if(h.getAllContainingConnectors){e=e.concat(h.getAllContainingConnectors())}}return e},getAllAutoScaleRefLengths:function(j,g){var e=[];for(var h=0,f=this.getItemCount();h<f;++h){var k=this.getItemAt(h);if(k.getAllAutoScaleRefLengths){e=e.concat(k.getAllAutoScaleRefLengths(j,g))}}return e},getExposedContainerBox:function(k,g){var e;var m=this.toArray();for(var h=0,f=m.length;h<f;++h){var n=m[h];if(!n.isExposed()){continue}var j=n.getExposedContainerBox?n.getExposedContainerBox(k,g):n.getContainerBox?n.getContainerBox(k,g):null;if(j){if(!e){e=Kekule.BoxUtils.clone(j)}else{e=Kekule.BoxUtils.getContainerBox(e,j)}}}return e}});Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ChemObjList);ClassEx.extend(Kekule.ChemSpaceElement,{getAllContainingConnectors:function(){return this.getChildren().getAllContainingConnectors()},getAllAutoScaleRefLengths:function(f,e){return this.getChildren().getAllAutoScaleRefLengths(f,e)}});ClassEx.extend(Kekule.ChemSpace,{getAllContainingConnectors:function(){return this.getRoot().getAllContainingConnectors()},getAllAutoScaleRefLengths:function(g,f){var e;if(this.getDefAutoScaleRefLength()){e=[this.getDefAutoScaleRefLength()]}else{e=this.getRoot().getAllAutoScaleRefLengths(g,f)}return e}});ClassEx.defineProps(Kekule.ChemObject,[{name:"defAutoScaleRefLength",dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC}]);ClassEx.extend(Kekule.BaseStructureConnector,{getBaseCoord:function(g,e){var n=Kekule.CoordMode;var p=null;var o=0;var m=(g===n.COORD2D)?{x:0,y:0}:{x:0,y:0,z:0};for(var j=0,f=this.getConnectedObjCount();j<f;++j){var h=this.getConnectedObjAt(j);var k=h.getBaseCoord?h.getBaseCoord(g,e):null;if(k){m=Kekule.CoordUtils.add(m,k);++o}}if(o){p=Kekule.CoordUtils.divide(m,o)}return p},getAbsBaseCoord:function(g,e){var n=Kekule.CoordMode;var p=null;var o=0;var m=(g===n.COORD2D)?{x:0,y:0}:{x:0,y:0,z:0};for(var j=0,f=this.getConnectedObjCount();j<f;++j){var h=this.getConnectedObjAt(j);var k=h.getAbsBaseCoord?h.getAbsBaseCoord(g,e):null;if(k){m=Kekule.CoordUtils.add(m,k);++o}}if(o){p=Kekule.CoordUtils.divide(m,o)}return p},getConnectedExposedObjs:function(){var j=this.getConnectedObjs();var e=[];for(var g=0,f=j.length;g<f;++g){var h=j[g].getExposedAncestor();if(e.indexOf(h)<0){e.push(h)}}return e},getLength:function(g,e){var i=this.getConnectedObjs();if(i.length!==2){return null}else{var h=i[0].getAbsBaseCoord?i[0].getAbsBaseCoord(g,e):null;var f=i[1].getAbsBaseCoord?i[1].getAbsBaseCoord(g,e):null;return Kekule.CoordUtils.getDistance(h,f)}},getLength2D:function(e){return this.getLength(Kekule.CoordMode.COORD2D,e)},getLength3D:function(e){return this.getLength(Kekule.CoordMode.COORD3D,e)}});ClassEx.extend(Kekule.ChemStructureConnector,{getAllAutoScaleRefLengths:function(f,e){return[this.getLength(f,e)]}});ClassEx.extend(Kekule.BaseStructureNode,{getBaseCoord:function(f,e){return this.getCoordOfMode(f,e)},getAbsBaseCoord:function(f,e){return this.getAbsCoordOfMode(f,e)},getExposedContainerBox:function(g,f){var e=this.getContainerBox(g,f);return e},getExposedContainerBox2D:function(f){var e=this.getExposedContainerBox(Kekule.CoordMode.COORD2D,f);e.width=e.x2-e.x1;e.height=e.y2-e.y1;return e},getExposedContainerBox3D:function(f){var e=this.getExposedContainerBox(Kekule.CoordMode.COORD3D,f);e.deltaX=e.x2-e.x1;e.deltaY=e.y2-e.y1;e.deltaZ=e.z2-e.z1;return e}});ClassEx.extend(Kekule.ChemStructureNode,{getDisplayRichText:function(l,j,e,h,m,f){var i=Kekule.Render;if(Kekule.ObjUtils.isUnset(j)){j=true}var n=i.RichTextUtils.create();var k;var g=this.getRenderOption("customLabel");if(g){k=i.RichTextUtils.strToRichText(g)}else{k=this.getCoreDisplayRichTextItem(l,j,e,h)}if(k){if(j){k=this.appendElectronStateDisplayText(k,h,m,f)}if(k){i.RichTextUtils.append(n,k);n.anchorItem=k}}return n},getCoreDisplayRichTextItem:function(h,g,e,f){return null},appendElectronStateDisplayText:function(l,f,m,e){var g=Kekule.Render;var h=this.getCharge();var i=this.getRadical();var j=g.ChemDisplayTextUtils.createElectronStateDisplayTextSection(h,i,f,m,e);if(j){var k=g.RichTextUtils.createGroup();g.RichTextUtils.append(k,l);g.RichTextUtils.append(k,j);k.charDirection=Kekule.Render.TextDirection.LTR;k.anchorItem=l;return k}else{return l}}});ClassEx.extend(Kekule.AbstractAtom,{getDisplayRichText:function($super,k,j,e,g,l,f){var h=Kekule.Render;if(!k){k=h.HydrogenDisplayLevel.DEFAULT}var m=$super(k,j,e,g,l,f);var i=0;switch(k){case h.HydrogenDisplayLevel.NONE:i=0;break;case h.HydrogenDisplayLevel.ALL:i=this.getHydrogenCount();break;case h.HydrogenDisplayLevel.EXPLICIT:i=this.getExplicitHydrogenCount();break;case h.HydrogenDisplayLevel.UNMATCHED_EXPLICIT:if(this.getImplicitHydrogenCount&&(this.getImplicitHydrogenCount()!==this.getExplicitHydrogenCount())){i=this.getExplicitHydrogenCount()}break}if(i){m=this.appendHydrogenDisplayText(m,i)}return m},appendHydrogenDisplayText:function(h,e){var f=Kekule.Render;if(e){if(e>1){var i=f.RichTextUtils.createGroup();i.charDirection=Kekule.Render.TextDirection.LTR;var g=f.RichTextUtils.appendText2(i,"H");f.RichTextUtils.appendText(i,e.toString(),{textType:f.RichText.SUB,refItem:g});f.RichTextUtils.append(h,i)}else{f.RichTextUtils.appendText(h,"H")}}return h}});ClassEx.extend(Kekule.Atom,{getCoreDisplayRichTextItem:function(l,i,e,g){var h=Kekule.Render;var m=h.RichTextUtils.createGroup();var k=this.getIsotopeAlias();var f=this.getSymbol();if(k||this.getSymbol()!==b.Element.UNSET_ELEMENT){var j;if(k&&Kekule.ChemStructureNodeLabels.ENABLE_ISOTOPE_ALIAS){j=h.RichTextUtils.createSection(this.getIsotopeAlias(),{charDirection:Kekule.Render.TextDirection.LTR});m=h.RichTextUtils.append(m,j);m.anchorItem=j}else{j=h.RichTextUtils.createSection(this.getSymbol(),{charDirection:Kekule.Render.TextDirection.LTR});m=h.RichTextUtils.append(m,j);m.anchorItem=j;if(this.getMassNumber()!==Kekule.Isotope.UNSET_MASSNUMBER){m=h.RichTextUtils.insertText(m,0,this.getMassNumber().toString(),{textType:h.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR,refItem:m.anchorItem});m.charDirection=Kekule.Render.TextDirection.LTR}}}else{m=h.RichTextUtils.appendText(m,(e&&e.getUnsetElement())||c.UNSET_ELEMENT)}return m}});ClassEx.extend(Kekule.Pseudoatom,{getCoreDisplayRichTextItem:function(k,h,f,g){var j=Kekule.Render;var i;var l=f;i=this.getLabel();if(!i){i=(l&&l.getUnsetElement())||c.UNSET_ELEMENT}var e=j.RichTextUtils.createSection(i,{charDirection:Kekule.Render.TextDirection.LTR});return e}});var d=function(i,f,e){var h=Kekule.Render;var g=Kekule.IsotopesDataUtil.getIsotopeIdDetail(f);var j;if(g.massNumber){j=h.RichTextUtils.appendText2(i,g.massNumber.toString(),{textType:Kekule.Render.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR})}var k=h.RichTextUtils.appendText2(i,g.symbol,{charDirection:Kekule.Render.TextDirection.LTR},e);if(j){j.refItem=k}i.charDirection=Kekule.Render.TextDirection.LTR;return i};ClassEx.extend(Kekule.VariableAtom,{getCoreDisplayRichTextItem:function(q,p,g,m){var o=Kekule.Render;var e=g;var r;if(this.isListEmpty()){r=o.RichTextUtils.strToRichText((e&&e.getVariableAtom())||c.VARIABLE_ATOM);r.charDirection=Kekule.Render.TextDirection.LTR;return r}var f=this.getAllowedIsotopeIds()||this.getDisallowedIsotopeIds();var k=this.isDisallowedList();r=o.RichTextUtils.createGroup();r.charDirection=Kekule.Render.TextDirection.LTR;if(k){r=o.RichTextUtils.appendText(r,e.getIsoListDisallowPrefix())}r=o.RichTextUtils.appendText(r,e.getIsoListLeadingBracket());if(f&&f.length){for(var n=0,j=f.length;n<j;++n){var h=f[n];if(h){if(n!=0){r=o.RichTextUtils.appendText(r,e.getIsoListDelimiter())}r=d(r,h,n==0)}}}r=o.RichTextUtils.appendText(r,e.getIsoListTailingBracket());return r}});ClassEx.extend(Kekule.StructureConnectionTable,{exposedNodesHasCoord2D:function(g){var f=this.getExposedNodes();for(var h=0,e=f.length;h<e;++h){if(f[h].hasCoord2D(g)){return true}}return false},exposedNodesHasCoord3D:function(g){var f=this.getExposedNodes();for(var h=0,e=f.length;h<e;++h){if(f[h].hasCoord3D(g)){return true}}return false},getExposedNodes:function(){var e=[];var h=this.getNodes();for(var j=0,f=h.length;j<f;++j){var k=h[j];if(k.getExposedNodes&&k.isExpanded()){var g=k.getExposedNodes();e=e.concat(g)}else{if(k.isExposed()){e.push(k)}}}return e},getExposedConnectors:function(){var e=this.getConnectors();var g=this.getNodes();for(var h=0,f=g.length;h<f;++h){var k=g[h];if(k.getConnectors&&k.isExpanded()){var j=k.getExposedConnectors();e=e.concat(j)}}return e},getExposedContainerBox:function(g,f){var e=this.getExposedNodes();if(e.length){return this.getNodesContainBox(e,g,f)}else{return null}},getExposedContainerBox2D:function(f){var e=this.getExposedContainerBox(Kekule.CoordMode.COORD2D,f);e.width=e.x2-e.x1;e.height=e.y2-e.y1;return e},getExposedContainerBox3D:function(f){var e=this.getExposedContainerBox(Kekule.CoordMode.COORD3D,f);e.deltaX=e.x2-e.x1;e.deltaY=e.y2-e.y1;e.deltaZ=e.z2-e.z1;return e},getConnectorLengthMedian:function(g,f){var e=this.getAllContainingConnectors();return Kekule.ChemStructureUtils.getConnectorLengthMedian(e,g,f)},getAllAutoScaleRefLengths:function(m,j){var h=this.getAllContainingConnectors();var e=[];for(var k=0,g=h.length;k<g;++k){var f=h[k];if(f&&f.getAllAutoScaleRefLengths){var n=f.getAllAutoScaleRefLengths(m,j);if(n){e=e.concat(n)}}}return e}});ClassEx.extend(Kekule.ContentBlock,{getDefCoordPos:function($super,e){if(e!==a.COORD3D){return Kekule.Render.CoordPos.CORNER_TL}else{return $super(e)}}});ClassEx.extend(Kekule.ChemMarker.ChemPropertyMarker,{getDefCoordPos:function($super,e){if(e!==a.COORD3D){return Kekule.Render.CoordPos.CENTER}else{return $super(e)}}});ClassEx.extend(Kekule.StructureFragment,{isExpanded:function(){var e=this.getOverriddenRenderOptions();return e?(!!e.expanded):false},setExpanded:function(e){this.setRenderOption("expanded",e)},getExposedNodes:function(){if(this.hasCtab()){return this.getCtab().getExposedNodes()}else{return[]}},getExposedConnectors:function(){if(this.hasCtab()){return this.getCtab().getExposedConnectors()}else{return[]}},exposedNodesHasCoord2D:function(e){if(this.hasCtab()){return this.getCtab().exposedNodesHasCoord2D(e)}else{return false}},exposedNodesHasCoord3D:function(e){if(this.hasCtab()){return this.getCtab().exposedNodesHasCoord3D(e)}else{return false}},getExposedContainerBox:function(g,e){if(this.hasCtab()){var f=this.getCtab().getExposedContainerBox(g,e);if(!f){f=this.getContainerBox(g,e)}return f}else{return this.getContainerBox(g,e)}},getConnectorLengthMedian:function(f,e){if(this.hasCtab()){return this.getCtab().getConnectorLengthMedian(f,e)}else{return null}},getAutoScaleRefLength:function(f,e){return this.getConnectorLengthMedian(f,e)},getAllAutoScaleRefLengths:function(f,e){if(this.hasCtab()){return this.getCtab().getAllAutoScaleRefLengths(f,e)}else{return null}}});ClassEx.extend(Kekule.SubGroup,{getCoreDisplayRichTextItem:function(l,j,e,f){var g=Kekule.Render;var i=null;var m=this.getAbbr();if(!m){if(this.getFormulaText()){i=Kekule.FormulaUtils.textToFormula(this.getFormulaText())}else{i=this.getFormula(false)||this.calcFormula()}if(!i||i.isEmpty()){m=(e&&e.getRgroup())||c.SUBGROUP}}var n;if(m){if(m.length<=3){n=g.RichTextUtils.createSection(m);n.charDirection=Kekule.Render.TextDirection.LTR}else{var h=this._indexOfFirstUppercaseLetter(m);if(h<0){h=0}n=g.RichTextUtils.createGroup();n.charDirection=Kekule.Render.TextDirection.LTR;if(h>0){k=g.RichTextUtils.createSection(m.substring(0,h));k.charDirection=Kekule.Render.TextDirection.INHERIT;n=g.RichTextUtils.append(n,k)}var k=g.RichTextUtils.createSection(m.charAt(h));n=g.RichTextUtils.append(n,k);n.anchorItem=k;if(h<m.length-1){k=g.RichTextUtils.createSection(m.substring(h+1));k.charDirection=Kekule.Render.TextDirection.INHERIT;n=g.RichTextUtils.append(n,k)}}}else{if(i){n=i.getDisplayRichText(j,e,f);var k=g.RichTextUtils.getFirstNormalTextSection(n);if(!k){k=n.items[0]}n.anchorItem=k}}return n},_indexOfFirstUppercaseLetter:function(h){for(var f=0,e=h.length;f<e;++f){var g=h.charAt(f);if(g>="A"&&g<="Z"){return f}}return -1},_autoSetSelfCoord:function(j,h){if(this._isAutoSettingSelfCoord){return}if(this.getCoordOfMode(j,h)){return}var m=this.getAnchorNodeCount();if(m<=0){return}this.beginUpdate();try{this._isAutoSettingSelfCoord=true;var f={};for(var k=0;k<m;++k){var g=this.getAnchorNodeAt(k);if(g._autoSetSelfCoord){g._autoSetSelfCoord(j,h)}var l=g.getAbsCoordOfMode(j,h);if(l){f=Kekule.CoordUtils.add(f,l)}}var n=Kekule.CoordUtils.divide(f,m);this.setAbsCoordOfMode(n,j);var e=this.getCoordOfMode(j)||{};var m=this.getNodeCount();for(var k=0;k<m;++k){var g=this.getNodeAt(k);var l=g.getCoordOfMode(j,h);if(l){l=Kekule.CoordUtils.substract(l,e);g.setCoordOfMode(l,j)}}}finally{this._isAutoSettingSelfCoord=false;this.endUpdate()}},doGetAbsCoord2D:function($super,e){this._autoSetSelfCoord(Kekule.CoordMode.COORD2D,e);return $super(e)},doGetAbsCoord3D:function($super,e){this._autoSetSelfCoord(Kekule.CoordMode.COORD3D,e);return $super(e)},doSetAbsCoord2D:function($super,e){this._autoSetSelfCoord(Kekule.CoordMode.COORD2D);return $super(e)},doSetAbsCoord3D:function($super,e){this._autoSetSelfCoord(Kekule.CoordMode.COORD3D);return $super(e)}});ClassEx.extend(Kekule.MolecularFormula,{getDisplayRichText:function(i,e,h,g,f){var j=Kekule.Render;if(Kekule.ObjUtils.isUnset(i)){i=true}return j.ChemDisplayTextUtils.formulaToRichText(this,i,null,h,e,g,f)},getDisplayText:function(g,e,f){var h=this.getDisplayRichText();return Kekule.Render.RichTextUtils.toText(h)}});ClassEx.extend(Kekule.Molecule,{afterInitialization:function(){this.setExpanded(true)}});ClassEx.extend(Kekule.CompositeMolecule,{getExposedContainerBox:function(m,g){var e=null;var j=this.getPropStoreFieldValue("subMolecules");if(j){for(var h=0,f=j.length;h<f;++h){var n=j[h];var k=n.getExposedContainerBox(m,g);if(k){if(!e){e=Kekule.BoxUtils.clone(k)}else{e=Kekule.BoxUtils.getContainerBox(e,k)}}}}return e},getAllAutoScaleRefLengths:function(m,h){var e=[];var k=this.getPropStoreFieldValue("subMolecules");if(k){for(var j=0,f=k.getItemCount();j<f;++j){var n=k.getObjAt(j);var g=n.getAllAutoScaleRefLengths(m,h);if(g){e=e.concat(g)}}}return e}})})();"use strict";Kekule.Render={};Kekule.Render.CoordSystem={CHEM:0,CONTEXT:1,SCREEN:2};Kekule.Render.RendererType={R2D:2,R3D:3};Kekule.Render.CoordPos={CENTER:0,CORNER_TL:21,DEFAULT:0};Kekule.Render.DEF_ATOM_ATOMIC_NUM=6;Kekule.Render.MoleculeDisplayType={SKELETAL:1,CONDENSED:2,DEFAULT:1};Kekule.Render.Molecule2DDisplayType=Kekule.Render.MoleculeDisplayType;Kekule.Render.NodeLabelDisplayMode={HIDDEN:-1,SHOWN:1,SMART:0,DEFAULT:0};Kekule.Render.HydrogenDisplayLevel={NONE:0,EXPLICIT:1,UNMATCHED_EXPLICIT:2,ALL:10,DEFAULT:1};Kekule.Render.TextDirection={DEFAULT:0,LTR:1,RTL:3,TTB:2,BTT:4,INHERIT:10};Kekule.Render.TextAlign={DEFAULT:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4,CENTER:5,LEADING:10,TRAILING:11,getAbsAlign:function(e,f){var c=e;var d=Kekule.Render.TextAlign;var b=Kekule.Render.TextDirection;if((e===d.LEADING)||(e===d.TRAILING)){var a=e==d.LEADING;switch(f){case b.RTL:c=a?d.RIGHT:d.LEFT;break;case b.TTB:c=a?d.TOP:d.BOTTOM;break;case b.BTT:c=a?d.BOTTOM:d.TOP;break;case b.LTR:default:c=a?d.LEFT:d.RIGHT;break}}return c}};Kekule.Render.BoxXAlignment={LEFT:0,RIGHT:1,CENTER:2};Kekule.Render.BoxYAlignment={TOP:0,BOTTOM:1,CENTER:2};Kekule.Render.TextBoxAlignmentMode={BOX:0,ANCHOR:1};Kekule.Render.BondRenderType={SINGLE:0,DOUBLE:1,TRIPLE:2,QUAD:3,DASHED:4,DASHED_DOUBLE:5,DASHED_TRIPLE:6,SOLID_DASH:7,ARROWED:8,ARROWED_INV:9,HASHED:10,BOLD:11,BOLD_DOUBLE:12,BOLD_TRIPLE:13,BOLD_QUAD:14,BOLD_DASH:16,WEDGED_SOLID:20,WEDGED_SOLID_INV:21,WEDGED_HOLLOW:22,WEDGED_HOLLOW_INV:23,WEDGED_HASHED:24,WEDGED_HASHED_INV:25,WEDGED_SOLID_BOTH:26,WEDGED_HOLLOW_BOTH:27,WAVY:30,SCISSORS_DOUBLE:40};Kekule.Render.ChargeMarkRenderType={NUM_WITH_SYMBOL:1,DEFAULT:1,CIRCLE_AROUND:3};Kekule.Render.Render3DGraphicQuality={EXTREME_LOW:1,LOW:2,MEDIUM:3,HIGH:4,EXTREME_HIGH:5};Kekule.Render.Molecule3DDisplayType={WIRE:31,STICKS:32,BALL_STICK:33,SPACE_FILL:34,DEFAULT:33};Kekule.Render.Bond3DRenderMode={NONE:0,WIRE:1,MULTI_WIRE:2,CYLINDER:3,MULTI_CYLINDER:4,isWireMode:function(a){var b=Kekule.Render.Bond3DRenderMode;return(a===b.WIRE)||(a===b.MULTI_WIRE)},isCylinderMode:function(a){var b=Kekule.Render.Bond3DRenderMode;return(a===b.CYLINDER)||(a===b.MULTI_CYLINDER)}};Kekule.Render.Bond3DSpliceMode={UNSPLIT:1,MID_SPLIT:2,WEIGHTING_SPLIT:3};Kekule.Render.Bond3DRenderType={SINGLE:1,DOUBLE:2,TRIPLE:3,DASH:-1,SOLID_DASH:-2};Kekule.Render.Node3DRenderMode={NONE:0,BALL:1,SPACE:2};Kekule.Render.MetaShapeType={POINT:0,CIRCLE:1,LINE:2,RECT:3,POLYLINE:11,POLYGON:10,SPHERE:101,CYLINDER:102,COMPOSITE:-1};Kekule.Render.BoundShapeType=Kekule.Render.MetaShapeType;Kekule.Render.ObjectUpdateType={MODIFY:0,ADD:1,REMOVE:2,CLEAR:3};Kekule.Render.AbstractRenderer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.AbstractRenderer",RENDER_CACHE_FIELD:"__$renderCache$__",initialize:function($super,c,a,b){$super();this.setPropValue("chemObj",c,true);if(b){this.setParent(b)}this.setDrawBridge(a);this.setBubbleEvent(true);this._suspendUpdateStatus=0;this._suspendUpdateInfos=[]},finalize:function($super){this.setPropValue("chemObj",null,true);this.setDrawBridge(null);$super()},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,setter:null});this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:false});this.defineProp("parent",{dateType:DataType.OBJECT,serializable:false});this.defineProp("parentRenderer",{dateType:"Kekule.Render.AbstractRenderer",serializable:false,getter:function(){var a=this.getParent();return(a instanceof Kekule.Render.AbstractRenderer)?a:null},setter:function(a){this.setParent(a)}});this.defineProp("redirectContext",{dataType:DataType.OBJECT,serializable:false});this.defineProp("canModifyTargetObj",{dataType:DataType.BOOL,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("canModifyTargetObj");if(Kekule.ObjUtils.isUnset(a)){var b=this.getParent();if(b&&b.getCanModifyTargetObj){a=b.getCanModifyTargetObj()}}return a}});this.defineEvent("clear");this.defineEvent("updateBasicDrawObject")},isRootRenderer:function(){return !this.getParentRenderer()},getHigherLevelObj:function(){return this.getParent()},getRendererType:function(){return Kekule.Render.RendererType.R2D},getCoordMode:function(){var a=this.getRendererType();return(a===Kekule.Render.RendererType.R3D)?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D},getRenderCache:function(b){var a=this.getExtraProp(b,this.RENDER_CACHE_FIELD);if(!a){a={};this.setExtraProp(b,this.RENDER_CACHE_FIELD,a)}return a},beginDraw:function(d,e,c){var a=this.getDrawBridge();if(a.prepareContext){a.prepareContext(d)}},endDraw:function(d,e,c){var a=this.getDrawBridge();if(a.renderContext){a.renderContext(d)}},updateDrawInfoInCache:function(f,c,d,b,a){var e=this.getRenderCache(c);if(c){e.context=c}if(d){e.baseCoord=d}if(f){e.chemObj=f}if(b){e.options=b}if(a){e.realDrawOptions=a}},_isCurrChemObjNeedToBeDrawn:function(d,c){var f=this.getChemObj();for(var b=0,a=d.length;b<a;++b){var e=d[b];if((e===f)||(e.isChildOf(f))){return true}}return false},getAutoBaseCoord:function(a){return this.doGetAutoBaseCoord(a)},doGetAutoBaseCoord:function(a){return null},getCachedDrawOptions:function(a){return this.getRenderCache(a).options},getCachedDrawnElem:function(a){return this.getRenderCache(a).drawnElem},draw:function(b,i,m){try{this.__isDrawing=true;var d={};var c;var j=this.getParentRenderer();if(j){var c=j.getRenderCache().options}if(c){d=Object.create(c);d=Object.extend(d,m)}else{d=Object.create(m||null)}var k=this.getChemObj();var a=d.partialDrawObjs;if(a&&(!this._isCurrChemObjNeedToBeDrawn(a,b))){return null}var g=(this.getRendererType()===Kekule.Render.RendererType.R3D)?"getRender3DOptions":"getRenderOptions";var h=k[g]?k[g]():null;g=(this.getRendererType()===Kekule.Render.RendererType.R3D)?"getOverriddenRender3DOptions":"getOverriddenRenderOptions";var e=k[g]?k[g]():null;d=Kekule.Render.RenderOptionUtils.mergeRenderOptions(h||{},d);this.getRenderCache().options=d;d=Kekule.Render.RenderOptionUtils.mergeRenderOptions(e||{},d);this.updateDrawInfoInCache(this.getChemObj(),b,i,m,d);var f=this.isRootRenderer();this.invokeEvent("prepareDrawing",{context:b,obj:this.getChemObj()});if(f){this.beginDraw(b,i,d)}var l=this.doDraw(b,i,d);this.getRenderCache(b).drawnElem=l;if(f){this.endDraw(b,i,d)}this.invokeEvent("draw",{context:b,obj:this.getChemObj()})}finally{this.__isDrawing=false}return l},doDraw:function(b,c,a){return this.doDrawSelf(b,c,a)},doDrawSelf:function(b,c,a){return null},redraw:function(d){var c=this.isRootRenderer();if(c){var b=this.getRenderCache(d)||{};this.beginDraw(d,b.baseCoord,b.options)}var a=this.doRedraw(d);this.getRenderCache(d).drawnElem=a;if(c){this.endDraw(d,b.baseCoord,b.options)}return a},doRedraw:function(a){var b=this.getRenderCache(a);return this.draw(a,b.baseCoord,b.options)},canModifyGraphic:function(c){var a=this.getDrawBridge();return a.canModifyGraphic?a.canModifyGraphic(c):false},beginUpdateRenderer:function(){++this._suspendUpdateStatus},endUpdateRenderer:function(){--this._suspendUpdateStatus;if(this._suspendUpdateStatus<=0){this._suspendUpdateStatus=0}if(!this.isUpdatingRenderer()){this.doEndUpdateRenderer()}},doEndUpdateRenderer:function(){this.updateEx(this._suspendUpdateInfos);this._suspendUpdateInfos=[]},isUpdatingRenderer:function(){return this._suspendUpdateStatus>0},updateEx:function(o){var q;var s=true;if(!this.isUpdatingRenderer()){q=this.canModifyGraphic(c);if(q){for(var n=0,f=o.length;n<f;++n){var d=o[n];var c=d.context;for(var h=0,g=d.items.length;h<g;++h){var r=d.items[h];s=s&&this.doUpdate(c,r.updatedObjDetails,r.updateType);if(!s){break}}if(!s){break}}}else{var e=this.isRootRenderer();if(e){var m=[];for(var n=0,f=o.length;n<f;++n){var d=o[n];var c=d.context;Kekule.ArrayUtils.pushUnique(m,c)}for(var n=0,f=m.length;n<f;++n){this.getDrawBridge().clearContext(c);var a=this.getRenderCache(c);this.draw(c,a.baseCoord,a.options)}return true}else{var b=this.getParentRenderer();return b.updateEx(o)}}return s}else{if(!this._suspendUpdateInfos){this._suspendUpdateInfos=[]}this._mergeRendererUpdateInfo(this._suspendUpdateInfos,o);return true}},_mergeRendererUpdateInfo:function(d,g){for(var e=0,b=g.length;e<b;++e){var f=g[e];var c=this._indexOfContextInRendererUpdateInfos(f.context,d);if(c<0){d.push(f)}else{var a=d[c];a.items=a.items.concat(f.items)}}return d},_indexOfContextInRendererUpdateInfos:function(c,e){for(var b=0,a=e.length;b<a;++b){var d=e[b];if(d.context===c){return b}}return -1},update:function(d,g,b){var e=[];for(var c=0,a=g.length;c<a;++c){var f=g[c].obj;if(this.isChemObjRenderedBySelf(d,f)){e.push(g[c])}}if(e.length){return this.updateEx([{context:d,items:[{updateType:b,updatedObjDetails:e}]}])}else{return true}},doUpdate:function(c,b,a){return this.doUpdateSelf(c,b,a)},doUpdateSelf:function(c,h,k){var a=false;if(this.canModifyGraphic(c)){var d=false;var j=this.getChemObj();for(var f=0,e=h.length;f<e;++f){var g=h[f];if(g.obj===j){d=true;break}}if(d){if(k===Kekule.Render.ObjectUpdateType.CLEAR){return this.doClear(c)}else{this.doClear(c);var b=this.getRenderCache(c);return this.draw(c,b.baseCoord,b.options)}}}return a},_extractObjsOfUpdateObjDetails:function(a){return Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(a)},_createUpdateObjDetailsFromObjs:function(a){return Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(a)},addNew:function(c,a){var b=this._createUpdateObjDetailsFromObjs(a);return this.update(c,b,Kekule.Render.ObjectUpdateType.ADD)},modify:function(a,b){return this.update(a,b,Kekule.Render.ObjectUpdateType.MODIFY)},remove:function(b,c){var a=this._createUpdateObjDetailsFromObjs(c);return this.update(b,a,Kekule.Render.ObjectUpdateType.REMOVE)},clear:function(b){var a=this.doClear(b);this.invokeEvent("clear",{context:b,obj:this.getChemObj()})},doClear:function(a){if(this.canModifyGraphic()){return this.doClearSelf(a)}else{return false}},doClearSelf:function(a){if(this.canModifyGraphic()){var b=this.getRenderCache(a).drawnElem;if(b){try{this.getDrawBridge().removeDrawnElem(a,b)}catch(c){}}this.getRenderCache(a).drawnElem=null}else{return false}},estimateObjBox:function(c,b,a){var d=this.doEstimateObjBox(c,b,a);if(d){d=this._fillBoxDefaultValue(d,this.getRendererType())}return d},doEstimateObjBox:function(c,b,a){return this.doEstimateSelfObjBox(c,b,a)},doEstimateSelfObjBox:function(c,b,a){return null},estimateRenderBox:function(c,e,b,a){var d=this.doEstimateRenderBox(c,e,b,a);if(d){d=this._fillBoxDefaultValue(d,this.getRendererType())}return d},doEstimateRenderBox:function(c,d,b,a){return null},_fillBoxDefaultValue:function(d,a){if(!d){d={}}var c=a===Kekule.Render.RendererType.R3D;var b={x1:d.x1||0,x2:d.x2||0,y1:d.y1||0,y2:d.y2||0};if(c){b.z1=d.z1||0;b.z2=d.z2||0}return b},transformCoordToObj:function(a,c,b){return this.doTransformCoordToObj(a,c,b)},doTransformCoordToObj:function(a,c,b){return b},transformCoordToContext:function(a,c,b){return this.doTransformCoordToContext(a,c,b)},doTransformCoordToContext:function(a,c,b){return b},transformContextCoordToScreen:function(a,b){return this.doTransformContextCoordToScreen(a,b)},doTransformContextCoordToScreen:function(c,d){var a=this.getDrawBridge();return(a&&a.transformContextCoordToScreen)?a.transformContextCoordToScreen(c,d):d},basicDrawObjectUpdated:function(c,e,d,b,a){this.invokeEvent("updateBasicDrawObject",{context:c,obj:e,parentObj:d,boundInfo:b,updateType:a})},isChemObjRenderedBySelf:function(a,b){return(b===this.getRenderCache(a).chemObj)},isChemObjRenderedDirectlyBySelf:function(a,b){if(b&&this.getRenderCache(a).chemObj){return(b===this.getRenderCache(a).chemObj)}else{return false}},createBoundInfo:function(a,c,b){return Kekule.Render.MetaShapeUtils.createShapeInfo(a,c,b)},createPointBoundInfo:function(a){return this.createBoundInfo(Kekule.Render.BoundShapeType.POINT,[a])},createCircleBoundInfo:function(b,a){return this.createBoundInfo(Kekule.Render.BoundShapeType.CIRCLE,[b],{radius:a})},createLineBoundInfo:function(c,b,a){return this.createBoundInfo(Kekule.Render.BoundShapeType.LINE,[c,b],{width:a})},createRectBoundInfo:function(b,a){return this.createBoundInfo(Kekule.Render.BoundShapeType.RECT,[b,a])},createSphereBoundInfo:function(b,a){return this.createBoundInfo(Kekule.Render.BoundShapeType.SPHERE,[b],{radius:a})},createCylinderBoundInfo:function(c,b,a){return this.createBoundInfo(Kekule.Render.BoundShapeType.CYLINDER,[c,b],{radius:a})}});Kekule.ClassDefineUtils.addExtraObjMapSupport(Kekule.Render.AbstractRenderer);Kekule.Render.DummyRenderer=Class.create(Kekule.Render.AbstractRenderer,{CLASS_NAME:"Kekule.Render.DummyRenderer",draw:function(b,c,a){return},redraw:function(a){return}});Kekule.Render.CompositeRenderer=Class.create(Kekule.Render.AbstractRenderer,{CLASS_NAME:"Kekule.Render.CompositeRenderer",initProperties:function(){this.defineProp("targetChildObjs",{dataType:DataType.ARRAY,serializable:false});this.defineProp("childRendererMap",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("childRendererMap");if(!a){a=new Kekule.MapEx(true);this.setPropStoreFieldValue("childRendererMap",a)}return a}})},finalize:function($super){this.reset();$super()},doEstimateObjBox:function($super,c,k,e){var m=$super(c,k,e);var d=this.prepareChildRenderers();var g=Kekule.BoxUtils;for(var h=0,f=d.length;h<f;++h){var a=d[h];if(a){var j=a.estimateObjBox(c,k,e);if(j){if(!m){m=g.clone(j)}else{m=g.getContainerBox(m,j)}}}}return m},isChemObjRenderedBySelf:function($super,b,d){var h=$super(b,d);if(!h){var g=this.getChildRenderers();for(var e=0,c=g.length;e<c;++e){var a=g[e];if(a.isChemObjRenderedBySelf(b,d)){return true}}}if(!h){this.refreshChildObjs();var f=this.getTargetChildObjs();h=(f&&f.indexOf(d)>=0)}return h},isChemObjRenderedDirectlyBySelf:function($super,a,b){return $super(a,b)},doSetRedirectContext:function($super,d){$super(d);var b=this.getChildRenderers();if(b&&b.length){for(var c=0,a=b.length;c<a;++c){b[c].setRedirectContext(d)}}},getChildObjs:function(){var a=this.getChemObj();if(a&&a.getAttachedMarkers){return[].concat(a.getAttachedMarkers()||[])}else{return[]}},prepareChildObjs:function(){var a=this.getTargetChildObjs();if(a){return a}this.setTargetChildObjs(this.getChildObjs());return this.getTargetChildObjs()},refreshChildObjs:function(){this.setTargetChildObjs(null);this.prepareChildObjs()},getChildRenderers:function(){return this.getChildRendererMap().getValues()},getRendererForChild:function(g,f){var b=(this.getRendererType()===Kekule.Render.RendererType.R3D)?Kekule.Render.get3DRendererClass:Kekule.Render.get2DRendererClass;var e=this.getChildRendererMap();var a=e.get(g);if(!a&&f){var d=b(g)||Kekule.Render.DummyRenderer;var a=d?new d(g,this.getDrawBridge(),this):null;e.set(g,a);a.setRedirectContext(this.getRedirectContext())}return a},prepareChildRenderers:function(){var g=this.getChildRendererMap();var d=this.prepareChildObjs()||[];var c=g.getKeys();for(var b=0,a=c.length;b<a;++b){var e=c[b];if(d.indexOf(e)<0){g.remove(e)}}for(var b=0,a=d.length;b<a;++b){var f=d[b];this.getRendererForChild(f,true)}return g.getValues()},releaseChildRenderers:function(){var d=this.getChildRendererMap();var b=d.getValues();if(!b){return}for(var c=0,a=b.length;c<a;++c){b[c].finalize()}d.clear()},hasChildRenderers:function(){var b=this.getChildRendererMap().getValues();var a=b&&b.length;return a},prepare:function(){this.prepareChildObjs();this.prepareChildRenderers()},reset:function(){this.setTargetChildObjs(null);this.releaseChildRenderers()},_needWholelyDraw:function(b,a){var c=this.getChemObj();return !b||b.indexOf(c)>=0},doDraw:function($super,c,d,b){this.refreshChildObjs();this.prepareChildRenderers();var f=Object.create(b);if(b.partialDrawObjs&&this._needWholelyDraw(b.partialDrawObjs,c)){f.partialDrawObjs=null}if(!this.getTargetChildObjs().length){return $super(c,d,f)}else{var a=this.doDrawSelf(c,d,f);var e=this.doDrawChildren(c,d,f);if(a){this.addToDrawGroup(a,e)}return e}},doDrawChildren:function(b,g,k){var j=this.createDrawGroup(b);var h=this.getChildRenderers();var c=Object.create(k);this.getRenderCache(b).childDrawOptions=c;for(var f=0,e=h.length;f<e;++f){var a=h[f];var g=null;var d=a.draw(b,g,c);if(j&&d){this.addToDrawGroup(d,j)}}return j},doClear:function($super,a){$super(a);if(this.hasChildRenderers()){this.doClearChildren(a)}return true},doClearChildren:function(d){var b=this.getChildRendererMap().getValues();for(var c=0,a=b.length;c<a;++c){if(b[c]){b[c].clear(d)}}},doUpdate:function($super,c,b,a){this.refreshChildObjs();$super(c,b,a);if(this.getTargetChildObjs().length){this.doUpdateChildren(c,b,a)}return true},doUpdateChildren:function(b,A,g){var B=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(A);var d=this.getTargetChildObjs()||[];var a=this.getChildRendererMap();var f=Kekule.ArrayUtils.toArray(B);var n=new Kekule.MapEx(false);var D=[];var E=false;for(var w=0,t=f.length;w<t;++w){var m=f[w];if(this.isChemObjRenderedDirectlyBySelf(b,m)){E=true}}if(E){this.doClear(b);this.redraw(b);return true}for(var w=0,t=f.length;w<t;++w){var m=f[w];var s=a.get(m);if(s){if(g===Kekule.Render.ObjectUpdateType.REMOVE){s.clear();a.remove(m)}else{Kekule.ArrayUtils.pushUnique(D,s);z=[m];n.set(s,z)}}else{var e=this._getRenderersForChildObj(b,m);if(!e.length){if(d.indexOf(m)>=0){var p=this.getRendererForChild(m,true);var c=p.draw(b,null,this.getRenderCache(b).childDrawOptions);if(c){var y=this.getCachedDrawnElem(b);if(y){this.addToDrawGroup(c,y)}}}}for(var v=0,u=e.length;v<u;++v){var s=e[v];var z=n.get(s);if(!z){D.push(s);z=[];n.set(s,z)}z.push(m)}}}var h=true;for(var w=0,t=D.length;w<t;++w){var s=D[w];var q=n.get(s);var x=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(q);var p=s.update(b,x,g);h=h&&p}return h},_getRenderersForChildObj:function(e,g){var a=[];var c=this.getChildRenderers();for(var d=0,b=c.length;d<b;++d){var f=c[d];if(f.isChemObjRenderedBySelf(e,g)){a.push(f)}}return a}});Kekule.Render.Renderer2DFactory=Kekule.FactoryUtils.createSimpleFactory(Kekule.FactoryUtils.MATCH_BY_CLASS);Kekule.Render.get2DRendererClass=function(b){var a=(b instanceof ObjectEx)?b.getClass():b;return Kekule.Render.Renderer2DFactory.getClass(a)};Kekule.Render.Renderer3DFactory=Kekule.FactoryUtils.createSimpleFactory(Kekule.FactoryUtils.MATCH_BY_CLASS);Kekule.Render.get3DRendererClass=function(b){var a=(b instanceof ObjectEx)?b.getClass():b;return Kekule.Render.Renderer3DFactory.getClass(a)};Kekule.Render.DrawBridgeManager=Class.create({CLASS_NAME:"Kekule.Render.DrawBridgeManager",initialize:function(){this._items=[];this._preferredItem=null},_indexOfBridgeClass:function(d){for(var b=0,a=this._items.length;b<a;++b){var c=this._items[b];if(c.bridgeClass===d){return b}}return -1},_sortItems:function(){this._items.sort(function(b,a){return(b.priorityLevel||0)-(a.priorityLevel||0)})},_reselectPreferred:function(){this._sortItems();for(var a=this._items.length-1;a>=0;--a){var b=this._items[a];if(b.isSupported){this._preferredItem=b;return b}}this._preferredItem=null;return null},register:function(d,a){if(!a){a=0}var b=this._indexOfBridgeClass(d);var c;if(b>=0){c=this._items[b];c.priorityLevel=a}else{c={bridgeClass:d,priorityLevel:a};c.isSupported=d.isSupported?d.isSupported():false;this._items.push(c)}this._sortItems();if((!this._preferredItem)||(this._preferredItem.priorityLevel<a)){if(c.isSupported){this._preferredItem=c}}return c},unregister:function(c){var b=null;var a=this._indexOfBridgeClass(c);if(a>=0){b=this._items[a];this._items.splice(a,1);if(b===this._preferredItem){this._reselectPreferred()}}return b},getPreferredBridgeClass:function(){return(this._preferredItem)?this._preferredItem.bridgeClass:null},getPreferredBridgeInstance:function(){var a=this.getPreferredBridgeClass();if(a){return new a()}else{return null}}});Kekule.Render.DrawBridge2DMananger=new Kekule.Render.DrawBridgeManager();Kekule.Render.DrawBridge3DMananger=new Kekule.Render.DrawBridgeManager();(function(){var d=Kekule.Render;d.atomColorSets={jmol:["#000099","#FFFFFF","#D9FFFF","#CC80FF","#C2FF00","#FFB5B5","#909090","#3050F8","#FF0D0D","#90E050","#B3E3F5","#AB5CF2","#8AFF00","#BFA6A6","#F0C8A0","#FF8000","#FFFF30","#1FF01F","#80D1E3","#8F40D4","#3DFF00","#E6E6E6","#BFC2C7","#A6A6AB","#8A99C7","#9C7AC7","#E06633","#F090A0","#50D050","#C88033","#7D80B0","#C28F8F","#668F8F","#BD80E3","#FFA100","#A62929","#5CB8D1","#702EB0","#00FF00","#94FFFF","#94E0E0","#73C2C9","#54B5B5","#3B9E9E","#248F8F","#0A7D8C","#006985","#C0C0C0","#FFD98F","#A67573","#668080","#9E63B5","#D47A00","#940094","#429EB0","#57178F","#00C900","#70D4FF","#FFFFC7","#D9FFC7","#C7FFC7","#A3FFC7","#8FFFC7","#61FFC7","#45FFC7","#30FFC7","#1FFFC7","#00FF9C","#00E675","#00D452","#00BF38","#00AB24","#4DC2FF","#4DA6FF","#2194D6","#267DAB","#266696","#175487","#D0D0E0","#FFD123","#B8B8D0","#A6544D","#575961","#9E4FB5","#AB5C00","#754F45","#428296","#420066","#007D00","#70ABFA","#00BAFF","#00A1FF","#008FFF","#0080FF","#006BFF","#545CF2","#785CE3","#8A4FE3","#A136D4","#B31FD4","#B31FBA","#B30DA6","#BD0D87","#C70066","#CC0059","#D1004F","#D90045","#E00038","#E6002E","#EB0026","#000000","#000000"],cpk2D:["#000000","#000000","#FFC0CB","#B22222",null,"#00FF00","#000000","#8F8FFF","#F00000","#DAA520",null,"#0000FF","#228B22","#808090","#DAA520","#FFA500","#FFC832","#00FF00",null,"#0000FF","#808090","#808090","#808090","#808090","#808090","#808090","#FFA500","#A52A2A","#A52A2A","#A52A2A","#A52A2A"]};var b=d.atomColorSets.cpk2D;var c=d.atomColorSets.jmol;b[35]="#A52A2A";b[47]="#808090";b[53]="#A020F0";b[56]="#FFA500";b[79]="#DAA520";b.SubGroup=c.SubGroup="#0000CC";d.atom3DColors=Kekule.Render.atomColorSets.jmol;d.atom2DColors=Kekule.Render.atomColorSets.cpk2D;d.atomColors=[];d.atomColors[d.RendererType.R2D]=d.atom2DColors;d.atomColors[d.RendererType.R3D]=d.atom3DColors})();Kekule.Render.RichText={SECTION:"section",GROUP:"group",LINES:"lines",SUP:"superscript",SUB:"subscript",NORMAL:"normal"};Kekule.Render.RichTextUtils={STYLE_PROPS:["fontSize","fontFamily","fontWeight","fontStyle","color","opacity"],create:function(){return Kekule.Render.RichTextUtils.createGroup()},createGroup:function(d,b){var a={role:d||"group",items:[]};if(b){for(var c in b){if(b.hasOwnProperty(c)){a[c]=b[c]}}}return a},createSection:function(d,a){var c={text:d};if(a){for(var b in a){if(a.hasOwnProperty(b)){c[b]=a[b]}}}return c},strToRichText:function(h,f){if(!h){h=""}var g=Kekule.Render.RichTextUtils;var d=h.split("\n");if(d.length<=1){return Kekule.Render.RichTextUtils.appendText(g.create(),h,f)}else{var a=g.createGroup(Kekule.Render.RichText.LINES);for(var e=0,c=d.length;e<c;++e){var b=d[e]||"\u00a0";g.appendText(a,b,f)}return a}},insertText:function(e,b,f,c,a){var d=Kekule.Render.RichTextUtils.createSection(f,c);e.items.splice(b,0,d);if(a){e.anchorItem=d}return e},appendText:function(d,e,b,a){var c=Kekule.Render.RichTextUtils.createSection(e,b);d.items.push(c);if(a){d.anchorItem=c}return d},appendText2:function(d,e,b,a){var c=Kekule.Render.RichTextUtils.createSection(e,b);d.items.push(c);if(a){d.anchorItem=c}return c},insert:function(c,a,b){c.items.splice(a,0,b);return c},append:function(b,a){b.items.push(a);return b},appendItems:function(b,a){b.items=b.items.concat(Kekule.ArrayUtils.toArray(a));return b},getItemType:function(a){if(a.items){return a.role}else{return Kekule.Render.RichText.SECTION}},getItemRole:function(b){var a=Kekule.Render.RichText;return(Kekule.Render.RichTextUtils.getItemType(b)===a.GROUP)?a.GROUP:a.SECTION},getItemTextType:function(a){return a.textType||Kekule.Render.RichText.NORMAL},isSuperscript:function(a){return Kekule.Render.RichTextUtils.getItemTextType(a)==Kekule.Render.RichText.SUP},isSubscript:function(a){return Kekule.Render.RichTextUtils.getItemTextType(a)==Kekule.Render.RichText.SUB},isGroup:function(a){return Kekule.Render.RichTextUtils.getItemType(a)===Kekule.Render.RichText.GROUP},isSection:function(a){return Kekule.Render.RichTextUtils.getItemType(a)===Kekule.Render.RichText.SECTION},getFirstNormalTextSection:function(e){for(var b=0,a=e.items.length;b<a;++b){var c=e.items[b];var d=Kekule.Render.RichTextUtils.getItemTextType(c);if(d===Kekule.Render.RichText.NORMAL){return c}}return null},getActualRefItem:function(d,c){var a=d.refItem;if((!a)&&(c.items.length>1)){var b=c.items.indexOf(d);if(b>0){a=c.items[b-1]}else{if(b==0){a=c.items[1]}else{a=null}}}return a},getFinalAnchorItem:function(a){if(a.anchorItem){return Kekule.Render.RichTextUtils.getFinalAnchorItem(a.anchorItem)}else{return a}},tidy:function(b){var k=Kekule.Render.RichTextUtils.createGroup(b.role);var a=-1;for(var e=0,d=b.items.length;e<d;++e){var j=b.items[e];if(j.items){var c=Kekule.Render.RichTextUtils.tidy(j);if(c.items.length==1){var f=Object.extend({},c);delete f.items;delete f.role;f=Object.extend(f,c.items[0]);j=f}else{if(c.items.length>0){++a;k.items.push(c);continue}}}var h=false;if(a>=0){var g=k.items[a];if(!g.items){if(Kekule.ObjUtils.equal(j,g,["text"])){g.text+=j.text;h=true}}}if(!h){++a;k.items.push(Object.extend({},j))}}return k},clone:function(g){var b={};Object.extend(b,g);if(g.items){b.items=[];for(var e=0,c=g.items.length;e<c;++e){var f={};f=Kekule.Render.RichTextUtils.clone(g.items[e]);b.items.push(f)}}if(b.items){if(g.anchorItem){var d=g.items.indexOf(g.anchorItem);if(d>=0){b.anchorItem=b.items[d]}else{b.anchorItem=null}}for(var e=0,c=b.items.length;e<c;++e){var a=g.items[e];var f=b.items[e];if(a.refItem){var d=g.items.indexOf(a.refItem);if(d>=0){f.refItem=b.items[d]}else{f.refItem=null}}}}return b},toText:function(e){var a="";if(e.items){for(var c=0,b=e.items.length;c<b;++c){var d=e.items[c];if(d.items){a+=Kekule.Render.RichTextUtils.toText(d)}else{if(d.text){a+=d.text}}}}else{return e.text||""}return a},_toDebugHtml:function(e){if(!e.items){return e.text}var a="";for(var c=0,b=e.items.length;c<b;++c){var d=e.items[c];if(d.items){a+=Kekule.Render.RichTextUtils._toDebugHtml(d)}else{if(d.text){switch(d.textType){case Kekule.Render.RichText.SUB:a+="<sub>"+d.text+"</sub>";break;case Kekule.Render.RichText.SUP:a+="<sup>"+d.text+"</sup>";break;default:a+=d.text}}}}return a},toSimpleHtmlCode:function(a){return Kekule.Render.RichTextUtils._toDebugHtml(a)},toHtml:function(v,h,d){var c=Kekule.Render.RichText;var n;var b;if(h.charDirection){b=h.charDirection===Kekule.Render.TextDirection.RTL||h.charDirection===Kekule.Render.TextDirection.BTT}else{b=d}var w=h.role;if(w===c.SECTION||h.text){var g=h.textType;var e=(g===c.SUB)?"sub":(g===c.SUP)?"sup":"span";n=v.createElement(e);var o=h.text;if(b){o=o.reverse()}Kekule.DomUtils.setElementText(n,h.text||"")}else{var p=null;var k;if(w===c.LINES){n=v.createElement("div");p="p";k="margin:0.2em 0;padding:0"}else{n=v.createElement("span")}var j;for(var r=0,q=h.items.length;r<q;++r){var t=h.items[r];var m=Kekule.Render.RichTextUtils.toHtml(v,t,b);if(p){var s=v.createElement(p);if(k){s.style.cssText=k}s.appendChild(m);m=s}if(!b||!j){n.appendChild(m)}else{n.insertBefore(m,j)}j=m}}var u=n.style;var a=Kekule.Render.RichTextUtils.STYLE_PROPS;for(var r=0,q=a.length;r<q;++r){var f=a[r];if(h[f]){u[f]=h[f]}}return n},fromHtml:function(f){var a=Kekule.Render.RichText;var e=Kekule.Render.RichTextUtils;var d=Kekule.DomUtils;var b=Kekule.StyleUtils;function c(w,z){if(w.nodeType===Node.TEXT_NODE){var r=w.nodeValue;r=r.replace(/[\r\n]/g,"");return r.trim()?e.createSection(r):null}else{if(w.nodeType===Node.ELEMENT_NODE){var n=e.STYLE_PROPS;n.push("direction");var o={};for(var A=0,x=n.length;A<x;++A){var y=n[A];var v;if(z){v=b.getComputedStyle(w,y)}else{v=w.style[y]}if(v){o[y]=v}}if(!o.direction){o.charDirection=Kekule.Render.TextDirection.DEFAULT}else{o.charDirection=(o.direction==="ltr")?Kekule.Render.TextDirection.LTR:(o.direction==="rtl")?Kekule.Render.TextDirection.RTL:(o.direction==="inherit")?Kekule.Render.TextDirection.INHERIT:null;delete o.direction}if(!d.getFirstChildElem(w)){var r=d.getElementText(w);var h=w.tagName.toLowerCase();if(h==="sub"){o.textType=a.SUB}else{if(h==="sup"){o.textType=a.SUP}else{o.textType=a.NORMAL}}return r?e.createSection(r,o):null}else{var k=a.GROUP;var g=d.getChildNodesOfTypes(w,[Node.ELEMENT_NODE,Node.TEXT_NODE]);var u=[];var t=false;for(var A=0,x=g.length;A<x;++A){var m=g[A];var j=c(m,false);if(m.nodeType===Node.ELEMENT_NODE){if(m.tagName.toLowerCase()==="br"){u.push("br");t=true}var D=b.isBlockElem(m);if(D){t=true;j._isLine=true}}if(j){u.push(j)}}if(t){var B=[];var s=[];for(var A=0,x=u.length;A<x;++A){var j=u[A];if(j._isLine||j=="br"){if(s.length){if(s.length>1){var p=e.createGroup();e.appendItems(p,s);B.push(p)}else{B.push(s[0])}s=[]}if(j._isLine){delete j._isLine;B.push(j)}}else{s.push(j)}}if(s.length){if(s.length>1){var p=e.createGroup();e.appendItems(p,s);B.push(p)}else{B.push(s[0])}}u=B}if(t){k=a.LINES}var q=e.createGroup(k,o);for(var A=0,x=u.length;A<x;++A){e.append(q,u[A])}return q}}}}return c(f,true)}};Kekule.Render.ChemDisplayTextUtils={RADICAL_LABELS:["","\u2022\u2022","\u2022","\u2022\u2022"],RADICAL_TRIPLET_ALTER_LABEL:"^^",getRadicalDisplayText:function(a,b){if(b&&a===Kekule.RadicalOrder.TRIPLET){return Kekule.Render.ChemDisplayTextUtils.RADICAL_TRIPLET_ALTER_LABEL}else{return Kekule.Render.ChemDisplayTextUtils.RADICAL_LABELS[a]}},getChargeDisplayText:function(f,d,c){var a="";var b=(!!f)&&(!d||(Math.abs(f)>Math.pow(10,-d)/2));if(b){var g=(f>0)?"+":"-";var e=Math.abs(f);if(e!=1){a+=d?Kekule.NumUtils.toDecimals(e,d):e.toString()}else{if(c===Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND){g=(f>0)?"\u2295":"\u2296"}}a+=g}return a},createElectronStateDisplayTextSection:function(g,e,d,c,f){var b=null;var a="";if(g){a=Kekule.Render.ChemDisplayTextUtils.getChargeDisplayText(g,d,c)}if(e){a+=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(e,f)||""}if(a){b=Kekule.Render.RichTextUtils.createSection(a,{textType:Kekule.Render.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR})}return b},formulaToRichText:function(h,e,g,d,f,c,b){var a=Kekule.Render.ChemDisplayTextUtils._convFormulaToRichTextGroup(h,false,e,g,d,f,c,b);return a},_convFormulaToRichTextGroup:function(b,t,e,p,u,s,a,v){var f=Kekule.Render.RichTextUtils.createGroup();var h=b.getSections();if(t){var o=b.getMaxNestedLevel()%Kekule.FormulaUtils.FORMULA_BRACKET_TYPE_COUNT;var j=Kekule.FormulaUtils.FORMULA_BRACKETS[o][0];var d=Kekule.FormulaUtils.FORMULA_BRACKETS[o][1];f=Kekule.Render.RichTextUtils.appendText(f,j)}for(var q=0,n=h.length;q<n;++q){var g=h[q].obj;var k=b.getSectionCharge(h[q]);var m=null;if(g instanceof Kekule.MolecularFormula){m=Kekule.Render.ChemDisplayTextUtils._convFormulaToRichTextGroup(g,true,false,false,u,s,a)}else{if(g.getDisplayRichText){var m=g.getDisplayRichText(Kekule.Render.HydrogenDisplayLevel.NONE,false,null,s,u,a)}}if(m){if(h[q].count!=1){m=Kekule.Render.RichTextUtils.appendText(m,h[q].count.toString(),{textType:Kekule.Render.RichText.SUB});m.charDirection=Kekule.Render.TextDirection.LTR}if(e&&k){var c=Kekule.Render.ChemDisplayTextUtils.createElectronStateDisplayTextSection(k,null,u,a,v);if(c){Kekule.Render.RichTextUtils.append(m,c)}}f=Kekule.Render.RichTextUtils.append(f,m)}}if(t){f=Kekule.Render.RichTextUtils.appendText(f,d)}if(e||p){var k=b.getCharge();var r=b.getRadical();var c=Kekule.Render.ChemDisplayTextUtils.createElectronStateDisplayTextSection(k,r,u,a);if(c){Kekule.Render.RichTextUtils.append(f,c)}}return f}};Kekule.Render.TextDrawUtils={isHorizontalLine:function(a){return((a==Kekule.Render.TextDirection.LTR)||(a==Kekule.Render.TextDirection.RTL)||(a==null))},isVerticalLine:function(a){return((a==Kekule.Render.TextDirection.TTB)||(a==Kekule.Render.TextDirection.BTT))},getOppositeDirection:function(b){var a=Kekule.Render.TextDirection;switch(b){case a.LTR:return a.RTL;case a.RTL:return a.LTR;case a.TTB:return a.BTT;case a.BTT:return a.TTB}},isOppositeDirection:function(b,a){return Kekule.Render.TextDrawUtils.getOppositeDirection(b)===a},getActualDirection:function(b,a){if(b===TD.LINE_BREAK){return((a===TD.TTB)||(a===TD.BTT))?TD.LTR:((a===TD.LTR)||(a===TD.RTL))?TD.TTB:b}else{return b}},getActualAlign:function(d,c){var a=Kekule.Render.TextAlgin;var b=Kekule.Render.TextDirection;switch(d){case a.LEFT:case a.RIGHT:case a.TOP:case a.BOTTOM:case a.CENTER:return d;break;case a.LEADING:switch(c){case b.TTB:return a.TOP;case b.BTT:return a.BOTTOM;case b.RTL:return a.RIGHT;case b.LTR:default:return a.LEFT}case a.TRAILING:switch(c){case b.BTT:return a.TOP;case b.TTB:return a.BOTTOM;case b.RTL:return a.LEFT;case b.LTR:default:return a.RIGHT}}}};Kekule.Render.DrawPathUtils={makePath:function(){var b=[];var d=null;var g=[];var f;for(var e=0,c=arguments.length;e<c;++e){var a=arguments[e];if(DataType.isArrayValue(a)){g=g.concat(a)}else{if(typeof(a)==="number"){g.push(a)}else{if(d){f={method:d,params:g};b.push(f);d=null;g=[]}d=a.toString()}}if(e===c-1){if(d){f={method:d,params:g};b.push(f)}}}return b}};Kekule.Render.ConnectorDrawUtils={getPossibleConnectorRenderTypes:function(a){if(a instanceof Kekule.Bond){return Kekule.Render.ConnectorDrawUtils.getPossibleBondRenderTypes(a)}else{var b=Kekule.Render.BondRenderType;return[b.SINGLE,b.DASHED,b.WAVY]}},getDefConnectorRenderType:function(c){var b=Kekule.Render.ConnectorDrawUtils.getPossibleConnectorRenderTypes(c);return b[0]},getPossibleBondRenderTypes:function(g){var b=Kekule.Render.BondRenderType;var c=Kekule.BondType;var h=g.getBondType();switch(h){case c.HYDROGEN:return[b.DASHED,b.ARROWED,b.WAVY];break;case c.COORDINATE:return[b.ARROWED,b.SINGLE,b.DASHED,b.WAVY];break;case c.IONIC:case c.METALLIC:case c.UNKNOWN:return[b.SINGLE,b.DASHED,b.WAVY];break;case c.COVALENT:break;default:return[b.SINGLE,b.DASHED,b.ARROWED,b.WAVY]}if(g.getConnectedObjCount()>2){return[b.DASHED,b.SINGLE]}var f=Kekule.BondOrder;switch(g.getBondOrder()){case f.DOUBLE:var e=[b.DOUBLE,b.DASHED_DOUBLE,b.BOLD_DOUBLE,b.WAVY];if(g.getStereo&&[Kekule.BondStereo.E_OR_Z,Kekule.BondStereo.CIS_OR_TRANS].indexOf(g.getStereo())>=0){e.unshift(b.SCISSORS_DOUBLE)}return e;break;case f.TRIPLE:return[b.TRIPLE,b.BOLD_TRIPLE,b.WAVY];break;case f.QUAD:return[b.QUAD,b.BOLD_QUAD,b.WAVY];break;case f.EXPLICIT_AROMATIC:return[b.SOLID_DASH,b.WAVY];break;case f.SINGLE:var d=Kekule.BondStereo;var a=[b.SINGLE,b.BOLD,b.WAVY];switch(g.getStereo()){case d.UP:a.unshift(b.WEDGED_SOLID,b.WEDGED_HOLLOW);break;case d.UP_INVERTED:a.unshift(b.WEDGED_SOLID_INV,b.WEDGED_HOLLOW_INV);break;case d.DOWN:a.unshift(b.WEDGED_HASHED,b.DASHED);break;case d.DOWN_INVERTED:a.unshift(b.WEDGED_HASHED_INV,b.DASHED);break;case d.UP_OR_DOWN:case d.UP_OR_DOWN_INVERTED:a=[b.WAVY,b.SINGLE];break;case d.CLOSER:a=[b.WEDGED_SOLID_BOTH,b.WEDGED_HOLLOW_BOTH];break;default:}return a;break;default:return[b.SINGLE,b.DASHED,b.ARROWED,b.WAVY]}},getDefBondRenderType:function(c){var b=Kekule.Render.ConnectorDrawUtils.getPossibleBondRenderTypes(c);return b[0]},getConnectorRender3DType:function(a,d){var b=Kekule.Render.Bond3DRenderType;var c=Kekule.Render.Bond3DRenderMode;if(d&&((d===c.WIRE)||(d===c.CYLINDER))){return b.SINGLE}else{if(a instanceof Kekule.Bond){return Kekule.Render.ConnectorDrawUtils.getBondRender3DTypes(a)}else{return b.SINGLE}}},getBondRender3DTypes:function(d){var a=Kekule.Render.Bond3DRenderType;var b=Kekule.BondType;var e=d.getBondType();switch(e){case b.HYDROGEN:return a.DASH;break;case b.COVALENT:break;default:return a.SINGLE}var c=Kekule.BondOrder;switch(d.getBondOrder()){case c.DOUBLE:return a.DOUBLE;break;case c.TRIPLE:return a.TRIPLE;break;case c.EXPLICIT_AROMATIC:return a.SOLID_DASH;break;default:return a.SINGLE}}};Kekule.Render.ObjUtils={getContainerBox:function(f,c,a){if(!c){c=Kekule.CoordMode.COORD2D}var b;var d=f;if(d.getExposedContainerBox){b=d.getExposedContainerBox(c,a)}else{if(d.getContainerBox){b=d.getContainerBox(c,a)}else{var e=d.getAbsCoordOfMode?d.getAbsCoordOfMode(c):null;b=e?Kekule.BoxUtils.createBox(e,e):null}}return b}};Kekule.Render.MetaShapeUtils={createShapeInfo:function(c,d,b){var a={shapeType:c,coords:d};if(b){a=Object.extend(a,b)}return a},isCompositeShape:function(a){return DataType.isArrayValue(a)},inflateShape:function(f,h){if(!f){return null}var c=Kekule.Render.MetaShapeType;var a=Kekule.Render.MetaShapeUtils;if(a.isCompositeShape(f)){var k=[];for(var e=0,b=f.length;e<b;++e){var j=f[e];var d=a.inflateShape(j,h);k.push(d)}return k}var g;switch(f.shapeType){case c.POINT:g=a._inflatePointShape(f,h);break;case c.CIRCLE:g=a._inflateCircleShape(f,h);break;case c.LINE:g=a._inflateLineShape(f,h);break;case c.RECT:g=a._inflateRectShape(f,h);break;case c.POLYGON:g=a._inflatePolygonShape(f,h);break}return g},_inflatePointShape:function(b,c){var a=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.CIRCLE,[b.coords[0]],{radius:c});return a},_inflateCircleShape:function(b,c){var a=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.CIRCLE,[b.coords[0]],{radius:b.radius+c});return a},_inflateLineShape:function(b,c){var a=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.LINE,[b.coords[0],b.coords[1]],{width:(b.width||0)+c*2});return a},_inflateRectShape:function(b,d){var a=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.RECT,[]);var c=Kekule.Render.MetaShapeUtils._inflateCoords(b.coords,d);a.coords=c;return a},_inflatePolygonShape:function(b,d){var a=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.POLYGON,[]);var c=Kekule.Render.MetaShapeUtils._inflateCoords(b.coords,d);a.coords=c;return a},_inflateCoords:function(h,m){var c=Kekule.CoordUtils;var n=[];var a=c.getCenter(h);for(var f=0,e=h.length;f<e;++f){var g=h[f];var d=c.substract(g,a);var b=c.getDistance(g);var k=c.multiply(d,m/b);var j=c.add(g,k);n.push(j)}return n},getDistance:function(g,k,m){if(Kekule.Render.MetaShapeUtils.isCompositeShape(k)){var n=null;for(var f=0,c=k.length;f<c;++f){var b=k[f];var j=Kekule.Render.MetaShapeUtils.getDistance(g,b,m);if(n===null||n>j){n=j}}return n}else{var e=Kekule.Render.MetaShapeType;var a=Kekule.Render.MetaShapeUtils;var h=m?a.inflateShape(k,m):k;switch(k.shapeType){case e.POINT:return(m?a._getDistanceToCircle(g,h):a._getDistanceToPoint(g,h));case e.CIRCLE:return a._getDistanceToCircle(g,h);case e.LINE:return a._getDistanceToLine(g,h);case e.RECT:return a._getDistanceToRect(g,h);case e.POLYGON:return a._getDistanceToPolygon(g,h);default:return false}}},_getDistanceToPoint:function(b,a){return Kekule.CoordUtils.getDistance(b,a.coords[0])},_getDistanceToCircle:function(e,c){var b=Kekule.CoordUtils;var a=b.getDistance(e,c.coords[0]);return a-c.radius},_getDistanceToLine:function(i,n){var h=Kekule.Render.MetaShapeUtils;var l=n.coords;var g=Kekule.Render.MetaShapeUtils._calcVerticalLineCrossPoint(i,l[0],l[1]);var m;var d=Kekule.NumUtils;if(d.isFloatEqual(l[0].x,l[1].x)&&d.isFloatEqual(l[0].y,l[1].y)){var f={coords:[n.coords[0]],radius:n.width};var o=h._getDistanceToCircle(i,f);return o}else{var e=Kekule.CoordUtils.substract(l[1],l[0]);if(Math.abs(e.y)>Math.abs(e.x)){m=(Math.sign(g.y-l[0].y)*Math.sign(g.y-l[1].y)<=0)}else{m=(Math.sign(g.x-l[0].x)*Math.sign(g.x-l[1].x)<=0)}}if(!m){var k={coords:[n.coords[0]],radius:n.width||0};var j={coords:[n.coords[1]],radius:n.width||0};var c=h._getDistanceToCircle(i,k);var b=h._getDistanceToCircle(i,j);return Math.min(c,b)}else{var a=Kekule.CoordUtils.getDistance(i,g)-(n.width||0)/2;return a}},_getDistanceToRect:function(c,g){var e=g.coords;var h=(c.x-e[0].x);var f=(c.x-e[1].x);var d=(c.y-e[0].y);var b=(c.y-e[1].y);var a=(h*f<=0)&&(d*b<=0);if(a){return -Math.min(Math.abs(h),Math.abs(f),Math.abs(d),Math.abs(b))}else{var i=Kekule.CoordUtils;return Math.min(i.getDistance(c,e[0]),i.getDistance(c,e[1]),i.getDistance(c,{x:e[0].x,y:e[1].y}),i.getDistance(c,{x:e[1].x,y:e[0].y}))}},_getDistanceToPolygon:function(j,p){var b=Kekule.CoordUtils;var h=Kekule.Render.MetaShapeUtils;var f=Kekule.Render.MetaShapeType;var e=h._isInsidePolygon(j,p);var o=p.coords;var a=null;for(var g=0,c=o.length;g<c;++g){var n=o[g];var k=o[(g+1)%c];var q=h.createShapeInfo(f.LINE,[n,k],{width:0});var m=h._getDistanceToLine(j,q);if(a===null){a=m}else{if(a>m){a=m}}}if(e){a=-a}return a},_getDistanceOfTwoLines:function(h,g){var b=Kekule.Render.MetaShapeUtils;var a=Kekule.GeometryUtils;if(a.getCrossPointOfLines(h[0],h[1],g[0],g[1])){return 0}var f=a.getDistanceFromPointToLine(h[0],g[0],g[1]);var e=a.getDistanceFromPointToLine(h[1],g[0],g[1]);var d=a.getDistanceFromPointToLine(g[0],h[0],h[1]);var c=a.getDistanceFromPointToLine(g[1],h[0],h[1]);return Math.min(f,e,d,c)},isCoordInside:function(f,h,j){if(Kekule.Render.MetaShapeUtils.isCompositeShape(h)){for(var e=0,c=h.length;e<c;++e){var b=h[e];if(Kekule.Render.MetaShapeUtils.isCoordInside(f,b,j)){return true}}return false}else{var d=Kekule.Render.MetaShapeType;var a=Kekule.Render.MetaShapeUtils;var g=j?a.inflateShape(h,j):h;switch(h.shapeType){case d.POINT:return(j?a._isInsideCircle(f,g):a._isInsidePoint(f,g));case d.CIRCLE:return a._isInsideCircle(f,g);case d.LINE:return a._isInsideLine(f,g);case d.RECT:return a._isInsideRect(f,g);case d.POLYGON:return a._isInsidePolygon(f,g);default:return false}}},_isInsidePoint:function(b,a){return Kekule.CoordUtils.isEqual(b,a.coords[0])},_isInsideCircle:function(e,c){var b=Kekule.CoordUtils;var a=b.getDistance(e,c.coords[0]);return(a<=c.radius)},_isInsideLine:function(f,i){var g=i.coords;var e=Kekule.Render.MetaShapeUtils._calcVerticalLineCrossPoint(f,g[0],g[1]);var h;var b=Kekule.NumUtils;if(b.isFloatEqual(g[0].x,g[1].x)&&b.isFloatEqual(g[0].y,g[1].y)){var d={coords:[i.coords[0]],radius:i.width};var j=Kekule.Render.MetaShapeUtils._isInsideCircle(f,d);return j}else{var c=Kekule.CoordUtils.substract(g[1],g[0]);if(Math.abs(c.y)>Math.abs(c.x)){h=(Math.sign(e.y-g[0].y)*Math.sign(e.y-g[1].y)<=0)}else{h=(Math.sign(e.x-g[0].x)*Math.sign(e.x-g[1].x)<=0)}}if(!h){return false}else{var a=Kekule.CoordUtils.getDistance(f,e);return(a<=i.width/2)}},_isInsideRect:function(c,b){var a=b.coords;return Kekule.CoordUtils.insideRect(c,a[0],a[1])},_isInsidePolygon:function(f,m){var a=Kekule.CoordUtils;var j=m.coords;var c=0;for(var e=0,d=j.length;e<d;++e){var h=j[e];var g=j[(e+1)%d];var k=a.substract(g,h);if(k.x===0){continue}else{var b={x:f.x};b.y=((b.x-h.x)/k.x)*k.y+h.y;if(a.insideRect(b,h,g)){++c}}}return(c%2===0)},_calcVerticalLineCrossPoint:function(e,c,b){var a={};if(Math.abs(c.x-b.x)<1e-10){a.x=c.x;a.y=e.y}else{var d=(b.y-c.y)/(b.x-c.x);a.x=(d*d*c.x+d*(e.y-c.y)+e.x)/(d*d+1);a.y=d*(a.x-c.x)+c.y}return a},getContainerBox:function(n,m){var d=Kekule.Render.MetaShapeType;var c=Kekule.Render.MetaShapeUtils;var a=Kekule.BoxUtils;var j=n.coords;m=m||0;var o;if(c.isCompositeShape(n)){o=null;for(var f=0,b=n.length;f<b;++f){var e=n[f];var k=c.getContainerBox(e);if(!o){o=k}else{o=a.getContainerBox(o,k)}}}else{switch(n.shapeType){case d.POINT:case d.CIRCLE:var h=(n.shapeType===d.POINT)?0:(n.radius||0);var g=j[0];o=a.createBox({x:g.x-h,y:g.y-h},{x:g.x+h,y:g.y+h});break;case d.LINE:var o=a.createBox(j[0],j[1]);o=Kekule.BoxUtils.inflateBox(o,(n.width||0)/2);break;case d.RECT:o=a.createBox(j[0],j[1]);break;case d.POLYGON:o=a.createBox(j[0],j[0]);for(var f=1,b=j.length;f<b;++f){var g=j[f];o={x1:Math.min(o.x1,g.x),y1:Math.min(o.y1,g.y),x2:Math.max(o.x2,g.x),y2:Math.max(o.y2,g.y)}}break}}if(m){o=Kekule.BoxUtils.inflateBox(o,m)}return o},isIntersectingLine:function(s,o,m){var e=Kekule.Render.MetaShapeType;var b=Kekule.Render.MetaShapeUtils;if(b.isCompositeShape(s)){for(var k=0,c=s.length;k<c;++k){var h=s[k];if(b.isIntersectingLine(h,o,m)){return true}}return false}else{var t=b.createShapeInfo(e.LINE,o);var g=m/2;var a=s.coords;switch(s.shapeType){case e.POINT:var n=b._getDistanceToLine(a[0],t);return n<=g;case e.CIRCLE:var n=b._getDistanceToLine(a[0],t);return n<=g+(t.radius||0);case e.LINE:var n=b._getDistanceOfTwoLines(a,o);return n<=g+(t.width||0);case e.RECT:case e.POLYGON:var p=b._getCoordsForShapeInComparingWithPolygon(s);var n=null;var f=p.length-1;for(var k=0,c=p.length;k<c;++k){var r=[p[k],p[f]];var q=b._getDistanceOfTwoLines(r,o);if(n===null||q<n){n=q}f=k}return n<=g}return false}},isInsideBox:function(c,b){var a=Kekule.Render.MetaShapeUtils.getContainerBox(c);return Kekule.BoxUtils.isInside(a,b)},isIntersectingBox:function(g,d){if(U.isCompositeShape(g)){for(var c=0,b=g.length;c<b;++c){var f=g[c];var a=Kekule.Render.MetaShapeUtils.isIntersectingBox(f,d);if(a){return true}}}else{var e=g.coords;for(var c=0,b=e.length;c<b;++c){var h=e[c];if(Kekule.CoordUtils.isInsideBox(h,d)){return true}}return false}},isPointInsidePolygon:function(c,b){var a=false;var f=b.length;var d=f-1;for(var e=0;e<f;++e){if(((b[e].y>c.y)!==(b[d].y>c.y))&&(c.x<(b[d].x-b[e].x)*(c.y-b[e].y)/(b[d].y-b[e].y)+b[e].x)){a=!a}d=e}return a},isInsidePolygon:function(g,d){var b=Kekule.Render.MetaShapeUtils;var f=b._getCoordsForShapeInComparingWithPolygon(g);if(!f){return false}for(var e=0,a=f.length;e<a;++e){var h=f[e];if(!b.isPointInsidePolygon(h,d)){return false}}return true},isIntersectingPolygon:function(g,d){var b=Kekule.Render.MetaShapeUtils;var f=b._getCoordsForShapeInComparingWithPolygon(g);if(!f){return false}for(var e=0,a=f.length;e<a;++e){var h=f[e];if(b.isPointInsidePolygon(h,d)){return true}}return false},isIntersectingPolyline:function(g,e,a){var d=Kekule.Render.MetaShapeUtils;for(var f=0,c=e.length-1;f<c;++f){var b=[e[f],e[f+1]];if(d.isIntersectingLine(g,b,a)){return true}}return false},_getCoordsForShapeInComparingWithPolygon:function(p){var f=Kekule.Render.MetaShapeType;var d=Kekule.Render.MetaShapeUtils;var q;if(d.isCompositeShape(p)){q=[];for(var j=0,e=p.length;j<e;++j){var h=p[j];var c=d._getCoordsForShapeInComparingWithPolygon(h);q=q.concat(c)}return q}else{var o=p.coords;switch(p.shapeType){case f.POINT:q=[o[0]];break;case f.CIRCLE:var m=p.radius||0;if(!m){q=[o[0]]}else{var b=m;var n=b/Math.sqrt(2);q=[{x:b,y:0},{x:n,y:n},{x:0,y:b},{x:-n,y:n},{x:-b,y:0},{x:-n,y:-n},{x:0,y:-b},{x:n,y:-n}]}break;case f.LINE:q=[o[0],o[1]];break;case f.RECT:var k=o[0],g=o[1];q=[k,{x:g.x,y:k.y},g,{x:k.x,y:g.y}];break;case f.POLYGON:q=o;break}return q}}};Kekule.Render.RenderOptionUtils={mergeObjLocalRenderOptions:function(c,a){var b=(c&&c.getOverriddenRenderOptions)?c.getOverriddenRenderOptions():null;return Kekule.Render.RenderOptionUtils.mergeRenderOptions(b||{},a)},mergeObjLocalRender3DOptions:function(c,a){var b=(c&&c.getOverriddenRender3DOptions)?c.getOverriddenRender3DOptions():null;return Kekule.Render.RenderOptionUtils.mergeRenderOptions(b||{},a)},mergeRenderOptions:function(c,b){var a=Object.create(b);a=Object.extend(a,c,true,true);return a},getColor:function(a){return a?a.color:null},getMoleculeDisplayType:function(a){return a?a.moleculeDisplayType:null},getNodeDisplayMode:function(a){return a?a.nodeDisplayMode:null},getHydrogenDisplayLevel:function(a){return a?a.hydrogenDisplayLevel:null},getShowCharge:function(a){return a?a.showCharge:null},getChargeDrawOptions:function(b){if(!b){return null}else{var c=["showCharge","chargeMarkType","chargeMarkFontSize","chargeMarkMargin","chargeMarkCircleWidth","color","opacity"];var a=Object.copyValues({},b,c);return a}},getNodeLabelDrawOptions:function(b){if(!b){return null}else{var c=["fontSize","fontFamily","supFontSizeRatio","subFontSizeRatio","superscriptOverhang","subscriptOversink","textBoxXAlignment","textBoxYAlignment","color","opacity"];var a=Object.copyValues({},b,c);return a}},getConnectorRenderType:function(a){return a?renderOption.renderType:null},getConnectorDrawParams:function(b){if(!b){return null}else{var c=["bondLineWidth","boldBondLineWidth","hashSpacing","multipleBondSpacingRatio","multipleBondSpacingAbs","multipleBondMaxAbsSpacing","bondArrowLength","bondArrowWidth","bondWedgeWidth","bondWedgeHashMinWidth","color","opacity"];var a=Object.copyValues({},b,c);return a}},convertConfigsToPlainHash:function(b){var a=Kekule.Render.RenderOptionUtils;if(b instanceof Kekule.Render.Render3DConfigs){return a.convert3DConfigsToPlainHash(b)}else{return a.convert2DConfigsToPlainHash(b)}},convert2DConfigsToPlainHash:function(b){var d=Kekule.ObjUtils;var a={};a._configs=b;var c=b.getGeneralConfigs().toHash();d.replacePropName(c,"drawOpacity","opacity");a=Object.extend(a,c);c=b.getMoleculeDisplayConfigs().toHash();d.replacePropName(c,"defMoleculeDisplayType","moleculeDisplayType");d.replacePropName(c,"defNodeDisplayMode","nodeDisplayMode");d.replacePropName(c,"defHydrogenDisplayLevel","hydrogenDisplayLevel");d.replacePropName(c,"defChargeMarkType","chargeMarkType");a=Object.extend(a,c);a.displayLabelConfigs=b.getDisplayLabelConfigs();c=b.getTextFontConfigs().toHash();a=Object.extend(a,c);c=b.getLengthConfigs().toHash();a=Object.extend(a,c);a.unitLength=a.unitLength||1;c=b.getColorConfigs().toHash();a=Object.extend(a,c);return a},convert3DConfigsToPlainHash:function(b){var d=Kekule.ObjUtils;var a={};a._configs=b;var c=b.getGeneralConfigs().toHash();d.replacePropName(c,"drawOpacity","opacity");a=Object.extend(a,c);var c=b.getEnvironmentConfigs().toHash();a=Object.extend(a,c);var c=b.getMoleculeDisplayConfigs().toHash();d.replacePropName(c,"defMoleculeDisplayType","moleculeDisplayType");d.replacePropName(c,"defBondSpliceMode","bondSpliceMode");d.replacePropName(c,"defDisplayMultipleBond","displayMultipleBond");d.replacePropName(c,"defBondColor","bondColor");d.replacePropName(c,"defAtomColor","atomColor");a=Object.extend(a,c);var c=b.getModelConfigs().toHash();a=Object.extend(a,c);var c=b.getLengthConfigs().toHash();a=Object.extend(a,c);return a},getCascadeRenderOptionValueOfObjs:function(k,g,c){var m;var h=false;var f=Kekule.ArrayUtils.toArray(k);var a=c?"getCascadedRender3DOption":"getCascadedRenderOption";for(var e=0,b=f.length;e<b;++e){var d=f[e];if(d[a]){var j=d[a](g);if(!h){m=j;h=true}else{if(m!=j){return null}}}}return m},setRenderOptionValueOfObjs:function(m,o,c){var g=Kekule.ArrayUtils.toArray(m);var h=c?"setRenderOption":"setRenderOption";for(var f=0,a=g.length;f<a;++f){var e=g[f];if(e[h]){var n=Kekule.ObjUtils.getOwnedFieldNames(o);for(var d=0,b=n.length;d<b;++d){e[h](n[d],o[n[d]])}}}}};Kekule.Render.Render3DOptionUtils={getConnectorRenderType:function(a){return a?a.renderType:null},convertConfigsToPlainHash:function(a){}};Kekule.Render.RenderColorUtils={getActiveAtomColorSet:function(a){return Kekule.Render.atomColors[a]},setActiveAtomColorSet:function(b,a){var c=Kekule.Render.AtomColorSets[b];if(c){Kekule.Render.atomColorSet[a]=c}return c},getColor:function(a,b){var c=Kekule.Render.RenderColorUtils.getActiveAtomColorSet(b);var d=c[a];if(!d){d=c[0]}return d}};Kekule.Render.UpdateObjUtils={_extractObjsOfUpdateObjDetails:function(e){var a=[];for(var c=0,b=e.length;c<b;++c){var d=e[c];if(d.obj){Kekule.ArrayUtils.pushUnique(a,d.obj)}}return a},_createUpdateObjDetailsFromObjs:function(b){var a=[];for(var d=0,c=b.length;d<c;++d){a.push({obj:b[d]})}return a}};Kekule.Render.RendererDefineUtils={CompositeObjRendererMethods:{finalize:function($super){this.reset();$super()},doEstimateObjBox:function(c,k,e){var m=null;var d=this.prepareChildRenderers();var g=Kekule.BoxUtils;for(var h=0,f=d.length;h<f;++h){var a=d[h];if(a){var j=a.estimateObjBox(c,k,e);if(j){if(!m){m=g.clone(j)}else{m=g.getContainerBox(m,j)}}}}return m},isChemObjRenderedBySelf:function($super,b,d){var h=$super(b,d);if(!h){var g=this.getChildRenderers();for(var e=0,c=g.length;e<c;++e){var a=g[e];if(a.isChemObjRenderedBySelf(b,d)){return true}}}if(!h){this.refreshChildObjs();var f=this.getTargetChildObjs();h=(f&&f.indexOf(d)>=0)}return h},isChemObjRenderedDirectlyBySelf:function($super,a,b){return $super(a,b)},getChildObjs:function(){return null},prepareChildObjs:function(){var a=this.getTargetChildObjs();if(a){return a}this.setTargetChildObjs(this.getChildObjs());return this.getTargetChildObjs()},refreshChildObjs:function(){this.setTargetChildObjs(null);this.prepareChildObjs()},getChildRenderers:function(){return this.getChildRendererMap().getValues()},getRendererForChild:function(g,f){var b=(this.getRendererType()===Kekule.Render.RendererType.R3D)?Kekule.Render.get3DRendererClass:Kekule.Render.get2DRendererClass;var e=this.getChildRendererMap();var a=e.get(g);if(!a&&f){var d=b(g)||Kekule.Render.DummyRenderer;var a=d?new d(g,this.getDrawBridge(),this):null;e.set(g,a);a.setRedirectContext(this.getRedirectContext())}return a},prepareChildRenderers:function(){var g=this.getChildRendererMap();var d=this.prepareChildObjs()||[];var c=g.getKeys();for(var b=0,a=c.length;b<a;++b){var e=c[b];if(d.indexOf(e)<0){g.remove(e)}}for(var b=0,a=d.length;b<a;++b){var f=d[b];this.getRendererForChild(f,true)}return g.getValues()},releaseChildRenderers:function(){var d=this.getChildRendererMap();var b=d.getValues();if(!b){return}for(var c=0,a=b.length;c<a;++c){b[c].finalize()}d.clear()},hasChild:function(){return !!(this.getTargetChildObjs()||[]).length},prepare:function(){this.prepareChildObjs();this.prepareChildRenderers()},reset:function(){this.setTargetChildObjs(null);this.releaseChildRenderers()},doDraw:function($super,b,c,a){this.prepare();if(!this.hasChild()){return $super(b,c,a)}else{return this.doDrawChildrenAndSelf(b,c,a)}},doDrawChildrenAndSelf:function(b,g,m){var j=this.createDrawGroup(b);var h=this.getChildRenderers();var c=Object.create(m);this.getRenderCache(b).childDrawOptions=c;for(var f=0,e=h.length;f<e;++f){var a=h[f];var g=null;var d=a.draw(b,g,c);if(j&&d){this.addToDrawGroup(d,j)}}var k=this.doDrawSelf(b,g,m);if(k){this.addToDrawGroup(k,j)}return j},doDrawSelf:function($super,b,c,a){return $super(b,c,a)},doClear:function($super,d){if(this.hasChild()){var b=this.getChildRendererMap().getValues();for(var c=0,a=b.length;c<a;++c){if(b[c]){b[c].clear(d)}}}$super(d);return true},doClearSelf:function($super,a){return $super(a)},doUpdate:function($super,b,A,g){return $super(b,A,g);var B=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(A);var d=this.getTargetChildObjs()||[];var a=this.getChildRendererMap();var f=Kekule.ArrayUtils.toArray(B);var n=new Kekule.MapEx(false);var D=[];var E=false;for(var w=0,t=f.length;w<t;++w){var m=f[w];if(this.isChemObjRenderedDirectlyBySelf(b,m)){E=true}}if(E){this.doClear(b);this.redraw(b);return true}for(var w=0,t=f.length;w<t;++w){var m=f[w];var s=a.get(m);if(s){if(g===Kekule.Render.ObjectUpdateType.REMOVE){s.clear();a.remove(m)}else{Kekule.ArrayUtils.pushUnique(D,s);z=[m];n.set(s,z)}}else{var e=this._getRenderersForChildObj(b,m);if(!e.length){if(d.indexOf(m)>=0){var p=this.getRendererForChild(m,true);var c=p.draw(b,null,this.getRenderCache(b).childDrawOptions);if(c){var y=this.getCachedDrawnElem(b);if(y){this.addToDrawGroup(c,y)}}}}for(var v=0,u=e.length;v<u;++v){var s=e[v];var z=n.get(s);if(!z){D.push(s);z=[];n.set(s,z)}z.push(m)}}}var h=true;for(var w=0,t=D.length;w<t;++w){var s=D[w];var q=n.get(s);var x=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(q);var p=s.update(b,x,g);h=h&&p}var h=D&&D.length>0;if(!h){h=true}return h},doUpdateSelf:function($super,c,b,a){return $super(c,b,a)},_getRenderersForChildObj:function(e,g){var a=[];var c=this.getChildRenderers();for(var d=0,b=c.length;d<b;++d){var f=c[d];if(f.isChemObjRenderedBySelf(e,g)){a.push(f)}}return a}},addCompositeRenderSupport:function(a){ClassEx.defineProp(a,"targetChildObjs",{dataType:DataType.ARRAY,serializable:false});ClassEx.defineProp(a,"childRendererMap",{dataType:DataType.OBJECT,serializable:false,getter:function(){var b=this.getPropStoreFieldValue("childRendererMap");if(!b){b=new Kekule.MapEx(true);this.setPropStoreFieldValue("childRendererMap",b)}return b}});ClassEx.extend(a,Kekule.Render.RendererDefineUtils.CompositeObjRendererMethods)}};(function(){var a=Kekule.OBJDEF_TEXTS;var b=Class.PropertyScope;Kekule.Render.PredefinedConfigsMap=Class.create(Kekule.ConfigPresetMap,{CLASS_NAME:"Kekule.Render.PredefinedConfigsMap"});Kekule.Render.GeneralConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.GeneralConfigs",initProperties:function(){this.addBoolConfigProp("allowCoordBorrow",true,{scope:b.PUBLIC});this.addFloatConfigProp("drawOpacity",1,{title:a.TITLE_DRAWOPACITY,description:a.DES_DRAWOPACITY})}});Kekule.Render.Render2DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render2DConfigs",initProperties:function(){this.addConfigProp("generalConfigs","Kekule.Render.GeneralConfigs");this.addConfigProp("moleculeDisplayConfigs","Kekule.Render.MoleculeDisplayConfigs");this.addConfigProp("displayLabelConfigs","Kekule.Render.DisplayLabelConfigs");this.addConfigProp("textFontConfigs","Kekule.Render.TextFontConfigs");this.addConfigProp("lengthConfigs","Kekule.Render.LengthConfigs");this.addConfigProp("colorConfigs","Kekule.Render.ColorConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("generalConfigs",new Kekule.Render.GeneralConfigs());this.setPropStoreFieldValue("moleculeDisplayConfigs",new Kekule.Render.MoleculeDisplayConfigs());this.setPropStoreFieldValue("displayLabelConfigs",new Kekule.Render.DisplayLabelConfigs());this.setPropStoreFieldValue("textFontConfigs",new Kekule.Render.TextFontConfigs());this.setPropStoreFieldValue("lengthConfigs",new Kekule.Render.LengthConfigs());this.setPropStoreFieldValue("colorConfigs",new Kekule.Render.ColorConfigs())},initInteractStyleMap:function(){}});Kekule.ClassUtils.makeSingleton(Kekule.Render.Render2DConfigs);Kekule.Render.getRender2DConfigs=function(){return Kekule.Render.Render2DConfigs.getInstance()};Kekule.Render.MoleculeDisplayConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.MoleculeDisplayConfigs",initProperties:function(){this.addIntConfigProp("defMoleculeDisplayType",Kekule.Render.MoleculeDisplayType.SKELETAL,{enumSource:Kekule.Render.MoleculeDisplayType});this.addIntConfigProp("defNodeDisplayMode",Kekule.Render.NodeLabelDisplayMode.SMART,{enumSource:Kekule.Render.NodeLabelDisplayMode});this.addIntConfigProp("defHydrogenDisplayLevel",Kekule.Render.HydrogenDisplayLevel.EXPLICIT,{enumSource:Kekule.Render.HydrogenDisplayLevel});this.addIntConfigProp("defChargeMarkType",Kekule.Render.ChargeMarkRenderType.DEFAULT,{enumSource:Kekule.Render.ChargeMarkRenderType});this.addBoolConfigProp("distinguishSingletAndTripletRadical",false);this.addIntConfigProp("partialChargeDecimalsLength",2);this.addBoolConfigProp("autoCreateChargeAndRadicalMarker",true)}});Kekule.Render.DisplayLabelConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.DisplayLabelConfigs",DEF_UNSET_ELEMENT:"?",DEF_DUMMY_ATOM:"Du",DEF_HETERO_ATOM:"Q",DEF_ANY_ATOM:"A",DEF_VARIABLE_ATOM:"L",DEF_RGROUP:"R",DEF_ISO_LIST_LEADING_BRACKET:"[",DEF_ISO_LIST_TAILING_BRACKET:"]",DEF_ISO_LIST_DELIMITER:",",DEF_ISO_LIST_DISALLOW_PREFIX:"NOT",initProperties:function(){var c=Kekule.ChemStructureNodeLabels;this.addBoolConfigProp("enableIsotopeAlias",c.ENABLE_ISOTOPE_ALIAS,{getter:function(){return c.ENABLE_ISOTOPE_ALIAS},setter:function(d){c.ENABLE_ISOTOPE_ALIAS=d}});this.addStrConfigProp("unsetElement",c.UNSET_ELEMENT,{getter:function(){return c.UNSET_ELEMENT},setter:function(d){if(d){c.UNSET_ELEMENT=d}}});this.addStrConfigProp("dummyAtom",c.DUMMY_ATOM,{getter:function(){return c.DUMMY_ATOM},setter:function(d){if(d){c.DUMMY_ATOM=d}}});this.addStrConfigProp("heteroAtom",c.HETERO_ATOM,{getter:function(){return c.HETERO_ATOM},setter:function(d){if(d){c.HETERO_ATOM=d}}});this.addStrConfigProp("anyAtom",c.ANY_ATOM,{getter:function(){return c.ANY_ATOM},setter:function(d){if(d){c.ANY_ATOM=d}}});this.addStrConfigProp("variableAtom",c.VARIABLE_ATOM,{getter:function(){return c.VARIABLE_ATOM},setter:function(d){if(d){c.VARIABLE_ATOM=d}}});this.addStrConfigProp("rgroup",c.SUBGROUP,{getter:function(){return c.SUBGROUP},setter:function(d){if(d){c.SUBGROUP=d}}});this.addStrConfigProp("isoListLeadingBracket",c.ISO_LIST_LEADING_BRACKET,{getter:function(){return c.ISO_LIST_LEADING_BRACKET},setter:function(d){if(d){c.ISO_LIST_LEADING_BRACKET=d}}});this.addStrConfigProp("isoListTailingBracket",c.ISO_LIST_TAILING_BRACKET,{getter:function(){return c.ISO_LIST_TAILING_BRACKET},setter:function(d){if(d){c.ISO_LIST_TAILING_BRACKET=d}}});this.addStrConfigProp("isoListDelimiter",c.ISO_LIST_DELIMITER,{getter:function(){return c.ISO_LIST_DELIMITER},setter:function(d){if(d){c.ISO_LIST_DELIMITER=d}}});this.addStrConfigProp("isoListDisallowPrefix",c.ISO_LIST_DISALLOW_PREFIX,{getter:function(){return c.ISO_LIST_DISALLOW_PREFIX},setter:function(d){if(d){c.ISO_LIST_DISALLOW_PREFIX=d}}})}});Kekule.Render.TextFontConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.TextFontConfigs",DEF_LABEL_FONT_FAMILY:"",initProperties:function(){this.addStrConfigProp("labelFontFamily","Arial, Helvetica, sans-serif");this.addStrConfigProp("atomFontFamily","Arial, Helvetica, sans-serif");this.addFloatConfigProp("supFontSizeRatio",0.66);this.addFloatConfigProp("subFontSizeRatio",0.66);this.addFloatConfigProp("superscriptOverhang",0.2);this.addFloatConfigProp("subscriptOversink",0.2);this.addIntConfigProp("textCharDirection",Kekule.Render.TextDirection.LTR,{enumSource:Kekule.Render.TextDirection});this.addIntConfigProp("textHorizontalAlign",Kekule.Render.TextAlign.LEADING,{enumSource:Kekule.Render.TextAlign});this.addIntConfigProp("textVerticalAlign",Kekule.Render.TextAlign.LEADING,{enumSource:Kekule.Render.TextAlign});this.addIntConfigProp("textBoxXAlignment",Kekule.Render.BoxXAlignment.LEFT,{enumSource:Kekule.Render.BoxXAlignment,scope:b.PUBLIC});this.addIntConfigProp("textBoxYAlignment",Kekule.Render.BoxYAlignment.TOP,{enumSource:Kekule.Render.BoxYAlignment,scope:b.PUBLIC});this.addIntConfigProp("textBoxAlignmentMode",Kekule.Render.TextBoxAlignmentMode.ANCHOR,{enumSource:Kekule.Render.TextBoxAlignmentMode,scope:b.PUBLIC})}});Kekule.Render.LengthConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.LengthConfigs",initProperties:function(){this.addFloatConfigProp("unitLength",1,{scope:b.PUBLIC});this.addFloatConfigProp("labelFontSize",14);this.addFloatConfigProp("atomFontSize",14);this.addFloatConfigProp("atomLabelBoxExpandRatio",1.2,{scope:b.PUBLIC});this.addFloatConfigProp("chargeMarkFontSize",10);this.addFloatConfigProp("chargeMarkMargin",5);this.addFloatConfigProp("chemMarkerFontSize",10);this.addFloatConfigProp("chemMarkerMargin",5);this.addFloatConfigProp("allenCenterAtomRadius",3);this.addFloatConfigProp("defBondLength",25);this.addFloatConfigProp("bondLineWidth",1);this.addFloatConfigProp("boldBondLineWidthRatio",2,{scope:b.PUBLIC});this.addFloatConfigProp("hashSpacing",3);this.addFloatConfigProp("multipleBondSpacingRatio",0.18);this.addFloatConfigProp("multipleBondSpacingAbs",null,{scope:b.PUBLIC});this.addFloatConfigProp("multipleBondMaxAbsSpacing",5);this.addFloatConfigProp("bondArrowLength",6);this.addFloatConfigProp("bondArrowWidth",6);this.addFloatConfigProp("bondWedgeWidth",6);this.addFloatConfigProp("bondWedgeHashMinWidth",2);this.addFloatConfigProp("bondWavyRadius",5);this.addFloatConfigProp("glyphStrokeWidth",1);this.addFloatConfigProp("rxnMolMargin",10,{scope:b.PUBLIC});this.addFloatConfigProp("defScaleRefLength",0.8);this.addFloatConfigProp("autofitContextPadding",45)},getActualLength:function(d){var c=this.getPropValue(d);if((c!==null)&&(c!==undefined)){return c*this.getUnitLength()}else{return null}}});Kekule.Render.ColorConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.ColorConfigs",initProperties:function(){this.addBoolConfigProp("useAtomSpecifiedColor",false);this.addStrConfigProp("labelColor","#000000");this.addStrConfigProp("atomColor","#000000");this.addStrConfigProp("bondColor","#000000");this.addStrConfigProp("glyphStrokeColor","#999999");this.addStrConfigProp("glyphFillColor","#999999")}});Kekule.Render.Render3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render3DConfigs",initProperties:function(){this.addConfigProp("generalConfigs","Kekule.Render.GeneralConfigs");this.addConfigProp("moleculeDisplayConfigs","Kekule.Render.Molecule3DDisplayConfigs");this.addConfigProp("lengthConfigs","Kekule.Render.Length3DConfigs");this.addConfigProp("environmentConfigs","Kekule.Render.Render3DEnvironmentConfigs");this.addConfigProp("modelConfigs","Kekule.Render.Model3DConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("generalConfigs",new Kekule.Render.GeneralConfigs());this.setPropStoreFieldValue("environmentConfigs",new Kekule.Render.Render3DEnvironmentConfigs());this.setPropStoreFieldValue("moleculeDisplayConfigs",new Kekule.Render.Molecule3DDisplayConfigs());this.setPropStoreFieldValue("modelConfigs",new Kekule.Render.Model3DConfigs());this.setPropStoreFieldValue("lengthConfigs",new Kekule.Render.Length3DConfigs())}});Kekule.ClassUtils.makeSingleton(Kekule.Render.Render3DConfigs);Kekule.Render.getRender3DConfigs=function(){return Kekule.Render.Render3DConfigs.getInstance()};Kekule.Render.Render3DEnvironmentConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render3DEnvironmentConfigs",initProperties:function(){this.addIntConfigProp("graphicQuality",Kekule.Render.Render3DGraphicQuality.MEDIUM,{enumSource:Kekule.Render.Render3DGraphicQuality})}});Kekule.Render.Molecule3DDisplayConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Molecule3DDisplayConfigs",initProperties:function(){this.addIntConfigProp("defMoleculeDisplayType",Kekule.Render.Molecule3DDisplayType.BALL_STICK,{enumSource:Kekule.Render.Molecule3DDisplayType});this.addIntConfigProp("defBondSpliceMode",Kekule.Render.Bond3DSpliceMode.WEIGHTING_SPLIT,{enumSource:Kekule.Render.Bond3DSpliceMode});this.addBoolConfigProp("defDisplayMultipleBond",true);this.addStrConfigProp("defBondColor","#FFFFFF");this.addStrConfigProp("defAtomColor","#000099");this.addBoolConfigProp("useAtomSpecifiedColor",true)}});Kekule.Render.Model3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Model3DConfigs",initProperties:function(){this.addBoolConfigProp("showNodeLabel",true,{scope:b.PUBLIC});this.addBoolConfigProp("hideHydrogens",false);this.addBoolConfigProp("useVdWRadius",true);this.addFloatConfigProp("nodeRadiusRatio",0.25,{scope:b.PUBLIC});this.addFloatConfigProp("connectorRadiusRatio",0.25,{scope:b.PUBLIC});this.addFloatConfigProp("multiConnectorRadiusRatio",0.5);this.addFloatConfigProp("multiConnectorMarginRatio",1)}});Kekule.Render.Length3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Length3DConfigs",initProperties:function(){this.addFloatConfigProp("unitLength",1,{scope:b.PUBLIC});this.addFloatConfigProp("fixedNodeRadius",1.7);this.addFloatConfigProp("connectorRadius",0.6);this.addFloatConfigProp("connectorLineWidth",2);this.addFloatConfigProp("defBondLength",100,{scope:b.PUBLIC})},getActualLength:function(d){var c=this.getPropValue(d);if((c!==null)&&(c!==undefined)){return c*this.getUnitLength()}else{return null}}})})();(function(){var c=Kekule.Render.RichText;var e=Kekule.Render.RichTextUtils;var b=Kekule.Render.TextDirection;var a=Kekule.Render.TextDrawUtils;var d=Kekule.Render.TextAlign;Kekule.Render.AbstractTextDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.AbstractTextDrawBridge",drawText:function(g,i,h,f){return null},canMeasureText:function(f){return false},measureText:function(g,h,f){return{}},canMeasureDrawnText:function(f){return false},measureDrawnText:function(g,h,f){return{}},canModifyText:function(f){return false},modifyDrawnTextCoord:function(g,h,f){},createGroup:function(f){},addToGroup:function(f,g){},removeFromGroup:function(f,g){}});Kekule.Render.BaseRichTextDrawer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.BaseRichTextDrawer",ITEM_PARENT_FIELD:"__$parent__",initialize:function($super,h,g,f){$super();this.options=g||{};if(h){this.setDrawBridge(h)}if(f){this.setDrawConfigs(f)}},initProperties:function(){this.defineProp("drawBridge",{dataType:"Kekule.Render.AbstractTextDrawBridge",serializable:false});this.defineProp("drawConfigs",{dataType:"Kekule.Render.Render2DConfigs",serializable:false})},fillOptions:function(f){if(f){var h=f.getTextFontConfigs();var g=this.options;g.supFontSizeRatio=h.getSupFontSizeRatio();g.subFontSizeRatio=h.getSubFontSizeRatio();g.superscriptOverhang=h.getSuperscriptOverhang();g.subscriptOversink=h.getSubscriptOversink();g.textCharDirection=h.getTextCharDirection();g.textLineDirection=h.getTextLineDirection();g.textHorizontalAlign=h.getTextHorizontalAlign();g.textVerticalAlign=h.getTextVerticalAlign();g.textBoxXAlignment=h.getTextBoxXAlignment();g.textBoxYAlignment=h.getTextBoxYAlignment();g.textBoxAlignmentMode=h.getTextBoxAlignmentMode()}},cloneRichText:function(f){return Kekule.Render.RichTextUtils.clone(f)},_FONT_OPTION_FIELDS:["fontSize","fontFamily","fontWeight","fontStyle","color","overhang","oversink","opacity","zoom"],_DRAW_OPTIONS_FIELDS:["textType","charDirection","defaultCharDirection","fontSize","fontFamily","fontWeight","fontStyle","color","horizontalAlign","verticalAlign","zoom"],_fillLocalDrawOptions:function(h,j){var f=j||{};var m=0;for(var k=0,g=this._DRAW_OPTIONS_FIELDS.length;k<g;++k){var o=this._DRAW_OPTIONS_FIELDS[k];var n=h[o];if(Kekule.ObjUtils.notUnset(n)){f[o]=n;++m}}if(Kekule.ObjUtils.isUnset(h.charDirection)){f.charDirection=b.DEFAULT}else{if(h.charDirection===b.INHERIT){f.charDirection=j.charDirection}}return f},RECT_INFO_FIELD:"__rectInfo__",ACTUAL_FONT_FIELD:"__drawFont__",RENDER_TEXT_FIELD:"__renderText__",RENDER_ELEM_FIELD:"__renderElem__",LOCAL_DRAW_OPTIONS_FIELD:"__drawOptions__",_setItemRectInfo:function(g,f,h){g[this.RECT_INFO_FIELD]={boundRect:Object.extend({},f),alignRect:Object.extend({},h)}},_getItemRectInfo:function(f){return f[this.RECT_INFO_FIELD]},_setActualFontInfo:function(f,g){f[this.ACTUAL_FONT_FIELD]=g},_getActualFontInfo:function(f){return f[this.ACTUAL_FONT_FIELD]},_setRenderText:function(f,g){f[this.RENDER_TEXT_FIELD]=g},_getRenderText:function(f){return f[this.RENDER_TEXT_FIELD]||f.text},_setRenderElem:function(f,g){f[this.RENDER_ELEM_FIELD]=g},_getRenderElem:function(f){return f[this.RENDER_ELEM_FIELD]},_itemHasNoAlignRect:function(g){var f=Kekule.ObjUtils.notUnset(g._noAlignRect)?(!!g._noAlignRect):(e.isSubscript(g)||e.isSuperscript(g));return f},drawEx:function(i,m,h,q,n){var j;if(!q){j=this.options}else{j=Object.create(this.options||{});j=Object.extend(j,q)}if(!j.defaultCharDirection){j.defaultCharDirection=j.charDirection}var k=this.cloneRichText(h);var l=this.getDrawBridge();var g={delayDrawing:l.canMeasureText(),adjustDrawing:l.canModifyText()};this.doPrepare(i,m,k,j,g);var f=this.doRenderRichText(i,k,j,g);var o=this._getItemRectInfo(k).boundRect;var p={drawnObj:f,boundRect:o};return p},draw:function(h,j,i,g,f){return this.drawEx(h,j,i,g,f).drawnObj},doPrepare:function(j,n,i,q,h){var r=this.doPrepareItem(j,i,q,h);var k=null;if(q.textBoxAlignmentMode===Kekule.Render.TextBoxAlignmentMode.ANCHOR){k=this.doGetRootAnchorItemAbsAlignRect(i)}var g=this._getItemRectInfo(i);var p;if(k){var o=this.doAlignRectToCoord(n,k,q.textBoxXAlignment,q.textBoxYAlignment);p={x:o.left-k.left,y:o.top-k.top}}else{var l=this.doAlignRectToCoord(n,g.alignRect,q.textBoxXAlignment,q.textBoxYAlignment);p={x:l.left-g.alignRect.left,y:l.top-g.alignRect.top}}var m=Kekule.RectUtils.shiftRect(g.alignRect,p.x,p.y);var f=Kekule.RectUtils.shiftRect(g.boundRect,p.x,p.y);this._setItemRectInfo(i,f,m);return r},doAlignRectToCoord:function(i,m,f,l){var k=Kekule.Render.BoxXAlignment;var g=Kekule.Render.BoxYAlignment;var j=(f===k.RIGHT)?-1:(f===k.CENTER)?-0.5:0;var h=(l===g.TOP)?0:(l===g.CENTER)?-0.5:-1;var n=Object.extend({},m);n.left=i.x+n.width*j;n.top=i.y+n.height*h;return n},doGetRootAnchorItemAbsAlignRect:function(g){var h=g;if(h.anchorItem){var f=this._getItemRectInfo(h).alignRect;var i={x:f.left,y:f.top};while(h.anchorItem){h=h.anchorItem;f=this._getItemRectInfo(h).alignRect;i.x+=f.left;i.y+=f.top}return Kekule.RectUtils.createRect(i.x,i.y,f.width,f.height)}else{return null}},doCalcActualDrawFontInfo:function(h,m){function j(l,o){if(typeof(l)==="string"){var i=Kekule.StyleUtils.analysisUnitsValue(l);i.value=Math.round(Math.max(i.value*o,1));return""+i.value+i.units}else{return l*o}}var f={sizeScale:1};for(var k=0,g=this._FONT_OPTION_FIELDS.length;k<g;++k){var n=this._FONT_OPTION_FIELDS[k];if(Kekule.ObjUtils.notUnset(m[n])){f[n]=m[n]}}if(Kekule.ObjUtils.notUnset(m.zoom)){f.fontSize=j(f.fontSize,m.zoom||1)}if(e.isSuperscript(h)){f.sizeScale=m.supFontSizeRatio;f.fontSize=j(f.fontSize,m.supFontSizeRatio);f.isSup=true;if(Kekule.ObjUtils.isUnset(f.overhang)){f.overhang=m.superscriptOverhang||0}}else{if(e.isSubscript(h)){f.sizeScale=m.subFontSizeRatio;f.fontSize=j(f.fontSize,m.subFontSizeRatio);f.isSub=true;if(Kekule.ObjUtils.isUnset(f.oversink)){f.oversink=m.subscriptOversink||0}}}return f},doPrepareItem:function(h,j,g,k){var l=e.getItemType(j);var i=Object.create(g);i=this._fillLocalDrawOptions(j,i);if(i.charDirection===b.DEFAULT||Kekule.ObjUtils.isUnset(i.charDirection)){i.charDirection=i.defaultCharDirection}var f;switch(l){case c.SECTION:f=this.doPrepareSection(h,j,i,k);break;case c.LINES:f=this.doPrepareLines(h,j,i,k);break;default:f=this.doPrepareGroup(h,j,i,k);break}return f},doPrepareSection:function(g,q,v,f){var j=this.getDrawBridge();var k=this.doCalcActualDrawFontInfo(q,v);this._setActualFontInfo(q,k);var t=q.text;if(a.isVerticalLine(v.charDirection)&&(t.length>1)){var s=q;s.role="group";delete s.text;s.charDirection=v.charDirection;var p=Object.create(v);p=Object.extend(p,k);s.items=[];for(var n=0,h=t.length;n<h;++n){e.appendText(s,t.charAt(n))}return this.doPrepareItem(g,s,p,f)}if(v.charDirection===b.RTL){t=t.reverse()}this._setRenderText(q,t);var o;if(f.delayDrawing){o=j.measureText(g,t,k)}else{var m={x:-10000,y:-10000};var r=this.getDrawBridge().drawText(g,m,t,k);this._setRenderElem(q,r);o=j.measureDrawnText(g,r,k)}var u={left:0,top:0,width:o.width||0,height:o.height||0};this._setItemRectInfo(q,u,u)},doPrepareLines:function(g,o,q,f){var h=q.charDirection||b.DEFAULT;var n=o.items;var k=(h===b.TTB)?b.RTL:(h===b.BTT)?b.LTR:b.TTB;for(var m=0,j=n.length;m<j;++m){var p=n[m];if(!p.charDirection){p.charDirection=h}}o.charDirection=k;q.charDirection=k;q._originCharDirection=h;return this.doPrepareGroup(g,o,q,f)},doPrepareGroup:function(j,u,m,B){var z=u.items;for(var G=0,D=z.length;G<D;++G){var M=z[G];this.doPrepareItem(j,M,m,B)}var Q=m.charDirection||b.DEFAULT;var t=m._originCharDirection||Q;var q=a.isHorizontalLine(Q);var n=q?"x":"y";var h=q?"y":"x";var g;var E=d.getAbsAlign(m.horizontalAlign,t);var x=d.getAbsAlign(m.verticalAlign,t);if(q){g=(x==d.TOP)?0:(x==d.CENTER)?-0.5:-1}else{g=(E==d.RIGHT)?-1:(E==d.CENTER)?-0.5:0}var o={x:0,y:0};var s=((Q===b.RTL)||(Q===b.BTT))?-1:1;var I=q?"left":"top";var O=q?"top":"left";var w=[];for(var G=0,D=z.length;G<D;++G){var M=z[G];var k=this._getItemRectInfo(M);var f=k.boundRect;var A=k.alignRect;if(s>0){var H=o[n]-f[I];f[I]=o[n];A[I]+=H}var L={x:f.width,y:f.height};o[n]+=L[n]*s;if(s<0){var H=o[n]-f[I];f[I]=o[n];A[I]+=H}var L={x:A.width,y:A.height};var v=this._getActualFontInfo(M);if(v){isSupSub=v.isSup||v.isSub}else{isSupSub=false}if(isSupSub&&e.getActualRefItem(M,u)){w.push(M)}else{var K=v?(v.oversink||(-(v.overhang||0))):0;if(!q){K=-K}var J=L[h]*(g+K);var P=A[O]-J;A[O]=J;f[O]-=P}}for(var G=0,D=w.length;G<D;++G){var M=w[G];var y=e.getActualRefItem(M,u);var v=this._getActualFontInfo(M);var k=this._getItemRectInfo(M);var F=this._getItemRectInfo(y).alignRect;var f=k.boundRect;var A=k.alignRect;if(v.isSup){var N=v.overhang;if(q){A.top=F.top;A.height=F.height;f.top=F.top-F.height*N}else{A.left=F.left;A.width=F.width;f.left=F.lefy+F.width-f.left+F.width*N}}else{var K=v.oversink;if(q){A.top=F.top;A.height=F.height;f.top=F.top+F.height-f.height+F.height*K}else{A.left=F.left;A.width=F.width;f.left=F.left-F.width*K}}}var z=u.items;var r=null;var p=null;for(var G=0,D=z.length;G<D;++G){var M=z[G];k=this._getItemRectInfo(M);if((!this._itemHasNoAlignRect(M))||((!r)&&(G==D-1))){if(!r){r=Object.extend({},k.alignRect)}else{r=Kekule.RectUtils.getContainerRect(r,k.alignRect)}}if(!p){p=Object.extend({},k.boundRect)}else{p=Kekule.RectUtils.getContainerRect(p,k.boundRect)}}if(z.length<=0){r=Kekule.RectUtils.createRect(0,0,0,0);p=Kekule.RectUtils.createRect(0,0,0,0)}var P={x:-r.left,y:-r.top};if((P.x!==0)||(P.y!==0)){for(var G=0,D=z.length;G<D;++G){k=this._getItemRectInfo(z[G]);k.alignRect=Kekule.RectUtils.shiftRect(k.alignRect,P.x,P.y);k.boundRect=Kekule.RectUtils.shiftRect(k.boundRect,P.x,P.y)}r.left=0;r.top=0;p.left+=P.x;p.top+=P.y}this._setItemRectInfo(u,p,r)},doRenderRichText:function(g,i,f,j){var k=this.getDrawBridge();var h=k.createGroup(g);this.doRenderItem(g,{x:0,y:0},i,j,h);return h},doRenderItem:function(g,k,i,j,h){var l=e.getItemType(i);var f;switch(l){case c.SECTION:f=this.doRenderSection(g,k,i,j,h);break;default:f=this.doRenderGroup(g,k,i,j,h);break}return f},doRenderGroup:function(g,o,p,f,n){var m=p.items;if(m.length<=0){return null}var q=this._getItemRectInfo(p);var k={x:o.x+q.alignRect.left,y:o.y+q.alignRect.top};for(var j=0,h=m.length;j<h;++j){this.doRenderItem(g,k,m[j],f,n)}},doRenderSection:function(i,o,q,h,n){var g=this._getItemRectInfo(q);var f=g.boundRect;var m={x:f.left,y:f.top};m=Kekule.CoordUtils.add(m,o);var p=this._getRenderText(q);var j=this._getActualFontInfo(q);var l=this.getDrawBridge();var k;if(h.delayDrawing){k=l.drawText(i,m,p,j)}else{if(h.adjustDrawing){k=this._getRenderElem(q);l.modifyDrawnTextCoord(i,k,m)}}l.addToGroup(k,n)}})})();Kekule.Render.BoundInfoRecorder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.BoundInfoRecorder",initialize:function($super,a){$super();this.setPropStoreFieldValue("boundInfos",new Kekule.TwoTupleMapEx(true));this._renderer=a;this.installEventListener(a)},finalize:function($super){var a=this.getPropStoreFieldValue("boundInfos");if(a){a.clear()}$super()},initProperties:function(){this.defineProp("boundInfos",{dataType:"Kekule.TwoTupleMapEx",serializable:false,setter:null});this.defineProp("targetContext",{dataType:DataType.OBJECT,serializable:false})},needRecordOnContext:function(a){var b=this.getTargetContext();return(!b)||(b===a)},installEventListener:function(a){a.addEventListener("updateBasicDrawObject",function(d){var c=Kekule.Render.ObjectUpdateType;if(this.needRecordOnContext(d.context)){var b=d.updateType;if(b===c.ADD){this.add(d.context,d.obj,d.parentObj,d.boundInfo,d.target)}else{if(b===c.MODIFY){this.modify(d.context,d.obj,d.parentObj,d.boundInfo,d.target)}else{if(b===c.REMOVE){this.remove(d.context,d.obj)}else{if(b===c.CLEAR){this.clear(d.context)}}}}this.invokeEvent("updateBasicDrawObject",d)}},this);a.addEventListener("clear",function(b){if(this.needRecordOnContext(b.context)){this.clearOnRenderer(b.context,b.target)}var c=this.getAllRecordedInfoOfContext(b.context)},this)},getInfo:function(a,b){return this.getBoundInfos().get(a,b)},getBelongedInfos:function(e,b){var g=this.getInfo(e,b);if(g){return[g]}else{var a=[];var h=this.getAllRecordedInfoOfContext(e);for(var d=0,c=h.length;d<c;++d){var g=h[d];var f=g.obj;if(f.isChildOf(b)){a.push(g)}}return a}},getBound:function(b,g){var c=this.getInfo(b,g);var m=c?c.boundInfo:null;if(!m){var e=Kekule.BoxUtils;var j=Kekule.Render.MetaShapeUtils;var k=this.getBelongedInfos(b,g);var a=null;for(var f=0,d=k.length;f<d;++f){var c=k[f];var h=j.getContainerBox(c.boundInfo,0);a=a?e.getContainerBox(a,h):h}if(a){m=j.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:a.x1,y:a.y1},{x:a.x2,y:a.y2}])}}return m},clearOnRenderer:function(b,c){var h=this.getBoundInfos();var f=h.getSecondLevelMap(b);if(f){var g=f.getKeys();var h=f.getValues();for(var a=g.length-1;a>=0;--a){var e=g[a];var d=h[a];if(d.renderer===c){f.remove(e)}}}},clear:function(a){var c=this.getBoundInfos();var b=c.getSecondLevelMap(a);if(b){b.clear()}return this},clearAll:function(){this.getBoundInfos().clear();return this},add:function(b,e,d,a,c){this.getBoundInfos().set(b,e,{obj:e,parentObj:d,boundInfo:a,renderer:c});return this},modify:function(b,g,f,a,e){var c=this.getBoundInfos().get(b,g);if(!c){c={};this.getBoundInfos.set(b,g,c)}var d=Kekule.ObjUtils.notUnset;if(d(f)){c.parentObj=f}if(d(a)){c.boundInfo=a}if(d(e)){c.renderer=e}return this},remove:function(a,c,b){this.getBoundInfos().remove(a,c);return this},getAllRecordedInfoOfContext:function(a){var c=this.getBoundInfos();var b=c.getSecondLevelMap(a);if(!b){return[]}else{return b.getValues()}},getAllBoundInfosOfContext:function(e){var f=this.getAllRecordedInfoOfContext(e);var a=[];for(var d=0,b=f.length;d<b;++d){var c=f[d].boundInfo;if(c){a.push(c)}}return a},getContainerBox:function(f){var d=Kekule.BoxUtils;var c=Kekule.Render.MetaShapeUtils;var a=null;var h=this.getAllBoundInfosOfContext(f);for(var e=0,b=h.length;e<b;++e){var g=c.getContainerBox(info[e],0);a=d.getContainerBox(a,g)}return a},getIntersectionInfos:function(a,e,j,h,f){var k=[];var g=this.getAllRecordedInfoOfContext(a);for(var d=0,b=g.length;d<b;++d){var c=g[d].boundInfo;if(f&&!f(g[d])){continue}if(c){if(Kekule.Render.MetaShapeUtils.isCoordInside(e,c,h)){k.push(g[d])}}}return k}});(function(){var b=Kekule.Render.BondRenderType;var e=Kekule.Render.TextDirection;var a=Kekule.BoxUtils;var d=Kekule.BondOrder;var c=Kekule.CoordUtils;var f=Kekule.oneOf;Kekule.Render.Abstract2DDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.Abstract2DDrawBridge",createContext:function(h,i,g){return null},releaseContext:function(g){},getContextDimension:function(g){return{}},setContextDimension:function(h,i,g){return null},getContextElem:function(g){},setContextViewBox:function(k,g,m,j,l,i){},clearContext:function(g){return null},setClearColor:function(h,g){},transformContextCoordToScreen:function(g,h){return h},transformScreenCoordToContext:function(g,h){return h},canModifyGraphic:function(g){return false},drawPath:function(h,i,g){},drawLine:function(h,j,i,g){},drawTriangle:function(h,k,j,i,g){},drawRect:function(h,j,i,g){},drawRoundRect:function(i,k,j,g,h){},drawCircle:function(i,j,g,h){},drawImage:function(i,k,j,h,g,l){},drawImageElem:function(i,k,j,h,g){},createGroup:function(g){return null},addToGroup:function(g,h){},removeFromGroup:function(g,h){},removeDrawnElem:function(g,h){},exportToDataUri:function(i,g,h){}});Kekule.Render.Base2DRenderer=Class.create(Kekule.Render.CompositeRenderer,{CLASS_NAME:"Kekule.Render.Base2DRenderer",initialize:function($super,i,g,h){$super(i,g,h);this.__$redirectContextDebug__=false;this._richTextDrawer=null},initProperties:function(){this.defineProp("richTextDrawerClass",{dataType:DataType.CLASS,serializable:false})},getActualTargetContext:function(g){return this.getRedirectContext()||g},getRendererType:function(){return Kekule.Render.RendererType.R2D},canMeasureText:function(g){return this.getDrawBridge().canMeasureText(g)},getAutoScaleRefDrawLength:function(g){return g.defBondLength},getAutoScaleRefObjLength:function(j,g){var h=j||this.getChemObj();if(h.getAllAutoScaleRefLengths){var i=h.getAllAutoScaleRefLengths(Kekule.CoordMode.COORD2D,g);if(i&&i.length){return Kekule.ArrayUtils.getMedian(i)}}else{return null}},getRichTextDrawer:function(){if(!this._richTextDrawer){var g=this.getRichTextDrawerClass()||Kekule.Render.BaseRichTextDrawer;this._richTextDrawer=new g(this.getDrawBridge())}return this._richTextDrawer},drawPath:function(h,i,g){return this.getDrawBridge().drawPath(this.getActualTargetContext(h),i,g)},drawLine:function(h,j,i,g){if(this.__$redirectContextDebug__){var k=Object.create(g);if(this.getRedirectContext()){k.color=k.strokeColor="#ff0000"}return this.getDrawBridge().drawLine(this.getActualTargetContext(h),j,i,k)}else{return this.getDrawBridge().drawLine(this.getActualTargetContext(h),j,i,g)}},drawArrowLine:function(g,i,h,p,j){var v=this.getActualTargetContext(g);if(!p){return this.drawLine(v,i,h,j)}else{var q=this.createDrawGroup(v);var r=this.drawLine(v,i,h,j);this.addToDrawGroup(r,q);var t=h.x-i.x;var s=h.y-i.y;var n=Math.atan(s/t);var A=Math.sign(t)||1;var u=(p.width||6)/2;var k=p.length||3;var y=Math.atan(u/k);var w=Math.sqrt(Math.sqr(u)+Math.sqr(k))*A;var z=Math.cos(n-y)*w;var o=Math.sin(n-y)*w;var x=Math.cos(n+y)*w;var m=Math.sin(n+y)*w;r=this.drawLine(v,h,{x:h.x-z,y:h.y-o},j);this.addToDrawGroup(r,q);r=this.drawLine(v,h,{x:h.x-x,y:h.y-m},j);this.addToDrawGroup(r,q);return q}},drawTriangle:function(h,k,j,i,g){return this.getDrawBridge().drawTriangle(this.getActualTargetContext(h),k,j,i,g)},drawRect:function(i,l,k,g){var j={x:Math.min(l.x,k.x),y:Math.min(l.y,k.y)};var h={x:Math.max(l.x,k.x),y:Math.max(l.y,k.y)};return this.getDrawBridge().drawRect(this.getActualTargetContext(i),j,h,g)},drawRoundRect:function(j,m,l,g,h){var k={x:Math.min(m.x,l.x),y:Math.min(m.y,l.y)};var i={x:Math.max(m.x,l.x),y:Math.max(m.y,l.y)};return this.getDrawBridge().drawRoundRect(this.getActualTargetContext(j),k,i,g,h)},drawCircle:function(i,j,g,h){return this.getDrawBridge().drawCircle(this.getActualTargetContext(i),j,g,h)},drawText:function(i,m,k,h){var j=this.getRichTextDrawer();var g=Kekule.Render.RichTextUtils.strToRichText(k,h);if(this.__$redirectContextDebug__){var l=Object.create(h||{});if(this.getRedirectContext()){l.color=l.strokeColor="#ff0000"}return j.drawEx(this.getActualTargetContext(i),m,g,l)}else{return j.drawEx(this.getActualTargetContext(i),m,g,h)}},drawRichText:function(h,l,j,g){var i=this.getRichTextDrawer();if(this.__$redirectContextDebug__){var k=Object.create(g||{});if(this.getRedirectContext()){k.color=k.strokeColor="#ff0000"}return i.drawEx(this.getActualTargetContext(h),l,j,k)}else{return i.drawEx(this.getActualTargetContext(h),l,j,g)}},drawImage:function(j,l,k,i,h,m){var g=this;return this.getDrawBridge().drawImage(this.getActualTargetContext(j),l,k,i,h,m,function(){return g.getActualTargetContext(j)})},drawImageElem:function(g,l,j,n,o){if(l.complete){return this.getDrawBridge().drawImageElem(this.getActualTargetContext(g),l,j,n,o)}else{var k=Kekule.X.Event;if(k){var m=this;var i=function(){k.removeListener(l,"load",h)};var h=function(){i(l,h);m.update(m.getActualTargetContext(g),[{obj:m.getChemObj()}],Kekule.Render.ObjectUpdateType.MODIFY)};k.addListener(l,"load",h);k.addListener(l,"error",i)}}},createDrawGroup:function(g){return this.getDrawBridge().createGroup(this.getActualTargetContext(g))},addToDrawGroup:function(g,h){return this.getDrawBridge().addToGroup(g,h)},removeFromDrawGroup:function(g,h){return this.getDrawBridge().removeFromGroup(g,h)},removeDrawnElem:function(g,h){return this.getDrawBridge().removeDrawnElem(this.getActualTargetContext(g),h)},transformScreenCoordToContext:function(g,h){return this.doTransformScreenCoordToContext(this.getActualTargetContext(g),h)},doTransformScreenCoordToContext:function(h,i){var g=this.getDrawBridge();return(g&&g.transformScreenCoordToContext)?g.transformScreenCoordToContext(this.getActualTargetContext(h),i):i}});Kekule.Render.ChemObj2DRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.Render.ChemObj2DRenderer",doEstimateSelfObjBox:function(i,h,g){return Kekule.Render.ObjUtils.getContainerBox(this.getChemObj(),this.getCoordMode(),g)},doEstimateRenderBox:function(i,j,h,g){var l=this.estimateObjBox(i,h,g);if(l){var k=this.prepareTransformParams(i,j,h,l);var m=k;return a.transform2D(l,m)}else{return null}},doGetAutoBaseCoord:function(i){var j=i.transformParams;if(j){var h=this.getChemObj();var g=h.getAbsBaseCoord?h.getAbsBaseCoord(Kekule.CoordMode.COORD2D):h.getAbsBaseCoord2D?h.getAbsBaseCoord2D():null;if(g){return Kekule.CoordUtils.transform2D(g,j)}}return null},doDraw:function($super,i,j,h){var g=this.getAutoScaleRefObjLength(this.getChemObj(),h.allowCoordBorrow);h.medianObjRefLength=g||h.defScaleRefLength;this.prepareTransformParams(i,j,h);this.prepareGeneralOptions(i,h);return $super(i,j,h)},prepareGeneralOptions:function(h,g){},prepareTransformParams:function(i,j,m,n){var g;if(m.transformParams){g=m.transformParams}else{var l=this.generateTransformParams(i,j,m,n);m.transformParams=l;g=l}var h=Kekule.CoordUtils.calcTransform2DMatrix(g);var k=Kekule.CoordUtils.calcInverseTransform2DMatrix(g);m.transformParams.transformMatrix=h;m.transformParams.invTransformMtrix=k;this.getRenderCache(i).transformParams=g;this.getRenderCache(i).transformMatrix=h;this.getRenderCache(i).invTransformMatrix=k;return g},calcPreferedTransformOptions:function(g,o,r,h){var s={};s.allowCoordBorrow=f(r.allowCoordBorrow,false);s.unitLength=r.unitLength||1;if(!h){h=this.estimateObjBox(g,r,s.allowCoordBorrow)}var p={x:(h.x1+h.x2)/2,y:(h.y1+h.y2)/2};var i=Kekule.ObjUtils;if(i.isUnset(r.translateX)&&i.isUnset(r.translateY)){if(o){s.translateX=o.x-p.x;s.translateY=o.y-p.y}}else{s.translateX=r.translateX||0;s.translateY=r.translateY||0}s.zoom=r.zoom||1;if((!r.scale)&&(!r.scaleX)&&(!r.scaleY)){if(r.autofit){var n=this.getDrawBridge().getContextDimension(g);n.x=n.width;n.y=n.height;n=this.getDrawBridge().transformScreenCoordToContext(g,n);n.width=n.x;n.height=n.y;var m=r.autofitContextPadding;m*=s.unitLength*2;h.width=h.x2-h.x1;h.height=h.y2-h.y1;var l=Math.max(n.width-m,0)/(h.width||1);var k=Math.max(n.height-m,0)/(h.height||1);if(i.isUnset(r.retainAspect)||(r.retainAspect)){s.scaleX=s.scaleY=Math.min(l,k)}else{s.scaleX=l;s.scaleY=k}}else{var q=f(r.refDrawLength,this.getAutoScaleRefDrawLength(r))||1;var j=r.medianObjRefLength;if(Kekule.ObjUtils.isUnset(j)){j=r.defScaleRefLength}s.scaleX=s.scaleY=(q/j)||1}}else{s.scaleX=f(r.scaleX,r.scale,1);s.scaleY=f(r.scaleY,r.scale,1)}if(i.notUnset(r.rotateAngle)){s.rotateAngle=r.rotateAngle}if(i.isUnset(r.center)){s.center=p}else{s.center=r.center}if(o){s.drawBaseCoord=o}else{s.drawBaseCoord=Kekule.CoordUtils.transform2D(p,s)}return s},generateTransformParams:function(h,i,k,l){var g=this.calcPreferedTransformOptions(h,i,k,l);var j=Object.extend({},g);g=this.getFinalTransformParams(h,g);g.initialTransformOptions=j;return g},getFinalTransformParams:function(h,i){var g=Object.create(i);if(g.zoom){g.scaleX*=g.zoom;g.scaleY*=g.zoom}g.scaleY=-g.scaleY;if(g.unitLength){g.translateX*=g.unitLength;g.translateY*=g.unitLength;g.drawBaseCoord.x*=g.unitLength;g.drawBaseCoord.y*=g.unitLength}return g},getRenderFinalTransformParams:function(g){return this.getRenderCache(g).transformParams},getRenderInitialTransformOptions:function(g){var h=this.getRenderFinalTransformParams(g);return h?h.initialTransformOptions:null},doTransformCoordToObj:function(h,j,i){var g=this.getRenderCache(h).invTransformMatrix;return Kekule.CoordUtils.transform2DByMatrix(i,g)},doTransformCoordToContext:function(h,j,i){var g=this.getRenderCache(h).transformMatrix;return Kekule.CoordUtils.transform2DByMatrix(i,g)}});Kekule.Render.RichTextBased2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.RichTextBased2DRenderer",DRAWN_OBJ_FIELD:"__$drawnObj__",initialize:function($super,i,g,h){$super(i,g,h);this.__$alwaysRecalcSize__=false;this.__$isRecalculatingSize=false},getDrawnObj:function(g){return this.getExtraProp(g,this.DRAWN_OBJ_FIELD)},setDrawnObj:function(g,h){this.setExtraProp(g,this.DRAWN_OBJ_FIELD,h)},getRichText:function(h,g){return null},extractRichTextDrawOptions:function(h){var g=Object.create(h||{});g.horizontalAlign=f(g.horizontalAlign,g.textHorizontalAlign);g.verticalAlign=f(g.verticalAlign,g.textVerticalAlign);g.charDirection=f(g.charDirection,g.textCharDirection);return g},getDrawTextCoord:function(g,h){return h},doDrawSelf:function($super,i,m,p){$super(i,m,p);var n=this.getChemObj();var j=p.transformParams;var h=this.getRichText(this.getChemObj(),p);if(!h){return null}if(!m){m=this.getAutoBaseCoord(p)}var g=this.getDrawTextCoord(i,m);var o=this.drawRichText(i,g,h,this.extractRichTextDrawOptions(p));var l=o.boundRect;var k=this.createRectBoundInfo({x:l.left,y:l.top},{x:l.left+l.width,y:l.top+l.height});this.basicDrawObjectUpdated(i,n,n,k,Kekule.Render.ObjectUpdateType.ADD);this.getRenderCache(i).drawnObj=o.drawnObj;this.setDrawnObj(i,o.drawnObj);if(this.getCanModifyTargetObj()&&(n.getNeedRecalcSize&&n.getNeedRecalcSize())||(this.__$alwaysRecalcSize__)){this._autosetObjSize(i,n,k)}return o.drawnObj},_autosetObjSize:function(i,m,j){if(this.__$isRecalculatingSize){return}if(m.hasProperty("size2D")&&m.setNeedRecalcSize){this.__$isRecalculatingSize=true;try{var k=j.coords;var h=this.transformCoordToObj(i,m,k[0]);var g=this.transformCoordToObj(i,m,k[1]);var l=Kekule.CoordUtils.substract(g,h);m.setPropStoreFieldValue("size2D",{x:Math.abs(l.x),y:Math.abs(l.y)});m.setNeedRecalcSize(false)}finally{this.__$isRecalculatingSize=false}}}});Kekule.Render.TextBlock2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.TextBlock2DRenderer",getRichText:function(i,h){var g=Kekule.Render.RichTextUtils.strToRichText(i.getText());return g},doEstimateSelfObjBox:function(i,h,g){return this.getChemObj().getBox2D(g)},getDrawTextCoord:function(g,m){var n=this.getChemObj();var h=n.getExposedContainerBox();var j={x:h.x1,y:h.y2};var i={x:h.x2,y:h.y1};var l=this.transformCoordToContext(g,n,j);var k=this.transformCoordToContext(g,n,i);var p=Kekule.CoordUtils.substract(k,l);var o={x:m.x-p.x/2,y:m.y-p.y/2};return o},extractRichTextDrawOptions:function($super,g){var h=$super(g);h.fontSize=f(h.fontSize,h.labelFontSize);h.fontFamily=f(h.fontFamily,h.labelFontFamily);h.color=f(h.color,h.labelColor);h.textBoxXAlignment=Kekule.Render.BoxXAlignment.LEFT;h.textBoxYAlignment=Kekule.Render.BoxYAlignment.TOP;return h}});Kekule.Render.Formula2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.Formula2DRenderer",basicDrawObjectUpdated:function($super,i,k,j,h,g){if(k===this.getChemObj()){return $super(i,k.getParent(),k.getParent(),h,g)}else{return $super(i,k,j,h,g)}},getRichText:function(h,g){return h.getDisplayRichText(true,g.displayLabelConfigs,g.partialChargeDecimalsLength,g.chargeMarkType)},doEstimateSelfObjBox:function(i,h,g){var j=this.getChemObj()?this.getChemObj().getParent():null;if(j){var k=(j)?j.getAbsBaseCoord2D(g):{x:0,y:0};return a.createBox(k,k)}else{return null}},extractRichTextDrawOptions:function($super,g){var h=$super(g);h.fontSize=f(h.fontSize,h.atomFontSize);h.fontFamily=f(h.fontFamily,h.atomFontFamily);h.color=f(h.color,h.labelColor,h.atomColor);h.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER;h.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER;return h}});Kekule.Render.TextBasedChemMarker2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.TextBasedChemMarker2DRenderer",initialize:function($super,i,g,h){$super(i,g,h)},doDrawSelf:function($super,h,i,g){return $super(h,i,g)},getRichText:function(l,j){var i=this.getChemObj();var k;if(i instanceof Kekule.ChemMarker.Charge){var h=i.getValue();k=Kekule.Render.ChemDisplayTextUtils.getChargeDisplayText(h,j.partialChargeDecimalsLength,j.chargeMarkType);if(k){return Kekule.Render.RichTextUtils.createSection(k,{charDirection:Kekule.Render.TextDirection.LTR})}}else{if(i instanceof Kekule.ChemMarker.Radical){var g=i.getValue();k=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(g,j.distinguishSingletAndTripletRadical);if(k){return Kekule.Render.RichTextUtils.createSection(k,{charDirection:Kekule.Render.TextDirection.LTR})}}}return null},doEstimateSelfObjBox:function($super,i,h,g){return $super(i,h,g)},extractRichTextDrawOptions:function($super,g){var h=$super(g);var i=this.getChemObj();h.fontSize=f(i.getRenderOption("fontSize"),h.chemMarkerFontSize,h.fontSize,h.atomFontSize);h.fontFamily=f(h.fontFamily,h.atomFontFamily);h.color=f(h.color,h.atomColor,h.labelColor);h.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER;h.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER;return h}});Kekule.Render.ImageBlock2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.ImageBlock2DRenderer",initialize:function($super,i,g,h){$super(i,g,h)},doDrawSelf:function($super,g,o,t){$super(g,o,t);var p=this.getChemObj();var h=t.transformParams;if(!p||!p.getSrc||!p.getSrc()){return null}if(!o){o=this.getAutoBaseCoord(t)}var j=p.getExposedContainerBox();var l={x:j.x1,y:j.y2};var k={x:j.x2,y:j.y1};var n=this.transformCoordToContext(g,p,l);var m=this.transformCoordToContext(g,p,k);var s=Kekule.CoordUtils.substract(m,n);var i={x:o.x-s.x/2,y:o.y-s.y/2};var r;var q=p.getCacheImg();if(q){r=this.drawImageElem(g,q,i,s,t)}else{r=this.drawImage(g,p.getSrc(),i,s,t)}this.basicDrawObjectUpdated(g,p,p,this.createRectBoundInfo(i,Kekule.CoordUtils.add(i,s)),Kekule.Render.ObjectUpdateType.ADD);return r}});Kekule.Render.UnbondedElectronSetRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.UnbondedElectronSetRenderer",_extractActualDrawOptions:function(g){var h=Object.create(g);var i=this.getChemObj();h.fontSize=f(i.getRenderOption("fontSize"),h.chargeMarkFontSize,h.fontSize,h.atomFontSize);h.color=f(h.color,h.atomColor,h.labelColor);h.strokeColor=h.color;h.fillColor=h.color;h.electronGap=h.fontSize/3*(h.unitLength||1)*(h.zoom||1);h.electronRadius=h.fontSize/12*(h.unitLength||1)*(h.zoom||1);return h},_drawSingleElectron:function(i,j,g,h){return this.drawCircle(i,j,g,h)},_drawElectrons:function(j,h,B,x,m){var w=c.substract(B,x);var n=c.getDistance(w);var D;var o;if(n===0){var D=0;var o=1}else{var D=w.x/n;var o=w.y/n}var s=m.electronGap;var l=m.electronRadius;var p={x:s*o,y:-s*D};var g=(h-1)/2;var k=c.substract(B,c.multiply(p,g));var v=[];var q=(h>1)?this.createDrawGroup(j):null;var A;for(var y=0;y<h;++y){v.push(k);A=this._drawSingleElectron(j,k,l,m);if(q){this.addToDrawGroup(A,q)}k=c.add(k,p)}var z;if(v.length<=1){z=this.createCircleBoundInfo(v[0],l)}else{var r=c.multiply(p,l*2/s);var u=c.substract(v[0],r);var t=c.add(v[h-1],r);z=this.createLineBoundInfo(u,t,l)}return{electronCoords:v,drawnElem:q||A,electronRadius:l,boundInfo:z}},_doGetParentCoord:function(h,j,g){var l=g.transformParams;if(l){var k=j;var i=k.getAbsBaseCoord?k.getAbsBaseCoord(Kekule.CoordMode.COORD2D):k.getAbsBaseCoord2D?k.getAbsBaseCoord2D():null;if(i){return c.transform2D(i,l)}}return null},doDrawSelf:function($super,h,p,r){$super(h,p,r);var i=this._extractActualDrawOptions(r);var q=this.getChemObj();var l=q.getParent();var j=r.transformParams;if(!q||!l||!q.getElectronCount||(q.getElectronCount()||0)<=0){return null}if(!p){p=this.getAutoBaseCoord(r)}var k=this._doGetParentCoord(h,l,r);if(!p||!k){return null}var n=this._drawElectrons(h,q.getElectronCount(),p,k,i);var o=n.electronCoords;var m=n.electronRadius;this.basicDrawObjectUpdated(h,q,l,n.boundInfo,Kekule.Render.ObjectUpdateType.ADD);var g=n.drawnElem;return g}});Kekule.Render.Ctab2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.Ctab2DRenderer",DRAW_ELEM_FIELD:"__$drawElem__",TRANSFORM_COORD_FIELD:"__$transCoord2D__",TRANSFORM_MATRIX_FIELD:"__$transMatrix__",RENDERED_OBJS_FIELD:"__$renderedObjs__",INV_TRANSFORM_MATRIX_FIELD:"__$inverseTransMatrix__",CHILD_TRANSFORM_MATRIX_FIELD:"__$childTransMatrix__",doEstimateSelfObjBox:function(i,h,g){var j=this.getChemObj().getExposedContainerBox2D(g);return j},getObjDrawElem:function(g,h){return this.getExtraProp2(g,h,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(g,i,h){this.setExtraProp2(g,i,this.DRAW_ELEM_FIELD,h)},getRenderedObjs:function(g){return this.getExtraProp(g,this.RENDERED_OBJS_FIELD)},addRenderedObj:function(g,h){var i=this.getRenderedObjs(g);if(!i){i=[h];this.setExtraProp(g,this.RENDERED_OBJS_FIELD,i)}else{Kekule.ArrayUtils.pushUnique(i,h)}},removeRenderedObj:function(g,h){var i=this.getRenderedObjs(g);if(i){Kekule.ArrayUtils.remove(i,h)}},clearRenderedObj:function(g){this.setExtraProp(g,this.RENDERED_OBJS_FIELD,null)},prepareGeneralOptions:function($super,h,g){return $super(h,g)},doPrepare:function($super,h,j,i,g){$super(h,j,i,g)},handleNodeSpecifiedRenderOptions:function(i,h){var j=(i.getOverriddenRenderOptions?i.getOverriddenRenderOptions():null)||{};var g=Object.create(h);g=Object.extend(g,j);return g},handleConnectorSpecifiedRenderOptions:function($super,i,h){var j=(i.getOverriddenRenderOptions?i.getOverriddenRenderOptions():null)||{};var g=Object.create(h||null);g=Object.extend(g,j);return g},isChemObjRenderedBySelf:function($super,i,j){var h=this.getRenderedObjs(i);var g=$super(i,j)||(h&&(h.indexOf(j)>=0))||(this.getChemObj().hasChildObj(j)&&(!j.isExposed||j.isExposed()));return g},isChemObjRenderedDirectlyBySelf:function($super,h,i){var g=this.getRenderedObjs(h);return $super(h,i)||(g&&(g.indexOf(i)>=0))},doDrawSelf:function($super,i,k,h){$super(i,k,h);var l=this.getChemObj();this._ctab=l;var j=h.transformParams;this.getRenderCache(i).transformOptions=j;this.transformCtabCoords2DToContext(i,l,j);this.doPrepare(i,l,k,h);this.getRenderCache(i).appliedOptions=h;var g=this.doDrawCore(i,l,h,j);return g},doRedraw:function(g){var h=this.getRenderCache(g);return this.doDrawCore(g,this.getChemObj(),h.appliedOptions,h.transformOptions)},doDrawCore:function(h,k,g,i){this.clearRenderedObj(h);var j=this.createDrawGroup(h);this.doDrawConnectors(h,j,k,g,i);this.doDrawNodes(h,j,k,g,i);this.setObjDrawElem(h,k,j);return j},doUpdateSelf:function($super,i,k,g){if(this.canModifyGraphic(i)){var j=false;var h=Kekule.Render.ObjectUpdateType;switch(g){case h.ADD:j=this.doAddNew(i,k);break;case h.MODIFY:j=this.doModify(i,k);break;case h.REMOVE:j=this.doRemove(i,Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(k));break;default:return $super(i,k,g)}return j}else{return $super(i,updatedObjs,g)}},doAddNew:function(g,h){if(this.canModifyGraphic()){return this.doModify(g,h)}else{return false}},doModify:function(h,o){if(this.canModifyGraphic()){var n=this._extractObjsOfUpdateObjDetails(o);this.remove(h,n);var q=this.getChemObj();var p=this.getObjDrawElem(h,q);var g=this.getRenderCache(h);var r=g.appliedOptions;if(n.indexOf(q)>=0){this.draw(h,g.baseCoord,r)}for(var m=0,j=n.length;m<j;++m){var k=n[m];if(!k.isExposed||k.isExposed()){if(q.hasConnector(k)){this.doDrawConnector(h,p,k,this.getChemObj(),r,g.transformParams||{})}else{if(q.hasNode(k)){this.doDrawNode(h,p,k,this.getChemObj(),r,g.transformParams)}}}}return true}else{return false}},doRemove:function(j,o){if(this.canModifyGraphic()){var p=Kekule.ArrayUtils.toArray(o);for(var h=0,g=p.length;h<g;++h){var n=p[h];var k=this.getObjDrawElem(j,n);if(k){var m=this.getObjDrawElem(j,this.getChemObj());this.removeFromDrawGroup(k,m);this.removeDrawnElem(j,k)}this.removeRenderedObj(j,n);this.removeExtraProp2(j,n);this.basicDrawObjectUpdated(j,n,this.getChemObj(),null,Kekule.Render.ObjectUpdateType.REMOVE)}return true}else{return false}},getCoordTransformOptions:function(g){return this.getRenderCache(g).transformOptions},transformCtabCoords2DToContext:function(g,q,n){var k=n.allowCoordBorrow;var o=Object.extend({},n);o.centerX=0;o.centerY=0;var t;var p=n.transformMatrix;this.setExtraProp2(g,q,this.TRANSFORM_MATRIX_FIELD,p);var h=p;this.setExtraProp2(g,q,this.CHILD_TRANSFORM_MATRIX_FIELD,p);var s=n.invTransformMatrix;this.setExtraProp2(g,q,this.INV_TRANSFORM_MATRIX_FIELD,s);for(var r=0,m=q.getNodeCount();r<m;++r){var j=q.getNodeAt(r);this.transformObjCoord2DToContext(g,j,p,h,k)}},transformObjCoord2DToContext:function(g,n,k,o,h){var r;if(n&&n.getAbsBaseCoord2D){var p=n.getAbsBaseCoord2D(h);if(p){var q=Kekule.CoordUtils.transform2DByMatrix(p,k);this.setTransformedCoord2D(g,n,q);r=q}if(n.getNodes){for(var m=0,j=n.getNodeCount();m<j;++m){this.transformObjCoord2DToContext(g,n.getNodeAt(m),o,o,h)}}}return r},getTransformedCoord2D:function(k,n,j){if(Kekule.ObjUtils.isUnset(j)){j=this.getRenderCache(k).options.transformParams.allowCoordBorrow}var m=n instanceof Kekule.BaseStructureNode;var h=m&&this.getExtraProp2(k,n,this.TRANSFORM_COORD_FIELD);if(!h){var l=this.getChemObj();var i=this.getExtraProp2(k,l,this.TRANSFORM_MATRIX_FIELD);var g=this.getExtraProp2(k,l,this.CHILD_TRANSFORM_MATRIX_FIELD);if(l&&(l.hasNode(n,false)||l.hasConnector(n,false))){h=this.transformObjCoord2DToContext(k,n,i,g,j)}else{h=this.transformObjCoord2DToContext(k,n,g,g,j)}}return h},setTransformedCoord2D:function(g,h,i){this.setExtraProp2(g,h,this.TRANSFORM_COORD_FIELD,i)},doTransformCoordToObj:function($super,h,j,i){var g=this.getExtraProp2(h,j,this.INV_TRANSFORM_MATRIX_FIELD);if(g){return Kekule.CoordUtils.transform2DByMatrix(i,g)}else{return $super(h,j,i)}},doTransformCoordToContext:function($super,h,j,i){var g=this.getExtraProp2(h,j,this.TRANSFORM_MATRIX_FIELD);if(g){return Kekule.CoordUtils.transform2DByMatrix(i,g)}else{return $super(h,j,i)}},doDrawNodes:function(h,r,p,s,k){var g=p.getExposedNodes();for(var q=0,o=g.length;q<o;++q){var n=g[q];var j=this.handleNodeSpecifiedRenderOptions(n,s);var m=this.doDrawNode(h,r,n,p,j,k)}},doDrawNode:function(h,l,j,k,g,i){},doDrawConnectors:function(g,r,p,s,j){var k=p.getExposedConnectors();for(var q=0,o=k.length;q<o;++q){var n=k[q];var h=this.handleConnectorSpecifiedRenderOptions(n,s);var m=this.doDrawConnector(g,r,n,p,h,j)}},doDrawConnector:function(h,r,g,p,m,u){var t;var s=g.getConnectedExposedObjs();var v=s.length;if(v<2){return null}var A,y;var l,k;var B;var D=(v>2)?this.createDrawGroup(h):null;var o;var n=(v>2)?[]:null;var q=m;for(var x=0;x<v;++x){A=s[x];l=this.getTransformedCoord2D(h,A,u.allowCoordBorrow);if(l){for(var w=x+1;w<v;++w){y=s[w];k=this.getTransformedCoord2D(h,y,u.allowCoordBorrow);if(k){o=this.doDrawConnectorShape(h,g,A,y,q,u);if(o){B=o.element;if(B&&D){this.addToDrawGroup(B,D)}var z=o.boundInfo;if(n){n.push(z)}}}}}}t=D||B;if(t&&r){this.addToDrawGroup(t,r)}if(t){this.setObjDrawElem(h,g,t)}else{this.setObjDrawElem(h,g,null)}this.addRenderedObj(h,g);if(z||n){this.basicDrawObjectUpdated(h,g,p,n||z,Kekule.Render.ObjectUpdateType.ADD)}return t},doDrawConnectorShape:function(k,h,j,g,i,l){}});Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.Render.Ctab2DRenderer);Kekule.Render.ChemCtab2DRenderer=Class.create(Kekule.Render.Ctab2DRenderer,{CLASS_NAME:"Kekule.Render.ChemCtab2DRenderer",OBJ_NEED_LABEL_FIELD:"__$needDrawLabel__",OBJ_NEED_DOT_FIELD:"__$needDrawDot__",getObjNeedDrawLabel:function(h,j){var g=this.getExtraProp2(h,j,this.OBJ_NEED_LABEL_FIELD);if(Kekule.ObjUtils.isUnset(g)){var i=this.getRenderCache(h).appliedOptions;g=(j instanceof Kekule.ChemStructureConnector)?false:this._needNodeDrawLabel(j,i);this.setObjNeedDrawLabel(h,j,g)}return g},setObjNeedDrawLabel:function(g,i,h){this.setExtraProp2(g,i,this.OBJ_NEED_LABEL_FIELD,h)},getObjNeedDrawDot:function(h,j){var i=this.getRenderCache(h).appliedOptions;var g=(j instanceof Kekule.ChemStructureConnector)?false:this._needNodeDrawDot(h,j,i);return g},doPrepare:function($super,h,p,o,q){$super(h,p,o,q);if(!q.fontSize){q.fontSize=q.atomFontSize}q.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER;q.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER;var g=p.getExposedNodes();for(var n=0,k=g.length;n<k;++n){var j=g[n];var m=this._needNodeDrawLabel(j,q);this.setObjNeedDrawLabel(h,j,m)}},handleNodeSpecifiedRenderOptions:function($super,i,h){var g=$super(i,h);if(!g.color&&g.atomColor){g.color=g.atomColor}if(!g.fontFamily&&g.atomFontFamily){g.fontFamily=g.atomFontFamily}if(!g.fontSize&&g.atomFontSize){g.fontSize=g.atomFontSize}return g},handleConnectorSpecifiedRenderOptions:function($super,i,h){var g=$super(i,h);if(!g.color&&g.bondColor){g.color=g.bondColor}return g},doDrawNode:function(W,x,G,m,A,S){var u;var R;var s=this.getTransformedCoord2D(W,G,S.allowCoordBorrow);var o=A;var r=G.getAtomicNumber?G.getAtomicNumber():0;var w=G.getOverriddenRenderOptions()||{};var J=w.color||w.atomColor;if(J){o.color=J}else{if(o.useAtomSpecifiedColor){var F;if(r<=0){var E=G.getClassLocalName();F=Kekule.Render.RenderColorUtils.getColor(E,this.getRendererType())}else{F=Kekule.Render.RenderColorUtils.getColor(r,this.getRendererType())}o.color=F}}var g=G.getCharge()||G.getRadical();var K=(G.getCharge()&&!G.fetchChargeMarker(false));var t=(G.getRadical()&&!G.fetchRadicalMarker(false));var v=false;if(this.getObjNeedDrawLabel(W,G)){v=true;var p=Kekule.Render.HydrogenDisplayLevel.ALL;var N=!!(K||t);var O=G.getDisplayRichText(p,N,o.displayLabelConfigs,o.partialChargeDecimalsLength,o.chargeMarkType,o.distinguishSingletAndTripletRadical);var j=!o.charDirection?this._decideNodeLabelCharDirection(W,G):o.charDirection;o.fontSize*=o.unitLength;var z=Object.create(o);z.charDirection=j;var H=this.drawRichText(W,s,O,z);var Q=H.drawnObj;var B=H.boundRect;R=this.createRectBoundInfo({x:B.left,y:B.top},{x:B.left+B.width,y:B.top+B.height});u=Q}else{var V,T;if(this.getObjNeedDrawDot(W,G)&&Kekule.ObjUtils.isUnset(o.atomRadius)){o.atomRadius=o.allenCenterAtomRadius}if(o.atomRadius){var M=o.atomRadius*o.unitLength;o.strokeColor=o.color;o.fillColor=o.color;V=this.drawCircle(W,s,M,o);R=this.createCircleBoundInfo(s,M)}else{R=this.createPointBoundInfo(s)}if(K||t){var H=this.doDrawElectronStateMark(W,x,G,o.chargeMarkType,o.partialChargeDecimalsLength,o.distinguishSingletAndTripletRadical,o.fontFamily,o.chargeMarkFontSize*o.unitLength,o.chargeMarkMargin*o.unitLength,o.chargeMarkCircleWidth*o.unitLength,o.color,o.opacity,o.zoom||1);if(H){T=H.drawnObj}}if(V&&T){u=this.createDrawGroup(W);this.addToDrawGroup(u,V);this.addToDrawGroup(u,T)}else{u=V||T}}if(G.getUnplacedMarkers(this.getCoordMode()).length>=0){var h;var l=o.chemMarkerMargin;if(v){var I=1;var k=this._getNodeFontSize(W,G)*(S.zoom||1);var y=k*o.unitLength*I/2;l+=y-l/2;var q=Kekule.Render.TextDirection;var n=[q.LTR,q.RTL,q.TTB,q.BTT];var L=(j===q.LTR)?{x:1,y:0}:(j===q.RTL)?{x:-1,y:0}:(j===q.TTB)?{x:0,y:1}:(j===q.BTT)?{x:0,y:-1}:{x:0,y:0};var i={x:L.x*S.scaleX,y:L.y*S.scaleY};h=(i.x>0)?0:(i.x<0)?Math.PI:(i.y>0)?Math.PI/2:(i.y<0)?Math.PI*3/2:null}var P=l/o.defBondLength*o.medianObjRefLength;this.doAdjustChemPropMarkerPos(G,P,S.allowCoordBorrow,Kekule.ObjUtils.notUnset(h)?[h]:[])}if(u){this.setObjDrawElem(W,G,u);if(x){this.addToDrawGroup(u,x)}}else{this.setObjDrawElem(W,G,null)}this.addRenderedObj(W,G);this.basicDrawObjectUpdated(W,G,m,R,Kekule.Render.ObjectUpdateType.ADD);return u},_getNodeFontSize:function(g,h,i){if(!i){i=this.getRenderCache(g).appliedOptions||this.getRenderCache(g).options}var j=Kekule.Render.RenderOptionUtils.getNodeLabelDrawOptions(h.getOverriddenRenderOptions())||{};return f(j.fontSize,i.fontSize,i.atomFontSize)},_getNodeHydrogenDisplayLevel:function(i,j){var k=i.getOverriddenRenderOptions();var h=Kekule.Render.RenderOptionUtils.getHydrogenDisplayLevel(k);var g=Kekule.ObjUtils.notUnset(h)?h:((j.moleculeDisplayType===Kekule.Render.MoleculeDisplayType.CONDENSED)?Kekule.Render.HydrogenDisplayLevel.ALL:j.hydrogenDisplayLevel);return g},_needNodeDrawDot:function(i,j,k){var m=j.getOverriddenRenderOptions();if(!(j instanceof Kekule.Atom)){return false}else{if(j.getAtomicNumber()!==Kekule.Render.DEF_ATOM_ATOMIC_NUM){return false}else{if(this.getObjNeedDrawLabel(i,j)){return false}var h=j.getLinkedBonds();if(h.length===2){var l=j.getLinkedMultipleBonds();if(l.length===2){if(l[0].getBondOrder()===l[1].getBondOrder()){var g=l[0].getBondOrder();return g>=d.DOUBLE&&g<d.EXPLICIT_AROMATIC}}}return false}}},_needNodeDrawLabel:function(i,p){var k=Kekule.Render.RenderOptionUtils;var m=Kekule.Render.NodeLabelDisplayMode;var g=i.getOverriddenRenderOptions();var l=k.getNodeDisplayMode(g)||p.nodeDisplayMode;if(!(i instanceof Kekule.ChemStructureNode)){return false}if(l===m.HIDDEN){return false}else{if(l===m.SHOWN){return true}else{var j=p.moleculeDisplayType;if(j===Kekule.Render.MoleculeDisplayType.CONDENSED){return true}else{var h=i.getLinkedConnectors();if(h.length<=0){return true}if((i instanceof Kekule.Atom)&&(i.getAtomicNumber()===Kekule.Render.DEF_ATOM_ATOMIC_NUM)&&(!i.getMassNumber())){if(i.getRenderOption("customLabel")){return true}var n=this._getNodeHydrogenDisplayLevel(i,p);var o=Kekule.Render.HydrogenDisplayLevel;if((n===o.ALL)||(n===o.NONE)){return true}else{if(n===o.UNMATCHED_EXPLICIT){return(i.getImplicitHydrogenCount()!==i.getExplicitHydrogenCount())}else{return Kekule.ObjUtils.notUnset(i.getExplicitHydrogenCount())}}}else{return true}}}}},_isNodeHasConnectorToDirection:function(n,k,g){if(Kekule.ObjUtils.isUnset(g)){g=1/5}for(var j=0,h=n.length;j<h;++j){var m=n[j];if((k===e.LTR)&&(m.x>g)){return true}else{if((k===e.RTL)&&(m.x<-g)){return true}}if((k===e.TTB)&&(m.y>g)){return true}else{if((k===e.BTT)&&(m.y<-g)){return true}}}return false},_calcConnectorVectorWeight:function(j){var p=0;var n=0;var m=function(i,q){var l=100;if(q==0){return l}else{return Math.min(l,Math.pow(i/q,2))}};var o=1;var k=1;for(var h=0,g=j.length;h<g;++h){p+=j[h].x*m(j[h].x,j[h].y)*o;n+=j[h].y*m(j[h].y,j[h].x)*k}return{x:p,y:n}},_calcConnectorVectorOfNode:function(k,m){var g={x:0,y:0};var n=this._getStandardizedLinkedObjRelCoords(k,m,null);for(var j=0,h=n.length;j<h;++j){g.x+=n[j].x;g.y+=n[j].y}if(g.x===g.y===0){g={x:1,y:0}}return g},_calcVectorAxisDirection:function(g){var i=Math.abs(g.x);var h=Math.abs(g.y);if(i>=h){return(g.x>0)?e.LTR:e.RTL}else{return(g.y>0)?e.TTB:e.BTT}},_decideNodeLabelCharDirection:function(h,j){var k=this._getStandardizedLinkedObjRelCoords(h,j,null);var g=Kekule.Render.TextDirection;var p=[g.LTR,g.RTL,g.TTB,g.BTT];var q;for(var n=0,m=p.length;n<m;++n){if(!this._isNodeHasConnectorToDirection(k,p[n])){return p[n]}}var o=this._calcConnectorVectorWeight(k);if(Math.abs(o.x)>Math.abs(o.y)){if(o.x<=0){q=g.LTR}else{q=g.RTL}}else{if(o.y<=0){q=g.TTB}else{q=g.BTT}}return q},_calcConnectorAnglesOfNode:function(k,m){var g=[];var p=this._getStandardizedLinkedObjRelCoords(k,m,null);for(var j=0,h=p.length;j<h;++j){var o=p[j];var n=Math.atan2(o.y,o.x);if(n<0){n=Math.PI*2+n}g.push(n)}g.sort();return g},_getMostEmptyDirectionAngleOfNode:function(j,k){var s;var p=this._calcConnectorAnglesOfNode(j,k);var m=p.length;if(m===0){s=0}else{if(m===1){s=-p[0]}else{var q=0;var o=0;for(var n=0;n<m;++n){var h=p[n];var g=p[(n+1)%m];var r=g-h;if(r<0){r+=Math.PI*2}if(r>q){q=r;o=n}}s=p[o]+q/2}}return s},doAutoAdjustAttachedMarkerPos:function(k,g,i,h,j){if(g&&!g.getCoordOfMode(this.getCoordMode())){k.autoSetMarker2DPos(g,i,h,j)}},doAdjustChemPropMarkerPos:function(k,p,g,o){k.beginUpdate();try{var n=k.getMarkerOfType(Kekule.ChemMarker.Charge);this.doAutoAdjustAttachedMarkerPos(k,n,p,g,o);var q=k.getMarkerOfType(Kekule.ChemMarker.Radical);this.doAutoAdjustAttachedMarkerPos(k,q,p,g,o);var j=k.getUnplacedMarkers(this.getCoordMode());for(var m=0,h=j.length;m<h;++m){this.doAutoAdjustAttachedMarkerPos(k,j[m],p,g,o)}}finally{k.endUpdate()}},doDrawElectronStateMark:function(k,r,z,w,I,K,o,D,G,n,F,m,h){var y=z.getCharge();var H=z.getRadical();var u="";if((!I)||(Math.abs(y)>Math.pow(10,-I)/2)){var p=w===Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND;var g=(w===Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND);if(y===1){u=g?"\u2295":"+"}else{if(y===-1){u=g?"\u2296":"\u2212"}else{var B=I?Kekule.NumUtils.toDecimals(Math.abs(y),I):Math.abs(y).toString();u=B+((y>0)?"+":"\u2212")}}}if(H){u+=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(H,K)}if(!u){return null}var A=this.getTransformedCoord2D(k,z);var E=this._getMostEmptyDirectionAngleOfNode(k,z);var j={x:Math.cos(E),y:Math.sin(E)};var l=1;var q=G/l;var v={x:j.x*q,y:j.y*q};v=Kekule.CoordUtils.add(A,v);var i=Kekule.Render.BoxXAlignment;var s=Kekule.Render.BoxYAlignment;var t,x;t=i.CENTER;x=s.CENTER;var J=this.drawText(k,v,u,{fontFamily:o,fontSize:D,color:F,opacity:m,textBoxXAlignment:t,textBoxYAlignment:x,zoom:h||1});return J},doDrawConnectorShape:function(ac,h,B,A,E,Y){var p=Kekule.CoordUtils;var o=this.getTransformedCoord2D(ac,B,Y.allowCoordBorrow);var n=this.getTransformedCoord2D(ac,A,Y.allowCoordBorrow);var aa={x:o.x,y:o.y};var Z={x:n.x,y:n.y};var O=[B,A];var q=[aa,Z];var ad=p.getDistance(aa,Z);var v=0;var F=E.unitLength||1;var V=Math.sqrt(Math.sqr(Z.x-aa.x)+Math.sqr(Z.y-aa.y));var t=[];var G=false,I;var D=E.bondLengthScaleRatio;if(Kekule.ObjUtils.notUnset(D)){var H=p.substract(Z,aa);G=true;I=(D>0)?0:1;var L=1-(Math.abs(D||1));var r=(I===1)?-1:1;t[I]=p.multiply(H,r*L)}if(this.getObjNeedDrawLabel(ac,B)||this.getObjNeedDrawLabel(ac,A)){var P=E.atomLabelBoxExpandRatio;var k,J;var M;var y=Z.x-aa.x;var R=Z.y-aa.y;var s=(y>=0)?1:-1;var g=(R>=0)?1:-1;var Q=(y===0);if(!Q){var ab=Math.abs(R/y)}if(Math.abs(y)>=Math.abs(R)){M=true}else{M=false}for(var W=0,T=O.length;W<T;++W){var K=O[W];var w=q[W];var X=null;if(this.getObjNeedDrawLabel(ac,K)){var m=this._getNodeFontSize(ac,K)*(Y.zoom||1);k=J=m*F*P/2;if(M){X={x:k*s,y:k*ab*g}}else{if(!Q){X={x:J/ab*s,y:J*g}}else{X={x:0,y:J*g}}}if(X){var j=t[W];if(j&&(Math.abs(D)<=1)){if(Math.abs(X.x)>Math.abs(j.x)||Math.abs(X.y)>Math.abs(j.y)){t[W]=X}}else{t[W]=X}}}s*=-1;g*=-1}}for(var W=0,T=q.length;W<T;++W){var w=q[W];var X=t[W];if(X){v+=p.getDistance(X,{x:0,y:0});var z=p.add(w,X);w.x=z.x;w.y=z.y}}if(v>=ad){return null}var N=(E.bondLineWidth||E.strokeWidth||1)*(E.unitLength||1);E.strokeWidth=N;var u=E.renderType;var S=Kekule.Render.ConnectorDrawUtils.getPossibleConnectorRenderTypes(h);if(Kekule.ObjUtils.isUnset(u)||(S.indexOf(u)<0)){u=S[0]}var x;if(this.isLineBasedConnector(u)){x=this.doDrawLineBasedConnector(ac,u,B,A,aa,Z,V,E)}else{if(this.isTriangleBasedConnector(u)){x=this.doDrawTriangleBasedConnector(ac,u,B,A,aa,Z,V,E)}else{if(this.isTriangleHashBasedConnector(u)){x=this.doDrawTriangleHashBasedConnector(ac,u,B,A,aa,Z,V,E)}else{if(this.isRectangleBasedConnector(u)){x=this.doDrawRectangleBasedConnector(ac,u,B,A,aa,Z,V,E)}else{if(this.isWavyBasedConnector(u)){x=this.doDrawWavyBasedConnector(ac,u,B,A,aa,Z,V,E)}}}}}return x},_lineBasedConnectorTypes:[b.SINGLE,b.DOUBLE,b.TRIPLE,b.QUAD,b.SCISSORS_DOUBLE,b.BOLD,b.BOLD_DOUBLE,b.BOLD_TRIPLE,b.DASHED,b.DASHED_DOUBLE,b.DASHED_TRIPLE,b.SOLID_DASH,b.BOLD_DASH,b.ARROWED],_triangleBasedConnectorTypes:[b.WEDGED_SOLID,b.WEDGED_SOLID_INV,b.WEDGED_HOLLOW,b.WEDGED_HOLLOW_INV],_triangleHashBasedConnectorTypes:[b.WEDGED_HASHED,b.WEDGED_HASHED_INV,b.HASHED],_rectangleBasedConnectorTypes:[b.WEDGED_SOLID_BOTH,b.WEDGED_HOLLOW_BOTH],isLineBasedConnector:function(g){return(this._lineBasedConnectorTypes.indexOf(g)>=0)},isTriangleBasedConnector:function(g){return(this._triangleBasedConnectorTypes.indexOf(g)>=0)},isTriangleHashBasedConnector:function(g){return(this._triangleHashBasedConnectorTypes.indexOf(g)>=0)},isRectangleBasedConnector:function(g){return(this._rectangleBasedConnectorTypes.indexOf(g)>=0)},isWavyBasedConnector:function(g){return g=b.WAVY},doDrawLineBasedConnector:function(j,h,t,s,p,o,g,u){var m=[];var l={isBold:false,isDash:false};var r={isBold:true,isDash:false};var k={isBold:false,isDash:true};switch(h){case b.DOUBLE:case b.SCISSORS_DOUBLE:for(var n=0;n<2;++n,m.push(l)){}break;case b.TRIPLE:for(var n=0;n<3;++n,m.push(l)){}break;case b.QUAD:for(var n=0;n<4;++n,m.push(l)){}break;case b.BOLD:m.push(r);break;case b.BOLD_DOUBLE:m.push(r);m.push(l);break;case b.BOLD_TRIPLE:m.push(r);for(var n=0;n<2;++n,m.push(l)){}break;case b.BOLD_QUAD:m.push(r);for(var n=0;n<3;++n,m.push(l)){}break;case b.DASHED:m.push(k);break;case b.DASHED_DOUBLE:for(var n=0;n<2;++n,m.push(k)){}break;case b.DASHED_TRIPLE:for(var n=0;n<3;++n,m.push(k)){}break;case b.SOLID_DASH:m.push(l);m.push(k);break;case b.BOLD_DASH:m.push(r);m.push(k);break;case b.ARROWED:l.isArrow=true;m.push(l);break;case b.SINGLE:default:m.push(l)}var q=h===b.SCISSORS_DOUBLE;return this.doDrawSymmetryLineConnector(j,t,s,p,o,g,m,q,u)},doDrawSymmetryLineConnector:function(aa,A,z,Z,Y,R,J,E,H){var o=J.length;var y=null,p=null;if(o===1){var M=H.strokeWidth;if(J[0].isBold){M*=H.boldBondLineWidthRatio}var l=null;if(J[0].isArrow){l={width:H.bondArrowWidth*H.unitLength,length:H.bondArrowLength*H.unitLength}}var x={strokeWidth:M,strokeColor:Kekule.Render.RenderOptionUtils.getColor(H),strokeDash:J[0].isDash,opacity:H.opacity};var p=this.drawArrowLine(aa,Z,Y,l,x);var X=this.createLineBoundInfo(Z,Y,M)}else{if(o>1){y=this.createDrawGroup(aa);var Q=H.multipleBondSpacingAbs?H.multipleBondSpacingAbs:H.multipleBondSpacingRatio*R;if(H.multipleBondMaxAbsSpacing){Q=Math.min(Q,H.multipleBondMaxAbsSpacing)}Q*=H.unitLength;var P=Y.x-Z.x;var V=Y.y-Z.y;var k=Math.sqrt(Math.sqr(P)+Math.sqr(V));var T=V/k;var N=P/k;var j=0;var I=[];var O=1;if(!(o&1)){if(E){O=0}else{O=Kekule.ObjUtils.isUnset(J.bondAlign)?this._decideEvenBondAlign(aa,A,z):J.bondAlign}}for(var S=0;S<o;++S){if(Kekule.ObjUtils.notUnset(J[S].offsetAdjust)){I.push(J[S].offsetAdjust)}else{if((S===0)&&(O!==0)){I.push(0)}else{var r=(S&1)?1:-1;if(O!==0){var m=O*r*((S+1)>>1)}else{var m=((S>>1)*1+0.5)*r}I.push(m)}}}var n=Q;if(n>W){W=n}if(n<K){K=n}var g={x:0,y:0};var ab={x:0,y:0};var W=0,K=0;var D=[];for(var S=0;S<o;++S){var v=Object.create(H);var s=n*T;var q=n*N;var G={x:Z.x-s*I[S],y:Z.y+q*I[S]};var B={x:Y.x-s*I[S],y:Y.y+q*I[S]};g=Kekule.CoordUtils.add(g,G);ab=Kekule.CoordUtils.add(ab,B);var l=null;if(J[S].isArrow){l={width:H.bondArrowWidth*H.unitLength,length:H.bondArrowLength*H.unitLength}}var M=H.strokeWidth;if(J[S].isBold){M*=H.boldBondLineWidthRatio}v.strokeColor=H.color;v.strokeDash=J[S].isDash;D.push({coord1:G,coord2:B,arrowParams:l,drawOptions:v});if(J[S].isBold){n=Q+Math.floor(M/2)}else{n=Q}}if(E){for(var S=0;S<o;++S){var L=D[S];var F=D[o-S-1];var p=this.drawArrowLine(aa,L.coord1,F.coord2,L.arrowParams,L.drawOptions);this.addToDrawGroup(p,y)}}else{for(var S=0;S<o;++S){var t=D[S];var p=this.drawArrowLine(aa,t.coord1,t.coord2,t.arrowParams,t.drawOptions);this.addToDrawGroup(p,y)}}g=Kekule.CoordUtils.divide(g,o);ab=Kekule.CoordUtils.divide(ab,o);var X=this.createLineBoundInfo(g,ab,W-K)}}var u={element:y||p,boundInfo:X};return u},_getStandardizedLinkedObjRelCoords:function(g,j,k){var s=[];var q=this.getTransformedCoord2D(g,j);var h=j.getLinkedExposedObjs();for(var o=0,m=h.length;o<m;++o){var n=h[o];if(n===k){continue}var p=this.getTransformedCoord2D(g,n);var r=Kekule.CoordUtils.substract(p,q);r=Kekule.CoordUtils.standardize(r);s.push(r)}return s},_decideEvenBondAlign:function(g,q,o){var h=Kekule.CoordUtils.substract(this.getTransformedCoord2D(g,o),this.getTransformedCoord2D(g,q));h=Kekule.CoordUtils.standardize(h);var r=this._getStandardizedLinkedObjRelCoords(g,q,o);var p=this._getStandardizedLinkedObjRelCoords(g,o,q);var n=0;var k={x:0,y:0};for(var m=0,j=r.length;m<j;++m){n+=this._calcSinglePointAlign(r[m],h);k.x+=r[m].x;k.y+=r[m].y}for(var m=0,j=p.length;m<j;++m){n+=this._calcSinglePointAlign(p[m],h);k.x+=p[m].x;k.y+=p[m].y}if(n!==0){return Math.sign(n)}else{return this._calcSinglePointAlign(k,h)}},_calcSinglePointAlign:function(l,h){var g;var i=0.0001;if(Math.abs(h.x)<i){if(Math.abs(l.x)<i){g=0}else{g=-Math.sign(l.x)*Math.sign(h.y)}return g}else{var k=h.y*l.x/h.x;var j=l.y-k;if(j>i){g=1}else{if(j<-i){g=-1}else{g=0}}g*=Math.sign(h.x);return g}},doDrawTriangleBasedConnector:function(i,h,t,s,o,n,g,v){var m=(h===b.WEDGED_SOLID)||(h===b.WEDGED_SOLID_INV);var q=(h===b.WEDGED_SOLID_INV)||(h===b.WEDGED_HOLLOW_INV);var k=q?[n,o]:[o,n];var r=v.bondWedgeWidth*v.unitLength;var p=this._calcTriangleBaselineCoords(k[0],k[1],r);var l=Object.create(v);l.strokeColor=v.color;l.fillColor=m?v.color:null;var j=this.drawTriangle(i,k[0],p[0],p[1],l);var u={element:j};u.boundInfo=this.createLineBoundInfo(k[0],k[1],r);return u},doDrawTriangleHashBasedConnector:function(j,E,h,g,m,k,B,o){var H=(E===b.WEDGED_HASHED_INV);var x=(E!==b.HASHED);var r=H?[k,m]:[m,k];var z=o.hashSpacing*o.unitLength;var F=o.bondWedgeWidth*o.unitLength;var y=(x)?o.bondWedgeHashMinWidth*o.unitLength:F;var J=F-y;var u=Kekule.CoordUtils.substract(r[1],r[0]);var w=Math.sqrt(Math.sqr(u.x)+Math.sqr(u.y));var p=Math.floor(w/z);var s=this.createDrawGroup(j);var n=Object.create(o);n.strokeColor=o.color;for(var D=0;D<p;++D){var A=z*D;var q=A/w;var t={x:u.x*q,y:u.y*q};t=Kekule.CoordUtils.add(t,r[0]);var I=this._calcTriangleBaselineCoords(r[0],t,J*q+y);var G=this.drawLine(j,I[0],I[1],n);this.addToDrawGroup(G,s)}var v={element:s};v.boundInfo=this.createLineBoundInfo(r[0],r[1],F);return v},_calcTriangleBaselineCoords:function(g,l,i){var j=Kekule.CoordUtils.substract(l,g);var k=Math.sqrt(Math.sqr(j.x)+Math.sqr(j.y));var m=j.y/k;var h=j.x/k;var n=i/2;var o=[];o.push({x:l.x+n*m,y:l.y-n*h});o.push({x:l.x-n*m,y:l.y+n*h});return o},doDrawRectangleBasedConnector:function(i,h,r,q,n,m,g,u){var l=(h===b.WEDGED_SOLID_BOTH);var p=u.bondWedgeWidth*u.unitLength;var o=this._calcRectangleCornerCoords(n,m,p);var k=Object.create(u);k.strokeColor=u.color;k.fillColor=l?u.color:null;var t=Kekule.Render.DrawPathUtils.makePath("M",[o[0].x,o[0].y],"L",[o[1].x,o[1].y],"L",[o[2].x,o[2].y],"L",[o[3].x,o[3].y],"Z");var j=this.drawPath(i,t,k);var s={element:j};s.boundInfo=this.createLineBoundInfo(n,m,p);return s},_calcRectangleCornerCoords:function(j,o,h){var i=Kekule.CoordUtils.substract(o,j);var k=Math.sqrt(Math.sqr(i.x)+Math.sqr(i.y));var l=i.y/k;var g=i.x/k;var m=h/2;var p=[];var n={x:m*l,y:m*g};p.push({x:j.x+n.x,y:j.y-n.y});p.push({x:j.x-n.x,y:j.y+n.y});p.push({x:o.x-n.x,y:o.y+n.y});p.push({x:o.x+n.x,y:o.y-n.y});return p},doDrawWavyBasedConnector:function(j,B,h,g,l,k,z,n){var J=Kekule.CoordUtils;var q=n.bondWavyRadius*n.unitLength;var x=J.getDistance(l,k);var o=Math.round(x/q);var E=J.divide(J.substract(k,l),o);var t=x/o;var v=[];var p;var w=l;var D=Math.atan2(E.y,E.x)+Math.PI;var I={x:t/1.5*Math.sin(D),y:-t/1.5*Math.cos(D)};var H=1;for(var A=0;A<o;++A){H=-H;p=w;w=J.add(p,E);var G=J.multiply(I,H);var s=J.add(p,G);var r=J.add(w,G);if(A===0){v.push("M");v.push([p.x,p.y])}v.push("C");v.push([s.x,s.y,r.x,r.y,w.x,w.y])}var y=Kekule.Render.DrawPathUtils.makePath.apply(Kekule.Render.DrawPathUtils,v);var m=Object.create(n);m.strokeColor=n.color;m.fillColor=null;var F=this.drawPath(j,y,m);var u={element:F};u.boundInfo=this.createLineBoundInfo(l,k,t);return u}});Kekule.Render.StructFragment2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.StructFragment2DRenderer",initialize:function($super,i,g,h){$super(i,g,h);this._concreteRenderer=null;this._concreteChemObj=null;this.initConcreteRenderer()},finalize:function($super){$super();if(this._concreteRenderer){this._concreteRenderer.finalize();this._concreteRenderer=null}},initConcreteRenderer:function(){var h=this.getChemObj();var g=this.getDrawBridge();if(this._isRendererMismatch(this._concreteRenderer,h)&&this._concreteRenderer){this._concreteRenderer.finalize();this._concreteRenderer=null;this._concreteChemObj=null}if(!this._concreteRenderer&&h){if(h.hasCtab()){this._concreteChemObj=h.getCtab();this._concreteRenderer=new Kekule.Render.ChemCtab2DRenderer(h.getCtab(),g,this)}else{if(h.hasFormula()){this._concreteChemObj=h.getFormula();this._concreteRenderer=new Kekule.Render.Formula2DRenderer(h.getFormula(),g,this)}}}return this._concreteRenderer},_isRendererMismatch:function(g,h){return(g&&!h)||((g instanceof Kekule.Render.ChemCtab2DRenderer)&&!h.hasCtab())||((g instanceof Kekule.Render.Formula2DRenderer)&&!h.hasFormula())},getConcreteRenderer:function(){this.initConcreteRenderer();return this._concreteRenderer},_getConcreteRendererDrawOptions:function(g){return g},isChemObjRenderedBySelf:function($super,h,j){var i=this.getConcreteRenderer();var g=$super(h,j)||(j===this.getChemObj())||(i&&i.isChemObjRenderedBySelf(h,j));return g},isChemObjRenderedDirectlyBySelf:function($super,g,i){var h=this.getConcreteRenderer();return $super(g,i)||(i===this.getChemObj())||(i===this._concreteChemObj)},doSetRedirectContext:function($super,h){$super(h);var g=this.getConcreteRenderer();if(g){g.setRedirectContext(h)}},getChildObjs:function($super){var n=this.getChemObj();if(n){var j=[];var k=(n.getExposedNodes()||[]).concat(n.getExposedConnectors()||[]);for(var h=0,g=k.length;h<g;++h){var m=k[h];if(m.getAttachedMarkers){j=j.concat(m.getAttachedMarkers()||[])}}return j.concat($super())}else{return $super()}},_needWholelyDraw:function($super,g,h){var p=$super(g,h);if(!p){var o=this.getChemObj();var j=false;for(var n=0,m=g.length;n<m;++n){var k=g[n];if(k.isChildOf(o)){j=true;break}}p=j}return p},_createChargeAndRadicalMarkerOnStructFragment:function(m){m.beginUpdate();try{if(m.getCharge&&m.getCharge()){m.fetchChargeMarker(true)}var h=m.getNodes();for(var j=0,g=m.getNodeCount();j<g;++j){var k=m.getNodeAt(j);k.beginUpdate();try{if(k.getCharge()){k.fetchChargeMarker(true)}if(k.getRadical()){k.fetchRadicalMarker(true)}if(k.getNodeAt){this._createChargeAndRadicalMarkerOnStructFragment(k)}}finally{k.endUpdate()}}}finally{m.endUpdate()}},doDraw:function($super,h,j,g){var k=!!g.autoCreateChargeAndRadicalMarker;if(this.getCanModifyTargetObj()&&k){var i=this.getChemObj();this._createChargeAndRadicalMarkerOnStructFragment(i)}$super(h,j,g)},doDrawSelf:function($super,h,k,g){$super(h,k,g);var m=this.getChemObj();var j=k;var i=this.getConcreteRenderer();if((!j)&&(i instanceof Kekule.Render.Formula2DRenderer)){if(m.getAbsBaseCoord2D){var l=m.getAbsBaseCoord2D(g.allowCoordBorrow);j=Kekule.CoordUtils.transform2D(l,g.transformParams)}}if(!m.hasFormula()&&!m.hasCtab()){return null}else{if(i){return i.draw(h,j,this._getConcreteRendererDrawOptions(g))}}},doRedraw:function($super,g){return $super(g)},doUpdateSelf:function(h,l,g){var k=this._extractObjsOfUpdateObjDetails(l);if(k.indexOf(this.getChemObj())>=0){var j=this.getRenderCache(h);this.doClear(h);return this.draw(h,j.baseCoord,j.options)}var i=this.getConcreteRenderer();if(i){return i.doUpdate(h,l,g)}},doClearSelf:function(g){var h=this.getConcreteRenderer();if(h){return h.clear(g)}},estimateRenderBox:function(i,k,h,g){var j=this.getConcreteRenderer();if(j){return j.estimateRenderBox(i,k,this._getConcreteRendererDrawOptions(h),g)}else{return null}},transformCoordToObj:function($super,g,i,h){return $super(g,i,h)},transformCoordToContext:function($super,g,i,h){return $super(g,i,h)}});Kekule.Render.Mol2DRenderer=Kekule.Render.StructFragment2DRenderer;Kekule.Render.CompositeObj2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeObj2DRenderer"});Kekule.Render.CompositeMolecule2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule2DRenderer",getChildObjs:function($super){var j=[];var k=this.getChemObj().getSubMolecules();for(var h=0,g=k.getItemCount();h<g;++h){var m=k.getObjAt(h);j.push(m)}return j.concat($super())}});Kekule.Render.ChemObjGroupList2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule2DRenderer",getChildObjs:function($super){var k=this.getChemObj();if(k instanceof Kekule.ChemObjList){var j=[];for(var h=0,g=k.getItemCount();h<g;++h){j.push(k.getItemAt(h))}}else{if(k instanceof Kekule.ChemStructureObjectGroup){j=k.getAllObjs()}}return(j||[]).concat($super())}});Kekule.Render.Reaction2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.Reaction2DRenderer",getChildObjs:function($super){var j=[];var k=this.getChemObj();var j=[];for(var h=0,g=k.getReactantCount();h<g;++h){var m=k.getReactantAt(h);j.push(m)}for(var h=0,g=k.getProductCount();h<g;++h){var m=k.getProductAt(h);j.push(m)}return(j||[]).concat($super())}});Kekule.Render.ChemSpaceElement2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpaceElement2DRenderer",getChildObjs:function($super){var g=$super()||[];var h=this.getChemObj();g=(h.getChildren().toArray()||[]).concat(g);return g}});Kekule.Render.ChemSpace2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpace2DRenderer",getChildObjs:function($super){return[this.getChemObj().getRoot()].concat($super()||[])},doEstimateSelfObjBox:function($super,k,i,h){var j=this.getChemObj().getSize2D();if(j.x&&j.y&&i.useExplicitSpaceSize){var g={x1:0,y1:0,x2:j.x,y2:j.y};return g}else{return $super(k,i,h)}}});Kekule.Render.Renderer2DFactory.register(Kekule.ChemMarker.Charge,Kekule.Render.TextBasedChemMarker2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemMarker.Radical,Kekule.Render.TextBasedChemMarker2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemMarker.UnbondedElectronSet,Kekule.Render.UnbondedElectronSetRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.TextBlock,Kekule.Render.TextBlock2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ImageBlock,Kekule.Render.ImageBlock2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.StructureFragment,Kekule.Render.StructFragment2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.CompositeMolecule,Kekule.Render.CompositeMolecule2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.Reaction,Kekule.Render.Reaction2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemObjList,Kekule.Render.ChemObjGroupList2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemStructureObjectGroup,Kekule.Render.ChemObjGroupList2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemSpaceElement,Kekule.Render.ChemSpaceElement2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemSpace,Kekule.Render.ChemSpace2DRenderer)})();(function(){var c=Kekule.Render.DrawPathUtils;var a=Kekule.Render.CoordUtils;var e=Kekule.oneOf;var b=Kekule.Glyph.NodeType;var d=Kekule.Glyph.PathType;Kekule.Render.BaseGlyph2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.BaseGlyph2DRenderer",doDraw:function($super,g,i,f){var h=Object.create(f);h.strokeColor=f.strokeColor||f.glyphStrokeColor;h.fillColor=f.fillColor||f.glyphFillColor;h.strokeWidth=f.strokeWidth||f.glyphStrokeWidth;return $super(g,i,h)}});Kekule.Render.PathGlyphCtab2DRenderer=Class.create(Kekule.Render.Ctab2DRenderer,{CLASS_NAME:"Kekule.Render.PathGlyphCtab2DRenderer",extractGlyphDrawOptions:function(f){var g=f.unitLength||1;return{strokeColor:f.strokeColor||f.color||f.glyphStrokeColor,fillColor:f.fillColor||f.color||f.glyphFillColor,strokeWidth:(f.strokeWidth||f.glyphStrokeWidth)*g}},doDraw:function($super,g,h,f){return $super(g,h,f)},doDrawNode:function(f,m,h,i,n,g){var l;var k=this.getTransformedCoord2D(f,h,g.allowCoordBorrow);var j=h.getNodeType();if(!j||j===b.LOCATION){l=this.createPointBoundInfo(k)}if(l){this.basicDrawObjectUpdated(f,h,i,l,Kekule.Render.ObjectUpdateType.ADD)}},doDrawConnectorShape:function(ad,f,x,v,A,X){var p=Kekule.CoordUtils;var Z=p.clone(this.getTransformedCoord2D(ad,x,X.allowCoordBorrow));var Y=p.clone(this.getTransformedCoord2D(ad,v,X.allowCoordBorrow));var u=this.extractGlyphDrawOptions(A);var r=f.getPathType();var z=f.getPathParams()||{};var B=this.getChemObj();var L=z.lineGap||0;var o=L?(z.lineCount||1):1;var p=Kekule.CoordUtils;var V=Kekule.Glyph.ArrowSide;var T=p.substract(Y,Z);var I=T.x;var R=T.y;var N=p.getDistance(Z,Y);var Q=R/N;var H=I/N;var M={y:L*H,x:L*Q};var F=p.substract(this.transformCoordToContext(ad,B,{x:0,y:0}),this.transformCoordToContext(ad,B,M));var q=p.getDistance(F,{x:0,y:0});var ab=p.multiply(F,(o-1)/2);var J,K;var s=[];if(!!z.startArrowType&&z.startArrowWidth){var t=this._transformArrowLength(ad,z.startArrowLength,z.startArrowWidth);J={arrowLength:t.arrowLength,arrowWidth:t.arrowWidth,arrowType:z.startArrowType,arrowSide:z.startArrowSide,drawOnCenter:(!z.startArrowSide||z.startArrowSide===V.BOTH)};if(J.drawOnCenter){Kekule.ArrayUtils.pushUnique(s,this.doDrawArrowShape(ad,f,Y,Z,J,u,true))}}if(!!z.endArrowType&&z.endArrowWidth){var t=this._transformArrowLength(ad,z.endArrowLength,z.endArrowWidth);var K={arrowLength:t.arrowLength,arrowWidth:t.arrowWidth,arrowType:z.endArrowType,arrowSide:z.endArrowSide,drawOnCenter:(!z.endArrowSide||z.endArrowSide===V.BOTH)};if(K.drawOnCenter){Kekule.ArrayUtils.pushUnique(s,this.doDrawArrowShape(ad,f,Z,Y,K,u))}}var G=p.multiply(F,(o-1)/2);var n=p.substract(Z,G);var k=p.substract(Y,G);var ac=[];var E=[];var W,S;var y=N;var g=(o-1)/2;for(var P=0;P<o;++P){W=null;S=null;if(P!==0){n=p.add(n,F);k=p.add(k,F)}if(J||K){var D=P-g;var m=q*Math.abs(D);if(J){if(J.drawOnCenter&&(!J.arrowSide||(J.arrowSide===V.SINGLE&&D<0)||(J.arrowSide===V.REVERSED&&D>0))){var aa=(J.arrowType===Kekule.Glyph.ArrowType.OPEN)?J.arrowLength*m/(J.arrowWidth/2):J.arrowLength;var W=p.add(n,p.multiply(T,aa/y))}if(!J.drawOnCenter&&((J.arrowSide===V.SINGLE&&P===0)||(J.arrowSide===V.REVERSED&&P===o-1))){Kekule.ArrayUtils.pushUnique(s,this.doDrawArrowShape(ad,f,k,n,J,u,true))}}if(K){if(K.drawOnCenter&&(!K.arrowSide||(K.arrowSide===V.SINGLE&&D<0)||(K.arrowSide===V.REVERSED&&D>0))){var aa=(K.arrowType===Kekule.Glyph.ArrowType.OPEN)?K.arrowLength*m/(K.arrowWidth/2):K.arrowLength;var S=p.substract(k,p.multiply(T,aa/y))}if(!K.drawOnCenter&&((K.arrowSide===V.SINGLE&&P===0)||(K.arrowSide===V.REVERSED&&P===o-1))){Kekule.ArrayUtils.pushUnique(s,this.doDrawArrowShape(ad,f,n,k,K,u))}}}var O;if(r===d.LINE){O=this.doDrawLineShape(ad,f,W||n,S||k,u,A)}ac.push(O.element);E.push(O.boundInfo)}if((o<=1)&&!s.length){return{element:ac[0],boundInfo:E[0]}}else{var j=this.createDrawGroup(ad);for(var P=0;P<o;++P){this.addToDrawGroup(ac[P],j)}for(var P=0,N=s.length;P<N;++P){this.addToDrawGroup(s[P],j)}return{element:j,boundInfo:E}}},_transformArrowLength:function(h,i,f){var j={x:i||0,y:f||0};var g=Kekule.CoordUtils.substract(this.transformCoordToContext(h,this.getChemObj(),j),this.transformCoordToContext(h,this.getChemObj(),{x:0,y:0}));return{arrowLength:Math.abs(g.x),arrowWidth:Math.abs(g.y)}},doDrawArrowShape:function(i,g,k,j,p,o,h){var F=Kekule.CoordUtils;var r=Kekule.Glyph.ArrowSide;var q=Kekule.Glyph.ArrowType;var D=F.substract(j,k);var l=F.getDistance(j,k);var m=D.y/l;var G=D.x/l;var w=p.arrowLength;var B=p.arrowWidth;var E=B/2;var n=F.substract(j,F.multiply(D,w/l));var A={x:E*m,y:-E*G};var v;var u;var s=Kekule.Render.DrawPathUtils;var y=[];if(!p.arrowSide||(!h&&p.arrowSide===r.SINGLE)||(h&&p.arrowSide===r.REVERSED)){v=F.add(n,A);y.push("M");y.push([v.x,v.y]);y.push("L");y.push([j.x,j.y])}else{y.push("M");y.push([j.x,j.y])}if(!p.arrowSide||(!h&&p.arrowSide===r.REVERSED)||(h&&p.arrowSide===r.SINGLE)){u=F.substract(n,A);y.push("L");y.push([u.x,u.y])}var z=false;if(p.arrowType===q.TRIANGLE){var t=(v&&u)?null:n;if(t){y.push("L");y.push([t.x,t.y])}y.push("Z");z=true}var x=s.makePath.apply(this,y);var f=Object.create(o);if(!z){f.fillColor="transparent"}return this.drawPath(i,x,f)},doDrawLineShape:function(i,f,l,k,m,g){var j=this.drawLine(i,l,k,m);var h=this.createLineBoundInfo(l,k,m.strokeWidth);return{element:j,boundInfo:h}}});Kekule.Render.PathGlyph2DRenderer=Class.create(Kekule.Render.BaseGlyph2DRenderer,{CLASS_NAME:"Kekule.Render.PathGlyph2DRenderer",initialize:function($super,h,f,g){$super(h,f,g);this._concreteChemObj=h.getCtab();this._concreteRenderer=new Kekule.Render.PathGlyphCtab2DRenderer(h.getCtab(),f,this)},finalize:function($super){$super();if(this._concreteRenderer){this._concreteRenderer.finalize();this._concreteRenderer=null}},getRenderCache:function(f){return this._concreteRenderer.getRenderCache(f)},_getConcreteRendererDrawOptions:function(f){return f},isChemObjRenderedBySelf:function($super,g,h){var f=$super(g,h)||(h===this.getChemObj())||this._concreteRenderer.isChemObjRenderedBySelf(g,h);return f},isChemObjRenderedDirectlyBySelf:function($super,f,g){return $super(f,g)||(g===this.getChemObj())},doSetRedirectContext:function($super,f){$super(f);this._concreteRenderer.setRedirectContext(f)},doDraw:function($super,g,h,f){$super(g,h,f);var j=this.getChemObj();var i=Object.create(f);if(i.partialDrawObjs){i.partialDrawObjs=null}return this._concreteRenderer.draw(g,h,this._getConcreteRendererDrawOptions(i))},doRedraw:function(f){return this._concreteRenderer.redraw(f)},doUpdate:function(g,j,f){var i=this._extractObjsOfUpdateObjDetails(j);if(i.indexOf(this.getChemObj())>=0){var h=this.getRenderCache(g);this.doClear(g);return this.draw(g,h.baseCoord,h.options)}return this._concreteRenderer.doUpdate(g,j,f)},doClear:function(f){return this._concreteRenderer.clear(f)},estimateRenderBox:function(h,g,f){return this._concreteRenderer.estimateRenderBox(h,this._getConcreteRendererDrawOptions(g),f)},transformCoordToObj:function(f,i,h){var g=(this.getChemObj()===i)?this._concreteChemObj:i;return this._concreteRenderer.transformCoordToObj(f,g,h)},transformCoordToContext:function(f,i,h){var g=(this.getChemObj()===i)?this._concreteChemObj:i;return this._concreteRenderer.transformCoordToContext(f,g,h)}});Kekule.Render.Renderer2DFactory.register(Kekule.Glyph.PathGlyph,Kekule.Render.PathGlyph2DRenderer)})();"use strict";Kekule.Render.CanvasRendererBridge=Class.create({CLASS_NAME:"Kekule.Render.CanvasRendererBridge",DEF_DOUBLE_BUFFERED:false,SHADOW_CANVAS_FIELD:"__$shadow_canvas__",SHADOW_CONTEXT_FIELD:"__$shadow_context__",getShadowContext:function(a){return a[this.SHADOW_CONTEXT_FIELD]},getShadowCanvas:function(a){return a[this.SHADOW_CANVAS_FIELD]},getOperatingContext:function(a){return this.getShadowContext(a)||a},createContext:function(e,b,h,a,c){if(c===undefined){c=this.DEF_DOUBLE_BUFFERED}var g=e.ownerDocument;var d=document.createElement("canvas");if(a){d.id=a}e.appendChild(d);var i=d.getContext("2d");if(c){var f=document.createElement("canvas");f.style.position="absolute";f.style.display="none";e.appendChild(f);i[this.SHADOW_CANVAS_FIELD]=f;i[this.SHADOW_CONTEXT_FIELD]=f.getContext("2d")}this.setContextDimension(i,b,h);return i},releaseContext:function(b){var a=b.canvas;var d=this.getShadowCanvas(b);var c=a.parentNode;if(c){c.removeChild(a);if(d){c.removeChild(d)}}},getContextDimension:function(a){return{width:a.canvas.width,height:a.canvas.height}},setContextDimension:function(b,d,a){var c=this.getShadowCanvas(b);if(d){b.canvas.width=d;b.canvas.style.width=d+"px";if(c){c.width=d;c.style.width=d+"px"}}if(a){b.canvas.height=a;b.canvas.style.height=a+"px";if(c){c.height=a;c.style.height=a+"px"}}this.clearContext(b)},getContextElem:function(a){return a?a.canvas:null},setContextViewBox:function(d,a,f,c,e,b){},clearContext:function(a){var c=a.canvas;c.width=c.width;var b=this.getShadowCanvas(a);if(b){b.width=b.width}var d=a.__$clearColor__;if(d){a.save();try{var e=this.getContextDimension(a);this.drawRect(a,{x:0,y:0},{x:e.width,y:e.height},{fillColor:d,strokeColor:d})}finally{a.restore()}}},setClearColor:function(b,a){if(b){b.__$clearColor__=a}},renderContext:function(a){var b=this.getShadowCanvas(a);if(b){a.drawImage(b,0,0)}},transformContextCoordToScreen:function(a,b){return b},transformScreenCoordToContext:function(a,b){return b},canModifyGraphic:function(a){return false},_drawDashLine:function(c,h,g,f){if(f==undefined){f=5}c.moveTo(h.x,h.y);var e=g.x-h.x;var d=g.y-h.y;var i=Math.floor(Math.sqrt(e*e+d*d)/f);var l=e/i;var k=d/i;var a=0;var b=h.x;var j=h.y;while(a++<i){b+=l;j+=k;c[a%2==0?"moveTo":"lineTo"](b,j)}c[a%2==0?"moveTo":"lineTo"](g.x2,g.y)},drawLine:function(a,e,d,b){var c=this.getOperatingContext(a);c.beginPath();this.setDrawStyle(c,b);if(b.strokeDash&&(!this.isLineDashSupported(c))){this._drawDashLine(c,e,d,b.strokeDash)}else{c.moveTo(e.x,e.y);c.lineTo(d.x,d.y)}this.doneDraw(c,b)},drawTriangle:function(a,f,e,d,b){var c=this.getOperatingContext(a);c.beginPath();this.setDrawStyle(c,b);c.moveTo(f.x,f.y);c.lineTo(e.x,e.y);c.lineTo(d.x,d.y);c.closePath();this.doneDraw(c,b)},drawRect:function(a,e,d,b){var c=this.getOperatingContext(a);c.beginPath();this.setDrawStyle(c,b);c.rect(e.x,e.y,d.x-e.x,d.y-e.y);this.doneDraw(c,b)},drawRoundRect:function(b,e,d,a,c){return this.drawRect(b,e,d,c)},drawCircle:function(b,e,a,c){var d=this.getOperatingContext(b);d.beginPath();this.setDrawStyle(d,c);d.arc(e.x,e.y,a,0,2*Math.PI,false);this.doneDraw(d,c)},_PATH_CMDS:["M","Z","L","C","Q"],_PATH_METHODS:["moveTo","closePath","lineTo","bezierCurveTo","quadraticCurveTo"],drawPath:function(k,m,n){var d=this.getOperatingContext(k);if(m.length<=0){return}d.beginPath();this.setDrawStyle(d,n);var b;for(var f=0,e=m.length;f<e;++f){b=[];var j=m[f];var h=j.method.toUpperCase();var g=this._PATH_CMDS.indexOf(h);var a;if(g>=0){var a=this._PATH_METHODS[g];b=j.params;d[a].apply(d,b)}}this.doneDraw(d,n)},drawImage:function(j,a,d,k,l,f,i){var b=this.getOperatingContext(j);var c=this.getContextElem(b);var e=c.ownerDocument;var h=e.createElement("img");h.src=a;var g=this;h.onload=function(){try{g.setDrawStyle(b,l);var m=j;if(i){m=i()}m=g.getOperatingContext(m);m.drawImage(h,d.x,d.y,k.x,k.y);if(f){f(true)}g.doneDraw(b,l)}catch(n){if(f){f(false)}throw n}};h.src=a},drawImageElem:function(a,f,e,d,b){var c=this.getOperatingContext(a);this.setDrawStyle(c,b);c.drawImage(f,e.x,e.y,d.x,d.y);this.doneDraw(c,b)},isLineDashSupported:function(a){if(Kekule.ObjUtils.isUnset(this.isLineDashSupported._cachedValue)){this.isLineDashSupported._cachedValue=(a.setLineDash&&(typeof(a.lineDashOffset)=="number"))}return this.isLineDashSupported._cachedValue},setDrawStyle:function(b,a){if(Kekule.ObjUtils.notUnset(a.strokeWidth)){b.lineWidth=a.strokeWidth}else{b.lineWidth=1}if(a.strokeColor){b.strokeStyle=a.strokeColor}b.lineCap=a.lineCap||"butt";b.lineJoin=a.lineJoin||"miter";if(this.isLineDashSupported(b)){if(a.strokeDash){var c=(a.strokeDash===true)?[5]:Kekule.ArrayUtils.isArray(a.strokeDash)?a.strokeDash:[a.strokeDash];b.setLineDash(c)}else{b.setLineDash([])}}if(a.fillColor){b.fillStyle=a.fillColor}else{b.fillStyle="transparent"}if(Kekule.ObjUtils.notUnset(a.opacity)){b.globalAlpha=a.opacity}else{b.globalAlpha=1}},doneDraw:function(b,a){b.stroke();if(a.fillColor){b.fill()}},getCanvasFontStyle:function(b){var a="";if(b.fontStyle){a+=b.fontStyle+" "}if(b.fontWeight){a+=b.fontWeight+" "}if(b.fontSize){if(typeof(b.fontSize)==="string"){a+=b.fontSize+" "}else{a+=b.fontSize+"px "}}if(b.fontFamily){a+=b.fontFamily+" "}return a},drawText:function(a,h,g,b){var c=this.getOperatingContext(a);var d=c.font;var f=c.fillStyle;var e=this.getCanvasFontStyle(b);this.setDrawStyle(c,b);c.font=e;if(b.color){c.fillStyle=b.color}c.textBaseline="top";c.fillText(g,h.x,h.y);c.fontStyle=d;c.fillStyle=f},canMeasureText:function(a){return true},measureText:function(d,g,c){var f=this.getCanvasFontStyle(c);d.font=f;var b=d.measureText(g);var e=c.fontSize;if(typeof(e)==="string"){e=Kekule.StyleUtils.analysisUnitsValue(e).value}var a={width:b.width,height:e};return a},canMeasureDrawnText:function(a){return false},canModifyText:function(a){return false},createGroup:function(a){},addToGroup:function(a,b){},removeFromGroup:function(a,b){},exportToDataUri:function(c,a,b){var d=this.getContextElem(c);return d?d.toDataURL(a,b):null}});Kekule.Render.CanvasRendererBridge.isSupported=function(){var a=false;if(document&&document.createElement){a=!!document.createElement("canvas").getContext}return a};Kekule.Render.DrawBridge2DMananger.register(Kekule.Render.CanvasRendererBridge,20);if(this.Raphael){Raphael.fn.line=function(b,d,a,c){return this.path("M"+b+" "+d+" L"+a+" "+c)};Raphael.fn.arrowLine=function(c,h,a,g,j){if(!j){return this.line(c,h,a,g)}var n=this.set();var m=a-c;var k=g-h;var f=Math.atan(k/m);var b=(j.width||6)/2;var d=j.length||3;var i=Math.atan(b/d);var e=Math.sqrt(Math.sqr(b)+Math.sqr(d));n.push(this.path("M"+a+" "+g+" L"+(a-e*Math.cos(f-i))+" "+(g-e*Math.sin(f-i))+" M"+a+" "+g+" L"+(a-e*Math.cos(f+i))+" "+(g-e*Math.sin(f+i))),this.path("M"+c+" "+h+" L"+a+" "+g));return n};Raphael.fn.triangle=function(d,f,b,e,a,c){return this.path("M"+d+" "+f+" L"+b+" "+e+" L"+a+" "+c+" L"+d+" "+f)};Raphael.fn.polygon=function(d){var c="M"+d[0].x+" "+d[0].y;for(var b=1,a=d.length;b<a;++b){c+=" L"+d[b].x+" "+d[b].y}c+="L"+d[0].x+" "+d[0].y;return this.path(c)};Raphael.el.translateCoord=function(b){if(this.forEach){this.forEach(function(c){c.translateCoord(b)})}else{var a=this.attr(["x","y"]);if((typeof(a.x)!="undefined")&&(typeof(a.y)!="undefined")){this.attr({x:a.x+b.x,y:a.y+b.y})}}return this};Raphael.st.translateCoord=function(a){if(this.forEach){this.forEach(function(b){b.translateCoord(a)})}return this};Raphael.st.remove=function(a){this.forEach(function(b){b.remove()},this);this.clear()}}Kekule.Render.RaphaelRendererBridge=Class.create({CLASS_NAME:"Kekule.Render.RaphaelRendererBridge",createContext:function(b,c,a){return Raphael(b,c,a)},releaseContext:function(a){a.remove()},getContextDimension:function(a){return{width:a.width,height:a.height}},setContextDimension:function(b,c,a){b.setSize(c,a);this.clearContext(b)},clearContext:function(a){a.clear();var b=a.__$clearColor__;if(b){var c=this.getContextDimension(a);this.drawRect(a,{x:0,y:0},{x:c.width,y:c.height},{fillColor:b,strokeColor:b})}},setClearColor:function(b,a){if(b){b.__$clearColor__=a}},getContextElem:function(a){return a?a.canvas:null},transformContextCoordToScreen:function(a,b){return b},transformScreenCoordToContext:function(a,b){return b},canModifyGraphic:function(a){return true},drawPath:function(a,m,n){var d="";for(var f=0,b=m.length;f<b;++f){var g=m[f];d+=g.method;if(g.params&&g.params.length){for(var e=0,c=g.params.length;e<c;++e){d+=(e===0)?"":",";if(DataType.isArrayValue(g.params[e])){d+=g.params[e].join(",")}else{d+=g.params[e]}}}}var h=a.path(d);this.setBasicElemAttribs(h,n);return h},drawLine:function(c,e,d,b){var a=c.line(e.x,e.y,d.x,d.y);this.setBasicElemAttribs(a,b);return a},drawTriangle:function(c,f,e,d,b){var a=c.triangle(f.x,f.y,e.x,e.y,d.x,d.y);this.setBasicElemAttribs(a,b);return a},drawRect:function(c,e,d,b){var a=c.rect(e.x,e.y,d.x-e.x,d.y-e.y);this.setBasicElemAttribs(a,b);return a},drawRoundRect:function(d,f,e,b,c){var a=d.rect(f.x,f.y,e.x-f.x,e.y-f.y,b);this.setBasicElemAttribs(a,c);return a},drawCircle:function(d,e,b,c){var a=d.circle(e.x,e.y,b);this.setBasicElemAttribs(a,c);return a},drawImage:function(d,h,f,c,b,i){try{var a=d.image(h,f.x,f.y,c.x,c.y);this.setBasicElemAttribs(a,b);if(i){i(true)}}catch(g){if(i){i(false)}throw g}return a},drawImageElem:function(c,e,d,b,a){return this.drawImage(c,e.src,d,b,a)},setBasicElemAttribs:function(b,a){if(Kekule.ObjUtils.notUnset(a.strokeWidth)){b.attr("stroke-width",a.strokeWidth)}if(a.strokeColor){b.attr("stroke",a.strokeColor)}if(a.strokeDash){var c="- ";b.attr("stroke-dasharray",c)}if(a.fillColor){b.attr("fill",a.fillColor)}if(a.opacity){b.attr({"stroke-opacity":a.opacity,"fill-opacity":a.opacity})}if(a.lineCap){b.attr("stroke-linecap",a.linecap)}if(a.lineJoin){b.attr("stroke-linejoin",a.linejoin)}},getRaphaelFontStyle:function(b){var a={};if(b.fontStyle){a["font-style"]=b.fontStyle}if(b.fontWeight){a["font-weight"]=b.fontWeight}if(b.fontSize){a["font-size"]=b.fontSize+"px"}if(b.fontFamily){a["font-family"]=b.fontFamily}return a},drawText:function(b,f,e,a){if(e.endsWith(" ")){e=e.substring(0,e.length-1)+"\u00A0"}if(e.startsWith(" ")){e="\u00A0"+e.substr(1)}var d=this.getRaphaelFontStyle(a);var c=b.text(-10000,-10000,e);c.attr(d);if(a.color){c.attr({stroke:a.color,fill:a.color})}this.modifyDrawnTextCoord(b,c,f);this.setBasicElemAttribs(c,a);return c},canMeasureText:function(a){return false},canMeasureDrawnText:function(a){return true},canModifyText:function(a){return true},measureDrawnText:function(c,f,b){var e=Kekule.oneOf;var d=f.getBBox();var a={};a.width=e(d.width,(d.x2-d.x1));a.height=e(d.height,(d.y2-d.y1));return a},modifyDrawnTextCoord:function(b,d,a){var c=this.measureDrawnText(b,d,null);d.attr({x:a.x+c.width/2,y:a.y+c.height/2})},createGroup:function(a){return a.set()},addToGroup:function(a,b){return b.push(a)},removeFromGroup:function(a,b){if(a!==b){return b.exclude(a)}else{return false}},removeDrawnElem:function(a,b){b.remove()},exportToDataUri:function(d,b,c){if(d.toSVG){var a=d.toSVG();return"data:image/svg+xml;base64,"+btoa(a)}else{if(d.canvas&&(d.canvas.tagName.toLowerCase()==="svg")){var a=XmlUtility.serializeNode(d.canvas);return"data:image/svg+xml;base64,"+btoa(a)}}}});Kekule.Render.RaphaelRendererBridge.isSupported=function(){var a=false;if(Kekule.$jsRoot.Raphael){a=!!(Raphael.svg||Raphael.vml)}return a};Kekule.Render.DrawBridge2DMananger.register(Kekule.Render.RaphaelRendererBridge,10);(function(){var f=Kekule.ObjUtils;var c=Kekule.BoxUtils;var d=Kekule.Render.Molecule3DDisplayType;var h=Kekule.Render.Bond3DRenderMode;var b=Kekule.Render.Bond3DRenderType;var a=Kekule.Render.Bond3DSpliceMode;var e=Kekule.Render.Node3DRenderMode;var g=Kekule.oneOf;Kekule.Render.Abstract3DDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.Abstract3DDrawBridge",getGraphicQualityLevel:function(){return null},setGraphicQualityLevel:function(i){},transformContextCoordToScreen:function(i,j){return{x:j.x,y:j.y}},canModifyGraphic:function(i){return false},createContext:function(j,k,i){return null},getContextDimension:function(i){return{}},setContextDimension:function(j,k,i){return null},clearContext:function(i){return null},setClearColor:function(j,i){},drawSphere:function(k,l,i,j){},drawCylinder:function(k,m,l,i,j){},drawLine:function(j,l,k,i){},createDrawGroup:function(i){},addToDrawGroup:function(i,j){},removeFromDrawGroup:function(i,j){},getCameraProps:function(i){},setCameraProps:function(i,j){},exportToDataUri:function(k,i,j){}});Kekule.Render.Base3DRenderer=Class.create(Kekule.Render.CompositeRenderer,{CLASS_NAME:"Kekule.Render.Base3DRenderer",initialize:function($super,k,i,j){$super(k,i,j)},getRendererType:function(){return Kekule.Render.RendererType.R3D},getActualTargetContext:function(i){return this.getRedirectContext()||i},getCameraProps:function(i){return this.getDrawBridge().getCameraProps(i)},setCameraProps:function(i,j){return this.getDrawBridge().setCameraProps(i,j)},getInitialLightPositions:function(i){return this.getDrawBridge().getInitialLightPositions&&this.getDrawBridge().getInitialLightPositions(i)},getLightCount:function(i){return this.getDrawBridge().getLightCount&&this.getDrawBridge().getLightCount(i)},getLightProps:function(j,i){return this.getDrawBridge().getLightProps&&this.getDrawBridge().getLightProps(j,i)},setLightProps:function(j,i,k){return this.getDrawBridge().setLightProps(j,i,k)},drawSphere:function(k,l,i,j){return this.getDrawBridge().drawSphere(this.getActualTargetContext(k),l,i,j)},drawCylinder:function(l,n,m,j,k){var i=this.getDrawBridge();return i?i.drawCylinder(this.getActualTargetContext(l),n,m,j,k):null},drawCylinderEx:function(m,p,o,j,k){var i=null;var n=this.drawCylinder(m,p,o,j,k);if(n&&k.withEndCaps){i=this.createDrawGroup(m);var l=this.drawSphere(m,p,j);this.addToDrawGroup(l,i);var l=this.drawSphere(m,o,j);this.addToDrawGroup(l,i)}return i||n},drawParallelCylinders:function(j,q,m){var r=this.getDrawBridge();if(r.drawParallelCylinders){return r.drawParallelCylinders(this.getActualTargetContext(j),q,m)}else{var s=this.createDrawGroup(j);for(var p=0,n=q.length;p<n;++p){var k=q[p];var o=this.drawCylinderEx(j,k.coord1,k.coord2,k.radius,{color:k.color,withEndCaps:m});if(o){this.addToDrawGroup(o,s)}}return s}},drawLine:function(k,m,l,j){var i=this.getDrawBridge();return i?i.drawLine(this.getActualTargetContext(k),m,l,j):null},drawParallelLines:function(j,k){var r=this.getDrawBridge();if(r.drawParallelLines){return r.drawParallelLines(this.getActualTargetContext(j),k,drawEndCaps)}else{if(r.drawLine){var q=k.length;var t=[];for(var p=0;p<q;++p){var m=k[p];var n=this.drawLine(j,m.coord1,m.coord2,{lineWidth:m.lineWidth,color:m.color,opacity:m.opacity});if(n){t.push(n)}}var s;if(t.length<=1){s=t[0]}else{s=this.createDrawGroup(j);for(var p=0,o=t.length;p<o;++p){this.addToDrawGroup(t[p],s)}}return s}}},createDrawGroup:function(i){return this.getDrawBridge().createGroup(this.getActualTargetContext(i))},addToDrawGroup:function(i,j){return this.getDrawBridge().addToGroup(i,j)},removeFromDrawGroup:function(i,j){return this.getDrawBridge().removeFromGroup(i,j)},removeDrawnElem:function(i,j){}});Kekule.Render.ChemObj3DRenderer=Class.create(Kekule.Render.Base3DRenderer,{CLASS_NAME:"Kekule.Render.ChemObj3DRenderer",initialize:function($super,k,i,j){$super(k,i,j);this._enableTransformByCamera=true},doEstimateSelfObjBox:function(k,j,i){return Kekule.Render.ObjUtils.getContainerBox(this.getChemObj(),this.getCoordMode(),i)},doEstimateRenderBox:function(k,l,j,i){var n=this.estimateObjBox(k,j,i);if(n){var m=this.prepareTransformParams(k,l,j,n);var o=m;return c.transform3D(n,o)}else{return null}},beginDraw:function($super,k,l,j){$super(k,l,j);if(this.isRootRenderer()){var i=this.getDrawBridge();if(i&&i.setGraphicQualityLevel){var m=j.graphicQuality;i.setGraphicQualityLevel(m)}}},endDraw:function($super,j,k,i){if(this.isRootRenderer()){this.adjustCamera(j,i.transformParams)}$super(j,k,i)},doDraw:function($super,k,l,j){this.prepareTransformParams(k,l,j);var i=$super(k,l,j);return i},changeGeometryOptions:function(i,k,m){var j=Object.create(m);var l=this.prepareTransformParams(i,k,j);if(l.pureCameraTransform){this.endDraw(i,k,j)}else{this.getDrawBridge().clearContext(i);this.draw(i,k,m)}},prepareTransformParams:function(k,l,o,q){var i;if(o.transformParams){i=o.transformParams}else{var n=this.generateTransformParams(k,l,o,q);o.transformParams=n;i=n}var j=Kekule.CoordUtils.calcTransform3DMatrix(i);var m=Kekule.CoordUtils.calcInverseTransform3DMatrix(i);o.transformParams.transformMatrix=j;o.transformParams.invTransformMtrix=m;this.getRenderCache(k).transformParams=i;this.getRenderCache(k).transformMatrix=j;this.getRenderCache(k).invTransformMatrix=m;this.getRenderCache(k).transformParams=i;return i},canDoPureCameraTransform:function(i,k){var j=this._enableTransformByCamera&&(k.scaleX===k.scaleY)&&(k.scaleY===k.scaleZ)&&(!k.rotateAngle)&&(!k.rotateX)&&(!k.rotateY)&&(!k.rotateZ);return j},generateTransformParams:function(n,R,p,E){var y={};y.allowCoordBorrow=g(p.allowCoordBorrow,false);y.unitLength=p.unitLength||1;if(!E){E=this.estimateObjBox(n,p,y.allowCoordBorrow)}var H={x:(E.x1+E.x2)/2,y:(E.y1+E.y2)/2,z:(E.z1+E.z2)/2};var t=Kekule.ObjUtils;if(t.isUnset(p.translateX)&&t.isUnset(p.translateY)&&t.isUnset(p.translateZ)){if(R){y.translateX=R.x-H.x;y.translateY=R.y-H.y;y.translateZ=R.z||0-H.z||0}}else{y.translateX=p.translateX||0;y.translateY=p.translateY||0;y.translateZ=p.translateZ||0}y.zoom=p.zoom||1;y.scaleX=g(p.scaleX,p.scale,1);y.scaleY=g(p.scaleY,p.scale,1);y.scaleZ=g(p.scaleZ,p.scale,1);var Q=!(p.scaleX||p.scaleY||p.scaleZ||p.scale);if(f.notUnset(p.rotateMatrix)){y.rotateMatrix=p.rotateMatrix}else{if(f.notUnset(p.rotateAngle)&&f.notUnset(p.rotateAxisVector)){y.rotateMatrix=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:p.rotateAngle,rotateAxisVector:p.rotateAxisVector})}else{if(y.rotateX||y.rotateY||y.rotateZ){y.rotateMatrix=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:p.rotateX||0,rotateY:p.rotateY||0,rotateZ:p.rotateZ||0})}}}if(t.isUnset(p.center)){y.center=H}if(R){y.drawBaseCoord=R}else{y.drawBaseCoord=Kekule.CoordUtils.transform3D(H,y)}var u=Object.extend({},y);y=this.getFinalTransformParams(n,y);y.initialTransformOptions=u;var A=this.canDoPureCameraTransform(n,y);y.pureCameraTransform=A;if(this.isRootRenderer()){if(p.autofit||(!p.cameraPos)){var J=this.getAutofitObjBoxInflation(n,this.getChemObj(),p);var S=Kekule.BoxUtils.inflateBox(E,J.x,J.y,J.z);var z=Math.max(S.x2-S.x1,S.y2-S.y1);var T=this.getCameraProps(n);var I=z/2/Math.tan(T.fov/2);var F=Math.sqrt(Math.sqr(I)-Math.sqr(z/2));if(A){F=F/y.scaleX;y.cameraWidth=z/y.scaleX;y.cameraHeight=y.cameraWidth;var M=Kekule.MatrixUtils.create(4,1,[0,0,1,1]);var P=Kekule.MatrixUtils.create(4,1,[0,1,1,1]);var G,D;var L,o;if(y.rotateMatrix){var x=Kekule.MatrixUtils.transpose(y.rotateMatrix);G=Kekule.MatrixUtils.multiply(x,M);L=Kekule.MatrixUtils.multiply(x,P);D={x:G[0],y:G[1],z:G[2]};o={x:L[0],y:L[1],z:L[2]}}else{D={x:0,y:0,z:1};o={x:0,y:1,z:1}}D=Kekule.CoordUtils.multiply(D,F);y.cameraPos={x:D.x,y:D.y,z:D.z};y.cameraPos=Kekule.CoordUtils.add(y.cameraPos,y.drawBaseCoord);y.cameraUp=o;y.scaleX=y.scaleY=y.scaleZ=1;var N=this.getInitialLightPositions(n);if(x){var q=this.getLightCount(n);if(N&&N.length&&q){var s=Math.min(N.length,q);var k=[];for(var K=0;K<s;++K){var r=N[K];if(r){var j=Kekule.MatrixUtils.create(4,1,[r.x,r.y,r.z,1]);var v=Kekule.MatrixUtils.multiply(x,j);var m={x:v[0],y:v[1],z:v[2]};k.push(m)}}}}y.lightPositions=k||N;y.rotateMatrix=null}else{y.cameraPos={x:y.drawBaseCoord.x,y:y.drawBaseCoord.y,z:F+y.drawBaseCoord.z};y.cameraUp={x:0,y:1,z:1}}y.cameraLookAtVector=y.drawBaseCoord||{x:0,y:0,z:0};var B={x:-y.translateX,y:-y.translateY,z:-y.translateZ};y.translateX=y.translateY=y.translateZ=0;y.cameraPos=Kekule.CoordUtils.add(y.cameraPos,B);y.cameraLookAtVector=Kekule.CoordUtils.add(y.cameraLookAtVector,B)}}return y},getFinalTransformParams:function(j,k){var i=Object.create(k);if(i.zoom){i.scaleX*=i.zoom;i.scaleY*=i.zoom;i.scaleZ*=i.zoom}if(i.unitLength!==1){i.translateX*=i.unitLength;i.translateY*=i.unitLength;i.translateZ*=i.unitLength;if(i.drawBaseCoord){i.drawBaseCoord=Kekule.CoordUtils.multiply(i.drawBaseCoord,i.unitLength)}}return i},getRenderFinalTransformParams:function(i){return this.getRenderCache(i).transformParams},getRenderInitialTransformOptions:function(i){var j=this.getRenderFinalTransformParams(i);return j?j.initialTransformOptions:null},getAutofitObjBoxInflation:function(i,l,k){var j=k.fixedNodeRadius||0;return{x:j,y:j,z:j}},adjustCamera:function(m,o){var j=o.cameraWidth;var n=o.cameraHeight;var k={position:o.cameraPos,upVector:o.cameraUp,lookAtVector:o.cameraLookAtVector};if(j&&n){var i=j/2;var l=n/2;k.left=-i;k.right=i;k.top=l;k.bottom=-l}this.setCameraProps(m,k);this.adjustLights(m,o)},adjustLights:function(n,p){var k=p.lightPositions||[];for(var m=0,j=k.length;m<j;++m){var o=k[m];if(o){this.setLightProps(n,m,{position:o})}}}});Kekule.Render.ChemCtab3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemCtab3DRenderer",TRANSFORM_COORD_FIELD:"__$transCoord3D__",DRAW_ELEM_FIELD:"__$drawElem__",DRAW_COLOR_FIELD:"__$drawColor__",BASE_RADIUS_FIELD:"__$baseRadius__",TRANSFORM_MATRIX_FIELD:"__$transMatrix__",INV_TRANSFORM_MATRIX_FIELD:"__$inverseTransMatrix__",CHILD_TRANSFORM_MATRIX_FIELD:"__$childTransMatrix__",HIDDEN_NODES_FIELD:"__$hiddenNodes__",HIDDEN_CONNECTORS_FIELD:"__$hiddenConnectors__",getObjDrawElem:function(i,j){return this.getExtraProp2(i,j,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(i,k,j){this.setExtraProp2(i,k,this.DRAW_ELEM_FIELD,j)},getObjDrawColor:function(i,j){return this.getExtraProp2(i,j,this.DRAW_COLOR_FIELD)},setObjDrawColor:function(i,k,j){this.setExtraProp2(i,k,this.DRAW_COLOR_FIELD,j)},getNodeBaseRadius:function(i,j){return this.getExtraProp2(i,j,this.BASE_RADIUS_FIELD)},setNodeBaseRadius:function(i,k,j){this.setExtraProp2(i,k,this.BASE_RADIUS_FIELD,j)},getHiddenNodes:function(i){return this.getExtraProp(i,this.HIDDEN_NODES_FIELD)||[]},setHiddenNodes:function(i,j){return this.setExtraProp(i,this.HIDDEN_NODES_FIELD,j)},getHiddenConnectors:function(i){return this.getExtraProp(i,this.HIDDEN_CONNECTORS_FIELD)||[]},setHiddenConnectors:function(i,j){return this.setExtraProp(i,this.HIDDEN_CONNECTORS_FIELD,j)},doEstimateSelfObjBox:function(k,j,i){var l=this.getChemObj().getExposedContainerBox3D(i);return l},doPrepare:function(j,q,p,r){var n=r;var o=this.getRenderCache(j);var l,m;switch(n.moleculeDisplayType){case d.WIRE:l=e.NONE;m=n.displayMultipleBond?h.MULTI_WIRE:h.WIRE;break;case d.STICKS:l=e.NONE;m=n.displayMultipleBond?h.MULTI_CYLINDER:h.CYLINDER;break;case d.SPACE_FILL:l=e.SPACE;m=h.NONE;break;case d.BALL_STICK:default:l=e.BALL;m=n.displayMultipleBond?h.MULTI_CYLINDER:h.CYLINDER;break}o.nodeRenderMode=l;o.connectorRenderMode=m;o.options=n;var i=q.getExposedNodes();var k=q.getExposedConnectors();this.prepareHiddenObjects(j,i,k,n);this.prepareNodesDrawColor(j,i,n);this.prepareNodeBaseRadii(j,i,n);return n},prepareHiddenObjects:function(k,j,o,m){var u=[];this.setHiddenNodes(k,u);for(var t=0,r=j.length;t<r;++t){var p=j[t];if(m.hideHydrogens&&(p instanceof Kekule.Atom)&&(p.getAtomicNumber()===1)){u.push(p)}}var v=[];this.setHiddenConnectors(k,v);for(var t=0,r=o.length;t<r;++t){var q=o[t];var s=q.getConnectedExposedObjs();var n=Kekule.ArrayUtils.exclude(s,u);if(n<2){v.push(q)}}},prepareNodesDrawColor:function(m,k,n){var j=n.useAtomSpecifiedColor;for(var s=0,p=k.length;s<p;++s){var o=k[s];var r=o.getOverriddenRender3DOptions()||{};var q=r.color||r.atomColor;if(q&&(!r.useAtomSpecifiedColor)){}else{if(j||r.useAtomSpecifiedColor){var t=o.getAtomicNumber?o.getAtomicNumber():0;if(t>=0){q=Kekule.Render.RenderColorUtils.getColor(t,this.getRendererType())}else{q=Kekule.Render.RenderColorUtils.getColor(o.getClassLocalName(),this.getRendererType())}}else{q=g(r.color||n.atomColor)}}this.setObjDrawColor(m,o,q)}},prepareNodeBaseRadii:function(p,n,m){for(var o=0,k=n.length;o<k;++o){var j;var q=n[o];j=this.calcNodeBaseRadius(q,m);this.setNodeBaseRadius(p,q,j)}},calcNodeBaseRadius:function(l,j){var m=l.getOverriddenRender3DOptions()||{};var i=l.getAtomicNumber?l.getAtomicNumber():null;if(m.nodeRadius||j.nodeRadius){radius=m.nodeRadius||j.nodeRadius}else{if(g(m.useVdWRadius,j.useVdWRadius)&&i){var k=Kekule.ChemicalElementsDataUtil.getElementProp(i,"radiiVdw")||m.fixedNodeRadius||j.fixedNodeRadius;radius=k}else{radius=g(m.fixedNodeRadius,j.fixedNodeRadius)}}return radius},doDrawSelf:function($super,j,l,i){$super(j,l,i);var n=this.getChemObj();var k=i.transformParams;this.getRenderCache(j).transformOptions=k;this.transformCtabCoords3DToContext(j,n,k);var m=this.doPrepare(j,n,l,i);return this.doDrawCore(j,n,m,k)},doRedraw:function(i){var j=this.getRenderCache(i);return this.doDrawCore(i,this.getChemObj(),j.options,j.transformOptions)},doDrawCore:function(j,m,i,k){var l=this.createDrawGroup(j);this.doDrawConnectors(j,l,m,i,k);this.doDrawNodes(j,l,m,i,k);this.setObjDrawElem(j,m,l);return l},transformCtabCoords3DToContext:function(j,s,p){var n=p.allowCoordBorrow;p.scaleX=p.scaleX||p.scale;p.scaleY=(p.scaleY||p.scale);p.scaleZ=(p.scaleZ||p.scale);var q=Object.extend({},p);q.centerX=0;q.centerY=0;var v;var r=p.transformMatrix;this.setExtraProp2(j,s,this.TRANSFORM_MATRIX_FIELD,r);var k=r;this.setExtraProp2(j,s,this.CHILD_TRANSFORM_MATRIX_FIELD,r);var u=p.invTransformMatrix;this.setExtraProp2(j,s,this.INV_TRANSFORM_MATRIX_FIELD,u);for(var t=0,o=s.getNodeCount();t<o;++t){var m=s.getNodeAt(t);this.transformObjCoord3DToContext(j,m,r,k,n)}},transformObjCoord3DToContext:function(j,o,n,q,k){var s;if(o&&o.getAbsBaseCoord3D){coord=o.getAbsBaseCoord3D(k);if(coord){var r=Kekule.CoordUtils.transform3DByMatrix(coord,n);this.setTransformedCoord3D(j,o,r);s=r}if(o.getNodes){for(var p=0,m=o.getNodeCount();p<m;++p){this.transformObjCoord3DToContext(j,o.getNodeAt(p),q,q,k)}}}return s},getTransformedCoord3D:function(m,p,l){if(Kekule.ObjUtils.isUnset(l)){l=this.getRenderCache(m).options.transformParams.allowCoordBorrow}var o=p instanceof Kekule.BaseStructureNode;var j=o&&this.getExtraProp2(m,p,this.TRANSFORM_COORD_FIELD);if(!j){var n=this.getChemObj();var k=this.getExtraProp2(m,n,this.TRANSFORM_MATRIX_FIELD);var i=this.getExtraProp2(m,n,this.CHILD_TRANSFORM_MATRIX_FIELD);if(n&&(n.hasNode(p,false)||n.hasConnector(p,false))){j=this.transformObjCoord3DToContext(p,k,i,l)}else{j=this.transformObjCoord3DToContext(p,i,i,l)}}return j},setTransformedCoord3D:function(i,j,k){this.setExtraProp2(i,j,this.TRANSFORM_COORD_FIELD,k)},doTransformCoordToObj:function(j,l,k){var i=this.getExtraProp2(j,l,this.INV_TRANSFORM_MATRIX_FIELD);return Kekule.CoordUtils.transform3DByMatrix(k,i)},doTransformCoordToContext:function(j,l,k){var i=this.getExtraProp2(j,l,this.TRANSFORM_MATRIX_FIELD);return Kekule.CoordUtils.transform3DByMatrix(k,i)},doDrawNodes:function(k,t,q,u,m){var j=q.getExposedNodes();var s=this.getHiddenNodes(k);for(var r=0,p=j.length;r<p;++r){var o=j[r];if(s.indexOf(o)>=0){continue}var n=this.doDrawNode(k,t,o,q,u,m)}},doDrawNode:function(j,r,l,o,s,k){var t;var m=this.getRenderCache(j).nodeRenderMode;if(m===e.NONE){return null}else{op=Kekule.Render.RenderOptionUtils.mergeObjLocalRender3DOptions(l,s);var i;i=this.getNodeBaseRadius(j,l);if(Kekule.ObjUtils.isUnset(i)){i=this.calcNodeBaseRadius(l,s)}if(m===e.SPACE){i*=k.scaleX}else{i*=op.nodeRadiusRatio*k.scaleX}var n=this.getObjDrawColor(j,l);var q=this.getTransformedCoord3D(j,l,k.allowCoordBorrow);t=this.drawSphere(j,q,i,{color:n,opacity:op.opacity});var p=this.createSphereBoundInfo(q,i);this.basicDrawObjectUpdated(j,l,o,p,Kekule.Render.ObjectUpdateType.ADD)}if(t){this.setObjDrawElem(j,l,t);if(r){this.addToDrawGroup(t,r)}}},doDrawConnectors:function(j,t,q,u,k){if(this.getRenderCache(j).connectorRenderMode===h.NONE){return null}var m=q.getExposedConnectors();var s=this.getHiddenConnectors(j);for(var r=0,p=m.length;r<p;++r){var o=m[r];if(s.indexOf(o)>=0){continue}var n=this.doDrawConnector(j,t,o,q,u,k)}},doDrawConnector:function(l,q,k,p,o,t){var s=Object.create(o);s=Kekule.Render.RenderOptionUtils.mergeObjLocalRender3DOptions(k,o);var A=this.getHiddenNodes(l);var r=k.getConnectedExposedObjs();r=Kekule.ArrayUtils.exclude(r,A);var u=r.length;var y,x;var n,m;var B=(u>2)?this.createDrawGroup(l):null;var z;for(var w=0;w<u;++w){y=r[w];n=this.getTransformedCoord3D(l,y,t.allowCoordBorrow);if(n){for(var v=w+1;v<u;++v){x=r[v];m=this.getTransformedCoord3D(l,x,t.allowCoordBorrow);if(m){z=this.doDrawConnectorShape(l,k,y,x,p,n,m,s,t);if(z&&B){this.addToDrawGroup(z,B)}}}}}if(B){this.addToDrawGroup(B,q)}else{this.addToDrawGroup(z,q)}return B||z},doDrawConnectorShape:function(al,o,I,H,u,ai,ah,P,ag){var B=Kekule.CoordUtils;var F=o.getOverriddenRender3DOptions()||{};var S=P.unitLength;var aa=g(F.bondSpliceMode,P.bondSpliceMode);var K=(aa===a.MID_SPLIT)?0.5:null;if(aa===a.WEIGHTING_SPLIT){var A=this.getNodeBaseRadius(al,I);var z=this.getNodeBaseRadius(al,H);if(A&&z){K=A/(A+z)}else{K=0.5}}var x=null;var ae=false;var Z=[];if(K){var m=g(P.color||P.bondColor);var V=g(F.color||F.bondColor);ae=false;if(V){Z.push(V)}else{var O=g(this.getObjDrawColor(al,I),m);var M=g(this.getObjDrawColor(al,H),m);if(O!==M){Z.push(O);Z.push(M);ae=true}else{Z.push(g(O,P.color,P.bondColor,P.defBondColor))}}}else{Z.push(g(F.color,F.bondColor,P.color,P.bondColor,P.defBondColor))}if(K&&ae){var t=ah.x-ai.x;var s=ah.y-ai.y;var q=ah.z-ai.z;x={};x.x=ai.x+t*K;x.y=ai.y+s*K;x.z=ai.z+q*K}var W=ae?[[ai,x],[x,ah]]:[[ai,ah]];var aj=this.getRenderCache(al).connectorRenderMode;var E=this._getBondRenderType(o,aj);var p=false;var ak=g(F.connectorRadius,P.connectorRadius)*g(F.connectorRadiusRatio,P.connectorRadiusRatio)*P.unitLength;ak*=ag.scaleX;var J=g(F.connectorLineWidth,P.connectorLineWidth)*P.unitLength;if((E!==b.SINGLE)&&(E!==b.DASH)){ak*=g(F.multiConnectorRadiusRatio,P.multiConnectorRadiusRatio);p=(aj===h.MULTI_CYLINDER)}else{p=false}var R=[];var X=1,w=0;switch(E){case b.SINGLE:X=1;break;case b.DOUBLE:X=2;break;case b.TRIPLE:X=3;break;case b.DASH:case b.SOLID_DASH:}w=X;var N=null;if(w>1){var y=g(F.multiConnectorMarginRatio,P.multiConnectorMarginRatio)*ak;if(p){y+=ak*2}var Y=B.getDistance(ai,ah);var L=B.substract(ah,ai);var v=L.y/Y;var Q=L.x/Y;var G={x:-y*v,y:y*Q,z:0};N=((w%2)?0:0.5)-Math.floor(w/2);var r=B.multiply(G,N)}for(var ad=0,ab=W.length;ad<ab;++ad){if(w===1){var D={};D.coord1=W[ad][0];D.coord2=W[ad][1];if(ae){D.jointCoordIndex=(ad===0)?2:1}D.color=Z[ad];D.radius=ak;D.lineWidth=J;D.opacity=P.opacity;R.push(D)}else{var n=B.add(W[ad][0],r);var k=B.add(W[ad][1],r);for(var ac=0;ac<w;++ac){var D={};D.coord1=n;D.coord2=k;n=B.add(n,G);k=B.add(k,G);if(ae){D.jointCoordIndex=(ad===0)?2:1}D.color=Z[ad];D.radius=ak;D.lineWidth=J;D.opacity=P.opacity;R.push(D)}}}var T=aj;var af;if((T===h.WIRE)||(T===h.MULTI_WIRE)){af=this.createLineBoundInfo(ai,ah,{width:J})}else{af=this.createCylinderBoundInfo(ai,ah,{radius:ak})}this.basicDrawObjectUpdated(al,o,u,af,Kekule.Render.ObjectUpdateType.ADD);return this.doDrawConnectorSet(al,R,T,E,P)},doDrawConnectorSet:function(k,m,n,l,j){if((n===h.WIRE)||(n===h.MULTI_WIRE)){return this.drawParallelLines(k,m)}else{var i=this.getRenderCache(k).nodeRenderMode===e.NONE;return this.drawParallelCylinders(k,m,i)}},_getBondRenderType:function(j,k){var l=j.getOverriddenRender3DOptions()||{};var i=Kekule.Render.Render3DOptionUtils.getConnectorRenderType(l);if(i){return i}else{return Kekule.Render.ConnectorDrawUtils.getConnectorRender3DType(j,k)}}});Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.Render.ChemCtab3DRenderer);Kekule.Render.StructFragment3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.StructFragment3DRenderer",initialize:function($super,k,i,j){$super(k,i,j);this._concreteRenderer=null;if(k.hasCtab()){this._concreteRenderer=new Kekule.Render.ChemCtab3DRenderer(k.getCtab(),i,this)}else{this._concreteRenderer=null;Kekule.raise(Kekule.$L("ErrorMsg.FORMULA_RENDERER_3D_NOT_AVAILABLE"))}this._concreteRenderer.setParentRenderer(this)},finalize:function($super){$super();if(this._concreteRenderer){this._concreteRenderer.finalize()}},getRenderCache:function(i){return this._concreteRenderer.getRenderCache(i)},_getConcreteRendererDrawOptions:function(i){var j=Object.create(i);var l=this.getChemObj();var k=(this.getRendererType()===Kekule.Render.RendererType.R3D)?l.getOverriddenRender3DOptions():l.getOverriddenRenderOptions();j=Object.extend(j,k||{});return j},isChemObjRenderedBySelf:function($super,j,k){var i=$super(j,k)||(k===this.getChemObj())||this._concreteRenderer.isChemObjRenderedBySelf(j,k);return i},isChemObjRenderedDirectlyBySelf:function($super,i,j){return $super(i,j)||(j===this.getChemObj())},doSetRedirectContext:function($super,i){$super(i);this._concreteRenderer.setRedirectContext(i)},doDrawSelf:function($super,j,k,i){$super(j,k,i);return this._concreteRenderer.draw(j,k,this._getConcreteRendererDrawOptions(i))},doRedraw:function(i){return this._concreteRenderer.redraw(i)},doUpdateSelf:function(j,m,i){var l=this._extractObjsOfUpdateObjDetails(m);if(l.indexOf(this.getChemObj())>=0){var k=this.getRenderCache(j);this.doClear(j);return this.draw(j,k.baseCoord,k.options)}return this._concreteRenderer.doUpdate(j,m,i)},doClearSelf:function(i){var j=this._concreteRenderer;if(j){return j.clear(i)}},estimateRenderBox:function(k,j,i){return this._concreteRenderer.estimateRenderBox(k,this._getConcreteRendererDrawOptions(j),i)},getChildObjs:function($super){var p=this.getChemObj();if(p&&p.getAttachedMarkers){var m=[];var n=(p.getExposedNodes()||[]).concat(p.getExposedConnectors()||[]);for(var k=0,j=n.length;k<j;++k){var o=n[k];m=m.concat(o.getAttachedMarkers()||[])}return m.concat($super())}else{return $super()}},_needWholelyDraw:function($super,j,k){var r=$super(j,k);if(!r){var q=this.getChemObj();var m=false;for(var p=0,o=j.length;p<o;++p){var n=j[p];if(n.isChildOf(q)){m=true;break}}r=m}return r},transformCoordToObj:function(i,l,k){var j=(this.getChemObj()===l)?this._concreteChemObj:l;return this._concreteRenderer.transformCoordToObj(i,j,k)},transformCoordToContext:function(i,l,k){var j=(this.getChemObj()===l)?this._concreteChemObj:l;return this._concreteRenderer.transformCoordToContext(i,j,k)}});Kekule.Render.Mol3DRenderer=Kekule.Render.StructFragment3DRenderer;Kekule.Render.CompositeObj3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.CompositeObj3DRenderer"});Kekule.Render.CompositeMolecule3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule3DRenderer",getChildObjs:function($super){var m=[];var n=this.getChemObj().getSubMolecules();for(var k=0,j=n.getItemCount();k<j;++k){var p=n.getObjAt(k);m.push(p)}return m.concat($super())}});Kekule.Render.ChemObjGroupList3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemObjGroupList3DRenderer",getChildObjs:function($super){var n=this.getChemObj();if(n instanceof Kekule.ChemObjList){var m=[];for(var k=0,j=n.getItemCount();k<j;++k){m.push(n.getItemAt(k))}}else{if(n instanceof Kekule.ChemStructureObjectGroup){m=n.getAllObjs()}}return(m||[]).concat($super())}});Kekule.Render.ChemSpaceElement3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpaceElement3DRenderer",getChildObjs:function($super){return(this.getChemObj().getChildren().toArray()||[]).concat($super())}});Kekule.Render.ChemSpace3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpace3DRenderer",getChildObjs:function($super){return[this.getChemObj().getRoot()].concat($super())}});Kekule.Render.Renderer3DFactory.register(Kekule.StructureFragment,Kekule.Render.StructFragment3DRenderer);Kekule.Render.Renderer3DFactory.register(Kekule.CompositeMolecule,Kekule.Render.CompositeMolecule3DRenderer);Kekule.Render.Renderer3DFactory.register(Kekule.ChemObjList,Kekule.Render.ChemObjGroupList3DRenderer);Kekule.Render.Renderer3DFactory.register(Kekule.ChemStructureObjectGroup,Kekule.Render.ChemObjGroupList3DRenderer);Kekule.Render.Renderer3DFactory.register(Kekule.ChemSpaceElement,Kekule.Render.ChemSpaceElement3DRenderer);Kekule.Render.Renderer3DFactory.register(Kekule.ChemSpace,Kekule.Render.ChemSpace3DRenderer)})();if(Kekule.$jsRoot.THREE){THREE.Object3D.prototype.clear=function(){var b=this.children;for(var a=b.length-1;a>=0;a--){var c=b[a];c.clear();this.remove(c)}};THREE.Scene.prototype.clearMesh=function(){var b=this.children;for(var a=b.length-1;a>=0;a--){var c=b[a];if((c instanceof THREE.Mesh)||(c instanceof THREE.Line)||(c.__objGroup__)){c.clear();this.remove(c)}}}}Kekule.Render.ThreeObjectCache=Class.create({CLASS_NAME:"Kekule.Render.ThreeObjectCache",initialize:function(){this.cache=new Kekule.MapEx(true)},finalize:function(){this.cache.finalize();this.cache=null},createInstance:function(a,b){return null},isSameParams:function(d,c){if(d.length!==c.length){return false}for(var b=0,a=d.length;b<a;++b){if(!this.isParamEqual(d[b],c[b])){return false}}return true},isParamEqual:function(c,b){var a=(c===b);if(!a){if(DataType.isObjectValue(c)&&DataType.isObjectValue(b)){a=Kekule.ObjUtils.equal(c,b)}}return a},add:function(){var c=Array.prototype.slice.call(arguments);var b=c.shift();var d=this.cache.get(b);if(!d){d=[];this.cache.set(b,d)}var e={params:c};e.instance=this.createInstance(b,c);d.push(e);return e.instance},get:function(){var d=Array.prototype.slice.call(arguments);var b=d[0];var e=this.cache.get(b);if(e){d.shift();for(var f=0,c=e.length;f<c;++f){var g=e[f].params;if(this.isSameParams(g,d)){return e[f].instance}}d.unshift(b)}return this.add.apply(this,d)}});Kekule.Render.ThreeGeometryCache=Class.create(Kekule.Render.ThreeObjectCache,{CLASS_NAME:"Kekule.Render.ThreeGeometryCache",createInstance:function(d,f){var b=null;var c=f;var e=c[0];switch(d){case THREE.SphereGeometry:b=new THREE.SphereGeometry(c[1],c[2],c[3]);break;case THREE.CylinderGeometry:b=new THREE.CylinderGeometry(c[1],c[2],c[3],c[4],c[5],c[6]);break}return b}});Kekule.ClassUtils.makeSingleton(Kekule.Render.ThreeGeometryCache);Kekule.Render.ThreeMaterialCache=Class.create(Kekule.Render.ThreeObjectCache,{CLASS_NAME:"Kekule.Render.ThreeMaterialCache",createInstance:function(a,b){return new a(b[1])}});Kekule.ClassUtils.makeSingleton(Kekule.Render.ThreeMaterialCache);Kekule.Render.ThreeContext=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.ThreeContext",initialize:function($super,d,b,a,c){$super();this.setScene(d);this.setCamera(b);this.setLights(a);this.setRenderer(c)},initProperties:function(){this.defineProp("scene",{dataType:DataType.OBJECT,serializable:false});this.defineProp("camera",{dataType:DataType.OBJECT,serializable:false});this.defineProp("lights",{dataType:DataType.ARRAY,serializable:false});this.defineProp("renderer",{dataType:DataType.OBJECT,serializable:false});this.defineProp("width",{dataType:DataType.INT,serializable:false,setter:null});this.defineProp("height",{dataType:DataType.INT,serializable:false,setter:null})},getDimension:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimension:function(b,a){this.setPropStoreFieldValue("width",b);this.setPropStoreFieldValue("height",a);this.getRenderer().setSize(b,a);var d=this.getCamera();if(d instanceof THREE.OrthographicCamera){d.left=b/-2;d.right=b/2;d.top=a/2;d.bottom=a/-2}else{d.aspect=b/a}d.updateProjectionMatrix()}});Kekule.Render.ThreeRendererBridge=Class.create({CLASS_NAME:"Kekule.Render.ThreeRendererBridge",_qualitySettings:[null,{sphereSegments:6,sphereRings:6,cylinderSegmentsRadius:6},{sphereSegments:8,sphereRings:8,cylinderSegmentsRadius:8},{sphereSegments:16,sphereRings:16,cylinderSegmentsRadius:16},{sphereSegments:32,sphereRings:32,cylinderSegmentsRadius:32},{sphereSegments:64,sphereRings:64,cylinderSegmentsRadius:64}],initialize:function(){this.geometryCache=Kekule.Render.ThreeGeometryCache.getInstance();this.materialCache=Kekule.Render.ThreeMaterialCache.getInstance();this._quality=null;this._modelParams={};this._webglEnabled=true},finalize:function(){this.geometryCache=null;this.materialCache=null},getGraphicQualityLevel:function(){return this._quality},setGraphicQualityLevel:function(a){if(this._webglEnabled){this._quality=a}else{this._quality=Kekule.Render.Render3DGraphicQuality.EXTREME_LOW}this._modelParams=this.calcModelParams(this._quality)},_updateGraphicQualityLevel:function(){if(!this._webglEnabled){this.setGraphicQualityLevel(Kekule.Render.Render3DGraphicQuality.EXTREME_LOW)}},calcModelParams:function(b){var a=this._qualitySettings[b];if(!a){a=this._qualitySettings[Kekule.Render.Render3DGraphicQuality.MEDIUM]}return a},getInitialLightPositions:function(a){return[{x:5,y:5,z:10}]},createContext:function(g,a,n){var p=Kekule.BrowserFeature;var k=p.webgl?new THREE.WebGLRenderer({preserveDrawingBuffer:true,alpha:true}):p.canvas?new THREE.CanvasRenderer():new THREE.SVGRenderer();var j=new THREE.PerspectiveCamera();j.fov=5;this._webglEnabled=(k instanceof THREE.WebGLRenderer);this._updateGraphicQualityLevel();var f=new THREE.Scene();f.add(j);k.setSize(a,n);var m=this.getInitialLightPositions();var d=[];for(var e=0,c=m.length;e<c;++e){var b=new THREE.DirectionalLight(13421772,1,10,true);var h=m[e];b.position.set(h.x,h.y,h.z);f.add(b);d.push(b)}var b=new THREE.AmbientLight(2105376);f.add(b);g.appendChild(k.domElement);var o=new Kekule.Render.ThreeContext(f,j,d,k);o.setDimension(a,n);return o},releaseContext:function(a){var b=this.getContextElem(a);a.finalize();if(b){b.parentNode.removeChild(b)}},getContextElem:function(a){return a?a.getRenderer().domElement:null},getContextDimension:function(a){return{width:a.getWidth(),height:a.getHeight()}},setContextDimension:function(b,c,a){b.setDimension(c,a)},transformContextCoordToScreen:function(a,c){var b=a.getDimension();return{x:c.x+b.width/2,y:c.y+b.height/2}},transformScreenCoordToContext:function(a,c){var b=a.getDimension();return{x:c.x-b.width/2,y:c.y-b.height/2,z:0}},clearContext:function(a){a.clear()},canModifyGraphic:function(a){return true},transformContextCoordToScreen:function(a,b){return{x:b.x,y:b.y}},colorStrToHex:function(a){return Kekule.StyleUtils.colorStrToValue(a)},createGroup:function(a){var b=new THREE.Object3D();b.__objGroup__=true;a.getScene().add(b);return b},addToGroup:function(a,b){b.add(a);return b},removeFromGroup:function(a,b){b.remove(a)},setClearColor:function(b,a){var c=b.getRenderer();if(c){if(c.setClearColorHex){if(a){b.getRenderer().setClearColorHex(this.colorStrToHex(a),1)}else{b.getRenderer().setClearColorHex(null,0)}}else{if(c.setClearColor){if(a){b.getRenderer().setClearColor(this.colorStrToHex(a),1)}else{b.getRenderer().setClearColor(null,0)}}}}},clearContext:function(a){a.getScene().clearMesh();this.renderContext(a)},renderContext:function(a){a.getRenderer().render(a.getScene(),a.getCamera())},drawSphere:function(a,c,d,i){var b=this._modelParams.sphereSegments;var g=this._modelParams.sphereRings;var f=this.geometryCache.get(THREE.SphereGeometry,a.getScene(),1,b,g);var e=this.materialCache.get(THREE.MeshLambertMaterial,a.getScene(),{color:this.colorStrToHex(i.color),opacity:i.opacity||1});var h=new THREE.Mesh(f,e);h.scale.x=d;h.scale.y=d;h.scale.z=d;h.position.x=c.x;h.position.y=c.y;h.position.z=c.z;a.getScene().add(h);return h},drawLine:function(c,e,d,a){var f=this.colorStrToHex(a.color);var g=this.materialCache.get(THREE.LineBasicMaterial,c.getScene(),{color:this.colorStrToHex(a.color),opacity:a.opacity||1,linewidth:a.lineWidth||1});var b=new THREE.Geometry();b.vertices.push(new THREE.Vector3(e.x,e.y,e.z));b.vertices.push(new THREE.Vector3(d.x,d.y,d.z));line=new THREE.Line(b,g);c.getScene().add(line);return line},drawCylinder:function(b,g,f,d,m){var a=Kekule.CoordUtils;var i=this._modelParams.cylinderSegmentsRadius;var j=1;var k=a.getDistance(g,f);var h=this.geometryCache.get(THREE.CylinderGeometry,b.getScene(),1,1,1,i,j,true);var e=this.materialCache.get(THREE.MeshLambertMaterial,b.getScene(),{color:this.colorStrToHex(m.color),opacity:m.opacity||1});var l=new THREE.Mesh(h,e);l.scale.y=k;l.scale.x=d;l.scale.z=d;var c=Kekule.ObjUtils.isUnset(m.quaternion)?this._calcQuaternion(g,f):m.quaternion;if(c){if(l.applyQuaternion){l.applyQuaternion(c)}else{l.useQuaternion=true;l.quaternion=c;l.updateMatrix()}}l.position.x=(g.x+f.x)/2;l.position.y=(g.y+f.y)/2;l.position.z=(g.z+f.z)/2;b.getScene().add(l);return l},drawParallelCylinders:function(c,q,f){var b=Kekule.CoordUtils;var p=q[0];var n=this._calcQuaternion(p.coord1,p.coord2);var r=this.createGroup(c);for(var o=0,e=q.length;o<e;++o){var d=q[o];var m=this.drawCylinder(c,d.coord1,d.coord2,d.radius,{color:d.color,quaternion:n,opacity:d.opacity});this.addToGroup(m,r)}if(f){var a;for(var o=0,e=q.length;o<e;++o){var d=q[o];if(Kekule.ObjUtils.isUnset(d.jointCoordIndex)){a=[d.coord1,d.coord2]}else{a=(d.jointCoordIndex===1)?[d.coord2]:[d.coord1]}for(var h=0,g=a.length;h<g;++h){var m=this.drawSphere(c,a[h],d.radius,{color:d.color,opacity:d.opacity});this.addToGroup(m,r)}}}return r},removeDrawnElem:function(a,b){if(b.parent&&b.parent.remove){b.parent.remove(b)}},_calcQuaternion:function(i,g){var a=Kekule.CoordUtils;var j=a.substract(g,i);if(j.x||j.z){var c={x:j.z,y:0,z:-j.x};c=a.standardize(c);var e=Math.atan2(Math.sqrt(Math.sqr(j.x)+Math.sqr(j.z)),j.y);var h=e/2;var b=Math.cos(h);var d=Math.sin(h);var f=new THREE.Quaternion(d*c.x,d*c.y,d*c.z,b);return f}else{return null}},getLightCount:function(b){var a=b.getLights();return a?(a.length||0):0},getLightProps:function(c,b){var a=c.getLights()[b];return{position:a.position}},setLightProps:function(c,b,d){var a=c.getLights()[b];var e=d.position;if(e){a.position.x=e.x;a.position.y=e.y;a.position.z=e.z}a.updateMatrix()},getCameraProps:function(a){var b=a.getCamera();return{position:b.position,fov:b.fov*Math.PI/180,aspect:b.aspect,left:b.left,right:b.right,top:b.top,bottom:b.bottom,lookAtVector:b.lookAtVector,upVector:b.up}},setCameraProps:function(b,d){var g=b.getCamera();var e=Kekule.ObjUtils.notUnset;var f=d.position;if(f){g.position.x=f.x;g.position.y=f.y;g.position.z=f.z}if(e(d.near)){g.near=d.near}if(e(d.far)){g.near=d.far}if(d.fov){g.fov=d.fov*180/Math.PI}if(d.aspect){g.aspect=d.aspect}if(e(d.left)){g.left=d.left}if(e(d.top)){g.top=d.top}if(e(d.bottom)){g.bottom=d.bottom}if(e(d.right)){g.right=d.right}if(e(d.upVector)){var a=d.upVector;g.up=new THREE.Vector3(a.x,a.y,a.z)}if(e(d.lookAtVector)){var a=d.lookAtVector;g.lookAt(new THREE.Vector3(a.x,a.y,a.z))}g.updateMatrix()},exportToDataUri:function(d,b,c){var f=d.getRenderer();if(f instanceof THREE.SVGRenderer){var e=d.getRenderer().domElement;var a=XmlUtility.serializeNode(e);return"data:image/svg+xml;base64,"+btoa(a)}else{var e=d.getRenderer().domElement;return e?e.toDataURL(b,c):null}}});Kekule.Render.ThreeRendererBridge.isSupported=function(){var a=(typeof(Kekule.$jsRoot.THREE)!=="undefined");if(a){var b=Kekule.BrowserFeature;a=b.webgl||b.canvas||b.svg}return !!a};Kekule.Render.DrawBridge3DMananger.register(Kekule.Render.ThreeRendererBridge,20);(function(){Kekule.Render.ChemObjPainter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.ChemObjPainter",initialize:function($super,b,e,a,d){$super();var c=b||Kekule.Render.RendererType.R2D;this.setPropStoreFieldValue("renderType",c);this.setPropStoreFieldValue("chemObj",e);this.setPropStoreFieldValue("drawBridge",a||((c===Kekule.Render.RendererType.R3D)?Kekule.Render.DrawBridge3DMananger.getPreferredBridgeInstance():Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance()));if(d){this.setPropStoreFieldValue("renderConfigs",d)}},finalize:function($super){if(this.getRenderer()){this.getRenderer().finalize()}$super()},initProperties:function(){this.defineProp("renderType",{dataType:DataType.INT,serializable:false,setter:null});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,setter:null});this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("renderConfigs");if(!a){a=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()}return a}});this.defineProp("renderer",{dateType:"Kekule.Render.AbstractRenderer",serializable:false,setter:null});this.defineProp("canModifyTargetObj",{dataType:DataType.BOOL})},getDrawOptionFromConfigs:function(b){var a=Kekule.Render.RenderOptionUtils;return a.convertConfigsToPlainHash(b)},prepareRenderer:function(){if(this.getRenderer()){return this.getRenderer()}var b=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.get3DRendererClass:Kekule.Render.get2DRendererClass;var d=b(this.getChemObj());if(d){var a=new d(this.getChemObj(),this.getDrawBridge(),this);this.setPropStoreFieldValue("renderer",a);return a}else{Kekule.error(Kekule.$L("ErrorMsg.CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ"));return null}},createContext:function(d,e,c){var a=this.getDrawBridge();return a.createContext(d,e,c)},_convertContextBoxToScreen:function(a,c){if(!c){return{}}var e=this.getDrawBridge();var d=e.transformContextCoordToScreen(a,{x:c.x1,y:c.y1});var b=e.transformContextCoordToScreen(a,{x:c.x2,y:c.y2});return Kekule.BoxUtils.createBox(d,b)},estimateObjBox:function(c,b,a){var d=this._generateDrawOptions(b);this.prepareRenderer();return this.getRenderer().estimateObjBox(c,b,a)},estimateRenderBox:function(c,f,b,a){var d=this._generateDrawOptions(b);this.prepareRenderer();var e=this.getRenderer();return e.estimateRenderBox(c,f,d,a)},estimateScreenBox:function(c,e,b,a){var d=this.estimateRenderBox(c,e,b,a);return d?this._convertContextBoxToScreen(c,d):null},_generateDrawOptions:function(b){var c=this.getRenderConfigs();var a=c?this.getDrawOptionFromConfigs(c):{};a=Object.extend(a,b);return a},draw:function(c,f,b){this.prepareRenderer();var d=this._generateDrawOptions(b);var e=this.getRenderer();var a=e.draw(c,f,d);return a},redraw:function(a){return this.getRenderer().redraw(a)},getActualRenderTransformParams:function(a){var b=this.getRenderer();if(b){return b.getRenderFinalTransformParams(a)}else{return null}},getActualInitialRenderTransformOptions:function(a){var b=this.getRenderer();if(b){return b.getRenderInitialTransformOptions(a)}else{return null}},changeGeometryOptions:function(a,d,e){var c=this.getRenderer();if(c&&c.changeGeometryOptions){var b=this._generateDrawOptions(e);return c.changeGeometryOptions(a,d,b)}else{this.clearContext(a);return this.draw(a,d,e)}},supportGeometryOptionChange:function(){var a=this.getRenderer();return a&&a.changeGeometryOptions},beginUpdatePainter:function(){return this.getRenderer().beginUpdateRenderer()},endUpdatePainter:function(){return this.getRenderer().endUpdateRenderer()},update:function(c,a,b){return this.getRenderer().update(c,a,b)},addNew:function(b,a){return this.getRenderer().addNew(b,a)},modify:function(b,a){return this.getRenderer().modify(b,a)},remove:function(a,b){return this.getRenderer().remove(a,b)},clear:function(a){var b=this.getRenderer();if(b){b.clear(a)}return this},clearContext:function(a){return this.getDrawBridge().clearContext(a)}});Kekule.Render.ChemObjPainter2D=Class.create(Kekule.Render.ChemObjPainter,{CLASS_NAME:"Kekule.Render.ChemObjPainter2D",initialize:function($super,c,a,b){$super(Kekule.Render.RendererType.R2D,c,a,b)}});Kekule.Render.ChemObjPainter3D=Class.create(Kekule.Render.ChemObjPainter,{CLASS_NAME:"Kekule.Render.ChemObjPainter3D",initialize:function($super,c,a,b){$super(Kekule.Render.RendererType.R3D,c,a,b)}})})();!function(be,bd,bc,a7){function a6(e,d,f){return setTimeout(aY(e,f),d)}function a4(e,d,f){return Array.isArray(e)?(a3(e,f[d],f),!0):!1}function a3(f,d,h){var g;if(f){if(f.forEach){f.forEach(d,h)}else{if(f.length!==a7){for(g=0;g<f.length;){d.call(h,f[g],g,f),g++}}else{for(g in f){f.hasOwnProperty(g)&&d.call(h,f[g],g,f)}}}}}function a2(a,h,g){var f="DEPRECATED METHOD: "+h+"\n"+g+" AT \n";return function(){var i=new Error("get-stack-trace"),e=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",b=be.console&&(be.console.warn||be.console.log);return b&&b.call(be.console,f,e),a.apply(this,arguments)}}function aZ(g,f,j){var i,h=f.prototype;i=g.prototype=Object.create(h),i.constructor=g,i._super=h,j&&cj(i,j)}function aY(d,c){return function(){return d.apply(c,arguments)}}function aW(d,c){return typeof d==a8?d.apply(c?c[0]||a7:a7,c):d}function aV(d,c){return d===a7?c:d}function aU(e,d,f){a3(aO(d),function(a){e.addEventListener(a,f,!1)})}function aS(e,d,f){a3(aO(d),function(a){e.removeEventListener(a,f,!1)})}function aR(d,c){for(;d;){if(d==c){return !0}d=d.parentNode}return !1}function aP(d,c){return d.indexOf(c)>-1}function aO(b){return b.trim().split(/\s+/g)}function aN(f,e,h){if(f.indexOf&&!h){return f.indexOf(e)}for(var g=0;g<f.length;){if(h&&f[g][h]==e||!h&&f[g]===e){return g}g++}return -1}function aM(b){return Array.prototype.slice.call(b,0)}function aL(i,h,n){for(var m=[],l=[],k=0;k<i.length;){var j=h?i[k][h]:i[k];aN(l,j)<0&&m.push(i[k]),l[k]=j,k++}return n&&(m=h?m.sort(function(b,d){return b[h]>d[h]}):m.sort()),m}function aK(h,d){for(var l,k,j=d[0].toUpperCase()+d.slice(1),i=0;i<b4.length;){if(l=b4[i],k=l?l+j:d,k in h){return k}i++}return a7}function aJ(){return bg++}function aI(a){var d=a.ownerDocument||a;return d.defaultView||d.parentWindow||be}function aH(e,d){var f=this;this.manager=e,this.callback=d,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(a){aW(e.options.enable,[e])&&f.handler(a)},this.init()}function aF(e){var d,f=e.options.inputClass;return new (d=f?f:ac?bz:cc?bv:ap?bs:bA)(e,aE)}function aE(i,h,n){var m=n.pointers.length,l=n.changedPointers.length,k=h&ax&&m-l===0,j=h&(ck|b5)&&m-l===0;n.isFirst=!!k,n.isFinal=!!j,k&&(i.session={}),n.eventType=h,bT(i,n),i.emit("hammer.input",n),i.recognize(n),i.session.prevInput=n}function bT(v,u){var t=v.session,s=u.pointers,r=s.length;t.firstInput||(t.firstInput=bO(u)),r>1&&!t.firstMultiple?t.firstMultiple=bO(u):1===r&&(t.firstMultiple=!1);var q=t.firstInput,p=t.firstMultiple,o=p?p.center:q.center,n=u.center=bL(s);u.timeStamp=cm(),u.deltaTime=u.timeStamp-q.timeStamp,u.angle=bG(o,n),u.distance=bH(o,n),bR(t,u),u.offsetDirection=bI(u.deltaX,u.deltaY);var m=bK(u.deltaTime,u.deltaX,u.deltaY);u.overallVelocityX=m.x,u.overallVelocityY=m.y,u.overallVelocity=am(m.x)>am(m.y)?m.x:m.y,u.scale=p?bC(p.pointers,s):1,u.rotation=p?bD(p.pointers,s):0,u.maxPointers=t.prevInput?u.pointers.length>t.prevInput.maxPointers?u.pointers.length:t.prevInput.maxPointers:u.pointers.length,bQ(t,u);var l=v.element;aR(u.srcEvent.target,l)&&(l=u.srcEvent.target),u.target=l}function bR(h,g){var l=g.center,k=h.offsetDelta||{},j=h.prevDelta||{},i=h.prevInput||{};g.eventType!==ax&&i.eventType!==ck||(j=h.prevDelta={x:i.deltaX||0,y:i.deltaY||0},k=h.offsetDelta={x:l.x,y:l.y}),g.deltaX=j.x+(l.x-k.x),g.deltaY=j.y+(l.y-k.y)}function bQ(v,u){var t,s,r,q,p=v.lastInterval||u,o=u.timeStamp-p.timeStamp;if(u.eventType!=b5&&(o>a1||p.velocity===a7)){var n=u.deltaX-p.deltaX,m=u.deltaY-p.deltaY,d=bK(o,n,m);s=d.x,r=d.y,t=am(d.x)>am(d.y)?d.x:d.y,q=bI(n,m),v.lastInterval=u}else{t=p.velocity,s=p.velocityX,r=p.velocityY,q=p.direction}u.velocity=t,u.velocityX=s,u.velocityY=r,u.direction=q}function bO(e){for(var d=[],f=0;f<e.pointers.length;){d[f]={clientX:az(e.pointers[f].clientX),clientY:az(e.pointers[f].clientY)},f++}return{timeStamp:cm(),pointers:d,center:bL(d),deltaX:e.deltaX,deltaY:e.deltaY}}function bL(g){var f=g.length;if(1===f){return{x:az(g[0].clientX),y:az(g[0].clientY)}}for(var j=0,i=0,h=0;f>h;){j+=g[h].clientX,i+=g[h].clientY,h++}return{x:az(j/f),y:az(i/f)}}function bK(e,d,f){return{x:d/e||0,y:f/e||0}}function bI(d,c){return d===c?bN:am(d)>=am(c)?0>d?a9:aA:0>c?an:cn}function bH(g,f,j){j||(j=aD);var i=f[j[0]]-g[j[0]],h=f[j[1]]-g[j[1]];return Math.sqrt(i*i+h*h)}function bG(g,f,j){j||(j=aD);var i=f[j[0]]-g[j[0]],h=f[j[1]]-g[j[1]];return 180*Math.atan2(h,i)/Math.PI}function bD(d,c){return bG(c[1],c[0],aq)+bG(d[1],d[0],aq)}function bC(d,c){return bH(c[0],c[1],aq)/bH(d[0],d[1],aq)}function bA(){this.evEl=cd,this.evWin=bX,this.pressed=!1,aH.apply(this,arguments)}function bz(){this.evEl=ar,this.evWin=ae,aH.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function by(){this.evTarget=bP,this.evWin=af,this.started=!1,aH.apply(this,arguments)}function bx(f,e){var h=aM(f.touches),g=aM(f.changedTouches);return e&(ck|b5)&&(h=aL(h.concat(g),"identifier",!0)),[h,g]}function bv(){this.evTarget=bu,this.targetIds={},aH.apply(this,arguments)}function bt(r,q){var p=aM(r.touches),o=this.targetIds;if(q&(ax|ak)&&1===p.length){return o[p[0].identifier]=!0,[p,p]}var n,m,l=aM(r.changedTouches),k=[],j=this.target;if(m=p.filter(function(b){return aR(b.target,j)}),q===ax){for(n=0;n<m.length;){o[m[n].identifier]=!0,n++}}for(n=0;n<l.length;){o[l[n].identifier]&&k.push(l[n]),q&(ck|b5)&&delete o[l[n].identifier],n++}return k.length?[aL(m.concat(k),"identifier",!0),k]:void 0}function bs(){aH.apply(this,arguments);var b=aY(this.handler,this);this.touch=new bv(this.manager,b),this.mouse=new bA(this.manager,b),this.primaryTouch=null,this.lastTouches=[]}function br(d,c){d&ax?(this.primaryTouch=c.changedPointers[0].identifier,bq.call(this,c)):d&(ck|b5)&&bq.call(this,c)}function bq(g){var f=g.changedPointers[0];if(f.identifier===this.primaryTouch){var j={x:f.clientX,y:f.clientY};this.lastTouches.push(j);var i=this.lastTouches,h=function(){var b=i.indexOf(j);b>-1&&i.splice(b,1)};setTimeout(h,aQ)}}function bp(i){for(var h=i.srcEvent.clientX,n=i.srcEvent.clientY,m=0;m<this.lastTouches.length;m++){var l=this.lastTouches[m],k=Math.abs(h-l.x),j=Math.abs(n-l.y);if(at>=k&&at>=j){return !0}}return !1}function bo(d,c){this.manager=d,this.set(c)}function bn(e){if(aP(e,av)){return av}var d=aP(e,ai),f=aP(e,ci);return d&&f?av:d||f?d?ai:ci:aP(e,aX)?aX:bB}function bm(){if(!cf){return !1}var a={},d=be.CSS&&be.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(b){a[b]=d?be.CSS.supports("touch-action",b):!0}),a}function bl(b){this.options=cj({},this.defaults,b||{}),this.id=aJ(),this.manager=null,this.options.enable=aV(this.options.enable,!0),this.state=bJ,this.simultaneous={},this.requireFail=[]}function bj(b){return b&b7?"cancel":b&al?"end":b&ay?"move":b&a5?"start":""}function b6(b){return b==cn?"down":b==an?"up":b==a9?"left":b==aA?"right":""}function bh(e,d){var f=d.manager;return f?f.get(e):e}function bZ(){bl.apply(this,arguments)}function bw(){bZ.apply(this,arguments),this.pX=null,this.pY=null}function aT(){bZ.apply(this,arguments)}function au(){bl.apply(this,arguments),this._timer=null,this._input=null}function ah(){bZ.apply(this,arguments)}function cg(){bZ.apply(this,arguments)}function b1(){bl.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function bE(d,c){return c=c||{},c.recognizers=aV(c.recognizers,bE.defaults.preset),new a0(d,c)}function a0(d,c){this.options=cj({},bE.defaults,c||{}),this.options.inputTarget=this.options.inputTarget||d,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=d,this.input=aF(this),this.touchAction=new bo(this,this.options.touchAction),aw(this,!0),a3(this.options.recognizers,function(f){var e=this.add(new f[0](f[1]));f[2]&&e.recognizeWith(f[2]),f[3]&&e.requireFailure(f[3])},this)}function aw(f,e){var h=f.element;if(h.style){var g;a3(f.options.cssProps,function(b,a){g=aK(h.style,a),e?(f.oldCssProps[g]=h.style[g],h.style[g]=b):h.style[g]=f.oldCssProps[g]||""}),e||(f.oldCssProps={})}}function aj(b,f){var e=bd.createEvent("Event");e.initEvent(b,!0,!0),e.gesture=f,f.target.dispatchEvent(e)}var cj,b4=["","webkit","Moz","MS","ms","o"],bM=bd.createElement("div"),a8="function",az=Math.round,am=Math.abs,cm=Date.now;cj="function"!=typeof Object.assign?function(g){if(g===a7||null===g){throw new TypeError("Cannot convert undefined or null to object")}for(var d=Object(g),j=1;j<arguments.length;j++){var i=arguments[j];if(i!==a7&&null!==i){for(var h in i){i.hasOwnProperty(h)&&(d[h]=i[h])}}}return d}:Object.assign;var b8=a2(function(g,d,j){for(var i=Object.keys(d),h=0;h<i.length;){(!j||j&&g[i[h]]===a7)&&(g[i[h]]=d[i[h]]),h++}return g},"extend","Use `assign`."),bU=a2(function(d,c){return b8(d,c,!0)},"merge","Use `assign`."),bg=1,aC=/mobile|tablet|ip(ad|hone|od)|android/i,ap="ontouchstart" in be,ac=aK(be,"PointerEvent")!==a7,cc=ap&&aC.test(navigator.userAgent),bW="touch",ch="pen",b2="mouse",bF="kinect",a1=25,ax=1,ak=2,ck=4,b5=8,bN=1,a9=2,aA=4,an=8,cn=16,b9=a9|aA,bV=an|cn,bi=b9|bV,aD=["x","y"],aq=["clientX","clientY"];aH.prototype={handler:function(){},init:function(){this.evEl&&aU(this.element,this.evEl,this.domHandler),this.evTarget&&aU(this.target,this.evTarget,this.domHandler),this.evWin&&aU(aI(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&aS(this.element,this.evEl,this.domHandler),this.evTarget&&aS(this.target,this.evTarget,this.domHandler),this.evWin&&aS(aI(this.element),this.evWin,this.domHandler)}};var ad={mousedown:ax,mousemove:ak,mouseup:ck},cd="mousedown",bX="mousemove mouseup";aZ(bA,aH,{handler:function(d){var c=ad[d.type];c&ax&&0===d.button&&(this.pressed=!0),c&ak&&1!==d.which&&(c=ck),this.pressed&&(c&ck&&(this.pressed=!1),this.callback(this.manager,c,{pointers:[d],changedPointers:[d],pointerType:b2,srcEvent:d}))}});var bk={pointerdown:ax,pointermove:ak,pointerup:ck,pointercancel:b5,pointerout:b5},aG={2:bW,3:ch,4:b2,5:bF},ar="pointerdown",ae="pointermove pointerup pointercancel";be.MSPointerEvent&&!be.PointerEvent&&(ar="MSPointerDown",ae="MSPointerMove MSPointerUp MSPointerCancel"),aZ(bz,aH,{handler:function(j){var i=this.store,p=!1,o=j.type.toLowerCase().replace("ms",""),n=bk[o],m=aG[j.pointerType]||j.pointerType,l=m==bW,k=aN(i,j.pointerId,"pointerId");n&ax&&(0===j.button||l)?0>k&&(i.push(j),k=i.length-1):n&(ck|b5)&&(p=!0),0>k||(i[k]=j,this.callback(this.manager,n,{pointers:i,changedPointers:[j],pointerType:m,srcEvent:j}),p&&i.splice(k,1))}});var ce={touchstart:ax,touchmove:ak,touchend:ck,touchcancel:b5},bP="touchstart",af="touchstart touchmove touchend touchcancel";aZ(by,aH,{handler:function(e){var d=ce[e.type];if(d===ax&&(this.started=!0),this.started){var f=bx.call(this,e,d);d&(ck|b5)&&f[0].length-f[1].length===0&&(this.started=!1),this.callback(this.manager,d,{pointers:f[0],changedPointers:f[1],pointerType:bW,srcEvent:e})}}});var bY={touchstart:ax,touchmove:ak,touchend:ck,touchcancel:b5},bu="touchstart touchmove touchend touchcancel";aZ(bv,aH,{handler:function(e){var d=bY[e.type],f=bt.call(this,e,d);f&&this.callback(this.manager,d,{pointers:f[0],changedPointers:f[1],pointerType:bW,srcEvent:e})}});var aQ=2500,at=25;aZ(bs,aH,{handler:function(g,f,j){var i=j.pointerType==bW,h=j.pointerType==b2;if(!(h&&j.sourceCapabilities&&j.sourceCapabilities.firesTouchEvents)){if(i){br.call(this,f,j)}else{if(h&&bp.call(this,j)){return}}this.callback(g,f,j)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ag=aK(bM.style,"touchAction"),cf=ag!==a7,b0="compute",bB="auto",aX="manipulation",av="none",ai="pan-x",ci="pan-y",b3=bm();bo.prototype={set:function(b){b==b0&&(b=this.compute()),cf&&this.manager.element.style&&b3[b]&&(this.manager.element.style[ag]=b),this.actions=b.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var b=[];return a3(this.manager.recognizers,function(a){aW(a.options.enable,[a])&&(b=b.concat(a.getTouchAction()))}),bn(b.join(" "))},preventDefaults:function(t){var s=t.srcEvent,r=t.offsetDirection;if(this.manager.session.prevented){return void s.preventDefault()}var q=this.actions,p=aP(q,av)&&!b3[av],o=aP(q,ci)&&!b3[ci],n=aP(q,ai)&&!b3[ai];if(p){var m=1===t.pointers.length,l=t.distance<2,k=t.deltaTime<250;if(m&&l&&k){return}}return n&&o?void 0:p||o&&r&b9||n&&r&bV?this.preventSrc(s):void 0},preventSrc:function(b){this.manager.session.prevented=!0,b.preventDefault()}};var bJ=1,a5=2,ay=4,al=8,cl=al,b7=16,bS=32;bl.prototype={defaults:{},set:function(b){return cj(this.options,b),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(d){if(a4(d,"recognizeWith",this)){return this}var c=this.simultaneous;return d=bh(d,this),c[d.id]||(c[d.id]=d,d.recognizeWith(this)),this},dropRecognizeWith:function(b){return a4(b,"dropRecognizeWith",this)?this:(b=bh(b,this),delete this.simultaneous[b.id],this)},requireFailure:function(d){if(a4(d,"requireFailure",this)){return this}var c=this.requireFail;return d=bh(d,this),-1===aN(c,d)&&(c.push(d),d.requireFailure(this)),this},dropRequireFailure:function(d){if(a4(d,"dropRequireFailure",this)){return this}d=bh(d,this);var c=aN(this.requireFail,d);return c>-1&&this.requireFail.splice(c,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(b){return !!this.simultaneous[b.id]},emit:function(f){function e(a){h.manager.emit(a,f)}var h=this,g=this.state;al>g&&e(h.options.event+bj(g)),e(h.options.event),f.additionalEvent&&e(f.additionalEvent),g>=al&&e(h.options.event+bj(g))},tryEmit:function(b){return this.canEmit()?this.emit(b):void (this.state=bS)},canEmit:function(){for(var b=0;b<this.requireFail.length;){if(!(this.requireFail[b].state&(bS|bJ))){return !1}b++}return !0},recognize:function(d){var c=cj({},d);return aW(this.options.enable,[this,c])?(this.state&(cl|b7|bS)&&(this.state=bJ),this.state=this.process(c),void (this.state&(a5|ay|al|b7)&&this.tryEmit(c))):(this.reset(),void (this.state=bS))},process:function(b){},getTouchAction:function(){},reset:function(){}},aZ(bZ,bl,{defaults:{pointers:1},attrTest:function(d){var c=this.options.pointers;return 0===c||d.pointers.length===c},process:function(g){var f=this.state,j=g.eventType,i=f&(a5|ay),h=this.attrTest(g);return i&&(j&b5||!h)?f|b7:i||h?j&ck?f|al:f&a5?f|ay:a5:bS}}),aZ(bw,bZ,{defaults:{event:"pan",threshold:10,pointers:1,direction:bi},getTouchAction:function(){var d=this.options.direction,c=[];return d&b9&&c.push(ci),d&bV&&c.push(ai),c},directionTest:function(i){var h=this.options,n=!0,m=i.distance,l=i.direction,k=i.deltaX,j=i.deltaY;return l&h.direction||(h.direction&b9?(l=0===k?bN:0>k?a9:aA,n=k!=this.pX,m=Math.abs(i.deltaX)):(l=0===j?bN:0>j?an:cn,n=j!=this.pY,m=Math.abs(i.deltaY))),i.direction=l,n&&m>h.threshold&&l&h.direction},attrTest:function(b){return bZ.prototype.attrTest.call(this,b)&&(this.state&a5||!(this.state&a5)&&this.directionTest(b))},emit:function(d){this.pX=d.deltaX,this.pY=d.deltaY;var c=b6(d.direction);c&&(d.additionalEvent=this.options.event+c),this._super.emit.call(this,d)}}),aZ(aT,bZ,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[av]},attrTest:function(b){return this._super.attrTest.call(this,b)&&(Math.abs(b.scale-1)>this.options.threshold||this.state&a5)},emit:function(d){if(1!==d.scale){var c=d.scale<1?"in":"out";d.additionalEvent=this.options.event+c}this._super.emit.call(this,d)}}),aZ(au,bl,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[bB]},process:function(g){var e=this.options,j=g.pointers.length===e.pointers,i=g.distance<e.threshold,h=g.deltaTime>e.time;if(this._input=g,!i||!j||g.eventType&(ck|b5)&&!h){this.reset()}else{if(g.eventType&ax){this.reset(),this._timer=a6(function(){this.state=cl,this.tryEmit()},e.time,this)}else{if(g.eventType&ck){return cl}}}return bS},reset:function(){clearTimeout(this._timer)},emit:function(b){this.state===cl&&(b&&b.eventType&ck?this.manager.emit(this.options.event+"up",b):(this._input.timeStamp=cm(),this.manager.emit(this.options.event,this._input)))}}),aZ(ah,bZ,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[av]},attrTest:function(b){return this._super.attrTest.call(this,b)&&(Math.abs(b.rotation)>this.options.threshold||this.state&a5)}}),aZ(cg,bZ,{defaults:{event:"swipe",threshold:10,velocity:0.3,direction:b9|bV,pointers:1},getTouchAction:function(){return bw.prototype.getTouchAction.call(this)},attrTest:function(e){var d,f=this.options.direction;return f&(b9|bV)?d=e.overallVelocity:f&b9?d=e.overallVelocityX:f&bV&&(d=e.overallVelocityY),this._super.attrTest.call(this,e)&&f&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&am(d)>this.options.velocity&&e.eventType&ck},emit:function(d){var c=b6(d.offsetDirection);c&&this.manager.emit(this.options.event+c,d),this.manager.emit(this.options.event,d)}}),aZ(b1,bl,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[aX]},process:function(j){var e=this.options,p=j.pointers.length===e.pointers,o=j.distance<e.threshold,n=j.deltaTime<e.time;if(this.reset(),j.eventType&ax&&0===this.count){return this.failTimeout()}if(o&&n&&p){if(j.eventType!=ck){return this.failTimeout()}var m=this.pTime?j.timeStamp-this.pTime<e.interval:!0,l=!this.pCenter||bH(this.pCenter,j.center)<e.posThreshold;this.pTime=j.timeStamp,this.pCenter=j.center,l&&m?this.count+=1:this.count=1,this._input=j;var k=this.count%e.taps;if(0===k){return this.hasRequireFailures()?(this._timer=a6(function(){this.state=cl,this.tryEmit()},e.interval,this),a5):cl}}return bS},failTimeout:function(){return this._timer=a6(function(){this.state=bS},this.options.interval,this),bS},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==cl&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),bE.VERSION="2.0.8",bE.defaults={domEvents:!1,touchAction:b0,enable:!0,inputTarget:null,inputClass:null,preset:[[ah,{enable:!1}],[aT,{enable:!1},["rotate"]],[cg,{direction:b9}],[bw,{direction:b9},["swipe"]],[b1],[b1,{event:"doubletap",taps:2},["tap"]],[au]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var bf=1,aB=2;a0.prototype={set:function(b){return cj(this.options,b),b.touchAction&&this.touchAction.update(),b.inputTarget&&(this.input.destroy(),this.input.target=b.inputTarget,this.input.init()),this},stop:function(b){this.session.stopped=b?aB:bf},recognize:function(h){var g=this.session;if(!g.stopped){this.touchAction.preventDefaults(h);var l,k=this.recognizers,j=g.curRecognizer;(!j||j&&j.state&cl)&&(j=g.curRecognizer=null);for(var i=0;i<k.length;){l=k[i],g.stopped===aB||j&&l!=j&&!l.canRecognizeWith(j)?l.reset():l.recognize(h),!j&&l.state&(a5|ay|al)&&(j=g.curRecognizer=l),i++}}},get:function(e){if(e instanceof bl){return e}for(var d=this.recognizers,f=0;f<d.length;f++){if(d[f].options.event==e){return d[f]}}return null},add:function(d){if(a4(d,"add",this)){return this}var c=this.get(d.options.event);return c&&this.remove(c),this.recognizers.push(d),d.manager=this,this.touchAction.update(),d},remove:function(e){if(a4(e,"remove",this)){return this}if(e=this.get(e)){var d=this.recognizers,f=aN(d,e);-1!==f&&(d.splice(f,1),this.touchAction.update())}return this},on:function(e,d){if(e!==a7&&d!==a7){var f=this.handlers;return a3(aO(e),function(b){f[b]=f[b]||[],f[b].push(d)}),this}},off:function(e,d){if(e!==a7){var f=this.handlers;return a3(aO(e),function(b){d?f[b]&&f[b].splice(aN(f[b],d),1):delete f[b]}),this}},emit:function(f,e){this.options.domEvents&&aj(f,e);var h=this.handlers[f]&&this.handlers[f].slice();if(h&&h.length){e.type=f,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var g=0;g<h.length;){h[g](e),g++}}},destroy:function(){this.element&&aw(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},cj(bE,{INPUT_START:ax,INPUT_MOVE:ak,INPUT_END:ck,INPUT_CANCEL:b5,STATE_POSSIBLE:bJ,STATE_BEGAN:a5,STATE_CHANGED:ay,STATE_ENDED:al,STATE_RECOGNIZED:cl,STATE_CANCELLED:b7,STATE_FAILED:bS,DIRECTION_NONE:bN,DIRECTION_LEFT:a9,DIRECTION_RIGHT:aA,DIRECTION_UP:an,DIRECTION_DOWN:cn,DIRECTION_HORIZONTAL:b9,DIRECTION_VERTICAL:bV,DIRECTION_ALL:bi,Manager:a0,Input:aH,TouchAction:bo,TouchInput:bv,MouseInput:bA,PointerEventInput:bz,TouchMouseInput:bs,SingleTouchInput:by,Recognizer:bl,AttrRecognizer:bZ,Tap:b1,Pan:bw,Swipe:cg,Pinch:aT,Rotate:ah,Press:au,on:aU,off:aS,each:a3,merge:bU,extend:b8,assign:cj,inherit:aZ,bindFn:aY,prefixed:aK});var ao="undefined"!=typeof be?be:"undefined"!=typeof self?self:{};ao.Hammer=bE,"function"==typeof define&&define.amd?define(function(){return bE}):"undefined"!=typeof module&&module.exports?module.exports=bE:be[bc]=bE}(window,document,"Hammer");Kekule.Operation=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Operation",initialize:function($super){$super()},initProperties:function(){},isReversible:function(){return true},execute:function(){var a=this.doExecute();return a},doExecute:function(){},reverse:function(){if(!this.isReversible()){Kekule.raise(Kekule.$L("ErrorMsg.COMMAND_NOT_REVERSIBLE"))}var a=this.doReverse();return a},doReverse:function(){}});Kekule.Operation.State={UNEXECUTED:0,EXECUTED:1};Kekule.MacroOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.MacroOperation",initialize:function($super,a){$super();this.setChildren(a||[])},initProperties:function(){this.defineProp("children",{dataType:DataType.ARRAY})},isReversible:function(){var c=this.getChildren();for(var b=0,a=c.length;b<a;++b){if(!c[b].isReversible()){return false}}return true},doExecute:function(){var c=this.getChildren();for(var b=0,a=c.length;b<a;++b){c[b].execute()}},doReverse:function(){var b=this.getChildren();for(var a=b.length-1;a>=0;--a){b[a].reverse()}},add:function(a){return this.getChildren().push(a)},remove:function(c){var b=this.getChildren();var a=b.indexOf(c);if(a>=0){return b.splice(a,1)}else{return null}},getChildAt:function(a){return this.getChildren()[a]},getChildCount:function(){return this.getChildren().length}});Kekule.OperationHistory=Class.create(ObjectEx,{CLASS_NAME:"Kekule.OperationHistory",initialize:function($super,a){$super();this.setCapacity(a||null)},initProperties:function(){this.defineProp("capacity",{dataType:DataType.INT});this.defineProp("operations",{dataType:DataType.ARRAY,getter:function(){var a=this.getPropStoreFieldValue("operations");if(!a){a=[];this.setPropStoreFieldValue("operations",a)}return a}});this.defineProp("currIndex",{dataType:DataType.INT,serializable:false});this.defineEvent("push");this.defineEvent("pop");this.defineEvent("undo");this.defineEvent("redo")},checkCapacity:function(){var d=this.getCapacity();if((!d)||(d<=0)){return}var b=this.getPropStoreFieldValue("operations");while(b&&(b.length>d)){b.shift();if(this.getCurrIndex()>0){this.setCurrIndex(this.getCurrIndex()-1)}}},getOperationCount:function(){return this.getOperations().length},getOperationAt:function(a){return this.getOperations()[a]},getCurrOperation:function(){var a=this.getCurrIndex();if(a>=0){return this.getOperations()[a]}else{return null}},clear:function(){this.setOperations([]);this.setCurrIndex(-1);this.invokeEvent("clear",{currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange")},push:function(c){var b=this.getOperations();var d=this.getCurrIndex();if(d<b.length){b.splice(d+1,b.length-d-1)}b.push(c);this.setCurrIndex(b.length-1);this.checkCapacity();this.invokeEvent("push",{operation:c,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange")},pop:function(){var a;var b=this.getCurrIndex();if(this.canPop()){a=this.getOperations()[b];this.setCurrIndex(--b);this.invokeEvent("pop",{operation:a,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange")}else{a=null}return a},canPop:function(){var a=this.getCurrIndex();return((a>=0)&&(!!this.getOperations().length))},unpop:function(){var b;var d=this.getCurrIndex();var c=this.getOperations();if(this.canUnpop()){this.setCurrIndex(++d);b=this.getOperations()[d]}else{b=null}return b},canUnpop:function(){var a=this.getCurrIndex();return(a<this.getOperations().length-1)},undo:function(){var a=this.pop();if(a&&a.isReversible()){a.reverse()}this.invokeEvent("undo",{operation:a,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange");return a},undoAll:function(){while(this.canUndo){this.undo()}},canUndo:function(){return this.canPop()},redo:function(){var a=this.unpop();if(a){a.execute()}this.invokeEvent("redo",{operation:a,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange");return a},canRedo:function(){return this.canUnpop()}});(function(){Kekule.Action=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Action",HTML_CLASSNAME:null,initialize:function($super){$super();this.setPropStoreFieldValue("linkedWidgets",[]);this.setPropStoreFieldValue("enabled",true);this.setPropStoreFieldValue("visible",true);this.setPropStoreFieldValue("displayed",true);this.setPropStoreFieldValue("htmlClassName",this.getInitialHtmlClassName());this.setBubbleEvent(true);this.reactWidgetExecuteBind=this.reactWidgetExecute.bind(this)},finalize:function($super){var b=this.getOwner();if(b&&b.actionRemoved){b.actionRemoved(this)}this.unlinkAllWidgets();this.setPropStoreFieldValue("linkedWidgets",[]);$super()},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getEnabled()){this.setPropStoreFieldValue("enabled",b);this.updateAllWidgetsProp("enabled",b)}}});this.defineProp("visible",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getVisible()){this.setPropStoreFieldValue("visible",b);this.updateAllWidgetsProp("visible",b)}}});this.defineProp("displayed",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getDisplayed()){this.setPropStoreFieldValue("displayed",b);this.updateAllWidgetsProp("displayed",b)}}});this.defineProp("checked",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getChecked()){this.setPropStoreFieldValue("checked",b);this.updateAllWidgetsProp("checked",b);this.checkedChanged()}}});this.defineProp("checkGroup",{dataType:DataType.STRING});this.defineProp("hint",{dataType:DataType.STRING,setter:function(b){if(b&&(b!==this.getHint())){this.setPropStoreFieldValue("hint",b);this.updateAllWidgetsProp("hint",b)}}});this.defineProp("text",{dataType:DataType.STRING,setter:function(b){if(b&&(b!==this.getText())){this.setPropStoreFieldValue("text",b);this.updateAllWidgetsProp("text",b)}}});this.defineProp("htmlClassName",{dataType:DataType.STRING,setter:function(c){var b=this.getHtmlClassName();this.setPropStoreFieldValue("htmlClassName",c);this.updateAllWidgetClassName(c,b)}});this.defineProp("owner",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("linkedWidgets",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("invoker",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},getHigherLevelObj:function(){return this.getOwner()},invokeEvent:function($super,b,c){if(!c){c={}}if(!c.invoker){c.invoker=this.getInvoker()}$super(b,c)},getInitialHtmlClassName:function(){return this.HTML_CLASSNAME||null},getActionList:function(){var b=this.getOwner();return(b instanceof Kekule.ActionList)?b:null},checkedChanged:function(){var b=this.getActionList();if(b){b.actionCheckedChanged(this)}},linkWidget:function(c){var b=this.getLinkedWidgets();if(b.indexOf(c)<0){var e=this.getText();if(e){this.updateWidgetProp(c,"text",e)}var d=this.getHint();if(d){this.updateWidgetProp(c,"hint",d)}this.updateWidgetProp(c,"enabled",this.getEnabled());this.updateWidgetProp(c,"displayed",this.getDisplayed());this.updateWidgetProp(c,"visible",this.getVisible());this.updateWidgetProp(c,"checked",this.getChecked());this.updateWidgetClassName(c,this.getHtmlClassName(),null);c.addEventListener("execute",this.reactWidgetExecuteBind);b.push(c);return this}},unlinkWidget:function(d){var c=this.getLinkedWidgets();var b=c.indexOf(d);if(b>=0){this.updateWidgetClassName(d,null,this.getHtmlClassName());d.removeEventListener("execute",this.reactWidgetExecuteBind);c.splice(b,1)}},unlinkAllWidgets:function(){var c=this.getLinkedWidgets();for(var b=c.length-1;b>=0;--b){this.unlinkWidget(c[b])}},reactWidgetExecute:function(b){return this.execute(b.target,b.htmlEvent)},execute:function(d,b){var c=this.getChecked();if(!this.getCheckGroup()||!c){this.doExecute(d,b);if(this.getCheckGroup()){this.setChecked(true)}}this.setPropStoreFieldValue("invoker",d);this.invokeEvent("execute",{htmlEvent:b});return this},doExecute:function(c,b){},update:function(){this.doUpdate();return this},doUpdate:function(){},updateAllWidgetsProp:function(f,g){var e=this.getLinkedWidgets();for(var d=0,c=e.length;d<c;++d){var b=e[d];this.updateWidgetProp(b,f,g)}},updateWidgetProp:function(c,b,d){if(c.hasProperty(b)){c.setPropValue(b,d)}},updateWidgetClassName:function(c,d,b){if(b){c.removeClassName(b,true)}if(d){c.addClassName(d,true)}},updateAllWidgetClassName:function(g,b){var f=this.getLinkedWidgets();for(var e=0,d=f.length;e<d;++e){var c=f[e];this.updateWidgetClassName(c,g,b)}}});Kekule.ActionList=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ActionList",initialize:function($super){$super();this.setPropStoreFieldValue("actions",[]);this.setPropStoreFieldValue("ownActions",true);this.setPropStoreFieldValue("autoUpdate",true);this.reactActionExecutedBind=this.reactActionExecuted.bind(this);this.addEventListener("execute",this.reactActionExecutedBind)},finalize:function($super){this.removeEventListener("execute",this.reactActionExecutedBind);this.clear();this.setPropStoreFieldValue("actions",null);$super()},initProperties:function(){this.defineProp("actions",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("ownActions",{dataType:DataType.BOOL});this.defineProp("autoUpdate",{dataType:DataType.BOOL,setter:function(b){this.setPropStoreFieldValue("autoUpdate",b);if(b){this.updateAll()}}})},hasActionChecked:function(b){return !!this.getCheckedAction(b)},getCheckedAction:function(e){var f=this.getActions();for(var d=0,c=f.length;d<c;++d){var b=f[d];if((b.getCheckGroup()===e)&&(b.getChecked())){return b}}return null},actionAdded:function(c){if(this.getOwnActions()){var b=c.getOwner();if(b&&b.actionRemoved){b.actionRemoved(c)}c.setPropStoreFieldValue("owner",this)}Kekule.ArrayUtils.pushUnique(this.getActions(),c);c.update()},actionRemoved:function(b){Kekule.ArrayUtils.remove(this.getActions(),b);b.setPropStoreFieldValue("owner",null)},actionCheckedChanged:function(e){if(e&&e.getChecked()){var f=e.getCheckGroup();if(f){var g=this.getActions();for(var d=0,c=g.length;d<c;++d){var b=g[d];if((b!==e)&&(b.getCheckGroup()===f)&&(b.getChecked())){b.setChecked(false)}}}}},reactActionExecuted:function(b){if(b.target instanceof Kekule.Action){this.invokeEvent("execute",{action:b.target});if(this.getAutoUpdate()){this.updateAll()}}},getActionCount:function(){return this.getActions().length},getActionLength:function(){return this.getActions().length},getActionAt:function(b){return this.getActions()[b]},indexOfAction:function(b){return this.getActions().indexOf(b)},setActionIndex:function(c,b){var d=this.getActions();if(d){var e=d.indexOf(c);if(e>=0&&e!==b){d.splice(e,1);d.splice(b,0,c)}}return this},hasAction:function(b){return this.indexOfAction(b)>=0},add:function(b){this.actionAdded(b);return this},remove:function(b){this.actionRemoved(b);if(this.getOwnActions()){b.finalize()}return this},removeAt:function(b){var d=this.getActions();var c=d[b];if(c){Kekule.ArrayUtils.removeAt(d,b);this.actionRemoved(c)}return this},clear:function(){var c=this.getActions();for(var b=c.length-1;b>=0;--b){this.actionRemoved(c[b])}this.setPropStoreFieldValue("actions",[]);return this},updateAll:function(){var d=this.getActions();for(var c=0,b=d.length;c<b;++c){d[c].update()}return this}});Kekule.ActionFileOpen=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileOpen",initialize:function($super){$super()},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function($super){$super();this.setEnabled(this.getEnabled()&&Kekule.NativeServices.showFilePickerDialog)},doExecute:function(f){var d=f.getElement();var e=d.ownerDocument;var c=this;var b=this.getInvoker();this.openFilePicker(e,function(g,i,h){if(g){c.fileOpened(h,b)}})},openFilePicker:function(b,c){return Kekule.NativeServices.showFilePickerDialog(b,c,{mode:"open",filters:this.getFilters()})},fileOpened:function(c,b){this.doFileOpened(c,b);this.invokeEvent("open",{files:c,file:c[0]})},doFileOpened:function(c,b){}});Kekule.ActionLoadFileData=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionLoadFileData",initialize:function($super){$super()},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function($super){$super();this.setEnabled(this.getEnabled()&&Kekule.NativeServices.canLoadFileData())},doExecute:function(f){var d=f.getElement();var e=d.ownerDocument;var c=this;var b=this.getInvoker();this.loadFileData(e,function(g,h,i){c.dataLoaded(h,i,!!g,b)})},loadFileData:function(b,c){return Kekule.NativeServices.loadFileData(b,c,{filters:this.getFilters()})},reactFileLoad:function(b,c,d){this.dataLoaded(c,d,!!b)},dataLoaded:function(d,e,c,b){this.doDataLoaded(d,e,c,b);this.invokeEvent("load",{fileName:e,data:d,success:c})},doDataLoaded:function(d,e,c,b){}});Kekule.ActionFileSave=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileSave",initialize:function($super,b,c){$super();if(b){this.setData(b)}if(c){this.setFileName(c)}},initProperties:function(){this.defineProp("data",{dataType:DataType.STRING,serializable:false});this.defineProp("fileName",{dataType:DataType.STRING,serializable:false});this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function($super){$super();this.setEnabled(this.getEnabled()&&Kekule.NativeServices.canSaveFileData())},doExecute:function(d){var c;if(!d){c=document}else{var b=d.getElement();c=b.ownerDocument}Kekule.NativeServices.saveFileData(c,this.getData(),null,{initialFileName:this.getFileName(),filters:this.getFilters()})}});Kekule.ActionManager={_namedActionMap:null,_getNamedActionMap:function(c){var b=a._namedActionMap;if(!b&&c){b=new Kekule.MapEx();a._namedActionMap=b}return b},getRegisteredActionsOfClass:function(d,e){var c=a._getNamedActionMap(e);if(c){var b=c.get(d);if(!b&&e){b={};c.set(d,b)}return b}else{return null}},registerNamedActionClass:function(b,d,c){var e=a.getRegisteredActionsOfClass(c,true);e[b]=d},unregisterNamedActionClass:function(b,c){var d=a.getRegisteredActionsOfClass(c,false);if(d&&d[b]){delete d[b]}},getActionClassOfName:function(d,c,f){var h=ClassEx.isClass(c)?c:(c.getClass&&c.getClass());if(!h){return null}var g=a.getRegisteredActionsOfClass(h,false);var b=g&&g[d];if(!b&&f){var e=ClassEx.getSuperClass(h);b=e?a.getActionClassOfName(d,e,f):null}return b}};var a=Kekule.ActionManager})();(function(){Kekule.DataBingItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DataBingItem",initialize:function($super,c,a,d,b){$super();this.setSource(c);this.setSourceName(a);this.setTarget(d);this.setTargetName(b)},initProperties:function(){this.defineProp("source",{dataType:DataType.OBJECTEX,serializable:false});this.defineProp("sourceName",{dataType:DataType.STRING,serializable:false});this.defineProp("target",{dataType:DataType.OBJECTEX,serializable:false});this.defineProp("targetName",{dataType:DataType.STRING,serializable:false})},updateData:function(a){var f=this.getSource();var e=this.getTarget();var c=this.getSourceName();var b=this.getTargetName();if(f&&e&&c&&b){if(a){var d=e.getDataByBindingName(b);f.setDataByBindingName(c,d)}else{var d=f.getDataByBindingName(sourceName);e.setDataByBindingName(b,d)}}}});ClassEx.extend(ObjectEx,{getDataByBindingName:function(a){if(this.hasProperty(a)){return this.getPropValue(a)}else{if(DataType.isFunctionValue(this[a])){return this[a]()}}},setDataByBindingName:function(c,d){var b=d;var a=this.getPropInfo(c);if(a){var e=a.dataType;var f=DataType.getType(d);if((e!==f)&&(f===DataType.STRING)){b=DataType.StringUtils.deserializeValue(d)}}this.setPropValue(c,b);return this},createDataBinding:function(d,c,b){var a=new Kekule.DataBingItem(d,c,this,b);this.getDataBindings(true).push(a);return a},removeDataBinding:function(a){Kekule.ArrayUtils.remove(this.getDataBindings(),a)},updateBindingData:function(c){var b=this.getDataBindings();if(b&&b.length){for(var d=0,a=b.length;d<a;++d){b[d].updateData(c)}}}});ClassEx.defineProp(ObjectEx,"dataBindings",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,getter:function(b){var a=this.getPropStoreFieldValue("dataBindings");if(!a&&b){a=[];this.setPropStoreFieldValue("dataBindings",a)}return a}})})();(function(){var a=Kekule.ArrayUtils;var e=Kekule.HtmlElementUtils;Kekule.Widget={DEF_EVENT_HANDLER_PREFIX:"react_",getEventHandleFuncName:function(f){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+f},getTouchGestureHandleFuncName:function(f){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+f}};Kekule.Widget.HtmlClassNames={BASE:"K-Widget",DYN_CREATED:"K-Dynamic-Created",NORMAL_BACKGROUND:"K-Normal-Background",NONSELECTABLE:"K-NonSelectable",SELECTABLE:"K-Selectable",STATE_NORMAL:"K-State-Normal",STATE_DISABLED:"K-State-Disabled",STATE_HOVER:"K-State-Hover",STATE_ACTIVE:"K-State-Active",STATE_FOCUSED:"K-State-Focused",STATE_SELECTED:"K-State-Selected",STATE_CHECKED:"K-State-Checked",SHOW_POPUP:"K-Show-Popup",SHOW_DIALOG:"K-Show-Dialog",SHOW_ACTIVE_MODAL:"K-Show-ActiveModal",SECTION:"K-Section",PART_CONTENT:"K-Content",PART_TEXT_CONTENT:"K-Text-Content",PART_ASSOC_TEXT_CONTENT:"K-Assoc-Text-Content",PART_IMG_CONTENT:"K-Img-Content",PART_GLYPH_CONTENT:"K-Glyph-Content",PART_PRI_GLYPH_CONTENT:"K-Pri-Glyph-Content",PART_ASSOC_GLYPH_CONTENT:"K-Assoc-Glyph-Content",PART_DECORATION_CONTENT:"K-Decoration-Content",PART_ERROR_REPORT:"K-Error-Report",FIRST_CHILD:"K-First-Child",LAST_CHILD:"K-Last-Child",TEXT_NO_WRAP:"K-No-Wrap",LAYOUT_H:"K-Layout-H",LAYOUT_V:"K-Layout-V",CORNER_ALL:"K-Corner-All",CORNER_LEFT:"K-Corner-Left",CORNER_RIGHT:"K-Corner-Right",CORNER_TOP:"K-Corner-Top",CORNER_BOTTOM:"K-Corner-Bottom",CORNER_TL:"K-Corner-TL",CORNER_TR:"K-Corner-TR",CORNER_BL:"K-Corner-BL",CORNER_BR:"K-Corner-BR",CORNER_LEADING:"K-Corner-Leading",CORNER_TAILING:"K-Corner-Tailing",FULLFILL:"K-Fulfill",NOWRAP:"K-No-Wrap",HIDE_TEXT:"K-Text-Hide",HIDE_GLYPH:"K-Glyph-Hide",SHOW_TEXT:"K-Text-Show",SHOW_GLYPH:"K-Glyph-Show",MODAL_BACKGROUND:"K-Modal-Background",DUMB_WIDGET:"K-Dumb-Widget",PLACEHOLDER:"K-PlaceHolder"};var c=Kekule.Widget.HtmlClassNames;Kekule.Widget.Layout={HORIZONTAL:1,VERTICAL:2};Kekule.Widget.Position={AUTO:0,TOP:1,LEFT:2,BOTTOM:4,RIGHT:8,TOP_LEFT:3,TOP_RIGHT:9,BOTTOM_LEFT:6,BOTTOM_RIGHT:12};Kekule.Widget.Direction={AUTO:0,LTR:1,TTB:2,RTL:4,BTT:8,isInHorizontal:function(g){var f=Kekule.Widget.Direction;return !!((g&f.LTR)||(g&f.RTL))},isInVertical:function(g){var f=Kekule.Widget.Direction;return !!((g&f.TTB)||(g&f.BTT))}};Kekule.Widget.State={NORMAL:0,FOCUSED:1,HOVER:2,ACTIVE:3,DISABLED:-1};var b=Kekule.Widget.State;Kekule.Widget.ShowHideType={DROPDOWN:1,POPUP:2,DIALOG:3,DEFAULT:0};Kekule.Widget.UiEvents=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","mousewheel","keydown","keyup","keypress","touchstart","touchend","touchcancel","touchmove","pointerdown","pointermove","pointerout","pointerover","pointerup"];Kekule.Widget.UiLocalEvents=["blur","focus","mouseenter","mouseleave","pointerenter","pointerleave"];Kekule.Widget.TouchGestures=["hold","tap","doubletap","swipe","swipeup","swipedown","swipeleft","swiperight","transform","transformstart","transformend","rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout","pan","panstart","panmove","panend","pancancel","panleft","panright","panup","pandown"];Kekule.Widget._PointerHoldParams={DURATION_THRESHOLD:1000,MOVEMENT_THRESHOLD:10};var d="__$kekule_widget__";Kekule.Widget.BaseWidget=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget",BINDABLE_TAG_NAMES:null,DEF_PERIODICAL_EXEC_DELAY:500,DEF_PERIODICAL_EXEC_INTERVAL:100,STYLE_RES_FIELD:"__$style_resources__",initialize:function($super,f,g){this._stateClassName=null;this._isDismissed=false;this._pendingHtmlClassNames="";this._enableShowHideEvents=true;this._reactElemAttribMutationBind=this._reactElemAttribMutation.bind(this);this.reactTouchGestureBind=this.reactTouchGesture.bind(this);this.setPropStoreFieldValue("inheritEnabled",true);this.setPropStoreFieldValue("inheritStatic",true);this.setPropStoreFieldValue("selfEnabled",true);this.setPropStoreFieldValue("selfStatic",false);this.setPropStoreFieldValue("periodicalExecDelay",this.DEF_PERIODICAL_EXEC_DELAY);this.setPropStoreFieldValue("periodicalExecInterval",this.DEF_PERIODICAL_EXEC_INTERVAL);this.setPropStoreFieldValue("useNormalBackground",true);this._touchActionNoneTouchStartHandlerBind=this._touchActionNoneTouchStartHandler.bind(this);$super();this.setPropStoreFieldValue("isDumb",!!g);if(!g){this.reactUiEventBind=this.reactUiEvent.bind(this)}if(f){if(f instanceof Kekule.Widget.BaseWidget){this.setDocument(f.getDocument());this.createElement();this.setParent(f)}else{if(f.documentElement){this.setDocument(f);this.createElement()}else{this.setDocument(f.ownerDocument);this.setElement(f)}}}this._stateClassName=null;this._layoutClassName=null;if(!this.getLayout()){this.setLayout(Kekule.Widget.Layout.HORIZONTAL)}this.setDraggable(false);this._periodicalExecBind=this._periodicalExec.bind(this);this.setBubbleEvent(true);this.setInheritBubbleUiEvents(true);this.stateChanged();var h=this.getGlobalManager();if(h){h.notifyWidgetCreated(this)}},initProperties:function(){this.defineProp("isDumb",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(g){if(this.getIsDumb()!=g){this.setPropStoreFieldValue("isDumb",g);var f=this.getElement();if(f){if(g){this.uninstallUiEventHandlers(f)}else{this.installUiEventHandlers(f)}}}}});this.defineProp("bubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("inheritBubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("touchAction",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(g){var f=this.getCoreElement();if(f){f.style.touchAction=g;if(g==="none"){Kekule.X.Event.addListener(f,"touchstart",this._touchActionNoneTouchStartHandlerBind,{passive:false})}else{Kekule.X.Event.removeListener(f,"touchstart",this._touchActionNoneTouchStartHandlerBind,{passive:false})}}}});this.defineProp("parent",{dataType:"Kekule.Widget.BaseWidget",serializable:false,scope:Class.PropertyScope.PUBLISHED,setter:function(g){var f=this.getParent();if(f){f._removeChild(this)}if(g){g._addChild(this)}this.setPropStoreFieldValue("parent",g)}});this.defineProp("childWidgets",{dataType:DataType.ARRAY,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var f=this.getPropStoreFieldValue("childWidgets");if(!f){f=[];this.setPropStoreFieldValue("childWidgets",f)}return f}});this.defineProp("document",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("element",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(g){var f=this.getElement();if(g!==f){this.setPropStoreFieldValue("element",g);this.elementChanged(g,f)}}});this.defineProp("observeElementAttribChanges",{dataType:DataType.BOOL,setter:function(f){if(!!f!==!!this.getObserveElementAttribChanges()){this.setPropStoreFieldValue("observeElementAttribChanges",f);this.observeElementAttribChangesChanged(!!f)}}});this.defineElemAttribMappingProp("id","id");this.defineElemAttribMappingProp("draggable","draggable");this.defineElemStyleMappingProp("width","width");this.defineElemStyleMappingProp("height","height");this.defineProp("offsetParent",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().offsetParent},setter:null});this.defineProp("offsetLeft",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetLeft},setter:null});this.defineProp("offsetTop",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetTop},setter:null});this.defineProp("offsetWidth",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetWidth},setter:null});this.defineProp("offsetHeight",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetHeight},setter:null});this.defineProp("innerHTML",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().innerHTML},setter:function(f){this.getElement().innerHTML=f}});this.defineProp("style",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style},setter:null});this.defineProp("cssText",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style.cssText},setter:function(f){this.getElement().style.cssText=f}});this.defineProp("htmlClassName",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().className},setter:function(f){this.getElement().className=f}});this.defineProp("customHtmlClassName",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(h){var g=this.getElement();var f=this.getCustomHtmlClassName();if(g&&(f!==h)){if(f){e.removeClass(g,f)}if(h){e.addClass(g,h)}this.setPropStoreFieldValue("customHtmlClassName",h)}}});this.defineProp("visible",{dataType:DataType.BOOL,serializable:false,getter:function(){return Kekule.StyleUtils.isVisible(this.getElement())},setter:function(g,f){Kekule.StyleUtils.setVisibility(this.getElement(),g);if(!f){this.widgetShowStateChanged(this.isShown())}}});this.defineProp("displayed",{dataType:DataType.BOOL,serializable:false,getter:function(){return Kekule.StyleUtils.isDisplayed(this.getElement())},setter:function(g,f){Kekule.StyleUtils.setDisplay(this.getElement(),g);if(!f){this.widgetShowStateChanged(this.isShown())}}});this.defineProp("showHideType",{dataType:DataType.INT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("showHideCaller",{dataType:"Kekule.Widget.BaseWidget",serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("showHideCallerPageRect",{dataType:DataType.HASH,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("finalizeAfterHiding",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("layout",{dataType:DataType.INT,setter:function(f){if(this.getPropStoreFieldValue("layout")!==f){this.setPropStoreFieldValue("layout",f);this.layoutChanged()}}});this.defineProp("useCornerDecoration",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("useCornerDecoration",f);if(!f){this.removeClassName(c.CORNER_ALL)}else{this.addClassName(c.CORNER_ALL)}}});this.defineProp("useNormalBackground",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("useNormalBackground",f);if(!f){this.removeClassName(c.NORMAL_BACKGROUND)}else{this.addClassName(c.NORMAL_BACKGROUND)}}});this.defineProp("showText",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("showText",f);if(f){this.removeClassName(c.HIDE_TEXT);this.addClassName(c.SHOW_TEXT)}else{this.addClassName(c.HIDE_TEXT);this.removeClassName(c.SHOW_TEXT)}}});this.defineProp("showGlyph",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("showGlyph",f);if(f){this.removeClassName(c.HIDE_GLYPH);this.addClassName(c.SHOW_GLYPH)}else{this.addClassName(c.HIDE_GLYPH);this.removeClassName(c.SHOW_GLYPH)}}});this.defineProp("allowTextWrap",{dataType:DataType.BOOL,serialzable:false,setter:function(f){if(f){this.removeClassName(c.TEXT_NO_WRAP)}else{this.addClassName(c.TEXT_NO_WRAP)}}});this.defineProp("selfEnabled",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE});this.defineProp("inheritEnabled",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("inheritEnabled",f);this.stateChanged()}});this.defineProp("enabled",{dataType:DataType.BOOL,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("selfEnabled");if(this.getInheritEnabled()){var g=this.getParent();if(g){f=f&&g.getEnabled()}}return f},setter:function(g){var f=this.getElement();if(!g){f.setAttribute("disabled","true")}else{f.removeAttribute("disabled")}var f=this.getCoreElement();if(f!=this.getElement()){if(!g){f.setAttribute("disabled","true")}else{f.removeAttribute("disabled")}}this.setPropStoreFieldValue("selfEnabled",g);this.stateChanged()}});this.defineProp("selfStatic",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE});this.defineProp("inheritStatic",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("inheritStatic",f);this.stateChanged()}});this.defineProp("static",{dataType:DataType.BOOL,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("selfStatic");if(this.getInheritStatic()){var g=this.getParent();if(g){f=f||g.getStatic()}}return f},setter:function(f){this.setPropStoreFieldValue("selfStatic",f);this.stateChanged()}});this.defineProp("inheritState",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("inheritState",f);this.stateChanged()}});this.defineProp("state",{dataType:DataType.INT,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var f;if(this.getInheritState()){var g=this.getParent();if(g){f=g.getState()}}else{if(!this.getEnabled()){f=b.DISABLED}else{f=this.getIsActive()?b.ACTIVE:this.getIsHover()?b.HOVER:this.getIsFocused()?b.FOCUSED:b.NORMAL}}return f}});this.defineProp("cursor",{dataType:DataType.VARIANT,serializable:false,getter:function(){return this.getStyleProperty("cursor")},setter:function(f){if(DataType.isArrayValue(f)){Kekule.StyleUtils.setCursor(this.getElement(),f)}else{this.setStyleProperty("cursor",f)}}});this.defineProp("isHover",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){this.setPropStoreFieldValue("isHover",f);if(!f&&!this.isCaptureMouse()){this.setPropStoreFieldValue("isActive",false)}this.stateChanged()}});this.defineProp("isActive",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(g){this.setPropStoreFieldValue("isActive",g);if(g){this.focus()}var f=this.getGlobalManager();if(f){f.notifyWidgetActiveChanged(this,g)}this.stateChanged()}});this.defineProp("isFocused",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var g=this.getDocument();var f=this.getCoreElement();if(g&&f&&g.activeElement){return(g.activeElement===f)}},setter:function(h){this.setPropStoreFieldValue("isFocused",h);var f=this.getGlobalManager();if(f){f.notifyWidgetFocusChanged(this,h)}var g=this.getCoreElement();if(g){if(g.focus&&h&&Kekule.HtmlElementUtils.isFormCtrlElement(g)){g.focus()}if(g.blur&&(!h)){g.blur()}}this.stateChanged()}});this.defineProp("minDimension",{dataType:DataType.HASH});this.defineProp("enableDimensionTransform",{dataType:DataType.BOOL});this.defineProp("autoResizeConstraints",{dataType:DataType.HASH,setter:function(f){this.setPropStoreFieldValue("autoResizeConstraints",f);var g=this.getGlobalManager()||Kekule.Widget.globalManager;if(f){this.autoResizeToClient();g.registerAutoResizeWidget(this)}else{g.unregisterAutoResizeWidget(this)}}});this.defineProp("autoAdjustSizeOnPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("isDialog",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("isPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("popupCaller",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE});this.defineProp("modalInfo",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC});this.defineProp("enablePeriodicalExec",{dataType:DataType.BOOL});this.defineProp("periodicalExecDelay",{dataType:DataType.INT});this.defineProp("periodicalExecInterval",{dataType:DataType.INT});this.defineElemAttribMappingProp("hint","title");this.defineProp("action",{dataType:"Kekule.Action",serializable:false,setter:function(g){var f=this.getAction();if(f!==g){if(f&&f.unlinkWidget){f.unlinkWidget(this);this.unlinkAction(f)}this.setPropStoreFieldValue("action",g);if(g&&g.linkWidget){g.linkWidget(this);this.linkAction(g)}}}});this.defineProp("iaControllerMap",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var f=this.getPropStoreFieldValue("iaControllerMap");if(!f){f=new Kekule.HashEx();this.setPropStoreFieldValue("iaControllerMap",f)}return f}});this.defineProp("defIaControllerId",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("defIaController",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getDefIaControllerId())}});this.defineProp("activeIaControllerId",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(g){if(g!==this.getActiveIaControllerId()){this.setPropStoreFieldValue("activeIaControllerId",g);var f=this.getActiveIaController();if(f&&f.activated){f.activated(this)}}}});this.defineProp("activeIaController",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getActiveIaControllerId())}});this.defineProp("observingGestureEvents",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null})},doFinalize:function($super){this.setAction(null);this.setParent(null);this.releaseChildWidgets();var f=this.getElement();this.setElement(null);this.destroyElement(f);if(this.getGlobalManager()){this.getGlobalManager().notifyWidgetFinalized(this)}$super()},initPropValues:function($super){$super();this.setEnableObjectChangeEvent(true)},invokeEvent:function($super,g,h){if(!h){h={}}if(!h.widget){h.widget=this}$super(g,h);var f=this.getGlobalManager();if(f){f.notifyWidgetEventFired(this,g,h)}},getGlobalManager:function(){var h=this.getDocument();var g=h&&Kekule.DocumentUtils.getDefaultView(h);var f=g&&g.Kekule;if(!f){f=Kekule}return f.Widget.globalManager},getCoreElement:function(){return this.getElement()},getChildrenHolderElement:function(){return this.getCoreElement()},getTextSelectable:function(){return false},canUsePlaceHolderOnElem:function(f){return false},doPropChanged:function(f,g){if((f==="width")||(f==="height")){this.resized()}},getActualBubbleUiEvents:function(){var f=this.getParent();if(this.getBubbleUiEvents()){return true}else{if(this.getInheritBubbleUiEvents()&&f&&f.getActualBubbleUiEvents){return f.getActualBubbleUiEvents()}else{false}}},releaseChildWidgets:function(){var g=this.getChildWidgets();for(var f=g.length-1;f>=0;--f){g[f].finalize()}},defineElemAttribMappingProp:function(i,h,f){var g=Object.extend({dataType:DataType.STRING,serializable:false,getter:function(){return this.getElement()&&this.getElement().getAttribute(h)},setter:function(j){this.getElement()&&this.getElement().setAttribute(h,j)}},f||{});return this.defineProp(i,g)},defineElemStyleMappingProp:function(h,i,f){var g=Object.extend({dataType:DataType.STRING,serializable:false,getter:function(){return this.getStyleProperty(i)},setter:function(j){this.setStyleProperty(i,j)}},f||{});return this.defineProp(h,g)},getHigherLevelObj:function(){return this.getParent()},linkAction:function(f){},unlinkAction:function(f){},getChildActionClass:function(g,h){var f=Kekule.ActionManager.getActionClassOfName(g,this,h);return f},linkStyleResource:function(f,h){var g=(f instanceof Kekule.Widget.StyleResource)?f:Kekule.Widget.StyleResourceManager.getResource(f);if(g){g.linkTo(h||this)}return this},unlinkStyleResource:function(f,h){var g=(f instanceof Kekule.Widget.StyleResource)?f:Kekule.Widget.StyleResourceManager.getResource(f);if(g){g.unlinkFrom(h||this)}return this},getStyleProperty:function(f,h){var i=h||this.getElement();var g=i[this.STYLE_RES_FIELD];if(!g||!g[f]){return i.style[f]}else{return g[f]}},setStyleProperty:function(g,l,j){var k=j||this.getElement();if(k){var i;if(l instanceof Kekule.Widget.StyleResource){i=l}else{if((DataType.getType(l)===DataType.STRING)&&(l.startsWith(Kekule.Widget.StyleResourceNames.PREFIX))){i=Kekule.Widget.StyleResourceManager.getResource(l)}}if(i){var h=k[this.STYLE_RES_FIELD];if(!h){h={};k[this.STYLE_RES_FIELD]=h}var f=h[g];if(f){this.unlinkStyleResource(f,k)}if(i){this.linkStyleResource(i,k)}h[g]=i}else{k.style[g]=l;var h=k[this.STYLE_RES_FIELD];if(h&&h[g]){this.unlinkStyleResource(h[g],k)}}}},removeStyleProperty:function(f,i,g){var h=g||this.getElement();Kekule.StyleUtils.removeStyleProperty(h.style,f)},_addChild:function(g){if(!g){return}var f=this.getChildWidgets();if(f.indexOf(g)<0){f.push(g);this.childWidgetAdded(g);this.childrenModified()}},_insertChild:function(i,g){if(!i){return}var f=this.getChildWidgets();var h=g?f.indexOf(g):f.length;if(f.indexOf(i)>=0){if(h>=0){this._moveChild(i,h)}}else{if(h<0){h=f.length}f.splice(h,0,i);this.childWidgetAdded(i);this.childrenModified()}},_removeChild:function(j){if(!j){return}var g=this.getChildWidgets();var h=g.indexOf(j);if(h>=0){g.splice(h,1);var f=this.getChildrenHolderElement();var i=j.getElement();if(i&&Kekule.DomUtils.isDescendantOf(i,f)){i.parentNode.removeChild(i)}this.childWidgetRemoved(j);this.childrenModified()}},_moveChild:function(g,f){if(!g){return}if(Kekule.ArrayUtils.changeItemIndex(this.getChildWidgets(),g,f)){this.childWidgetMoved(g,f);this.childrenModified()}},childrenModified:function(){},childWidgetAdded:function(f){},childWidgetRemoved:function(f){},childWidgetMoved:function(g,f){},indexOfChild:function(f){return this.getChildWidgets().indexOf(f)},hasChild:function(g){var f=this.indexOfChild(g);return(f>=0)},getChildAtIndex:function(f){return this.getChildWidgets()[f]},getPrevSibling:function(){var g=this.getParent();if(g){var f=g.indexOfChild(this);return this.getChildAtIndex(--f)}else{return null}},getNextSibling:function(){var g=this.getParent();if(g){var f=g.indexOfChild(this);return this.getChildAtIndex(++f)}else{return null}},_haltPrevShowHideProcess:function(){if(Kekule.Widget.showHideManager){if(this.__$showHideTransInfo){this.__$showHideTransInfo.halt()}}},_setEnableShowHideEvents:function(f){this._enableShowHideEvents=f},show:function(f,i,h,g){if(!this.getElement()){return}if(this.__$isShowing){return}this._haltPrevShowHideProcess();this.doShow(f,i,h,g);return this},doShow:function(h,l,k,i){this.__$isShowing=true;var g=this;var f=function(){g.__$showHideTransInfo=null;g.widgetShowStateDone(true);g.__$isShowing=false;if(l){l()}};this.setShowHideType(k);if(Kekule.ObjUtils.notUnset(k)){this.setIsPopup((k===Kekule.Widget.ShowHideType.DROPDOWN)||(k===Kekule.Widget.ShowHideType.POPUP));if(k===Kekule.Widget.ShowHideType.DIALOG){this.setIsDialog(true);k=Kekule.Widget.ShowHideType.POPUP}else{this.setIsDialog(false)}}this.widgetShowStateBeforeChanging(true);var j=this.getGlobalManager();if(k===Kekule.Widget.ShowHideType.DROPDOWN||k===Kekule.Widget.ShowHideType.POPUP){j.preparePopupWidget(this,h,k)}if(Kekule.Widget.showHideManager&&!(i&&i.instantly)){if(!this.__$showHideTransInfo){this.__$showHideTransInfo=Kekule.Widget.showHideManager.show(this,h,f,k,i)}}else{this.setDisplayed(true,true);this.setVisible(true,true);f()}this.setShowHideCaller(h);if(h){this.setShowHideCallerPageRect(e.getElemBoundingClientRect((h.getElement&&h.getElement())||h))}this.widgetShowStateChanged(true)},flash:function(i,h,k,j){var g=this;var f=function(){if(k){k()}setTimeout(g.hide.bind(g),i)};this.show(h,f,j);return this},hide:function(f,i,h,g){if(!this.getElement()){return}if(this.__$isHiding){return}this.__$isHiding=true;if(!f){f=this.getShowHideCaller()}if(!h){h=this.getShowHideType()}this._haltPrevShowHideProcess();this.doHide(f,i,h,g);return this},doHide:function(f,m,g,h){var l=Object.extend({callerPageRect:this.getShowHideCallerPageRect()},h);var k=l.useVisible;var n=this;var j=this.getFinalizeAfterHiding();var i=function(){n.__$showHideTransInfo=null;n.widgetShowStateDone(false);var o=n.getGlobalManager();if(g===Kekule.Widget.ShowHideType.DROPDOWN||g===Kekule.Widget.ShowHideType.POPUP){o.unpreparePopupWidget(n)}n.__$isHiding=false;if(m){m()}if(j){n.finalize()}};this.widgetShowStateBeforeChanging(false);if(Kekule.Widget.showHideManager&&!l.instantly){if(this.__$showHideTransInfo){this.__$showHideTransInfo.halt()}if(!this.__$showHideTransInfo){this.__$showHideTransInfo=Kekule.Widget.showHideManager.hide(this,f,i,g,false,l)}}else{if(k){this.setVisible(false,true)}else{this.setDisplayed(false,true)}i()}this.widgetShowStateChanged(false)},dismiss:function(f,i,h,g){this._isDismissed=true;return this.hide(f,i,h,g)},isShown:function(g){var f=(this.isInDomTree()||g)&&this.getElement()&&this.getVisible()&&this.getDisplayed();return f},widgetShowStateBeforeChanging:function(f){if(f){this.autoResizeToClient()}},widgetShowStateChanged:function(h,f){if(Kekule.ObjUtils.isUnset(h)){h=this.isShown()}if(Kekule.ObjUtils.notUnset(this._lastShown)&&(this._lastShown===h)){return}this._lastShown=h;if(h){this._isDismissed=false}var g=this.getGlobalManager();if(this.getIsPopup()){if(h){g.registerPopupWidget(this)}else{g.unregisterPopupWidget(this)}}if(this.getIsDialog()){if(h){g.registerDialogWidget(this)}else{g.unregisterDialogWidget(this)}}this.doWidgetShowStateChanged(h);if(this._enableShowHideEvents){this.invokeEvent("showStateChange",{widget:this,isShown:h,isDismissed:this._isDismissed,byDomChange:f})}},doWidgetShowStateChanged:function(f){},widgetShowStateDone:function(f){},isInDomTree:function(){var f=this.getElement();return Kekule.DomUtils.isInDomTree(f)},focus:function(){this.setIsFocused(true);return this},blur:function(){this.setIsFocused(false);return this},getBoundingClientRect:function(h){if(!this.getDisplayed()){var i=Kekule.StyleUtils.getDisplayed(this.getElement());var g=Kekule.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden");this.setDisplayed("");var f=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),h)}finally{this.setDisplayed(i);this.setVisible(g)}return f}else{return Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),h)}},getPageRect:function(h){if(!this.getDisplayed()){var i=Kekule.StyleUtils.getDisplayed(this.getElement());var g=Kekule.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden");this.setDisplayed("");var f=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),h)}finally{this.setDisplayed(i);this.setVisible(g)}return f}else{return Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),h)}},getDimension:function(){return this.getPageRect()},setDimension:function(i,q,j){var n=Kekule.ObjUtils.notUnset;var h=this.getMinDimension();var g=h&&h.width;var p=h&&h.height;if(!this.getEnableDimensionTransform()){var f=n(i)?(g?Math.max(i,g):i):null;var k=n(q)?(p?Math.max(q,p):q):null;this._setTransformScale(1);return this.doSetDimension(f,k,j)}else{var o=(n(i)&&g)?i/g:null;var m=(n(q)&&p)?q/p:null;var l;if(!o||!m){l=o||m}else{l=Math.min(o,m)}if(l>=1){this._setTransformScale(1);return this.doSetDimension(i,q,j)}else{var f,k;if(!m||o<=m){f=g;k=q&&(q/l)}else{k=p;f=i&&(i/l)}this._setTransformScale(l);return this.doSetDimension(f,k,j)}}},doSetDimension:function(i,f,h){var g=false;var j=Kekule.ObjUtils.notUnset;if(j(i)){this.getStyle().width=(typeof(i)==="number")?i+"px":i;g=true}if(j(f)){this.getStyle().height=(typeof(f)==="number")?f+"px":f;g=true}if(g&&(!h)){this.resized()}this.objectChange(["width","height"]);return this},_setTransformScale:function(g){var f=this.getElement();if(g!==1){f.style.transformOrigin="0 0";f.style.transform="scale("+g+")"}else{Kekule.StyleUtils.removeStyleProperty(f.style,"transform")}},updateDimensionTransform:function(){var f=this.getDimension();this.setDimension(f.width,f.height,true)},autoResizeToClient:function(){var i=this.getAutoResizeConstraints();if(i){var h=Kekule.DocumentUtils.getClientDimension(this.getDocument());var g=i.width?h.width*i.width:null;var f=i.height?h.height*i.height:null;this.setDimension(g,f)}},resized:function(){this.doResize();this.invokeEvent("resize",{widget:this})},doResize:function(){},layoutChanged:function(){var f=this.getLayout();if(this._layoutClassName){this.removeClassName(this._layoutClassName)}this._layoutClassName=this.getLayoutClassName(f);if(this._layoutClassName){this.addClassName(this._layoutClassName)}},getLayoutClassName:function(f){var g=Kekule.Widget.Layout;return(f===g.VERTICAL)?c.LAYOUT_V:(f===g.HORIZONTAL)?c.LAYOUT_H:null},stateChanged:function(){if(this._stateClassName){this.removeClassName(this._stateClassName)}this._stateClassName=this.getStateClassName(this.getState());if(this._stateClassName){this.addClassName(this._stateClassName)}var h=this.getChildWidgets();for(var g=0,f=h.length;g<f;++g){h[g].stateChanged()}},getStateClassName:function(h){var g=Kekule.Widget.State;var f=(h===g.ACTIVE)?c.STATE_ACTIVE:(h===g.HOVER)?c.STATE_HOVER:(h===g.FOCUSED)?c.STATE_FOCUSED:(h===g.DISABLED)?c.STATE_DISABLED:c.STATE_NORMAL;return f},createElement:function(){var g=this.getDocument();var f=this.doCreateRootElement(g);this.setElement(f);return f},doCreateRootElement:function(f){},doCreateSubElements:function(g,f){return[]},destroyElement:function(f){var f=f||this.getElement();if(f&&f.parentNode){f.parentNode.removeChild(f)}},appendToElem:function(f){if(f){f.appendChild(this.getElement())}return this},insertToElem:function(f,g){f.insertBefore(this.getElement(),g);return this},removeFromDom:function(){var g=this.getElement();var f=g.parentNode;if(f){f.removeChild(g)}},appendToWidget:function(f){this.setParent(f);this.appendToElem(f.getChildrenHolderElement());return this},insertToWidget:function(f,g){this.setParent(f);if(g){this.insertToElem(f.getChildrenHolderElement(),g.getElement())}else{this.appendToElem(f.getChildrenHolderElement())}return this},insertedToDom:function(){this.widgetDomStateChanged(true);this.widgetShowStateChanged(this.isShown(),true);return this.doInsertedToDom()},doInsertedToDom:function(){},removedFromDom:function(){this.widgetDomStateChanged(false);this.widgetShowStateChanged(false,true);return this.doRemovedFromDom()},doRemovedFromDom:function(){},widgetDomStateChanged:function(f){this.doWidgetDomStateChanged(f);this.invokeEvent("domStateChange",{widget:this,isInDom:f})},doWidgetDomStateChanged:function(f){},domElemAdded:function(f){return this.doDomElemAdded(f)},doDomElemAdded:function(f){},domElemRemoved:function(f){return this.doDomElemRemoved(f)},doDomElemRemoved:function(f){},getWidgetClassName:function(){var f=Kekule.Widget.HtmlClassNames.BASE;if(this.getElement()&&!Kekule.HtmlElementUtils.isFormCtrlElement(this.getCoreElement())&&!!this.getUseNormalBackground()){f+=" "+Kekule.Widget.HtmlClassNames.NORMAL_BACKGROUND}f+=" "+this.doGetWidgetClassName();return f},doGetWidgetClassName:function(){return""},hasClassName:function(f){return e.hasClass(this.getElement(),f)},addClassName:function(g,h){if(this.getElement()){if(h){var f=this.getCustomHtmlClassName();f=Kekule.StrUtils.addTokens(f,g);this.setCustomHtmlClassName(f)}else{e.addClass(this.getElement(),g)}}else{this._pendingHtmlClassNames=Kekule.StrUtils.addTokens(this._pendingHtmlClassNames,g)}return this},removeClassName:function(g,h){if(this.getElement()){if(h){var f=this.getCustomHtmlClassName();f=Kekule.StrUtils.removeTokens(f,g);this.setCustomHtmlClassName(f)}else{e.removeClass(this.getElement(),g)}}else{this._pendingHtmlClassNames=Kekule.StrUtils.removeTokens(this._pendingHtmlClassNames,g)}return this},toggleClassName:function(g,h){if(this.getElement()){if(h){var f=this.getCustomHtmlClassName();f=Kekule.StrUtils.toggleTokens(f,g);this.setCustomHtmlClassName(f)}else{e.toggleClass(this.getElement(),g)}}return this},isElementBindable:function(f){var h=this.getBindableElemTagNames();if(h){var g=f.tagName;return(h.indexOf(g.toLowerCase())>=0)}else{return true}},getBindableElemTagNames:function(){if(this.getPrototype().hasOwnProperty("BINDABLE_TAG_NAMES")){return this.BINDABLE_TAG_NAMES}else{return null}},bindElement:function(k){if(k){if(!this.isElementBindable(k)){Kekule.error(Kekule.$L("ErrorMsg.WIDGET_CAN_NOT_BIND_TO_ELEM").format(this.getClassName(),k.tagName));return}var q=k.className;if(q){this.setCustomHtmlClassName(this.getCustomHtmlClassName()||" "+q)}var m=Kekule.DomUtils;var u=Kekule.HtmlElementUtils;var n=function(h){var w=m.getDirectChildElems(h);for(var l=w.length-1;l>=0;--l){var D=w[l];if(u.hasClass(D,c.DYN_CREATED)){h.removeChild(D)}}};n(k);var B=this.getDocument();var g=B.createDocumentFragment();var r=this.doCreateSubElements(this.getDocument(),g);if(r&&r.length){for(var v=0,t=r.length;v<t;++v){var A=r[v];u.addClass(A,c.DYN_CREATED)}}if((r&&r.length)||(g.children&&g.children.length)){k.appendChild(g)}this.doBindElement(k);if(Kekule.DomUtils.hasAttribute(k,"disabled")){this.setEnabled(false)}var p=k.getAttribute("width");var y=k.getAttribute("height");if(Kekule.ObjUtils.notUnset(p)||Kekule.ObjUtils.notUnset(y)){p=parseFloat((p||"").toString())||0;y=parseFloat((y||"").toString())||0;this.setDimension(p,y)}var o=Kekule.DomUtils.getDataset(k);if(o){for(var j in o){var s=o[j];try{Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,j,s)}catch(z){Kekule.warn(z)}}}var f=this.getWidgetClassName();e.addClass(k,f);f=this.getCustomHtmlClassName();if(f){e.addClass(k,f)}if(!this.getTextSelectable()){e.addClass(k,c.NONSELECTABLE)}if(this._pendingHtmlClassNames){e.addClass(k,this._pendingHtmlClassNames);this._pendingHtmlClassNames=""}var x=this.getTouchAction();if(Kekule.ObjUtils.notUnset(x)){this.setTouchAction(x)}if(!this.getIsDumb()){this.installUiEventHandlers(k)}k[d]=this;this.invokeEvent("bind",{widget:this,element:k})}},doBindElement:function(f){},unbindElement:function(g){if(g){if(!this.getIsDumb()){this.uninstallUiEventHandlers(g)}var f=this.getWidgetClassName();e.removeClass(g,f);this.doUnbindElement(g);g[d]=undefined;try{delete g[d]}catch(h){}this.invokeEvent("unbind",{widget:this,element:g})}},doUnbindElement:function(f){},elementChanged:function(f,g){if(g){this.unbindElement(g)}if(f){this.bindElement(f)}},observeElementAttribChangesChanged:function(g){var f=this.getElement();if(g){this._installAttribMutationObserver(f)}else{this._uninstallAttribMutationObserver(f)}},_installAttribMutationObserver:function(g){if(Kekule.X.MutationObserver){if(!this._attribMutationObserver){var f=new Kekule.X.MutationObserver(this._reactElemAttribMutationBind);this._attribMutationObserver=f}this._attribMutationObserver.observe(g,{attributes:true})}},_uninstallAttribMutationObserver:function(f){if(this._attribMutationObserver){this._attribMutationObserver.disconnect()}},_reactElemAttribMutation:function(j){var p=this.getElement();for(var n=0,h=j.length;n<h;++n){var g=j[n];if(g.type!=="attributes"){continue}if(g.target!==p){continue}var o=g.attributeName;if(o&&Kekule.DomUtils.isDataAttribName(o)){var f=Kekule.DomUtils.getDataAttribCoreName(o);if(f){var k=p.getAttribute(o);Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,f,k)}}}},createDecorationContent:function(g,h){var i=g.ownerDocument;var f=i.createElement("span");e.addClass(f,[c.PART_CONTENT,c.PART_DECORATION_CONTENT,c.DYN_CREATED]);if(h){g.insertBefore(f,h)}else{g.appendChild(f)}return f},createTextContent:function(j,g,h){var i=g.ownerDocument;var f=i.createElement("span");e.addClass(f,[c.PART_CONTENT,c.PART_TEXT_CONTENT,c.DYN_CREATED]);f.innerHTML=j;if(h){g.insertBefore(f,h)}else{g.appendChild(f)}return f},createGlyphContent:function(g,h,i){var j=g.ownerDocument;var f=j.createElement("span");e.addClass(f,[c.PART_CONTENT,c.PART_GLYPH_CONTENT,c.DYN_CREATED]);if(i){e.addClass(f,i)}if(h){g.insertBefore(f,h)}else{g.appendChild(f)}return f},_touchActionNoneTouchStartHandler:function(f){f.preventDefault()},installUiEventHandlers:function(j){var h=Kekule.Widget.UiLocalEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.addListener(j,h[g],this.reactUiEventBind)}},uninstallUiEventHandlers:function(j){var h=Kekule.Widget.UiLocalEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.removeListener(j,h[g],this.reactUiEventBind)}},reactUiEvent:function(t){if(this.getStatic()){}else{if(!this.getEnabled()){t.stopPropagation()}else{var m=false;var q=t.getType();var l=t.getTarget();var v=Kekule.Widget.Utils.getBelongedResponsiveWidget(l);var f=v===this;var g=Kekule.X.Event.KeyCode;var k;if(q==="mousemove"||q==="pointermove"){this.reactPointerMoving(t);var s=this.getEventMouseRelCoord(t);var j=this.testMouseCursor(s,t);if(Kekule.ObjUtils.notUnset(j)&&this.getElement()){this.setCursor(j);m=true}}else{if(q==="touchmove"){this.reactPointerMoving(t);if(this.getIsActive()&&!this.isCaptureMouse()){var p=t.touches[0];if(p){var w=this.getDocument();var n=w.elementFromPoint(p.clientX,p.clientY);if(!Kekule.DomUtils.isOrIsDescendantOf(n,this.getElement())){this.setIsHover(false);this.setIsActive(false)}}else{this.setIsHover(false);this.setIsActive(false)}}m=true}else{if(q==="focus"){if(f&&t.getTarget()===this.getCoreElement()){this.setIsFocused(true);m=true}}else{if(q==="blur"){if(f&&t.getTarget()==this.getCoreElement()){var i=this.getDocument().activeElement;var u=this.getElement();if(i&&(Kekule.DomUtils.isDescendantOf(i,u)||i===u)){}else{this.setIsFocused(false)}m=true}}else{if(q==="pointerover"){if(t.pointerType!=="touch"&&!t.ghostMouseEvent){this.setIsHover(true)}m=true}else{if(q==="mouseout"||q==="touchleave"){if(!t.ghostMouseEvent){var h=t.getRelatedTarget();if(h&&Kekule.DomUtils.isOrIsDescendantOf(h,this.getCoreElement())){}else{this.setIsHover(false);if(!this.isCaptureMouse()){this.reactDeactiviting(t);m=true}}}}else{if(q==="pointerdown"&&t.getButton()===Kekule.X.Event.MouseButton.LEFT){if(f&&!t.ghostMouseEvent){this.reactActiviting(t)}m=true}else{if((q==="pointerup"&&t.getButton()===Kekule.X.Event.MouseButton.LEFT)||(q==="touchcancel")){if(f&&!t.ghostMouseEvent){this.reactDeactiviting(t)}m=true}else{if(q==="keydown"){k=t.getKeyCode();if((k===g.ENTER)||(k===g.SPACE)){if(f&&!this.getIsActive()){this.reactActiviting(t)}m=true}}else{if(q==="keyup"){k=t.getKeyCode();if((k===g.ENTER)||(k===g.SPACE)){if(f&&this.getIsActive()){this.reactDeactiviting(t)}m=true}}}}}}}}}}}this.doBeforeDispatchUiEvent(t);var r=Kekule.Widget.getEventHandleFuncName(t.getType());if(this[r]){m=this[r](t)}else{m=this.dispatchEventToIaControllers(t)||m}this.doReactUiEvent(t);this.invokeEvent(q,{htmlEvent:t})}}if(this.getActualBubbleUiEvents()){var o=this.getParent();if(o&&o.reactUiEvent){o.reactUiEvent(t)}}},doReactUiEvent:function(f){},doBeforeDispatchUiEvent:function(f){},_supportGestureEvent:function(){return(typeof(Kekule.$jsRoot.Hammer)!=="undefined")&&(document&&document.addEventListener)},startObservingGestureEvents:function(g){if(this._supportGestureEvent()){if(!g){g=Kekule.Widget.TouchGestures}var f=a.exclude(g,this.getObservingGestureEvents()||[]);if(f.length){this.installHammerTouchHandlers(f)}}},stopObservingGestureEvents:function(g){if(this._supportGestureEvent()&&this.getObservingGestureEvents()){if(!g){g=Kekule.Widget.TouchGestures}var f=a.intersect(g,this.getObservingGestureEvents());if(f.length){this.uninstallHammerTouchHandlers(f)}}},installHammerTouchHandlers:function(f){if(this._supportGestureEvent()){if(!f){f=Kekule.Widget.TouchGestures}var g=this.getCoreElement();var h=new Hammer(g);if(f.indexOf("pinch")>=0){h.get("pinch").set({enable:true})}if(f.indexOf("rotate")>=0){h.get("rotate").set({enable:true})}h.on(f.join(" "),this.reactTouchGestureBind);this._hammertime=h;this.setPropStoreFieldValue("observingGestureEvents",f);return h}},uninstallHammerTouchHandlers:function(f){if(this._hammertime){if(!f){f=this.getObservingGestureEvents()}this._hammertime.off(f.join(" "),this.reactTouchGestureBind)}},reactTouchGesture:function(g){var f=Kekule.Widget.getTouchGestureHandleFuncName((g.getType&&g.getType())||g.type);if(this[f]){this[f](g)}else{this.dispatchEventToIaControllers(g,"hammer")}},observingGestureEventsChanged:function(f){if(enabled){this.installHammerTouchHandlers()}},reactActiviting:function(f){if(!this.getIsActive()){this.setIsActive(true);this.doReactActiviting(f);this.invokeEvent("activate",{widget:this})}},doReactActiviting:function(f){},reactDeactiviting:function(f){if(this.getIsActive()){this.doReactDeactiviting(f);this.invokeEvent("deactivate",{widget:this});this.setIsActive(false)}},doReactDeactiviting:function(f){},reactPointerMoving:function(f){this.doReactPointerMoving(f)},doReactPointerMoving:function(f){},dispatchEventToIaControllers:function(i,g){var h=false;var f=this.getActiveIaController();if(f){if(g==="hammer"){h=f.handleGestureEvent(i)}else{h=f.handleUiEvent(i)}}if(!h){f=this.getDefIaController();if(f){if(g==="hammer"){h=f.handerGestureEvent(i)}else{h=f.handleUiEvent(i)}}}return h},getEventMouseRelCoord:function(i,h){if(!h){h=this.getCoreElement()}var k={x:i.getClientX(),y:i.getClientY()};var g=Kekule.HtmlElementUtils.getElemPageRect(h,true);var j={x:g.left-h.scrollLeft,y:g.top-h.scrollTop};var f=Kekule.CoordUtils.substract(k,j);return f},testMouseCursor:function(i,h){var f=this.doTestMouseCursor(i,h);if(!f){var g=this.getActiveIaController();if(g){f=g.testMouseCursor(i,h)}if(!f){g=this.getDefIaController();if(g){f=g.testMouseCursor(i,h)}}}return f},doTestMouseCursor:function(g,f){return null},setMouseCapture:function(f){var g=this.getGlobalManager();if(f){g.setMouseCaptureWidget(this)}else{if(this.isCaptureMouse()){g.setMouseCaptureWidget(null)}}},isCaptureMouse:function(){var f=this.getGlobalManager();return f.getMouseCaptureWidget()===this},addIaController:function(h,f,g){this.getIaControllerMap().set(h,f);if(g){this.setDefIaControllerId(h)}if(f){f.setWidget(this)}},removeIaController:function(g){var f=this.getIaControllerMap().get(g);if(f){this.getIaControllerMap().remove(g);if(g===this.getDefIaControllerId()){this.setDefIaControllerId(null)}if(g===this.getActiveIaControllerId()){this.setActiveIaControllerId(null)}f.setWidget(null)}},getIaController:function(f){return this.getIaControllerMap().get(f)},execute:function(f){this.doExecute(f);this.invokeEvent("execute",{widget:this,htmlEvent:f})},doExecute:function(f){},isPeriodicalExecuting:function(){return this._periodicalExecBind},startPeriodicalExec:function(f){var g=this.getPeriodicalExecDelay()||0;this._periodicalExecuting=true;this._periodicalExecHtmlEvent=f;setTimeout(this._periodicalExecBind,g)},stopPeriodicalExec:function(){this._periodicalExecuting=false;this._periodicalExecHtmlEvent=null},_periodicalExec:function(f){if(this.isPeriodicalExecuting()){if(!this._waitPeriodicalProcess){this._waitPeriodicalProcess=true;this.execute(this._periodicalExecHtmlEvent);this._waitPeriodicalProcess=false}setTimeout(this._periodicalExecBind,this.getPeriodicalExecInterval()||20)}}});Kekule.Widget.InteractionController=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.InteractionController",initialize:function($super,f){$super();if(f){this.setWidget(f)}},doFinalize:function($super){this.setWidget(null);$super()},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false})},activated:function(f){},handleUiEvent:function(h){var f=h.getType();var g=Kekule.Widget.getEventHandleFuncName(f);if(this[g]){return this[g](h)}else{return false}},handleGestureEvent:function(h){var f=h.type;var g=Kekule.Widget.getEventHandleFuncName(f);if(this[g]){return this[g](h)}else{return false}},_defEventHandler:function(f){return false},testMouseCursor:function(g,f){return this.doTestMouseCursor(g,f)},doTestMouseCursor:function(g,f){return null},_getEventMouseCoord:function(k,j){var h=j||this.getWidget().getElement();var i=k.getTarget();var m=k.getOffsetCoord(true);if(i===h){return m}else{var f=Kekule.HtmlElementUtils.getElemPagePos(h);var g=Kekule.HtmlElementUtils.getElemPagePos(i);var l={x:g.x-f.x,y:g.y-f.y};m=Kekule.CoordUtils.substract(m,l);return m}}});Kekule.Widget.DumbWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DumbWidget",initialize:function($super,f){$super(f,true)},doGetWidgetClassName:function($super){return $super()+" "+c.DUMB_WIDGET},doCreateRootElement:function(g){var f=g.createElement("span");return f}});Kekule.Widget.PlaceHolder=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.PlaceHolder",initialize:function($super,f,g){this.setPropStoreFieldValue("targetWidgetClass",g);$super(f,true)},initProperties:function(){this.defineProp("targetWidgetClass",{dataType:DataType.CLASS,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("targetWidgetClass");if(!f){var g=this.getPropStoreFieldValue("targetWidgetClassName");if(g){f=ClassEx.findClass(g)}}return f}});this.defineProp("targetWidgetClassName",{dataType:DataType.STRING,getter:function(){var g=this.getTargetWidgetClass();var f=g?ClassEx.getClassName(C):this.getPropStoreFieldValue("targetWidgetClassName");return f},setter:function(f){this.setPropStoreFieldValue("targetWidgetClassName",f);this.setTargetWidgetClass(ClassEx.findClass(f))}});this.defineProp("target",{dataType:DataType.STRING,getter:function(){return this.getTargetWidgetClassName()},setter:function(f){this.setTargetWidgetClassName(f)}});this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:"false",setter:null,getter:function(){var f=this.getPropStoreFieldValue("targetWidget");if(!f){f=this.createTargetWidget()}return f}})},doGetWidgetClassName:function($super){var f=$super()+" "+c.PLACEHOLDER;var g=this.getTargetWidgetClass();if(g){var h=ClassEx.getPrototype(g).getWidgetClassName();f=Kekule.StrUtils.addTokens(f,h)}return f},doCreateRootElement:function(g){var f=g.createElement("img");return f},doReactUiEvent:function(g){var f=this.createTargetWidget()},createTargetWidget:function(){var o=this.getTargetWidgetClass();if(o){try{var n=this.getElement();var g=this.getParent();if(g&&g instanceof Kekule.Widget.PlaceHolder){g=g.createTargetWidget()}var m=a.clone(this.getChildWidgets());this.unbindElement(this.getElement());this.setPropStoreFieldValue("element",null);var f=new o(n);if(f){if(g){var k=this.getNextSibling();this.setParent(null);f.setPropStoreFieldValue("parent",g);g._insertChild(f,k)}if(m){for(var j=0,h=m.length;j<h;++j){m[j].setParent(f)}}}}finally{this.finalize()}return f}else{Kekule.error(Kekule.$L("ErrorMsg.WIDGET_UNAVAILABLE_FOR_PLACEHOLDER"))}}});Kekule.Widget.Utils={getWidgetOnElem:function(g,h){var f=g[d];if(!h&&(f instanceof Kekule.Widget.PlaceHolder)){f=f.getTargetWidget()}return f},getWidgetsInsideElem:function(h,n){var p;var k=Kekule.Widget.Utils.getWidgetOnElem(h);if(k){p=[k]}else{p=[]}if(!n){return p}var o=Kekule.DomUtils.getDirectChildElems(h);for(var j=0,g=o.length;j<g;++j){var f=o[j];var m=Kekule.Widget.Utils.getWidgetsInsideElem(f,n);p=p.concat(m)}return p},getWidgetById:function(h,g){if(!g){g=document}var f=g.getElementById(h);if(f){return Kekule.Widget.Utils.getWidgetOnElem(f)}else{return undefined}},getBelongedWidget:function(g){var f=null;while(g&&(!f)){f=Kekule.Widget.Utils.getWidgetOnElem(g);g=g.parentNode}return f},getBelongedResponsiveWidget:function(g){var f=null;while(g&&(!f)){f=Kekule.Widget.Utils.getWidgetOnElem(g);if(f&&f.getStatic()){f=null}g=g.parentNode}return f},createFromHash:function(t,j){var p=["widget","widgetClass","htmlClass","children"];var r=j.widgetClass||j.widget;if(typeof(r)==="string"){r=ClassEx.findClass(r)}if(!r){Kekule.error(Kekule.$L("ErrorMsg.WIDGET_CLASS_NOT_FOUND"));return null}var u=new r(t);var o=Kekule.ObjUtils.getOwnedFieldNames(j,true);o=Kekule.ArrayUtils.exclude(o,p);for(var m=0,k=o.length;m<k;++m){var q=o[m];var s=j[q];if(q.startsWith("#")&&DataType.isFunctionValue(s)){var n=q.substr(1);u.addEventListener(n,s)}else{if(u.hasProperty(q)){u.setPropValue(q,s)}}}if(j.htmlClass){u.addClassName(j.htmlClass,true)}if(j.children){var h=j.children;if(DataType.isArrayValue(h)){for(var m=0,k=h.length;m<k;++m){var g=h[m];var f=Kekule.Widget.Utils.createFromHash(u,g);if(f){f.appendToWidget(u)}}}}return u},setWidgetPropFromElemAttrib:function(k,h,g){var j=h.camelize();var f=k.getPropertyDataType(j);if(!f){return}if(f===DataType.STRING){k.setPropValue(j,g)}else{if(Kekule.PredefinedResReferer.isResValue(g)){Kekule.PredefinedResReferer.loadResource(g,function(n,o){if(k.loadPredefinedResDataToProp){k.loadPredefinedResDataToProp(j,n,o)}},null,k.getDocument())}else{if(g.startsWith("#")&&(ClassEx.isOrIsDescendantOf(ClassEx.findClass(f),Kekule.Widget.BaseWidget))){var m=g.substr(1).trim();Kekule.Widget.Utils._setWidgetRefPropFromId(k,j,m)}else{var i=JSON.parse(g);if(Kekule.ObjUtils.notUnset(i)){var l=ObjSerializerFactory.getSerializer("json").load(null,i);k.setPropValue(j,l)}}}}},_setWidgetRefPropFromId:function(h,g,i){if(i){var f=Kekule.Widget.getWidgetById(i,h.getDocument());if(f){h.setPropValue(g,f)}}}};Kekule.Widget.getWidgetOnElem=Kekule.Widget.Utils.getWidgetOnElem;Kekule.Widget.getWidgetById=Kekule.Widget.Utils.getWidgetById;Kekule.$W=Kekule.Widget.Utils.getWidgetById;Kekule.Widget.getBelongedWidget=Kekule.Widget.Utils.getBelongedWidget;Kekule.Widget.createFromHash=Kekule.Widget.Utils.createFromHash;Kekule.Widget.GlobalManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.GlobalManager",INFO_FIELD:"__$info__",initialize:function($super,f){$super();this._document=f||document;this._touchEventSeq=[];this._hammertime=null;this.setPropStoreFieldValue("popupWidgets",[]);this.setPropStoreFieldValue("dialogWidgets",[]);this.setPropStoreFieldValue("modalWidgets",[]);this.setPropStoreFieldValue("autoResizeWidgets",[]);this.setPropStoreFieldValue("widgets",[]);this.setPropStoreFieldValue("preserveWidgetList",true);this.setPropStoreFieldValue("enableMouseEventToPointerPolyfill",true);this.setPropStoreFieldValue("enableHammerGesture",!true);this.reactUiEventBind=this.reactUiEvent.bind(this);this.reactTouchGestureBind=this.reactTouchGesture.bind(this);this.reactWindowResizeBind=this.reactWindowResize.bind(this);Kekule.X.domReady(this.domReadyInit.bind(this))},finalize:function($super){this.uninstallWindowEventHandlers(Kekule.DocumentUtils.getDefaultView(this._document));this.uninstallGlobalDomMutationHandlers(this._document.documentElement);this.uninstallGlobalEventHandlers(this._document.body);this._hammertime=null;this.setPropStoreFieldValue("popupWidgets",null);this.setPropStoreFieldValue("widgets",null);$super()},initProperties:function(){this.defineProp("mouseCaptureWidget",{dataType:DataType.OBJECT,serializable:false});this.defineProp("popupWidgets",{dataType:DataType.ARRAY,serializable:false});this.defineProp("dialogWidgets",{dataType:DataType.ARRAY,serializable:false});this.defineProp("modalWidgets",{dataType:DataType.ARRAY,serializable:false});this.defineProp("autoResizeWidgets",{dataType:DataType.ARRAY,serializable:false});this.defineProp("preserveWidgetList",{dataType:DataType.BOOL,serializable:false,setter:function(f){this.setPropStoreFieldValue("preserveWidgetList",f);if(!f){this.setPropStoreFieldValue("widgets",[])}}});this.defineProp("widgets",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("currActiveWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false});this.defineProp("currFocusedWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false});this.defineProp("modalBackgroundElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("enableHammerGesture",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableMouseEventToPointerPolyfill",{dataType:DataType.BOOL,serializable:false})},domReadyInit:function(){this.installGlobalEventHandlers(this._document.documentElement);if(this.getEnableHammerGesture()){this._hammertime=this.installGlobalHammerTouchHandlers(this._document.body)}this.installGlobalDomMutationHandlers(this._document.documentElement);this.installWindowEventHandlers(Kekule.DocumentUtils.getDefaultView(this._document))},notifyWidgetCreated:function(f){if(this.getPreserveWidgetList()){this.getWidgets().push(f)}this.invokeEvent("widgetCreate",{widget:f})},notifyWidgetFinalized:function(f){if(this.getWidgets()){Kekule.ArrayUtils.remove(this.getWidgets(),f)}if(this.getPopupWidgets()){Kekule.ArrayUtils.remove(this.getPopupWidgets(),f)}if(this.getDialogWidgets()){Kekule.ArrayUtils.remove(this.getDialogWidgets(),f)}if(this.getAutoResizeWidgets()){Kekule.ArrayUtils.remove(this.getAutoResizeWidgets(),f)}if(f===this.getCurrActiveWidget()){this.setCurrActiveWidget(null)}if(f===this.getCurrFocusedWidget()){this.setCurrFocusedWidget(null)}this.invokeEvent("widgetFinalize",{widget:f})},notifyWidgetActiveChanged:function(g,h){var f=this.getCurrActiveWidget();if(h){if(g!==f){if(f){f.setIsActive(false)}this.setCurrActiveWidget(g)}}else{if(f===g){this.setCurrActiveWidget(null)}}},notifyWidgetFocusChanged:function(g,h){var f=this.getCurrFocusedWidget();if(h){if(g!==f){if(f){f.setIsFocused(false)}this.setCurrFocusedWidget(g)}}else{if(f===g){this.setCurrFocusedWidget(null)}}},hasPopupWidgets:function(){return !!this.getPopupWidgets().length},hasDialogWidgets:function(){return !!this.getDialogWidgets().length},getBelongedResponsiveWidget:function(f){return Kekule.Widget.Utils.getBelongedResponsiveWidget(f)},notifyWidgetEventFired:function(h,f,g){var i=Object.extend({},g);i.widget=h;this.invokeEvent(f,i)},installGlobalEventHandlers:function(j){if(!this._globalEventInstalled){var h=Kekule.Widget.UiEvents;for(var g=0,f=h.length;g<f;++g){if(h[g]==="touchstart"||h[g]==="touchmove"||h[g]==="touchend"){Kekule.X.Event.addListener(j,h[g],this.reactUiEventBind,{passive:true})}else{Kekule.X.Event.addListener(j,h[g],this.reactUiEventBind)}}this._globalEventInstalled=true}},uninstallGlobalEventHandlers:function(j){var h=Kekule.Widget.UiEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.removeListener(j,h[g],this.reactUiEventBind)}},installWindowEventHandlers:function(f){Kekule.X.Event.addListener(f,"resize",this.reactWindowResizeBind)},uninstallWindowEventHandlers:function(f){Kekule.X.Event.removeListener(f,"resize",this.reactWindowResizeBind)},installGlobalHammerTouchHandlers:function(f){if(typeof(Kekule.$jsRoot.Hammer)!=="undefined"){var g=new Hammer(f);g.get("pinch").set({enable:true});g.get("rotate").set({enable:true});g.on(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind);this._hammertime=g;return g}},uninstallGlobalHammerTouchHandlers:function(f){if(this._hammertime){this._hammertime.off(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind)}},installGlobalDomMutationHandlers:function(h){var g=this;if(Kekule.X.MutationObserver){var f=new Kekule.X.MutationObserver(function(p){for(var t=0,o=p.length;t<o;++t){var n=p[t];if(n.type==="childList"){var r=n.addedNodes;for(var s=0,q=r.length;s<q;++s){var u=r[s];if(u.nodeType===Node.ELEMENT_NODE){g._handleDomAddedElem(u)}}var r=n.removedNodes;for(var s=0,q=r.length;s<q;++s){var u=r[s];if(u.nodeType===Node.ELEMENT_NODE){g._handleDomRemovedElem(u)}}}}});f.observe(h,{childList:true,subtree:true});this._domMutationObserver=f}else{this._reactDomNodeInserted=function(j){var i=j.getTarget();if(i.nodeType===(Node.ELEMENT_NODE)){g._handleDomAddedElem(i)}};this._reactDomNodeRemoved=function(j){var i=j.getTarget();if(i.nodeType===(Node.ELEMENT_NODE)){g._handleDomRemovedElem(i)}};Kekule.X.Event.addListener(h,"DOMNodeInserted",this._reactDomNodeInserted);Kekule.X.Event.addListener(h,"DOMNodeRemoved",this._reactDomNodeRemoved)}},uninstallGlobalDomMutationHandlers:function(f){if(this._domMutationObserver){this._domMutationObserver.disconnect()}if(this._reactDomNodeInserted){Kekule.X.Event.removeListener(f,"DOMNodeInserted",this._reactDomNodeInserted)}if(this._reactDomNodeRemoved){Kekule.X.Event.removeListener(f,"DOMNodeRemoved",this._reactDomNodeRemoved)}},_handleDomAddedElem:function(k){var j=Kekule.Widget.Utils.getWidgetsInsideElem(k,true);for(var h=0,g=j.length;h<g;++h){var f=j[h];f.insertedToDom()}var f=Kekule.Widget.Utils.getBelongedWidget(k);if(f){if(f.getElement()===k){f.insertedToDom()}else{f.domElemAdded(k)}}},_handleDomRemovedElem:function(k){var j=Kekule.Widget.Utils.getWidgetsInsideElem(k,true);for(var h=0,g=j.length;h<g;++h){var f=j[h];f.removedFromDom()}var f=Kekule.Widget.Utils.getBelongedWidget(k);if(f){f.domElemRemoved(k)}},isMouseEvent:function(f){return f.startsWith("mouse")||(f==="click")},isTouchEvent:function(f){return f.startsWith("touch")},isPointerEvent:function(f){return f.startsWith("pointer")},mapTouchToPointerEvent:function(p){var o=["touchstart","touchmove","touchleave","touchend","touchcancel"];var n=["pointerdown","pointermove","pointerout","pointerover","pointerup"];var r=p.getType();var k=p;k.pointerType="touch";var f;if(r==="touchstart"){f="pointerdown"}else{if(r==="touchmove"){f="pointermove"}else{if(r==="touchleave"){f="pointerout"}else{if(r==="touchend"){f="pointerup"}else{if(r==="touchcancel"){}}}}}if(f){k.setType(f);k.button=Kekule.X.Event.MouseButton.LEFT;var q=p.touches[0];var u=["clientX","clientY","pageX","pageY","screenX","screenY"];if(q){var t={};for(var m=0,j=u.length;m<j;++m){var h=u[m];k[h]=q[h];t[h]=q[h]}if(r!=="touchstart"){var s=this._document;var g=s.elementFromPoint(k.clientX,k.clientY);k.setTarget(g)}this._touchPointerMapData={positionCache:t,targetCache:k.getTarget()}}else{if(this._touchPointerMapData){for(var m=0,j=u.length;m<j;++m){var h=u[m];k[h]=this._touchPointerMapData.positionCache[h]}}k.setTarget(this._touchPointerMapData.targetCache)}return k}return null},reactUiEvent:function(n){var p=n.getType();var f;var k;if(this.getMouseCaptureWidget()&&(this.isMouseEvent(p)||this.isTouchEvent(p)||this.isPointerEvent(p))){f=this.getMouseCaptureWidget();k=true}else{var g=n.getTarget();f=this.getBelongedResponsiveWidget(g)}if(p==="touchstart"){this._touchEventSeq=["touchstart"];this._touchDoneTimeStamp=null}else{if(p==="touchcancel"){this._touchEventSeq=[]}else{if(p==="touchend"){if(this._touchEventSeq[0]==="touchstart"){this._touchEventSeq.push("touchend");this._touchDoneTimeStamp=Date.now()}}else{if(["mousedown","mouseup","mouseover","mouseout","click"].indexOf(p)>=0){if(this._touchEventSeq[0]==="touchstart"&&this._touchEventSeq[1]==="touchend"){n.ghostMouseEvent=true;if(p==="click"){this._touchEventSeq=[];this._touchDoneTimeStamp=Date.now()}}else{if(this._touchDoneTimeStamp){var i=Date.now();if(i-this._touchDoneTimeStamp<1000){n.ghostMouseEvent=true}}}}}}}var o=Kekule.Widget.getEventHandleFuncName(n.getType());if(this[o]){this[o](n)}if(f){f.reactUiEvent(n)}if(!n.ghostMouseEvent&&!Kekule.BrowserFeature.pointerEvent&&this.getEnableMouseEventToPointerPolyfill()){var q=["mousedown","mousemove","mouseout","mouseover","mouseup"];var m=["touchstart","touchmove","touchleave","touchend","touchcancel"];var j=["pointerdown","pointermove","pointerout","pointerover","pointerup"];var l=q.indexOf(p);if(l>=0){n.setType(j[l]);n.pointerType="mouse";this.reactUiEvent(n)}else{if(m.indexOf(p)>=0){var h=this.mapTouchToPointerEvent(n);if(h){this.reactUiEvent(h)}}}}},reactTouchGesture:function(h){var g=Kekule.Widget.getTouchGestureHandleFuncName((h.getType&&h.getType())||h.type);if(this[g]){this[g](h)}var f=Kekule.Widget.getBelongedWidget(h.target);if(f){f.reactTouchGesture(h)}else{}},reactWindowResize:function(j){var h=this.getAutoResizeWidgets();for(var g=0,f=h.length;g<f;++g){if(h[g].isShown()){h[g].autoResizeToClient()}}},_startPointerHolderTimer:function(g){var f=this;this._pointerHolderTimer={pointerType:g.pointerType,button:g.getButton(),coord:{x:g.getClientX(),y:g.getClientY()},target:g.getTarget(),_timeoutId:setTimeout(function(){var h=g;h.setType("pointerhold");f._pointerHolderTimer=null;f.reactUiEvent(h)},Kekule.Widget._PointerHoldParams.DURATION_THRESHOLD),cancel:function(){clearTimeout(f._pointerHolderTimer._timeoutId);f._pointerHolderTimer=null}};return this._pointerHolderTimer},react_pointerdown:function(g){if(this.hasPopupWidgets()&&!g.ghostMouseEvent){if(g.getButton()===Kekule.X.Event.MouseButton.LEFT){var f=g.getTarget();this.hidePopupWidgets(f)}}if(!this._pointerHolderTimer){this._startPointerHolderTimer(g)}else{if(g.pointerType!==this._pointerHolderTimer.pointerType||g.getButton()!==this._pointerHolderTimer.button){this._pointerHolderTimer.cancel()}}},react_pointerup:function(f){if(this._pointerHolderTimer){this._pointerHolderTimer.cancel()}},react_pointermove:function(h){if(this._pointerHolderTimer){if(h.getTarget()!==this._pointerHolderTimer.target){this._pointerHolderTimer.cancel()}else{var g=this._pointerHolderTimer.coord;var f={x:h.getClientX(),y:h.getClientY()};if(Kekule.CoordUtils.getDistance(g,f)>Kekule.Widget._PointerHoldParams.MOVEMENT_THRESHOLD){this._pointerHolderTimer.cancel()}}}},react_keydown:function(g){var f=g.getKeyCode();if(f===Kekule.X.Event.KeyCode.ESC){if(this.hasPopupWidgets()){this.hidePopupWidgets(null,true)}else{if(this.hasDialogWidgets()){this.hideTopmostDialogWidget(null,true)}}}},react_touchstart:function(g){if(this.hasPopupWidgets()){var f=g.getTarget();this.hidePopupWidgets(f)}},unpreparePopupWidget:function(f){f.setPopupCaller(null);this.restoreElem(f.getElement())},preparePopupWidget:function(g,s,u){g.setPopupCaller(s);var h=g.getElement();var E=h.ownerDocument;var A=this.getTopmostLayer(E,true);var f=h.parentNode===A;var p=Kekule.Widget.ShowHideType;var k=g.getAutoAdjustSizeOnPopup();var o;var m;if(u===p.DROPDOWN){m=Kekule.StyleUtils.isSelfOrAncestorPositionFixed(s.getElement());o=this._calcDropDownWidgetPosInfo(g,s,m)}else{o=this._calcPopupWidgetPosInfo(g,f)}if(k&&o){var B=Kekule.DocumentUtils.getClientVisibleBox((s||g).getDocument());var v=B.right-B.left;var q=B.bottom-B.top;var j=o.rect;if(j.left+j.width>v+B.left){o.width=(B.right-j.left)+"px";o.widthChanged=true}if(j.top+j.height>q+B.top){o.height=(B.bottom-j.top)+"px";o.heightChanged=true}}if(!f){this.moveElemToTopmostLayer(h)}else{this.moveElemToTopmostLayer(h,true)}if(o){var n=["left","top","right","bottom"];if(o.widthChanged){n.push("width")}if(o.heightChanged){n.push("height")}var w={};var y=h.style;if(u===p.DROPDOWN&&m){y.position="fixed"}else{if(!Kekule.StyleUtils.isAbsOrFixPositioned(h)){y.position="absolute"}}for(var x=0,t=n.length;x<t;++x){var D=n[x];var r=o[D];if(r){w[D]=y[D]||"";y[D]=r}}var z=this._getElemStoredInfo(h);z.styles=w}},_calcPopupWidgetPosInfo:function(i,h){var f;var l=Kekule.HtmlElementUtils;var g=i.getElement();var k=i.isShown();if(!k){g.style.visible="hidden";g.style.display=""}var j=l.getElemBoundingClientRect(g,true);f={rect:j};if(!h){if(Kekule.StyleUtils.getComputedStyle(g,"position")!=="fixed"){f.top=j.top+"px";f.left=j.left+"px"}}return f},_calcDropDownWidgetPosInfo:function(g,I,k){var H=Kekule.HtmlElementUtils;var B=Kekule.Widget.Position;var m=I.getDropPosition?I.getDropPosition():null;var G=I.getParent();var O=G&&G.getLayout()||Kekule.Widget.Layout.HORIZONTAL;var K=I.getElement();var N=H.getElemBoundingClientRect(K,true);var o=Kekule.DocumentUtils.getClientVisibleBox(I.getDocument());var q=g.getElement();q.style.visible="hidden";q.style.display="";var f=false;var Q=this.getTopmostLayer(q.ownerDocument);if(!q.parentNode){Q.appendChild(q);f=true}q.style.position="relative";var z=H.getElemOffsetDimension(q);var L=H.getElemScrollDimension(q);var F=H.getElemPageRect(q,true);q.style.position="absolute";if(f){Q.removeChild(q)}if(!m||m===B.AUTO){m=0;if(O===Kekule.Widget.Layout.VERTICAL){var j=N.x-o.left;var P=o.right-N.x-N.width;if(P>=z.width){m|=B.RIGHT}else{m|=(j>P)?B.LEFT:B.RIGHT}}else{var E=N.y-o.top;var n=o.bottom-N.y-N.height;if(n>=z.height){m|=B.BOTTOM}else{m|=(E>n)?B.TOP:B.BOTTOM}}}var t=Kekule.StyleUtils;var N=H.getElemBoundingClientRect(K,!k);var v=L.width;var M=L.height;var s;if(m&B.LEFT){s=N.left-F.width}else{if(m&B.RIGHT){s=N.right}else{var l=N.right-o.left;var i=o.right-N.left;if(i>=F.width){s=N.left}else{if(l>=F.width){s=N.right-F.width}else{s=Math.max(o.left,o.right-F.width)}}}}var r;if(m&B.TOP){r=N.top-F.height}else{if(m&B.BOTTOM){r=N.bottom}else{var J=N.bottom-o.top;var A=o.bottom-N.top;if(A>=F.height){r=N.bottom}else{if(J>=F.height){r=N.bottom-F.height}else{r=Math.max(o.top,o.bottom-F.height)}}}}var u={};u.rect={left:s,top:r,width:v,height:M};s+="px";r+="px";v+="px";M+="px";u.left=s;u.top=r;u.width=v;u.height=M;return u},_fillPersistentPopupWidgetsInHidden:function(f,g,j,h){h.push(f);var s,k,q;try{if(f&&f instanceof Kekule.Widget.BaseWidget){s=f.getElement();k=f.getParent();q=f.getPopupCaller()}else{if(f instanceof HTMLElement){s=f}else{s=null}}}catch(p){s=null}if(!s){return}for(var o=0,n=g.length;o<n;++o){var r=g[o];if(r===f){j.push(r)}else{var m=r.getElement();if(Kekule.DomUtils.isDescendantOf(s,m)){j.push(r)}}}if(k&&h.indexOf(k)<=0){this._fillPersistentPopupWidgetsInHidden(k,g,j,h)}if(q&&h.indexOf(q)<=0){this._fillPersistentPopupWidgetsInHidden(q,g,j,h)}},hidePopupWidgets:function(k,j){var g=this.getPopupWidgets();var n=Kekule.Widget.getBelongedWidget(k);var m=[];if(n){this._fillPersistentPopupWidgetsInHidden(n,g,m,[])}for(var f=g.length-1;f>=0;--f){var l=g[f];var h=l.getElement();if(h){if(m.indexOf(l)>=0){continue}if((!k)||((h!==k)&&(!Kekule.DomUtils.isDescendantOf(k,h)))){if(!j){l.hide()}else{l.dismiss()}}}else{Kekule.ArrayUtils.remove(this.getPopupWidgets(),l)}}},hideTopmostDialogWidget:function(j,i){var g=this.getDialogWidgets()||[];var f=g[g.length-1];if(f){var h=f.getElement();if(h){if(i){f.dismiss()}else{f.hide()}}else{Kekule.ArrayUtils.remove(this.geDialogWidgets(),f)}}},registerPopupWidget:function(f){f.addClassName(c.SHOW_POPUP);Kekule.ArrayUtils.pushUnique(this.getPopupWidgets(),f)},unregisterPopupWidget:function(f){f.removeClassName(c.SHOW_POPUP);Kekule.ArrayUtils.remove(this.getPopupWidgets(),f)},registerDialogWidget:function(f){f.addClassName(c.SHOW_DIALOG);Kekule.ArrayUtils.pushUnique(this.getDialogWidgets(),f)},unregisterDialogWidget:function(f){f.removeClassName(c.SHOW_DIALOG);Kekule.ArrayUtils.remove(this.getDialogWidgets(),f)},registerModalWidget:function(g){var f=this.getCurrModalWidget();if(f){f.removeClassName(c.SHOW_ACTIVE_MODAL)}Kekule.ArrayUtils.pushUnique(this.getModalWidgets(),g);g.addClassName(c.SHOW_ACTIVE_MODAL)},unregisterModalWidget:function(g){g.removeClassName(c.SHOW_ACTIVE_MODAL);Kekule.ArrayUtils.remove(this.getModalWidgets(),g);var f=this.getCurrModalWidget();if(f){f.addClassName(c.SHOW_ACTIVE_MODAL)}},getCurrModalWidget:function(){var f=this.getModalWidgets();if(!f||!f.length){return null}else{return f[0]}},prepareModalWidget:function(g){var i=g.getDocument();var h=this.getModalBackgroundElem();if(!h){h=i.createElement("div");h.className=c.MODAL_BACKGROUND;this.setPropStoreFieldValue("modalBackgroundElem",h)}var f=g.getElement();g.setModalInfo({oldParent:f.parentNode,oldSibling:f.nextSibling});if(f.parentNode){f.parentNode.removeChild(f)}if(h.parentNode){h.parentNode.removeChild(h)}i.body.appendChild(h);i.body.appendChild(f);this.registerModalWidget(g)},unprepareModalWidget:function(h){var j=h.getDocument();this.unregisterModalWidget(h);var g=h.getElement().parentNode;if(g){g.removeChild(h.getElement())}var l=h.getModalInfo();if(l){if(l.oldParent){l.oldParent.insertBefore(h.getElement(),l.oldSibling)}h.setModalInfo(null)}var k=this.getCurrModalWidget();var i=this.getModalBackgroundElem();if(i){if(k){if(i.parentNode){i.parentNode.removeChild(i)}var f=k.getElement().parentNode;f.insertBefore(i,k.getElement())}else{if(i.parentNode){i.parentNode.removeChild(i)}}}},registerAutoResizeWidget:function(f){Kekule.ArrayUtils.pushUnique(this.getAutoResizeWidgets(),f)},unregisterAutoResizeWidget:function(f){Kekule.ArrayUtils.remove(this.getAutoResizeWidgets(),f)},getTopmostLayer:function(g,h){var f=g.body;return f},_getElemStoredInfo:function(g){var f=null;if(g){f=g[this.INFO_FIELD];if(!f){f={};g[this.INFO_FIELD]=f}}return f},_clearElemStoredInfo:function(f){if(f[this.INFO_FIELD]){f[this.INFO_FIELD]=undefined}},moveElemToTopmostLayer:function(h,g){if(!g){var i=this._getElemStoredInfo(h);i.parentElem=h.parentNode;i.nextSibling=h.nextSibling}var f=this.getTopmostLayer(h.ownerDocument);f.appendChild(h)},restoreElem:function(j){if(!j){return}var h=this._getElemStoredInfo(j);if(!h){return}var p=h.styles;var n=Kekule.ObjUtils.getOwnedFieldNames(p);var f=j.style;for(var m=0,k=n.length;m<k;++m){var g=n[m];var o=p[g];if(o){f[g]=o}else{Kekule.StyleUtils.removeStyleProperty(f,g)}}if(h.parentElem){if(h.nextSibling){h.parentElem.insertBefore(j,h.nextSibling)}else{h.parentElem.appendChild(j)}}j[this.INFO_FIELD]=null}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.GlobalManager);Kekule.Widget.globalManager=Kekule.Widget.GlobalManager.getInstance()})();(function(){var c=function(){var k=["monospace","sans-serif","serif"];var f="mmmmmmmmmmlli";var i="72px";var g=document.getElementsByTagName("body")[0];var m=document.createElement("span");m.style.fontSize=i;m.innerHTML=f;var l={};var d={};for(var j in k){m.style.fontFamily=k[j];g.appendChild(m);l[k[j]]=m.offsetWidth;d[k[j]]=m.offsetHeight;g.removeChild(m)}function e(n){var p=false;for(var o in k){m.style.fontFamily=n+","+k[o];g.appendChild(m);var h=(m.offsetWidth!=l[k[o]]||m.offsetHeight!=d[k[o]]);g.removeChild(m);p=p||h}return p}this.detect=e};var b;Kekule.Widget.FontDetector={detect:function(e){var f=b;if(!f){f=new c();b=f}return f.detect(e)}};var a=["Arial, Helvetica, sans-serif","Georgia, Times New Roman, Times, serif","Courier New, Courier, monospace","Tahoma, Geneva, sans-serif","Trebuchet MS, Arial, Helvetica, sans-serif","Arial Black, Gadget, sans-serif","Palatino Linotype, Book Antiqua, Palatino, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","MS Serif, New York, serif","Lucida Console, Monaco, monospace","Comic Sans MS, cursive"];Kekule.Widget.FontEnumerator={getAvailableFontFamilies:function(e){if(!e){e=a}var d=[];for(var g=0,f=e.length;g<f;++g){var h=e[g];if(Kekule.Widget.FontDetector.detect(h)){d.push(h)}}return d}}})();(function(){Kekule.Widget.Clipboard=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Clipboard",STORAGE_KEY:"__$kekule_widget_clipboard__",initialize:function($super){$super();this._data=new Kekule.MapEx(true);if(Kekule.BrowserFeature.localStorage){this._crossPageStorage=window.localStorage;this.setEnableCrossPageClipboard(true);var a=this;Kekule.X.Event.addListener(window,"storage",function(d){if(a.getEnableCrossPageClipboard()){var c=d.key;var b=a._extractSessionDataType(c);if(b){a.invokeEvent("setData",{dataType:b,data:a.deserializeData(d.newValue)})}}})}},finalize:function($super){this._data.finalize();$super()},initProperties:function(){this.defineProp("enableCrossPageClipboard",{dataType:DataType.BOOL})},_useSessionClipboard:function(){return this.getEnableCrossPageClipboard()&&Kekule.BrowserFeature.localStorage},_extractSessionDataType:function(a){return(a.startsWith(this.STORAGE_KEY))?a.substr(this.STORAGE_KEY.length):null},serializeData:function(b){var a;if(DataType.isSimpleValue(b)){a=JSON.stringify(b)}else{var c={};ObjSerializerFactory.getSerializer("json").save(b,c);a=JSON.stringify(c)}return a},deserializeData:function(a){var b=JSON.parse(a);if(DataType.isSimpleValue(b)){return b}else{return ObjSerializerFactory.getSerializer("json").load(null,b)}},setData:function(a,c){if(this._useSessionClipboard()){var b=this.serializeData(c);this._crossPageStorage.setItem(this.STORAGE_KEY+a,b)}else{this._data.set(a,c)}this.invokeEvent("setData",{dataType:a,data:c});return this},getData:function(a){if(this._useSessionClipboard()){var b=this._crossPageStorage.getItem(this.STORAGE_KEY+a);return b?this.deserializeData(b):null}else{return this._data.get(a)}},hasData:function(a){return Kekule.ObjUtils.notUnset(this.getData(a))},clearData:function(){if(this._useSessionClipboard()){var c=this.getTypes();for(var b=0,a=c.length;b<a;++b){this._crossPageStorage.removeItem(this.STORAGE_KEY+c[b])}}else{this._data.clear()}this.invokeEvent("setData",{dataType:null,data:null});return this},getTypes:function(){if(this._useSessionClipboard()){var a=[];for(var e=0,b=this._crossPageStorage.length;e<b;++e){var d=this._crossPageStorage.key(e);var c=this._extractSessionDataType(d);if(c){a.push(c)}}return a}else{return this._data.getKeys()}},setObjects:function(h,d){var f=[];var g=ObjSerializerFactory.getSerializer("json");for(var c=0,a=d.length;c<a;++c){var b=d[c];var j={};g.save(b,j);f.push(j)}var e=JSON.stringify(f);return this.setData(h,e)},getObjects:function(g){var c=this.getData(g);if(DataType.isSimpleValue(c)){var e=JSON.parse(c);if(!DataType.isArrayValue(e)){e=[e]}var j=[];var f=ObjSerializerFactory.getSerializer("json");for(var d=0,a=e.length;d<a;++d){var h=e[d];var b=f.load(null,h);j.push(b)}return j}else{return c}}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.Clipboard);Kekule.Widget.clipboard=Kekule.Widget.Clipboard.getInstance()})();(function(){Kekule.Widget.EvokeMode={ALWAYS:0,EVOKEE_CLICK:1,EVOKEE_MOUSE_ENTER:2,EVOKEE_MOUSE_LEAVE:3,EVOKEE_MOUSE_DOWN:4,EVOKEE_MOUSE_UP:5,EVOKEE_MOUSE_MOVE:6,EVOKEE_TOUCH:7,EVOKER_CLICK:11,EVOKER_MOUSE_ENTER:12,EVOKER_MOUSE_LEAVE:13,EVOKER_MOUSE_DOWN:14,EVOKER_MOUSE_UP:15,EVOKER_MOUSE_MOVE:16,EVOKER_TOUCH:17,EVOKEE_TIMEOUT:21,EVOKER_TIMEOUT:22};var a=Kekule.Widget.EvokeMode;Kekule.Widget.DynamicEvokeHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DynamicEvokeHelper",evokeEvents:["click","mouseenter","mouseleave","mousedown","mouseup","touchstart"],DEF_TIMEOUT:5000,initialize:function($super,d,c,b,e,f){$super();this._timeoutRevokeHandle=null;this.reactEvokeEventsBind=this.reactEvokeEvents.bind(this);this.checkTimeoutRevokeBind=this.checkTimeoutRevoke.bind(this);this.setTimeout(f||this.DEF_TIMEOUT);this.setPropStoreFieldValue("evokeModes",b||[]);this.setPropStoreFieldValue("revokeModes",e||[]);this.linkWidgets(d,c)},finalize:function($super){this.unlinkWidgets(this.getEvokee(),this.getEvoker());$super()},initProperties:function(){this.defineProp("evokee",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("evoker",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("evokeModes",{dataType:DataType.ARRAY});this.defineProp("revokeModes",{dataType:DataType.ARRAY});this.defineProp("timeout",{dataType:DataType.INT});this.defineProp("showHideType",{dataType:DataType.INT})},evoke:function(){if(this.getEvoker()){clearTimeout(this._timeoutRevokeHandle);this.getEvoker().show(this.getEvokee(),null,this.getShowHideType());this.postponeTimeoutCheck()}},revoke:function(){if(this.getEvoker()){clearTimeout(this._timeoutRevokeHandle);var b=this.getEvoker().getDocument();b.body.focus();this.getEvoker().hide(this.getEvokee(),null,this.getShowHideType())}},doObjectChange:function($super,c){$super(c);var b=Kekule.ArrayUtils.intersect(c,["evokeModes","revokeModes"]);if(b.length>0){this.evokeModesChanged()}},linkWidgets:function(c,b){this.setPropStoreFieldValue("evokee",c);this.setPropStoreFieldValue("evoker",b);this.installEventHandlers(c,this.evokeEvents,this.reactEvokeEventsBind);this.installEventHandlers(b,this.evokeEvents,this.reactEvokeEventsBind);this.updateOnAlwaysMode()},unlinkWidgets:function(c,b){this.uninstallEventHandlers(c,this.evokeEvents,this.reactEvokeEventsBind);this.uninstallEventHandlers(b,this.evokeEvents,this.reactEvokeEventsBind)},installEventHandlers:function(f,d,e){for(var c=0,b=d.length;c<b;++c){f.addEventListener(d[c],e)}},uninstallEventHandlers:function(f,d,e){for(var c=0,b=d.length;c<b;++c){f.removeEventListener(d[c],e)}},evokeModesChanged:function(){this.updateOnAlwaysMode()},updateOnAlwaysMode:function(){if(this.getEvokeModes().indexOf(a.ALWAYS)>=0){this.evoke()}else{if(this.getRevokeModes().indexOf(a.ALWAYS)>=0){this.revoke()}}},checkTimeoutRevoke:function(j){if(!this.getEvoker()){return}var g=Kekule.DomUtils;var k=this.getEvoker().getDocument();var h=k.activeElement;var b=this.getRevokeModes();var m=[];if(b.indexOf(a.EVOKEE_TIMEOUT)>=0){m.push(this.getEvokee().getElement())}if(b.indexOf(a.EVOKER_TIMEOUT)>=0){m.push(this.getEvoker().getElement())}var f=false;for(var e=0,d=m.length;e<d;++e){var c=m[e];if((h===c)||g.isDescendantOf(h,c)){f=true;break}}if(f){this.postponeTimeoutCheck()}else{this.revoke()}},postponeTimeoutCheck:function(){if(this.hasTimeoutMode(this.getRevokeModes())){if(this.getEvokeModes().indexOf(a.ALWAYS)>=0){return}else{this._timeoutRevokeHandle=setTimeout(this.checkTimeoutRevokeBind,this.getTimeout())}}},hasTimeoutMode:function(b){return Kekule.ArrayUtils.intersect([a.EVOKEE_TIMEOUT,a.EVOKER_TIMEOUT],b).length>0},getEventTypeOfMode:function(b){switch(b){case a.EVOKEE_CLICK:case a.EVOKER_CLICK:return"click";case a.EVOKEE_MOUSE_ENTER:case a.EVOKER_MOUSE_ENTER:return"mouseenter";case a.EVOKEE_MOUSE_LEAVE:case a.EVOKER_MOUSE_LEAVE:return"mouseleave";case a.EVOKEE_MOUSE_DOWN:case a.EVOKER_MOUSE_DOWN:return"mousedown";case a.EVOKEE_MOUSE_UP:case a.EVOKER_MOUSE_UP:return"mouseup";case a.EVOKEE_MOUSE_MOVE:case a.EVOKER_MOUSE_MOVE:return"mousemove";case a.EVOKEE_TOUCH:case a.EVOKER_TOUCH:return"touchstart"}},isEvokeTargetOnEvokee:function(b){return(b>=a.EVOKEE_CLICK)&&(b<=a.EVOKEE_TOUCH)},reactEvokeEvents:function(h){var k=h.htmlEvent.getType();var g=h.target;if((g!==this.getEvokee())&&(g!==this.getEvoker())){return}var d=(h.target===this.getEvokee());var j=!this.getEvoker().isShown();if(j){if((this.getRevokeModes().indexOf(a.ALWAYS)>=0)){return}var f=this.getEvokeModes();for(var c=0,b=f.length;c<b;++c){if(d===this.isEvokeTargetOnEvokee(f[c])&&(k===this.getEventTypeOfMode(f[c]))){this.evoke();return}}}else{if(this.getEvokeModes().indexOf(a.ALWAYS)>=0){return}var f=this.getRevokeModes();for(var c=0,b=f.length;c<b;++c){if(d===this.isEvokeTargetOnEvokee(f[c])&&(k===this.getEventTypeOfMode(f[c]))){this.revoke();return}}}}})})();(function(){var c=Kekule.HtmlElementUtils;Kekule.Widget.StyleResource=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.StyleResource",initialize:function($super,f,e){$super();this.setPropStoreFieldValue("name",f);if(e){this.setCssClassName(e)}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,setter:null});this.defineProp("cssClassName",{dataType:DataType.STRING})},linkTo:function(e){c.addClass(this._getElement(e),this.getCssClassName());return this},unlinkFrom:function(e){c.removeClass(this._getElement(e),this.getCssClassName())},_getElement:function(e){if(e instanceof Kekule.Widget.BaseWidget){return e.getElement()}else{return e}}});Kekule.Widget.StyleResourceManager={_resources:{},register:function(f){var e=f.getName();if(e){d._resources[e]=f}return d},unregister:function(f){var e;if(typeof(f)==="string"){e=f}else{if(f.getName){e=f.getName()}}if(e){delete d._resources[e]}return d},getResource:function(e){return d._resources[e]}};Kekule.Widget.StyleResourceNames={PREFIX:"$$",CURSOR_ROTATE:"$$cursor_rotate",CURSOR_ROTATE_NE:"$$cursor_rotate_ne",CURSOR_ROTATE_NW:"$$cursor_rotate_nw",CURSOR_ROTATE_SE:"$$cursor_rotate_se",CURSOR_ROTATE_SW:"$$cursor_rotate_sw",ICON_COLOR_PICK:"$$icon_color_pick",ICON_COLOR_NOTSET:"$$icon_color_default",ICON_COLOR_MIXED:"$$icon_color_mixed",BUTTON_YES_OK:"$$btn_yes_ok",BUTTON_NO_CANCEL:"$$btn_no_cancel",BUTTON_LOAD_FILE:"$$btn_load_file",ICON_REMOVE:"$$icon_remove"};var d=Kekule.Widget.StyleResourceManager;var b=Kekule.Widget.StyleResource;var a=Kekule.Widget.StyleResourceNames;d.register(new b(a.CURSOR_ROTATE,"K-Res-Cursor-Rotate"));d.register(new b(a.CURSOR_ROTATE_NE,"K-Res-Cursor-Rotate-NE"));d.register(new b(a.CURSOR_ROTATE_NW,"K-Res-Cursor-Rotate-NW"));d.register(new b(a.CURSOR_ROTATE_SE,"K-Res-Cursor-Rotate-SE"));d.register(new b(a.CURSOR_ROTATE_SW,"K-Res-Cursor-Rotate-SW"));d.register(new b(a.ICON_COLOR_PICK,"K-Res-Icon-Color-Pick"));d.register(new b(a.ICON_COLOR_NOTSET,"K-Res-Icon-Color-NotSet"));d.register(new b(a.ICON_COLOR_MIXED,"K-Res-Icon-Color-Mixed"));d.register(new b(a.BUTTON_YES_OK,"K-Res-Button-YesOk"));d.register(new b(a.BUTTON_NO_CANCEL,"K-Res-Button-NoCancel"));d.register(new b(a.BUTTON_LOAD_FILE,"K-Res-Button-LoadFile"));d.register(new b(a.ICON_REMOVE,"K-Res-Icon-Remove"))})();(function(){var c=Kekule.DomUtils;var a=Kekule.ArrayUtils;Kekule.Widget.AutoLauncher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.AutoLauncher",WIDGET_ATTRIB:"data-widget",WIDGET_ATTRIB_ALT:"data-kekule-widget",PLACEHOLDER_ATTRIB:"data-placeholder",FIELD_PARENT_WIDGET_ELEM:"__$kekule_parent_widget_elem$__",initialize:function($super){$super();this._executingFlag=0;this._pendingWidgetRefMap=new Kekule.MapEx(true);this._pendingElems=[];this._handlingPendings=false;this._execOnPendingBind=this._execOnPending.bind(this);var e=this;Kekule.Widget.Utils._setWidgetRefPropFromId=function(i,h,j){if(j){var f=Kekule.Widget.getWidgetById(j,i.getDocument());if(f){i.setPropValue(h,f)}else{var g=i.getDocument().getElementById(j);if(g&&e.isExecuting()){e.addPendingWidgetRefItem(g,i,h)}}}}},finalize:function($super){this._pendingElems=null;this._pendingWidgetRefMap=null;$super()},getPendingElems:function(){return this._pendingElems},addPendingElem:function(h,g,f,i,e){this._pendingElems.push({doc:h,elem:g,parent:f,widgetClass:i,execOnChildren:e})},handlePendingElems:function(f){if(!this._handlingPendings){this._handlingPendings=true;if(f){var e=this._pendingElems;e.push({callback:f})}this.beginExec();setTimeout(this._execOnPendingBind,0)}},_execOnPending:function(){var e=this._pendingElems.shift();if(!e){this._handlingPendings=false;this.endExec()}else{try{if(e.elem){this.createWidgetOnElem(e.doc,e.elem,e.parent)}else{if(e.callback){setTimeout(e.callback,0)}}}finally{setTimeout(this._execOnPendingBind,0)}}},getPendingWidgetRefMap:function(){return this._pendingWidgetRefMap},addPendingWidgetRefItem:function(e,g,f){this._pendingWidgetRefMap.set(e,{widget:g,propName:f})},removePendingWidgetRefItem:function(e){this._pendingWidgetRefMap.remove(e)},handlePendingWidgetRef:function(){var k=this._pendingWidgetRefMap.getKeys();for(var g=0,e=k.length;g<e;++g){var j=k[g];var f=Kekule.Widget.getWidgetOnElem(j);if(f){var h=this._pendingWidgetRefMap.get(j);h.widget.setPropValue(h.propName,f)}this.removePendingWidgetRefItem(j)}},beginExec:function(){++this._executingFlag},endExec:function(){if(this._executingFlag>0){--this._executingFlag}if(this._executingFlag<=0){this.handlePendingWidgetRef()}},isExecuting:function(){return this._executingFlag>0},execute:function(f,g,h){var e=Kekule.ObjUtils.notUnset(g)?g:Kekule.Widget.AutoLauncher.deferring;if(!e){this.beginExec()}try{if(typeof(f.querySelector)==="function"){this.executeOnElemBySelector(f.ownerDocument,f,null,e)}else{this.executeOnElem(f.ownerDocument,f,null,e)}if(e){this.handlePendingElems(h)}}finally{if(!e){this.endExec();if(h){h()}}}},executeOnElem:function(p,j,q,r){if(!this.isElemLaunchable(j)){return}var n=null;var h=this.getElemWidgetClass(j);var o=q;if(r){if(h){this.addPendingElem(p,j,q,h,false);o=j}}else{var e=q;if(e&&!(e instanceof Kekule.Widget.BaseWidget)){e=Kekule.Widget.getWidgetOnElem(q)}n=this.createWidgetOnElem(p,j,e,h);if(n){o=n}else{o=j}}var s=(r&&!h)||(!r&&!n)||Kekule.Widget.AutoLauncher.enableCascadeLaunch;if(s){var g=c.getDirectChildElems(j);for(var m=0,k=g.length;m<k;++m){var f=g[m];this.executeOnElem(p,f,o,r)}}},executeOnElemBySelector:function(p,g,f,r){var m="["+this.WIDGET_ATTRIB+"],["+this.WIDGET_ATTRIB_ALT+"]";var e=g.querySelectorAll(m);var k=this.getElemWidgetClass(g);if(k){e=Array.prototype.slice.call(e);e.unshift(g)}if(e&&e.length){for(var n=0,j=e.length;n<j;++n){var h=e[n];var o=this._findParentCandidateElem(h,e,0,n-1);if(o){h[this.FIELD_PARENT_WIDGET_ELEM]=o}}for(var n=0,j=e.length;n<j;++n){var h=e[n];if(!this.isElemLaunchable(h)){continue}var q=h[this.FIELD_PARENT_WIDGET_ELEM]||null;if(Kekule.Widget.AutoLauncher.enableCascadeLaunch||!q){if(r){this.addPendingElem(p,h,q,null,false)}else{this.createWidgetOnElem(p,h,q)}}}}},_findParentCandidateElem:function(k,f,j,l){var e=null;var h=k.parentNode;while(h&&!e){for(var g=l;g>=j;--g){if(h===f[g]){e=f[g];return e}}if(!e){h=h.parentNode}}return e},createWidgetOnElem:function(l,i,m,g){var n=null;var h=Kekule.Widget.getWidgetOnElem(i);if(h){return h}if(!g){g=this.getElemWidgetClass(i)}if(g){var e=Kekule.Widget.AutoLauncher;var k=false;if(e.placeHolderStrategy!==e.PlaceHolderStrategies.DISABLED){var j=i.getAttribute(this.PLACEHOLDER_ATTRIB)||"";k=((e.placeHolderStrategy===e.PlaceHolderStrategies.EXPLICIT)&&Kekule.StrUtils.strToBool(j))||(e.placeHolderStrategy===e.PlaceHolderStrategies.IMPLICIT);k=k&&ClassEx.getPrototype(g).canUsePlaceHolderOnElem(i)}if(k){n=new Kekule.Widget.PlaceHolder(i,g)}else{n=new g(i)}if(n){var f=m;if(f&&!(f instanceof Kekule.Widget.BaseWidget)){f=Kekule.Widget.getWidgetOnElem(m)}if(f){n.setParent(f)}}}return n},isElemLaunchable:function(e){if(e.isContentEditable&&!Kekule.Widget.AutoLauncher.enableOnEditable){return false}else{return true}},getElemWidgetClass:function(g){var e=null;var f=g.getAttribute(this.WIDGET_ATTRIB);if(!f){f=g.getAttribute(this.WIDGET_ATTRIB_ALT)}if(f){e=this.getWidgetClass(f)}return e},getWidgetClass:function(e){return ClassEx.findClass(e)}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.AutoLauncher);Kekule.Widget.autoLauncher=Kekule.Widget.AutoLauncher.getInstance();Kekule.Widget.AutoLauncher.PlaceHolderStrategies={DISABLED:"disabled",IMPLICIT:"implicit",EXPLICIT:"explicit"};Kekule.Widget.AutoLauncher.enabled=true;Kekule.Widget.AutoLauncher.enableCascadeLaunch=true;Kekule.Widget.AutoLauncher.enableDynamicDomCheck=true;Kekule.Widget.AutoLauncher.enableOnEditable=false;Kekule.Widget.AutoLauncher.placeHolderStrategy=Kekule.Widget.AutoLauncher.PlaceHolderStrategies.EXPLICIT;Kekule.Widget.AutoLauncher.deferring=false;Kekule.Widget.WidgetsReady={isReady:false,funcs:[],ready:function(e){if(b.isReady){e()}else{b.funcs.push(e)}},fireReady:function(){if(b.isReady){return}b.isReady=true;var e=b.funcs;while(e.length){var f=e.shift();f()}}};var b=Kekule.Widget.WidgetsReady;Kekule.Widget.ready=b.ready;var d=function(){if(d.done){return}if(!Kekule._isLoaded()){Kekule._registerAfterLoadSysProc(d);return}var g=Kekule.Widget.AutoLauncher.deferring?function(){Kekule.X.DomReady.resume()}:null;var e=function(){try{b.fireReady()}finally{if(g){g()}}};if(Kekule.Widget.AutoLauncher.enabled){if(Kekule.Widget.AutoLauncher.deferring){Kekule.X.DomReady.suspend()}Kekule.Widget.autoLauncher.execute(document.body,null,e)}else{e()}if(Kekule.X.MutationObserver){var f=new Kekule.X.MutationObserver(function(o){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck&&Kekule.Widget.AutoLauncher.enabled){for(var s=0,n=o.length;s<n;++s){var h=o[s];if(h.type==="childList"){var r=h.addedNodes;for(var q=0,p=r.length;q<p;++q){var t=r[q];if(t.nodeType===Node.ELEMENT_NODE){Kekule.Widget.autoLauncher.execute(t)}}}}}});f.observe(document.body,{childList:true,subtree:true})}else{Kekule.X.Event.addListener(document,"DOMNodeInserted",function(i){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck&&Kekule.Widget.AutoLauncher.enabled){var h=i.getTarget();if(h.nodeType===(Node.ELEMENT_NODE||1)){Kekule.Widget.autoLauncher.execute(h)}}})}d.done=true};Kekule.X.domReady(d)})();(function(){var b=Kekule.Widget.Direction;SU=Kekule.StyleUtils;Kekule.Widget.BaseTransition=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseTransition",initialize:function($super){$super()},initProperties:function(){this.defineProp("element",{dataType:DataType.OBJECT,serializable:false});this.defineProp("caller",{dataType:DataType.OBJECT,serializable:false})},canExecute:function(d,c){return true},prepare:function(e,d,c){},finish:function(e,d,c){},execute:function(h,g,j,f){this.setElement(h);if(g){this.setCaller(g)}var i=Object.extend({from:0,to:1},f);var e=this;var d=function(){if(d.__$applied__){return}d.__$applied__=true;e.finish(h,g,i);if(j){j()}};d.__$applied__=false;this.prepare(h,g,i);var e=this;var c={element:h,caller:g,callback:j,doneCallback:d,options:f,executor:this,halt:function(){e.halt(c)}};this.doExecute(h,g,d,i);return c},doExecute:function(e,d,f,c){},halt:function(c){if(c.executor!==this){c.executor.halt(c)}else{this.doHalt(c);if(c.doneCallback){c.doneCallback()}}},doHalt:function(c){},setElementProp:function(e,c,d){}});Kekule.Widget.Css3Transition=Class.create(Kekule.Widget.BaseTransition,{CLASS_NAME:"Kekule.Widget.Css3Transition",initialize:function($super){$super()},initProperties:function(){this.defineProp("cssProperty",{dataType:DataType.STRING});this.defineProp("timingFunc",{dataType:DataType.STRING})},getAffectedCssPropNames:function(c){},getTransCssPropNames:function(c){},storeCssInlineValues:function(g,j){var h=g.style;var c={};for(var f=0,d=j.length;f<d;++f){var e=j[f];c[e]=h[e]}return c},restoreCssInlineValues:function(g,m,k){var h=g.style;for(var f=0,c=m.length;f<c;++f){var d=m[f];if(!k[d]){try{h.removeProperty(d)}catch(j){h[d]=""}}else{h[d]=k[d]}}},storeCssComputedValues:function(g,j){var c={};for(var f=0,d=j.length;f<d;++f){var e=j[f];var h=SU.getComputedStyle(g,e);c[e]=h}return c},canExecute:function(d,c){return Kekule.BrowserFeature.cssTransition},isSupported:function(){return Kekule.BrowserFeature.cssTransition},isAppear:function(c){return !!c.isAppear},isDisappear:function(c){return !!c.isDisappear},setTransitionProp:function(g,f,e){var h=["Moz"+f.capitalizeFirst(),"Webkit"+f.capitalizeFirst(),f];for(var d=0,c=h.length;d<c;++d){g[h[d]]=e}},getOriginCssInlineValues:function(){return this._originCssInlineValues},getComputedCssValues:function(){return this._computedCssValues},prepare:function(f,e,d){this.setCssProperty(this.getTransCssPropNames(d).join(","));var c=this.getAffectedCssPropNames(d);this._affectedCssPropNames=c;this._originCssInlineValues=this.storeCssInlineValues(f,c);this._computedCssValues=this.storeCssComputedValues(f,c)},finish:function(e,d,c){if((c.to===1)||this.isAppear(c)||this.isDisappear(c)){this.restoreCssInlineValues(e,this._affectedCssPropNames,this._originCssInlineValues)}},doExecute:function(g,d,l,p){var h=Kekule.StyleUtils;var c=g.style;var j=this.isAppear(p);var k=this.isDisappear(p);if(this.isSupported()){this.setElementProp(g,p.from,p);if(!h.isDisplayed(g)){h.setDisplay(g,true)}if(!h.isVisible(g)){h.setVisibility(g,true)}var o=this.getCssProperty();this.setTransitionProp(c,"transitionProperty",o);o=this.getTimingFunc();if(o){this.setTransitionProp(c,"transitionTimingFunction",o)}o=p.duration.toString()+"ms";this.setTransitionProp(c,"transitionDuration",o);var n;var m=this;var f=function(q){Kekule.X.Event.removeListener(g,"transitionend",f);m.setTransitionProp(c,"transition","");if(n){clearTimeout(n)}if(l){l()}};this._currEventHandler=f;Kekule.X.Event.addListener(g,"transitionend",f);n=setTimeout(f,p.duration+100);setTimeout(function(){m.setElementProp(g,p.to,p)},0)}else{try{this.setElementProp(g,p.to,p)}catch(i){}if(l){setTimeout(l,0)}}},doHalt:function(c){var d=c.element;if(d){this.setTransitionProp(d.style,"transitionProperty","none")}}});Kekule.Widget.Css3OpacityTrans=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3OpacityTrans",canExecute:function($super,d,c){return !!Kekule.BrowserFeature.cssTranform},getAffectedCssPropNames:function(c){return["opacity"]},getTransCssPropNames:function(c){return["opacity"]},setElementProp:function(e,c,d){var f=parseFloat(this._computedCssValues.opacity)||1;e.style.opacity=f*c}});Kekule.Widget.Css3SlideTransition=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3SlideTransition",initialize:function($super,c){$super();if(Kekule.ObjUtils.notUnset(c)){this.setDirection(c)}},initProperties:function(){this.defineProp("direction",{dataType:DataType.INT})},canExecute:function($super,d,c){return true},prepare:function($super,e,d,c){SU.setDisplay(e,true);this._direction=this.getActualDirection(e,c);$super(e,d,c);e.style.overflow="hidden";this._clearDimesionConstraints(e)},_clearDimesionConstraints:function(d){var c=d.style;c.minWidth="0";c.minHeight="0";c.maxWidth="none";c.maxHeight="none"},setElementProp:function(d,e,k){var f=this._direction;var j;if(b.isInHorizontal(f)){j=this.getComputedCssValues().width;var i=SU.analysisUnitsValue(j);d.style.width=i.value*e+i.units;j=this.getComputedCssValues().left;if(j){var c=SU.analysisUnitsValue(j);if(c.units===i.units){d.style.left=(i.value*(1-e)+c.value)+c.units}}}if(b.isInVertical(f)){j=this.getComputedCssValues().height;var g=SU.analysisUnitsValue(j);d.style.height=g.value*e+g.units;j=this.getComputedCssValues().top;if(j){var h=SU.analysisUnitsValue(j);if(h.units===g.units){d.style.top=(g.value*(1-e)+h.value)+h.units}}}},getAffectedCssPropNames:function(d){var c=[].concat(this.getTransCssPropNames(d));c=c.concat(["overflow","min-width","min-height","max-width","max-height"]);return c},getTransCssPropNames:function(d){var e=this.getActualDirection(this.getElement(),d);var c=[];if(b.isInHorizontal(e)){c.push("width");if(e&b.RTL){c.push("left")}}if(b.isInVertical(e)){c.push("height");if(e&b.BTT){c.push("top")}}return c},getRefRect:function(d){var c;var e=Kekule.HtmlElementUtils;if(this.getCaller()){c=e.getElemPageRect(this.getCaller());if(Kekule.RectUtils.isZero(c)){c=(d||{}).callerPageRect||null}}else{c=null}return c},getActualDirection:function(k,i){if(!k){k=this.getElement()}var c=Kekule.Widget.Direction;var j=Kekule.HtmlElementUtils;var o=this.getDirection();if(!o||(o===c.AUTO)){var d=this.getRefRect(i);if(!d){o=c.TTB}else{var m={x:d.x+d.width/2,y:d.y+d.height/2};var e=j.getElemPagePos(k);var l=j.getElemClientDimension(k);var f={x:e.x+(l.width||0)/2,y:e.y+(l.height||0)/2};var n=Kekule.CoordUtils.substract(f,m);if(d.width<1){o=(n.x>=0)?c.LTR:c.RTL}else{if(n.x<1){o=(n.y>=0)?c.TTB:c.BTT}else{var h=Math.abs(d.height/d.width);var g=Math.abs(n.y/n.x);if(h>g){o=(n.x>=0)?c.LTR:c.RTL}else{o=(n.y>=0)?c.TTB:c.BTT}}}}}return o}});Kekule.Widget.Css3GrowTransition=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3GrowTransition",initialize:function($super,c){$super();if(c){if(c.ownerDocument){this.setBaseElement(c)}else{this.setCaller(c)}}},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(d){var e=Kekule.HtmlElementUtils;var c=null;if(this.getBaseRect()){c=this.getBaseRect()}else{if(this.getCaller()){c=e.getElemBoundingClientRect(this.getCaller(),true);if(Kekule.RectUtils.isZero(c)){c=(d||{}).callerPageRect||null}}}if(!c){c={x:0,y:0,width:0,height:0}}return c},canExecute:function($super,d,c){return true},prepare:function($super,f,e,d){SU.setDisplay(f,true);$super(f,e,d);f.style.overflow="hidden";Kekule.HtmlElementUtils.makePositioned(f);var c=this.getRefRect(d);var h=Kekule.HtmlElementUtils;var g=h.getElemBoundingClientRect(f,true);var i={x:g.x-c.x,y:g.y-c.y,width:g.width-c.width,height:g.height-c.height};this._delta=i;this._clearDimesionConstraints(f)},_clearDimesionConstraints:function(d){var c=d.style;c.minWidth="0";c.minHeight="0";c.maxWidth="none";c.maxHeight="none"},setElementProp:function(e,c,d){var j=this.getComputedCssValues();var i=this._delta;var g=1-c;var f=e.style;var h=SU.analysisUnitsValue(j.left);if(h.units==="px"){f.left=(h.value-g*i.x)+"px"}var h=SU.analysisUnitsValue(j.top);if(h.units==="px"){f.top=(h.value-g*i.y)+"px"}var h=SU.analysisUnitsValue(j.width);if(h.units==="px"){f.width=(h.value-g*i.width)+"px"}var h=SU.analysisUnitsValue(j.height);if(h.units==="px"){f.height=(h.value-g*i.height)+"px"}},getAffectedCssPropNames:function(d){var c=[].concat(this.getTransCssPropNames(d));c=c.concat(["overflow","min-width","min-height","max-width","max-height"]);return c},getTransCssPropNames:function(c){return["left","top","width","height","position"]}});if(Kekule.BrowserFeature&&Kekule.BrowserFeature.cssTranform){Kekule.Widget.Css3TransformTrans=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3TransformTrans",getAffectedCssPropNames:function(c){return["transform","transformOrigin"]},getTransCssPropNames:function(c){return["transform","transformOrigin"]},prepare:function($super,f,e,d){$super(f,e,d);var c=Kekule.StyleUtils.getTransformMatrixValues(f);if(c){c.scaleX=c.a;c.scaleY=c.d}this._computedTransMatrixInfo=c},setElemTransform:function(f,d,c,h,g){var e=[h,0,0,g,d,c];Kekule.StyleUtils.setTransformMatrixArrayValues(f,e)}});Kekule.Widget.Css3TransformGrowTransition=Class.create(Kekule.Widget.Css3TransformTrans,{CLASS_NAME:"Kekule.Widget.Css3TransformGrowTransition",initialize:function($super,c){$super();if(c){if(c.ownerDocument){this.setBaseElement(c)}else{this.setCaller(c)}}},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(d){var e=Kekule.HtmlElementUtils;var c=null;if(this.getBaseRect()){c=this.getBaseRect()}else{if(this.getCaller()){c=e.getElemBoundingClientRect(this.getCaller(),true);if(Kekule.RectUtils.isZero(c)){c=(d||{}).callerPageRect||null}}}if(!c){c={x:0,y:0,width:0,height:0}}return c},prepare:function($super,f,e,d){SU.setDisplay(f,true);$super(f,e,d);f.style.overflow="hidden";Kekule.HtmlElementUtils.makePositioned(f);var c=this.getRefRect(d);var i=Kekule.HtmlElementUtils;var g=i.getElemBoundingClientRect(f,true);var h={x:g.x-c.x,y:g.y-c.y};this._translateDelta=h;this._initialScale={x:c.width/g.width,y:c.height/g.height};if(this._computedTransMatrixInfo){this._endScale={x:this._computedTransMatrixInfo.scaleX,y:this._computedTransMatrixInfo.scaleY};this._endTranslate={x:this._computedTransMatrixInfo.tx,y:this._computedTransMatrixInfo.ty}}else{this._endScale={x:1,y:1};this._endTranslate={x:0,y:0}}},setElementProp:function(h,j,l){var c=this.getComputedCssValues();var f=this._translateDelta;var g=this._initialScale;var e=this._endScale;var i={x:this._endTranslate.x-(1-j)*f.x,y:this._endTranslate.y-(1-j)*f.y};var k={x:j*e.x+(1-j)*g.x,y:j*e.y+(1-j)*g.y};var d=h.style;d.transformOrigin="0 0 0";this.setElemTransform(h,i.x,i.y,k.x,k.y)}})}Kekule.Widget.Css3TransitionSimpleClassCreator={create:function(g,e,d,f){var c=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:g,initialize:function($super){$super();this.setCssProperty(e);this.setTimingFunc(d)}});if(f){c=ClassEx.extend(c,f)}return c}};var a=Kekule.Widget.Css3TransitionSimpleClassCreator})();(function(){SU=Kekule.StyleUtils;Kekule.Widget.ShowHideManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideManager",initialize:function($super){$super();this.setEnableTransition(true);this.setShowDuration(450);this.setHideDuration(450)},initProperties:function(){this.defineProp("enableTransition",{dataType:DataType.BOOL});this.defineProp("transitionSelector",{dataType:"Kekule.Widget.ShowHideTransitionSelector",serializable:false});this.defineProp("showDuration",{dataType:DataType.INT});this.defineProp("hideDuration",{dataType:DataType.INT})},_getCallerElement:function(c){if(!c){return null}else{return c.getElement?c.getElement():Kekule.DomUtils.isElement(c)?c:null}},isUsingTransition:function(){return this.getEnableTransition()&&this.getTransitionSelector()},selectTransition:function(g,f,e){var d=this.getTransitionSelector();if(!d){return null}else{var c=d.selectTransition(g,f,e);if(c&&f){c.setCaller(this._getCallerElement(f))}}return c},show:function(h,e,j,i,g){var f=Object.extend(g||{},{from:0,to:1,isAppear:true,duration:this.getShowDuration()});var c=this.selectTransition(h,e,i);if(c&&this.isUsingTransition()&&c.canExecute(h.getElement(),f)){var d=function(k){h.setVisible(true,true);h.setDisplayed(true,true);if(j){j()}};return c.execute(h.getElement(),this._getCallerElement(e),d,f)}else{h.setVisible(true,true);h.setDisplayed(true,true);if(j){j()}}return null},hide:function(h,c,j,e,i,f){var d=Object.extend(f,{from:1,to:0,isDisappear:true,duration:this.getHideDuration()});var i=!!f.useVisible;var k=this.selectTransition(h,c,e);if(k&&this.isUsingTransition()&&k.canExecute(h.getElement(),d)){var g=function(){if(h){if(i){h.setVisible(false,true)}else{h.setDisplayed(false,true)}}if(j){j()}};return k.execute(h.getElement(),this._getCallerElement(c),g,d)}else{if(i){h.setVisible(false,true)}else{h.setDisplayed(false,true)}if(j){j()}}return null}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.ShowHideManager);Kekule.Widget.showHideManager=Kekule.Widget.ShowHideManager.getInstance();Kekule.Widget.ShowHideTransitionSelector=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideTransitionSelector",initialize:function($super){$super();this.setTransitionClassMap({})},initProperties:function(){this.defineProp("transitionClassMap",{dataType:DataType.OBJECT,serializable:false})},_getTransClassOfType:function(c){var d=this.getTransitionClassMap();return d[c]||d[Kekule.Widget.ShowHideType.DEFAULT]},addTransitionClass:function(c,d){this.getTransitionClassMap()[c]=d},selectTransition:function(g,d,c){var f;var e=Kekule.Widget.ShowHideType;if(d){f=this._getTransClassOfType(c)}else{f=this._getTransClassOfType(Kekule.Widget.ShowHideType.DEFAULT)}if(f){return new f()}else{return null}}});var b=new Kekule.Widget.ShowHideTransitionSelector();var a=Kekule.Widget.ShowHideType;b.addTransitionClass(a.DEFAULT,Kekule.Widget.Css3OpacityTrans);b.addTransitionClass(a.DROPDOWN,Kekule.Widget.Css3SlideTransition);b.addTransitionClass(a.POPUP,Kekule.Widget.Css3TransformGrowTransition||Kekule.Widget.Css3GrowTransition);b.addTransitionClass(a.DIALOG,Kekule.Widget.Css3TransformGrowTransition||Kekule.Widget.Css3GrowTransition);Kekule.Widget.showHideManager.setTransitionSelector(b)})();(function(){var c=Kekule.HtmlElementUtils;var b=Kekule.X.Event;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{RESIZEGRIPPER:"K-Resize-Gripper"});var d=Class.PropertyScope;Kekule.Widget.ResizeGripper=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ResizeGripper",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,f){this.reactMousemoveBind=this.reactMousemove.bind(this);this.reactMouseupBind=this.reactMouseup.bind(this);this.reactTouchmoveBind=this.reactTouchmove.bind(this);this.reactTouchendBind=this.reactTouchend.bind(this);$super(f);if(!this.getTarget()){if(this.getParent()){this.setTarget(this.getParent())}else{var e=this.getElement().parentNode;if(e){this.setTarget(e)}}}},initProperties:function(){this.defineProp("target",{dataType:DataType.OBJECT,serializable:false,setter:function(e){if(this.getTarget()!==e){this.setPropStoreFieldValue("target",e);this.targetChanged(e)}}});this.defineProp("retainAspectRatio",{dataType:DataType.BOOL});this.defineProp("isUnderResizing",{dataType:DataType.BOOL,serializable:false,setter:null,scope:d.PRIVATE});this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:false,scope:d.PRIVATE});this.defineProp("baseDimension",{dataType:DataType.HASH,serializable:false,scope:d.PRIVATE});this.defineProp("baseAspectRatio",{dataType:DataType.FLOAT,serializable:false,scope:d.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+a.RESIZEGRIPPER},doCreateRootElement:function(f){var e=f.createElement("span");return e},targetChanged:function(f){var e;if(this.targetIsWidget(f)){e=f.getResizerElement?f.getResizerElement():f.getCoreElement()}else{e=f}if(e){this.appendToElem(e)}},targetIsWidget:function(e){return e instanceof Kekule.Widget.BaseWidget},getTargetDimension:function(f){var e=f||this.getTarget();if(this.targetIsWidget(e)){return e.getDimension()}else{return Kekule.HtmlElementUtils.getElemPageRect(e,true)}},setTargetDimension:function(i,g,e){var h=i||this.getTarget();if(this.targetIsWidget(h)){h.setDimension(g,e)}else{var f=h.style;f.width=g+"px";f.height=e+"px"}},prepareResizing:function(f,g){if(!this.getIsUnderResizing()){var e=this._getMoveEventReceiverElem(this.getElement());this._installEventHandlers(e);this._setMouseCapture(this.getElement(),true,g);this.setBaseCoord(f);var h=this.getTargetDimension();this.setBaseDimension(h);this.setBaseAspectRatio(h.width/h.height);this.setPropStoreFieldValue("isUnderResizing",true)}},doneResizing:function(f){this._setMouseCapture(this.getElement(),false,f);var e=this._getMoveEventReceiverElem(this.getElement());this._uninstallEventHandlers(e);this.setBaseCoord(null);this.setBaseDimension(null);this.setPropStoreFieldValue("isUnderResizing",false)},resizeTo:function(j){var k=Kekule.CoordUtils.substract(j,this.getBaseCoord());var e=this.getBaseDimension();var f=e.width+k.x;var i=e.height+k.y;if(this.getRetainAspectRatio()){var g=this.getBaseAspectRatio();if(f/i>g){f=g*i}else{if(f/i<g){i=f/g}}}this.setTargetDimension(this.getTarget(),f,i)},reactMousemove:function(f){if(this.getIsUnderResizing()){var g={x:f.getScreenX(),y:f.getScreenY()};this.resizeTo(g);f.stopPropagation();f.preventDefault()}},reactMouseup:function(f){if(f.getButton()===Kekule.X.Event.MouseButton.LEFT){if(this.getIsUnderResizing()){this.doneResizing(f);f.preventDefault()}}},reactTouchmove:function(f){if(this.getIsUnderResizing()){var g={x:f.getScreenX(),y:f.getScreenY()};this.resizeTo(g);f.stopPropagation();f.preventDefault()}},reactTouchend:function(f){if(this.getIsUnderResizing()){this.doneResizing(f);f.preventDefault()}},_elemSupportCapture:function(e){return !!e.setCapture},_setMouseCapture:function(g,e,f){if(g){if(e){if(g.setCapture){g.setCapture(true)}if(g.setPointerCapture){if(Kekule.ObjUtils.notUnset(f.pointerId)){g.setPointerCapture(f.pointerId)}}}else{if(g.releaseCapture){g.releaseCapture()}if(g.releasePointerCapture){if(Kekule.ObjUtils.notUnset(f.pointerId)){g.releasePointerCapture(f.pointerId)}}}}},_getMoveEventReceiverElem:function(e){return(this._elemSupportCapture(e))?e:e.ownerDocument.documentElement},_installEventHandlers:function(e){b.addListener(e,"mousemove",this.reactMousemoveBind);b.addListener(e,"touchmove",this.reactTouchmoveBind);b.addListener(e,"mouseup",this.reactMouseupBind);b.addListener(e,"touchend",this.reactTouchendBind)},_uninstallEventHandlers:function(e){b.removeListener(e,"mousemove",this.reactMousemoveBind);b.removeListener(e,"touchmove",this.reactTouchmoveBind);b.removeListener(e,"mouseup",this.reactMouseupBind);b.removeListener(e,"touchend",this.reactTouchendBind)},doReactActiviting:function($super,f){$super(f);var g={x:f.getScreenX(),y:f.getScreenY()};this.prepareResizing(g,f)}});ClassEx.extend(Kekule.Widget.BaseWidget,{resizableChanged:function(){if(this.getResizable()){var e=new Kekule.Widget.ResizeGripper(this);e.setRetainAspectRatio(this.getResizeWithAspectRatio());this.setPropStoreFieldValue("resizeGripper",e)}else{var e=this.getResizeGripper();if(e){e.finalize()}this.setPropStoreFieldValue("resizeGripper",null)}}});ClassEx.defineProps(Kekule.Widget.BaseWidget,[{name:"resizable",dataType:DataType.BOOL,setter:function(e){if(e!==this.getResizable()){this.setPropStoreFieldValue("resizable",e);this.resizableChanged()}}},{name:"resizeWithAspectRatio",dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("resizeWithAspectRatio",e);if(this.getResizeGripper()){this.getResizeGripper().setRetainAspectRatio(e)}}},{name:"isResizing",dataType:DataType.BOOL,serializable:false,scope:d.PRIVATE,setter:null,getter:function(){var e=this.getResizeGripper();return e?e.getIsUnderResizing():false}},{name:"resizeGripper",dataType:"Kekule.Widget.ResizeGripper",serializable:false,setter:null,scope:d.PRIVATE}])})();(function(){var c=Kekule.HtmlElementUtils;var a=Kekule.StyleUtils;var b=Kekule.X.Event;var d=Class.PropertyScope;Kekule.Widget.MoveHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.MoveHelper",initialize:function($super,f,e){$super();this.reactMouseDownBind=this.reactMouseDown.bind(this);this.reactMouseUpBind=this.reactMouseUp.bind(this);this.reactMouseMoveBind=this.reactMouseMove.bind(this);this.reactTouchDownBind=this.reactTouchDown.bind(this);this.reactTouchEndBind=this.reactTouchEnd.bind(this);this.reactTouchMoveBind=this.reactTouchMove.bind(this);this.__$K_initialMoverInfo__={};this.setCssPropX("left").setCssPropY("top").setMovingCursor("move").setMovingCursorDelay(500);this.setTarget(f);this.setGripper(e);this.setEnabled(true)},doFinalize:function($super){this.setGripper(null);$super()},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL});this.defineProp("target",{dataType:DataType.OBJECT,serializable:false});this.defineProp("gripper",{dataType:DataType.OBJECT,serializable:false,getter:function(){return this.getPropStoreFieldValue("gripper")||this.getTarget()},setter:function(f){var e=this.getPropStoreFieldValue("gripper");if(f!==e){this.setPropStoreFieldValue("gripper",f);this.gripperChanged(f,e)}}});this.defineProp("isMoving",{dataType:DataType.BOOL,serializable:false});this.defineProp("cssPropX",{dataType:DataType.STRING});this.defineProp("cssPropY",{dataType:DataType.STRING});this.defineProp("movingCursor",{dataType:DataType.STRING});this.defineProp("movingCursorDelay",{dataType:DataType.INT});this.defineProp("movable",{dataType:DataType.BOOL,setter:null,getter:function(){return this.getEnabled()&&this.getGripper()}})},_objIsWidget:function(e){return e instanceof Kekule.Widget.BaseWidget},_getElement:function(e){if(this._objIsWidget(e)){return e.getElement()}else{return e}},getTargetElement:function(){var e=this.getTarget();return this._objIsWidget(e)?e.getElement():e},getGripperElement:function(){var e=this.getGripper();return this._objIsWidget(e)?e.getElement():e},gripperChanged:function(f,e){if(e){this.installEventHandlers(this._getElement(e))}if(f){this.installEventHandlers(this._getElement(f))}},installEventHandlers:function(e){if(e){b.addListener(e,"mousedown",this.reactMouseDownBind);b.addListener(e,"touchstart",this.reactTouchDownBind)}},uninstallEventHandlers:function(e){if(e){b.removeListener(e,"mousedown",this.reactMouseDownBind);b.removeListener(e,"touchstart",this.reactTouchDownBind)}},_elemSupportCapture:function(e){return !!e.setCapture},_getMoveEventReceiverElem:function(e){return(this._elemSupportCapture(e))?e:e.ownerDocument.documentElement},setMouseCapture:function(e){var f=this.getGripperElement();if(f){if(e){if(f.setCapture){f.setCapture(true)}}else{if(f.releaseCapture){f.releaseCapture()}}}},beginMoving:function(f){if(this.getIsMoving()){return}var g=this.getTargetElement();c.makePositioned(g);this.saveInitialInformation(f);var e=this._getMoveEventReceiverElem(this.getGripperElement());b.addListener(e,"mousemove",this.reactMouseMoveBind);b.addListener(e,"touchmove",this.reactTouchMoveBind);b.addListener(e,"mouseup",this.reactMouseUpBind);b.addListener(e,"touchend",this.reactTouchEndBind);this.setMouseCapture(true);this._setCursorHandle=this.delaySetMoveCursor();this.setIsMoving(true)},endMoving:function(){this.setIsMoving(false);this.setMouseCapture(false);var e=this.getGripperElement();var f=this._getMoveEventReceiverElem(e);b.removeListener(f,"mousemove",this.reactMouseMoveBind);b.removeListener(f,"touchmove",this.reactTouchMoveBind);b.removeListener(f,"mouseup",this.reactMouseUpBind);b.removeListener(f,"touchend",this.reactTouchEndBind);this.clearCursorSetter();if(e){var g=this.__$K_initialMoverInfo__.cursor;e.style.cursor=g||"";this.__$K_initialMoverInfo__.cursor=null}},moveTo:function(f){this.clearCursorSetter();this.doSetMoveCursor();var h=this.getTargetElement();if(!h){return}var e=this.__$K_initialMoverInfo__;var g=Kekule.CoordUtils.substract(f,e.pointerCoord);if((this.getCssPropX()||"").toLowerCase()==="right"){h.style.right=(e.elemCoord.x-g.x)+"px"}else{h.style.left=(e.elemCoord.x+g.x)+"px"}if((this.getCssPropY()||"").toLowerCase()==="bottom"){h.style.bottom=(e.elemCoord.y-g.y)+"px"}else{h.style.top=(e.elemCoord.y+g.y)+"px"}},delaySetMoveCursor:function(){return setTimeout(this.doSetMoveCursor.bind(this),this.getMovingCursorDelay()||0)},doSetMoveCursor:function(){var e=this.getGripperElement();if(e&&this.getMovingCursor()){e.style.cursor=this.getMovingCursor()}},clearCursorSetter:function(){if(this._setCursorHandle){clearTimeout(this._setCursorHandle)}},saveInitialInformation:function(m){var g=this.getTargetElement();if(g){this.__$K_initialMoverInfo__.pointerCoord=m;var j;var e=(a.getComputedStyle(g,"position")||"").toLowerCase();var k=(this.getCssPropX()||"left").toLowerCase();var i=(this.getCssPropY()||"top").toLowerCase();if(e==="relative"){var f=a.analysisUnitsValue(a.getComputedStyle(g,"left")).value||0;var l=a.analysisUnitsValue(a.getComputedStyle(g,"top")).value||0;j={x:f,y:l};k="left";i="top"}else{j={x:g.offsetLeft,y:g.offsetTop}}var h=c.getElemOffsetDimension(g);if(k==="right"){j.x+=h.width}if(i==="bottom"){j.y+=h.height}this.__$K_initialMoverInfo__.elemCoord=j;if(this.getGripperElement()){this.__$K_initialMoverInfo__.cursor=this.getGripperElement().style.cursor}}},reactMouseDown:function(f){if(this.getTargetElement()&&this.getEnabled()){if(f.getButton()===b.MouseButton.LEFT){this.beginMoving({x:f.getScreenX(),y:f.getScreenY()},f.getTarget());f.preventDefault()}}},reactMouseUp:function(f){if(f.getButton()===b.MouseButton.LEFT){if(this.getIsMoving()){this.endMoving();f.preventDefault()}}},reactMouseMove:function(g){if(this.getIsMoving()){var f={x:g.getScreenX(),y:g.getScreenY()};this.moveTo(f);g.preventDefault()}},reactTouchDown:function(f){if(this.getEnabled()){this.beginMoving({x:f.getScreenX(),y:f.getScreenY()},f.getTarget());f.preventDefault()}},reactTouchEnd:function(f){if(this.getIsMoving()){this.endMoving();f.preventDefault()}},reactTouchMove:function(f){if(this.getIsMoving()){var g={x:f.getScreenX(),y:f.getScreenY()};this.moveTo(g);f.preventDefault()}}});ClassEx.extend(Kekule.Widget.BaseWidget,{_getMoveHelper:function(f){var e=this.getMoveHelper();if(!e&&f){e=new Kekule.Widget.MoveHelper(this)}return e},movingGripperChanged:function(){var e=this.getMovingGripper();if(e){var f=this._getMoveHelper(true);f.setGripper(e)}else{var f=this._getMoveHelper(false);if(f){f.setGripper(null)}}}});ClassEx.defineProps(Kekule.Widget.BaseWidget,[{name:"movable",dataType:DataType.BOOL,getter:function(){return this._getMoveHelper()&&this._getMoveHelper().getMovable()},setter:function(g){var e=this.getMovable();if(g!==e){if(g){this.setMovingGripper((this.getDefaultMovingGripper&&this.getDefaultMovingGripper())||this)}else{var f=this._getMoveHelper();if(f){f.setEnabled(false)}}}}},{name:"movingGripper",dataType:DataType.OBJECT,setter:function(e){if(e!==this.getMovingGripper()){this.setPropStoreFieldValue("movingGripper",e);this.movingGripperChanged()}}},{name:"isMoving",dataType:DataType.BOOL,serializable:false,scope:d.PRIVATE,setter:null,getter:function(){var e=this.getMoveHelper();return e?e.getIsMoving():false}},{name:"moveHelper",dataType:"Kekule.Widget.MoveHelper",serializable:false,setter:null,scope:d.PRIVATE}])})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.Glyph=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Glyph",initialize:function($super,c,d){this._imgElem=null;$super(c);if(d){this.setNormalInfo(d)}},initProperties:function(){this.defineImgInfoProp("normalInfo",{dataType:DataType.HASH});this.defineImgInfoProp("hoverInfo",{dataType:DataType.HASH});this.defineImgInfoProp("focusedInfo",{dataType:DataType.HASH});this.defineImgInfoProp("activeInfo",{dataType:DataType.HASH});this.defineImgInfoProp("disabledInfo",{dataType:DataType.HASH})},defineImgInfoProp:function(e,c){var d=Object.extend({setter:function(f){if(f){this.setPropStoreFieldValue(e,Object.extend({},f))}else{this.setPropStoreFieldValue(e,null)}this.imgInfoChanged()}},c);return this.defineProp(e,d)},doGetWidgetClassName:function(){return"K-Glyph"},doCreateRootElement:function(d){var c=d.createElement("span");return c},doBindElement:function($super,c){$super();this.createImgContainer(c)},createImgContainer:function(c,e){var d=c.ownerDocument;this._imgElem=d.createElement("span");this._imgElem.className=a.FULLFILL;c.innerHTML="";c.appendChild(this._imgElem)},imgInfoChanged:function(){this.updateImg()},stateChanged:function($super){$super();this.updateImg()},updateImg:function(){var c=Kekule.Widget.State;var d=this.getState();var e=(d===c.DISABLED)?this.getDisabledInfo():(d===c.ACTIVE)?this.getActiveInfo()||this.getHoverInfo()||this.getFocusedInfo():(d===c.HOVER)?this.getHoverInfo():(d===c.FOCUSED)?this.getFocusedInfo():this.getNormalInfo();e=e||this.getNormalInfo();this.showImgOfInfo(e)},showImgOfInfo:function(d){var c=this._imgElem;if(c){if(d){if(d.className){c.className=a.FULLFILL;b.addClass(c,d.className)}else{c.className=a.FULLFILL}c.style.backgroundImage=d.src?"url("+d.src+")":"";c.style.backgroundPosition=d.position||"";c.style.backgroundRepeat=d.repeat||"no-repeat"}else{c.style.backgroundImage=""}}}})})();(function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{CONTAINER:"K-Container",PANEL:"K-Panel",PANEL_CAPTION:"K-Panel-Caption",TOOLBAR:"K-Toolbar"});var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.Container=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Container",initialize:function($super,d){$super(d);this.reactShowStateChangeBind=this.reactShowStateChange.bind(this);this.addEventListener("showStateChange",this.reactShowStateChangeBind)},finalize:function($super){this.removeEventListener("showStateChange",this.reactShowStateChangeBind);this.clearWidgets();$super()},initProperties:function(){this.defineChildDimensionRelatedProp("childWidth");this.defineChildDimensionRelatedProp("childHeight");this.defineChildDimensionRelatedProp("childMargin");this.defineProp("firstChild",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("lastChild",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("allowChildWrap",{dataType:DataType.BOOL,serializable:false,setter:function(d){this.setPropStoreFieldValue("allowChildWrap",d);if(d){this.removeClassName(a.NOWRAP)}else{this.addClassName(a.NOWRAP)}}})},initPropValues:function($super){$super();this.setAllowChildWrap(true)},defineChildDimensionRelatedProp:function(f,d){var e=Object.extend({dataType:DataType.STRING,setter:function(g){this.setPropStoreFieldValue(f,g);this.updateChildSizes()}},d||{});return this.defineProp(f,e)},doGetWidgetClassName:function(){return a.CONTAINER},doCreateRootElement:function(e){var d=e.createElement("span");return d},getContainerElement:function(){return this.getElement()},appendWidget:function(d){d.setParent(this);return this},insertWidgetBefore:function(e,d){e.insertToWidget(this,d);return this},removeWidget:function(e,d){e.setParent(null);if(!d){e.finalize()}},clearWidgets:function(d){var f=this.getChildWidgets();for(var e=f.length-1;e>=0;--e){var g=f[e];this.removeWidget(g,d)}},_insertChildWidget:function(g,f){var e=f?f.getElement():null;var d=this.getContainerElement();if(d){if(e){d.insertBefore(g.getElement(),e)}else{d.appendChild(g.getElement())}}},reactShowStateChange:function(d){this.childrenModified()},childrenModified:function($super){$super();var i=this.getChildWidgets();var d=i.length;var f=0;var k=i[f];while(k&&(!k.isShown(true))&&(f<d)){++f;k=i[f]}var h=(f<d)?k:null;var f=d-1;var k=i[d-1];while(k&&(!k.isShown(true))&&(f>=0)){--f;k=i[f]}var e=(f>=0)?k:null;var g=this.getFirstChild();var j=this.getLastChild();if(h!==g){if(g){g.removeClassName(a.FIRST_CHILD)}if(h){h.addClassName(a.FIRST_CHILD)}this.setPropStoreFieldValue("firstChild",h)}if(e!==j){if(j){j.removeClassName(a.LAST_CHILD)}if(e){e.addClassName(a.LAST_CHILD)}this.setPropStoreFieldValue("lastChild",e)}},childWidgetAdded:function($super,g){$super(g);var d=this.getChildWidth();if(d){g.setWidth(d)}var e=this.getChildHeight();if(e){g.setHeight(e)}var f=this.getChildMargin();if(f){g.getStyle().margin=f}this._insertChildWidget(g,null)},childWidgetRemoved:function($super,d){$super(d)},childWidgetMoved:function($super,h,f){$super(h,f);var g=h.getElement();var e=this.getChildWidgets()[f+1];var d=e?e.getElement():null;if(d){this.getContainerElement().insertBefore(g,d)}else{this.getContainerElement().appendChild(g)}},updateChildSizes:function(){var g=this.getChildWidgets();var e=this.getChildWidth()||"";var j=this.getChildHeight()||"";var n=this.getChildMargin()||"";var k=this.getLayout();for(var f=0,d=g.length;f<d;++f){var m=g[f];m.setWidth(e);m.setHeight(j);m.getStyle().margin=n}}});Kekule.Widget.Panel=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Panel",initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){var d=this.getCaptionElem(false);return d&&b.getElementText(this.getCaptionElem())},setter:function(d){b.setElementText(this.getCaptionElem(true),d);SU.setDisplay(this.getCaptionElem(),!!d)}});this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(f){var d=this.getPropStoreFieldValue("captionElem");if(!d&&f){d=this.getDocument().createElement("div");d.className=a.PANEL_CAPTION;var e=this.getElement();e.insertBefore(d,b.getFirstChildElem(e));this.setPropStoreFieldValue("captionElem",d)}return d}})},initPropValues:function($super){$super();this.setUseCornerDecoration(true)},doGetWidgetClassName:function($super){return $super()+" "+a.PANEL}});Kekule.Widget.WidgetGroup=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGroup",initialize:function($super,d){$super(d)},initPropValues:function($super){$super();this.setUseCornerDecoration(true)},doObjectChange:function($super,d){$super(d);if(d.indexOf("useCornerDecoration")>=0){this._updateChildStyles()}},childWidgetAdded:function($super,d){if(d.setUseCornerDecoration){d.setUseCornerDecoration(false)}$super(d)},layoutChanged:function($super){$super();this._updateChildStyles()},childrenModified:function($super){$super();this._updateChildStyles()},_updateChildStyles:function(){var g=Kekule.Widget.Layout;var k=this.getLayout();var j=this.getFirstChild();var o=this.getLastChild();var n=this.getUseCornerDecoration();var e=this.getChildWidgets();var m=[a.CORNER_LEADING,a.CORNER_TAILING];for(var h=0,f=e.length;h<f;++h){var d=e[h];d.removeClassName(m);if(d===j){if(n){d.addClassName(a.CORNER_LEADING)}}if(d===o){if(n){d.addClassName(a.CORNER_TAILING)}}}}});Kekule.Widget.Toolbar=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.Toolbar",finalize:function($super){var d=this.getChildWidgetInternalNameMap();if(d){d.finalize()}$super()},initProperties:function(){this.defineProp("childDefs",{dataType:DataType.ARRAY,setter:function(d){this.setPropStoreFieldValue("childDefs",d);this.recreateChildrenByDefs()}});this.defineProp("childWidgetInternalNameMap",{dataType:DataType.OBJECT,serializable:false})},doGetWidgetClassName:function($super){return $super()+" "+a.TOOLBAR},doSetShowText:function($super,d){$super(d);this._updateAllChildTextGlyphStyles()},doSetShowGlyph:function($super,d){$super(d);this._updateAllChildTextGlyphStyles()},childWidgetAdded:function($super,d){$super(d);this._updateChildTextGlyphStyles(d)},_updateChildTextGlyphStyles:function(d){if(d.setShowText){d.setShowText(this.getShowText())}if(d.setShowGlyph){d.setShowGlyph(this.getShowGlyph())}},_updateAllChildTextGlyphStyles:function(){var e=this.getChildWidgets();for(var d=e.length-1;d>=0;--d){this._updateChildTextGlyphStyles(e[d])}},recreateChildrenByDefs:function(){var d=this.getChildDefs()||[];this.clearWidgets();var h=new Kekule.MapEx(true);this.setChildWidgetInternalNameMap(h);var j=this.getDefaultChildWidgetClassName();for(var g=0,f=d.length;g<f;++g){var k=d[g];if(!k.widget&&!k.widgetClass&&j){k=Object.extend({widget:j},k)}var e=Kekule.Widget.createFromHash(this,k);if(e){e.appendToWidget(this);if(k.internalName){h.set(k.internalName,e)}}}},getDefaultChildWidgetClassName:function(){return null},getChildWidgetByInternalName:function(d){var e=this.getChildWidgetInternalNameMap();return e?e.get(d):null}})})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MENU:"K-Menu",POPUPMENU:"K-PopupMenu",MENUBAR:"K-MenuBar",MENUITEM:"K-MenuItem",MENUITEM_NORMAL:"K-MenuItem-Normal",MENUITEM_SEPARATOR:"K-MenuItem-Separator",SUBMENU_MARKER:"K-SubMenu-Marker",CHECKMENU_MARKER:"K-CheckMenu-Marker"});Kekule.Widget.MenuItem=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.MenuItem",BINDABLE_TAG_NAMES:["li"],SUB_MENU_TAGS:["ol","ul"],initialize:function($super,d,e){$super(d);if(e){this.setText(e)}this._subMenuMarker=null;this._checkMarker=null},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(d){if(d===Kekule.Widget.MenuItem.SEPARATOR_TEXT){this.setIsSeparator(true)}else{if(!!d){this.setIsSeparator(false)}this.changeContentText(d)}}});this.defineProp("checked",{dataType:DataType.BOOL,setter:function(d){if(this.getPropStoreFieldValue("checked")!==d){this.setPropStoreFieldValue("checked",d);this.checkChanged()}}});this.defineProp("autoCheck",{dataType:DataType.BOOL});this.defineProp("isSeparator",{dataType:DataType.BOOL,setter:function(d){this.setPropStoreFieldValue("isSeparator",d);this.isSeparatorChanged(d)}})},initPropValues:function($super){$super();this.setUseCornerDecoration(false);this.setIsSeparator(false)},doGetWidgetClassName:function($super){return $super()+" "+a.MENUITEM},doCreateRootElement:function(e){var d=e.createElement("li");return d},changeContentText:function(d){this.getElement().innerHTML=d||""},isSeparatorChanged:function(d){if(d){this.setText("&nbsp;");this.removeClassName(a.MENUITEM_NORMAL);this.addClassName(a.MENUITEM_SEPARATOR);this.setStatic(true)}else{this.removeClassName(a.MENUITEM_SEPARATOR);this.addClassName(a.MENUITEM_NORMAL);this.setStatic(false)}},doBindElement:function($super,g){$super(g);var f=b.getDirectChildElems(g);for(var e=0,d=f.length;e<d;++e){var h=f[e];if(h.nodeType===Node.ELEMENT_NODE){this.bindSubMenu(h)}h=h.nextSibling}},doDomElemAdded:function(d){if(!Kekule.Widget.getWidgetOnElem(d)){this.bindSubMenu(d)}},checkChanged:function(){var d=this.getChecked();if(d){this._createCheckMarker();this.addClassName(a.STATE_CHECKED);this.invokeEvent("check")}else{this.removeClassName(a.STATE_CHECKED)}},_createCheckMarker:function(){var d=this._checkMarker;if(!d){var d=this.getDocument().createElement("span");d.className=a.CHECKMENU_MARKER;this.getElement().appendChild(d);this._checkMarker=d}return d},_removeCheckMarker:function(){if(this._checkMarker){this._checkMarker.parentNode.removeChild(this._checkMarker);this._checkMarker=null}},childWidgetAdded:function($super,d){$super(d);if(d instanceof Kekule.Widget.Menu){d.setIsSubMenu(true)}else{if(d instanceof Kekule.Widget.MenuItem){var e=this.getSubMenu(true);(function(){d.setParent(e);d.appendToWidget(e)}).defer(10)}}},childrenModified:function($super){$super();this.subMenuChanged()},bindSubMenu:function(f){var e=f.tagName.toLowerCase();if(e==="ul"||e==="ol"){var d=new Kekule.Widget.PopupMenu(f);this.addSubMenu(d);return d}},subMenuChanged:function(){var d=this.getSubMenu();if(d){this._createSubMenuMarker(d)}else{this._removeSubMenuMarker()}},getSubMenu:function(h){var g=this.getChildWidgets();for(var f=0,e=g.length;f<e;++f){var d=g[f];if(d instanceof Kekule.Widget.Menu){return d}}if(h){return this.createSubMenu()}else{return null}},addSubMenu:function(d){d.appendToWidget(this);return this},removeSubMenu:function(d){d.setParent(null);return d},createSubMenu:function(){var d=new Kekule.Widget.PopupMenu(this);this.addSubMenu(d);return d},_createSubMenuMarker:function(e){var d=this._subMenuMarker;if(!d){var d=this.getDocument().createElement("span");d.className=a.SUBMENU_MARKER;this.getElement().appendChild(d);this._subMenuMarker=d}return d},_removeSubMenuMarker:function(){if(this._subMenuMarker){this._subMenuMarker.parentNode.removeChild(this._subMenuMarker);this._subMenuMarker=null}},isLeafItem:function(){var d=this.getElement();return !(d.getElementsByTagName("ul").length||d.getElementsByTagName("ol").length)},isPeriodicalExecuting:function($super){return $super()&&this.getIsActive()},doReactActiviting:function($super,d){$super(d);if(this.isLeafItem()){if(this.getEnablePeriodicalExec()){this.startPeriodicalExec(d)}}},doReactDeactiviting:function($super,d){if(this.isLeafItem()){this.stopPeriodicalExec();if(this.getIsActive()){this.execute(d);if(this.getAutoCheck()){this.setChecked(!this.getChecked())}this.notifyDeactivated()}}},notifyDeactivated:function(){var d=this.getParent();if(d&&d.childDeactivated){d.childDeactivated(this)}},childDeactivated:function(d){var e=this.getParent();if(e&&e.childDeactivated){e.childDeactivated(this)}}});Kekule.Widget.MenuItem.SEPARATOR_TEXT="-";Kekule.Widget.MenuItem.createFromHash=function(d,f){var e=f;if(DataType.isSimpleValue(e)){if(e===Kekule.Widget.MenuItem.SEPARATOR_TEXT){e={isSeparator:true}}else{e={text:e}}}if(!e.widget&&!e.widgetClass){e.widget=Kekule.Widget.MenuItem}return Kekule.Widget.createFromHash(d,e)};Kekule.Widget.Menu=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Menu",BINDABLE_TAG_NAMES:["ol","ul"],MENU_ITEM_TAG:"li",initialize:function($super,d){$super(d)},initProperties:function(){this.defineProp("isSubMenu",{dataType:DataType.BOOL,serializable:false,setter:function(d){this.setPropStoreFieldValue("isSubMenu",d);if(d){this.setLayout(Kekule.Widget.Layout.VERTICAL)}}})},initPropValues:function($super){$super();this.setUseCornerDecoration(true)},doGetWidgetClassName:function($super){return $super()+" "+a.MENU},doCreateRootElement:function(e){var d=e.createElement("ul");return d},doBindElement:function($super,g){$super(g);var f=Kekule.DomUtils.getDirectChildElems(g);for(var e=0,d=f.length;e<d;++e){var h=f[e];if(h.nodeType===Node.ELEMENT_NODE){this.bindMenuItem(h)}h=h.nextSibling}},doDomElemAdded:function(d){this.bindMenuItem(d)},bindMenuItem:function(e){if(e.tagName.toLowerCase()==="li"){var d=new Kekule.Widget.MenuItem(e);d.setParent(this);return d}},getSubMenuTagName:function(){return this.getElement().tagName},getMenuItems:function(j){if(!j){j=this.getElement()}var g=b.getDirectChildElems(menuElem,this.MENU_ITEM_TAG);var d=[];for(var h=0,f=g.length;h<f;++h){var e=Kekule.Widget.getWidgetOnElem(g[h]);if(e&&(e instanceof Kekule.Widget.MenuItem)){d.push(e)}}return d},insertMenuItem:function(e,d){e.insertToWidget(this,d);return this},appendMenuItem:function(d){d.appendToWidget(this);return this},removeMenuItem:function(e,d){e.setParent(null);if(!d){e.finalize()}},clearMenuItems:function(d){this.clearWidgets(d);return this},isTopLevel:function(){var d=this.getParent();return !d||!((d instanceof Kekule.Widget.MenuItem)||(d instanceof Kekule.Widget.Menu))},childDeactivated:function(d){var e=this.getParent();if(e){if(e.childDeactivated){e.childDeactivated(this)}}},createChildrenByDefs:function(d){for(var f=0,e=d.length;f<e;++f){var h=d[f];var g=Kekule.Widget.MenuItem.createFromHash(this,h)}return this}});Kekule.Widget.PopupMenu=Class.create(Kekule.Widget.Menu,{CLASS_NAME:"Kekule.Widget.PopupMenu",initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.VERTICAL)},doGetWidgetClassName:function($super){return $super()+" "+a.POPUPMENU},childDeactivated:function(d){}});Kekule.Widget.MenuBar=Class.create(Kekule.Widget.Menu,{CLASS_NAME:"Kekule.Widget.MenuBar",doGetWidgetClassName:function($super){return $super()+" "+a.MENUBAR}})})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{BUTTON:"K-Button",BUTTON_KINDED:"K-Button-Kinded",BUTTON_GROUP:"K-Button-Group",COMPACT_BUTTON:"K-Compact-Button",BTN_COMPACT_MARK:"K-Compact-Mark"});Kekule.Widget.Button=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Button",BINDABLE_TAG_NAMES:["input","button","a","label"],CSS_DROPDOWN_CLASS_NAME:"K-DropDownMark",DEF_GLYPH_WIDTH:"16px",DEF_GLYPH_HEIGHT:"16px",initialize:function($super,c,d){this._elemTextPart=null;this._elemLeadingGlyphPart=null;this._elemTailingGlyphPart=null;$super(c);if(d){this.setText(d)}},initProperties:function(){this.defineElemAttribMappingProp("actionType","type");this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var c=(this._elemTextPart||this.getElement());return c?c.innerHTML:null},setter:function(c){this.changeContentText(c)}});this.defineProp("leadingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(d){var c=this.getPropStoreFieldValue("leadingGlyph");if(!c&&d){c=this._createDefaultGlyphWidget(this._elemLeadingGlyphPart);this.setPropStoreFieldValue("leadingGlyph",c)}return c}});this.defineProp("tailingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(d){var c=this.getPropStoreFieldValue("tailingGlyph");if(!c&&d){c=this._createDefaultGlyphWidget(this._elemTailingGlyphPart);this.setPropStoreFieldValue("tailingGlyph",c)}return c}});this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(c){this.setPropStoreFieldValue("showLeadingGlyph",c);this._elemLeadingGlyphPart.style.display=(c&&this.getShowGlyph())?"":"none"}});this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(c){this.setPropStoreFieldValue("showTailingGlyph",c);this._elemTailingGlyphPart.style.display=(c&&this.getShowGlyph())?"":"none"}});this.defineProp("buttonKind",{dataType:DataType.STRING,setter:function(d){var c=this.getButtonKind();if(d!==c){this.cancelButtonKind(c);this.applyButtonKind(d);this.setPropStoreFieldValue("buttonKind",d)}}})},initPropValues:function($super){$super();this.setPropStoreFieldValue("showText",true);this.setPropStoreFieldValue("showGlyph",true);this.setPropStoreFieldValue("showLeadingGlyph",true);this.setPropStoreFieldValue("showTailingGlyph",true);this.setPropStoreFieldValue("useCornerDecoration",true);this.setAllowTextWrap(false)},_createDefaultGlyphWidget:function(c){var d=new Kekule.Widget.Glyph(this);d.setWidth(this.DEF_GLYPH_WIDTH).setHeight(this.DEF_GLYPH_HEIGHT);d.setStatic(true).setInheritState(true).setInheritStatic(true).setInheritEnabled(true);d.appendToElem(c);return d},doGetWidgetClassName:function($super){return $super()+" "+a.BUTTON},doCreateRootElement:function(d){var c=d.createElement("button");c.setAttribute("type","button");return c},doBindElement:function($super,c){$super(c);var d=c.innerHTML||"";c.innerHTML="";this._elemTextPart=this.createTextContent(d,c);this._elemLeadingGlyphPart=this.createGlyphContent(c,this._elemTextPart,a.PART_PRI_GLYPH_CONTENT);this._elemTailingGlyphPart=this.createGlyphContent(c,null,a.PART_ASSOC_GLYPH_CONTENT);if(this.getUseCornerDecoration()){b.addClass(c,a.CORNER_ALL)}},changeContentText:function(c){this._elemTextPart.innerHTML=c||""},isPeriodicalExecuting:function($super){return $super()&&this.getIsActive()},doReactActiviting:function($super,c){$super(c);if(this.getEnablePeriodicalExec()){this.startPeriodicalExec(c)}},doReactDeactiviting:function($super,c){this.stopPeriodicalExec();if(this.getIsActive()){this.execute(c)}},cancelButtonKind:function(c){if(c){this.removeClassName(c);this.removeClassName(a.BUTTON_KINDED)}},applyButtonKind:function(c){if(c){this.addClassName(a.BUTTON_KINDED);this.addClassName(c)}}});Kekule.Widget.Button.Kinds={DROPDOWN:"K-Kind-DropDown",POPUP:"K-Kind-Popup",SEARCH:"K-Kind-Search",EDIT:"K-Kind-Edit",ENTER:"K-Kind-Enter"};Kekule.Widget.CheckButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.CheckButton",initialize:function($super,c,d){$super(c,d)},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,setter:function(c){if(this.getPropStoreFieldValue("checked")!==c){this.setPropStoreFieldValue("checked",c);this.checkChanged();this.stateChanged()}}});this.defineProp("autoCheck",{dataType:DataType.BOOL})},initPropValues:function($super){$super();this.setAutoCheck(true)},checkChanged:function(){if(this.getChecked()){this.invokeEvent("check")}else{this.invokeEvent("uncheck")}this.invokeEvent("checkChange",{checked:this.getChecked()})},getStateClassName:function($super,d){var c=this.getChecked()?Kekule.Widget.State.ACTIVE:d;return $super(c)},doReactDeactiviting:function($super,d){var c=this.getChecked();$super(d);if(this.getAutoCheck()){this._doToggleCheckOnSelf(c)}},_doToggleCheckOnSelf:function(c){if(this.getEnabled()){this.setChecked(!c)}}});Kekule.Widget.RadioButton=Class.create(Kekule.Widget.CheckButton,{CLASS_NAME:"Kekule.Widget.RadioButton",initialize:function($super,c,d){$super(c,d)},initProperties:function(){this.defineProp("group",{dataType:DataType.STRING})},checkChanged:function($super){$super();if(this.getChecked()){this.uncheckSiblings()}},uncheckSiblings:function(){var g=this.getParent();var h=this.getGroup();if(g){var e=g.getChildWidgets();for(var f=0,d=e.length;f<d;++f){var c=e[f];if((c!==this)&&c.getGroup&&c.setChecked&&(c.getGroup()===h)){c.setChecked(false)}}}},doReactDeactiviting:function($super,c){$super(c)},_doToggleCheckOnSelf:function($super,c){if(c){return}else{$super(c)}},_doCheckOnSelf:function(){if(this.getEnabled()){this.setChecked(true)}}});Kekule.Widget.DropDownButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.DropDownButton",doFinalize:function($super){$super()},initProperties:function(){this.defineProp("dropDownWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,getter:function(){var d=this.getPropStoreFieldValue("dropDownWidget");if(!d){var c=this.getDropDownWidgetGetter();if(c){d=c(this);this.setPropStoreFieldValue("dropDownWidget",d)}}return d},setter:function(c){this.setPropStoreFieldValue("dropDownWidget",c);if(c){c.setDisplayed(false)}}});this.defineProp("dropDownWidgetGetter",{dataType:DataType.FUNCTION,serializable:false});this.defineProp("dropPosition",{dataType:DataType.INT})},doCreateRootElement:function($super,c){return $super(c)},calcActualDropPosition:function(){var d=Kekule.Widget.Position;var k=this.getDropPosition();if(!k){var e=this.getParent();var i=e?e.getLayout():Kekule.Widget.Layout.HORIZONTAL;var h=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),true);var g=Kekule.HtmlElementUtils.getViewportDimension(this.getElement());var l=this.getDropDownWidget().getElement();l.style.visible="hidden";l.style.display="";this.getElement().appendChild(l);var m=Kekule.HtmlElementUtils.getElemOffsetDimension(l);this.getElement().removeChild(l);if(i){if(i===Kekule.Widget.Layout.VERTICAL){var f=h.x;var n=g.width-f-h.width;if(n>=m.width){k=d.RIGHT}else{k=(f>n)?d.LEFT:d.RIGHT}}else{var j=h.y;var c=g.height-j-h.height;if(c>=m.height){k=d.BOTTOM}else{k=(j>c)?d.TOP:d.BOTTOM}}}}return k},showDropDownWidget:function(){var e=this.getDropDownWidget();var c=e.getElement();c.style.position="absolute";var d=this.getElement();e.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN);this.invokeEvent("dropDown",{dropDown:e})},hideDropDownWidget:function(){this.getDropDownWidget().hide(this)},isDropDownWidgetShown:function(){var d=this.getDropDownWidget();var c=d&&d.isShown();return c},doExecute:function($super,c){if(this.getDropDownWidget()){if(this.isDropDownWidgetShown()){this.hideDropDownWidget()}else{this.showDropDownWidget()}}$super(c)}});Kekule.Widget.ButtonGroup=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Widget.ButtonGroup",initialize:function($super,c){$super(c)},initPropValues:function($super){$super();this.setPropStoreFieldValue("showText",true);this.setPropStoreFieldValue("showGlyph",true);this.setAllowChildWrap(false)},doGetWidgetClassName:function($super){return $super()+" "+a.BUTTON_GROUP},doCreateRootElement:function(d){var c=d.createElement("span");return c},getDefaultChildWidgetClassName:function(){return"Kekule.Widget.Button"}});Kekule.Widget.CompactButtonSet=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.CompactButtonSet",initialize:function($super,c,d){this.reactSetButtonExecuteBind=this.reactSetButtonExecute.bind(this);this.setPropStoreFieldValue("showCompactMark",true);this.setPropStoreFieldValue("cloneSelectedOutlook",true);$super(c,d);if(!this.getButtonSet()){this.initButtonGroup()}},initProperties:function(){this.defineProp("buttonSet",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,setter:function(d){var c=this.getButtonSet();if(c!==d){if(c){c.finalize()}this.initButtonGroup(d)}}});this.defineProp("buttonSetLayout",{dataType:DataType.INT});this.defineProp("selected",{dataType:"Kekule.Widget.Button",serializable:false,setter:function(d){if(d){if(this.getButtonSet().hasChild(d)){if(this.getCloneSelectedOutlook()){this.cloneSetButton(d)}if(d.setChecked){d.setChecked(true)}}}else{var c=this.getSelected();if(c){c.setChecked(false)}}this.setPropStoreFieldValue("selected",d)}});this.defineProp("cloneSelectedOutlook",{dataType:DataType.BOOL});this.defineProp("showCompactMark",{dataType:DataType.BOOL,setter:function(d){var c=this.getShowCompactMark();if(c!==d){this.setPropStoreFieldValue("showCompactMark",d);if(d){this.createCompactMark()}else{this.removeCompactMark()}}}})},doGetWidgetClassName:function($super){return $super()+" "+a.COMPACT_BUTTON},doSetShowText:function($super,c){if(this.getButtonSet()){this.getButtonSet().setShowText(c)}return $super(c)},doSetShowGlyph:function($super,c){if(this.getButtonSet()){this.getButtonSet().setShowGlyph(c)}return $super(c)},createCompactMark:function(){var c=this.getElement();if(this._compactMark){c.removeChild(this._compactMark)}var d=this.getDocument().createElement("span");d.className=a.BTN_COMPACT_MARK;c.appendChild(d);this._compactMark=d;return d},removeCompactMark:function(){var c=this.getElement();if(this._compactMark){c.removeChild(this._compactMark)}},initButtonGroup:function(d){if(!d){d=new Kekule.Widget.ButtonGroup(this)}else{var c=this._getCheckedButtonInGroup(d)}d.setDisplayed(false);d.setShowText(this.getShowText());d.setShowGlyph(this.getShowGlyph());this.setPropStoreFieldValue("buttonSet",d);this.setDropDownWidget(d);d.addEventListener("execute",this.reactSetButtonExecuteBind);d.addEventListener("check",this.reactSetButtonExecuteBind);if(c){this.cloneSetButton(c)}},_getCheckedButtonInGroup:function(g){var e=g.getChildWidgets();for(var f=0,d=e.length;f<d;++f){var c=e[f];if(c.getChecked&&c.getChecked()){return c}}return null},cloneSetButton:function(d){if(!this.getCloneSelectedOutlook()){return}var f=this.getElement();var n=this.getButtonSet().getElement();var m=Kekule.DomUtils;var g=m.getDirectChildElems(f);var j=m.getDirectChildElems(d.getElement());var k=false;for(var h=0,e=g.length;h<e;++h){var c=g[h];if(c!==n){f.removeChild(c)}else{k=true}}for(var h=0,e=j.length;h<e;++h){var c=j[h].cloneNode(true);if(k){f.insertBefore(c,n)}else{f.appendChild(c)}}if(this._clonedCustomHtmlClassName){this.removeClassName(this._clonedCustomHtmlClassName)}this._clonedCustomHtmlClassName=d.getCustomHtmlClassName();if(this._clonedCustomHtmlClassName){this.addClassName(this._clonedCustomHtmlClassName)}this._compactMark=null;this.createCompactMark()},calcActualButtonSetLayout:function(){var d=Kekule.Widget.Layout;var c=this.getButtonSetLayout();if(!c){var f=this.getParent();var e=f?f.getLayout():d.HORIZONTAL;c=(e===d.VERTICAL)?d.HORIZONTAL:d.VERTICAL}return c},showDropDownWidget:function($super){var c=this.calcActualButtonSetLayout();this.getButtonSet().setLayout(c);$super()},reactSetButtonExecute:function(c){if(c.target instanceof Kekule.Widget.Button){if(c.target!==this.getSelected()){c.target.setIsFocused(false);c.target.setIsHover(false);c.target.setIsActive(false);this.setSelected(c.target);if(this.getButtonSet().isShown()){this.getButtonSet().hide()}this.invokeEvent("select",{selected:c.target})}}},append:function(c,d){this.getButtonSet().appendWidget(c);if(d){this.setSelected(c)}return this},insertBefore:function(c,e,d){this.getButtonSet().insertWidgetBefore(c);if(d){this.setSelected(c)}return this},remove:function(d,c){this.getButtonSet().removeWidget(d,c);return this}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;var b=Kekule.ObjUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OVERLAP:"K-Overlap",FORMCONTROL:"K-FormControl",CHECKBOX:"K-CheckBox",TEXTBOX:"K-TextBox",COMBOTEXTBOX:"K-ComboTextBox",COMBOTEXTBOX_ASSOC_WIDGET:"K-ComboTextBox-Assoc-Widget",BUTTONTEXTBOX:"K-ButtonTextBox",TEXTAREA:"K-TextArea",SELECTBOX:"K-SelectBox",COMBOBOX:"K-ComboBox",COMBOBOX_TEXTWRAPPER:"K-ComboBox-TextWrapper"});Kekule.Widget.FormWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.FormWidget",initialize:function($super,e,f){this.reactValueChangeBind=this.reactValueChange.bind(this);this.reactInputBind=this.reactInput.bind(this);this.setPropStoreFieldValue("isDirty",false);$super(e,f)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,getter:function(){return this.getCoreElement().name},setter:function(e){this.getCoreElement().name=e}});this.defineProp("value",{dataType:DataType.VARIANT,serializable:false,getter:function(){return this.getCoreElement().value},setter:function(e){this.getCoreElement().value=e}});this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:false});this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getCoreElement().readOnly},setter:function(e){this.getCoreElement().readOnly=e}})},getTextSelectable:function(){return true},doGetWidgetClassName:function($super){return $super()+" "+a.FORMCONTROL},doBindElement:function($super,f){$super(f);var e=this.getCoreElement();if(e){Kekule.X.Event.addListener(e,"change",this.reactValueChangeBind);Kekule.X.Event.addListener(e,"input",this.reactInputBind)}},doUnbindElement:function($super,f){var e=this.getCoreElement();if(e){Kekule.X.Event.removeListener(e,"change",this.reactValueChangeBind);Kekule.X.Event.removeListener(e,"input",this.reactInputBind)}$super(f)},notifyValueChanged:function(){this.setIsDirty(true);this.invokeEvent("valueChange",{widget:this})},selectAll:function(){var e=this.getCoreElement();if(e&&e.select){e.select()}return this},reactValueChange:function(){this.notifyValueChanged()},reactInput:function(){this.setIsDirty(true)}});Kekule.Widget.CheckBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.CheckBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e,f){$super(e);if(Kekule.ObjUtils.notUnset(f)){this.setChecked(!!f)}},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,getter:function(){var e=this.getCoreElement();return e?e.checked:false},setter:function(f){var e=this.getCoreElement();if(e){e.checked=!!f}}});this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.DomUtils.getElementText(this.getLabelElem())},setter:function(e){Kekule.DomUtils.setElementText(this.getLabelElem(),e)}})},getCoreElement:function(){return this.getInputElem()},doGetWidgetClassName:function($super){return $super()+" "+a.CHECKBOX},getInputElem:function(){var f=this.getElement();if(f){var e=f.getElementsByTagName("input");if(e&&e.length){return e[0]}}return null},getLabelElem:function(){var e=this.getElement();if(e){if(e.tagName.toLowerCase()==="label"){return e}else{var f=e.getElementsByTagName("label");if(f&&f.length){return f[0]}}}return null},doCreateRootElement:function(f){var e=f.createElement("span");return e},doCreateSubElements:function(h,e){var f=h.createElement("label");e.appendChild(f);var g=h.createElement("input");g.setAttribute("type","checkbox");f.appendChild(g);return[f,g]}});Kekule.Widget.TextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextBox",BINDABLE_TAG_NAMES:["input"],initialize:function($super,e,f){$super(e);if(f){this.setText(f)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getElement().value},setter:function(e){if(e){this.getElement().value=e}else{this.getElement().value=""}}});this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}})},doGetWidgetClassName:function($super){return $super()+" "+a.TEXTBOX},doCreateRootElement:function(f){var e=f.createElement("input");e.setAttribute("type","text");return e},doBindElement:function($super,e){$super(e)}});Kekule.Widget.ComboTextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboTextBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e,f){$super(e);if(f){this.setText(f)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var f=this.getTextBox();if(f){f.setText(e)}}});this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getTextBox().getPlaceholder()},setter:function(e){this.getTextBox().setPlaceholder(e)}});this.defineProp("overlapOnTextBox",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("overlapOnTextBox",e);if(e){this.addClassName(a.OVERLAP)}else{this.removeClassName(a.OVERLAP)}this.adjustWidgetsSize()}});this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:false,setter:null});this.defineProp("headingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:function(g){var e=this.getHeadingWidget();if(g!==e){this.setPropStoreFieldValue("headingWidget",g);if(e){e.setParent(null);e.removeClassName(a.COMBOTEXTBOX_ASSOC_WIDGET)}if(g){var f=this.getTextBox()?this.getTextBox().getElement():this.getTailingWidget()?this.getTailingWidget().getElement():null;g.setParent(this);g.addClassName(a.COMBOTEXTBOX_ASSOC_WIDGET);g.insertToElem(this.getElement(),f)}}}});this.defineProp("tailingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:function(f){var e=this.getTailingWidget();if(f!==e){this.setPropStoreFieldValue("tailingWidget",f);if(e){e.setParent(null);e.removeClassName(a.COMBOTEXTBOX_ASSOC_WIDGET)}if(f){f.setParent(this);f.addClassName(a.COMBOTEXTBOX_ASSOC_WIDGET);f.appendToElem(this.getElement())}}}})},finalize:function($super){this._finalizeSubWidgets();$super()},_finalizeSubWidgets:function(){var f=this.getTextBox();if(f){f.finalize()}var e=this.getHeadingWidget();if(e){e.finalize()}var e=this.getTailingWidget();if(e){e.finalize()}},getCoreElement:function($super){var e=this.getTextBox();if(e){return e.getElement()}else{return $super()}},doGetWidgetClassName:function($super){return $super()+" "+a.COMBOTEXTBOX},doCreateRootElement:function(f){var e=f.createElement("span");return e},doCreateSubElements:function($super,h,g){var e=$super(h,g);var f=this;this._finalizeSubWidgets();var i=new Kekule.Widget.TextBox(this);i.addClassName(a.TEXTBOX);i.appendToElem(this.getElement());this.setPropStoreFieldValue("textBox",i);e.push(i.getElement());return e},relayEvent:function($super,f,g){var e=g.widget;if((e===this.getTextBox())||(e===this.getHeadingWidget())||(e===this.getTailingWidget())){g.widget=this}return $super(f,g)},doSetEnabled:function(f){var g=this.getTextBox();if(g){g.setEnabled(f)}var e=this.getHeadingWidget();if(e){e.setEnabled(f)}e=this.getTailingWidget();if(e){e.setEnabled(f)}},doResize:function(){this.adjustWidgetsSize()},widgetShowStateChanged:function($super,f,e){$super(f,e);if(f){this.adjustWidgetsSize()}},doInsertedToDom:function(){if(this.isShown()){this.adjustWidgetsSize()}},assocWidgetChanged:function(){this.adjustWidgetsSize()},adjustWidgetsSize:function(){var h=Kekule.StyleUtils;var m=this.getOverlapOnTextBox();var j=m?"absolute":"relative";var g=this.getTextBox().getElement();if(!g){return}var l=Kekule.HtmlElementUtils.getElemPageRect(g);var i=this.getHeadingWidget();var f=i?i.getElement():null;if(f&&i.isShown()){var e=f.style;e.position=j;if(m){var k=Kekule.HtmlElementUtils.getElemPageRect(f);e.left=0;e.top=((l.height-k.height)/2)+"px";g.style.paddingLeft=k.width+"px"}else{h.removeStyleProperty(e,"left");h.removeStyleProperty(e,"top");h.removeStyleProperty(g.style,"paddingLeft")}}else{h.removeStyleProperty(g.style,"paddingLeft")}var i=this.getTailingWidget();var f=i?i.getElement():null;if(f&&i.isShown()){var e=f.style;e.position=j;if(m){var k=Kekule.HtmlElementUtils.getElemPageRect(f);e.right=0;e.top=((l.height-k.height)/2)+"px";g.style.paddingRight=k.width+"px"}else{h.removeStyleProperty(e,"right");h.removeStyleProperty(e,"top");h.removeStyleProperty(g.style,"paddingRight")}}else{h.removeStyleProperty(g.style,"paddingRight")}}});Kekule.Widget.ButtonTextBox=Class.create(Kekule.Widget.ComboTextBox,{CLASS_NAME:"Kekule.Widget.ButtonTextBox",initialize:function($super,e,f){$super(e,f);this.setOverlapOnTextBox(true)},initProperties:function(){this.defineProp("button",{dataType:"Kekule.Widget.Button",serializable:false,setter:null,getter:function(){return this.getTailingWidget()}});this.defineProp("buttonKind",{dataType:DataType.STRING,getter:function(){return this.getButton().getButtonKind()},setter:function(e){this.getButton().setButtonKind(e)}});this.defineProp("buttonText",{dataType:DataType.STRING,getter:function(){return this.getButton().getText()},setter:function(e){this.getButton().setText(e).setShowText(!!e)}})},doGetWidgetClassName:function($super){return $super()+" "+a.BUTTONTEXTBOX},doCreateSubElements:function($super,h,f){var e=$super(h,f);var g=this.createAssocButton();if(g){e.push(g.getElement())}return e},createAssocButton:function(){var e=new Kekule.Widget.Button(this);e.setShowText(false);this.setTailingWidget(e);e.addEventListener("change",this.adjustWidgetsSize,this);e.addEventListener("execute",function(f){this.invokeEvent("buttonExecute",{widget:this})},this);return e},execBtn:function(g){var f=this.getButton();if(f){f.execute(g);return true}},react_keypress:function(f){if(f.getKeyCode()===13){this.execBtn(f)}},react_keydown:function(g){if(this.getButtonKind()===Kekule.Widget.Button.Kinds.DROPDOWN){var f=Kekule.X.Event.KeyCode;if(g.getKeyCode()===f.DOWN){this.execBtn(g)}}}});Kekule.Widget.TextArea=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextArea",BINDABLE_TAG_NAMES:["textarea"],initialize:function($super,e,f){$super(e);if(f){this.setText(f)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getValue()},setter:function(e){this.setValue(e);this.adjustAutoSize()}});this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}});this.defineProp("autoSizeX",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeX",e);this._autoSizeChanged()}});this.defineProp("autoSizeY",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeY",e);this._autoSizeChanged()}});this.defineProp("wrap",{dataType:DataType.STRING,getter:function(){return this.getElement().wrap},setter:function(e){this.getElement().wrap=e}})},doGetWidgetClassName:function($super){return $super()+" "+a.TEXTAREA},doCreateRootElement:function(f){var e=f.createElement("textarea");return e},doBindElement:function($super,e){$super(e);this.adjustAutoSize()},setValue:function($super,e){$super(e);this.adjustAutoSize()},widgetShowStateChanged:function($super,f,e){$super(f,e);if(f){this.adjustAutoSize()}},reactValueChange:function($super){this.adjustAutoSize();$super()},react_keyup:function(){this.adjustAutoSize()},react_keypress:function(){this.adjustAutoSize()},doWidgetShowStateChanged:function(e){if(e){this.adjustAutoSize()}},_autoSizeChanged:function(){var e=this.getCoreElement().style;if(this.getAutoSizeX()){e.overflowX="hidden";this.setWrap("off")}else{e.overflowX="auto";this.setWrap("")}if(this.getAutoSizeY()){e.overflowY="hidden"}else{e.overflowY="auto"}this.adjustAutoSize()},adjustAutoSize:function(){if(this.getAutoSizeX()||this.getAutoSizeY()){this.adjustSizeByContent()}},adjustSizeByContent:function(){var f=this.getCoreElement();var i=this.getText();var h=!i;var e=f.style;if(this.getAutoSizeX()){e.width="1px"}if(this.getAutoSizeY()){e.height="1px"}var g=Kekule.HtmlElementUtils.getElemScrollDimension(f);var j=Kekule.HtmlElementUtils.getElemClientDimension(f);if(this.getAutoSizeX()){if(h){e.width="1em"}else{if(g.width>j.width){e.width=g.width+"px"}}}if(this.getAutoSizeY()){if(h){e.height="1em"}if(g.height>j.height){e.height=g.height+"px"}}}});Kekule.Widget.SelectBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.SelectBox",BINDABLE_TAG_NAMES:["select"],ITEM_DATA_FIELD:"__$item_data__",ITEM_VALUE_FIELD:"__$item_value__",initialize:function($super,e,f){$super(e);if(f){this.setItems(f)}},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY,serializable:false,getter:function(){var g=this.getAllItemElems();var e=[];for(var h=0,f=g.length;h<f;++h){var j=g[h];var k=this._getBoxItemInfo(j);e.push(k)}return e},setter:function(k){var f=this.getElement();this.clear();if(k){var g=Kekule.ArrayUtils.toArray(k);for(var h=0,e=g.length;h<e;++h){var m=g[h];if(m){var j=this._createBoxItemElem(f);this._setBoxItemInfo(j,m)}}}}});this.defineProp("index",{dataType:DataType.INT,getter:function(){return this.getElement().selectedIndex},setter:function(e){this.getElement().selectedIndex=e}})},doGetWidgetClassName:function($super){return $super()+" "+a.SELECTBOX},doCreateRootElement:function(f){var e=f.createElement("select");return e},_createBoxItemElem:function(f,g){var h=f.ownerDocument;var e=h.createElement("option");if(g){f.insertBefore(e,g)}else{f.appendChild(e)}return e},doBindElement:function($super,e){$super(e)},doGetValue:function(){var e=this.getSelectedItemElem();if(e){var f=this._getBoxItemInfo(e);return f.value}else{return undefined}},doSetValue:function(k){var f=this.getAllItemElems();var g;for(var h=0,e=f.length;h<e;++h){var j=f[h];var m=this._getBoxItemInfo(j);if(m.value===k){this.setIndex(h);return}}this.setIndex(-1)},getAllItemElems:function(){return c.getDirectChildElems(this.getElement(),"option")},getSelectedItemElem:function(){var f=this.getAllItemElems();for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h.selected){return h}}return null},clear:function(){this.getElement().innerHTML=""},dropDown:function(){var g=this.getDocument();var f=this.getElement();var e=this.getDocument().createEvent("MouseEvents");e.initEvent("mousedown",true,true);this.getElement().dispatchEvent(e)},_getBoxItemInfo:function(f){var e={};e.text=d.getInnerText(f);e.value=f[this.ITEM_VALUE_FIELD];if(b.notUnset(f.title)){e.title=f.title}if(b.notUnset(f[this.ITEM_DATA_FIELD])){e.data=f[this.ITEM_DATA_FIELD]}return e},_setBoxItemInfo:function(g,e){if(DataType.isSimpleValue(e)){e={value:e}}var f=e.text||e.value;if(b.notUnset(f)){Kekule.DomUtils.setElementText(g,f)}g.value=""+e.value;g[this.ITEM_VALUE_FIELD]=e.value;if(b.notUnset(e.title)){g.title=e.title}if(b.notUnset(e.data)){g[this.ITEM_DATA_FIELD]=e.data}if(e.selected){g.setAttribute("selected","selected")}else{g.selected=false}return this}});Kekule.Widget.ComboBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var f=this.getTextBox();if(f){f.setText(e);this.textChanged()}}});this.defineProp("items",{dataType:DataType.ARRAY,serializable:false,getter:function(){var e=this.getSelectBox();return e?e.getItems():null},setter:function(e){var f=this.getSelectBox();if(f){f.setItems(e)}}});this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE});this.defineProp("selectBox",{dataType:"Kekule.Widget.SelectBox",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE})},finalize:function($super){this._finalizeSubElements();$super()},_finalizeSubElements:function(){var f=this.getTextBox();if(f){f.finalize()}var e=this.getSelectBox();if(e){e.finalize()}},getCoreElement:function($super){var e=this.getTextBox();if(e){return e.getElement()}else{return $super()}},doGetWidgetClassName:function($super){return $super()+" "+a.COMBOBOX},doCreateRootElement:function(f){var e=f.createElement("span");return e},doCreateSubElements:function(h,f){var e=this;this._finalizeSubElements();var j=h.createElement("span");j.className=a.COMBOBOX_TEXTWRAPPER;f.appendChild(j);var i=new Kekule.Widget.TextBox(this);i.appendToElem(j);this.setPropStoreFieldValue("textBox",i);var g=new Kekule.Widget.SelectBox(this);g.appendToElem(f);this.setPropStoreFieldValue("selectBox",g);g.addEventListener("valueChange",function(l){var n=g.getSelectedItemElem();if(n){var k=n.value;var m=n.text||n.value;if(m!==i.getText()){i.setText(m);e.notifyValueChanged()}i.selectAll();i.focus();e.invokeEvent("valueSelect",{widget:e,value:k})}});i.addEventListener("valueChange",function(k){e.textChanged()});Kekule.X.Event.addListener(i.getElement(),"keydown",function(l){var k=l.getKeyCode();if(k===Kekule.X.Event.KeyCode.DOWN){g.dropDown()}});return[j]},relayEvent:function($super,f,g){var e=g.widget;if((e===this.getTextBox())||(e===this.getSelectBox())){g.widget=this;if(f==="valueChange"){return}}return $super(f,g)},textChanged:function(){var f=this.getText();var e=this._getValueOfText(f);this.getSelectBox().setValue(e)},_getValueOfText:function(j){var f=this.getSelectBox().getItems();for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h.text&&(h.text===j)){return h.value}}return j},doSetEnabled:function(e){var g=this.getTextBox();if(g){g.setEnabled(e)}var f=this.getSelectBox();if(f){f.setEnabled(e)}},doGetValue:function($super){var f=$super();var e=this._getValueOfText(f);return e},doSetValue:function($super,j){var k=j;var f=this.getSelectBox().getItems();this.getSelectBox().setIndex(-1);for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h.value===j){k=h.text||h.value;this.getSelectBox().setIndex(g);break}}$super(k)}})})();(function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{STATE_COLLAPSED:"K-State-Collapsed",STATE_EMPTY:"K-State-Empty",NESTED_CONTAINER:"K-NestedContainer",NESTED_CONTAINER_ITEM:"K-NestedContainer-Item"});Kekule.Widget.NestedContainer=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.NestedContainer",DEF_CONTAINER_TAG:"ul",DEF_ITEM_TAG:"li",ITEM_DATA_FIELD:"__$itemData__",initialize:function($super,a){$super(a)},initProperties:function(){this.defineProp("itemInitialExpanded",{dataType:DataType.BOOL})},doCreateRootElement:function(b){var a=b.createElement("div");return a},doBindElement:function($super,a){$super(a)},getContainerElemTag:function(){return this.DEF_CONTAINER_TAG},getItemElemTag:function(){return this.DEF_ITEM_TAG},_createChildItemElem:function(){var a=this.doCreateChildItemElem();Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM);Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.STATE_EMPTY);return a},doCreateChildItemElem:function(){return this.getDocument().createElement(this.getItemElemTag())},_createChildContainerElem:function(){var a=this.doCreateChildContainerElem();Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER);return a},doCreateChildContainerElem:function(){return this.getDocument().createElement(this.getContainerElemTag())},getChildContainerElem:function(d,c){if(!d){d=this.getElement()}var b=d.getElementsByTagName(this.getContainerElemTag());var a=b.length?b[0]:null;if(!a&&c){a=this._createChildContainerElem();d.appendChild(a)}return a},getItemData:function(a){return a[this.ITEM_DATA_FIELD]},setItemData:function(f,d){this.doSetItemData(f,d);f[this.ITEM_DATA_FIELD]=d;var e=d.children;if(e&&Kekule.ArrayUtils.isArray(e)){this.clearChildItems(f);for(var b=0,a=e.length;b<a;++b){var c=e[b];this.appendChildItem(f,c)}}return this},doSetItemData:function(b,a){},hasChildItem:function(a){return this.getChildItemCount(a)>0},getChildItemCount:function(a){return this.getChildren(a).length},getChildren:function(c){var b=this.getChildContainerElem(c);if(b){var a=Kekule.DomUtils.getDirectChildElems(b,this.getItemElemTag());return a}else{return[]}},getChildItemAt:function(a,b){var c=this.getChildren(a);return(c.length&&(c.length>b))?c[b]:null},insertChildItem:function(e,d,f){var b;var a=this.getChildContainerElem(e,true);if(d&&Kekule.DomUtils.isElement(d)){b=d}else{var b=this._createChildItemElem();if(!this.getItemInitialExpanded()){Kekule.HtmlElementUtils.addClass(b,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED)}if(d){this.setItemData(b,d)}}var c=DataType.isSimpleType(f)?this.getChildren(e)[index]:f;if(c){a.insertBefore(b,c)}else{a.appendChild(b)}this.childItemsChanged(e);return b},appendChildItem:function(b,a){return this.insertChildItem(b,a)},removeChildItem:function(c,b){var a=this.getChildContainerElem(c);if(a){a.removeChild(b);if(!this.hasChildItem(c)){c.removeChild(a)}this.childItemsChanged(c)}return this},removeChildItemAt:function(b,a){var c=this.getChildItemAt(b,a);if(c){this.removeChildItem(b,c)}return this},clearChildItems:function(b){var a=this.getChildContainerElem(b);if(!b){b=this.getElement()}if(a){b.removeChild(a)}this.childItemsChanged(b)},childItemsChanged:function(a){if(a){var b=Kekule.Widget.HtmlClassNames.STATE_EMPTY;if(this.hasChildItem(a)){Kekule.HtmlElementUtils.removeClass(a,b)}else{Kekule.HtmlElementUtils.addClass(a,b)}}},expandItem:function(a){Kekule.HtmlElementUtils.removeClass(a,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED);return this},collapseItem:function(a){Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED);return this},toggleExpandStateOfItem:function(a){Kekule.HtmlElementUtils.toggleClass(a,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED);return this},isChildItem:function(a){return Kekule.HtmlElementUtils.hasClass(a,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM)},getBelongedChildItem:function(d){var b=d;var c=this.getElement();var a=this.getDocument().body;while((b!==c)&&(b!==a)){b=b.parentNode;if(this.isChildItem(b)){return b}}return null},getAllChildItems:function(e){var b=[];var a=this.getChildContainerElem(e,false);if(a){var g=Kekule.DomUtils.getDirectChildElems(a);for(var f=0,c=g.length;f<c;++f){var h=g[f];if(this.isChildItem(h)){b.push(h);var d=this.getAllChildItems(h);b=b.concat(d)}}}return b},getChildItemRange:function(c,b,g){var f=this.getAllChildItems(g);var e=f.indexOf(c);var d=f.indexOf(b);if((e>=0)&&(d>=0)){if(e>d){var a=true;var h=e;e=d;d=h}var i=f.slice(e,d+1);if(a){i=i.reverse()}return i}else{return[]}}})})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TREEVIEW:"K-TreeView",TREEVIEW_EXPANDMARK:"K-TreeView-ExpandMark",TREEVIEW_ITEMCONTENT:"K-TreeView-ItemContent"});Kekule.Widget.TreeView=Class.create(Kekule.Widget.NestedContainer,{CLASS_NAME:"Kekule.Widget.TreeView",BELONGED_ITEM_FIELD:"__$treeItem__",initProperties:function(){this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var c=this.getPropStoreFieldValue("selection");if(!c){c=[];this.setPropStoreFieldValue("selection",c)}return c},setter:function(c){this.select(c)}});this.defineProp("selectedItem",{dataType:DataType.OBJECT,serializable:false,getter:function(){var c=this.getSelection();return c.length?c[c.length-1]:null},setter:function(c){this.select(c)}});this.defineProp("enableMultiSelected",{dataType:DataType.BOOL})},doGetWidgetClassName:function(){return a.TREEVIEW},doCreateChildItemElem:function($super){var c=$super();if(c){var d=this.createGlyphContent(c,null,a.TREEVIEW_EXPANDMARK);d[this.BELONGED_ITEM_FIELD]=c;c._expandMarkerElem=d;var e=this.getDocument().createElement("span");e.className=a.TREEVIEW_ITEMCONTENT;c.appendChild(e);e[this.BELONGED_ITEM_FIELD]=c;c._contentElem=e}return c},doSetItemData:function(d,c){this.setItemText(d,c.text)},getExpandMarkerElem:function(c){return c._expandMarkerElem},getItemContentElem:function(c){return c._contentElem},getTextPartElem:function(e,d){var c=e._textPartElem;if(!c&&d){c=this.createTextContent("",this.getItemContentElem(e));e._textPartElem=c}return c},setItemText:function(d,e){var c=this.getTextPartElem(d,true);c.innerHTML=e},isItemSelected:function(d){var c=this.getSelection();return c?(c.indexOf(d)>=0):false},selectionChanged:function(){this.notifyPropSet("selection",this.getSelection())},clearSelection:function(){var e=this.getSelection();if(e.length){for(var d=0,c=e.length;d<c;++d){var f=e[d];Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(f),a.STATE_SELECTED)}this.setPropStoreFieldValue("selection",[]);this.selectionChanged()}return this},removeFromSelection:function(d){if(d){var f=Kekule.ArrayUtils.toArray(d);if(f&&f.length){var g=this.getSelection();for(var e=0,c=f.length;e<c;++e){var h=f[e];if(Kekule.ArrayUtils.remove(g,h)){Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(h),a.STATE_SELECTED)}}this.selectionChanged()}}return this},addToSelection:function(d){if(d){var h=Kekule.ArrayUtils.toArray(d);if(h&&h.length){if(!this.getEnableMultiSelected()){this.clearSelection();h=[h[h.length-1]]}var f=this.getSelection();for(var e=0,c=h.length;e<c;++e){var g=h[e];if(!this.isItemSelected(g)){Kekule.HtmlElementUtils.addClass(this.getItemContentElem(g),a.STATE_SELECTED);f.push(g)}}this.selectionChanged()}}return this},toggleSelectionState:function(d){if(d){this.beginUpdate();try{var h=Kekule.ArrayUtils.toArray(d);var f=this.getSelection();if(h&&h.length){for(var e=0,c=h.length;e<c;++e){var g=h[e];if(this.isItemSelected(g)){this.removeFromSelection(g)}else{this.addToSelection(g)}}}}finally{this.endUpdate()}}},select:function(c){this.beginUpdate();try{this.clearSelection();if(c){if(this.getEnableMultiSelected()){this.addToSelection(c)}else{var d=Kekule.ArrayUtils.toArray(c);this.addToSelection(d[d.length-1])}}}finally{this.endUpdate()}},react_click:function(h){var g=h.getTarget();var f=g[this.BELONGED_ITEM_FIELD];if(f&&this.isChildItem(f)){this.toggleExpandStateOfItem(f)}else{f=this.getBelongedChildItem(g);if(h.getShiftKey()){var d=this.getSelectedItem();if(d){var c=this.getChildItemRange(d,f);if(c.length){if(h.getCtrlKey()){this.addToSelection(c)}else{this.select(c)}}}else{this.select(f)}}else{if(h.getCtrlKey()){this.toggleSelectionState(f)}else{if(f){this.select(f)}}}}},react_dblclick:function(f){var d=f.getTarget();var c=this.getBelongedChildItem(d);if(c){this.toggleExpandStateOfItem(c)}}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.StyleUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DIALOG:"K-Dialog",DIALOG_INSIDE:"K-Dialog-Inside",DIALOG_OVERFLOW:"K-Dialog-Overflow",DIALOG_CLIENT:"K-Dialog-Client",DIALOG_CAPTION:"K-Dialog-Caption",DIALOG_BTN_PANEL:"K-Dialog-Button-Panel"});Kekule.Widget.DialogButtons={OK:"ok",CANCEL:"cancel",YES:"yes",NO:"no",isPositive:function(f){var e=Kekule.Widget.DialogButtons;return([e.OK,e.YES].indexOf(f)>=0)},isNegative:function(f){var e=Kekule.Widget.DialogButtons;return([e.CANCEL,e.NO].indexOf(f)>=0)}};Kekule.Widget.Location={DEFAULT:1,CENTER:2,FULLFILL:3,CENTER_OR_FULLFILL:4};Kekule.Widget.Dialog=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Dialog",BINDABLE_TAG_NAMES:["div","span"],BTN_NAME_FIELD:"__$btnName__",initialize:function($super,e,f,g){this._dialogCallback=null;this._modalInfo=null;this._childButtons=[];this.setPropStoreFieldValue("location",Kekule.Widget.Location.CENTER);$super(e);this._dialogOpened=false;this.setUseCornerDecoration(true);if(f){this.setCaption(f)}if(g){this.setButtons(g)}this.setDisplayed(false)},doFinalize:function($super){this.unprepareModal();$super()},initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return c.getElementText(this.getCaptionElem())},setter:function(e){c.setElementText(this.getCaptionElem(),e);b.setDisplay(this.getCaptionElem(),!!e)}});this.defineProp("buttons",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("buttons",e);if(this.getBtnPanelElem()){b.setDisplay(this.getBtnPanelElem(),e&&e.length)}this.buttonsChanged()}});this.defineProp("result",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("location",{dataType:DataType.INT});this.defineProp("clientElem",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("btnPanelElem",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC})},initPropValues:function($super){$super();if(this.setMovable){this.setMovable(true)}},getDefaultMovingGripper:function(){return this.getCaptionElem()},getCoreElement:function(){return this.getClientElem()},doGetWidgetClassName:function(){return a.DIALOG},doCreateRootElement:function(f){var e=f.createElement("div");return e},doCreateSubElements:function(h,f){var e=[];var g=h.createElement("div");g.className=a.DIALOG_CAPTION;f.appendChild(g);this.setPropStoreFieldValue("captionElem",g);e.push(g);if(this.setMovingGripper){this.setMovingGripper(g)}var g=h.createElement("div");g.className=a.DIALOG_CLIENT;f.appendChild(g);this.setPropStoreFieldValue("clientElem",g);this.doCreateClientContents(g);e.push(g);var g=h.createElement("div");g.className=a.DIALOG_BTN_PANEL;f.appendChild(g);this.setPropStoreFieldValue("btnPanelElem",g);e.push(g);this.buttonsChanged();return e},doCreateClientContents:function(e){},buttonsChanged:function(){for(var g=this._childButtons.length-1;g>=0;--g){var f=this._childButtons[g];f.finalize()}var h=this.getButtons()||[];for(var g=0,e=h.length;g<e;++g){this.createDialogButton(h[g])}},createDialogButton:function(k,f,j,g){var i=this._getPredefinedButtonInfo(k);if(!i){i={text:k}}if(i){var h=new Kekule.Widget.Button(this,i.text);h[this.BTN_NAME_FIELD]=k;h.addEventListener("execute",this._reactDialogBtnExec,this);h.appendToElem(this.getBtnPanelElem());h.__$name__=k;var e=f||this._getDialogButtonResName(k);if(e){h.linkStyleResource(e)}this._childButtons.push(h);return h}else{return null}},_getDialogButtonResName:function(f){var e=Kekule.Widget.DialogButtons;if([e.OK,e.YES].indexOf(f)>=0){return Kekule.Widget.StyleResourceNames.BUTTON_YES_OK}else{if([e.CANCEL,e.NO].indexOf(f)>=0){return Kekule.Widget.StyleResourceNames.BUTTON_NO_CANCEL}else{return null}}},_reactDialogBtnExec:function(i){var f=Kekule.Widget.DialogButtons;var h=[f.OK,f.YES,f.CANCEL,f.NO];var g=i.target;if(g){var j=g.__$name__;if(h.indexOf(j)>=0){this.setResult(j);this.close(j)}}},_getPredefinedButtonInfo:function(i){var f=Kekule.Widget.DialogButtons;var h=[f.OK,f.CANCEL,f.YES,f.NO];var g=[Kekule.$L("WidgetTexts.CAPTION_OK"),Kekule.$L("WidgetTexts.CAPTION_CANCEL"),Kekule.$L("WidgetTexts.CAPTION_YES"),Kekule.$L("WidgetTexts.CAPTION_NO")];var e=h.indexOf(i);return(e>=0)?{text:g[e]}:null},getDialogButton:function(g){for(var f=this._childButtons.length-1;f>=0;--f){var e=this._childButtons[f];if(e[this.BTN_NAME_FIELD]===g){return e}}return null},needAdjustPosition:function(){var f=this.getShowHideType();var g=Kekule.Widget.ShowHideType;var e=(f!==g.DROPDOWN);return e},_storePositionInfo:function(){if(!this.needAdjustPosition()){return}var f=this.getElement();var e=f.style;this._posInfo={left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,position:e.position}},_restorePositionInfo:function(){if(!this.needAdjustPosition()){return}var f=this.getElement();var e=f.style;var g=this._posInfo;if(g){e.left=g.left;e.top=g.top;e.right=g.right;e.bottom=g.bottom;e.width=g.width;e.height=g.height;e.position=g.position}},adjustLocation:function(){if(!this.needAdjustPosition()){return}this._storePositionInfo();var j=Kekule.Widget.Location;var e=this.getLocation()||j.DEFAULT;var s=false;if(e!==j.DEFAULT){var u,n,m,x,p,z;var A=this.getDisplayed();var E=this.getVisible();try{this.setDisplayed(true,true);this.setVisible(true,true);var q=Kekule.DocumentUtils.getInnerClientDimension(this.getDocument());var B=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),true);var g=B.right-B.left;var D=B.bottom-B.top;var k=this.getOffsetParent();var f=k?Kekule.HtmlElementUtils.getElemPageRect(k,true):{left:0,top:0,width:0,height:0};s=(g>=q.width)||(D>=q.height)}finally{this.setVisible(E,true);this.setDisplayed(A,true)}if(e===j.CENTER_OR_FULLFILL){if(s){var i=Kekule.DocumentUtils.getClientVisibleBox(this.getDocument());if(g>=q.width){u=0;p=0}else{u=(q.width-g)/2}if(D>=q.height){n=0;z=0}else{n=(q.height-D)/2}}else{e=j.CENTER}}if(e===j.FULLFILL){u=0;n=0;p=0;z=0}else{if(e===j.CENTER){u=(q.width-g)/2;n=(q.height-D)/2}}if(s){this.removeClassName(a.DIALOG_INSIDE);this.addClassName(a.DIALOG_OVERFLOW);var o=Kekule.DocumentUtils.getScrollPosition(this.getDocument());u+=o.left;n+=o.top;if(u<0){u=0}if(n<0){n=0}}else{this.removeClassName(a.DIALOG_OVERFLOW);this.addClassName(a.DIALOG_INSIDE)}var v=this.getElement().style;var y=Kekule.ObjUtils.notUnset;if(y(u)){v.left=u+"px"}if(y(n)){v.top=n+"px"}if(y(p)){v.right=p+"px"}if(y(z)){v.bottom=p+"px"}if(y(m)){v.width=m+"px"}if(y(x)){v.height=x+"px"}this.adjustClientSize(m,x,s)}this._posAdjusted=true},adjustClientSize:function(f,e,g){},prepareShow:function(g){var f=this.getElement();if(!f.parentNode){this.getDocument().body.appendChild(f)}var e=this;setTimeout(function(){e._dialogCallback=g},0)},openModal:function(f,e){this.getGlobalManager().prepareModalWidget(this);return this.open(f,e)},openPopup:function(f,e){return this.open(f,e,Kekule.Widget.ShowHideType.POPUP)},open:function(g,e,f){this.prepareShow(g);this.show(e,null,f||Kekule.Widget.ShowHideType.DIALOG);this._dialogOpened=true;return this},close:function(e){this.setResult(e);this.hide()},isPositiveResult:function(e){return Kekule.Widget.DialogButtons.isPositive(e||this.getResult())},isNegativeResult:function(e){return Kekule.Widget.DialogButtons.isNegative(e||this.getResult())},widgetShowStateBeforeChanging:function($super,e){$super(e);if(e){this.adjustLocation();this.setResult(null)}else{}},doWidgetShowStateChanged:function($super,e){$super(e);if(!e){if(this._dialogCallback){this._dialogCallback(this.getResult());this._dialogCallback=null}}},widgetShowStateDone:function($super,e){$super(e);if(!e&&this._dialogOpened){if(this.getModalInfo()){this.getGlobalManager().unprepareModalWidget(this)}if(!this.isShown()){this._restorePositionInfo()}this._dialogOpened=false}}})})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MSGPANEL:"K-MsgPanel",MSGPANEL_CONTENT:"K-MsgPanel-Content",MSGGROUP:"K-MsgGroup",MSGGROUP_FOR_WIDGET:"K-Widget-MsgGroup",MSG_NORMAL:"K-Msg-Normal",MSG_INFO:"K-Msg-Info",MSG_WARNING:"K-Msg-Warning",MSG_ERROR:"K-Msg-Error"});Kekule.Widget.MsgType={NORMAL:"",INFO:"info",WARNING:"warning",ERROR:"error"};Kekule.Widget.MsgPanel=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.MsgPanel",BINDABLE_TAG_NAMES:["span","div"],initialize:function($super,c,e,d){this._contentElem=null;this._elemTextPart=null;this._elemLeadingGlyphPart=null;this._elemTailingGlyphPart=null;this.setPropStoreFieldValue("showText",true);$super(c);if(e){this.setText(e)}if(d){this.setMsgType(d)}this.setUseCornerDecoration(true)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(c){this.changeContentText(c)}});this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,setter:function(c){this.setPropStoreFieldValue("showLeadingGlyph",c);this._elemLeadingGlyphPart.style.display=c?"":"none"}});this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,setter:function(c){this.setPropStoreFieldValue("showTailingGlyph",c);this._elemTailingGlyphPart.style.display=c?"":"none"}});this.defineProp("msgType",{dataType:DataType.STRING,setter:function(e){var c=this.getMsgType();if(c!==e){var d=this.getClassNameForMsgType(c);var f=this.getClassNameForMsgType(e);if(d!==f){this.removeClassName(d);this.addClassName(f)}this.setPropStoreFieldValue("msgType",e)}}})},doGetWidgetClassName:function($super){return $super()+" "+a.MSGPANEL},doCreateRootElement:function(d){var c=d.createElement("span");return c},doCreateSubElements:function($super,e,c){var f=b.getInnerText(c);c.innerHTML="";var d=e.createElement("span");d.className=a.MSGPANEL_CONTENT;c.appendChild(d);this._contentElem=d;this._elemTextPart=this.createTextContent(f,d);this._elemLeadingGlyphPart=this.createGlyphContent(d,this._elemTextPart,a.PART_PRI_GLYPH_CONTENT);this._elemTailingGlyphPart=this.createGlyphContent(d,null,a.PART_ASSOC_GLYPH_CONTENT)},doSetUseCornerDecoration:function($super,c){$super(c);if(c){Kekule.HtmlElementUtils.addClass(this._contentElem,a.CORNER_ALL)}else{Kekule.HtmlElementUtils.removeClass(this._contentElem,a.CORNER_ALL)}},getTextSelectable:function(){return true},changeContentText:function(c){Kekule.DomUtils.setElementText(this._elemTextPart,c||"")},getClassNameForMsgType:function(c){var d=Kekule.Widget.MsgType;switch(c){case d.INFO:return a.MSG_INFO;case d.WARNING:return a.MSG_WARNING;case d.ERROR:return a.MSG_ERROR;default:return a.MSG_NORMAL}}});Kekule.Widget.MsgGroup=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.MsgGroup",BINDABLE_TAG_NAMES:["span","div"],initialize:function($super,c){$super(c);this.setLayout(Kekule.Widget.Layout.VERTICAL)},initProperties:function(){this.defineProp("reversedOrder",{dataType:DataType.BOOL});this.defineProp("maxMsgCount",{dataType:DataType.INT,setter:function(c){this.setPropStoreFieldValue("maxMsgCount",c);this.clearExcessiveMsgs()}});this.defineProp("msgFlashTime",{dataType:DataType.INT})},initPropValues:function($super){$super();this.setMsgFlashTime(6000)},doGetWidgetClassName:function($super){return $super()+" "+a.MSGGROUP},doCreateRootElement:function(d){var c=d.createElement("div");return c},addMessage:function(i,d,h,e){if(i||d){var c=new Kekule.Widget.MsgPanel(this,i,d);c.setFinalizeAfterHiding(true);if(e){c.addClassName(e)}var g=this.getReversedOrder();if(g){c.insertToWidget(this,this.getChildAt(0))}else{c.appendToWidget(this)}var f=Kekule.ObjUtils.isUnset(h)?this.getMsgFlashTime():h;if(f){c.flash(f,this)}else{c.show(this)}this.clearExcessiveMsgs();return c}},clearExcessiveMsgs:function(){var h=this.getMaxMsgCount();if(h&&h>0){var g=this.getChildWidgets().length;var f=g-h;if(f>0){var e=0;var d=this;var c;var i=function(){if(e<f){c=d.getOldestMsgPanel();d.hideMsgPanel(c,i);++e}};i()}}},getOldestMsgPanel:function(){return this.getReversedOrder()?this.getLastChild():this.getFirstChild()},hideMsgPanel:function(c,d){c.hide(this,d);return c}});ClassEx.defineProp(Kekule.Widget.BaseWidget,"msgReporter",{dataType:"Kekule.Widget.MsgGroup",serializable:false,setter:null,getter:function(d){var c=this.getPropStoreFieldValue("msgReporter");if(!c&&d){c=new Kekule.Widget.MsgGroup(this);c.addClassName(a.MSGGROUP_FOR_WIDGET);c.appendToWidget(this);this.setPropStoreFieldValue("msgReporter",c)}return c}});ClassEx.extend(Kekule.Widget.BaseWidget,{reportMessage:function(h,d,g,f){var e=this.getMsgReporter(true);var c=e.addMessage(h,d,g||0,f);e.setDisplayed(true);return c},flashMessage:function(f,c,e,d){return this.reportMessage(f,c,e||this.getMsgReporter(true).getMsgFlashTime(),d)},removeMessage:function(c){c.hide()}})})();(function(){var c=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;var a=Kekule.ArrayUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TABVIEW:"K-TabView",TABVIEW_TABBUTTON:"K-TabView-TabButton",TABVIEW_CLIENT:"K-TabView-Client",TABVIEW_PAGE:"K-TabView-Page",TABVIEW_ACTIVE_PAGE:"K-TabView-Active-Page",TABVIEW_TABBUTTON_CONTAINER:"K-TabView-TabButton-Container",TABVIEW_PAGE_CONTAINER:"K-TabView-Page-Container",TABBUTTONGROUP:"K-TabButtonGroup",TAB_AT_LEFT:"K-TabAtLeft",TAB_AT_RIGHT:"K-TabAtRight",TAB_AT_TOP:"K-TabAtTop",TAB_AT_BOTTOM:"K-TabAtBottom"});Kekule.Widget.TabPage=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.TabPage",initProperties:function(){this.defineProp("text",{dataType:DataType.STRING})},doGetWidgetClassName:function($super){return $super()+" "+b.TABVIEW_PAGE},doCreateRootElement:function(e){var d=e.createElement("div");return d}});Kekule.Widget.TabButtonGroup=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.TabButtonGroup",initialize:function($super,d){$super(d);this.addEventListener("execute",function(g){var f=g.target;if((f instanceof Kekule.Widget.RadioButton)){this.invokeEvent("switch",{button:f})}},this);this.tabButtonPosChanged()},initProperties:function(){this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(d){if(this.getTabButtonPosition()!==d){this.setPropStoreFieldValue("tabButtonPosition",d);this.tabButtonPosChanged()}}})},initPropValues:function($super){$super();this.setUseCornerDecoration(false)},doGetWidgetClassName:function($super){return $super()+" "+b.TABBUTTONGROUP},tabButtonPosChanged:function(){var e=Kekule.Widget.Position;var g=this.getTabButtonPosition();var f=(g&e.LEFT)||(g&e.RIGHT);var d=(g&e.RIGHT)?b.TAB_AT_RIGHT:(g&e.BOTTOM)?b.TAB_AT_BOTTOM:(g&e.LEFT)?b.TAB_AT_LEFT:b.TAB_AT_TOP;if(this._lastTabBtnPosClassName){this.removeClassName(this._lastTabBtnPosClassName)}this._lastTabBtnPosClassName=d;this.addClassName(this._lastTabBtnPosClassName);this.setLayout(f?Kekule.Widget.Layout.VERTICAL:Kekule.Widget.Layout.HORIZONTAL)}});Kekule.Widget.TabView=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.TabView",TAB_BTN_FIELD:"__$tabButton__",initialize:function($super,d){this._tabBtnContainer=null;this._pageContainer=null;$super(d);if(Kekule.ObjUtils.isUnset(this.getUseCornerDecoration())){this.setUseCornerDecoration(true)}this.tabButtonPosChanged();this.addEventListener("change",this.reactTabPagePropChange,this)},doFinalize:function($super){if(this.getTabGroup()){this.getTabGroup().finalize()}$super()},initProperties:function(){this.defineProp("tabPages",{dataType:DataType.ARRAY,serializable:false,getter:function(){var d=this.getPropStoreFieldValue("tabPages");if(!d){d=[];this.setPropStoreFieldValue("tabPages",d)}return d},setter:null});this.defineProp("activeTabPage",{dataType:"Kekule.Widget.TabPage",serializable:false,setter:function(e){var d=this.getActiveTabPage();if(d!==e){if(this.hasChild(e)){this.setPropStoreFieldValue("activeTabPage",e);if(d){d.removeClassName(b.TABVIEW_ACTIVE_PAGE);this._getPageTabButton(d).setChecked(false)}if(e){e.addClassName(b.TABVIEW_ACTIVE_PAGE);this._getPageTabButton(e).setChecked(true);this.invokeEvent("switchTab",{tabPage:e})}}}}});this.defineProp("activeTabIndex",{dataType:DataType.INT,serializable:false,getter:function(){return this.getTabPages().indexOf(this.getActiveTabPage())},setter:function(e){var d=this.getTabPages()[e];if(d){this.setActiveTabPage(d)}}});this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(d){if(this.getTabButtonPosition()!==d){this.setPropStoreFieldValue("tabButtonPosition",d);this.tabButtonPosChanged()}}});this.defineProp("showTabButtons",{dataType:DataType.BOOL,getter:function(){var d=this.getTabGroup();return d&&d.getDisplayed()},setter:function(e){var d=this.getTabGroup();if(d){d.setDisplayed(e)}}});this.defineProp("tabGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+b.TABVIEW},doCreateRootElement:function(e){var d=e.createElement("div");return d},doCreateSubElements:function(g,f){var h=g.createElement("div");h.className=b.TABVIEW_TABBUTTON_CONTAINER;var e=g.createElement("div");e.className=b.TABVIEW_PAGE_CONTAINER;this._tabBtnContainer=h;this._pageContainer=e;f.appendChild(h);f.appendChild(e);this.setPropStoreFieldValue("tabGroup",this.doCreateTabbar(g,h));var d=[h,e];return d},doCreateTabbar:function(f,e){var d=new Kekule.Widget.TabButtonGroup(f);d.setParent(this);d.appendToElem(e);d.addEventListener("switch",function(i){var g=i.button;var h=this._getPageOfTabButton(g);if(h){this.setActiveTabPage(h)}},this);return d},getChildrenHolderElement:function(){return this._pageContainer},getContainerElement:function(){return this._pageContainer},_getPageTabButton:function(d){return d[this.TAB_BTN_FIELD]},_setPageTabButton:function(d,e){d[this.TAB_BTN_FIELD]=e},_getPageOfTabButton:function(g){var d=this.getTabPages();for(var f=0,e=d.length;f<e;++f){var h=d[f];if(this._getPageTabButton(h)===g){return h}}return null},childWidgetAdded:function($super,e){$super(e);if(e instanceof Kekule.Widget.TabPage){var d=!this.getTabPages().length;e.appendToElem(this._pageContainer);this.getTabPages().push(e);this._insertTabButtonBefore(e);if(d){this.setActiveTabPage(e)}}},childWidgetRemoved:function($super,d){$super(d);if(d instanceof Kekule.Widget.TabPage){a.remove(this.getTabPages(),d);this._removeTabButton(d)}},childWidgetMoved:function($super,e,d){$super(e,d);if(e instanceof Kekule.Widget.TabPage){this._changeTabIndex(e,d)}},_insertTabButtonBefore:function(d,g){var f=this.getTabGroup();var e=new Kekule.Widget.RadioButton(this.getDocument());this._updateTabButton(d,e);this._setPageTabButton(d,e);if(g){e.insertToWidget(f,g)}else{e.appendToWidget(f)}},_updateTabButton:function(d,e){if(!e){e=this._getPageTabButton(d)}e.setText(d.getText()||"");if(d.getHint()){e.setHint(d.getHint())}},_removeTabButton:function(d){var e=this._getPageTabButton(d);if(e){e.finalize()}},_changeTabIndex:function(e,g){var f=this._getPageTabButton(e);this.getTabGroup()._moveChild(f,g);var d=this.getTabPages();var h=d.indexOf(e);if(h>=0&&h!==g){a.changeItemIndex(d,e,g)}},reactTabPagePropChange:function(g){var f=g.target;if(f instanceof Kekule.Widget.TabPage){var d=this._getPageTabButton(f);if(d){this._updateTabButton(f,d)}}},tabButtonPosChanged:function(){var f=Kekule.Widget.Position;var h=this.getTabButtonPosition();var e=(h&f.BOTTOM)||(h&f.RIGHT);var g=(h&f.LEFT)||(h&f.RIGHT);var d=(h&f.RIGHT)?b.TAB_AT_RIGHT:(h&f.BOTTOM)?b.TAB_AT_BOTTOM:(h&f.LEFT)?b.TAB_AT_LEFT:b.TAB_AT_TOP;if(this._lastTabBtnPosClassName){this.removeClassName(this._lastTabBtnPosClassName)}this._lastTabBtnPosClassName=d;this.addClassName(this._lastTabBtnPosClassName);this.getTabGroup().setTabButtonPosition(h);if(e){this.getElement().appendChild(this._tabBtnContainer)}else{this.getElement().insertBefore(this._tabBtnContainer,this._pageContainer)}},createNewTabPage:function(i,h,e){var g=this.getDocument();var d=new Kekule.Widget.TabPage(g);d.setText(i);if(h){d.setHint(h)}d.appendToWidget(this);if(e){var f=this.getChildWidgets().indexOf(e);this._moveChild(d,f)}return d}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{VALUELISTEDITOR:"K-ValueListEditor",VALUELISTEDITOR_ROW:"K-ValueListEditor-Row",VALUELISTEDITOR_CELL:"K-ValueListEditor-Cell",VALUELISTEDITOR_INDICATORCELL:"K-ValueListEditor-IndicatorCell",VALUELISTEDITOR_KEYCELL:"K-ValueListEditor-KeyCell",VALUELISTEDITOR_VALUECELL:"K-ValueListEditor-ValueCell",VALUELISTEDITOR_CELL_CONTENT:"K-ValueListEditor-CellContent",VALUELISTEDITOR_VALUECELL_TEXT:"K-ValueListEditor-ValueCellText",VALUELISTEDITOR_INLINE_EDIT:"K-ValueListEditor-InlineEdit",VALUELISTEDITOR_EXPANDMARK:"K-ValueListEditor-ExpandMark",VALUELISTEDITOR_ACTIVE_ROW:"K-ValueListEditor-ActiveRow"});Kekule.Widget.ValueListEditor=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ValueListEditor",BINDABLE_TAG_NAMES:["table"],ROW_ELEM_TAG:"tr",CELL_ELEM_TAG:"td",ROW_DATA_FIELD:"__$row_data__",ROW_EDIT_INFO_FIELD:"__$row_edit_info__",initialize:function($super,e){$super(e);this._inlineEdit=null;this._isActivitingRow=false},initProperties:function(){this.defineProp("hash",{dataType:DataType.HASH,getter:function(){return this._getTotalHash()},setter:function(e){this._setTotalHash(e);this.setPropStoreFieldValue("hash",e)}});this.defineProp("readOnly",{dataType:DataType.BOOL});this.defineProp("useKeyHint",{dataType:DataType.BOOL});this.defineProp("valueDisplayMode",{dataType:DataType.INT,enumSource:Kekule.Widget.ValueListEditor.ValueDisplayMode,setter:function(e){if(this.getValueDisplayMode()!==e){this.setPropStoreFieldValue("valueDisplayMode",e);this.valueDisplayModeChanged()}}});this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){var e=this.getActiveRow();if(e!==f){if(e){this.finishEditing();d.removeClass(e,b.VALUELISTEDITOR_ACTIVE_ROW);this._showValueCellText(e)}if(this._inlineEdit){this._inlineEdit.finalize()}if(f){d.addClass(f,b.VALUELISTEDITOR_ACTIVE_ROW);if(!this.getReadOnly()){this.createValueEditWidget(f)}}this.setPropStoreFieldValue("activeRow",f);this.invokeEvent("activeRowChange",{row:f})}}})},doGetWidgetClassName:function(){return b.VALUELISTEDITOR},doCreateRootElement:function(f){var e=f.createElement("table");return e},doBindElement:function($super,e){$super(e)},getRootElem:function(){return this.getElement()},createRowElem:function(f){var e=f.createElement(this.ROW_ELEM_TAG);d.addClass(e,b.VALUELISTEDITOR_ROW);return e},createCellElem:function(f){var e=f.createElement(this.CELL_ELEM_TAG);d.addClass(e,b.VALUELISTEDITOR_CELL);return e},createIndicatorCellElem:function(g){var e=this.createCellElem(g);d.addClass(e,b.VALUELISTEDITOR_INDICATORCELL);var f=g.createElement("span");e.appendChild(f);return e},createKeyCellElem:function(f){var e=this.createCellElem(f);d.addClass(e,b.VALUELISTEDITOR_KEYCELL);return e},createValueCellElem:function(f){var e=this.createCellElem(f);d.addClass(e,b.VALUELISTEDITOR_VALUECELL);return e},createValueEditWidget:function(h){var f=null;if(h===this.getActiveRow()){f=this._inlineEdit}else{if(this._inlineEdit){this._inlineEdit.finalize();this._inlineEdit=null}}if(!f){f=this.doCreateValueEditWidget(h);f.setBubbleUiEvents(true);d.addClass(f.getElement(),b.VALUELISTEDITOR_INLINE_EDIT);var e=this.getValueCell(h);var g=this.getCellContentWrapper(e,true);f.appendToElem(g)}if(f){if(f.focus){f.focus()}if(f.selectAll){f.selectAll()}this._inlineEdit=f;this._hideValueCellText(h)}return f},doCreateValueEditWidget:function(j){var i=this.getRowData(j);var h=this.getValueCellText(j,i);var f=this.getValueEditWidgetInfo(j);var g=f.widgetClass;var e=new g(this);if(f.propValues){e.setPropValues(f.propValues)}e.setValue(h);return e},getDefaultValueEditWidgetInfo:function(){return{widgetClass:Kekule.Widget.TextBox}},getValueEditWidgetInfo:function(e){return this.getRowEditInfo(e)||this.getDefaultValueEditWidgetInfo()},getRowElems:function(){if(this.getRootElem()){return c.getDirectChildElems(this.getRootElem(),this.ROW_ELEM_TAG)}else{return[]}},getRows:function(){return this.getRowElems()},getRowCount:function(){var e=this.getRowElems();return e?e.length:0},getRowAt:function(e){var f=this.getRowElems();return f?f[e]:null},getPrevRow:function(g){var f=this.ROW_ELEM_TAG.toLowerCase();var e=g.previousSibling;while(e&&((e.nodeType!==Node.ELEMENT_NODE)||(e.tagName.toLowerCase()!==f))){e=e.previousSibling}return e},getNextRow:function(g){var f=this.ROW_ELEM_TAG.toLowerCase();var e=g.nextSibling;while(e&&((e.nodeType!==Node.ELEMENT_NODE)||(e.tagName.toLowerCase()!==f))){e=e.nextSibling}return e},getKeyCell:function(f){var e=c.getDirectChildElems(f,this.CELL_ELEM_TAG);return e[1]},getCellContentWrapper:function(f,h){var g=c.getDirectChildElems(f);var e=g?g[0]:null;if(!e&&h){e=f.ownerDocument.createElement("span");f.appendChild(e);d.addClass(e,b.VALUELISTEDITOR_CELL_CONTENT)}return e},getValueCellTextWrapper:function(f,i){var e=null;var h=this.getCellContentWrapper(f,i);if(h){var g=h.getElementsByTagName("span");e=g?g[0]:null;if(!e&&i){e=f.ownerDocument.createElement("span");h.appendChild(e);d.addClass(e,b.VALUELISTEDITOR_VALUECELL_TEXT)}}return e},_hideValueCellText:function(f){var e=this.getValueCellTextWrapper(this.getValueCell(f));if(e){e.style.visibility="hidden"}},_showValueCellText:function(f){var e=this.getValueCellTextWrapper(this.getValueCell(f));if(e){e.style.visibility="visible"}},getValueCell:function(f){var e=c.getDirectChildElems(f,this.CELL_ELEM_TAG);return e[2]},getParentCell:function(f){var e=c.getNearestAncestorByTagName(f,this.CELL_ELEM_TAG,true);return e},getParentRow:function(f){var e=c.getNearestAncestorByTagName(f,this.ROW_ELEM_TAG,true);return e},_createNewRow:function(h){var j=this.getDocument();var e=this.createRowElem(j);if(e){var i=this.createIndicatorCellElem(j);e.appendChild(i);var f=this.createKeyCellElem(j);e.appendChild(f);var g=this.createValueCellElem(j);e.appendChild(g);if(h){this.setRowData(e,h)}}return e},insertRowBefore:function(f,e){var g=this._createNewRow(f);if(g){this.getRootElem().insertBefore(g,e||null)}return g},appendRow:function(e){return this.insertRowBefore(e,null)},removeRow:function(e){if(e===this.getActiveRow()){this.setActiveRow(null)}this.getRootElem().removeChild(e);return this},removeRowAt:function(e){var f=this.getRowAt(e);if(f){this.removeRow(f)}return this},clear:function(){this.setActiveRow(null);if(this.getRootElem()){Kekule.DomUtils.clearChildContent(this.getRootElem())}},updateAll:function(){var h=this.getRowElems();for(var f=0,e=h.length;f<e;++f){var j=h[f];var g=this.getRowData(j);this.setRowData(j,g)}return this},valueDisplayModeChanged:function(){this.updateAll()},getKeyCellText:function(f,e){return e.title||e.key},getKeyCellHint:function(f,e){return e.hint||this.getKeyCellText(f,e)},getValueCellText:function(h,f){var g=this.getValueDisplayMode();var e=(g===a.JSON)?JSON.stringify(f.value):""+f.value;return e},valueCellTextToValue:function(e,h,g){var f=this.getValueDisplayMode();return(f===a.JSON)?JSON.parse(e):e},setValueCellText:function(e,h){var g=this.getRowData(h);var f=this.valueCellTextToValue(e,h,g);g.value=f;this.setRowData(h,g);return this},getRowData:function(e){return e[this.ROW_DATA_FIELD]},setRowData:function(f,e){f[this.ROW_DATA_FIELD]=e;this.setRowKeyCellContent(f,this.getKeyCellText(f,e),this.getKeyCellHint(f,e));this.setRowValueCellContent(f,this.getValueCellText(f,e));if(f===this.getActiveRow()&&this._inlineEdit){this.createValueEditWidget(f)}},setRowKeyCellContent:function(i,g,f){var e=this.getKeyCell(i);var h=this.getCellContentWrapper(e,true);h.innerHTML=g;if(this.getUseKeyHint()){h.title=f}},setRowValueCellContent:function(h,f){var e=this.getValueCell(h);var i=this.getValueCellTextWrapper(e,true);var g=f;if(g===""){i.innerHTML="&nbsp;"}else{Kekule.DomUtils.setElementText(i,g)}},getRowEditInfo:function(e){return e[this.ROW_EDIT_INFO_FIELD]},setRowEditInfo:function(f,e){f[this.ROW_EDIT_INFO_FIELD]=e;if(f===this.getActiveRow()){this.setActiveRow(null);this.setActiveRow(activeRow)}},editRow:function(e){this.setActiveRow(e)},finishEditing:function(){var e=this.getActiveRow();if(e&&this._inlineEdit){this.setValueCellText(this._inlineEdit.getValue(),e);this.invokeEvent("editFinish",{row:e})}return this},cancelEditing:function(){var f=this.getActiveRow();if(f&&this._inlineEdit){var e=this.getRowData(f);this.setRowData(f,e);this.invokeEvent("editCancel",{row:f})}return this},_getTotalHash:function(){var e={};var j=this.getRowElems();for(var g=0,f=j.length;g<f;++g){var k=j[g];var h=this.getRowData(k);if(h){e[h.key]=h.value}}return e},_setTotalHash:function(g){var p=this.getRowElems();var e=p.length;var n=Kekule.ObjUtils.getOwnedFieldNames(g);var f=n.length;for(var h=0;h<f;++h){var m=n[h];var j=g[m];var o;if(h<e){o=this.getRowAt(h);this.setRowData(o,{key:m,value:j})}else{o=this.appendRow({key:m,value:j})}}if(e>f){for(var h=e-1;h>=f;--h){this.removeRow(p[h])}}var k=this.getActiveRow();if(k){this.setActiveRow(null);this.setActiveRow(k)}return this},react_click:function(g){var f=g.getTarget();var h=this.getParentRow(f);if(h){this.setActiveRow(h)}},react_keydown:function(i){var h=i.getKeyCode();var f=!(i.getAltKey()||i.getShiftKey()||i.getCtrlKey());if(f){var g=this.getActiveRow();if(g){var j;if(h===Kekule.X.Event.KeyCode.UP){j=this.getPrevRow(g)}else{if(h===Kekule.X.Event.KeyCode.DOWN){j=this.getNextRow(g)}}if(j){this.setActiveRow(j)}}}},react_keyup:function(g){var f=g.getKeyCode();if(f===Kekule.X.Event.KeyCode.ESC){this.cancelEditing()}else{if(f===Kekule.X.Event.KeyCode.ENTER){this.finishEditing()}}},react_blur:function(f){return;this.finishEditing();this.setActiveRow(null)}});Kekule.Widget.ValueListEditor.ValueDisplayMode={SIMPLE:0,JSON:1};var a=Kekule.Widget.ValueListEditor.ValueDisplayMode})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{COLORPICKER:"K-ColorPicker",COLORPICKER_HEADER:"K-ColorPicker-Header",COLORPICKER_SPEC_COLOR_PALETTE:"K-ColorPicker-Spec-Color-Palette",COLORPICKER_HEXBOX:"K-ColorPicker-HexBox",COLORPICKER_PREVIEWER:"K-ColorPicker-Previewer",COLORPICKER_INPUT:"K-ColorPicker-Input",COLORPICKER_BROWSE_BTN:"K-ColorPicker-Browse-Btn",COLORPICKER_PALETTE:"K-ColorPicker-Palette",COLORPICKER_PALETTE_LINE:"K-ColorPicker-Palette-Line",COLORPICKER_PALETTE_CELL:"K-ColorPicker-Palette-Cell",COLORPICKER_PALETTE_CELL_TRANSPARENT:"K-ColorPicker-Palette-Cell-Transparent",COLORPICKER_SPEC_COLOR_UNSET:"K-Color-Unset",COLORPICKER_SPEC_COLOR_DEFAULT:"K-Color-Default",COLORPICKER_SPEC_COLOR_MIXED:"K-Color-Mixed",COLORPICKER_SPEC_COLOR_TRANSPARENT:"K-Color-Transparent",COLORDROPTEXTBOX:"K-ColorDropTextBox",COLORDROPBUTTON:"K-ColorDropButton",COLORPREVIEWER:"K-ColorPreviewer"});Kekule.Widget.ColorPicker=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ColorPicker",COLOR_VALUE_FIELD:"__$colorValue__",COLOR_TEXT_FIELD:"__$colorText__",COLOR_CLASS_FIELD:"__ $colorClass__",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,d){$super(d);this.setUseCornerDecoration(true);this.setValue("#000000");this.setTouchAction("none")},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,setter:function(d){this.setPropStoreFieldValue("value",d);this.getHexBox().innerHTML=d||"&nbsp;";this.getPreviewer().style.backgroundColor=d||"transparent";if(this.getColorInput()){this.getColorInput().value=d}}});this.defineProp("colorClassName",{dataType:DataType.STRING});this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(d){this.setPropStoreFieldValue("specialColors",d);this._recreateSpecialColorPaletteCells(this.getDocument(),this.getSpecialColorPalette())}});this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:false});this.defineProp("hexBox",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("palette",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("previewer",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("colorInput",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("specialColorPalette",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("isPicking",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+a.COLORPICKER},doCreateRootElement:function(e){var d=e.createElement("div");return d},doCreateSubElements:function(f,e){var d=[];d.push(this.doCreateHeader(f,e));d.push(this.doCreatePalette(f,e));return d},doCreateHeader:function(h,e){var d=h.createElement("div");d.className=a.COLORPICKER_HEADER;d.appendChild(this.doCreateSpecialColorPalette(h));d.appendChild(this.doCreateHexBox(h));d.appendChild(this.doCreatePreviewer(h));var g=this.doCreateColorInput(h);if(g){d.appendChild(g);var f=this.doCreateColorDialogBtn(h);if(f){f.appendToElem(d)}}e.appendChild(d);return d},doCreateSpecialColorPalette:function(e){var d=e.createElement("div");d.className=a.COLORPICKER_SPEC_COLOR_PALETTE;this._recreateSpecialColorPaletteCells(e,d);this.setSpecialColorPalette(d);return d},_isPredefinedSpecialColor:function(d){var f=Kekule.Widget.ColorPicker.SpecialColors;var e=[f.UNSET,f.DEFAULT,f.MIXED,f.TRANSPARENT];return e.indexOf(d)>=0},_getPredefinedSpecialColorInfo:function(e){var j=Kekule.Widget.ColorPicker.SpecialColors;var g=[j.UNSET,j.DEFAULT,j.MIXED,j.TRANSPARENT];var i=[a.COLORPICKER_SPEC_COLOR_UNSET,a.COLORPICKER_SPEC_COLOR_DEFAULT,a.COLORPICKER_SPEC_COLOR_MIXED,a.COLORPICKER_SPEC_COLOR_TRANSPARENT];var h=[Kekule.$L("WidgetTexts.S_COLOR_UNSET"),Kekule.$L("WidgetTexts.S_COLOR_DEFAULT"),Kekule.$L("WidgetTexts.S_COLOR_MIXED"),Kekule.$L("WidgetTexts.S_COLOR_TRANSPARENT"),];var d={value:e};var f=g.indexOf(e);if(f>=0){d.text=h[f];d.className=i[f]}return d},_recreateSpecialColorPaletteCells:function(m,d){Kekule.DomUtils.clearChildContent(d);var f=this.getSpecialColors();if(f&&f.length){for(var h=0,e=f.length;h<e;++h){var g=f[h];var k;var j={};if(DataType.isObjectValue(g)){j=g}else{if(this._isPredefinedSpecialColor(g)){j=this._getPredefinedSpecialColorInfo(g)}else{j.value=g}}k=this.doCreatePaletteCell(m,j.value,j.text,j.className);if(j.className){Kekule.HtmlElementUtils.addClass(k,j.className)}d.appendChild(k)}}},doCreateHexBox:function(e){var d=e.createElement("span");d.className=a.COLORPICKER_HEXBOX;d.innerHTML="&nbsp";this.setHexBox(d);return d},doCreatePreviewer:function(e){var d=e.createElement("span");d.className=a.COLORPICKER_PREVIEWER;d.innerHTML="&nbsp";this.setPreviewer(d);return d},doCreateColorInput:function(f){if(Kekule.BrowserFeature.html5Form.supportType("color")){var d=f.createElement("input");d.setAttribute("type","color");d.className=a.COLORPICKER_INPUT;var e=this;Kekule.X.Event.addListener(d,"change",function(h){var g=d.value;e.setValue(g);e.notifyColorSet()});this.setColorInput(d);return d}else{return null}},doCreateColorDialogBtn:function(e){if(Kekule.BrowserFeature.html5Form.supportType("color")){var d=new Kekule.Widget.Button(e);d.setText(Kekule.$L("WidgetTexts.CAPTION_BROWSE_COLOR"));d.setHint(Kekule.$L("WidgetTexts.HINT_BROWSE_COLOR"));d.setShowText(false);d.doSetShowGlyph(true);d.linkStyleResource(Kekule.Widget.StyleResourceNames.ICON_COLOR_PICK);d.addClassName(a.COLORPICKER_BROWSE_BTN);d.addEventListener("execute",this.openColorDialog,this);return d}},doCreatePalette:function(n,m){var q=n.createElement("div");q.className=a.COLORPICKER_PALETTE;var o=["00","00","11","22","33","44","55","66","77","88","99","AA","BB","CC","DD","EE","FF",null];var p=o.length;var d=this.doCreatePaletteLine(n);for(var l=0;l<p;l++){var h=o[l]?"#"+o[l]+o[l]+o[l]:"transparent";var f=this.doCreatePaletteCell(n,h);d.appendChild(f)}q.appendChild(d);o=["00","33","66","99","CC","FF"];var p=o.length;for(var l=0;l<p;l++){var d=this.doCreatePaletteLine(n);for(var g=0;g<(p>>1);g++){for(var e=0;e<p;e++){var h="#"+o[g]+o[l]+o[e];var f=this.doCreatePaletteCell(n,h);d.appendChild(f)}}q.appendChild(d)}for(var l=0;l<p;l++){var d=this.doCreatePaletteLine(n);for(var g=(p>>1);g<p;g++){for(var e=0;e<p;e++){var h="#"+o[g]+o[l]+o[e];var f=this.doCreatePaletteCell(n,h);d.appendChild(f)}}q.appendChild(d)}m.appendChild(q);this.setPalette(q);return q},doCreatePaletteCell:function(k,i,g,f){var d=k.createElement("span");var h=a.COLORPICKER_PALETTE_CELL;if(i==="transparent"){h+=" "+a.COLORPICKER_PALETTE_CELL_TRANSPARENT}else{try{d.style.backgroundColor=i}catch(j){}}d[this.COLOR_VALUE_FIELD]=i;d[this.COLOR_TEXT_FIELD]=g||i;d[this.COLOR_CLASS_FIELD]=f;d.className=h;d.title=g||i;return d},doCreatePaletteLine:function(e){var d=e.createElement("div");d.className=a.COLORPICKER_PALETTE_LINE;return d},_isPaletteCellElem:function(d){return Kekule.HtmlElementUtils.hasClass(d,a.COLORPICKER_PALETTE_CELL)},openColorDialog:function(){if(this.getColorInput()){this.getColorInput().click()}return this},applyColor:function(g){var d=g[this.COLOR_VALUE_FIELD];if(d){this.setValue(d)}var e=g[this.COLOR_TEXT_FIELD];if(e){this.getHexBox().innerHTML=e}var f=g[this.COLOR_CLASS_FIELD];this.setColorClassName(f)},notifyColorSet:function(){this.setIsDirty(true);this.invokeEvent("valueSet",{value:this.getValue(),colorClassName:this.getColorClassName()});this.invokeEvent("valueChange",{value:this.getValue(),colorClassName:this.getColorClassName()})},doReactActiviting:function($super,f){$super(f);var d=f.getTarget();if(this._isPaletteCellElem(d)){this.setIsPicking(true);this.applyColor(d);return true}},doReactDeactiviting:function($super,f){if(this.getIsPicking()){this.setIsPicking(false);var d=f.getTarget();if(this._isPaletteCellElem(d)){this.applyColor(d)}this.notifyColorSet();return true}$super(f)},reactPointerMoving:function($super,g){$super(g);if(this.getIsPicking()){var f=g.getTarget();if(g.getTouches()){var h={x:g.getClientX(),y:g.getClientY()};var d=this.getDocument();f=(d.elementFromPoint&&d.elementFromPoint(h.x,h.y))||f;g.preventDefault()}if(f&&this._isPaletteCellElem(f)){this.applyColor(f)}g.preventDefault();return true}}});Kekule.Widget.ColorPicker.SpecialColors={UNSET:"(unset)",DEFAULT:"(default)",MIXED:"(mixed)",TRANSPARENT:"transparent"};Kekule.Widget.ColorDropTextBox=Class.create(Kekule.Widget.ButtonTextBox,{CLASS_NAME:"Kekule.Widget.ColorDropTextBox",initialize:function($super,d,e){$super(d);this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);this.addEventListener("buttonExecute",this.reactDropbuttonExecute,this);this.setShowPreview(true);if(e){this.setValue(e)}},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(d){this.getPreviewElem().style.display=d?"inherit":""}});this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(f){var e=this.getPreviewElem();if(e){var d=this.getColorClassName();if(d){Kekule.HtmlElementUtils.removeClass(e,d)}if(f){Kekule.HtmlElementUtils.addClass(e,f)}}this.setPropStoreFieldValue("colorClassName",f)}});this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var d=this.getPropStoreFieldValue("colorPicker");if(!d){d=new Kekule.Widget.ColorPicker(this);d.setDisplayed(false);d.getElement().style.position="absolute";d.setSpecialColors(this.getSpecialColors());d.addEventListener("valueChange",this.reactColorPickerValueSet,this);d.appendToElem(this.getElement());this.setPropStoreFieldValue("colorPicker",d)}return d}});this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var d=this.getPropStoreFieldValue("colorPicker");if(d){d.setSpecialColors(e)}}})},doFinalize:function($super){var d=this.getPropStoreFieldValue("colorPicker");if(d){d.finalize()}$super()},doGetWidgetClassName:function($super){return $super()+" "+a.COLORDROPTEXTBOX},doCreateSubElements:function($super,f,d){$super(f,d);var e=new Kekule.Widget.DumbWidget(this);e.addClassName(a.COLORPREVIEWER);this.setHeadingWidget(e);return[e.getElement()]},getPreviewElem:function(){var d=this.getHeadingWidget();if(d){return d.getElement()}},showColorPicker:function(){var d=this.getColorPicker();if(!d.isShown()){d.setValue(this.getValue());d.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN)}},hideColorPicker:function(){var d=this.getPropStoreFieldValue("colorPicker");if(d&&d.isShown()){d.hide()}},reactDropbuttonExecute:function(d){this.showColorPicker()},reactColorPickerValueSet:function(f){var d=f.value;this.setValue(d);this.setIsDirty(this.getIsDirty()||this.getColorPicker().getIsDirty());this.setColorClassName(f.colorClassName);this.hideColorPicker();f.stopPropagation()},doSetValue:function($super,e){$super(e);var d=this.getPreviewElem();if(d){d.style.backgroundColor="transparent";d.style.backgroundColor=e}}});Kekule.Widget.ColorDropButton=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.ColorDropButton",initialize:function($super,d,e){$super(d);this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);this.setShowPreview(true);if(e){this.setValue(e)}},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(d){try{this.getPreviewElem().style.display=d?"inherit":""}catch(f){}}});this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getText()},setter:function(e){this.setText(e);this.updateColorPreview(e);var d=this.getPropStoreFieldValue("colorPicker");if(d){d.setValue(e)}}});this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(f){var e=this.getPreviewElem();if(e){var d=this.getColorClassName();if(d){Kekule.HtmlElementUtils.removeClass(e,d)}if(f){Kekule.HtmlElementUtils.addClass(e,f)}}this.setPropStoreFieldValue("colorClassName",f)}});this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var d=this.getPropStoreFieldValue("colorPicker");if(!d){d=new Kekule.Widget.ColorPicker(this);d.setDisplayed(false);d.getElement().style.position="absolute";d.setSpecialColors(this.getSpecialColors());d.addEventListener("valueChange",this.reactColorPickerValueSet,this);this.setPropStoreFieldValue("colorPicker",d)}return d}});this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var d=this.getPropStoreFieldValue("colorPicker");if(d){d.setSpecialColors(e)}}});this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getColorPicker().getIsDirty()},setter:function(d){this.getColorPicker().setIsDirty(d)}})},doFinalize:function($super){var d=this.getPropStoreFieldValue("colorPicker");if(d){d.finalize()}$super()},doGetWidgetClassName:function($super){return $super()+" "+a.COLORDROPBUTTON},doGetDropDownWidget:function(){return this.getColorPicker()},getPreviewElem:function(){return this._elemLeadingGlyphPart},showColorPicker:function(){var d=this.getColorPicker();if(!d.isShown()){d.setValue(this.getValue());d.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN)}},hideColorPicker:function(){var d=this.getPropStoreFieldValue("colorPicker");if(d&&d.isShown()){d.hide()}},reactColorPickerValueSet:function(g){var f=g.value;var d=g.colorClassName;this.setValue(f);this.setColorClassName(d);this.hideColorPicker();this.invokeEvent("valueChange",{value:f});g.stopPropagation()},updateColorPreview:function(e){var d=this.getPreviewElem();if(d){d.style.backgroundColor="transparent";d.style.backgroundColor=e}}})})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TEXTEDITOR:"K-TextEditor",TEXTEDITOR_TOOLBAR:"K-TextEditor-Toolbar",TEXTEDITOR_TEXTAREA:"K-TextEditor-TextArea",TEXTEDITOR_FONTBOX:"K-TextEditor-FontBox",TEXTEDITOR_BTN_FONTSIZEINC:"K-TextEditor-Btn-FontSizeInc",TEXTEDITOR_BTN_FONTSIZEDEC:"K-TextEditor-Btn-FontSizeDec",TEXTEDITOR_BTN_TEXTWRAP:"K-TextEditor-Btn-TextWrap"});Kekule.Widget.TextEditor=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextEditor",BINDABLE_TAG_NAMES:["div","span"],DEF_TOOLBAR_COMPONENTS:["fontFamily","fontSizeInc","fontSizeDec","textWrap"],initialize:function($super,d){this._toolCompWidgets=[];this.setPropStoreFieldValue("showToolbar",true);$super(d)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var d=this.getTextArea();return d?d.getText():null},setter:function(d){var e=this.getTextArea();if(e){e.setText(d)}}});this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getTextArea().getReadOnly()},setter:function(d){return this.getTextArea().setReadOnly(d)}});this.defineProp("wrap",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getTextArea().getWrap()},setter:function(e){var d=this.getTextArea().setWrap(e);this.updateToolButtonStates();return d}});this.defineProp("textArea",{dataType:"Kekule.Widget.TextArea",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var d=this.getPropStoreFieldValue("textArea");if(!d){d=this.createTextArea();this.setPropStoreFieldValue("textArea",d)}return d}});this.defineProp("toolbar",{dataType:"Kekule.Widget.Toolbar",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var d=this.getPropStoreFieldValue("toolbar");if(!d){if(this.getShowToolbar()){d=this.createToolbar();this.setPropStoreFieldValue("styleToolbar",d)}}return d}});this.defineProp("showToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showToolbar",e);var d=this.getToolbar();d.setDisplayed(e)}});this.defineProp("toolbarPos",{dataType:DataType.INT,setter:function(d){this.setPropStoreFieldValue("toolbarPos",d);this.updateChildWidgetPos()}});this.defineProp("toolbarComponents",{dataType:DataType.ARRAY,serializable:false,getter:function(){var d=this.getPropStoreFieldValue("toolbarComponents");if(!d){d=null;this.setPropStoreFieldValue("toolbarComponents",d)}return d},setter:function(d){this.setPropStoreFieldValue("toolbarComponents",d);this.recreateToolbarComponents(d)}});this.defineProp("candidateFontFamilies",{dataType:DataType.ARRAY});this.defineProp("fontSizeLevel",{dataType:DataType.FLOAT,setter:function(d){this.setPropStoreFieldValue("fontSizeLevel",d);this.setTextStyle({fontSize:""+d+"em"})}})},finalize:function($super){this._finalizeSubElements();$super()},_finalizeSubElements:function(){var d=this.getTextArea();if(d){d.finalize()}},getCoreElement:function($super){var d=this.getTextArea();if(d){return d.getElement()}else{return $super()}},doGetWidgetClassName:function($super){return $super()+" "+a.TEXTEDITOR},doCreateRootElement:function(e){var d=e.createElement("span");return d},doCreateSubElements:function(f,d){var e=this.createToolbar();if(e){e.appendToElem(d)}var g=this.createTextArea();g.appendToElem(d);this.updateChildWidgetPos();return[e.getElement(),g.getElement()]},doWidgetShowStateChanged:function($super,d){$super(d);if(d){this.updateChildWidgetPos();this.updateToolButtonStates()}},createToolbar:function(){if(this.getShowToolbar()){var d=new Kekule.Widget.Toolbar(this);this.setPropStoreFieldValue("toolbar",d);d.addClassName(a.TEXTEDITOR_TOOLBAR);this.recreateToolbarComponents();return d}else{return null}},recreateToolbarComponents:function(k){if(!k){k=this.getToolbarComponents()}var h=k||this.DEF_TOOLBAR_COMPONENTS;var g=this.getToolbar();if(g){this._toolCompWidgets.length=0;g.clearWidgets();g.setShowText(false);g.setShowGlyph(true);var j;for(var f=0,d=h.length;f<d;++f){var e=h[f];if(e==="fontFamily"){j=this.createFontFamilyComboBox(g)}else{j=this.createToolButton(g,e)}this._toolCompWidgets[e]=j}this.updateToolButtonStates()}},createFontFamilyComboBox:function(h){var d=new Kekule.Widget.ComboBox(h);var j=Kekule.Widget.FontEnumerator.getAvailableFontFamilies(this.getCandidateFontFamilies());var f=[];for(var g=0,e=j.length;g<e;++g){f.push({text:j[g],value:j[g]})}d.setHint(Kekule.$L("WidgetTexts.HINT_CHOOSE_FONT_FAMILY"));d.addClassName(a.TEXTEDITOR_FONTBOX);d.setItems(f);d.appendToWidget(h);d.addEventListener("valueChange",function(i){this.setTextStyle({fontFamily:d.getValue()})},this);return d},createToolButton:function(g,j){var f,i;var e;var h=(j==="textWrap")?Kekule.Widget.CheckButton:Kekule.Widget.Button;var d=new h(g);d.appendToWidget(g);if(j==="textWrap"){f=Kekule.$L("WidgetTexts.CAPTION_TOGGLE_TEXTWRAP");i=Kekule.$L("WidgetTexts.HINT_TOGGLE_TEXTWRAP");e=a.TEXTEDITOR_BTN_TEXTWRAP;d.setChecked(this.getWrap()!=="off");d.addEventListener("checkChange",function(l){var k=d.getChecked();this.setWrap(k?"virtual":"off")},this)}else{if(j==="fontSizeInc"){f=Kekule.$L("WidgetTexts.CAPTION_INC_TEXT_SIZE");i=Kekule.$L("WidgetTexts.HINT_INC_TEXT_SIZE");e=a.TEXTEDITOR_BTN_FONTSIZEINC;d.addEventListener("execute",this.increaseTextSize,this)}else{if(j==="fontSizeDec"){f=Kekule.$L("WidgetTexts.CAPTION_DEC_TEXT_SIZE");i=Kekule.$L("WidgetTexts.HINT_DEC_TEXT_SIZE");e=a.TEXTEDITOR_BTN_FONTSIZEDEC;d.addEventListener("execute",this.decreaseTextSize,this)}}}d.setText(f);d.setHint(i);d.addClassName(e);return d},createToolCheckButton:function(e,f){var d=new Kekule.Widget.CheckButton(e);d.appendToWidget(e);return d},createTextArea:function(){var d=new Kekule.Widget.TextArea(this);this.setPropStoreFieldValue("textArea",d);d.addClassName(a.TEXTEDITOR_TEXTAREA);return d},updateChildWidgetPos:function(){var f=this.getToolbarPos();var g=this.getToolbar().getElement();var e=this.getTextArea().getElement();var d=g.parentNode;if(f===Kekule.Widget.Position.BOTTOM){d.insertBefore(e,g)}else{d.insertBefore(g,e)}},updateToolButtonStates:function(){var d=this._toolCompWidgets.textWrap;if(d){d.setChecked(this.getWrap()!=="off")}},setTextStyle:function(j){var h=this.getTextArea();if(h){var f=Kekule.ObjUtils.getOwnedFieldNames(j);for(var e=0,d=f.length;e<d;++e){var g=f[e];h.setStyleProperty(g,j[g])}}return this},increaseTextSize:function(){var e=this.getFontSizeLevel()||1;var d=Kekule.ZoomUtils.getNextZoomInRatio(e);this.setFontSizeLevel(d)},decreaseTextSize:function(){var e=this.getFontSizeLevel()||1;var d=Kekule.ZoomUtils.getNextZoomOutRatio(e);this.setFontSizeLevel(d)}})})();(function(){var a=Kekule.ArrayUtils;var c=Kekule.StyleUtils;var d=Kekule.DomUtils;var e=Kekule.HtmlElementUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_GRID:"K-Widget-Grid",WIDGET_GRID_CELL:"K-Widget-Grid-Cell",WIDGET_GRID_ADD_CELL:"K-Widget-Grid-Add-Cell",WIDGET_GRID_INTERACTION_AREA:"K-Widget-Grid-Interaction-Area",WIDGET_GRID_WIDGET_PARENT:"K-Widget-Grid-Widget-Parent",WIDGET_GRID_BUTTON_REMOVE:"K-Widget-Grid-Button-Remove",WIDGET_GRID_ENABLE_CELL_INTERACTION:"K-Widget-Grid-Enable-Cell-Interaction"});var b=Kekule.Widget.HtmlClassNames;Kekule.Widget.WidgetGrid=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGrid",CELL_FIELD:"__$cell__",WIDGET_FIELD:"__$cellWidget__",INTERACTION_AREA_FIELD:"__$interactionArea__",EXCEED_TOPRIGHT_FIELD:"__$exceedTopRight__",BTN_REMOVE_CELL_FIELD:"__$removeCell__",initialize:function($super,f){this._floatClearer=null;this.reactCellMouseEnterBind=this.reactCellMouseEnter.bind(this);this.reactCellMouseLeaveBind=this.reactCellMouseLeave.bind(this);this.reactCellClickBind=this.reactCellClick.bind(this);$super(f);this.addEventListener("change",this.reactChildWidgetChange,this)},initProperties:function(){this.defineProp("childWidgetClass",{dataType:DataType.CLASS,serializable:false});this.defineProp("cellWidth",{dataType:DataType.STRING});this.defineProp("cellHeight",{dataType:DataType.STRING});this.defineProp("widgetPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position});this.defineProp("autoShrinkWidgets",{dataType:DataType.BOOL});this.defineProp("keepWidgetAspectRatio",{dataType:DataType.BOOL});this.defineProp("restoreWidgetSizeOnHotTrack",{dataType:DataType.BOOL});this.defineProp("enableAdd",{dataType:DataType.BOOL,setter:function(g){this.setPropStoreFieldValue("enableAdd",g);if(g){this.setAddingCell(this.createAddCell())}else{var f=this.getAddingCell();if(f){this.getContainerElement().removeChild(f)}}}});this.defineProp("enableRemove",{dataType:DataType.BOOL,getter:function(){return this.hasClassName(b.WIDGET_GRID_ENABLE_CELL_INTERACTION)},setter:function(f){if(f){this.addClassName(b.WIDGET_GRID_ENABLE_CELL_INTERACTION)}else{this.removeClassName(b.WIDGET_GRID_ENABLE_CELL_INTERACTION)}}});this.defineProp("hotCell",{dataType:DataType.OBJECT,serializable:false,setter:function(f){if(this.getHotCell()!==f){this.hotCellChanged(this.getHotCell(),f);this.setPropStoreFieldValue("hotCell",f)}}});this.defineProp("addingCell",{dataType:DataType.OBJECT,serializable:false})},initPropValues:function(){this.setPropStoreFieldValue("autoShrinkWidgets",true);this.setPropStoreFieldValue("keepWidgetAspectRatio",true);this.setPropStoreFieldValue("restoreWidgetSizeOnHotTrack",true);this.setEnableRemove(true);this.setUseCornerDecoration(true)},doGetWidgetClassName:function($super){return $super()+" "+b.WIDGET_GRID},doCreateRootElement:function(g){var f=g.createElement("div");return f},doSetUseCornerDecoration:function($super,f){$super(f);this.updateAllCells()},doObjectChange:function($super,g){$super(g);var f=a.intersect(g,["autoShrinkWidgets","keepWidgetAspectRatio","cellWidth","cellHeight","widgetPos"]);if(f.length>0){this.updateAllCells()}},doWidgetShowStateChanged:function($super,f){if(f){this.updateAllCells()}return $super(f)},each:function(f){var h=Kekule.ArrayUtils.clone(this.getChildWidgets());for(var j=0,g=h.length;j<g;++j){f(h[j])}},addWidget:function(f){f.setParent(this)},removeWidget:function(g,f){if(!this.hasChild(g)){return}g.setParent(null);if(f){g.finalize()}},createWidget:function(){var f=this.doCreateNewChildWidget(this.getDocument());if(f){f.setParent(this);return f}},doCreateNewChildWidget:function(f){return null},getFloatClearer:function(){if(!this._floatClearer){this._floatClearer=this.getDocument().createElement("div");this._floatClearer.style.clear="both";this.getContainerElement().appendChild(this._floatClearer)}return this._floatClearer},createCell:function(i){var h=!i;var k=this.getDocument();var g=k.createElement("div");g.className=b.WIDGET_GRID_CELL+" "+b.DYN_CREATED+(h?" "+b.WIDGET_GRID_ADD_CELL:"");g[this.WIDGET_FIELD]=i;Kekule.X.Event.addListener(g,"mouseenter",this.reactCellMouseEnterBind);Kekule.X.Event.addListener(g,"mouseleave",this.reactCellMouseLeaveBind);Kekule.X.Event.addListener(g,"click",this.reactCellClickBind);var j=k.createElement("div");j.className=b.WIDGET_GRID_WIDGET_PARENT+" "+b.DYN_CREATED;j[this.WIDGET_FIELD]=i;if(h){j.innerHTML=Kekule.$L("WidgetTexts.CAPTION_ADD_CELL");j.title=Kekule.$L("WidgetTexts.HINT_ADD_CELL")}g.appendChild(j);if(i){i.appendToElem(j);i[this.CELL_FIELD]=g}if(!h){var f=k.createElement("div");f.className=b.WIDGET_GRID_INTERACTION_AREA+" "+b.DYN_CREATED;g.appendChild(f);j[this.INTERACTION_AREA_FIELD]=f;g[this.INTERACTION_AREA_FIELD]=f;this.createCellInteractionWidgets(f,g)}if(this.getAddingCell()&&!h){this.getContainerElement().insertBefore(g,this.getAddingCell())}else{this.getContainerElement().insertBefore(g,this.getFloatClearer())}this.updateCell(g);return g},createAddCell:function(){return this.createCell(null)},createCellInteractionWidgets:function(f,g){var h=new Kekule.Widget.Button(f.ownerDocument);h.setText(Kekule.$L("WidgetTexts.CAPTION_REMOVE_CELL"));h.setHint(Kekule.$L("WidgetTexts.HINT_REMOVE_CELL"));h.addClassName(b.WIDGET_GRID_BUTTON_REMOVE);h[this.BTN_REMOVE_CELL_FIELD]=true;var i=this.getContainingWidget(g);h[this.WIDGET_FIELD]=i;h.setShowText(false);h.setShowGlyph(true);h.addEventListener("execute",function(l){var j=l.widget;var k=j[this.WIDGET_FIELD];this.removeWidget(k,true)},this);h.appendToElem(f)},getWidgetCell:function(f){return f[this.CELL_FIELD]},getWidgetParentElem:function(g){var f=g.getElement();return f&&f.parentNode},getWidgetParentElemOfCell:function(f){return f.children[0]},getInteractionAreaElemOfCell:function(f){return f[this.INTERACTION_AREA_FIELD]},getContainingWidget:function(f){return f[this.WIDGET_FIELD]},childWidgetAdded:function($super,f){$super(f);this.createCell(f)},childWidgetRemoved:function($super,g){$super(g);var f=this.getWidgetCell(g);this.getContainerElement().removeChild(f)},childWidgetMoved:function($super,j,h){$super(j,h);var i=this.getWidgetCell(j);var g=this.getChildWidgets()[h+1];var f=g?this.getWidgetCell(g):null;if(f){this.getContainerElement().insertBefore(i,f)}else{this.getContainerElement().appendChild(i)}},childrenModified:function($super){this.getContainerElement().appendChild(this.getFloatClearer())},getAllCells:function(){var j=this.getChildWidgets();var f=[];for(var h=0,g=j.length;h<g;++h){f.push(this.getWidgetCell(j[h]))}if(this.getAddingCell()){f.push(this.getAddingCell())}return f},updateCell:function(g,i){var k=g.style;var f=this.getCellWidth();var j=this.getCellHeight();if(f){k.width=f}else{c.removeStyleProperty(k,"width")}if(j){k.height=j}else{c.removeStyleProperty(k,"height")}if(this.getUseCornerDecoration()){e.addClass(g,b.CORNER_ALL)}else{e.removeClass(g,b.CORNER_ALL)}this.adjustCellWidgetPos(g,i);this.adjustInteractionArea(g,i)},adjustCellWidgetPos:function(o,m){var D=this.getWidgetParentElemOfCell(o);var k=e.getElemOffsetDimension(D);var g=e.getElemClientDimension(o);var v=["top","right","bottom","left"];var h={};for(var x=0,w=v.length;x<w;++x){var t=c.getComputedStyle(o,"padding-"+v[x]);h[v[x]]=c.analysisUnitsValue(t).value||0}var F=Object.extend({},g);F.width-=(h.left+h.right);F.height-=(h.top+h.bottom);var n=this.getWidgetPos();var B=Kekule.Widget.Position;var j=(n&B.LEFT)?h.left:(n&B.RIGHT)?g.width-k.width-h.right:(F.width-k.width)/2+h.left;var s=(n&B.TOP)?h.top:(n&B.BOTTOM)?g.height-k.height-h.bottom:(F.height-k.height)/2+h.top;D.style.left=j+"px";D.style.top=s+"px";var u=this.getInteractionAreaElemOfCell(o);if(u){var p=e.getElemClientDimension(u);var z=j+k.width;var f=(z+p.width>=g.width)&&(s<=p.height);o[this.EXCEED_TOPRIGHT_FIELD]=f}if((this.getAutoShrinkWidgets()&&!m)||!this.getRestoreWidgetSizeOnHotTrack()){var A=(k.width>F.width)?F.width/k.width:null;var y=(k.height>F.height)?F.height/k.height:1;if(this.getKeepWidgetAspectRatio()){var E=(A&&y)?Math.min(A,y):A||y;A=E;y=E}D.style.transform="scale("+A+", "+y+")";var r=(n&B.LEFT)?"0":(n&B.RIGHT)?"100%":"50%";var q=(n&B.TOP)?"0":(n&B.BOTTOM)?"100%":"50%";D.style.transformOrigin=r+" "+q}else{D.style.transform="none"}},adjustInteractionArea:function(g,i){var h=this.getInteractionAreaElemOfCell(g);if(h){if(!i){g.appendChild(h)}else{if(g[this.EXCEED_TOPRIGHT_FIELD]){var f=this.getWidgetParentElemOfCell(g);f.appendChild(h)}}}},updateAllCells:function(){var g=this.getAllCells();for(var h=0,f=g.length;h<f;++h){this.updateCell(g[h],g[h]===this.getHotCell())}},restoreCellShrink:function(f){var g=this.getWidgetParentElemOfCell(f);if(g){g.style.transform="none"}},hotCellChanged:function(f,g){if(f){this.updateCell(f,false);e.removeClass(f,b.STATE_HOVER)}if(g){e.addClass(g,b.STATE_HOVER);if(this.getRestoreWidgetSizeOnHotTrack()){this.restoreCellShrink(g);this.adjustInteractionArea(g,true)}}},reactCellMouseEnter:function(g){var f=g.getTarget();this.setHotCell(f)},reactCellMouseLeave:function(g){var f=g.getTarget();if(this.getHotCell()===f){this.setHotCell(null)}},reactCellClick:function(g){var f=g.getTarget();if(d.isDescendantOf(f,this.getAddingCell())||f===this.getAddingCell()){this.createWidget()}},reactChildWidgetChange:function(g){var f=g.widget;if(f&&this.hasChild(f)){this.updateCell(this.getWidgetCell(f),this.getHotCell()===this.getWidgetCell(f))}}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.StyleUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{PROPLISTEDITOR:"K-PropListEditor",PROPLISTEDITOR_PROPEXPANDMARKER:"K-PropListEditor-PropExpandMarker",PROPLISTEDITOR_PROPEXPANDED:"K-PropListEditor-PropExpanded",PROPLISTEDITOR_PROPCOLLAPSED:"K-PropListEditor-PropCollapsed",PROPLISTEDITOR_INDENTDECORATOR:"K-PropListEditor-IndentDecorator",PROPLISTEDITOR_READONLY:"K-PropListEditor-ReadOnly",OBJINSPECTOR:"K-ObjInspector",OBJINSPECTOR_SUBPART:"K-ObjInspector-SubPart",OBJINSPECTOR_OBJSINFOPANEL:"K-ObjInspector-ObjsInfoPanel",OBJINSPECTOR_PROPINFOPANEL:"K-ObjInspector-PropInfoPanel",OBJINSPECTOR_PROPINFO_TITLE:"K-ObjInspector-PropInfoPanel-Title",OBJINSPECTOR_PROPINFO_DESCRIPTION:"K-ObjInspector-PropInfoPanel-Description",OBJINSPECTOR_PROPLISTEDITOR_CONTAINER:"K-ObjInspector-PropListEditorContainer"});Kekule.Widget.ObjPropListEditor=Class.create(Kekule.Widget.ValueListEditor,{CLASS_NAME:"Kekule.Widget.ObjPropListEditor",PARENT_ROW_FIELD:"__$parentRow__",SUB_ROWS_FIELD:"__$subRows__",initialize:function($super,e){$super(e);this.setValueDisplayMode(Kekule.Widget.ValueListEditor.ValueDisplayMode.SIMPLE);this.setPropStoreFieldValue("displayedPropScopes",[Class.PropertyScope.PUBLISHED]);this.setEnableLiveUpdate(true);this.setSubPropNamePadding("1em");this.setUseKeyHint(true)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){var g=Kekule.ArrayUtils.toArray(f);var e=this.getObjects();this.setPropStoreFieldValue("objects",g);this.inspectedObjectsChanged(g,e)}});this.defineProp("displayedPropScopes",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("displayedPropScopes",e);this.updateAll()}});this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL});this.defineProp("subPropNamePadding",{dataType:DataType.STRING});this.defineProp("activePropEditor",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getActiveRow();if(e){return this.getRowPropEditor(e)}else{return null}}});this.defineProp("keyField",{dataType:DataType.STRING});this.defineProp("sortField",{dataType:DataType.STRING});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false});this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,scope:Class.PropertyScope.PUBLIC})},doFinalize:function($super){$super()},initPropValues:function($super){$super();this.setKeyField("title");this.setSortField("key")},doGetWidgetClassName:function($super){return $super()+" "+a.PROPLISTEDITOR},inspectedObjectsChanged:function(f,e){var g=Kekule.ArrayUtils.toArray(f);if(e){this._uninstallObjectsEventHandlers(e)}if(f){this._installObjectsEventHandlers(g)}this.updateAll(g)},_installObjectsEventHandlers:function(g){for(var f=0,e=g.length;f<e;++f){var h=g[f];if(h.addEventListener){h.addEventListener("change",this.reactObjectsChange,this)}}},_uninstallObjectsEventHandlers:function(g){for(var f=0,e=g.length;f<e;++f){var h=g[f];if(h.removeEventListener){h.removeEventListener("change",this.reactObjectsChange,this)}}},reactObjectsChange:function(g){if(this.getEnableLiveUpdate()){var f=g.changedPropNames;this.updateValues(f)}},getKeyCellExpandMarker:function(n,m){var p=null;var e=this.getCellContentWrapper(n,m);if(e){var g=c.getDirectChildElems(e)||[];for(var j=0,h=g.length;j<h;++j){var f=g[j];if(d.hasClass(f,a.PROPLISTEDITOR_PROPEXPANDMARKER)){p=f;break}}if(!p&&m){var o=this.getDocument();p=o.createElement("span");d.addClass(p,a.PROPLISTEDITOR_PROPEXPANDMARKER);var k=c.getChildNodesOfTypes(e,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];e.insertBefore(p,k)}}return p},getKeyCellIndentDecorator:function(n,m){var p=null;var e=this.getCellContentWrapper(n,m);if(e){var g=c.getDirectChildElems(e)||[];for(var j=0,h=g.length;j<h;++j){var f=g[j];if(d.hasClass(f,a.PROPLISTEDITOR_INDENTDECORATOR)){p=f;break}}if(!p&&m){var o=this.getDocument();p=o.createElement("div");d.addClass(p,a.PROPLISTEDITOR_INDENTDECORATOR);var k=c.getChildNodesOfTypes(e,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];e.insertBefore(p,k)}}return p},setRowKeyCellContent:function($super,n,k,g){var o=$super(n,k,g);var m=this.getKeyCell(n);var i=this.getKeyCellExpandMarker(m,true);var l=this.getRowSubLevel(n);var e=this.getSubPropNamePadding();if(e){var h=Kekule.StyleUtils.multiplyUnitsValue(e,l);e=Kekule.StyleUtils.multiplyUnitsValue(e,l);var j=this.getKeyCell(n);var f=this.getCellContentWrapper(j,true);f.style.paddingLeft=e}return o},updateAll:function(j){if(!j){j=this.getObjects()}if(!j||!j.length){this.clear();return}this.setActiveRow(null);this.collapseAllRows();var f=j[0];var m=this.getDisplayPropEditors(j);this.sortPropEditors(m);var r=j.length>1;var q=this.getRows();var n=q.length;var e=m.length;var g=0;var h=0;var k=this.getValueDisplayMode();for(var g=0;g<e;++g){var o=m[g];o.setValueTextMode(k);if(!this.isPropEditorVisible(o)){continue}var p=(h<n)?q[h]:this.appendRow();this.setRowPropEditor(p,o);++h}if(n>h){for(var g=n-1;g>=h;--g){this.removeRow(q[g])}}return this},updateValues:function(m){var k=m&&m.length;var h=this.getRows();for(var f=0,e=h.length;f<e;++f){var j=h[f];if(k){var g=this.getRowPropEditor(j);if(!g||(m.indexOf(g.getPropertyName())<0)){continue}}this.updateRowPropValue(j)}},updateRowPropValue:function(m){var h=this.getRowPropEditor(m);var k=h.getValueText();var j=this.getRowData(m);j.value=k;this.setRowData(m,j);this.updateRowExpandState(m);var e=this.getSubPropRows(m);if(e){for(var g=0,f=e.length;g<f;++g){this.updateRowPropValue(e[g])}}},setRowPropEditor:function(j,g){var i;var f=this.getKeyField()||"title";if(f){if(f==="name"){i=g.getPropertyName()}else{if(f==="title"){i=g.getTitle()}else{var e=g.getPropertyInfo();i=e[f]}}}if(!i){i=g.getTitle()||g.getPropertyName()}var h={key:g.getPropertyName(),value:g.getValueText(),title:i,hint:g.getHint(),propEditor:g,expanded:false};var k=g.isReadOnly();if(k){d.addClass(j,a.PROPLISTEDITOR_READONLY)}else{d.removeClass(j,a.PROPLISTEDITOR_READONLY)}this.setRowData(j,h);this.updateRowExpandState(j)},getRowCascadeKey:function(g){if(g&&this.getRowData(g)){var e=this.getRowData(g).key;var f=this.getParentPropRow(g);if(f){e=this.getRowCascadeKey(f)+"."+e}return e}else{return null}},getActiveRowCascadeKey:function(){var e=this.getActiveRow();return e&&this.getRowCascadeKey(e)},getRowPropEditor:function(f){var e=this.getRowData(f);if(e){return e.propEditor}else{return null}},getPropEditor:function(f,e){var g=Kekule.PropertyEditor.findEditorClass(f,e);if(g){return new g()}else{return null}},getPropEditorForType:function(f,e){var g=Kekule.PropertyEditor.findEditorClassForType(f,e);if(g){return new g()}else{return null}},isPropEditorVisible:function(i){var f=true;var k=i.getObjects();var e=k.length>1;f=!e||(i.getAttributes()&Kekule.PropertyEditor.EditorAttributes.MULTIOBJS);if(f){var h=i.getPropertyInfo();if(h){var j=h.scope||Class.PropertyScope.DEFAULT;if(j){var g=this.getDisplayedPropScopes();if(g){f=g.indexOf(j)>=0}}}}return f},isRowExpandable:function(f){var e=this.getRowPropEditor(f);return e?e.hasSubPropertyEditors():false},isRowExpanded:function(f){var e=this.getRowData(f);return !!e.expanded},updateRowExpandState:function(f){var e=this.isRowExpandable(f);if(!e){this.removeSubPropertyRows(f)}d.removeClass(f,a.PROPLISTEDITOR_PROPCOLLAPSED);d.removeClass(f,a.PROPLISTEDITOR_PROPEXPANDED);if(e){if(this.isRowExpanded(f)){d.addClass(f,a.PROPLISTEDITOR_PROPEXPANDED)}else{d.addClass(f,a.PROPLISTEDITOR_PROPCOLLAPSED)}}},expandRow:function(e){this._doExpandRow(e);return this},_doExpandRow:function(h){if(this.isRowExpandable(h)&&(!this.isRowExpanded(h))){d.removeClass(h,a.PROPLISTEDITOR_PROPCOLLAPSED);d.addClass(h,a.PROPLISTEDITOR_PROPEXPANDED);var g=this.getRowData(h);g.expanded=true;var f=this.getRowPropEditor(h);var e=f.getSubPropertyEditors(this.getDisplayedPropScopes());h[this.SUB_ROWS_FIELD]=this.addSubPropertyRows(h,e);return h[this.SUB_ROWS_FIELD]}else{return null}},collapseRow:function(f){if(this.isRowExpandable(f)&&this.isRowExpanded(f)){d.removeClass(f,a.PROPLISTEDITOR_PROPEXPANDED);d.addClass(f,a.PROPLISTEDITOR_PROPCOLLAPSED);var e=this.getRowData(f);e.expanded=false;this.removeSubPropertyRows(f)}return this},toggleRowExpandState:function(e){if(this.isRowExpanded(e)){this.collapseRow(e)}else{this.expandRow(e)}return this},collapseAllRows:function(){var g=this.getRows();for(var f=0,e=g.length;f<e;++f){this.collapseRow(g[f])}return this},expandAllRows:function(g){var f=this;var e=function(o,m){for(var n=0,j=o.length;n<j;++n){var k=f._doExpandRow(o[n]);if(k&&m){e(k,m)}}};var h=this.getRows();e(h,g);return this},addSubPropertyRows:function(j,m){var h=this.getNextRow(j);var e=[];if(m&&m.length){this.sortPropEditors(m);for(var g=0,f=m.length;g<f;++g){var k=m[g];if(!this.isPropEditorVisible(k)){continue}e.push(this.addSubPropRow(j,k,h))}}return e},addSubPropRow:function(h,g,f){var e=this.insertRowBefore(null,f);e[this.PARENT_ROW_FIELD]=h;this.setRowPropEditor(e,g);return e},removeSubPropertyRows:function(g){var e=this.getSubPropRows(g);for(var f=e.length-1;f>=0;--f){this.removeSubPropertyRows(e[f]);this.removeRow(e[f])}g[this.SUB_ROWS_FIELD]=null},getSubPropRows:function(e){return e[this.SUB_ROWS_FIELD]||[]},getParentPropRow:function(e){return e[this.PARENT_ROW_FIELD]},getRowSubLevel:function(g){var e=0;var f=this.getParentPropRow(g);while(f){++e;f=this.getParentPropRow(f)}return e},getValueCellText:function($super,f,e){return e.value},finishEditing:function(){var j=this.getActiveRow();var h=this.getRowPropEditor(j);if(h){var e=this.getOperHistory();var i=this.getEnableOperHistory()&&e;var g=h.getValue();var f=h.saveEditValue();if(f){if(i){var k=new Kekule.Widget.PropEditorModifyOperation(h,h.getValue(),g);e.push(k)}this.updateValues();this.invokeEvent("propertyChange",{propertyEditor:h,propertyInfo:h.getPropertyInfo(),oldValue:g,newValue:h.getValue()});this.invokeEvent("editFinish",{row:j})}}return this},doCreateValueEditWidget:function($super,g){var f=this.getRowPropEditor(g);var e=f.createEditWidget(this);if(e){if(f.isReadOnly()){if(e.setReadOnly){e.setReadOnly(true)}}}else{e=this.doCreateDefaultValueEditWidget(g)}return e},doCreateDefaultValueEditWidget:function(g){var e=new Kekule.Widget.TextBox(this);e.setReadOnly(true);var f=this.getRowData(g).value;e.setValue(f);return e},isOperHistoryAvailable:function(){return this.getOperHistory()&&this.getEnableOperHistory()},undo:function(){if(this.isOperHistoryAvailable()){this.getOperHistory().undo()}return this},redo:function(){if(this.isOperHistoryAvailable()){this.getOperHistory().redo()}return this},getCommonSuperClass:function(e){return ClassEx.getCommonSuperClass(e)},getCommonPropNames:function(m){var f=[];var k=this.getCommonSuperClass(m);if(k){var e=ClassEx.getPropListOfScopes(k,this.getDisplayedPropScopes());for(var j=0,h=e.getLength();j<h;++j){var g=e.getPropInfoAt(j);f.push(g.name)}}else{}return f},getDisplayPropNames:function(e){return this.getCommonPropNames(e)},getDisplayPropEditors:function(g){var e=[];var f=this.getCommonSuperClass(g);if(f){var i=this.getPropEditor(null,{dataType:ClassEx.getClassName(f)});if(i){i.setObjects(g);e=e.concat(i.getSubPropertyEditors(this.getDisplayedPropScopes())||[])}}else{if(g.length===1){var h=g[0];if(DataType.isObjectValue(h)){var i=this.getPropEditorForType("object");if(i){i.setObjects(h);e=e.concat(i.getSubPropertyEditors()||[])}}}}return e},sortPropEditors:function(g){var e=this.getSortField();if(!e){return}if(e==="key"){e===this.getKeyField()||"title"}var f=function(h,i){return h[i]||h.name};g.sort(function(k,i){var j=f(k.getPropertyInfo(),e);var h=f(i.getPropertyInfo(),e);return(j<h)?-1:(j>h)?1:0})},getObjPropValue:function(f,e){if(f instanceof ObjectEx){return f.getPropValue(e)}else{if(f instanceof Object){return f[e]}else{return undefined}}},getObjsPropValue:function(k,j){var m=k[0];var e=this.getObjPropValue(m,j);for(var g=1,f=k.length;g<f;++g){var m=k[g];var h=this.getObjPropValue(m,j);if(h!==e){return undefined}}return e},react_click:function($super,h){var g=h.getTarget();var i=this.getParentRow(g);if(i){var f=this.getKeyCellExpandMarker(this.getKeyCell(i),false);if(g===f){this.toggleRowExpandState(i)}}$super(h)},react_dblclick:function(i){var h=i.getTarget();var f=this.getParentCell(h);var g=false;if(f){var j=this.getParentRow(f);if(f===this.getKeyCell(j)){this.toggleRowExpandState(j);g=true}}},react_keydown:function($super,i){$super(i);var h=i.getKeyCode();var f=!(i.getAltKey()||i.getShiftKey()||i.getCtrlKey());if(f){var g=this.getActiveRow();if(g){if(h===Kekule.X.Event.KeyCode.RIGHT){this.expandRow(g)}else{if(h===Kekule.X.Event.KeyCode.LEFT){this.collapseRow(g)}}}}}});Kekule.Widget.ObjectInspector=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ObjectInspector",initialize:function($super,e){this._propListElem=null;this._objsInfoElem=null;this._propInfoElem=null;this.setPropStoreFieldValue("showObjsInfoPanel",true);this.setPropStoreFieldValue("showPropInfoPanel",true);$super(e)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(e){var f=Kekule.ArrayUtils.toArray(e);this.setPropStoreFieldValue("objects",f);this.inspectedObjectsChanged(f)}});this.defineProp("propEditor",{dataType:"Kekule.Widget.ObjPropListEditor",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE});this.defineProp("showObjsInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showObjsInfoPanel",e);b.setDisplay(this._objsInfoElem,!!e);this._updateChildElemSize()}});this.defineProp("showPropInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showPropInfoPanel",e);b.setDisplay(this._propInfoElem,!!e);this._updateChildElemSize()}});this.defineProp("keyField",{dataType:DataType.STRING,getter:function(){var e=this.getPropEditor();return e&&e.getKeyField()},setter:function(f){var e=this.getPropEditor();if(e){e.setKeyField(f)}}});this.defineProp("sortField",{dataType:DataType.STRING,getter:function(){var e=this.getPropEditor();return e&&e.getSortField()},setter:function(f){var e=this.getPropEditor();if(e){e.setSortField(f)}}});this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e&&e.getActiveRow()},setter:function(f){var e=this.getPropEditor();if(e){e.setActiveRow(f)}}});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false,getter:function(){var e=this.getPropEditor();return e?e.getEnableOperHistory():false},setter:function(f){var e=this.getPropEditor();return e?e.setEnableOperHistory(f):null}});this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e?e.getOperHistory():null},setter:function(f){var e=this.getPropEditor();return e?e.setOperHistory(f):null}})},doFinalize:function($super){this._finalizeChildWidgets();$super()},getChildrenHolderElement:function($super){return this._propListElem||$super()},doGetWidgetClassName:function(){return a.OBJINSPECTOR},doBindElement:function($super,e){$super(e);this._updateChildElemSize()},doCreateRootElement:function(f){var e=f.createElement("div");return e},doCreateSubElements:function($super,i,g){$super(i,g);var h=this._createSubPartElem(i);d.addClass(h,a.OBJINSPECTOR_OBJSINFOPANEL);g.appendChild(h);this._objsInfoElem=h;var f=this._createSubPartElem(i);d.addClass(f,a.OBJINSPECTOR_PROPINFOPANEL);g.appendChild(f);this._propInfoElem=f;var e=this._createSubPartElem(i);d.addClass(e,a.OBJINSPECTOR_PROPLISTEDITOR_CONTAINER);g.appendChild(e);this._propListElem=e;this._createChildWidgets(e);return[h,f,e]},_createSubPartElem:function(f){var e=f.createElement("div");e.className=a.OBJINSPECTOR_SUBPART;return e},_createChildWidgets:function(e){this._finalizeChildWidgets();var g=new Kekule.Widget.ObjPropListEditor(this);g.appendToWidget(this);var f=this;g.addEventListener("activeRowChange",function(h){f._updatePropInfo()});this.setPropStoreFieldValue("propEditor",g)},_finalizeChildWidgets:function(){var e=this.getPropEditor();if(e){e.finalize()}},inspectedObjectsChanged:function(f){var e=this.getPropEditor();if(e){e.setObjects(f)}this._updateObjectsInfo(f);this._updatePropInfo()},_updateObjectsInfo:function(h){if(this._objsInfoElem){var g;if(h.length<=0){g=Kekule.$L("WidgetTexts.S_INSPECT_NONE")}else{if(h.length===1){var f=h[0];var i=f.getId?f.getId():null;var e=DataType.getType(f);g=i?Kekule.$L("WidgetTexts.S_INSPECT_ID_OBJECT").format(i,e):Kekule.$L("WidgetTexts.S_INSPECT_ANONYMOUS_OBJECT").format(e)}else{g=Kekule.$L("WidgetTexts.S_INSPECT_OBJECTS").format(h.length)}}c.setElementText(this._objsInfoElem,g)}},_updatePropInfo:function(){if(this._propInfoElem){this._propInfoElem.innerHTML="";var g=this.getPropEditor().getActivePropEditor();if(g){var i=g.getTitle();var f=g.getDescription()||g.getPropertyType()||"";var h=this._propInfoElem.ownerDocument;var e=h.createElement("div");e.className=a.OBJINSPECTOR_PROPINFO_TITLE;c.setElementText(e,i);this._propInfoElem.appendChild(e);var e=h.createElement("div");e.className=a.OBJINSPECTOR_PROPINFO_DESCRIPTION;c.setElementText(e,f);this._propInfoElem.appendChild(e)}}},undo:function(){if(this.getPropEditor()){this.getPropEditor().undo()}return this},redo:function(){if(this.getPropEditor()){this.getPropEditor().redo()}return this},getRowCascadeKey:function(f){var e=this.getPropEditor();return e&&e.getRowCascadeKey(f)},getActiveRowCascadeKey:function(){var e=this.getPropEditor();return e&&e.getActiveRowCascadeKey()},isRowExpandable:function(f){var e=this.getPropEditor();return e&&e.isRowExpandable(f)},isRowExpanded:function(f){var e=this.getPropEditor();return e&&e.isRowExpanded(f)},expandRow:function(f){var e=this.getPropEditor();if(e){e.expandRow(f)}return this},collapseRow:function(f){var e=this.getPropEditor();if(e){e.collapseRow(f)}return this},toggleRowExpandState:function(f){var e=this.getPropEditor();if(e){e.toggleRowExpandState(f)}return this},collapseAllRows:function(){var e=this.getPropEditor();if(e){e.collapseAllRows()}return this},expandAllRows:function(f){var e=this.getPropEditor();if(e){e.expandAllRows(f)}return this},_updateChildElemSize:function(){var e=this;setTimeout(function(){var g;if(e.getShowObjsInfoPanel()){g=b.getComputedStyle(e._objsInfoElem,"height")}else{g=0}var f;if(e.getShowPropInfoPanel()){f=b.getComputedStyle(e._propInfoElem,"height")}else{f=0}e._propListElem.style.top=g;e._propListElem.style.bottom=f},100)},setUseCornerDecoration:function($super,f){var e=$super(f);if(f){}return e}})})();(function(){var a=Kekule.ArrayUtils;Kekule.Widget.PropertyEditor={};Kekule.PropertyEditor=Kekule.Widget.PropertyEditor;Kekule.PropertyEditor.BaseEditor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PropertyEditor.BaseEditor",initialize:function($super){$super();this._editWidget=null},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:false,setter:function(d){var c=Kekule.ArrayUtils;this.setPropStoreFieldValue("objects",c.clone(c.toArray(d)))}});this.defineProp("propertyInfo",{dataType:DataType.OBJECT,serializable:false});this.defineProp("propertyName",{dataType:DataType.VARIANT,serializable:false,setter:null,getter:function(){var c=this.getPropertyInfo();return c?c.name:null}});this.defineProp("propertyType",{dataType:DataType.VARIANT,serializable:false,setter:null,getter:function(){var c=this.getPropertyInfo();return c?c.dataType:null}});this.defineProp("parentEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:false});this.defineProp("valueTextMode",{dataType:DataType.INT});this.defineProp("readOnly",{dataType:DataType.BOOL});this.defineProp("allowEmpty",{dataType:DataType.BOOL})},finalize:function($super){this.finalizeWidget();$super()},finalizeWidget:function(){if(this._editWidget){this._editWidget.finalize();this._editWidget=null}},getEditWidget:function(){return this._editWidget},getObjPropValue:function(d,c){if(Kekule.ObjUtils.isUnset(c)){return d}if(d instanceof ObjectEx){return d.getPropValue(c)}else{if(DataType.isArrayValue(d)){return d[c]}else{if(d instanceof Object){return d[c]}else{return undefined}}}},setObjPropValue:function(d,c,e){if(d instanceof ObjectEx){d.setPropValue(c,e)}else{if(d instanceof Object){d[c]=e}}return this},getObjsPropValue:function(h,g){if(!h){return undefined}if(Kekule.ObjUtils.isUnset(g)){return h}var j=h[0];var c=this.getObjPropValue(j,g);for(var e=1,d=h.length;e<d;++e){var j=h[e];var f=this.getObjPropValue(j,g);if(f!==c){return undefined}}return c},setObjsPropValue:function(f,e,h){if(!f||!e){return this}for(var d=0,c=f.length;d<c;++d){var g=f[d];this.setObjPropValue(g,e,h)}return this},isReadOnly:function(){return !!(this.getAttributes()&b.READONLY)},hasSubPropertyEditors:function(){var c=this.getAttributes();return !!(c&b.SUBPROPS)},getAttributes:function(){var c=b.MULTIOBJS|b.SIMPLEVALUE;var d=this.getPropertyInfo();if(Kekule.ObjUtils.isUnset(this.getReadOnly())){if(d&&!d.setter){c=c|b.READONLY}}else{if(this.getReadOnly()){c=c|b.READONLY}}return c},getSubPropertyEditors:function(c){return null},getTitle:function(){var c=this.getPropertyInfo();if(c){return(c.title||c.name)}else{return""}},getHint:function(){return this.getTitle()},getDescription:function(){var c=this.getPropertyInfo();return c.description},getValue:function(){return this.getObjsPropValue(this.getObjects(),this.getPropertyName())},getValueText:function(){var d=Kekule.Widget.ValueListEditor.ValueDisplayMode;var f=this.getValue();var h=this.getValueTextMode();try{var c=(h===d.JSON)?JSON.stringify(f):Kekule.ObjUtils.isUnset(f)?"":""+f}catch(g){return""+f}return c},setValue:function(d){var c=this.setObjsPropValue(this.getObjects(),this.getPropertyName(),d);if(this.getParentEditor()&&this.getParentEditor().notifyChildEditorValueChange){this.getParentEditor().notifyChildEditorValueChange(this.getPropertyName(),d)}return c},createEditWidget:function(d){var e=this.getValue();var c=this.doCreateEditWidget(d,e);if(c&&c.setIsDirty){c.setIsDirty(false)}this._editWidget=c;return c},doCreateEditWidget:function(c){},saveEditValue:function(){if(this._editWidget){if(!this._editWidget.getIsDirty||this._editWidget.getIsDirty()){var c=this.doSaveEditValue();if(this._editWidget.setIsDirty){this._editWidget.setIsDirty(false)}return c}else{return false}}else{return false}},doSaveEditValue:function(){},notifyChildEditorValueChange:function(d,c){}});Kekule.PropertyEditor.EditorAttributes={MULTIOBJS:1,SUBPROPS:2,SIMPLEVALUE:4,VALUELIST:8,CUSTOMEDIT:16,READONLY:32,INLINE_EDIT:128,DROP_EDIT:256,POPUP_EDIT:512};var b=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.EditorMananger=Class.create({initialize:function(){this._registeredItems=[];this._defaultItems=[]},register:function(c,g,d,f,h){var e={editorClass:c,propType:g,objClass:d,propName:f,matchFunc:h};this._registeredItems.push(e);if(!g&&!d&&!f&&!h){this._defaultItems.push(e)}return this},unregister:function(c){var d=this._registeredItems;for(var e=d.length-1;e>=0;--e){var f=d[e];if(f.editorClass===c){d.splice(e,1)}}var d=this._defaultItems;for(var e=d.length-1;e>=0;--e){var f=d[e];if(f.editorClass===c){d.splice(e,1)}}return this},_getDefaultItem:function(){var c=this._defaultItems;return c[c.length-1]},_getSuperiorItem:function(f,e){var c=["matchFunc","propName","objClass","propType"];for(var g=0,d=c.length;g<d;++g){if(!!f[c]===!!e[c]){continue}else{return f[c]?f:e}}return f},_isMatchedPropType:function(f,e){var d=(f===e);if(!d){if(DataType.isObjectExType(f)&&DataType.isObjectExType(e)){var c=ClassEx.findClass(f);var g=ClassEx.findClass(e);d=ClassEx.isOrIsDescendantOf(c,g)}}return d},_testOnPropType:function(d,c){if(!d.propType||!c.dataType){return 0}if(this._isMatchedPropType(c.dataType,d.propType)){return 1}else{return -1}},_testOnObjClass:function(c,d){if(!c.objClass||!d){return 0}else{if(ClassEx.isOrIsDescendantOf(d,c.objClass)){return 1}else{return -1}}},_testOnPropName:function(d,c){if(!d.propName||!c.name){return 0}else{if(d.propName===c.name){return 1}else{return -1}}},_testOnMatchFunc:function(d,e,c){if(!d.matchFunc){return 0}else{if(d.matchFunc(e,c)){return 1}else{return -1}}},findEditorClass:function(n,k){var o=null;var l=this._registeredItems;var e=false;var j=[];for(var h=l.length-1;h>=0;--h){var m=l[h];var g=this._testOnPropType(m,k);if(g<0){continue}var f=this._testOnObjClass(m,n);if(f<0){continue}var d=this._testOnPropName(m,k);if(d<0){continue}var c=this._testOnMatchFunc(m,n,k);if(c<0){continue}e=(g+f+d+c)>0;if(e){if(o){o=this._getSuperiorItem(o,m.editorClass)}else{o=m.editorClass}if(o&&m.matchFunc){break}}}if(!o){var m=this._getDefaultItem();o=m?m.editorClass:null}return o},findEditorClassForType:function(e,d){var c={dataType:e,name:d};return this.findEditorClass(null,c)}});Kekule.ClassUtils.makeSingleton(Kekule.PropertyEditor.EditorMananger);Kekule.PropertyEditor.findEditorClass=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClass.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.findEditorClassForType=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClassForType.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.register=Kekule.PropertyEditor.EditorMananger.getInstance().register.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.unregister=Kekule.PropertyEditor.EditorMananger.getInstance().unregister.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.SimpleEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SimpleEditor",convertStrToValue:function(d,c){if(DataType.isSimpleType(c)){if(!d&&this.getAllowEmpty()){return null}else{return Kekule.StrUtils.convertToType(d,c)}}else{return d}},setValueText:function(c){if(c===this._originValueText){return false}var e;var d=this.getPropertyType();if(d&&!DataType.isSimpleType(d)){return false}if(d){e=this.convertStrToValue(c,d)}else{e=c}this.setValue(e);return true},doCreateEditWidget:function(d){var e=this.getValueText();this._originValueText=e;var c=new Kekule.Widget.TextBox(d,e);return c},doSaveEditValue:function(){return this.setValueText(this.getEditWidget().getValue())}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.SimpleEditor);Kekule.PropertyEditor.TextEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.TextEditor",LINE_BREAK_REPLACER:"\\n",textToSingleLine:function(c){return c.split("\n").join(this.LINE_BREAK_REPLACER)},textToMultiLine:function(c){return c.split(this.LINE_BREAK_REPLACER).join("\n")},doCreateEditWidget:function(d){this._parentWidget=d;var e=this.getValueText();this._originValueText=e;var c=new Kekule.Widget.ButtonTextBox(d,this.textToSingleLine(e));this._textbox=c;c.setButtonKind(Kekule.Widget.Button.Kinds.POPUP);c.addEventListener("buttonExecute",this.reactButtonExecute,this);return c},reactButtonExecute:function(c){this.openPopupEditor()},openPopupEditor:function(){var d=this._popupDialog;if(!d){d=this.createPopupDialog();this._popupDialog=d}var e=this._popupEditor;e.setValue(this.getValueText());var c=this;d.openPopup(function(f){if(f===Kekule.Widget.DialogButtons.OK){c._textbox.setValue(c.textToSingleLine(e.getValue()));c._textbox.setIsDirty(true);c.saveEditValue()}},this._textbox)},createPopupDialog:function(){var f=this._parentWidget.getDocument();var d=new Kekule.Widget.Dialog(f,this.getPropertyName(),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);d.setLocation(Kekule.Widget.Location.CENTER_OR_FULLFILL);var c=Kekule.Widget.TextArea;var g=new c(f);var e=g.getElement().style;e.width="40em";e.height="20em";g.appendToWidget(d);this._popupEditor=g;return d},doSaveEditValue:function(){var c=this.getEditWidget().getValue();c=this.textToMultiLine(c);if(c!==this._originValueText){this.setValueText(c);return true}else{return false}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.TextEditor,DataType.STRING);Kekule.PropertyEditor.BoolEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.BoolEditor",boolToStr:function(c){return Kekule.StrUtils.boolToStr(c)},doCreateEditWidget:function(d){this._originValue=this.getValue();var c=new Kekule.Widget.CheckBox(d,this._originValue);c.setText(this.boolToStr(this._originValue));var e=this;c.addEventListener("valueChange",function(g){var f=c.getChecked();c.setText(e.boolToStr(f))});return c},getValueText:function($super){var c=this.getValue();if(Kekule.ObjUtils.isUnset(c)){return Kekule.$L("WidgetTexts.S_VALUE_UNSET")}else{return $super()}},doSaveEditValue:function(){var c=this.getEditWidget().getChecked();if(c!==this._originValue){this.setValue(c);return true}else{return false}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.BoolEditor,DataType.BOOL);Kekule.PropertyEditor.SelectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SelectEditor",getValueText:function($super){var e=this.getValue();var d=this.getSelectItems()||[];for(var f=0,c=d.length;f<c;++f){var g=d[f];if(g.value===e){return g.text}}return $super()},getSelectItems:function(){return[]},doCreateEditWidget:function(d){var c=new Kekule.Widget.SelectBox(d,this.getSelectItems());this._originalValue=this.getValue();c.setValue(this._originalValue);return c},doSaveEditValue:function(){var c=this.getEditWidget().getValue();if(c!==this._originalValue){this.setValue(c);return true}else{return false}}});Kekule.PropertyEditor.EnumEditor=Class.create(Kekule.PropertyEditor.SelectEditor,{CLASS_NAME:"Kekule.PropertyEditor.EnumEditor",initialize:function($super){$super();this.enumInfos=[]},setPropertyInfo:function($super,f){$super(f);if(f){var g=f.enumSource;if(g&&DataType.isObjectValue(g)){var c=Kekule.ObjUtils.getOwnedFieldNames(g);this.enumInfos=[];for(var e=0,d=c.length;e<d;++e){this.enumInfos.push({text:c[e],value:g[c[e]]})}}}},getSelectItems:function(){var d=this.getValue();if(Kekule.ObjUtils.isUnset(d)){var c=Kekule.ArrayUtils.clone(this.enumInfos);c.unshift({text:Kekule.$L("WidgetTexts.S_VALUE_UNSET"),value:d});return c}return this.enumInfos}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.EnumEditor,null,null,null,function(d,c){return !!c.enumSource});Kekule.PropertyEditor.ObjectExEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectExEditor",getAttributes:function($super){var c=$super();c=c|b.SUBPROPS;return c},hasSubPropertyEditors:function($super){return $super()&&this.getValue()},getSubPropertyEditors:function(c){var n=[];var g=this.getValue();if(g){if(g instanceof ObjectEx){var e=g;var m=e.getClass()}else{var m=ClassEx.getCommonSuperClass(g)}var o=ClassEx.getPropListOfScopes(m,c);for(var f=0,d=o.getLength();f<d;++f){var k=o.getPropInfoAt(f);var h=Kekule.PropertyEditor.findEditorClass(m,k);if(h){var j=new h();j.setObjects(Kekule.ArrayUtils.toArray(g));j.setPropertyInfo(k);j.setValueTextMode(this.getValueTextMode());n.push(j)}}}return n},getValueText:function($super){var c=this.getValue();if(Kekule.ObjUtils.notUnset(c)){if(c.getClassName){return"["+c.getClassName()+"]"}else{return $super()}}else{return Kekule.$L("WidgetTexts.S_OBJECT_UNSET")}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectExEditor,"ObjectEx");Kekule.PropertyEditor.ObjectFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectFieldEditor",initialize:function(){},doCreateEditWidget:function($super,d){if(!this.getPropertyType()){var e=this.getValue();this.getPropertyInfo().dataType=DataType.getType(e)}var c=$super(d);return c}});Kekule.PropertyEditor.ObjectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectEditor",initialize:function($super){$super();this._initialObjValue=undefined},getFieldEditorClass:function(d,c){return Kekule.PropertyEditor.findEditorClass(null,c)||Kekule.PropertyEditor.ObjectFieldEditor},getFieldValueType:function(d,e){var c=d[e];if(Kekule.ObjUtils.notUnset(c)){return DataType.getType(c)}else{return null}},createFieldEditor:function(f,e){var g=this.getFieldEditorClass(f,e);var d=new g();d.setParentEditor(this);d.setReadOnly(false);d.setAllowEmpty(this.getAllowEmpty());d.setPropertyInfo(e);d.setObjects(f);d.setValueTextMode(this.getValueTextMode());return d},getObjFields:function(c){if(c){return Kekule.ObjUtils.getOwnedFieldNames(c)}else{return[]}},getObjFieldInfos:function(h){var d=this.getObjFields(h);var c=[];for(var f=0,e=d.length;f<e;++f){var g={name:d[f],dataType:this.getFieldValueType(h,d[f])};c.push(g)}return c},notifyChildEditorValueChange:function(e,d){var c=this.getValue()||this._initialObjValue;c[e]=d;this.setValue(c)},getAttributes:function($super){var c=$super();c=c|b.SUBPROPS;return c},hasSubPropertyEditors:function($super){return $super()&&this.getObjFieldInfos(this.getValue()).length},getValueText:function($super){var c=Kekule.Widget.ValueListEditor.ValueDisplayMode;var e=this.getValueTextMode();if(e===c.JSON){return $super()}var d=this.getValue();if(d){return"["+Kekule.$L("WidgetTexts.S_OBJECT")+"]"}else{return""}},setValue:function($super,d){var c=$super(d);this._initialObjValue=d;return c},getSubPropertyEditors:function(d){var m=[];var h=a.toArray(this.getValue());if(h.length>1){return[]}var f=h[0];if(!f){this._initialObjValue={}}else{this._initialObjValue=f}var c=this.getObjFieldInfos(f);var k=[this._initialObjValue];for(var g=0,e=c.length;g<e;++g){var j=this.createFieldEditor(k,c[g]);m.push(j)}return m}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectEditor,DataType.OBJECT);Kekule.PropertyEditor.ArrayEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ArrayEditor",getAttributes:function($super){var c=$super();c=c|b.SUBPROPS;return c},hasSubPropertyEditors:function($super){var c=this.getValue();return $super()&&c&&c.length},getSubPropertyEditors:function(c){var o=[];var m=this.getValue();if(DataType.isArrayValue(m)&&m.length){var j=this.getPropertyInfo().elementType;for(var e=0,d=m.length;e<d;++e){var n=m[e];var h=j||DataType.getType(n);var f=Kekule.PropertyEditor.findEditorClassForType(h);if(f){var g=new f();g.setParentEditor(this);g.setObjects([m]);var k={name:e,title:e,dataType:h};g.setPropertyInfo(k);g.setValueTextMode(this.getValueTextMode());o.push(g)}}}return o},getValueText:function($super){var c=this.getValue();if(DataType.isArrayValue(c)){return"["+c.length+" "+Kekule.$L("WidgetTexts.S_ITEMS")+"]"}else{return $super()}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ArrayEditor,DataType.ARRAY);Kekule.PropertyEditor.ColorEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ColorEditor",doCreateEditWidget:function(d){this._parentWidget=d;var e=this.getValue();this._originValue=e;var c=new Kekule.Widget.ColorDropTextBox(d,e);c.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET]);c.addEventListener("valueSet",function(f){this.saveEditValue()},this);this._textbox=c;return c},doSaveEditValue:function(){var c=this.getEditWidget().getValue();if(c===Kekule.Widget.ColorPicker.SpecialColors.UNSET){c=undefined}else{if(c===""){c=undefined}}if(c!==this._originValue){this.setValue(c);return true}else{return false}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ColorEditor,DataType.STRING,null,null,function(d,c){var e=c.name;return e&&(e.toLowerCase().indexOf("color")>=0)})})();(function(){Kekule.Widget.PropEditorModifyOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.Widget.PropEditorModifyOperation",initialize:function($super,b,c,a){$super();this.setPropEditor(b);this.setNewValue(c);this.setOldValue(a)},initProperties:function(){this.defineProp("propEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:false});this.defineProp("newValue",{dataType:DataType.VARIANT,serializable:false});this.defineProp("oldValue",{dataType:DataType.VARIANT,serializable:false})},doExecute:function(){var a=this.getPropEditor();if(this.getOldValue()===undefined){this.setOldValue(a.getValue())}a.setValue(this.getNewValue())},doReverse:function(){this.getPropEditor().setValue(this.getOldValue())}})})();(function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_CONFIGURATOR:"K-Widget-Configurator",WIDGET_CONFIGURATOR_CLIENT:"K-Widget-Configurator-Client",ACTION_OPEN_CONFIGURATOR:"K-Action-Open-Configurator"});var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.Configurator=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.Widget.Configurator",TAB_BTN_DATA_FIELD:"__$data__",DEF_TAB_POSITION:Kekule.Widget.Position.RIGHT,initialize:function($super,b){this.setPropStoreFieldValue("widget",b);this._objInspector=null;this._tabGroup=null;$super(b)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false});this.defineProp("autoUpdate",{dataType:DataType.BOOL});this.defineProp("tabPosition",{dataType:DataType.INT,setter:function(b){this.setPropStoreFieldValue("tabPosition",b);if(this._tabGroup){this._tabGroup.setTabButtonPosition(b||this.DEF_TAB_POSITION)}}})},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},doGetWidgetClassName:function($super){return $super()+" "+a.WIDGET_CONFIGURATOR},doCreateRootElement:function(c){var b=c.createElement("div");return b},doCreateSubElements:function($super,o,h){var p=[];var d=o.createElement("div");d.className=a.WIDGET_CONFIGURATOR_CLIENT;p.push(d);var n=new Kekule.Widget.ObjectInspector(this);n.setShowObjsInfoPanel(false);n.setSortField(null);n.appendToElem(d);this._objInspector=n;n.addEventListener("propertyChange",function(c){this.invokeEvent("configChange",{obj:n.getObjects()[0],propertyName:c.propertyInfo.name,oldValue:c.oldValue,newValue:c.newValue})},this);var j=this.getCategoryInfos();var f=new Kekule.Widget.TabButtonGroup(this);this._tabGroup=f;f.setTabButtonPosition(this.getTabPosition()||this.DEF_TAB_POSITION);var k;for(var g=0,e=j.length;g<e;++g){var m=j[g];var b=new Kekule.Widget.RadioButton(f);b.setText(m.title||m.name);b.setHint(m.description||"");b[this.TAB_BTN_DATA_FIELD]=m.obj;b.appendToWidget(f);if(g===0){k=b}}f.addEventListener("execute",function(i){var c=i.widget;if(c instanceof Kekule.Widget.RadioButton){this._switchToTab(c)}},this);f.appendToElem(d);if(j.length<=1){f.setDisplayed("none")}k.setChecked(true);this._switchToTab(k);h.appendChild(d);return p},doWidgetShowStateChanged:function($super,b){$super(b);if(this.getAutoUpdate()){if(b){this.loadConfigValues()}else{this.saveConfigValues()}}},loadConfigValues:function(){},saveConfigValues:function(){},getCategoryInfos:function(){var e=this.getWidget();var b=[];var d=e.getSettingFacade();if(d){var c=e.getPropInfo("settingFacade");b.push({obj:d,name:c.name,title:c.title,descrption:c.description})}return b},_switchToTab:function(c){var b=c[this.TAB_BTN_DATA_FIELD];this._objInspector.setObjects(b)}});Kekule.Widget.ActionOpenConfigWidget=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Widget.ActionOpenConfigWidget",HTML_CLASSNAME:a.ACTION_OPEN_CONFIGURATOR,initialize:function($super,b){$super();this.setWidget(b);this.setText(Kekule.$L("WidgetTexts.CAPTION_CONFIG"));this.setHint(Kekule.$L("WidgetTexts.HINT_CONFIG"))},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false})},doUpdate:function(){var b=this.getWidget();this.setEnabled(b&&b.getEnabled())},doExecute:function(b){this.getWidget().openConfigurator(b)}});ClassEx.extend(Kekule.Widget.BaseWidget,{getSettingFacadeClass:function(){var e=this.getClass();var b=null;do{var d=ClassEx.getClassName(e)+".Settings";b=ClassEx.findClass(d);e=ClassEx.getSuperClass(e)}while(e&&!b);return b},getConfiguratorClass:function(){var e=this.getClass();var b=null;do{var d=ClassEx.getClassName(e)+".Configurator";b=ClassEx.findClass(d);e=ClassEx.getSuperClass(e)}while(e&&!b);return b},createConfigurator:function(){var b=this.getConfiguratorClass();return new b(this)},getConfigurator:function(){if(!this._configurator){this._configurator=this.createConfigurator()}return this._configurator},openConfigurator:function(b){var d=this.getConfigurator();d.show(b||this,null,Kekule.Widget.ShowHideType.DROPDOWN)}});ClassEx.defineProp(Kekule.Widget.BaseWidget,"settingFacade",{dataType:DataType.OBJECTEX,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var b=this.getPropStoreFieldValue("settingFacade");if(!b){var d=this.getSettingFacadeClass();if(d){b=new d(this);this.setPropStoreFieldValue("settingFacade",b)}}return b}});Kekule.Widget.BaseWidget.Settings=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget.Settings",initialize:function($super,b){this._basedClass=null;$super();this.setWidget(b)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,scope:Class.PropertyScope.PUBLIC})},getBasedClass:function(){if(!this.hasOwnProperty("_basedClass")||!this._basedClass){var c=this.getClassName();var b=c.split(".");b.pop();c=b.join(".");this._basedClass=ClassEx.findClass(c)}return this._basedClass},defineDelegatedProp:function(d,e){if(!e){e=d}var b=ClassEx.getPropInfo(this.getBasedClass(),e);var c=Object.create(b);c.setter=null;c.getter=null;if(b.getter){c.getter=function(){return this.getWidget().getPropValue(e)}}if(b.setter){c.setter=function(f){this.getWidget().setPropValue(e,f)}}this.defineProp(d,c)},defineDelegatedProps:function(g,d){if(!d){d=[]}for(var c=0,b=g.length;c<b;++c){var e=g[c];var f=d[c]||e;this.defineDelegatedProp(e,f)}}})})();(function(){Kekule.Widget.BaseDataSet=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseDataSet",PREFIX_SORT_DESC:"!",initProperties:function(){this.defineProp("enableCache",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableCache")&&this.getCacheAvailable()},setter:function(a){this.setPropStoreFieldValue("enableCache",a);if(!a){this.clearCache()}}});this.defineProp("defaultTimeout",{dataType:DataType.INT});this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(c){var b=c?Kekule.ArrayUtils.toArray(c):null;this.setPropStoreFieldValue("sortFields",b);this.sortFieldsChanged(b)}});this.defineProp("cache",{dataType:DataType.ARRAY})},initPropValues:function($super){$super();this.setEnableCache(true);this.setCache([]);this.setDefaultTimeout(20000)},finalize:function($super){this.clearCache();this.setCache(null);$super()},dataChanged:function(){this.clearCache();this.invokeEvent("dataChange")},sortFieldsChanged:function(a){this.clearCache();this.doSortFieldsChanged(a)},doSortFieldsChanged:function(a){},getTotalCount:function(){return this.doGetTotalCount()||0},doGetTotalCount:function(){},totalCountChanged:function(a){this.invokeEvent("totalCountChange",{totalCount:a})},getFirstIndex:function(){return 0},getLastIndex:function(){return(this.getTotalCount()||0)-1},getCacheAvailable:function(){return true},clearCache:function(){this.getCache().length=0;return this},saveCacheData:function(d,c){var a=this.getCache();var e=c;for(var b=0;b<d.length;++b){a[e]=d[b]||null;++e}},loadCacheData:function(e,g){if(!this.getEnableCache()){return null}else{var c=this.getCache();if(c.length<e+g){return null}var a=[];for(var d=e,b=e+g;d<b;++d){var f=c[d];if(f===undefined){return null}else{a.push(f)}}return a}},fetch:function(j){var d=Object.extend({fromIndex:0,count:0},j);d.timeout=d.timeout||this.getDefaultTimeout();if(this.getEnableCache()){var c=this.loadCacheData(d.fromIndex,d.count);if(c){d.callback(c);return}}var h=this;var a=false;var b=function(k){if(a){return}if(g){clearTimeout(g)}if(j.callback){j.callback(k)}if(h.getEnableCache()){h.saveCacheData(k,d.fromIndex)}};var e=function(k){if(a){return}if(g){clearTimeout(g)}if(j.errCallback){j.errCallback(k)}};if(d.timeout>0){var f=function(){if(g){clearTimeout(g)}a=true;if(d.timeoutCallback){d.timeoutCallback()}else{if(j.errCallback){j.errCallback(Kekule.$L("ErrorMsg.FETCH_DATA_TIMEOUT"))}}};var g=setTimeout(f,d.timeout)}d.callback=b;d.errCallback=e;var i=this.doFetch(d.fromIndex,d.count,d.callback,d.errCallback)},doFetch:function(b,c,d,a){}});Kekule.Widget.ArrayDataSet=Class.create(Kekule.Widget.BaseDataSet,{CLASS_NAME:"Kekule.Widget.ArrayDataSet",initialize:function($super,a){$super();this.setData(a)},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY,setter:function(b){this.setPropStoreFieldValue("data",b);var a=this.getSortFields();if(a){this.doSortFieldsChanged(a)}this.dataChanged()}})},getCacheAvailable:function(){return false},doSortFieldsChanged:function(a){var b=this.getData()||[];Kekule.ArrayUtils.sortHashArray(b,a);this.dataChanged();return this},doGetTotalCount:function(){return(this.getData()||[]).length},doFetch:function(f,d,g,e){var j=[];var b=this.getData()||[];for(var c=f,a=Math.min(f+d,b.length);c<a;++c){var h=b[c];j.push(h)}g(j)}});Kekule.Widget.DataPager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DataPager",initialize:function($super,a){$super();this.setDataSet(a)},initProperties:function(){this.defineProp("dataSet",{dataType:"Kekule.Widget.BaseDataSet",setter:function(b){var a=this.getDataSet();if(b!==a){this.setPropStoreFieldValue("dataSet",b);this.dataSetChange(a,b);this.switchToPage(this.getCurrPageIndex()||0)}}});this.defineProp("pageSize",{dataType:DataType.INT,setter:function(a){if(a!==this.getPageSize()){this.setPropStoreFieldValue("pageSize",a);this.pageCountChanged(this.getPageCount());this.switchToPage(this.getCurrPageIndex()||0)}}});this.defineProp("currPageIndex",{dataType:DataType.INT});this.defineProp("currPageData",{dataType:DataType.ARRAY});this.defineProp("sortFields",{dataType:DataType.ARRAY,serializable:false,getter:function(){return this.getDataSet()&&this.getDataSet().getSortFields()},setter:function(a){if(this.getDataSet()){this.getDataSet().setSortFields(a)}}})},initPropValues:function($super){$super();this.setCurrPageIndex(0)},dataSetChange:function(a,b){if(a){a.RemoveEventListener("dataChange",this.reactDataSetDataChange,this);a.RemoveEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)}if(b){b.addEventListener("dataChange",this.reactDataSetDataChange,this);b.addEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)}this.pageCountChanged(this.getPageCount())},reactDataSetDataChange:function(a){this.dataChanged()},dataChanged:function(){this.pageCountChanged(this.getPageCount());this.switchToPage(this.getCurrPageIndex()||0)},reactDataSetTotalCountChange:function(a){this.pageCountChanged(this.getPageCount())},getPageCount:function(){var b=this.getDataSet();var a=b?(b.getTotalCount()||0):0;return Math.ceil(a/this.getPageSize())},pageCountChanged:function(a){this.invokeEvent("pageCountChange",{pageCount:a})},fetchPageData:function(c){var b=this.getPageSize();var a=Kekule.ObjUtils.isUnset(c.pageIndex)?this.getCurrPageIndex():c.pageIndex;var e=b*a;var f=this.getPageSize();var d=Object.create(c);Object.extend(d,{fromIndex:e,count:f});this.getDataSet().fetch(d);return this},switchToPage:function(a,d){var b=this;var c={pageIndex:a,timeout:d,callback:function(e){b.setCurrPageData(e);b.setCurrPageIndex(a);b.invokeEvent("dataFetched",{pageIndex:a,data:e})},errCallback:function(e){b.invokeEvent("dataError",{error:e});Kekule.error(e)}};this.invokeEvent("pageRetrieve",{pageIndex:a});this.fetchPageData(c)}})})();(function(){var d=Kekule.DomUtils;var e=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DATAGRID:"K-DataGrid",DATATABLE:"K-DataTable",DATATABLE_ROW_ODD:"K-Odd",DATATABLE_ROW_EVEN:"K-Even",DATATABLE_CELL_WRAPPER:"K-DataTable-CellWrapper",DATATABLE_HEADCELL_INTERACTABLE:"K-DataTable-HeadCellInteractable",DATATABLE_OPER_COL:"K-DataTable-OperCol",DATATABLE_OPER_CELL:"K-DataTable-OperCell",DATATABLE_CHECK_COL:"K-DataTable-CheckCol",DATATABLE_CHECK_CELL:"K-DataTable-CheckCell",DATATABLE_DATA_COL:"K-DataTable-DataCol",DATATABLE_DATA_CELL:"K-DataTable-DataCell",DATATABLE_SORTMARK:"K-DataTable-SortMark",DATATABLE_SORTASC:"K-Sort-Asc",DATATABLE_SORTDESC:"K-Sort-Desc",DATATABLE_EDIT:"K-DataTable-Edit",DATATABLE_DELETE:"K-DataTable-Delete",DATATABLE_INSERT:"K-DataTable-Insert",PAGENAVIGATOR:"K-PageNavigator",PAGENAVIGATOR_FIRST:"K-PageNavigator-First",PAGENAVIGATOR_LAST:"K-PageNavigator-Last",PAGENAVIGATOR_PREV:"K-PageNavigator-Prev",PAGENAVIGATOR_NEXT:"K-PageNavigator-Next",PAGENAVIGATOR_PAGEINDEXER:"K-PageNavigator-PageIndexer",PAGENAVIGATOR_PAGEINPUT:"K-PageNavigator-PageInput",PAGENAVIGATOR_PAGESELECTOR:"K-PageNavigator-PageSelector"});Kekule.Widget.DataTableColNames={OPER:"OPER",CHECK:"CHECK",ALL:"*"};var c=Kekule.Widget.DataTableColNames;Kekule.Widget.DataTable=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DataTable",BINDABLE_TAG_NAMES:["div","span"],PREFIX_SORT_DESC:"!",COLDEF_FIELD:"__$colDef__",ROWDATA_FIELD:"__$rowData__",ROW_OPER_TOOLBAR_FIELD:"__$rowOperToolbar__",ROW_CHECKBOX_FIELD:"__$rowCheckBox__",COLNAME_OPER:c.OPER,COLNAME_CHECK:c.CHECK,COLNAME_ALL:c.ALL,initialize:function($super,g){this._displayData=null;this.setPropStoreFieldValue("showTableHead",true);$super(g)},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY});this.defineProp("columns",{dataType:DataType.ARRAY});this.defineProp("operColShowMode",{dataType:DataType.STRING});this.defineProp("operWidgets",{dataType:DataType.ARRAY});this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(h){var g=h?Kekule.ArrayUtils.toArray(h):null;this.setPropStoreFieldValue("sortFields",g);if(this.getDataPager()){this.getDataPager().setSortFields(g)}}});this.defineProp("sortFunc",{dataType:DataType.FUNCTION});this.defineProp("showTableHead",{dataType:DataType.BOOL});this.defineProp("enableHeadInteraction",{dataType:DataType.BOOL});this.defineProp("enableActiveRow",{dataType:DataType.BOOL,setter:function(g){this.setPropStoreFieldValue("enableActiveRow",g);if(!g){this.setActiveCell(null)}}});this.defineProp("activeCell",{dataType:DataType.OBJECT,setter:function(h){var g=this.getActiveCell();if(g!==h){if(g){e.removeClass(g,b.STATE_ACTIVE)}this.setPropStoreFieldValue("activeCell",h);if(h){e.addClass(h,b.STATE_ACTIVE);var i=this.getParentRow(h);if(i){this.setActiveRow(i)}}else{this.setActiveRow(null)}}}});this.defineProp("activeRow",{dataType:DataType.OBJECT,setter:function(h){var g=this.getActiveRow();if(g!==h){this.activeRowChanged(g,h);this.setPropStoreFieldValue("activeRow",h)}}});this.defineProp("hoverCell",{dataType:DataType.OBJECT,setter:function(h){var g=this.getHoverCell();if(g!==h){if(g){e.removeClass(g,b.STATE_HOVER)}this.setPropStoreFieldValue("hoverCell",h);if(h){e.addClass(h,b.STATE_HOVER);var i=this.getParentRow(h);if(i){this.setHoverRow(i)}}else{this.setHoverRow(null)}}}});this.defineProp("hoverRow",{dataType:DataType.OBJECT,setter:function(h){var g=this.getHoverRow();if(g!==h){this.hoverRowChanged(g,h);this.setPropStoreFieldValue("hoverRow",h)}}});this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(h){var g=this.getDataPager();if(g!==h){this.setPropStoreFieldValue("dataPager",h);this.dataPagerChanged(h,g)}}})},initPropValues:function($super){$super();this.reactOperEditBind=this.reactOperEdit.bind(this);this.reactOperDeleteBind=this.reactOperDelete.bind(this);this.reactOperInsertBind=this.reactOperInsert.bind(this)},doObjectChange:function($super,h){$super(h);var g=["data","columns","sortFields","sortFunc","showTableHead","enableHeadInteraction","operColShowMode","operWidgets"];if(Kekule.ArrayUtils.intersect(h,g).length){this.recreateChildContent()}},doGetWidgetClassName:function($super){return $super()+" "+b.DATATABLE},doCreateRootElement:function(h){var g=h.createElement("div");return g},doCreateSubElements:function(h,g){return this.doCreateDataTable(h,g)},doCreateDataTable:function(i,h){var g=i.createElement("table");this.recreateChildContent(i,g);h.appendChild(g);return g},getTableElement:function(){return this.getElement()&&this.getElement().getElementsByTagName("table")[0]},getShowOperCol:function(){var g=this.getOperColShowMode()||Kekule.Widget.DataTable.OperColShowMode.NONE;return g!==Kekule.Widget.DataTable.OperColShowMode.NONE},recreateChildContent:function(k,h){this.setActiveCell(null);this.setHoverCell(null);var j=this.prepareData();var i=h||this.getTableElement();var g=[];if(i){d.clearChildContent(i);if(!k){var k=i.ownerDocument}g.push(this.doCreateDataTableColGroup(k,i,j.columns));if(this.getShowTableHead()){g.push(this.doCreateDataTableHead(k,i,j.columns))}g.push(this.doCreateDataTableBody(k,i,j.columns,j.data))}return g},doCreateDataTableColGroup:function(o,k,g){var m=g||[];var q=o.createElement("colgroup");for(var j=0,h=m.length;j<h;++j){var n=m[j]||{};var p=o.createElement("col");if(n.colClassName){p.className=n.colClassName}if(n.colStyle){p.style.cssText=n.colStyle}q.appendChild(p)}k.appendChild(q);return q},doCreateDataTableCellWrapper:function(i,h){var g=i.createElement("span");g.className=b.DATATABLE_CELL_WRAPPER;h.appendChild(g);return g},doCreateDataTableHead:function(q,n,k){var o=k||[];var g=this.getEnableHeadInteraction();var r=q.createElement("thead");var h=q.createElement("tr");for(var m=0,j=o.length;m<j;++m){var p=o[m]||{};this.doCreateDataTableHeadCell(q,h,p,g)}r.appendChild(h);n.appendChild(r);return r},doCreateDataTableHeadCell:function(n,g,j,m){var i=n.createElement("th");if(j.className){i.className=j.className}if(j.style){i.style.cssText=j.style}var l=this.doCreateDataTableCellWrapper(n,i);var k=Kekule.ObjUtils.notUnset(j.disableInteract)?!j.disableInteract:m;if(k){e.addClass(i,b.DATATABLE_HEADCELL_INTERACTABLE)}d.setElementText(l,j.text||j.name);var h=this.doCreateDataTableHeadCellSortMark(n,i);if(j.sorting===1){e.addClass(h,b.DATATABLE_SORTASC)}else{if(j.sorting===-1){e.addClass(h,b.DATATABLE_SORTDESC)}else{}}l.title=j.hint||"";i[this.COLDEF_FIELD]=j;g.appendChild(i);return i},doCreateDataTableHeadCellSortMark:function(i,h){var g=i.createElement("span");g.className=b.DATATABLE_SORTMARK;h.appendChild(g);return g},doCreateDataTableBody:function(H,v,m,F){var s=m||[];var F=F||[];var r=H.createElement("tbody");if(this.getShowOperCol()){var x=this.getOperWidgetDefinitions()}var u=true;for(var D=0,z=F.length;D<z;++D){var n=H.createElement("tr");n.className=u?b.DATATABLE_ROW_ODD:b.DATATABLE_ROW_EVEN;u=!u;var p=F[D]||{};n[this.ROWDATA_FIELD]=p;for(var B=0,A=s.length;B<A;++B){var t=s[B];var G=t.name;var y=p[G];var o=H.createElement("td");if(t.className){o.className=t.className}if(t.style){o.style.cssText=t.style}var g=this.doCreateDataTableCellWrapper(H,o);if(t.isOperCol){var h={rowData:p,rowIndex:D,colIndex:B,childWidgetDefinitions:x};var q=this.doCreateOperCellContent(g,h);n[this.ROW_OPER_TOOLBAR_FIELD]=q}else{if(t.isCheckCol){var h={rowData:p,rowIndex:D,colIndex:B};var E=this.doCreateCheckCellContent(g,h);n[this.ROW_CHECKBOX_FIELD]=E}else{var h={rowData:p,cellKey:G,cellValue:y,rowIndex:D,colIndex:B};this.doCreateDataCellContent(g,h)}}o.appendChild(g);n.appendChild(o)}r.appendChild(n)}v.appendChild(r);return r},doCreateDataCellContent:function(g,h){var i="";if(Kekule.ObjUtils.notUnset(h.cellValue)){i=""+h.cellValue}d.setElementText(g,i)},doCreateCheckCellContent:function(h,i){var g=new Kekule.Widget.CheckBox(this);g.appendToElem(h);return g},doCreateOperCellContent:function(h,i){var j=this.doCreateOperToolbar(h,i.childWidgetDefinitions);var g=Kekule.Widget.DataTable.OperColShowMode;var k=this.getOperColShowMode();if(k!==g.ALL){j.setVisible(false)}return j},doCreateOperToolbar:function(h,i){var g=new Kekule.Widget.ButtonGroup(this);g.setChildDefs(i);g.appendToElem(h);return g},getDefaultOperButtons:function(){var g=Kekule.Widget.DataTable.Components;return[g.EDIT,g.DELETE]},getOperWidgetDefinitions:function(){var g=[];var n=this.getOperWidgets()||this.getDefaultOperButtons();for(var k=0,h=n.length;k<h;++k){var j=n[k];if(DataType.isObjectValue(j)){g.push(j)}else{var m=this.getDefaultComponentDefinitionHash(j);if(m){g.push(m)}}}return g},getDefaultComponentDefinitionHash:function(h){var i=Kekule.Widget.DataTable.Components;var g;if(h===i.EDIT){g={widget:"Kekule.Widget.Button",htmlClass:b.DATATABLE_EDIT,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_EDIT"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_EDIT"),"#execute":this.reactOperEditBind}}else{if(h===i.DELETE){g={widget:"Kekule.Widget.Button",htmlClass:b.DATATABLE_DELETE,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_DELETE"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_DELETE"),"#execute":this.reactOperDeleteBind}}else{if(h===i.INSERT){g={widget:"Kekule.Widget.Button",htmlClass:b.DATATABLE_INSERT,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_INSERT"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_INSERT"),"#execute":this.reactOperInsertBind}}}}if(g){g.internalName=h}return g},hasExternalDataProvider:function(){return !!this.getDataPager()},needSort:function(){return this.getSortFields()||this.getSortFunc()},sortData:function(){var h=this.getData()||[];if(this.needSort()){if(!this.hasExternalDataProvider()){var g=Kekule.ArrayUtils.clone(h);Kekule.ArrayUtils.sortHashArray(g,this.getSortFields());return g}}return h},prepareData:function(){var s={};var m=this.sortData();s.data=m;var o=function(y){var t=[];for(var x=0,u=y.length;x<u;++x){var w=Kekule.ObjUtils.getOwnedFieldNames(y[x]);Kekule.ArrayUtils.pushUnique(t,w)}var v=[];for(var x=0,u=t.length;x<u;++x){v.push({name:t[x],text:t[x]})}return v};if(this.getColumns()){s.columns=Kekule.ArrayUtils.clone(this.getColumns())}else{s.columns=o(m)}var n=0;while(n<s.columns.length){var g=s.columns[n];if(typeof(g)==="string"){g={name:g}}if(g.name===this.COLNAME_OPER){s.columns[n]={name:"",text:"",disableInteract:true,isOperCol:true,colClassName:b.DATATABLE_OPER_COL,className:b.DATATABLE_OPER_CELL}}else{if(g.name===this.COLNAME_CHECK){s.columns[n]={name:"",text:"",disableInteract:true,isCheckCol:true,colClassName:b.DATATABLE_CHECK_COL,className:b.DATATABLE_CHECK_CELL}}else{if(g.name===this.COLNAME_ALL){var j=o(m);var r=j;r.unshift(1);r.unshift(n);s.columns.splice.apply(s.columns,r)}else{g.colClassName=b.DATATABLE_DATA_COL+" "+(g.colClassName||"");g.className=b.DATATABLE_DATA_CELL+" "+(g.className||"")}}}++n}if(this.needSort()&&!this.getSortFunc()){var k=this.getSortFields();for(var n=0,h=s.columns.length;n<h;++n){var p=s.columns[n];var q=p.name;if(k.indexOf(q)>=0){s.columns[n].sorting=1}else{if(k.indexOf(this.PREFIX_SORT_DESC+q)>=0){s.columns[n].sorting=-1}else{s.columns[n].sorting=0}}}}return s},activeRowChanged:function(h,j){var g=Kekule.Widget.DataTable.OperColShowMode;var i=this.getOperColShowMode();if(h){e.removeClass(h,b.STATE_ACTIVE);if(i===g.ACTIVE||i===g.HOVER){this.hideRowOperToolbar(h)}}if(j){e.addClass(j,b.STATE_ACTIVE);if(i===g.ACTIVE||i===g.HOVER){this.showRowOperToolbar(j)}}},hoverRowChanged:function(h,j){var g=Kekule.Widget.DataTable.OperColShowMode;var i=this.getOperColShowMode();if(h){e.removeClass(h,b.STATE_HOVER);if(i===g.HOVER&&h!==this.getActiveRow()){this.hideRowOperToolbar(h)}}if(j){e.addClass(j,b.STATE_HOVER);if(i===g.HOVER){this.showRowOperToolbar(j)}}},getParentCell:function(g){if(d.isDescendantOf(g,this.getElement())){return d.getNearestAncestorByTagName(g,"td",true)}else{return null}},getParentHeadCell:function(g){if(d.isDescendantOf(g,this.getElement())){return d.getNearestAncestorByTagName(g,"th",true)}else{return null}},getParentRow:function(g){if(d.isDescendantOf(g,this.getElement())){return d.getNearestAncestorByTagName(g,"tr",true)}else{return null}},getColCount:function(){return(this.getColumns()||[]).length},getRowCount:function(){return(this.getData()||[]).length},getDataRows:function(){var g=[];var h=this.getElement().getElementsByTagName("tbody")[0];return h&&h.getElementsByTagName("tr")},getCheckedRows:function(){var g=[];var k=this.getDataRows();for(var j=0,h=k.length;j<h;++j){if(this.isRowChecked(k[j])){g.push(k[j])}}return g},getRowData:function(g){return g?g[this.ROWDATA_FIELD]:null},isRowChecked:function(g){var h=this.getRowCheckBox(g);return h&&h.getChecked&&h.getChecked()},getRowCheckBox:function(g){return g&&g[this.ROW_CHECKBOX_FIELD]},getRowOperToolbar:function(g){return g?g[this.ROW_OPER_TOOLBAR_FIELD]:null},showRowOperToolbar:function(h){var g=this.getRowOperToolbar(h);if(g){g.setVisible(true)}},hideRowOperToolbar:function(h){var g=this.getRowOperToolbar(h);if(g){g.setVisible(false)}},dataPagerChanged:function(g,h){if(h){h.removeEventListener("pageRetrieve",this.reactPagerRetrieve,this);h.removeEventListener("dataFetched",this.reactPagerFetched,this);h.removeEventListener("dataError",this.reactPagerError,this)}if(g){g.addEventListener("pageRetrieve",this.reactPagerRetrieve,this);g.addEventListener("dataFetched",this.reactPagerFetched,this);g.addEventListener("dataError",this.reactPagerError,this);this.setData(g.getCurrPageData())}},reactPagerRetrieve:function(g){if(this.reportMessage){this._loadingDataMsg=this.reportMessage(Kekule.$L("WidgetTexts.MSG_RETRIEVING_DATA"),Kekule.Widget.MsgType.INFO)}},reactPagerFetched:function(g){this.setData(g.data);if(this._loadingDataMsg&&this.removeMessage){this.removeMessage(this._loadingDataMsg)}},reactPagerError:function(g){if(this._loadingDataMsg&&this.removeMessage){this.removeMessage(this._loadingDataMsg)}if(this.flashMessage){this.flashMessage(g.error.message||g.error,Kekule.Widget.MsgType.ERROR)}},reactOperEdit:function(g){return this.reactOperExecute(a.EDIT,g)},reactOperDelete:function(g){return this.reactOperExecute(a.DELETE,g)},reactOperInsert:function(g){return this.reactOperExecute(a.INSERT,g)},reactOperExecute:function(g,k){var j=k.target;var h=this.getParentRow(j.getElement());var i=this.getRowData(h);return this.doReactOperExecute(g,i,h,k)},doReactOperExecute:function(g,i,h,j){},react_click:function($super,j){$super(j);var h=j.getTarget();var g=this.getParentHeadCell(h);if(g){this._autoSortOnHeadCell(g)}else{if(this.getEnableActiveRow()){var i=this.getParentCell(h);if(i){this.setActiveCell(i)}}}},react_pointerover:function($super,i){$super(i);var g=i.getTarget();if(this.getEnableActiveRow()){var h=this.getParentCell(g);if(h){this.setHoverCell(h)}else{this.setHoverCell(null)}}},react_pointerleave:function($super,h){$super(h);var g=h.getTarget();if(this.getEnableActiveRow()){this.setHoverCell(null)}},_autoSortOnHeadCell:function(g){if(g&&this.getEnableHeadInteraction()){var i=g[this.COLDEF_FIELD];if(i&&!i.disableInteract){var h=i.name;if(i.sorting===1){h=this.PREFIX_SORT_DESC+h}this.setSortFields([h])}}},load:function(i,h,g,j){this.beginUpdate();try{this.setData(i);this.setColumns(h);this.setSortFields(g?Kekule.ArrayUtils.toArray(g):null);this.setSortFunc(j)}finally{this.endUpdate()}return this},reload:function(){this.recreateChildContent();return this}});Kekule.Widget.DataTable.OperColShowMode={NONE:"none",ACTIVE:"active",HOVER:"hover",ALL:"all"};Kekule.Widget.DataTable.Components={EDIT:"edit",DELETE:"delete",INSERT:"insert"};var a=Kekule.Widget.DataTable.Components;Kekule.Widget.PageNavigator=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.PageNavigator",initProperties:function(){this.defineProp("components",{dataType:DataType.ARRAY});this.defineProp("firstIndex",{dataType:DataType.INT});this.defineProp("lastIndex",{dataType:DataType.INT});this.defineProp("currIndex",{dataType:DataType.INT});this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(h){var g=this.getDataPager();if(g!==h){this.setPropStoreFieldValue("dataPager",h);this.dataPagerChanged(h,g)}}})},initPropValues:function($super){$super();this.setShowText(true);this.setShowGlyph(true);this.setFirstIndex(1);this.reactFirstBind=this.reactFirst.bind(this);this.reactLastBind=this.reactLast.bind(this);this.reactPrevBind=this.reactPrev.bind(this);this.reactNextBind=this.reactNext.bind(this);this.reactPageInputChangeBind=this.reactPageInputChange.bind(this)},doObjectChange:function($super,g){$super(g);if(Kekule.ArrayUtils.intersect(g,["firstIndex","lastIndex","currIndex"]).length){this.updateChildComponent()}if(g.indexOf("currIndex")>=0){this.invokeEvent("pageChange",{currIndex:this.getCurrIndex()})}},doGetWidgetClassName:function($super){return $super()+" "+b.PAGENAVIGATOR},doCreateSubElements:function(h,g){return this.recreateChildContent(h,g)},getDefaultComponents:function(){return[f.FIRST,f.PREV,f.PAGESELECTOR,f.NEXT,f.LAST]},recreateChildContent:function(){var n=this.getComponents()||this.getDefaultComponents();var j=[];for(var k=0,g=n.length;k<g;++k){var h=n[k];if(DataType.isObjectValue(h)){j.push(h)}else{var m=this.getDefaultComponentDefinitionHash(h);if(m){j.push(m)}}}this.setChildDefs(j);this.updateChildComponent()},getDefaultComponentDefinitionHash:function(h){var g;if(h===f.FIRST){g={widget:"Kekule.Widget.Button",htmlClass:b.PAGENAVIGATOR_FIRST,text:Kekule.$L("WidgetTexts.CAPTION_FIRST_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_FIRST_PAGE"),"#execute":this.reactFirstBind}}else{if(h===f.LAST){g={widget:"Kekule.Widget.Button",htmlClass:b.PAGENAVIGATOR_LAST,text:Kekule.$L("WidgetTexts.CAPTION_LAST_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_LAST_PAGE"),"#execute":this.reactLastBind}}else{if(h===f.PREV){g={widget:"Kekule.Widget.Button",htmlClass:b.PAGENAVIGATOR_PREV,text:Kekule.$L("WidgetTexts.CAPTION_PREV_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_PREV_PAGE"),"#execute":this.reactPrevBind}}else{if(h===f.NEXT){g={widget:"Kekule.Widget.Button",htmlClass:b.PAGENAVIGATOR_NEXT,text:Kekule.$L("WidgetTexts.CAPTION_NEXT_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_NEXT_PAGE"),"#execute":this.reactNextBind}}else{if(h===f.PAGEINPUT){g={widget:"Kekule.Widget.TextBox",htmlClass:[b.PAGENAVIGATOR_PAGEINPUT,b.PAGENAVIGATOR_PAGEINDEXER],hint:Kekule.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}}else{if(h===f.PAGESELECTOR){g={widget:"Kekule.Widget.SelectBox",htmlClass:[b.PAGENAVIGATOR_PAGESELECTOR,b.PAGENAVIGATOR_PAGEINDEXER],hint:Kekule.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}}else{g=null}}}}}}if(g){g.internalName=h}return g},getComponent:function(g){return this.getChildWidgetByInternalName(g)},setChildComponentEnabled:function(i,h){var g=this.getComponent(i);if(g){g.setEnabled(h)}},updateChildComponent:function(){var h=this.getFirstIndex()||0;var n=this.getLastIndex()||0;var g=this.getCurrIndex()||0;var j=g<=h;var l=g>=n;this.setChildComponentEnabled(f.FIRST,!j);this.setChildComponentEnabled(f.PREV,!j);this.setChildComponentEnabled(f.NEXT,!l);this.setChildComponentEnabled(f.LAST,!l);this.setChildComponentEnabled(f.PAGEINPUT,n>h);this.setChildComponentEnabled(f.PAGESELECTOR,n>h);var m=this.getComponent(f.PAGEINPUT);if(m){m.setValue(g)}var p=this.getComponent(f.PAGESELECTOR);if(p){var o=[];for(var k=h;k<=n;++k){o.push({value:k})}p.setItems(o);p.setValue(g)}},dataPagerChanged:function(g,h){if(h){h.removeEventListener("dataFetched",this.reactPagerFetched,this);g.removeEventListener("pageCountChange",this.reactPagerPageCountChange,this)}if(g){g.addEventListener("dataFetched",this.reactPagerFetched,this);g.addEventListener("pageCountChange",this.reactPagerPageCountChange,this);this.updatePageDetails(g);this.setCurrIndex(g.getCurrPageIndex()+this.getFirstIndex())}},reactPagerFetched:function(g){this.setCurrIndex(g.pageIndex+this.getFirstIndex())},reactPagerPageCountChange:function(g){this.updatePageDetails(this.getDataPager())},updatePageDetails:function(h){var g=this.getFirstIndex();this.setLastIndex(h.getPageCount()+g-1)},requestChangeCurrIndex:function(h){var g=this.getDataPager();if(g){g.switchToPage(h-this.getFirstIndex())}else{this.setCurrIndex(h)}},reactFirst:function(g){this.requestChangeCurrIndex(this.getFirstIndex()||0)},reactLast:function(g){this.requestChangeCurrIndex(this.getLastIndex()||0)},reactPrev:function(h){var g=this.getFirstIndex()||0;var i=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.max(i-1,g))},reactNext:function(g){var i=this.getLastIndex()||0;var h=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.min(h+1,i))},reactPageInputChange:function(i){var h=i.target.getValue();if(typeof(h)==="string"){h=parseInt(h)}var g=this.getFirstIndex()||0;var j=this.getLastIndex()||0;if(h>=g&&h<=j){this.requestChangeCurrIndex(h)}else{Kekule.error(Kekule.$L("ErrorMsg.PAGE_INDEX_OUTOF_RANGE"))}}});Kekule.Widget.PageNavigator.Components={FIRST:"first",LAST:"last",PREV:"prev",NEXT:"next",PAGEINPUT:"pageInput",PAGESELECTOR:"pageSelector"};var f=Kekule.Widget.PageNavigator.Components})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{SYSMSGGROUP:"K-SysMsgGroup"});Kekule.Widget.SysMsgGroup=Class.create(Kekule.Widget.MsgGroup,{CLASS_NAME:"Kekule.Widget.SysMsgGroup",initialize:function($super,c){$super(c)},initPropValues:function($super){$super();this.setMaxMsgCount(6)},doGetWidgetClassName:function($super){return $super()+" "+a.SYSMSGGROUP}});Kekule.Widget.ExceptionHandler=Class.create(Kekule.ExceptionHandler,{CLASS_NAME:"Kekule.Widget.ExceptionHandler",initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:false,getter:function(){return this.getPropStoreFieldValue("document")||document}});this.defineProp("sysMsgGroup",{dataType:"Kekule.Widget.SysMsgGroup",serializable:false,setter:null,getter:function(){var c=this.getPropStoreFieldValue("sysMsgGroup");if(!c){c=new Kekule.Widget.SysMsgGroup(this.getDocument());c.appendToElem(this.getDocument().body);this.setPropStoreFieldValue("sysMsgGroup",c)}return c}})},throwException:function($super,h,f){var g=Kekule.ExceptionLevel;var d=Kekule.Widget.MsgType;if(!f){f=g.ERROR}var i;if(typeof(h)==="string"){i=h}else{i=h.message}if(i){var c=(f===g.ERROR)||!f?d.ERROR:(f===g.WARNING)?d.WARNING:(f===g.NOTE)?d.INFO:d.NORMAL;this.getSysMsgGroup().addMessage(i,c)}return $super(h,f)}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.ExceptionHandler);Kekule.X.domReady(function(){Kekule.exceptionHandler=Kekule.Widget.ExceptionHandler.getInstance()})})();(function(){var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OPER_HISTORY_TREE_VIEW:"K-OperHistory-TreeView"});Kekule.Widget.OperHistoryTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.Widget.OperHistoryTreeView",initialize:function($super,b,c){$super(b);this.setPropStoreFieldValue("objMap",new Kekule.MapEx(true));this.setEnableLiveUpdate(true);this.setEnableMultiSelected(true);this.setOperHistory(c)},initProperties:function(){this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,setter:function(c){var b=this.getPropStoreFieldValue("operHistory");this.setPropStoreFieldValue("operHistory",c);this.operHistoryChanged(c,b)}});this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL});this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:false})},doGetWidgetClassName:function($super){return $super()+" "+a.OPER_HISTORY_TREE_VIEW},operHistoryChanged:function(c,b){this.clearChildItems();this.getObjMap().clear();if(b){this._uninstallRootEventHandler(b)}if(c){this._fillTree(c);this._installRootEventHandler(c)}},_installRootEventHandler:function(b){b.addEventListener("operChange",this.reactOperChange,this)},_uninstallRootEventHandler:function(b){b.removeEventListener("operChange",this.reactOperChange,this)},reactOperChange:function(c){if(this.getEnableLiveUpdate()){var b=c.target;this._fillTree(c.target)}},_fillTree:function(c){if(c){this.clearChildItems();this._updateTreeItem(this.appendChildItem(),c);var d=c.getCurrOperation();var b=d?this.getObjMap().get(d):null;this.select(b)}},_getOperChildCount:function(b){if(b instanceof Kekule.OperationHistory){return b.getOperationCount()}else{if(b instanceof Kekule.MacroOperation){return b.getChildCount()}else{return 0}}},_getChildOperAt:function(c,b){if(c instanceof Kekule.OperationHistory){return c.getOperationAt(b)}else{if(c instanceof Kekule.MacroOperation){return c.getChildAt(b)}else{return null}}},_updateTreeItem:function(h,d){var k=this._getOperDisplayTitle(d);var f={text:k,obj:d};this.setItemData(h,f);this.getObjMap().set(d,h);var b=this.getChildItemCount(h);var e=this._getOperChildCount(d);for(var g=0;g<e;++g){var c=this._getChildOperAt(d,g);var j;if(g<b){j=this.getChildItemAt(h,g)}else{j=this.appendChildItem(h)}this._updateTreeItem(j,c)}if(b>e){for(var g=b-1;g>=e;--g){this.removeChildItemAt(h,g)}}},_getOperDisplayTitle:function(d){var b=d.getClassName();var c=d.getTarget?d.getTarget():null;if(c&&c.getId){b+="(target: "+c.getId()+")"}return b}})})();Kekule.ChemWidget={};Kekule.ChemWidget.AbstractWidget=Kekule.Widget.BaseWidget;Kekule.ChemWidget.ComponentWidgetNames={menu:"menu",newDoc:"newDoc",clearObjs:"clearObjs",loadFile:"loadFile",loadData:"loadData",saveData:"saveData",zoomIn:"zoomIn",zoomOut:"zoomOut",resetZoom:"resetZoom",rotateRight:"rotateRight",rotateLeft:"rotateLeft",rotateX:"rotateX",rotateY:"rotateY",rotateZ:"rotateZ",reset:"reset",molDisplayType:"molDisplayType",molDisplayTypeCondensed:"molDisplayTypeCondensed",molDisplayTypeSkeletal:"molDisplayTypeSkeletal",molDisplayTypeWire:"molDisplayTypeWire",molDisplayTypeSticks:"molDisplayTypeSticks",molDisplayTypeBallStick:"molDisplayTypeBallStick",molDisplayTypeSpaceFill:"molDisplayTypeSpaceFill",molHideHydrogens:"molHideHydrogens",openEditor:"openEditor",config:"config",objInspector:"objInspector",undo:"undo",redo:"redo",copy:"copy",cut:"cut",paste:"paste",cloneSelection:"cloneSelection",toggleSelect:"toggleSelect",dragScroll:"dragScroll",erase:"erase",manipulate:"manipulate",trackInput:"trackInput",molBond:"bond",molAtom:"atom",molFormula:"formula",molAtomAndFormula:"atomAndFormula",molCharge:"charge",textBlock:"textBlock",imageBlock:"imageBlock",molRing:"ring",glyph:"glyph",textImage:"textImage",fontName:"fontName",fontSize:"fontSize",color:"color",textDirection:"textDirection",textAlign:"textAlign"};Kekule.ChemWidget.HtmlClassNames={PREFIX:"K-Chem-",INNER_TOOLBAR:"K-Chem-InnerToolbar"};(function(){var d=Class.PropertyScope;var b=Kekule.ChemWidget;var a=Kekule.Widget.HtmlClassNames;var c=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DIALOG_LOADDATA:"K-Chem-Dialog-LoadData",DIALOG_LOADDATA_FORMATBOX:"K-Chem-Dialog-LoadData-FormatBox",DIALOG_LOADDATA_SRCEDITOR:"K-Chem-Dialog-LoadData-SrcEditor",DIALOG_LOADDATA_BTN_LOADFROMFILE:"K-Chem-Dialog-LoadData-Btn-LoadFromFile"});Kekule.ChemWidget.LoadDataDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.ChemWidget.LoadDataDialog",initialize:function($super,e,f,g){this._openFileAction=new Kekule.ActionLoadFileData();this._openFileAction.update();this._openFileAction.addEventListener("load",this.reactFileLoad,this);this._sBtnLoadFromFile=Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_FROM_FILE");this._formatItems=null;$super(e,f||Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG"),g||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);if(this.setResizable){this.setResizable(true)}},finalize:function($super){this._openFileAction.finalize();$super()},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,setter:null});this.defineProp("allowedFormatIds",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("allowedFormatIds",e);this.updateFormatItems()}})},initPropValues:function($super){$super();this.setAutoAdjustSizeOnPopup(true)},doGetWidgetClassName:function($super){return $super()+" "+c.DIALOG_LOADDATA},doCreateClientContents:function($super,i){$super();var h=this.getDocument();var f=h.createElement("div");f.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_FORMAT");i.appendChild(f);f=h.createElement("div");i.appendChild(f);var e=new Kekule.Widget.SelectBox(this);e.addClassName(c.DIALOG_LOADDATA_FORMATBOX);e.appendToElem(f);this._formatSelector=e;this.updateFormatItems();var f=h.createElement("div");f.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_SRC");i.appendChild(f);f=h.createElement("div");i.appendChild(f);var g=new Kekule.Widget.TextEditor(this);g.setWrap("off");g.setToolbarPos(Kekule.Widget.Position.BOTTOM);g.addClassName(c.DIALOG_LOADDATA_SRCEDITOR);g.appendToElem(f);this._dataEditor=g},getFormatSelectorItems:function(e){var s=[];var p=this.getAllowedFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds();for(var n=0,g=p.length;n<g;++n){var f=Kekule.IO.DataFormatsManager.getFormatInfo(p[n]);if(f){var o=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(f.fileExts));for(var m=0,h=o.length;m<h;++m){o[m]="*."+o[m]}var r=o.join(", ");var q=f.title;if(r){q+=" ("+r+")"}s.push({value:f.mimeType,text:q,title:f.mimeType,data:f})}}s.sort(function(j,i){return(j.text<i.text)?-1:(j.text>i.text)?1:0});return s},getFileFilters:function(j){var e=[];for(var h=0,f=j.length;h<f;++h){var m=j[h];var k=m.data;var n=m.text||m.title||m.value;var g=Kekule.ArrayUtils.toArray(k.fileExts);e.push({title:n,filter:"."+g.join(",.")})}e.push(Kekule.NativeServices.FILTER_ALL_SUPPORT);e.push(Kekule.NativeServices.FILTER_ANY);return e},updateFormatItems:function(){this._formatItems=this.getFormatSelectorItems();this._formatSelector.setItems(this._formatItems);var e=this.getFileFilters(this._formatItems);this._openFileAction.setFilters(e)},doSetButtons:function($super,g){var f=g||[];if(f.indexOf(this._sBtnLoadFromFile)<0){f.unshift(this._sBtnLoadFromFile)}$super(f);var e=this.getDialogButton(this._sBtnLoadFromFile);e.setAction(this._openFileAction);e.linkStyleResource(Kekule.Widget.StyleResourceNames.BUTTON_LOAD_FILE);e.addClassName(c.DIALOG_LOADDATA_BTN_LOADFROMFILE);e.setEnabled(this._openFileAction.getEnabled())},reactFileLoad:function(i){var h=i.data;var k=i.fileName;var j;try{if(i.success&&h&&k){j=Kekule.IO.loadTypedData(h,null,k);this.setPropStoreFieldValue("chemObj",j);var f=Kekule.Widget.DialogButtons.OK;this.close(f)}else{j=null}}catch(g){Kekule.error(g)}},open:function($super,g,e,f){this.setPropStoreFieldValue("chemObj",null);return $super(g,e,f)},close:function($super,f){if(!this.getChemObj()){if(this.isPositiveResult(f)){var g=this._dataEditor.getValue();var i=this._formatSelector.getValue();try{var j=Kekule.IO.loadTypedData(g,i);if(j){this.setPropStoreFieldValue("chemObj",j)}else{Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}}catch(h){Kekule.raise(h,Kekule.ExceptionLevel.ERROR)}}}return $super(f)}})})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;var d=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{PERIODIC_TABLE:"K-Chem-Periodic-Table",PERIODIC_TABLE_MINI:"K-Chem-Periodic-Table-Mini",PERIODIC_TABLE_LEGEND:"K-Chem-Periodic-Table-Legend",PERIODIC_TABLE_LEGEND_CONTENT:"K-Chem-Periodic-Table-Legend-Content",PERIODIC_TABLE_LEGEND_COLORS:"K-Chem-Periodic-Table-Legend-Colors",PERIODIC_TABLE_LEGEND_COLOR:"K-Chem-Periodic-Table-Legend-Color",PERIODIC_TABLE_MAINTABLE:"K-Chem-Periodic-Table-MainTable",PERIODIC_TABLE_EXTRATABLE:"K-Chem-Periodic-Table-ExtraTable",PERIODIC_TABLE_ELEM_CELL:"K-Chem-Periodic-Table-Elem-Cell",PERIODIC_TABLE_ELEM_STUBSCELL:"K-Chem-Periodic-Table-Elem-StubsCell",PERIODIC_TABLE_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_HEAD_CELL:"K-Chem-Periodic-Table-Head-Cell",PERIODIC_TABLE_HEAD_CELL_CONTENT:"K-Chem-Periodic-Table-Head-Cell-Content",PERIODIC_TABLE_HEAD_CELL_GROUP:"K-Chem-Periodic-Table-Head-Cell-Group",PERIODIC_TABLE_HEAD_CELL_PERIOD:"K-Chem-Periodic-Table-Head-Cell-Period",ELEM_SYMBOL:"K-Chem-Elem-Symbol",ELEM_SYMBOL_STUBS:"K-Chem-Elem-Symbol-Stubs",ELEM_NAME:"K-Chem-Elem-Name",ATOMIC_NUM:"K-Chem-Atomic-Num",ATOMIC_WEIGHT:"K-Chem-Atomic-Weight"});Kekule.globalOptions.add("chemWidget.periodicTable",{displayedComponents:["symbol","name","atomicNumber","groupHead","legend"]});Kekule.ChemWidget.PeriodicTable=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.PeriodicTable",BINDABLE_TAG_NAMES:["span","div"],ELEM_DATA_FIELD:"__$elemData__",MAX_GROUP:18,MAX_PERIOD:7,LA_SERIES:["La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu"],AC_SERIES:["Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr"],initialize:function($super,e,f){this.setPropStoreFieldValue("displayedComponents",f||this.getDefaultDisplayedComponents());this._elemCells=[];this._selectedElemCells=[];$super(e);this.setEnableSelect(true);this.setEnableMultiSelect(true)},initProperties:function(){this.defineProp("displayedComponents",{dataType:DataType.ARRAY,getter:function(){return this.getPropStoreFieldValue("displayedComponents")||this.getDefaultDisplayedComponents()}});this.defineProp("startingAtomNum",{dataType:DataType.INT});this.defineProp("endingAtomNum",{dataType:DataType.INT});this.defineProp("useMiniMode",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useMiniMode",e);if(e){this.addClassName(d.PERIODIC_TABLE_MINI)}else{this.removeClassName(d.PERIODIC_TABLE_MINI)}}});this.defineProp("enableSelect",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableSelect")||this.getEnableMultiSelect()}});this.defineProp("enableMultiSelect",{dataType:DataType.BOOL});this.defineProp("selected",{dataType:DataType.HASH,serializable:false,setter:null,getter:function(){return this.getSelection()?this.getSelection()[0]:null}});this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,setter:null,getter:function(){var e=[];var g=this._selectedElemCells||[];for(var h=0,f=g.length;h<f;++h){var j=g[h][this.ELEM_DATA_FIELD];if(j){e.push(j)}}return e}});this.defineProp("selectedSymbol",{dataType:DataType.STRING,getter:function(){return this.getSelectedSymbols()[0]},setter:function(e){this.setSelectedSymbols([e])}});this.defineProp("selectedSymbols",{dataType:DataType.ARRAY,getter:function(){var h=this.getSelection();if(h){var e=[];for(var g=0,f=h.length;g<f;++g){e.push(h[g].symbol)}return e}return[]},setter:function(e){this.selectSymbols(e)}})},doGetWidgetClassName:function($super){return $super()+" "+d.PERIODIC_TABLE},doCreateRootElement:function(f){var e=f.createElement("div");return e},doCreateSubElements:function($super,g,e){$super(g,e);var f=this.createMainTable(g,e);return[f]},doObjectChange:function(e){var f=["displayedComponents","startingAtomNum","endingAtomNum"];if(Kekule.ArrayUtils.intersect(e,f).length){this.recreateMainTable()}},getDefaultDisplayedComponents:function(){return Kekule.globalOptions.chemWidget.periodicTable.displayedComponents},getShowElemSymbol:function(){var e=this.getDisplayedComponents();return e.indexOf("symbol")>=0},getShowElemName:function(){var e=this.getDisplayedComponents();return e.indexOf("name")>=0},getShowAtomicNum:function(){var e=this.getDisplayedComponents();return e.indexOf("atomicNumber")>=0},getShowAtomicWeight:function(){var e=this.getDisplayedComponents();return e.indexOf("atomicWeight")>=0},getShowGroupHead:function(){var e=this.getDisplayedComponents();return e.indexOf("groupHead")>=0},getShowPeriodHead:function(){var e=this.getDisplayedComponents();return e.indexOf("periodHead")>=0},getShowLegend:function(){var e=this.getDisplayedComponents();return e.indexOf("legend")>=0},recreateMainTable:function(){this.deselectAll();var e=this.getElement();b.clearChildContent(e);this.createMainTable(e.ownerDocument,e)},createMainTable:function(M,y){var F=Kekule.chemicalElementsData;var g=[];this._elemCells=[];var r=[];var u=[];var w=M.createElement("table");for(var n=0;n<=this.MAX_PERIOD;++n){var j=M.createElement("tr");var o=[];for(var h=0;h<=this.MAX_GROUP;++h){var s=M.createElement("td");j.appendChild(s);o.push(s)}w.appendChild(j);g.push(o)}var e=M.createElement("table");for(var n=0;n<2;++n){var j=M.createElement("tr");var o=[];for(var h=0;h<this.LA_SERIES.length;++h){var s=M.createElement("td");j.appendChild(s);o.push(s)}e.appendChild(j);r.push(o)}var K=this.getStartingAtomNum()||0;var f=this.getEndingAtomNum()||300000;for(var D=0,A=F.length;D<A;++D){var H=F[D];var q=H.atomicNumber;if(q<K||q>f){continue}var B=H.symbol;var E=H.period;var p=H.group;var k=H.chemicalSerie.replace(/\s/g,"");Kekule.ArrayUtils.pushUnique(u,H.chemicalSerie);var s;var v=this.LA_SERIES.indexOf(B);var t=this.AC_SERIES.indexOf(B);if(v>=0){s=r[0][v]}else{if(t>=0){s=r[1][t]}else{if(E&&p){s=g[E][p]}}}if(s){s.className=d.PERIODIC_TABLE_ELEM_CELL;s.appendChild(this.createElemCellContent(M,H,k.upperFirst()));s[this.ELEM_DATA_FIELD]=H;this._elemCells.push(s)}if((v===0)||(t===0)){s=g[E][p];s.className=d.PERIODIC_TABLE_ELEM_STUBSCELL;s.appendChild(this.createElemCellStubsContent(M,H,k.upperFirst()))}}if(this.getShowGroupHead()){var m=["IA","IIA","IIIB","IVB","VB","VIB","VIIB","","VIII","","IB","IIB","IIIA","IVA","VA","VIA","VIIA","VIIIA"];for(var h=1;h<=this.MAX_GROUP;++h){var n=(h===1)||(h===18)?0:(h===2)||(h>=13)?1:3;var s=g[n][h];s.className=d.PERIODIC_TABLE_HEAD_CELL+" "+d.PERIODIC_TABLE_HEAD_CELL_GROUP;s.appendChild(this.createHeadContent(M,m[h-1]))}}if(this.getShowPeriodHead()){for(var n=1;n<=this.MAX_PERIOD;++n){var s=g[n][0];s.className=d.PERIODIC_TABLE_HEAD_CELL+" "+d.PERIODIC_TABLE_HEAD_CELL_PERIOD;s.appendChild(this.createHeadContent(M,n))}}y.appendChild(w);if(this.getShowLegend()){var L=M.createElement("a");L.href="javascript:void(0)";L.className=d.PERIODIC_TABLE_LEGEND+" "+a.CORNER_ALL;b.setElementText(L,Kekule.$L("ChemWidgetTexts.LEGEND_CAPTION"));var x=M.createElement("div");x.className=d.PERIODIC_TABLE_LEGEND_CONTENT+" "+a.CORNER_ALL;var z={symbol:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_SYMBOL"),atomicNumber:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_NUM"),naturalMass:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_WEIGHT"),name:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_NAME")};var I=this.createElemCellContent(M,z,d.PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT);x.appendChild(I);var J=M.createElement("div");J.className=d.PERIODIC_TABLE_LEGEND_COLORS;for(var D=0,A=u.length;D<A;++D){var G=M.createElement("div");G.className=d.PERIODIC_TABLE_LEGEND_COLOR+" "+u[D].replace(/\s/g,"");b.setElementText(G,u[D]);J.appendChild(G)}x.appendChild(J);L.appendChild(x);y.appendChild(L)}y.appendChild(e);return w},createElemCellContent:function(j,g,k){var e=j.createElement("div");var i=d.PERIODIC_TABLE_ELEM_CELL_CONTENT;if(k){i+=" "+k}e.className=i;if(this.getShowAtomicNum()){e.appendChild(this.createElemContentComponent(j,g.atomicNumber,d.ATOMIC_NUM))}if(this.getShowAtomicWeight()){var h=g.naturalMass;if(h){var f=(typeof(h)==="number")?h.toFixed(3):h;e.appendChild(this.createElemContentComponent(j,f,d.ATOMIC_WEIGHT))}else{e.appendChild(this.createElemContentComponent(j,"\u00a0",d.ATOMIC_WEIGHT))}}if(this.getShowElemSymbol()){e.appendChild(this.createElemContentComponent(j,g.symbol,d.ELEM_SYMBOL))}if(this.getShowElemName()){e.appendChild(this.createElemContentComponent(j,g.name,d.ELEM_NAME))}return e},createElemCellStubsContent:function(i,f,k){var e=i.createElement("div");e.className=d.PERIODIC_TABLE_ELEM_CELL_CONTENT+" "+(k||"");var j,h,g;g=f.chemicalSerie;if(f.symbol==="La"){j="57-71";h="La-Lu"}else{j="89-103";h="Ac-Lr"}if(this.getShowAtomicNum()){e.appendChild(this.createElemContentComponent(i,j,d.ATOMIC_NUM))}if(this.getShowElemSymbol()){e.appendChild(this.createElemContentComponent(i,h,d.ELEM_SYMBOL_STUBS,true))}if(this.getShowElemName()){e.appendChild(this.createElemContentComponent(i,g,d.ELEM_NAME))}return e},createElemContentComponent:function(h,g,e,j){var f=h.createElement("span");f.className=e;if(j){var i=h.createElement("span");f.appendChild(i)}b.setElementText(i||f,g);return f},createHeadContent:function(f,g,h){var e=f.createElement("div");e.className=d.PERIODIC_TABLE_HEAD_CELL_CONTENT+" "+(h||"");b.setElementText(e,g);return e},_getAtomCellElem:function(f){var e=b.getNearestAncestorByTagName(f,"td",true);if(e&&(this._elemCells.indexOf(e)>=0)){return e}else{return null}},_getCellElemOfSymbol:function(k){var g=this._elemCells;for(var h=0,f=g.length;h<f;++h){var e=g[h];var j=e[this.ELEM_DATA_FIELD];if(j.symbol===k){return e}}return null},isCellSelected:function(e){return this._selectedElemCells.indexOf(e)>=0},selectCell:function(e){if(e){c.addClass(e,a.STATE_SELECTED);Kekule.ArrayUtils.pushUnique(this._selectedElemCells,e);this.invokeEvent("select",{elemData:e[this.ELEM_DATA_FIELD]})}},deselectCell:function(e){if(e){c.removeClass(e,a.STATE_SELECTED);Kekule.ArrayUtils.remove(this._selectedElemCells,e);this.invokeEvent("deselect",{elemData:e[this.ELEM_DATA_FIELD]})}},toggleCell:function(e){if(this.isCellSelected(e)){this.deselectCell(e)}else{this.selectCell(e)}},deselectAll:function(){var e=this._selectedElemCells;for(var f=e.length-1;f>=0;--f){this.deselectCell(e[f])}return this},selectSymbols:function(g){this.deselectAll();var j=Kekule.ArrayUtils.toArray(g);for(var h=0,f=j.length;h<f;++h){var e=this._getCellElemOfSymbol(j[h]);if(e){this.selectCell(e)}}return this},react_click:function($super,h){if(this.getEnableSelect()){var g=h.getTarget();var f=this._getAtomCellElem(g);if(f){if(!this.getEnableMultiSelect()){this.deselectAll();this.selectCell(f)}else{this.toggleCell(f)}return true}}$super(h)}})})();(function(){var f=Class.PropertyScope;var d=Kekule.DomUtils;var c=Kekule.ZoomUtils;var b=Kekule.ChemWidget;var a=Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DISPLAYER_DRAWCONTEXT_PARENT:"K-Chem-Displayer-DrawContext-Parent",ACTION_MOL_DISPLAY_TYPE:"K-Chem-MolDisplayType",ACTION_MOL_DISPLAY_SKELETAL:"K-Chem-MolDisplaySkeletal",ACTION_MOL_DISPLAY_CONDENSED:"K-Chem-MolDisplayCondensed",ACTION_MOL_DISPLAY_WIRE:"K-Chem-MolDisplayWire",ACTION_MOL_DISPLAY_BALLSTICK:"K-Chem-MolDisplayBallStick",ACTION_MOL_DISPLAY_STICKS:"K-Chem-MolDisplaySticks",ACTION_MOL_DISPLAY_SPACEFILL:"K-Chem-MolDisplaySpaceFill",ACTION_MOL_HIDE_HYDROGENS:"K-Chem-MolHideHydrogens",ACTION_ZOOMIN:"K-Chem-ZoomIn",ACTION_ZOOMOUT:"K-Chem-ZoomOut",ACTION_RESET:"K-Chem-Reset",ACTION_RESET_ZOOM:"K-Chem-ResetZoom",ACTION_LOADFILE:"K-Chem-LoadFile",ACTION_LOADDATA:"K-Chem-LoadData",ACTION_SAVEFILE:"K-Chem-SaveFile",ACTION_CLEAROBJS:"K-Chem-ClearObjs",ACTION_CONFIG:"K-Chem-Config",DIALOG_CHOOSE_FILE_FORAMT:"K-Chem-Dialog-Choose-File-Format",DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX:"K-Chem-Dialog-Choose-File-Format-FormatBox",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER:"K-Chem-Dialog-Choose-File-Format-Previewer"});Kekule.ChemWidget.ChemObjDisplayerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerConfigs",initProperties:function(){this.addConfigProp("ioConfigs","Kekule.ChemWidget.ChemObjDisplayerIOConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("ioConfigs",new Kekule.ChemWidget.ChemObjDisplayerIOConfigs())}});Kekule.ChemWidget.ChemObjDisplayerIOConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerIOConfigs",initProperties:function(){this.addBoolConfigProp("canonicalizeBeforeSave",true)}});Kekule.ChemWidget.ChemObjDisplayer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer",initialize:function($super,g,j,h,i){this._paintFlag=0;this._bgColorMap={};this._contextTransformOpsMap=new Kekule.MapEx();this.setPropStoreFieldValue("resetAfterLoad",true);this.setPropStoreFieldValue("renderType",h||Kekule.Render.RendererType.R2D);$super(g);if(j){this.setChemObj(j)}this.setEnableLoadNewFile(true);this.setPropStoreFieldValue("displayerConfigs",i||this.createDefaultConfigs())},doFinalize:function($super){this.setChemObj(null);this.getPainter().finalize();var g=this.getPropStoreFieldValue("drawBridge");var h=this.getPropStoreFieldValue("drawContext");if(h&&g){g.releaseContext(h)}if(g.finalize){g.finalize()}this.setPropStoreFieldValue("drawBridge",null);this.setPropStoreFieldValue("drawContext",null);if(this._contextTransformOpsMap){this._contextTransformOpsMap.finalize()}$super()},initProperties:function(){this.defineProp("displayerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:false,scope:f.PUBLIC});this.defineProp("enableLoadNewFile",{dataType:DataType.BOOL});this.defineProp("allowedInputFormatIds",{dataType:DataType.ARRAY});this.defineProp("allowedOutputFormatIds",{dataType:DataType.ARRAY});this.defineProp("standardizationOptions",{dataType:DataType.HASH});this.defineProp("resetAfterLoad",{dataType:DataType.BOOL});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,scope:f.PUBLIC,setter:function(h){var g=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",h);this.chemObjChanged(h,g)}});this.defineProp("chemObjLoaded",{dataType:DataType.BOOL,serializable:false,scope:f.PUBLIC,setter:null,getter:function(){return this.getChemObj()&&this.getPropStoreFieldValue("chemObjLoaded")}});this.defineProp("renderType",{dataType:DataType.INT,serializable:false,scope:f.PUBLISHED,setter:function(h){if(!this.getAllowRenderTypeChange()){Kekule.error(Kekule.$L("ErrorMsg.RENDER_TYPE_CHANGE_NOT_ALLOWED"));return}var g=this.getRenderType();if(h!==g){this.setPropStoreFieldValue("renderType",h);this.resetRenderType(g,h)}}});this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:false,scope:f.PUBLIC,getter:function(){var g=this.getPropStoreFieldValue("renderConfigs");if(!g){g=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()}return g}});this.defineProp("backgroundColor",{dataType:DataType.STRING,scope:f.PUBLISHED,setter:function(g){this.setPropStoreFieldValue("backgroundColor",g);this._bgColorMap[this.getRenderType().toString()]=g;this.backgroundColorChanged()}});this.defineProp("transformParams",{dataType:DataType.HASH,serializable:false,scope:f.PUBLIC,getter:function(){var g=Object.extend({},this.getDrawOptions());g.screenCoordOffset=this.getBaseCoordOffset();return g},setter:function(g){var h=g||{};this.setDrawOptions(h);this.setBaseCoordOffset(h.baseCoordOffset);this.drawOptionChanged()}});this.defineProp("drawOptions",{dataType:DataType.HASH,serializable:false,scope:f.PUBLIC,getter:function(){var g=this.getPropStoreFieldValue("drawOptions");if(!g){g={};this.setPropStoreFieldValue("drawOptions",g)}return g},setter:function(g){this.setPropStoreFieldValue("drawOptions",g);this.drawOptionChanged()}});this.defineProp("zoom",{dataType:DataType.FLOAT,serializable:false,getter:function(){var g=this.getDrawOptions()||{};return g.zoom},setter:function(g){this.zoomTo(g);return this}});this.defineProp("initialZoom",{dataType:DataType.FLOAT});this.defineProp("autofit",{dataType:DataType.BOOL,serializable:false,getter:function(){var g=this.getDrawOptions()||{};return g.autofit},setter:function(g){var h=this.getDrawOptions()||{};h.autofit=g;return this.setDrawOptions(h)}});this.defineProp("moleculeDisplayType",{dataType:DataType.INT,serializable:false,getter:function(){var g=this.getDrawOptions()||{};return g.moleculeDisplayType},setter:function(g){this.getDrawOptions().moleculeDisplayType=g;this.drawOptionChanged();return this}});this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL,serializable:false,scope:f.PUBLIC,getter:function(){return Kekule.oneOf(this.getDrawOptions().allowCoordBorrow,this.getRenderConfigs().getGeneralConfigs().getAllowCoordBorrow())}});this.defineProp("autoSize",{dataType:DataType.BOOL,serializable:false,setter:function(g){if(g!=this.getAutoSize()){this.setPropStoreFieldValue("autoSize",g);if(g&&this.allowAutoSize()){this.drawOptionChanged()}}}});this.defineProp("padding",{dataType:DataType.INT,serializable:false,setter:function(g){if(g!=this.getPadding()){this.setPropStoreFieldValue("padding",g);this.getDrawOptions().autofitContextPadding=g;this.drawOptionChanged()}}});this.defineProp("baseCoordOffset",{dataType:DataType.Hash,serializable:false,setter:function(g){this.setPropStoreFieldValue("baseCoordOffset",g);if(this.getChemObjLoaded()){this.repaint()}}});this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:false,scope:f.PRIVATE,setter:null,getter:function(h){var g=this.getPropStoreFieldValue("drawBridge");if(!g){g=this.createDrawBridge(h);this.setPropStoreFieldValue("drawBridge",g)}return g}});this.defineProp("drawContext",{dataType:DataType.OBJECT,serializable:false,scope:f.PRIVATE,setter:null,getter:function(){var g=this.getPropStoreFieldValue("drawContext");if(!g){var j=this.getDrawBridge();if(j){var h=this.getDrawContextParentElem();if(!h){return null}else{var i=Kekule.HtmlElementUtils.getElemOffsetDimension(h);g=j.createContext(h,i.width,i.height);this.setPropStoreFieldValue("drawContext",g)}}}return g}});this.defineProp("painter",{dataType:"Kekule.Render.ChemObjPainter",serializable:false,scope:f.PRIVATE,setter:null,getter:function(){var g=this.getPropStoreFieldValue("painter");if(!g){g=this.createNewPainter()}return g}});this.defineProp("rootRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:false,scope:f.PRIVATE,setter:null,getter:function(){var g=this.getPainter();return g?g.getRenderer():null}})},initPropValues:function($super){$super();this.setStandardizationOptions({unmarshalSubFragments:false})},doWidgetShowStateChanged:function($super,g){$super(g);if(g){this.setChemObj(this.getChemObj())}},getAllowRenderTypeChange:function(){return false},resetRenderType:function(j,g){var l=this.getChemObj();var k=this.getPropStoreFieldValue("drawBridge");var i=this.getPropStoreFieldValue("drawContext");if(k){if(i){k.releaseContext(i)}}this.setPropStoreFieldValue("drawContext",null);this.setPropStoreFieldValue("drawBridge",null);var h=this.getBackgroundColorOfType(g);this.getDrawOptions().moleculeDisplayType=this.getDefaultMoleculeDisplayType(g);this.setPropStoreFieldValue("backgroundColor",h);this.backgroundColorChanged(true);this.setChemObj(l||null)},createDefaultConfigs:function(){return new Kekule.ChemWidget.ChemObjDisplayerConfigs()},getCoordMode:function(){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D},setCoordMode:function(h){var g=(h===Kekule.CoordMode.COORD3D)?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(g)},loadPredefinedResDataToProp:function(h,g,j){if(h==="chemObj"){if(j){try{var k=Kekule.IO.loadTypedData(g.data,g.resType,g.resUri);this.setChemObj(k)}catch(i){this.reportException(i)}}else{this.reportException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+g.resUri||"")}}},reportException:function(h,g){Kekule.raise(h,g||Kekule.ExceptionLevel.ERROR)},createDrawBridge:function(h){var i=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.DrawBridge3DMananger:Kekule.Render.DrawBridge2DMananger;var g=i.getPreferredBridgeInstance();if(!g){if(!h){Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"))}}return g},getDrawContextParentElem:function(j){var g=this._drawContextParentElem;if(!g&&!j){g=this.getDocument().createElement("div");this._drawContextParentElem=g;Kekule.HtmlElementUtils.addClass(g,a.DYN_CREATED);Kekule.HtmlElementUtils.addClass(g,e.DISPLAYER_DRAWCONTEXT_PARENT);g.style.width="100%";g.style.height="100%";var h=this.getElement();var i=Kekule.DomUtils.getFirstChildElem(h);if(i){h.insertBefore(g,i)}else{h.appendChild(g)}}return g},allowAutoSize:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D},canModifyPartialGraphic:function(h){var g=this.getDrawBridge();return g.canModifyGraphic?g.canModifyGraphic(h||this.getDrawContext()):false},doInsertedToDom:function(){this.doResize()},doResize:function(){this.refitDrawContext(this.isPainting())},refitDrawContext:function(h){if(this.getDrawBridge(true)&&this.getDrawContext()){var g=Kekule.HtmlElementUtils.getElemClientDimension(this.getDrawContextParentElem());var i=this.changeContextDimension(g);if(!h&&i){this.repaint()}}},getContextDimension:function(){if(this.getDrawBridge()&&this.getDrawContext()){return this.getDrawBridge().getContextDimension(this.getDrawContext())}else{return null}},changeContextDimension:function(g){if(this.getDrawBridge()&&this.getDrawContext()){this.getDrawBridge().setContextDimension(this.getDrawContext(),g.width,g.height);return true}else{return false}},clearContext:function(){var h=this.getPropStoreFieldValue("drawContext");if(h){var g=this.getPropStoreFieldValue("painter");if(g){g.clear(h)}this.getDrawBridge().clearContext(h)}},createNewPainter:function(i){var h=this.getPropStoreFieldValue("painter");if(h){h.finalize()}var g=new Kekule.Render.ChemObjPainter(this.getRenderType(),i,this.getDrawBridge());this.setPropStoreFieldValue("painter",g);return g},chemObjChanged:function(h,g){this.doLoad(h);if(this.getResetAfterLoad()&&g){this.resetDisplay()}},load:function(g){this.setChemObj(g)},doLoad:function(i){this.refitDrawContext(true);this.setPropStoreFieldValue("chemObjLoaded",false);try{if(i){var g=this.createNewPainter(i);g.setRenderConfigs(this.getRenderConfigs());this.repaint();this.setPropStoreFieldValue("chemObjLoaded",true)}else{this.clearContext()}this.invokeEvent("load",{obj:i})}catch(h){this.clearContext();this.reportException(h)}finally{this.doLoadEnd(this.getChemObj())}},doLoadEnd:function(g){},loadFromData:function(g,j,i){try{if(!g){this.setChemObj(null);return null}else{var k=Kekule.IO.loadTypedData(g,j,i);if(k){this.setChemObj(k)}else{Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}return k}}catch(h){this.reportException(h)}},loadFromFile:function(h){if(!h){this.setChemObj(null)}else{var g=this;try{Kekule.IO.loadFileData(h,function(k,j){if(j){g.setChemObj(k)}})}catch(i){this.reportException(i)}}},getSavingTargetObj:function(){return this.getChemObj()},saveData:function(l,g,j){var j=j||this.getSavingTargetObj();this.prepareSaveData(j);var i=Kekule.IO.ChemDataWriterManager.getWriterByFormat(l,null,j);if(i){var k=this._needToCanonicalizeBeforeSaving()&&this.getDisplayerConfigs().getIoConfigs().getCanonicalizeBeforeSave();if(k&&j.standardize){var j=j.clone?j.clone(true):j;j.standardize(this.getStandardizationOptions())}if(!g){var m=Kekule.IO.DataFormatsManager.getFormatInfo(l);g=m.dataType}var h=i.writeData(j,g,l);return h}else{Kekule.error(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT"));return null}},_needToCanonicalizeBeforeSaving:function(){return false},prepareSaveData:function(g){},getDrawClientDimension:function(){var g=Kekule.HtmlElementUtils.getElemClientDimension(this.getCoreElement());return g},setDrawDimension:function(h,g){this.setDimension(h,g)},calcDrawBaseCoord:function(q){var n;var h=this.getDrawContext();var o=this.getPainter();var i;if((!this._isContinuousRepainting)&&this.getAutoSize()&&this.allowAutoSize()){var m=this.getPadding()||0;var k=o.estimateScreenBox(h,n,q,this.getAllowCoordBorrow());if(k){var g=k.x2-k.x1+m*2;var p=k.y2-k.y1+m*2;this.changeContextDimension({width:g,height:p});this.setDrawDimension(g,p);i={width:g,height:p};n={x:g/2,y:p/2}}}else{n=q?q.baseCoord:null;if(!n){var l=this.getDrawClientDimension();n={x:l.width/2,y:l.height/2};var j=this.getBaseCoordOffset();if(j){n=Kekule.CoordUtils.add(n,j)}}}n=this.getDrawBridge().transformScreenCoordToContext(h,n);return{baseCoord:n,baseCoordPos:Kekule.Render.CoordPos.CENTER,newWidgetDimension:i}},getActualDrawOptions:function(){return this.getDrawOptions()},calcDrawParams:function(i){var h=this.getActualDrawOptions();if(i){h=Object.extend(h,i)}var g=this.calcDrawBaseCoord(h);return{drawOptions:h,baseCoord:g.baseCoord,baseCoordPos:g.baseCoordPos,newWidgetDimension:g.newWidgetDimension}},_savePainterInitialRenderTransformOptions:function(i,h){var g=h.getActualInitialRenderTransformOptions(i);this._contextTransformOpsMap.set(i,g)},repaint:function(l){this.beginPaint();try{if(!l||!l.doNotClear){this.clearContext()}if(!this.getChemObj()){return}var g=this.getPainter();var k=this.getDrawContext();var h;var i;var j=true;if(l&&l.preserveTransformOptions){i=this._contextTransformOpsMap.get(k)||null;j=false;h=this.calcDrawParams(i)}else{h=this.calcDrawParams(l)}this._lastBaseCoord=h.baseCoord;g.draw(k,h.baseCoord,h.drawOptions);if(j){this._savePainterInitialRenderTransformOptions(k,g)}}finally{this.endPaint()}},beginPaint:function(){if(!this._paintFlag){this._paintFlag=0}++this._paintFlag},endPaint:function(){if(this._paintFlag>0){--this._paintFlag}if(this._paintFlag<0){this._paintFlag=0}},isPainting:function(){return this._paintFlag>0},getBackgroundColorOfType:function(g){return this._bgColorMap[g.toString()]},setBackgroundColorOfType:function(g,h){this._bgColorMap[h.toString()]=g;if(h===this.getRenderType()){this.setBackgroundColor(g)}},backgroundColorChanged:function(i){var g=this.getBackgroundColor();if(g==="transparent"){g=null}var h=this.getDrawBridge(true);if(h&&h.setClearColor){h.setClearColor(this.getDrawContext(),g);if(!i){this.repaint()}}},drawOptionChanged:function(){this.repaint()},geometryOptionChanged:function(){var g=this.getPainter();var i=this.getDrawOptions();if(g.supportGeometryOptionChange()){var h=this.getDrawContext();g.changeGeometryOptions(h,i.baseCoord||this._lastBaseCoord,i);this._savePainterInitialRenderTransformOptions(h,g)}else{this.drawOptionChanged()}},beginContinuousRepainting:function(){this._isContinuousRepainting=true},endContinuousRepainting:function(){if(this._isContinuousRepainting){this._isContinuousRepainting=false;this.repaint()}},resetDisplay:function(){var g=this.getDrawOptions();g.zoom=this.getInitialZoom()||1;g.rotateX=0;g.rotateY=0;g.rotateZ=0;g.rotateAngle=0;g.rotateAxisVector=null;g.rotateMatrix=null;this.setBaseCoordOffset(null);this.geometryOptionChanged();return this},getCurrZoom:function(){return this.getDrawOptions().zoom||1},zoomTo:function(h,g){this.getDrawOptions().zoom=h;if(!g){this.geometryOptionChanged()}return this},zoomIn:function(h){var i=this.getCurrZoom();var g=c.getNextZoomInRatio(i,h||1);return this.zoomTo(g)},zoomOut:function(h){var i=this.getCurrZoom();var g=c.getNextZoomOutRatio(i,h||1);return this.zoomTo(g)},resetZoom:function(){return this.zoomTo(this.getInitialZoom()||1)},getDefaultMoleculeDisplayType:function(g){return(g===Kekule.Render.RendererType.R3D)?Kekule.Render.Molecule3DDisplayType.DEFAULT:Kekule.Render.Molecule2DDisplayType.DEFAULT},getCurrMoleculeDisplayType:function(){var g=this.getDrawOptions().moleculeDisplayType;if(!g){g=this.getDefaultMoleculeDisplayType(this.getRenderType())}return g},setHideHydrogens:function(g){this.getDrawOptions().hideHydrogens=g;this.drawOptionChanged();return this},exportToDataUri:function(g,h){return this.getDrawBridge().exportToDataUri(this.getDrawContext(),g,h)},createConfigurator:function($super){var g=$super();g.addEventListener("configChange",function(h){this.repaint()},this);return g}});Kekule.ChemWidget.ChemObjDisplayer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Settings",initialize:function($super,g){$super(g)},initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile"])},getDisplayer:function(){return this.getWidget()}});Kekule.ChemWidget.ChemObjDisplayer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function($super,g){$super(g)},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function($super){var u=$super();var t=this.getDisplayer();var n=[t.getDisplayerConfigs(),t.getRenderConfigs()];for(var o=0,m=n.length;o<m;++o){var g=n[o];var s=g.getPropListOfScopes([Class.PropertyScope.PUBLISHED]);for(var q=0,h=s.getLength();q<h;++q){var r=s.getPropInfoAt(q);var p=g.getPropValue(r.name);if(p){u.push({obj:p,name:r.name,title:r.title,description:r.description})}}}return u},getDisplayer:function(){return this.getWidget()}});Kekule.ChemWidget.ActionDisplayerLoadFile=Class.create(Kekule.ActionLoadFileData,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadFile",HTML_CLASSNAME:e.ACTION_LOADFILE,initialize:function($super,g){$super();this.setDisplayer(g);this.setText(Kekule.$L("ChemWidgetTexts.CAPTION_LOADFILE"));this.setHint(Kekule.$L("ChemWidgetTexts.HINT_LOADFILE"))},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:false})},doUpdate:function($super){$super();var g=this.getDisplayer();this.setEnabled(this.getEnabled()&&g&&g.getEnabled()&&g.getEnableLoadNewFile())},doDataLoaded:function(h,i,g){if(g){this.getDisplayer().loadFromData(h,null,i)}}});Kekule.ChemWidget.ActionOnDisplayer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnDisplayer",initialize:function($super,h,g,i){$super();this.setDisplayer(h);this.setText(g);this.setHint(i)},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:false})},doUpdate:function(){var g=this.getDisplayer();this.setEnabled(g&&g.getChemObj()&&g.getChemObjLoaded()&&g.getEnabled())}});Kekule.ChemWidget.ActionDisplayerClear=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerClear",HTML_CLASSNAME:e.ACTION_CLEAROBJS,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_CLEAROBJS"),Kekule.$L("ChemWidgetTexts.HINT_CLEAROBJS"))},doUpdate:function($super){$super();var g=this.getDisplayer();this.setEnabled(g&&g.getEnabled()&&g.getChemObj())},doExecute:function(h){var g=this.getDisplayer();g.setChemObj(null)}});Kekule.ChemWidget.ActionDisplayerLoadData=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadData",HTML_CLASSNAME:e.ACTION_LOADDATA,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA"),Kekule.$L("ChemWidgetTexts.HINT_LOADDATA"))},finalize:function($super){$super()},initPropValues:function($super){$super();this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("dataDialog",{dataType:"Kekule.ChemWidget.LoadDataDialog",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("dataDialog");if(!g){g=this.createDataDialog();this.setPropStoreFieldValue("dataDialog",g)}return g}});this.defineProp("dialogShowType",{dataType:DataType.INT})},createDataDialog:function(){var h=this.getDisplayer().getDocument();var g=new Kekule.ChemWidget.LoadDataDialog(h);return g},doUpdate:function($super){$super();var g=this.getDisplayer();this.setEnabled(g&&g.getEnabled()&&g.getEnableLoadNewFile())},doExecute:function(j){var g=this;var i=this.getDataDialog();i.setAllowedFormatIds(this.getDisplayer().getAllowedInputFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds());var h=i._formatSelector;var l=this.getDialogShowType();var k=(l===Kekule.Widget.ShowHideType.DIALOG)?i.openModal:i.open;k.apply(i,[function(m){if(i.isPositiveResult(m)){var n=g.getDisplayer();n.load(i.getChemObj())}},j,l])}});Kekule.ChemWidget.ActionDisplayerSaveFile=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerSaveFile",HTML_CLASSNAME:e.ACTION_SAVEFILE,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEFILE"),Kekule.$L("ChemWidgetTexts.HINT_SAVEFILE"));this._saveAction=new Kekule.ActionFileSave()},finalize:function($super){this._saveAction.finalize();$super()},initPropValues:function($super){$super();this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("formatDialog",{dataType:"Kekule.Widget.Dialog",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("formatDialog");if(!g){g=this.createFormatDialog();this.setPropStoreFieldValue("formatDialog",g)}return g}});this.defineProp("lastFormat",{dataType:DataType.STRING,serializable:false});this.defineProp("currSaveData",{dataType:DataType.VARIANT,serializable:false});this.defineProp("dialogShowType",{dataType:DataType.INT})},getChemObjSrcInfo:function(h){var g=this.getDisplayer();return g.getChemObjSrcInfo?g.getChemObjSrcInfo(h):h.getSrcInfo?h.getSrcInfo():null},getChemObjSrcFormat:function(h){var g=this.getChemObjSrcInfo(h);return g?g.format:null},createFormatDialog:function(){var k=this.getDisplayer().getDocument();var g=new Kekule.Widget.Dialog(k,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEDATA_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);g.addClassName(e.DIALOG_CHOOSE_FILE_FORAMT);g.setAutoAdjustSizeOnPopup(true);var j=k.createElement("div");j.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_SELECT_FORMAT");g.getClientElem().appendChild(j);j=k.createElement("div");g.getClientElem().appendChild(j);var i=new Kekule.Widget.SelectBox(g);i.addClassName(e.DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX);i.appendToElem(j);i.addEventListener("valueChange",this.reactFormatSelectorChange,this);g._formatSelector=i;var j=k.createElement("div");j.innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_PREVIEW_FILE_CONTENT");g.getClientElem().appendChild(j);j=k.createElement("div");g.getClientElem().appendChild(j);var h=new Kekule.Widget.TextEditor(g);h.setReadOnly(true);h.setWrap("off");h.setToolbarPos(Kekule.Widget.Position.BOTTOM);h.addClassName(e.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER);h.appendToElem(j);g._previewTextArea=h;if(g.setResizable){g.setResizable(true)}return g},getAvailableWriterInfos:function(h){if(!h){return[]}else{var g=Kekule.IO.ChemDataWriterManager.getAvailableWriterInfos(null,h);return g}},getFormatSelectorItems:function(w,t){var z=[];var u=[];var q=this.getChemObjSrcInfo(w);var x=(q)?q.format:null;for(var r=0,m=t.length;r<m;++r){var h=t[r];Kekule.ArrayUtils.pushUnique(u,h.formatId)}u=Kekule.ArrayUtils.intersect(this.getAllowedFormatIds(),u);for(var r=0,m=u.length;r<m;++r){var g=Kekule.IO.DataFormatsManager.getFormatInfo(u[r]);if(g){var s=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(g.fileExts));for(var p=0,n=s.length;p<n;++p){s[p]="*."+s[p]}var y=s.join(", ");var v=g.title;if(y){v+=" ("+y+")"}var o=x?(u[r]===x):this.getLastFormat()?(this.getLastFormat()===u[r]):r===0;z.push({value:g.id,text:v,title:g.mimeType,data:g,selected:o})}}z.sort(function(j,i){return(j.text<i.text)?-1:(j.text>i.text)?1:0});return z},getAllowedFormatIds:function(){return this.getDisplayer().getAllowedOutputFormatIds()||Kekule.IO.ChemDataWriterManager.getAllWritableFormatIds()},getFileFilters:function(m){var g=[];for(var k=0,h=m.length;k<h;++k){var o=m[k];var n=o.data;var p=o.text||o.title||o.value;var j=Kekule.ArrayUtils.toArray(n.fileExts);g.push({title:p,filter:"."+j.join(",.")})}g.push(Kekule.NativeServices.FILTER_ALL_SUPPORT);g.push(Kekule.NativeServices.FILTER_ANY);return g},updateFormatItems:function(h){this._formatItems=this.getFormatSelectorItems(h,this.getAvailableWriterInfos());this._formatSelector.setItems(this._formatItems);var g=this.getFileFilters(this._formatItems);this._saveAction.setFilters(g)},reactFormatSelectorChange:function(){var g=this.getFormatDialog()._formatSelector.getValue();this.updatePreview(g,this.getFormatDialog())},updatePreview:function(j,m){var i=m._previewTextArea;i.setValue("");if(j){var l=Kekule.IO.DataFormatsManager.getFormatInfo(j);var h=this.getTargetObj();var k=this.getChemObjSrcInfo(h);if(k&&k.format===j&&k.data){i.setValue(k.data);this.setCurrSaveData(k.data)}else{var g=this.getDisplayer().saveData(j,l.dataType,h);i.setValue(g);this.setCurrSaveData(g)}}},getTargetObj:function(g){return this.getDisplayer().getSavingTargetObj()},doUpdate:function($super){$super();var g=this.getDisplayer();if(this._saveAction){this._saveAction.update()}this.setEnabled(g&&g.getEnabled()&&g.getChemObj())},doExecute:function(k){var q=this;var l=this.getFormatDialog();var p=this.getTargetObj();var h=l._formatSelector;var m=this.getAvailableWriterInfos(p);var i=this.getFormatSelectorItems(p,m);h.setItems(i);this.reactFormatSelectorChange();var n=false;if(this._saveAction){n=this._saveAction.getEnabled()}var g=l.getDialogButton(Kekule.Widget.DialogButtons.OK);if(g){g.setEnabled(n)}var j=this.getDialogShowType();var o=(j===Kekule.Widget.ShowHideType.DIALOG)?l.openModal:l.open;o.apply(l,[function(s){if(s===Kekule.Widget.DialogButtons.OK){var v=q.getCurrSaveData();q._saveAction.setData(v);var w=l._formatSelector.getValue();q.setLastFormat(w);var y=Kekule.IO.DataFormatsManager.getFormatInfo(w);var r=y.fileExts;var t=Kekule.ArrayUtils.toArray(r[0]||r);var u=[{title:y.title||y.mimeType,filter:"."+t.join(",.")},Kekule.NativeServices.FILTER_ANY];var x=Kekule.$L("ChemWidgetTexts.S_DEF_SAVE_FILENAME")+"."+t;q._saveAction.setFileName(x);q._saveAction.setFilters(u);q._saveAction.execute(k)}},k,j])}});Kekule.ChemWidget.ActionDisplayerReset=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerReset",HTML_CLASSNAME:e.ACTION_RESET,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_RESETVIEW"),Kekule.$L("ChemWidgetTexts.HINT_RESETVIEW"))},doExecute:function(){this.getDisplayer().resetDisplay()}});Kekule.ChemWidget.ActionDisplayerZoomIn=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomIn",HTML_CLASSNAME:e.ACTION_ZOOMIN,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMIN"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMIN"))},doExecute:function(){this.getDisplayer().zoomIn()}});Kekule.ChemWidget.ActionDisplayerZoomOut=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomOut",HTML_CLASSNAME:e.ACTION_ZOOMOUT,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMOUT"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMOUT"))},doExecute:function(){this.getDisplayer().zoomOut()}});Kekule.ChemWidget.ActionDisplayerResetZoom=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerResetZoom",HTML_CLASSNAME:e.ACTION_RESET_ZOOM,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_RESETZOOM"),Kekule.$L("ChemWidgetTexts.HINT_RESETZOOM"))},doExecute:function(){this.getDisplayer().resetZoom()}});Kekule.ChemWidget.ActionDisplayerHideHydrogens=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerHideHydrogens",HTML_CLASSNAME:e.ACTION_MOL_HIDE_HYDROGENS,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_HIDEHYDROGENS"),Kekule.$L("ChemWidgetTexts.HINT_HIDEHYDROGENS"))},doUpdate:function($super){$super();var h=this.getDisplayer();var g=h&&(h.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(g).setEnabled(this.getEnabled()&&g)},doExecute:function(){var g=!this.getChecked();this.setChecked(g);this.getDisplayer().setHideHydrogens(g)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase",initialize:function($super,h,g,j,i){$super(h,g,j);this._displayType=i;this.setCheckGroup("__molDisplayType__")},doUpdate:function($super){$super();var g=this.getDisplayer();this.setChecked(g&&g.getCurrMoleculeDisplayType()===this.getMolDisplayType())},doExecute:function(){this.getDisplayer().setMoleculeDisplayType(this._displayType);this.setChecked(true)},getMolDisplayType:function(){return this._displayType}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D",doUpdate:function($super){$super();var h=this.getDisplayer();var g=h&&(h.getRenderType()===Kekule.Render.RendererType.R2D);this.setDisplayed(g).setEnabled(this.getEnabled()&&g)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D",doUpdate:function($super){$super();var h=this.getDisplayer();var g=h&&(h.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(g).setEnabled(this.getEnabled()&&g)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_SKELETAL,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_SKELETAL"),Kekule.$L("ChemWidgetTexts.HINT_SKELETAL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE=Kekule.Render.Molecule2DDisplayType.SKELETAL;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_CONDENSED,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_CONDENSED"),Kekule.$L("ChemWidgetTexts.HINT_CONDENSED"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE=Kekule.Render.Molecule2DDisplayType.CONDENSED;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_WIRE,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_WIRE"),Kekule.$L("ChemWidgetTexts.HINT_WIRE"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE=Kekule.Render.Molecule3DDisplayType.WIRE;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_STICKS,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_STICKS"),Kekule.$L("ChemWidgetTexts.HINT_STICKS"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE=Kekule.Render.Molecule3DDisplayType.STICKS;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_BALLSTICK,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_BALLSTICK"),Kekule.$L("ChemWidgetTexts.HINT_BALLSTICK"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE=Kekule.Render.Molecule3DDisplayType.BALL_STICK;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill",HTML_CLASSNAME:e.ACTION_MOL_DISPLAY_SPACEFILL,initialize:function($super,g){$super(g,Kekule.$L("ChemWidgetTexts.CAPTION_SPACEFILL"),Kekule.$L("ChemWidgetTexts.HINT_SPACEFILL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE=Kekule.Render.Molecule3DDisplayType.SPACE_FILL})();(function(){var a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEM_STRUCT_TREE_VIEW:"K-Chem-Struct-TreeView",CHEM_STRUCT_TREE_VIEW_ITEM_TITLE:"K-Chem-Struct-TreeView-ItemTitle",CHEM_STRUCT_TREE_VIEW_ITEM_TYPE:"K-Chem-Struct-TreeView-ItemType"});Kekule.ChemWidget.StructureTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.ChemWidget.StructureTreeView",initialize:function($super,b,c){$super(b);this.setPropStoreFieldValue("objMap",new Kekule.MapEx(true));this.setEnableLiveUpdate(true);this.setEnableMultiSelected(true);this.setRootObj(c);this._pauseLiveUpdateFlag=0;this._changedObjects=[]},initProperties:function(){this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:false,setter:function(c){var b=this.getPropStoreFieldValue("rootObj");this.setPropStoreFieldValue("rootObj",c);this.rootObjChanged(c,b)}});this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL});this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:false})},doGetWidgetClassName:function($super){return $super()+" "+a.CHEM_STRUCT_TREE_VIEW},rootObjChanged:function(c,b){this.clearChildItems();this.getObjMap().clear();if(b){this._uninstallRootEventHandler(b)}if(c){this._fillTree(c);this._installRootEventHandler(c)}},pauseLiveUpdate:function(){if(this._pauseLiveUpdateFlag>=0){this._pauseLiveUpdateFlag=0;this._changedObjects=[]}--this._pauseLiveUpdateFlag;return this},resumeLiveUpdate:function(){++this._pauseLiveUpdateFlag;if(this._pauseLiveUpdateFlag>=0){this._pauseLiveUpdateFlag=0;for(var c=0,b=this._changedObjects.length;c<b;++c){this.refreshObject(this._changedObjects[c])}}},isLiveUpdatePaused:function(){return(this._pauseLiveUpdateFlag<0)},_installRootEventHandler:function(b){b.addEventListener("change",this.reactChemObjChange,this)},_uninstallRootEventHandler:function(b){b.removeEventListener("change",this.reactChemObjChange,this)},reactChemObjChange:function(b){if(this.getEnableLiveUpdate()){if(this.isLiveUpdatePaused()){if(this.getObjMap().get(b.target)){Kekule.ArrayUtils.pushUnique(this._changedObjects,b.target)}}else{this.refreshObject(b.target)}}},refreshObject:function(c){var b=this.getObjMap().get(c);if(b){this._updateTreeItem(b,c)}return this},_fillTree:function(b){if(b){this.clearChildItems();this._updateTreeItem(this.appendChildItem(),b)}},_updateTreeItem:function(g,k){var j=this._getChemObjDisplayTitle(k);var e={text:j,obj:k};this.setItemData(g,e);this.getObjMap().set(k,g);var b=this.getChildItemCount(g);var d=k.getChildCount();for(var f=0;f<d;++f){var c=k.getChildAt(f);if(!c.isSelectable()){continue}var h;if(f<b){h=this.getChildItemAt(g,f)}else{h=this.appendChildItem(g)}this._updateTreeItem(h,c)}if(b>d){for(var f=b-1;f>=d;--f){this.removeChildItemAt(g,f)}}},_getChemObjDisplayTitle:function(h){var b="";var g=h.getId();if(g){b+='<span class="'+a.CHEM_STRUCT_TREE_VIEW_ITEM_TITLE+'">'+g+"</span>"}var f=h.getClassName();var e=f.split(".");var d=e.length?e[e.length-1]:f;var c='<span class="'+a.CHEM_STRUCT_TREE_VIEW_ITEM_TYPE+'">('+d+")</span>";return b+c},selectChemObjs:function(d){var c=[];for(var e=0,b=d.length;e<b;++e){var g=d[e];var f=this.getObjMap().get(g);if(f){c.push(f)}}this.select(c);return this},getSelectedChemObjs:function(){var b=[];var d=this.getSelection();if(d&&d.length){for(var e=0,c=d.length;e<c;++e){var f=this.getItemData(d[e]);if(f&&f.obj){b.push(f.obj)}}}return b}})})();(function(){var a=Kekule.oneOf;Kekule.ChemWidget.AbstractUIMarker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.AbstractUIMarker",initialize:function($super){$super();this.setVisible(true)},initProperties:function(){this.defineProp("drawStyles",{dataType:DataType.OBJECT});this.defineProp("visible",{dataType:DataType.BOOL})}});Kekule.ChemWidget.MetaShapeUiMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker",initialize:function($super,b){$super();if(b){this.setShapeInfo(b)}},initProperties:function(){this.defineProp("shapeInfo",{dataType:DataType.OBJECT});this.defineProp("shapeType",{dataType:DataType.INT,serializable:false,setter:null,getter:function(){var b=this.getShapeInfo();return b?b.shapeType:null}})}});Kekule.ChemWidget.MetaShapeUIMarker=Kekule.ChemWidget.MetaShapeUiMarker;Kekule.ChemWidget.TextUiMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker",initialize:function($super,b,c){$super();if(b){this.setText(b)}if(c){this.setCoord(c)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING});this.defineProp("coord",{dataType:DataType.HASH})}});Kekule.ChemWidget.UiMarkerCollection=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection",initProperties:function(){this.defineProp("markers",{dataType:DataType.ARRAY,getter:function(){var b=this.getPropStoreFieldValue("markers");if(!b){b=[];this.setPropStoreFieldValue("markers",b)}return b},setter:null})},getMarkerCount:function(){return this.getMarkers().length},getMarkerAt:function(b){return this.getMarkers()[b]},addMarker:function(b){return this.getMarkers().push(b)},indexOfMarker:function(b){return this.getMarkers().indexOf(b)},removeMarker:function(b){var d=this.getMarkers();var c=d.indexOf(b);if(c>=0){d.splice(c,1)}},clearMarkers:function(){this.setPropStoreFieldValue("markers",[])}});Kekule.ChemWidget.UiMarker2DRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerRenderer"});Kekule.ChemWidget.MetaShapeUiMarker2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker2DRenderer",doDrawSelf:function($super,b,h,k){var f=this.getChemObj();var j=f.getShapeInfo();if(!j){return null}var c=Object.create(k);c=Object.extend(c,f.getDrawStyles()||{});if(c.color){if(!c.strokeColor){c.strokeColor=c.color}if(!c.fillColor){c.fillColor=c.color}}var m;if(Kekule.Render.MetaShapeUtils.isCompositeShape(j)){if(j.length>1){m=this.createDrawGroup(b);for(var e=0,d=j.length;e<d;++e){var g=j[e];this.doDrawShape(b,m,g,c)}}else{if(j.length===1){m=this.doDrawShape(b,null,j[0],c)}else{return null}}}else{m=this.doDrawShape(b,null,j,c)}return m},doDrawShape:function(b,o,j,q){var f=Kekule.Render.MetaShapeType;var r;if(Kekule.Render.MetaShapeUtils.isCompositeShape(j)){r=this.createDrawGroup(b);for(var g=0,e=j.length;g<e;++g){var d=this.doDrawShape(b,r,j[g],q)}}else{var n=j.coords;switch(j.shapeType){case f.POINT:r=this.drawCircle(b,n[0],1,q);break;case f.CIRCLE:r=this.drawCircle(b,n[0],j.radius,q);break;case f.LINE:var c=q;if(j.width){c=Object.create(q);c.strokeWidth=j.width}r=this.drawLine(b,n[0],n[1],c);break;case f.RECT:r=this.drawRect(b,n[0],n[1],q);break;case f.POLYGON:case f.POLYLINE:var k=[];for(var g=0,e=n.length;g<e;++g){var h=(g===0)?"M":"L";k.push(h);var m=[n[g].x,n[g].y];k.push(m)}if(j.shapeType===f.POLYGON){k.push("L");m=[n[0].x,n[0].y];k.push(m)}var p=Kekule.Render.DrawPathUtils.makePath.apply(this,k);r=this.drawPath(b,p,q);break}}if(o){this.addToDrawGroup(r,o)}return r}});Kekule.ChemWidget.TextUiMarker2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker2DRenderer",doDrawSelf:function($super,d,f,c){var b=this.getChemObj();var e={textBoxXAlignment:Kekule.Render.BoxXAlignment.CENTER,textBoxYAlignment:Kekule.Render.BoxYAlignment.CENTER};e=Object.extend(e,c);e=Object.extend(e,b.getDrawStyles()||{});var h=b.getCoord();var g=b.getText();if(g&&h){return this.drawText(d,h,b.getText(),e)}else{return null}}});Kekule.ChemWidget.UiMarkerCollection2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection2DRenderer",getChildObjs:function($super){var f=this.getChemObj();var e=f.getMarkers();var b=[];for(var d=0,c=e.length;d<c;++d){if(e[d].getVisible()){b.push(e[d])}}return b}});Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.MetaShapeUiMarker,Kekule.ChemWidget.MetaShapeUiMarker2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.TextUiMarker,Kekule.ChemWidget.TextUiMarker2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.UiMarkerCollection,Kekule.ChemWidget.UiMarkerCollection2DRenderer);Kekule.ChemWidget.UiMarkersRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkersRenderer",DRAW_ELEM_FIELD:"__$drawElem__",initialize:function($super,b,c){$super(b,c);this._drawGroup=null},initProperties:function(){},getObjDrawElem:function(b,c){return this.getExtraProp2(b,c,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(b,d,c){this.setExtraProp2(b,d,this.DRAW_ELEM_FIELD,c)},doEstimateRenderBox:function(d,e,c,b){return null},doDraw:function($super,c,d,b){$super(c,d,b);var f=this.getChemObj();var e=this.createDrawGroup(c);this.setObjDrawElem(c,f,e);if(f.getMarkerCount()>0){this.doDrawMarkers(c,e,f.getMarkers(),b)}return e},doUpdate1:function($super,d,g,b){if(this.canModifyGraphic(d)){var e=false;var c=Kekule.Render.ObjectUpdateType;switch(b){case c.ADD:e=this.doAddNew(d,g);break;case c.MODIFY:e=this.doModify(d,g);break;case c.REMOVE:var f=this._extractObjsOfUpdateObjDetails(g);e=this.doRemove(d,f);break;default:return $super(d,g,b)}return e}else{return $super(d,updatedObjs,b)}},doAddNew:function(b,c){if(this.canRemoveElem()){return this.doModify(b,c)}else{return false}},doModify:function(b,g){if(this.canRemoveElem()){var e=this._extractObjsOfUpdateObjDetails(g);this.remove(b,e);var f=this.getChemObj();var c=this.getObjDrawElem(f);var d=this.getDrawParams();if(e.indexOf(f)>=0){this.draw(b,d.baseCoord,d.options)}else{this.doDrawMarkers(b,c,e,d.options)}}else{return false}},doRemove:function(b,d){if(this.canRemoveElem()){var c=this.getObjDrawElem(d);if(c){var e=this.getObjDrawElem(this.getChemObj());this.doRemoveFromGroup(c,e);this.doRemoveElem(b,c);this.setObjDrawElem(d,null)}}else{return false}},doDrawMarkers:function(f,g,h,d){for(var e=0,c=h.length;e<c;++e){var b=h[e];if(b.getVisible()){this.doDrawMarker(f,g,b,d)}}},doDrawMarker:function(b,h,f,k){var j=f.getShapeInfo();if(!j){return null}var c=Object.create(k);c=Object.extend(f.getDrawStyles()||{});if(c.color){if(!c.strokeColor){c.strokeColor=c.color}if(!c.fillColor){c.fillColor=c.color}}var m;if(Kekule.ArrayUtils.isArray(j)){if(j.length>1){m=this.createDrawGroup(b);for(var e=0,d=j.length;e<d;++e){var g=j[e];this.doDrawShape(b,m,g,c)}}else{if(j.length===1){m=this.doDrawShape(b,null,j[0],c)}else{return null}}}else{m=this.doDrawShape(b,null,j,c)}if(m){this.setObjDrawElem(b,f,m);if(h){this.addToDrawGroup(m,h)}}return m},doDrawShape:function(b,o,j,q){var f=Kekule.Render.MetaShapeType;var r;if(Kekule.Render.MetaShapeUtils.isCompositeShape(j)){r=this.createDrawGroup(b);for(var g=0,e=j.length;g<e;++g){var d=this.doDrawShape(b,r,j[g],q)}}else{var n=j.coords;switch(j.shapeType){case f.POINT:r=this.drawCircle(b,n[0],1,q);break;case f.CIRCLE:r=this.drawCircle(b,n[0],j.radius,q);break;case f.LINE:var c=q;if(j.width){c=Object.create(q);c.strokeWidth=j.width}r=this.drawLine(b,n[0],n[1],c);break;case f.RECT:r=this.drawRect(b,n[0],n[1],q);break;case f.POLYGON:case f.POLYLINE:var k=[];for(var g=0,e=n.length;g<e;++g){var h=(g===0)?"M":"L";k.push(h);var m=[n[g].x,n[g].y];k.push(m)}if(j.shapeType===f.POLYGON){k.push("L");m=[n[0].x,n[0].y];k.push(m)}var p=Kekule.Render.DrawPathUtils.makePath.apply(this,k);r=this.drawPath(b,p,q);break}}if(o){this.addToDrawGroup(r,o)}return r}});Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.ChemWidget.UiMarkersRenderer)})();(function(){var b=Class.PropertyScope;var e=Kekule.ArrayUtils;var j=Kekule.ZoomUtils;var c=Kekule.ChemWidget.ComponentWidgetNames;var i=Kekule.ChemWidget;var d=Kekule.Widget.EvokeMode;Kekule.globalOptions.add("chemWidget.viewer",{toolButtons:[c.loadData,c.saveData,c.molDisplayType,c.molHideHydrogens,c.zoomIn,c.zoomOut,c.rotateX,c.rotateY,c.rotateZ,c.rotateLeft,c.rotateRight,c.reset,c.openEditor],menuItems:[c.loadData,c.saveData,Kekule.Widget.MenuItem.SEPARATOR_TEXT,c.molDisplayType,c.molHideHydrogens,c.zoomIn,c.zoomOut,{text:Kekule.$L("ChemWidgetTexts.CAPTION_ROTATE"),hint:Kekule.$L("ChemWidgetTexts.HINT_ROTATE"),children:[c.rotateLeft,c.rotateRight,c.rotateX,c.rotateY,c.rotateZ]},c.reset,Kekule.Widget.MenuItem.SEPARATOR_TEXT,c.openEditor,c.config]});Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER:"K-Chem-Viewer",VIEWER2D:"K-Chem-Viewer2D",VIEWER3D:"K-Chem-Viewer3D",VIEWER_CAPTION:"K-Chem-Viewer-Caption",VIEWER_EMBEDDED_TOOLBAR:"K-Chem-Viewer-Embedded-Toolbar",VIEWER_MENU_BUTTON:"K-Chem-Viewer-Menu-Button",VIEWER_EDITOR_FULLCLIENT:"K-Chem-Viewer-Editor-FullClient",ACTION_ROTATE_LEFT:"K-Chem-RotateLeft",ACTION_ROTATE_RIGHT:"K-Chem-RotateRight",ACTION_ROTATE_X:"K-Chem-RotateX",ACTION_ROTATE_Y:"K-Chem-RotateY",ACTION_ROTATE_Z:"K-Chem-RotateZ",ACTION_VIEWER_EDIT:"K-Chem-Viewer-Edit"});var g=Kekule.Widget.HtmlClassNames;var a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.Viewer=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.ChemWidget.Viewer",BINDABLE_TAG_NAMES:["div","span","img"],DEF_BGCOLOR_2D:null,DEF_BGCOLOR_3D:"#000000",DEF_TOOLBAR_EVOKE_MODES:[d.EVOKEE_CLICK,d.EVOKEE_MOUSE_ENTER,d.EVOKEE_TOUCH],DEF_TOOLBAR_REVOKE_MODES:[d.EVOKEE_MOUSE_LEAVE,d.EVOKER_TIMEOUT],initialize:function($super,k,q,n,m){this.setPropStoreFieldValue("renderType",n||Kekule.Render.RendererType.R2D);this.setPropStoreFieldValue("enableToolbar",false);this.setPropStoreFieldValue("toolbarEvokeModes",this.DEF_TOOLBAR_EVOKE_MODES);this.setPropStoreFieldValue("toolbarRevokeModes",this.DEF_TOOLBAR_REVOKE_MODES);this.setPropStoreFieldValue("enableDirectInteraction",true);this.setPropStoreFieldValue("toolbarPos",Kekule.Widget.Position.AUTO);this.setPropStoreFieldValue("toolbarMarginHorizontal",10);this.setPropStoreFieldValue("toolbarMarginVertical",10);this.setPropStoreFieldValue("showCaption",false);this.setPropStoreFieldValue("useCornerDecoration",true);$super(k,q,n,m);this.setPadding(this.getRenderConfigs().getLengthConfigs().getActualLength("autofitContextPadding"));this._isContinuousRepainting=false;var l=Kekule.Render.RendererType;var o=(this.getRenderType()===l.R2D)?(this.getBackgroundColor()||this.DEF_BGCOLOR_2D):this.DEF_BGCOLOR_2D;var p=(this.getRenderType()===l.R3D)?(this.getBackgroundColor()||this.DEF_BGCOLOR_3D):this.DEF_BGCOLOR_3D;this.setBackgroundColorOfType(o,l.R2D);this.setBackgroundColorOfType(p,l.R3D);this.useCornerDecorationChanged();this.doResize();this.addIaController("default",new Kekule.ChemWidget.ViewerBasicInteractionController(this),true)},doFinalize:function($super){var k=this.getToolbar();if(k){k.finalize()}$super()},initProperties:function(){this.defineProp("viewerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:false,getter:function(){return this.getDisplayerConfigs()},setter:function(k){return this.setDisplayerConfigs(k)}});this.defineProp("allowedMolDisplayTypes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(k){this.setPropStoreFieldValue("allowedMolDisplayTypes",k);this.updateUiComps()}});this.defineProp("enableRestraintRotation3D",{dataType:DataType.BOOL});this.defineProp("restraintRotation3DEdgeRatio",{dataType:DataType.FLOAT});this.defineProp("enableEdit",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableEdit")&&(this.getCoordMode()!==Kekule.CoordMode.COORD3D)}});this.defineProp("shareEditorInstance",{dataType:DataType.BOOL});this.defineProp("enableEditFromVoid",{dataType:DataType.BOOL});this.defineProp("restrainEditorWithCurrObj",{dataType:DataType.BOOL});this.defineProp("modalEdit",{dataType:DataType.BOOL});this.defineProp("editorProperties",{dataType:DataType.HASH});this.defineProp("toolButtons",{dataType:DataType.ARRAY,scope:b.PUBLIC,getter:function(){var k=this.getPropStoreFieldValue("toolButtons");return k},setter:function(k){this.setPropStoreFieldValue("toolButtons",k);this.updateToolbar()}});this.defineProp("menuItems",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(k){this.setPropStoreFieldValue("menuItems",k);this.updateMenu()}});this.defineProp("menu",{dataType:"Kekule.Widget.Menu",serializable:false,scope:b.PRIVATE,setter:function(l){var k=this.getMenu();if(l!==k){if(k){k.finalize();k=null}this.setPropStoreFieldValue("menu",l)}}});this.defineProp("toolbar",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,scope:b.PRIVATE,setter:function(n){var l=this.getToolbar();var k=this.getToolbarEvokeHelper();if(n!==l){if(l){l.finalize();var m=this.getToolbarEvokeHelper();if(m){m.finalize()}l=null}if(k){k.finalize()}this.setPropStoreFieldValue("toolbar",n);if(n){this.setPropStoreFieldValue("toolbarEvokeHelper",new Kekule.Widget.DynamicEvokeHelper(this,n,this.getToolbarEvokeModes(),this.getToolbarRevokeModes()))}}}});this.defineProp("enableToolbar",{dataType:DataType.BOOL,setter:function(k){this.setPropStoreFieldValue("enableToolbar",k);this.updateToolbar()}});this.defineProp("toolbarPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(k){this.setPropStoreFieldValue("toolbarPos",k);this.adjustToolbarPos()}});this.defineProp("toolbarMarginVertical",{dataType:DataType.INT,setter:function(k){this.setPropStoreFieldValue("toolbarMarginVertical",k);this.adjustToolbarPos()}});this.defineProp("toolbarMarginHorizontal",{dataType:DataType.INT,setter:function(k){this.setPropStoreFieldValue("toolbarMarginHorizontal",k);this.adjustToolbarPos()}});this.defineProp("toolbarEvokeHelper",{dataType:"Kekule.Widget.DynamicEvokeHelper",serializable:false,setter:null,scope:b.PRIVATE});this.defineProp("toolbarEvokeModes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(k){this.setPropStoreFieldValue("toolbarEvokeModes",k||[]);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setEvokeModes(k||[])}}});this.defineProp("toolbarRevokeModes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(k){this.setPropStoreFieldValue("toolbarRevokeModes",k||[]);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setRevokeModes(k||[])}}});this.defineProp("toolbarRevokeTimeout",{dataType:DataType.INT,setter:function(k){this.setPropStoreFieldValue("toolbarRevokeTimeout",k);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setTimeout(k)}}});this.defineProp("toolbarParentElem",{dataType:DataType.OBJECT,serializable:false,setter:function(k){if(this.getToolbarParentElem()!==k){this.setPropStoreFieldValue("toolbarParentElem",k);this.updateToolbar()}}});this.defineProp("caption",{dataType:DataType.STRING,setter:function(k){this.setPropStoreFieldValue("caption",k);Kekule.DomUtils.setElementText(this.getCaptionElem(),k||"");this.captionChanged()}});this.defineProp("showCaption",{dataType:DataType.BOOL,setter:function(k){this.setPropStoreFieldValue("showCaption",k);this.captionChanged()}});this.defineProp("captionPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(k){this.setPropStoreFieldValue("captionPos",k);this.captionChanged()}});this.defineProp("autoCaption",{dataType:DataType.BOOL,setter:function(k){this.setPropStoreFieldValue("autoCaption",k);if(k){this.autoDetectCaption()}}});this.defineProp("captionElem",{dataType:DataType.OBJECT,scope:b.PRIVATE,setter:null,getter:function(l){var k=this.getPropStoreFieldValue("captionElem");if(!k&&!l){k=this.doCreateCaptionElem();this.setPropStoreFieldValue("captionElem",k)}return k}});this.defineProp("actions",{dataType:"Kekule.ActionList",serializable:false,scope:b.PUBLIC,setter:null,getter:function(){var k=this.getPropStoreFieldValue("actions");if(!k){k=new Kekule.ActionList();this.setPropStoreFieldValue("actions",k)}return k}});this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:false,scope:b.PRIVATE,setter:null,getter:function(){var k=this.getPropStoreFieldValue("actionMap");if(!k){k=new Kekule.MapEx(true);this.setPropStoreFieldValue("actionMap",k)}return k}});this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL});this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL,setter:function(k){this.setPropStoreFieldValue("enableTouchInteraction",!!k);this.setTouchAction(k?"none":null)}})},initPropValues:function($super){this.setUseNormalBackground(false);this.setModalEdit(true);this.setRestrainEditorWithCurrObj(true);this.setRestraintRotation3DEdgeRatio(0.18);this.setEnableRestraintRotation3D(true);this.setShareEditorInstance(true);this.setEnableTouchInteraction(!true)},canUsePlaceHolderOnElem:function(l){var k=l.getAttribute("src");return(l.tagName.toLowerCase()==="img")&&(!!k)},doObjectChange:function($super,k){$super(k);this.updateActions()},doSetElement:function($super,l){var m=l;if(m){var k=m.tagName.toLowerCase();if(k==="img"){m=Kekule.DomUtils.replaceTagName(m,"span")}}return $super(m)},doUnbindElement:function($super,k){if(this._drawContextParentElem&&this._drawContextParentElem.parentNode){this._drawContextParentElem.parentNode.removeChild(this._drawContextParentElem);this._drawContextParentElem=null}return $super(k)},doCreateRootElement:function(l){var k=l.createElement("div");return k},doGetWidgetClassName:function($super){var l=$super()+" "+a.VIEWER;try{var m=this.getRenderType();var k=this._getRenderTypeSpecifiedHtmlClassName(m);l+=" "+k}catch(n){}return l},_getRenderTypeSpecifiedHtmlClassName:function(k){return(k===Kekule.Render.RendererType.R3D)?a.VIEWER3D:a.VIEWER2D},getResizerElement:function(){return this.getDrawContextParentElem()},doResize:function($super){this.adjustDrawParentDim();this.adjustToolbarPos();$super()},doWidgetShowStateChanged:function(k){if(k){this.updateActions()}},refitDrawContext:function($super,k){$super(k);this.adjustToolbarPos()},getAllowRenderTypeChange:function(){return true},resetRenderType:function($super,n,l){$super(n,l);var m=this._getRenderTypeSpecifiedHtmlClassName(n);var k=this._getRenderTypeSpecifiedHtmlClassName(l);this.removeClassName(m);this.addClassName(k);this.updateUiComps()},doLoadEnd:function(k){this.updateActions();this.autoDetectCaption()},doSetUseCornerDecoration:function($super,k){$super(k);this.useCornerDecorationChanged()},useCornerDecorationChanged:function(){var l=this.getDrawContextParentElem();if(l){var k=this.getUseCornerDecoration();if(k){Kekule.HtmlElementUtils.addClass(l,g.CORNER_ALL)}else{Kekule.HtmlElementUtils.removeClass(l,g.CORNER_ALL)}}},adjustDrawParentDim:function(){var n=this.getDrawContextParentElem();var l=n.parentNode;var q=this.getCaptionElem(true);var p=Kekule.HtmlElementUtils.getElemClientDimension(l);var m,o;if(q&&this.captionIsShown()&&q.parentNode===l){var k=Kekule.HtmlElementUtils.getElemClientDimension(q);o=Math.max(p.height-k.height,0);m=(this.getCaptionPos()&Kekule.Widget.Position.TOP)?k.height:0;n.style.top=m+"px";n.style.height=o+"px"}else{Kekule.StyleUtils.removeStyleProperty(n.style,"top");n.style.height=p.height+"px"}},getInteractionReceiverElem:function(){return this.getDrawContextParentElem()},setDrawDimension:function($super,n,l){var m=l;if(this.captionIsShown()){var k=Kekule.HtmlElementUtils.getElemClientDimension(this.getCaptionElem());m+=k.height||0}$super(n,m)},doCreateCaptionElem:function(){var k=this.getDocument().createElement("span");k.className=g.DYN_CREATED+"  "+g.SELECTABLE+" "+a.VIEWER_CAPTION;this.getElement().appendChild(k);return k},captionChanged:function(){if(this.captionIsShown()){var l=this.getCaptionElem();var k=l.style;var m=this.getCaptionPos();if(m&Kekule.Widget.Position.TOP){k.top=0;k.bottom="auto"}else{k.bottom=0;k.top="auto"}k.display="block"}else{var l=this.getCaptionElem(true);if(l){l.style.display="none"}}this.doResize()},captionIsShown:function(){return this.getCaption()&&this.getShowCaption()},getAllowEditing:function(){return(this.getCoordMode()!==Kekule.CoordMode.COORD3D)&&this.getEnableEdit()&&(this.getChemObj()||this.getEnableEditFromVoid())},getComposerDialog:function(){var k;if(this.getShareEditorInstance()){k=Kekule.ChemWidget.Viewer._composerDialog}else{k=this._composerDialog}if(!k){if(Kekule.Editor.ComposerDialog){k=new Kekule.Editor.ComposerDialog(this,Kekule.$L("ChemWidgetTexts.CAPTION_EDIT_OBJ"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL])}}if(this.getShareEditorInstance()){Kekule.ChemWidget.Viewer._composerDialog=k}else{this._composerDialog=k}return k},getComposerPanel:function(){var k;if(this.getShareEditorInstance()){k=Kekule.ChemWidget.Viewer._composerPanel}else{k=this._composerPanel}if(!k){if(Kekule.Editor.Composer){k=new Kekule.Editor.Composer(this);k.addClassName(a.VIEWER_EDITOR_FULLCLIENT);k.setUseNormalBackground(true);var n=Kekule.Editor.Composer.getMinPreferredDimension();k.setMinDimension(n);k.setEnableDimensionTransform(true);k.setAutoResizeConstraints({width:1,height:1});var m=Kekule.globalOptions.chemWidget.composer.commonToolButtons;m=e.exclude(m,[c.cut,c.config,c.objInspector]);k.setCommonToolButtons(m);var l=[{text:Kekule.$L("ChemWidgetTexts.CAPTION_EDITOR_DONE"),hint:Kekule.$L("ChemWidgetTexts.HINT_EDITOR_DONE"),htmlClass:"K-Res-Button-YesOk",showText:true,"#execute":function(){k._doneEditCallback();k.hide()}},{text:Kekule.$L("ChemWidgetTexts.CAPTION_EDITOR_CANCEL"),hint:Kekule.$L("ChemWidgetTexts.HINT_EDITOR_CANCEL"),htmlClass:"K-Res-Button-NoCancel",showText:true,"#execute":function(){k.hide()}}];k._customEndEditButtons=l}}if(this.getShareEditorInstance()){Kekule.ChemWidget.Viewer._composerPanel=k}else{this._composerPanel=k}k._invokerViewer=this;k._doneEditCallback=null;return k},openEditor:function(k){if(this.getAllowEditing()){var q=this.getChemObj();var n=!q;var o=q&&q.isEmpty&&q.isEmpty();var m=this.getRestrainEditorWithCurrObj();var p=Kekule.DocumentUtils.getClientDimension(this.getDocument());var l=Kekule.Editor.Composer.getMinPreferredDimension();if(p.width<=l.width+50||p.height<l.height+100){this._openEditComposer(k,q,m,n,o)}else{this._openEditComposerDialog(k,q,m,n,o)}}},_prepareEditComposer:function(o,l,k,n){o.setEnableCreateNewDoc(k||!l);o.setEnableLoadNewFile(k||!l);o.setAllowCreateNewChild(k||!l);var m=this.getEditorProperties();if(m){o.setPropValues(m)}},_feedbackEditResult:function(m,n,l){if(!m.isDirty()){return}var k=m.getSavingTargetObj();if(l){this.setChemObj(k.clone())}else{if(this.getRestrainEditorWithCurrObj()){if(n.getClass()===k.getClass()){n.assign(k.clone())}else{n.assign(cloneObj)}n.setSrcInfo(null);this.setChemObj(n)}else{this.setChemObj(k)}}},_openEditComposerDialog:function(p,r,s,m,l){var o=this.getComposerDialog();if(!o){Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"));return}var k=o.getComposer();this._prepareEditComposer(k,s,m,l);var n;if(!m&&!l){n=r.clone();o.setChemObj(n)}else{o.getComposer().newDoc()}var t=this;var q=function(u){if(u===Kekule.Widget.DialogButtons.OK&&o.getComposer().isDirty()){t._feedbackEditResult(o.getComposer(),r,m)}};if(this.getModalEdit()){o.openModal(q,p||this)}else{o.openPopup(q,p||this)}},_openEditComposer:function(v,w,x,o,m){var k=this.getComposerPanel();if(!k){Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"));return}this._prepareEditComposer(k,x,o,m);var u=k._customEndEditButtons;var t=k.getCommonToolButtons()||[];var p=false;for(var s=0,q=u.length;s<q;++s){var n=u[s];if(t.indexOf(n)<0){t.push(n);p=true}}if(p){k.setCommonToolButtons(t)}if(!o&&!m){var r=w.clone();k.setChemObj(r)}else{k.newDoc()}var y=this;k._doneEditCallback=function(){y._feedbackEditResult(k,w,o)};k.show(v,function(){if(!o&&!m){k.setChemObj(r)}else{}},Kekule.Widget.ShowHideType.POPUP)},resetView:function(){return this.resetDisplay()},getCurr2DRotationAngle:function(){return this.getDrawOptions().rotateAngle||0},rotate2DBy:function(l,k){return this.rotate2DTo(this.getCurr2DRotationAngle()+l,k)},rotate2DTo:function(l,k){this.getDrawOptions().rotateAngle=l;if(!k){this.geometryOptionChanged()}return this},getCurr3DRotationInfo:function(){var m={};var k=["rotateMatrix","rotateX","rotateY","rotateZ","rotateAngle"];var p=this.getDrawOptions();for(var o=0,n=k.length;o<n;++o){var q=k[o];m[q]=p[q]||0}m.rotateAxisVector=p.rotateAxisVector||null;return m},setRotate3DMatrix:function(k,l){this.getDrawOptions().rotateMatrix=k;if(!l){this.geometryOptionChanged()}return this},rotate3DBy:function(l,k,r,o){var p=this.getCurr3DRotationInfo();var q=p.rotateMatrix||Kekule.MatrixUtils.createIdentity(4);var n=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:l,rotateY:k,rotateZ:r});var m=Kekule.MatrixUtils.multiply(n,q);this.setRotate3DMatrix(m,o);return this},rotate3DByAxis:function(q,o,m){var n=this.getCurr3DRotationInfo();var p=n.rotateMatrix||Kekule.MatrixUtils.createIdentity(4);var l=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:q,rotateAxisVector:o});var k=Kekule.MatrixUtils.multiply(l,p);this.setRotate3DMatrix(k,m);return this},getDefaultToolBarButtons:function(){return Kekule.globalOptions.chemWidget.viewer.toolButtons},isToolbarEmbedded:function(){return !this.getToolbarParentElem()},adjustToolbarPos:function(){var w=this.getToolbar();if(!w){return}if(this.isToolbarEmbedded()){var n=Kekule.Widget.Position;var s=Kekule.HtmlElementUtils.getElemPageRect(this.getDrawContextParentElem());var q=Kekule.HtmlElementUtils.getElemPageRect(w);var v=this.getToolbarPos();var k=this.getToolbarMarginHorizontal();var r=this.getToolbarMarginVertical();var l="left",u="top";var m="right",p="bottom";var t=(s.width-q.width)/2;var x=(s.height-q.height)/2;if(v===n.AUTO||!v){var o=((k>0)?k:0)*2+q.width;var y=((r>0)?r:0)*2+q.height;if(o>s.width){v|=n.LEFT;k=0}else{v|=n.RIGHT}if(y>s.height/2){v|=n.BOTTOM;r=-1}else{v|=n.BOTTOM}}if(v&n.LEFT){l="left";m="right";t=(k>=0)?k:k-q.width}else{if(v&n.RIGHT){l="right";m="left";t=(k>=0)?k:k-q.width}}if(v&n.TOP){u="top";p="bottom";x=(r>=0)?r:r-q.height}else{if(v&n.BOTTOM){u="bottom";p="top";x=(r>=0)?r:r-q.height}}w.removeStyleProperty(m);w.removeStyleProperty(p);w.setStyleProperty(l,t+"px");w.setStyleProperty(u,x+"px")}else{w.removeStyleProperty("left");w.removeStyleProperty("top");w.removeStyleProperty("width");w.removeStyleProperty("height")}},updateToolbar:function(){if(this.getEnableToolbar()){this.createToolbar();this.adjustToolbarPos()}else{this.setToolbar(null)}},updateMenu:function(){this.createMenu()},updateUiComps:function(){this.updateToolbar();this.updateMenu()},updateActions:function(){if(this.getActions()){this.getActions().updateAll()}},clearActions:function(){this.getActions().clear();this.getActionMap().clear()},getCompActionClass:function(k){return this.getChildActionClass(k,true)},_getActionOfComp:function(l,p,n){var m=this.getActionMap();var k=m.get(l);if(!k&&p){var o=this.getCompActionClass(l)||n;if(o){k=new o(this);m.set(l,k);this.getActions().add(k)}}return k},createToolbar:function(){this.clearActions();var m=new Kekule.Widget.ButtonGroup(this);m.addClassName(g.DYN_CREATED);m.setDisplayed(false);m.setShowText(false);m.doSetShowGlyph(true);var q=this.getToolButtons()||this.getDefaultToolBarButtons();for(var p=0,k=q.length;p<k;++p){var n=q[p];var o=this.createToolButton(n,m)}m.addClassName(a.INNER_TOOLBAR);if(this.isToolbarEmbedded()){m.addClassName(a.VIEWER_EMBEDDED_TOOLBAR)}m.appendToElem(this.getToolbarParentElem()||this.getElement());this.setToolbar(m);return m},createToolButton:function(s,q){var t=null;var n=this.beginContinuousRepainting.bind(this);var l=this.endContinuousRepainting.bind(this);var o=[c.rotateX,c.rotateY,c.rotateZ,c.rotateLeft,c.rotateRight];if(DataType.isObjectValue(s)){var r=Object.extend({widget:Kekule.Widget.Button},s);t=Kekule.Widget.Utils.createFromHash(q,r);var p=r.actionClass;if(p){if(typeof(p)==="string"){p=ClassEx.findClass(r.actionClass)}}if(p){var m=this._getActionOfComp(t,true,p);if(m){t.setAction(m)}}}else{if(s===c.molDisplayType){return this.createMolDisplayTypeButton(q)}else{if(s===c.menu){return this.createMenuButton(q)}}var p=this.getCompActionClass(s);var k=Kekule.Widget.Button;if(s===c.molHideHydrogens){k=Kekule.Widget.CheckButton}t=new k(q);var m=this._getActionOfComp(s,true);if(m){t.setAction(m)}if(o.indexOf(s)>=0){t.setPeriodicalExecInterval(20);t.setEnablePeriodicalExec(true);t.addEventListener("activate",n);t.addEventListener("deactivate",l)}}return t},createMenuButton:function(l){var k=new Kekule.Widget.DropDownButton(l);k.setText(Kekule.$L("WidgetTexts.CAPTION_MENU")).setHint(Kekule.$L("WidgetTexts.HINT_MENU"));k.addClassName(a.VIEWER_MENU_BUTTON);if(!this.getMenu()){this.createMenu()}k.setDropDownWidget(this.getMenu());return k},createMolDisplayTypeButton:function(s){var u=new Kekule.Widget.CompactButtonSet(s);u.getButtonSet().addClassName(a.INNER_TOOLBAR);u.setShowText(false);var n=this._getActionOfComp(c.molDisplayType,true);u.setAction(n);this.getActions().add(n);var t=this.getDocument();var q=this.getAllowedMolDisplayTypes();var r=this._getUsableMolDisplayActionClasses(q);for(var p=0,m=r.length;p<m;++p){var o=r[p].TYPE;var k=new Kekule.Widget.RadioButton(t);var n=this._getActionOfComp(c.molDisplayType+o,true,r[p]);k.setAction(n);u.append(k,o===this.getCurrMoleculeDisplayType())}return u},_getUsableMolDisplayActionClasses:function(q){var k=[];var p=(this.getRenderType()===Kekule.Render.RendererType.R3D)?i.Viewer.molDisplayType3DActionClasses:i.Viewer.molDisplayType2DActionClasses;for(var o=0,m=p.length;o<m;++o){var n=p[o].TYPE;if(q&&(q.indexOf(n)<0)&&(n!==this.getCurrMoleculeDisplayType())){continue}k.push(p[o])}return k},getDefaultMenuItems:function(){return Kekule.globalOptions.chemWidget.viewer.menuItems},prepareMenuItems:function(n){var t=[];var k=Kekule.Widget.MenuItem.SEPARATOR_TEXT;for(var p=0,o=n.length;p<o;++p){var q=n[p];if(typeof(q)==="string"){if(q!==k){var m=this.createPredefinedMenuItemDefHash(q);if(m){t.push(m)}}}else{var s=Object.extend({},q);if(!q.widget&&!q.widgetClass){s.widget=Kekule.Widget.MenuItem}if(q.children&&q.children.length){var r=this.prepareMenuItems(q.children);s.children=r}t.push(s)}}return t},createPredefinedMenuItemDefHash:function(m){if(m===c.molDisplayType){return this.createMolDisplayMenuDefHash()}var l=[c.rotateX,c.rotateY,c.rotateZ,c.rotateLeft,c.rotateRight];var o=this.beginContinuousRepainting.bind(this);var r=this.endContinuousRepainting.bind(this);var p=this.getCompActionClass(m);var q=Kekule.Widget.MenuItem;var k=null;var n=this._getActionOfComp(m,true);if(n){k={widget:q,action:n};if(l.indexOf(m)>=0){k=Object.extend(k,{periodicalExecInterval:20,enablePeriodicalExec:true,"#activate":o,"@deactivate":r})}}return k},createMolDisplayMenuDefHash:function(){var r=this._getActionOfComp(c.molDisplayType,true);var k={widget:Kekule.Widget.MenuItem,action:r};var q=[];var n=this.getAllowedMolDisplayTypes();var s=this._getUsableMolDisplayActionClasses(n);for(var p=0,m=s.length;p<m;++p){var o=s[p].TYPE;var r=this._getActionOfComp(c.molDisplayType+o,true,s[p]);q.push({widget:Kekule.Widget.MenuItem,action:r})}if(q.length){k.children=[{widget:Kekule.Widget.PopupMenu,children:q}]}return k},createMenu:function(){var k=this.getMenu();if(!k){k=new Kekule.Widget.PopupMenu(this);k.addClassName(g.DYN_CREATED);k.setDisplayed(false)}else{k.clearMenuItems()}var l=this.getMenuItems()||this.getDefaultMenuItems();l=this.prepareMenuItems(l);k.createChildrenByDefs(l);this.setMenu(k);return k},autoDetectCaption:function(){if(this.getAutoCaption()){var m=this.getChemObj();if(m){var l=m&&m.getInfo();var n=m&&m.getSrcInfo();if(l&&n){var k=l.title||l.caption||m.getName()||n.fileName;if(k){this.setCaption(k)}}}}}});var h=Kekule.X.Event;Kekule.ChemWidget.ViewerBasicInteractionController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.ChemWidget.ViewerBasicInteractionController",initialize:function($super,k){$super(k);this._enableMouseRotate=true;this._transformInfo={isTransforming:false,lastCoord:null,lastZoom:null};this._restraintCoord=null;this._doInteractiveTransformStepBind=this._doInteractiveTransformStep.bind(this)},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:false,getter:function(){return this.getWidget()},setter:function(k){this.setWidget(k)}})},getViewerRenderType:function(){return this.getViewer().getRenderType()},getEnableInteraction:function(){var l=this.getViewer();var k=!!(l&&l.getEnableDirectInteraction()&&l.getChemObjLoaded());return k},getEnableTouchInteraction:function(){var l=this.getViewer();var k=!!(l&&l.getEnableDirectInteraction()&&l.getEnableTouchInteraction()&&l.getChemObjLoaded());return k},_initTransform:function(){var p=this.getViewer();var l=p.getOffsetWidth();var m=p.getOffsetHeight();var k;var o=this._transformInfo;var n=this._restraintCoord;if(n){k=(n==="x")?m:l;o.angleRatio=1/k*Math.PI*2}else{k=Math.min(l,m);o.angleRatio=1/k*Math.PI}},zoomViewer:function(l){var k=this.getViewer();if(!k||!k.getChemObj()){return}if(l>0){if(k.zoomIn){k.zoomIn(l)}}else{if(l<0){if(k.zoomOut){k.zoomOut(-l)}}}},isEventFromInteractionArea:function(m){var l=m.getTarget();var k=this.getViewer().getInteractionReceiverElem();return(l===k)||Kekule.DomUtils.isDescendantOf(l,k)},_beginInteractTransformAtCoord:function(m,k,n,l){var p=this.getViewer();if(p&&p.getChemObj()){var o=this._transformInfo;o.isTransforming=true;o.lastCoord={x:m,y:k};this._restraintCoord=this._calcRestraintRotateCoord(n,l);this._initTransform();this.getViewer().setTouchAction("none");this._requestInteractiveTransform(m,k)}},_endInteractTransform:function(){this._transformInfo.isTransforming=false;this.getViewer().setTouchAction(null);this._doInteractiveTransformEnd()},_calcRestraintRotateCoord:function(m,l){var t=this.getViewer();var z=null;var x=this._getRestraintRotate3DEdgeSize();if(x>0){var p=t.getInteractionReceiverElem();var w=Kekule.HtmlElementUtils.getElemPageRect(p,true);var n=m-w.left;var y=l-w.top;var k=w.right-m;var v=w.bottom-l;var q,o,s,r;if(n<=k){s=1;q=n}else{s=-1;q=k}if(y<=v){r=1;o=y}else{r=-1;o=v}var u=Math.min(q,o);if(u>x){return null}else{if(o>u){if(s<0){z="x"}}else{if(r>0){z="z"}else{z="y"}}}}return z},_interactTransformAtCoord:function(m,k){var n=this._transformInfo.lastCoord;if(n){var l={x:m,y:k};var o=Kekule.CoordUtils.getDistance(n,l);if(o<5){return}}this._requestInteractiveTransform(m,k)},_requestInteractiveTransform:function(l,k){this._transformInfo.interactScreenCoord={x:l,y:k};if(!this._interactiveTransformStepId){this._interactiveTransformStepId=window.requestAnimationFrame(this._doInteractiveTransformStepBind)}},_doInteractiveTransformStep:function(){if(this._transformInfo&&this._transformInfo.isTransforming){var k=this._transformInfo.interactScreenCoord;if(this.getViewerRenderType()===Kekule.Render.RendererType.R3D){this.rotateByXYDistance(k.x,k.y)}else{this.moveByXYDistance(k.x,k.y)}this._interactiveTransformStepId=window.requestAnimationFrame(this._doInteractiveTransformStepBind)}},_doInteractiveTransformEnd:function(){if(this._interactiveTransformStepId){window.cancelAnimationFrame(this._interactiveTransformStepId);this._interactiveTransformStepId=null}},_getRestraintRotate3DEdgeSize:function(){var m=this.getViewer();if(m.getEnableRestraintRotation3D()&&m.getRenderType()===Kekule.Render.RendererType.R3D){var l=m.getDimension();var k=Math.min(l.width,l.height);return k*(m.getRestraintRotation3DEdgeRatio()||0)}else{return 0}},needReactEvent:function(k){return this.getEnableInteraction()&&this.isEventFromInteractionArea(k)},react_dblclick:function(k){if(this.needReactEvent(k)){this.getViewer().resetDisplay()}},react_mousewheel:function(k){if(this.needReactEvent(k)){var l=k.wheelDeltaY||k.wheelDelta;if(l){l/=120}this.zoomViewer(l);k.preventDefault();return true}},react_pointerdown:function(k){if(!this.needReactEvent(k)){return}if(k.getButton()===h.MouseButton.LEFT){if(k.getPointerType()!==h.PointerType.TOUCH||this.getEnableTouchInteraction()){this._beginInteractTransformAtCoord(k.getScreenX(),k.getScreenY(),k.getClientX(),k.getClientY())}}},react_pointerhold:function(k){if(!this.needReactEvent(k)){return}if(k.getPointerType()===h.PointerType.TOUCH&&k.getButton()===h.MouseButton.LEFT){this.getViewer().setEnableTouchInteraction(!this.getViewer().getEnableTouchInteraction())}},react_pointerleave:function(k){this._endInteractTransform()},react_pointerup:function(k){if(k.getButton()===h.MouseButton.LEFT){this._endInteractTransform()}},react_pointermove:function(k){if(!this.needReactEvent(k)){return}if(this._transformInfo.isTransforming){this._interactTransformAtCoord(k.getScreenX(),k.getScreenY());k.preventDefault()}},moveByXYDistance:function(m,l){var o=this._transformInfo;if(o&&o.isTransforming&&(!o.calculating)){var p=this.getViewer();if(p.getRenderType()===Kekule.Render.RendererType.R3D){return}o.calculating=true;try{var n={x:m,y:l};var q=Kekule.CoordUtils.substract(n,o.lastCoord);var k=p.getBaseCoordOffset()||{};k=Kekule.CoordUtils.add(k,q);p.setBaseCoordOffset(k);o.lastCoord=n}finally{o.calculating=false}}},rotateByXYDistance:function(n,m){var o=this._transformInfo;if(o&&o.isTransforming&&(!o.calculating)){var r=this.getViewer();if(r.getRenderType()!==Kekule.Render.RendererType.R3D){return}o.calculating=true;try{var l={x:n,y:m};var u=Kekule.CoordUtils.substract(l,o.lastCoord);u.y=-u.y;var p,q,t;if(this._restraintCoord){var k=this._restraintCoord;if(k==="x"){p=u.y;t={x:1,y:0,z:0}}else{p=u.x;if(k==="y"){t={x:0,y:-1,z:0}}else{t={x:0,y:0,z:1}}}q=-p*o.angleRatio}else{p=Kekule.CoordUtils.getDistance({x:0,y:0},u);q=p*o.angleRatio;t={x:-u.y,y:u.x,z:0}}r.rotate3DByAxis(q,t);o.lastCoord=l;o.calculating=false}catch(s){}finally{o.calculating=false}}},doTestMouseCursor:function(n,m){var k="";var l=this._transformInfo;if(l.isTransforming){k="move"}return k}});Kekule.ChemWidget.Viewer2D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer2D",initialize:function($super,k,l){$super(k,l,Kekule.Render.RendererType.R2D)},getAllowRenderTypeChange:function(){return false}});Kekule.ChemWidget.Viewer3D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer3D",initialize:function($super,k,l){$super(k,l,Kekule.Render.RendererType.R3D)},getAllowRenderTypeChange:function(){return false}});var f=Kekule.ObjPropSettingManager;f.register("Kekule.ChemWidget.Viewer.fullFunc",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:true,enableEdit:true,toolButtons:null});f.register("Kekule.ChemWidget.Viewer.basic",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:false,toolButtons:[c.saveData,c.molDisplayType,c.zoomIn,c.zoomOut],menuItems:[c.saveData,"-",c.molDisplayType,c.zoomIn,c.zoomOut]});f.register("Kekule.ChemWidget.Viewer.mini",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:false,toolButtons:[c.menu],menuItems:[c.saveData,"-",c.molDisplayType,c.zoomIn,c.zoomOut]});f.register("Kekule.ChemWidget.Viewer.static",{enableToolbar:false,enableDirectInteraction:false,enableTouchInteraction:false,toolButtons:[],menuItems:[]});f.register("Kekule.ChemWidget.Viewer.editOnly",{enableToolbar:true,enableEdit:true,toolButtons:[c.openEditor],menuItems:[c.openEditor]});Kekule.ChemWidget.Viewer.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.ChemWidget.Viewer.Settings",initProperties:function(){this.defineDelegatedProps(["enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","enableEdit","modalEdit"])},getViewer:function(){return this.getWidget()}});Kekule.ChemWidget.ActionOnViewer=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionOnViewer",initialize:function($super,m,k,l){$super(m,k,l)},doUpdate:function(){var k=this.getDisplayer();this.setEnabled(k&&k.getChemObj()&&k.getChemObjLoaded()&&k.getEnabled())},getViewer:function(){var k=this.getDisplayer();return(k instanceof Kekule.ChemWidget.Viewer)?k:null}});Kekule.ChemWidget.ActionViewerRotateBase=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase",initialize:function($super,m,k,l){$super(m,k,l);this.setDelta(2*Math.PI/180)},initProperties:function(){this.defineProp("delta",{dataType:DataType.FLOAT})},isShiftModified:function(k){return k&&k.getShiftKey()}});Kekule.ChemWidget.ActionViewerRotateBase2D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase2D",doUpdate:function($super){$super();var l=this.getViewer();var k=l&&(l.getRenderType()===Kekule.Render.RendererType.R2D);this.setDisplayed(k).setEnabled(this.getEnabled()&&k)}});Kekule.ChemWidget.ActionViewerRotateBase3D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase3D",doUpdate:function($super){$super();var l=this.getViewer();var k=l&&(l.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(k).setEnabled(this.getEnabled()&&k)}});Kekule.ChemWidget.ActionViewerRotateLeft=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateLeft",HTML_CLASSNAME:a.ACTION_ROTATE_LEFT,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATELEFT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATELEFT"))},doExecute:function(l,k){var m=this.getDelta();this.getViewer().rotate2DBy(m)}});Kekule.ChemWidget.ActionViewerRotateRight=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateRight",HTML_CLASSNAME:a.ACTION_ROTATE_RIGHT,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATERIGHT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATERIGHT"))},doExecute:function(l,k){var m=-this.getDelta();this.getViewer().rotate2DBy(m)}});Kekule.ChemWidget.ActionViewerRotateX=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateX",HTML_CLASSNAME:a.ACTION_ROTATE_X,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEX"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEX"))},doExecute:function(m,l){var k=this.isShiftModified(l);var n=-this.getDelta();if(k){n=-n}this.getViewer().rotate3DBy(n,0,0)}});Kekule.ChemWidget.ActionViewerRotateY=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateY",HTML_CLASSNAME:a.ACTION_ROTATE_Y,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEY"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEY"))},doExecute:function(m,l){var k=this.isShiftModified(l);var n=-this.getDelta();if(k){n=-n}this.getViewer().rotate3DBy(0,n,0)}});Kekule.ChemWidget.ActionViewerRotateZ=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateZ",HTML_CLASSNAME:a.ACTION_ROTATE_Z,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEZ"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEZ"))},doExecute:function(m,l){var k=this.isShiftModified(l);var n=-this.getDelta();if(k){n=-n}this.getViewer().rotate3DBy(0,0,n)}});Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub",initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_MOL_DISPLAY_TYPE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_DISPLAY_TYPE"))},doExecute:function(k){}});Kekule.ChemWidget.ActionViewerEdit=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerEdit",HTML_CLASSNAME:a.ACTION_VIEWER_EDIT,initialize:function($super,k){$super(k,Kekule.$L("ChemWidgetTexts.CAPTION_OPENEDITOR"),Kekule.$L("ChemWidgetTexts.HINT_OPENEDITOR"))},doUpdate:function($super){$super();var k=this.getViewer();this.setEnabled(k&&k.getAllowEditing()&&k.getEnabled());this.setDisplayed(k&&k.getEnableEdit())},doExecute:function(k){var l=this.getViewer();l.openEditor(k)}});Kekule.ChemWidget.Viewer.rotate2DActionClasses=[i.ActionViewerRotateLeft,i.ActionViewerRotateRight];Kekule.ChemWidget.Viewer.rotate3DActionClasses=[i.ActionViewerRotateX,i.ActionViewerRotateY,i.ActionViewerRotateZ];Kekule.ChemWidget.Viewer.molDisplayType2DActionClasses=[i.ActionDisplayerChangeMolDisplayTypeSkeletal,i.ActionDisplayerChangeMolDisplayTypeCondensed];Kekule.ChemWidget.Viewer.molDisplayType3DActionClasses=[i.ActionDisplayerChangeMolDisplayTypeWire,i.ActionDisplayerChangeMolDisplayTypeSticks,i.ActionDisplayerChangeMolDisplayTypeBallStick,i.ActionDisplayerChangeMolDisplayTypeSpaceFill];Kekule._registerAfterLoadSysProc(function(){var m=Kekule.ActionManager;var k=Kekule.ChemWidget;var n=Kekule.ChemWidget.Viewer;var l=m.registerNamedActionClass;l(c.loadFile,k.ActionDisplayerLoadFile,n);l(c.loadData,k.ActionDisplayerLoadData,n);l(c.saveData,k.ActionDisplayerSaveFile,n);l(c.clearObjs,k.ActionDisplayerClear,n);l(c.zoomIn,k.ActionDisplayerZoomIn,n);l(c.zoomOut,k.ActionDisplayerZoomOut,n);l(c.rotateLeft,k.ActionViewerRotateLeft,n);l(c.rotateRight,k.ActionViewerRotateRight,n);l(c.rotateX,k.ActionViewerRotateX,n);l(c.rotateY,k.ActionViewerRotateY,n);l(c.rotateZ,k.ActionViewerRotateZ,n);l(c.reset,k.ActionDisplayerReset,n);l(c.molHideHydrogens,k.ActionDisplayerHideHydrogens,n);l(c.molDisplayType,k.ActionViewerChangeMolDisplayTypeStub,n);l(c.openEditor,k.ActionViewerEdit,n);l(c.config,Kekule.Widget.ActionOpenConfigWidget,n);l(c.molDisplayTypeCondensed,k.ActionDisplayerChangeMolDisplayTypeCondensed,n);l(c.molDisplayTypeSkeletal,k.ActionDisplayerChangeMolDisplayTypeSkeletal,n);l(c.molDisplayTypeWire,k.ActionDisplayerChangeMolDisplayTypeWire,n);l(c.molDisplayTypeSticks,k.ActionDisplayerChangeMolDisplayTypeSticks,n);l(c.molDisplayTypeBallStick,k.ActionDisplayerChangeMolDisplayTypeBallStick,n);l(c.molDisplayTypeSpaceFill,k.ActionDisplayerChangeMolDisplayTypeSpaceFill,n)})})();(function(){var c=Class.PropertyScope;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER_GRID:"K-Chem-Viewer-Grid"});var a=Kekule.Widget.HtmlClassNames;var b=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ViewerGrid=Class.create(Kekule.Widget.WidgetGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid",initialize:function($super,d,f,e){this.setPropStoreFieldValue("renderType",f);this.setPropStoreFieldValue("viewerConfigs",e);$super(d)},initProperties:function(){this._shadowedPropPairs=[];this.defineProp("renderType",{dataType:DataType.INT,serializable:false,setter:null,scope:c.PUBLIC});this.defineProp("chemObjs",{dataType:DataType.ARRAY,serializable:false,setter:null,getter:function(){var d=[];this.each(function(e){d.push(e.getChemObj())});return d}});this.defineViewerShadowProps(["drawOptions","moleculeDisplayType","zoom","autoSize","enableLoadNewFile","viewerConfigs","allowedMolDisplayTypes","enableEdit","modalEdit","toolButtons","enableToolbar","toolbarPos","toolbarMarginVertical","toolbarMarginHorizontal","toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","caption","showCaption","autoCaption","captionPos","enableDirectInteraction","enableTouchInteraction"]);this.defineViewerShadowProps(["viewerPredefinedSetting"],["predefinedSetting"]);this.defineProp("actionLoadData",{dataType:"Kekule.ChemWidget.ActionDisplayerLoadData",serializable:false,scope:c.PRIVATE,setter:null,getter:function(){var d=this.getPropStoreFieldValue("actionLoadData");if(!d){d=new Kekule.ChemWidget.ActionDisplayerLoadData();this.setPropStoreFieldValue("actionLoadData",d)}return d}})},defineViewerShadowProps:function(j,f){if(!f){f=[]}for(var g=0,e=j.length;g<e;++g){var h=j[g];var d=f[g]||j[g];this.defineViewerShadowProp(h,d)}},defineViewerShadowProp:function(h,f){if(!f){f=h}var e=Kekule.ChemWidget.Viewer;var g=ClassEx.getPropInfo(e,f);if(g){var d=Object.create(g);d.getter=undefined;d.setter=function(i){this.setPropStoreFieldValue(h,i);this.each(function(j){j.setPropValue(f,i)})};this.defineProp(h,d);this._shadowedPropPairs.push({prop:h,viewerProp:f})}},doGetWidgetClassName:function($super){return $super()+" "+b.VIEWER_GRID},createWidget:function($super){var f=this.getDocument();var e=new Kekule.ChemWidget.LoadDataDialog(f);var d=this;e.openModal(function(g){if(e.isPositiveResult(g)){var i=e.getChemObj();if(i){var h=d.doCreateNewChildWidget(f,i);h.setParent(d)}}},this.getAddingCell())},doCreateNewChildWidget:function(e,f){var d=new Kekule.ChemWidget.Viewer(e,null,this.getRenderType(),this.getViewerConfigs());this.doSetShadowedPropValuesToViewer(d);if(!f){}else{d.setChemObj(f)}return d},doSetShadowedPropValuesToViewer:function(h){for(var e=0,d=this._shadowedPropPairs.length;e<d;++e){var g=this._shadowedPropPairs[e];var f=this.getPropValue(g.prop);h.setPropValue(g.viewerProp,f)}},addChemObj:function(d){this.doCreateNewChildWidget(this.getDocument(),d).setParent(this);return this},removeChemObj:function(e){var d=this;this.each(function(f){if(f.getChemObj()===e){d.removeWidget(f,true)}});return this}});Kekule.ChemWidget.ViewerGrid2D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid2D",initialize:function($super,d,e){$super(d,Kekule.Render.RendererType.R2D,e)}});Kekule.ChemWidget.ViewerGrid3D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid3D",initialize:function($super,d,e){$super(d,Kekule.Render.RendererType.R3D,e)}})})();(function(){var f=Class.PropertyScope;var d=Kekule.DomUtils;var a=Kekule.ArrayUtils;var c=Kekule.ChemWidget;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMOBJSETTER:"K-Chem-Obj-Setter",CHEMOBJSETTER_TOOLBAR_AREA:"K-Chem-Obj-Setter-Toolbar-Area",CHEMOBJSETTER_CLIENT:"K-Chem-Obj-Setter-Client",CHEMOBJSETTER_VIEWER:"K-Chem-Obj-Setter-Viewer",CHEMOBJSETTER_TABGROUP:"K-Chem-Obj-Setter-TabGroup",CHEMOBJSETTER_INFOLABEL:"K-Chem-Obj-Setter-InfoLabel",CHEMOBJSETTER_REGION:"K-Chem-Obj-Setter-Region",CHEMOBJSETTER_REGION_LABEL:"K-Chem-Obj-Setter-Region-Label",CHEMOBJSETTER_LINE:"K-Chem-Obj-Setter-Line",CHEMOBJSETTER_CONFIGURATOR:"K-Chem-Obj-Setter-Configurator"});var b=Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ChemObjInserter=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter",DEF_BGCOLOR_2D:"transparent",DEF_BGCOLOR_3D:"#000000",initialize:function($super,g,k,i,h){this._configAction=new Kekule.Widget.ActionOpenConfigWidget(this);this._toolbarParentElem=null;this._infoLabel=null;this._infoLabelTemplate=Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH_HEIGHT");$super(g);var j=this.getViewer();if(i){j.setRenderType(i)}if(h){j.setViewerConfigs(h)}this.adjustChildrenSizes()},doFinalize:function($super){if(this._configAction){this._configAction.finalize()}$super()},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("viewer");if(!g){g=this.createViewer();this.setPropStoreFieldValue("viewer",g)}return g}});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,scope:f.PUBLIC,getter:function(){var g=this.getPropStoreFieldValue("viewer");return g?g.getChemObj():this.getPropStoreFieldValue("chemObj")},setter:function(g){this.setPropStoreFieldValue("chemObj",g);if(this.getViewer()){this.getViewer().setChemObj(g)}}});this.defineProp("renderType",{dataType:DataType.INT,serializable:false,scope:f.PUBLIC,setter:function(j){var h=this.getRenderType();if(j!==h){this.setPropStoreFieldValue("renderType",j);this.getViewer().setRenderType(j);var i=this.getTabs();if(i){var g=(j===Kekule.Render.RendererType.R3D)?1:0;i.getChildWidgets()[g].setChecked(true)}}}});this.defineProp("is3D",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getRenderType()===Kekule.Render.RendererType.R3D},setter:function(g){this.setRenderType(g?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D)}});this.defineProp("showInfo",{dataType:DataType.BOOL,serializable:false,getter:function(){return this._infoLabel&&Kekule.StyleUtils.isShown(this._infoLabel)},setter:function(g){if(this._infoLabel){Kekule.StyleUtils.setDisplay(this._infoLabel,g)}}});this.defineProp("autoSizeExport",{dataType:DataType.BOOL});this.defineProp("backgroundColor2D",{dataType:DataType.STRING,setter:function(g){this.setPropStoreFieldValue("backgroundColor2D",g);this.backgroundColorChange()}});this.defineProp("backgroundColor3D",{dataType:DataType.STRING,setter:function(g){this.setPropStoreFieldValue("backgroundColor3D",g);this.backgroundColorChange()}});this.defineProp("exportViewerPredefinedSetting",{dataType:DataType.STRING});this.defineProp("clientPanel",{dataType:DataType.OBJECT,serializable:false,setter:false,scope:f.PRIVATE});this.defineProp("tabs",{dataType:DataType.OBJECT,serializable:false,setter:false,scope:f.PRIVATE});this._defineViewerDelegatedProp("chemObjLoaded");this._defineViewerDelegatedProp("renderConfigs");this._defineViewerDelegatedProp("drawOptions");this._defineViewerDelegatedProp("allowCoordBorrow");this._defineViewerDelegatedProp("autoSize");this._defineViewerDelegatedProp("autofit");this._defineViewerDelegatedProp("viewerConfigs");this._defineViewerDelegatedProp("allowedMolDisplayTypes");this._defineViewerDelegatedProp("enableEdit");this._defineViewerDelegatedProp("enableEditFromVoid");this._defineViewerDelegatedProp("modalEdit");this._defineViewerDelegatedProp("toolButtons");this._defineViewerDelegatedProp("enableDirectInteraction");this._defineViewerDelegatedProp("enableTouchInteraction")},initPropValues:function($super){$super();this.setAutoSizeExport(true);this.setBackgroundColor3D(this.DEF_BGCOLOR_3D);this.setExportViewerPredefinedSetting("basic")},_defineViewerDelegatedProp:function(j,g){if(!g){g=j}var h=ClassEx.getPropInfo(Kekule.ChemWidget.Viewer,g);var i=Object.create(h);i.getter=null;i.setter=null;if(h.getter){i.getter=function(){return this.getViewer().getPropValue(g)}}if(h.setter){i.setter=function(k){this.getViewer().setPropValue(g,k)}}return this.defineProp(j,i)},loadPredefinedResDataToProp:function(h,g,i){if(h==="chemObj"){if(i){var j=Kekule.IO.loadTypedData(g.data,g.resType,g.resUri);this.setChemObj(j)}else{Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+g.resUri||"")}}},doGetWidgetClassName:function($super){var g=$super()+" "+e.CHEMOBJSETTER;return g},doCreateRootElement:function(h){var g=h.createElement("div");return g},doCreateSubElements:function($super,j,h){var g=$super(j,h);this.createToolbarParent(h);var i=new Kekule.Widget.Panel(this);i.addClassName(e.CHEMOBJSETTER_CLIENT);i.setUseCornerDecoration(false);i.appendToElem(h);this.setPropStoreFieldValue("clientPanel",i);this.createViewer(i.getCoreElement());this.createInfoLabel(h,this.getViewer());this.createTabs(h);return g},doResize:function($super){this.adjustChildrenSizes()},doWidgetShowStateChanged:function($super,g){$super(g);this.adjustChildrenSizes()},getResizerElement:function(){return this.getClientPanel()?this.getClientPanel().getCoreElement():this.getCoreElement()},getBackgroundColor:function(h){var g=(h===Kekule.Render.RendererType.R3D)?this.getBackgroundColor3D():this.getBackgroundColor2D();if(g===Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT){g="transparent"}return g},setBackgroundColor:function(g,h){if(h===Kekule.Render.RendererType.R3D){var i=g||this.DEF_BGCOLOR_3D;this.setBackgroundColor3D(i)}else{var i=g||this.DEF_BGCOLOR_2D;this.setBackgroundColor2D(i)}},backgroundColorChange:function(){var g=this.getBackgroundColor(this.getRenderType());var h=this.getPropStoreFieldValue("viewer");if(h){h.setBackgroundColor(g)}},adjustChildrenSizes:function(){var g=this.getPageRect();var k=Kekule.HtmlElementUtils.getElemPageRect(this._toolbarParentElem);var i=this.getTabs();var l=i&&i.getPageRect();var j=l.top-k.bottom;this.getClientPanel().setHeight(j+"px");this.getViewer().resized()},createViewer:function(h){var k=Kekule.ChemWidget.ComponentWidgetNames;var i=Kekule.Widget.EvokeMode;var g=new Kekule.ChemWidget.Viewer(this,null,this.getRenderType());g.addClassName([b.DYN_CREATED,e.CHEMOBJSETTER_VIEWER]);g.setRenderType(Kekule.Render.RendererType.R2D);g.setEnableEdit(true);g.setEnableEditFromVoid(true);g.setRestrainEditorWithCurrObj(false);g.setEnableToolbar(true);g.setPredefinedSetting("fullFunc");var j=a.exclude(g.getDefaultToolBarButtons(),k.config);j.push({action:this._configAction});j.splice(2,0,k.clearObjs);g.setToolbarParentElem(this._toolbarParentElem);g.setToolButtons(j);g.setToolbarPos(Kekule.Widget.Position.BOTTOM);g.setToolbarMarginVertical(-2);g.setToolbarEvokeModes([i.ALWAYS]);g.addEventListener("resize",this.updateInfoLabel,this);g.appendToElem(h);g.setChemObj(this.getChemObj());this.setPropStoreFieldValue("viewer",g);this.backgroundColorChange();return g},createToolbarParent:function(h){var g=h.ownerDocument.createElement("div");g.className=e.CHEMOBJSETTER_TOOLBAR_AREA;h.appendChild(g);this._toolbarParentElem=g;return g},createTabs:function(k){var o=[Kekule.$L("ChemWidgetTexts.CAPTION_2D"),Kekule.$L("ChemWidgetTexts.CAPTION_3D")];var j=(this.getRenderType()===Kekule.Render.RendererType.R3D)?1:0;var g=new Kekule.Widget.TabButtonGroup(this);g.setTabButtonPosition(Kekule.Widget.Position.BOTTOM);g.addClassName([b.DYN_CREATED,e.CHEMOBJSETTER_TABGROUP]);var p=[];for(var n=0,h=o.length;n<h;++n){var m=new Kekule.Widget.RadioButton(g);m.setText(o[n]);if(n===j){m.setChecked(true)}p.push(m)}g.addEventListener("switch",function(r){var q=r.button;var i=p.indexOf(q);var l=(i===1)?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(l);this.backgroundColorChange()},this);g.appendToElem(k);this.setPropStoreFieldValue("tabs",g);return g},createInfoLabel:function(h,i){var g=this.getDocument().createElement("div");g.className=b.DYN_CREATED+" "+e.CHEMOBJSETTER_INFOLABEL;i.getElement().appendChild(g);this._infoLabel=g;return g},updateInfoLabel:function(){var i=this.getViewer();if(i&&this._infoLabel){var h=i.getContextDimension();var g=h?this._infoLabelTemplate.format(Math.round(h.width),Math.round(h.height)):"";Kekule.DomUtils.setElementText(this._infoLabel,g)}},getContextDimension:function(){return this.getViewer().getContextDimension()},setContextDimension:function(k){var g=this.getContextDimension();var h=k.width-g.width;var i=k.height-g.height;var j=this.getDimension();var l={width:j.width+h,height:j.height+i};this.setDimension(l.width,l.height);return this},exportToDataUri:function(h,i){var g=this.getViewer().exportToDataUri(h,i);return g},exportDetails:function(h,i){if(this.getAutoSizeExport()){this.setAutoSize(true)}var j=this.getViewer().getActualDrawOptions();var l=this.getViewer().getContextDimension();var g={dataUri:this.exportToDataUri(h,i),drawOptions:j,drawOptionsJson:JSON.stringify(j),chemObj:this.getChemObj(),chemObjJson:Kekule.IO.saveMimeData(this.getChemObj(),"chemical/x-kekule-json"),autoSize:this.getAutoSizeExport(),autofit:this.getAutofit(),width:Math.round(l.width),height:Math.round(l.height),renderType:this.getRenderType()||Kekule.Render.RendererType.R2D,backgroundColor:this.getBackgroundColor(this.getRenderType()),predefinedSetting:this.getExportViewerPredefinedSetting()};if(this.getAutoSizeExport()){this.setAutoSize(false);var k=this.getViewer().getElement();k.style.width="auto";k.style.height="auto";this.getViewer().resized()}return g},getExportImgElemAttributes:function(h,i){var k=this.exportDetails(h,i);var j="width:"+k.width+"px; height:"+k.height+"px";var g={src:k.dataUri,style:j,width:k.width,height:k.height,"data-kekule-widget":"Kekule.ChemWidget.Viewer","data-render-type":k.renderType,"data-chem-obj":k.chemObjJson,"data-draw-options":k.drawOptionsJson,"data-predefined-setting":k.predefinedSetting};if(Kekule.ObjUtils.notUnset(k.autoSize)){g["data-auto-size"]=k.autoSize}if(Kekule.ObjUtils.notUnset(k.autofit)){g["data-auto-fit"]=k.autofit}if(Kekule.ObjUtils.notUnset(k.backgroundColor)){g["data-background-color"]=k.backgroundColor}return g},createExportImgElement:function(j,h,i){var g=j.createElement("img");var k=this.getExportImgElemAttributes(h,i);Kekule.DomUtils.setElemAttributes(g,k);return g},importChemObjWithDetails:function(h,g){this.setChemObj(h);this.setRenderType(g.renderType||Kekule.Render.RendererType.R2D);if(Kekule.ObjUtils.notUnset(g.autoSize)){this.setAutoSizeExport(!!g.autoSize)}if(Kekule.ObjUtils.notUnset(g.autofit)){this.setAutofit(!!g.autofit)}if(g.width&&g.height&&(!g.autoSize||g.renderType===Kekule.Render.RendererType.R3D)){this.setContextDimension({width:g.width,height:g.height})}if(g.drawOptions){this.getViewer().setDrawOptions(g.drawOptions)}if(g.backgroundColor){this.setBackgroundColor(g.backgroundColor,this.getRenderType())}return this},importFromElemAttribs:function(h){h.width=JsonUtility.parse(h.width);h.height=JsonUtility.parse(h.height);var g=h["data-chem-obj"];var i=g?Kekule.IO.loadMimeData(g,"chemical/x-kekule-json"):null;if(h["data-render-type"]){h.renderType=JsonUtility.parse(h["data-render-type"])}if(h["data-draw-options"]){h.drawOptions=JsonUtility.parse(h["data-draw-options"])}if(h["data-auto-size"]){h.autoSize=JsonUtility.parse(h["data-auto-size"])}if(h["data-autofit"]){h.autofit=JsonUtility.parse(h["data-autofit"])}if(h.backgroundColor){h.backgroundColor=h.backgroundColor}return this.importChemObjWithDetails(i,h)},importFromElem:function(g){var h=Kekule.HtmlElementUtils.getElemPageRect(g);var i=Kekule.DomUtils.fetchAttributeValuesToJson(g);if(!i.width){i.width=h.width}if(!i.height){i.height=h.height}return this.importFromElemAttribs(i)}});Kekule.ChemWidget.ChemObjInserter.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter.Configurator",initialize:function($super,g){this._checkBoxAutoSize=null;this._checkBoxAutofit=null;this._checkBoxShowInfo=null;this._textBoxWidth=null;this._textBoxHeight=null;this._colorPicker=null;$super(g);this.addEventListener("valueChange",function(h){this.saveConfigValues()},this)},initPropValues:function($super){$super();this.setAutoUpdate(true)},doGetWidgetClassName:function($super){return $super()+" "+e.CHEMOBJSETTER_CONFIGURATOR},doCreateSubElements:function(m,k){var l=m.createElement("div");l.className=e.CHEMOBJSETTER_REGION;var j=new Kekule.Widget.CheckBox(this);j.setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOSIZE"));j.addClassName(e.CHEMOBJSETTER_LINE);j.appendToElem(l);this._checkBoxAutoSize=j;var h=m.createElement("span");h.className=b.PART_ASSOC_TEXT_CONTENT;d.setElementText(h,Kekule.$L("ChemWidgetTexts.HINT_AUTOSIZE"));l.appendChild(h);var j=new Kekule.Widget.CheckBox(this);j.setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOFIT"));j.addClassName(e.CHEMOBJSETTER_LINE);j.appendToElem(l);this._checkBoxAutofit=j;var h=m.createElement("span");h.className=b.PART_ASSOC_TEXT_CONTENT;d.setElementText(h,Kekule.$L("ChemWidgetTexts.HINT_AUTOFIT"));l.appendChild(h);k.appendChild(l);var l=m.createElement("div");l.className=e.CHEMOBJSETTER_REGION;var i=m.createElement("label");i.className=e.CHEMOBJSETTER_REGION_LABEL;d.setElementText(i,Kekule.$L("ChemWidgetTexts.CAPTION_LABEL_SIZE"));l.appendChild(i);l.appendChild(m.createElement("br"));var n=new Kekule.Widget.TextBox(this);n.setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_WIDTH"));n.appendToElem(l);this._textBoxWidth=n;var i=m.createElement("span");d.setElementText(i,"×");l.appendChild(i);var n=new Kekule.Widget.TextBox(this);n.setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_HEIGHT"));n.appendToElem(l);this._textBoxHeight=n;var j=new Kekule.Widget.CheckBox(this);j.setText(Kekule.$L("ChemWidgetTexts.CAPTION_SHOWSIZEINFO"));j.appendToElem(l);this._checkBoxShowInfo=j;k.appendChild(l);var l=m.createElement("div");l.className=e.CHEMOBJSETTER_REGION;var i=m.createElement("label");i.className=e.CHEMOBJSETTER_REGION_LABEL;d.setElementText(i,Kekule.$L("ChemWidgetTexts.CAPTION_BACKGROUND_COLOR"));l.appendChild(i);l.appendChild(m.createElement("br"));var g=new Kekule.Widget.ColorPicker(this);g.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT]);g.appendToElem(l);this._colorPicker=g;k.appendChild(l)},loadConfigValues:function($super){$super();var g=this.getWidget();if(g){var i=!g.getIs3D();this._checkBoxAutoSize.setChecked(i&&g.getAutoSizeExport());this._checkBoxAutoSize.setEnabled(i);this._checkBoxAutofit.setChecked(i&&g.getAutofit());this._checkBoxAutofit.setEnabled(i);this._checkBoxShowInfo.setChecked(g.getShowInfo());var j=g.getContextDimension();this._textBoxWidth.setText(Math.round(j.width));this._textBoxHeight.setText(Math.round(j.height));var h=i?g.getBackgroundColor2D():g.getBackgroundColor3D();this._colorPicker.setValue(h||Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT)}},saveConfigValues:function($super){$super();var g=this.getWidget();if(g){var h=!g.getIs3D();if(h){g.setAutoSizeExport(this._checkBoxAutoSize.getChecked());g.setAutofit(this._checkBoxAutofit.getChecked());g.setBackgroundColor2D(this._colorPicker.getValue())}else{g.setBackgroundColor3D(this._colorPicker.getValue())}g.setShowInfo(this._checkBoxShowInfo.getChecked());var i={width:parseInt(this._textBoxWidth.getText()),height:parseInt(this._textBoxHeight.getText())};g.setContextDimension(i);g.invokeEvent("configSave")}}})})();(function(){var b=Kekule;var c=Kekule.CoordMode;var a=Kekule.ArrayUtils;ClassEx.extend(Kekule.ChemObject,{isStandalone:function(){return !this.getIsAttachedToParent()},getStandaloneAncestor:function(){var d=this;while(d.isStandalone&&(!d.isStandalone())&&d.getParent&&d.getParent()){d=d.getParent()}return d},getCascadeDeleteObjs:function(){return[]},cascadeRemove:function(e){var d=this.getParent();if(d&&d.notifyBeforeCascadeRemove){d.notifyBeforeCascadeRemove(this)}if(e){this.finalize()}else{this.removeSelf()}if(d&&d.notifyAfterCascadeRemove){d.notifyAfterCascadeRemove(this)}},notifyBeforeCascadeRemove:function(d,e){},notifyAfterCascadeRemove:function(d,e){if((!this.getKeepEmptyEvenOnCascadeRemove())&&this.isEmpty()){this.cascadeRemove(e)}},isCoordDependent:function(){return false},getCoordDependentObjects:function(){var d=[];if(!this.isCoordDependent()){d.push(this)}return d},getCoordDeterminateObjects:function(){var d=[];if(this.getAttachedMarkers){var g=this.getAttachedMarkers()||[];for(var f=0,e=g.length;f<e;++f){d=d.concat(g[f].getCoordDependentObjects())}}return d},getAllContainingConnectors:function(){return[]},getConstraintManipulationBaseObj:function(){if(this.isAttachedMarker&&this.isAttachedMarker()){var d=this.getParent();if(d instanceof Kekule.StructureFragment){return null}else{return d}}else{return null}},transformAbsCoordByMatrix:function(h,k,g,n,e,q){if(this.getChildCount&&(n||Kekule.ObjUtils.isUnset(n))){for(var j=0,f=this.getChildCount();j<f;++j){var d=this.getChildAt(j);if(d&&d.transformAbsCoordByMatrix){d.transformAbsCoordByMatrix(k,k,g,n,e,true)}}}var p=(g===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix;if(q){if(this.getCoordOfMode&&this.setCoordOfMode){var m=this.getCoordOfMode(g,e);var o=p(m,h);this.setCoordOfMode(o,g)}}else{if(this.getAbsCoordOfMode&&this.setAbsCoordOfMode){var m=this.getAbsCoordOfMode(g,e);var o=p(m,h);this.setAbsCoordOfMode(o,g)}}},scaleSize:function(f,h,m,e){if(this.getSizeOfMode&&this.setSizeOfMode){var n=this.getSizeOfMode(h,e);var k=Kekule.CoordUtils.multiply(n,f);this.setSizeOfMode(k,h)}if(this.getChildCount&&(m||Kekule.ObjUtils.isUnset(m))){for(var j=0,g=this.getChildCount();j<g;++j){var d=this.getChildAt(j);if(d&&d.scaleSize){d.scaleSize(f,h,m,e)}}}}});ClassEx.extendMethod(Kekule.ChemObject,"_attachedMarkerAdded",function(f,e){var d=f(e);if(e){e.setIsAttachedToParent(true)}return d});ClassEx.extendMethod(Kekule.ChemObject,"_attachedMarkerRemoved",function(f,e){var d=f(e);if(e){e.setIsAttachedToParent(false)}return d});ClassEx.defineProps(Kekule.ChemObject,[{name:"keepEmptyEvenOnCascadeRemove",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC},{name:"isAttachedToParent",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}]);ClassEx.extend(Kekule.ChemStructureObject,{getCascadeDeleteObjs:function($super){var d=$super();var j=this.getLinkedConnectors?this.getLinkedConnectors():[];for(var h=0,f=j.length;h<f;++h){var e=j[h];if(e.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(d,e);var g=e.getCascadeDeleteObjs();Kekule.ArrayUtils.pushUnique(d,g)}}return d},isStandalone:function($super){return false},getCoordDeterminateObjects:function($super){var d=$super();var g=this.getLinkedConnectors();for(var h=0,f=g.length;h<f;++h){var e=g[h];a.pushUnique(d,e);a.pushUnique(d,e.getCoordDeterminateObjects())}return d}});ClassEx.extend(Kekule.BaseStructureNode,{getCascadeDeleteObjs:function($super){return $super()},isCoordDependent:function(){return false},move:function(g,f){var e=this.getCoordOfMode(f);var d=Kekule.CoordUtils.add(e,g);this.setCoordOfMode(d,f);return d},move2D:function(d){return this.move(d,c.COORD2D)},move3D:function(d){return this.move(d,c.COORD3D)}});ClassEx.extend(Kekule.BaseStructureConnector,{getCascadeDeleteObjs:function($super){var d=$super();var h=this.getConnectedObjs();for(var f=0,e=h.length;f<e;++f){var g=h[f];if(g instanceof Kekule.BaseStructureNode){if(g.getLinkedConnectors().length<=1){Kekule.ArrayUtils.pushUnique(d,g)}}}return d},isCoordDependent:function(){return true},getCoordDependentObjects:function($super){var d=$super();var h=this.getConnectedObjs();for(var f=0,e=h.length;f<e;++f){var g=h[f];var j;if(g.isExposed){var j=g.isExposed()?g:g.getExposedAncestor()}else{j=g}if(j){a.pushUnique(d,j.getCoordDependentObjects())}}return d},move:function(h,f){for(var e=0,d=this.getConnectedObjCount();e<d;++e){var g=this.getConnectedObjAt(e);if(g.move){g.move(h,f)}}},move2D:function(d){return this.move(d,c.COORD2D)},move3D:function(d){return this.move(d,c.COORD3D)},setAbsBaseCoord:function(f,e){var d=this.getAbsBaseCoord();var g=Kekule.CoordUtils.substract(f,d);this.move(g,e)},setAbsBaseCoord2D:function(d){this.setAbsCoordOfMode(d,Kekule.CoordMode.COORD2D)},setAbsBaseCoord3D:function(d){this.setAbsCoordOfMode(d,Kekule.CoordMode.COORD3D)}});ClassEx.extend(Kekule.ChemStructureNode,{getConstraintManipulationBaseObj:function($super){var d=this.getLinkedObjs();return(d.length===1)?d[0]:$super()}});ClassEx.extend(Kekule.Glyph.PathGlyphNode,{getCascadeDeleteObjs:function($super){var d=[this.getParent()];return d}});ClassEx.extend(Kekule.Glyph.PathGlyphConnector,{getCascadeDeleteObjs:function($super){var d=[this.getParent()];return d}});ClassEx.extend(Kekule.StructureFragment,{isStandalone:function($super){return !this.getCrossConnectors().length},notifyBeforeCascadeRemove:function($super,f,h){var d=this._getObjsNeedToBeCascadeRemoved(f);if(d&&d.length){for(var e=d.length-1;e>=0;--e){var g=d[e];if(h){g.finalize()}else{g.removeSelf()}}}$super(f,h)},getCoordDependentObjects:function($super){if(this.isExpanded&&!this.isExpanded()){return $super()}else{if(!this.hasCtab()){return $super()}else{var d=[];var e=this.getChildCount();for(var f=0;f<e;++f){var g=this.getChildAt(f);a.pushUnique(d,g.getCoordDependentObjects())}return d}}},transformAbsCoordByMatrix:function($super,h,k,g,m,e,n){if(m||Kekule.ObjUtils.isUnset(m)){for(var j=0,f=this.getNodeCount();j<f;++j){var d=this.getNodeAt(j);if(d&&d.transformAbsCoordByMatrix){d.transformAbsCoordByMatrix(k,k,g,m,e,true)}}}$super(h,k,g,false,e,n)}});ClassEx.extend(Kekule.Glyph.Base,{isStandalone:function($super){return $super()}});ClassEx.extend(Kekule.Glyph.PathGlyph,{getCoordDependentObjects:function(){var d=[];var e=this.getNodeCount();for(var f=0;f<e;++f){var g=this.getNodeAt(f);d.push(g)}return d},transformAbsCoordByMatrix:function($super,h,k,g,m,e,n){if(m||Kekule.ObjUtils.isUnset(m)){for(var j=0,f=this.getNodeCount();j<f;++j){var d=this.getNodeAt(j);if(d&&d.transformAbsCoordByMatrix){d.transformAbsCoordByMatrix(k,k,g,m,e,true)}}}$super(h,k,g,false,e,n)}})})();(function(){var a=Kekule.ArrayUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{EDITOR:"K-Chem-Editor",EDITOR_CLIENT:"K-Chem-Editor-Client",EDITOR_UIEVENT_RECEIVER:"K-Chem-Editor-UiEvent-Receiver",EDITOR2D:"K-Chem-Editor2D",EDITOR3D:"K-Chem-Editor3D"});Kekule.ChemWidget.Editor={};Kekule.Editor=Kekule.ChemWidget.Editor;Kekule.Editor.CoordSys=Kekule.Render.CoordSystem;Kekule.Editor.BoxRegion={OUTSIDE:0,CORNER_TL:1,CORNER_TR:2,CORNER_BL:3,CORNER_BR:4,EDGE_TOP:11,EDGE_LEFT:12,EDGE_BOTTOM:13,EDGE_RIGHT:14,INSIDE:20};Kekule.Editor.SelectMode={RECT:0,POLYGON:1,POLYLINE:2,ANCESTOR:10};Kekule.Editor.BaseEditor=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.Editor.BaseEditor",BINDABLE_TAG_NAMES:["div","span"],OBSERVING_GESTURES:["rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout",],initialize:function($super,f,i,h,g){this._objSelectFlag=0;this._objectUpdateFlag=0;this._objectManipulateFlag=0;this._uiMarkerUpdateFlag=0;this._updatedObjectDetails=[];this._operatingObjs=[];this._operatingRenderers=[];this._initialRenderTransformParams=null;this._objChanged=false;this._lengthCaches={};this.setPropStoreFieldValue("enableCreateNewDoc",true);this.setPropStoreFieldValue("enableOperHistory",true);this.setPropStoreFieldValue("enableOperContext",true);this.setPropStoreFieldValue("initOnNewDoc",true);$super(f,i,h);if(!this.getChemObj()&&this.getInitOnNewDoc()&&this.getEnableCreateNewDoc()){this.newDoc()}this.setPropStoreFieldValue("editorConfigs",g||this.createDefaultConfigs());this.setEnableGesture(true)},initProperties:function(){this.defineProp("editorConfigs",{dataType:"Kekule.Editor.BaseEditorConfigs",serializable:false,getter:function(){return this.getDisplayerConfigs()},setter:function(f){return this.setDisplayerConfigs(f)}});this.defineProp("defBondLength",{dataType:DataType.FLOAT,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("defBondLength");if(!f){f=this.getEditorConfigs().getStructureConfigs().getDefBondLength()}return f}});this.defineProp("defBondScreenLength",{dataType:DataType.FLOAT,serializable:false,setter:null,getter:function(){var g=this._lengthCaches.defBondScreenLength;if(g){return g}else{var h=this.getDefBondLength()||0;var f=this.translateDistance(h,Kekule.Render.CoordSystem.CHEM,Kekule.Render.CoordSystem.SCREEN);this._lengthCaches.defBondScreenLength=f;return f}}});this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:false,setter:null,getter:function(){var f=this.getCurrPointerType();return this.getInteractionBoundInflation(f)}});this.defineProp("currPointerType",{dataType:DataType.STRING,serializable:false});this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:false});this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false});this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,getter:function(){var f=this.getPropStoreFieldValue("operHistory");if(!f){f=new Kekule.OperationHistory();this.setPropStoreFieldValue("operHistory",f);f.addEventListener("push",this.reactOperHistoryPush,this);f.addEventListener("pop",this.reactOperHistoryPop,this);f.addEventListener("undo",this.reactOperHistoryUndo,this);f.addEventListener("redo",this.reactOperHistoryRedo,this);f.addEventListener("clear",this.reactOperHistoryClear,this);f.addEventListener("change",this.reactOperHistoryChange,this)}return f},setter:null});this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("selection");if(!f){f=[];this.setPropStoreFieldValue("selection",f)}return f},setter:function(f){this.setPropStoreFieldValue("selection",f);this.selectionChanged()}});this.defineProp("selectMode",{dataType:DataType.INT,getter:function(){var f=this.getPropStoreFieldValue("selectMode");if(Kekule.ObjUtils.isUnset(f)){f=Kekule.Editor.SelectMode.RECT}return f},setter:function(f){if(this.getSelectMode()!==f){this.setPropStoreFieldValue("selectMode",f);this.hideSelectingMarker()}}});this.defineProp("isToggleSelectOn",{dataType:DataType.BOOL});this.defineProp("hotTrackedObjs",{dataType:DataType.ARRAY,serializable:false,setter:function(k){var m=k?Kekule.ArrayUtils.toArray(k):[];if(this.getEditorConfigs()&&this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){this.setPropStoreFieldValue("hotTrackedObjs",m);var j;if(m&&m.length){j=[];for(var g=0,f=m.length;g<f;++g){var h=this.getBoundInfoRecorder().getBound(this.getObjContext(),m[g]);if(j){Kekule.ArrayUtils.pushUnique(j,h)}}}if(j){this.changeHotTrackMarkerBounds(j)}else{if(this.getUiHotTrackMarker().getVisible()){this.hideHotTrackMarker()}}}}});this.defineProp("hotTrackedObj",{dataType:DataType.OBJECT,serializable:false,getter:function(){return this.getHotTrackedObjs()&&this.getHotTrackedObjs()[0]},setter:function(f){this.setHotTrackedObjs(f)}});this.defineProp("enableOperContext",{dataType:DataType.BOOL,setter:function(h){this.setPropStoreFieldValue("enableOperContext",!!h);if(!h){var g=this.getPropStoreFieldValue("operContext");var f=this.getPropStoreFieldValue("drawBridge");if(f&&g){f.releaseContext(g)}}}});this.defineProp("enableGesture",{dataType:DataType.BOOL,setter:function(g){var f=!!g;if(this.getEnableGesture()!==f){this.setPropStoreFieldValue("enableGesture",f);if(f){this.startObservingGestureEvents(this.OBSERVING_GESTURES)}else{this.startObservingGestureEvents(this.OBSERVING_GESTURES)}}}});this.defineProp("uiEventReceiverElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("objContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("operContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("uiContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("objContext",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){return this.getDrawContext()}});this.defineProp("operContext",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){if(!this.getEnableOperContext()){return null}else{var f=this.getPropStoreFieldValue("operContext");if(!f){var i=this.getDrawBridge();if(i){var g=this.getOperContextParentElem();if(!g){return null}else{var h=Kekule.HtmlElementUtils.getElemScrollDimension(g);f=i.createContext(g,h.width,h.height);this.setPropStoreFieldValue("operContext",f)}}}return f}}});this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("uiContext");if(!f){var i=this.getUiDrawBridge();if(i){var g=this.getUiContextParentElem();if(!g){return null}else{var h=Kekule.HtmlElementUtils.getElemScrollDimension(g);f=i.createContext(g,h.width,h.height);this.setPropStoreFieldValue("uiContext",f)}}}return f}});this.defineProp("objDrawBridge",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){return this.getDrawBridge()}});this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("uiDrawBridge");if(!f){f=this.createUiDrawBridge();this.setPropStoreFieldValue("uiDrawBridge",f)}return f}});this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("uiPainter");if(!f){var g=this.getUiMarkers();f=new Kekule.Render.ChemObjPainter(Kekule.Render.RendererType.R2D,g,this.getUiDrawBridge());f.setCanModifyTargetObj(true);this.setPropStoreFieldValue("uiPainter",f);return f}return f}});this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:false,setter:null,getter:function(){var g=this.getUiPainter();if(g){var f=g.getRenderer();if(!f){g.prepareRenderer()}return g.getRenderer()||null}else{return null}}});this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("uiMarkers");if(!f){f=new Kekule.ChemWidget.UiMarkerCollection();this.setPropStoreFieldValue("uiMarkers",f)}return f}});this._defineUiMarkerProp("uiHotTrackMarker");this._defineUiMarkerProp("uiSelectionAreaMarker");this._defineUiMarkerProp("uiSelectingMarker");this.defineProp("uiSelectionAreaContainerBox",{dataType:DataType.Object,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("objRendererMap",{dataType:"Kekule.MapEx",serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("objRendererMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("objRendererMap",f)}return f}});this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:false,setter:null});this.defineProp("zoomCenter",{dataType:DataType.HASH})},_defineUiMarkerProp:function(f,g){return this.defineProp(f,{dataType:"Kekule.ChemWidget.AbstractUIMarker",serializable:false,getter:function(){var h=this.getPropStoreFieldValue(f);if(!h){h=this.createShapeBasedMarker(f,null,null,false)}return h},setter:function(i){if(!g){g=this.getUiMarkers()}var h=this.getPropValue(f);if(h){g.removeMarker(h);h.finalize()}g.addMarker(i);this.setPropStoreFieldValue(f,i)}})},doFinalize:function($super){var j=this.getPropStoreFieldValue("operHistory");if(j){j.finalize();this.setPropStoreFieldValue("operHistory",null)}var g=this.getPropStoreFieldValue("objDrawBridge");var i=this.getPropStoreFieldValue("operContext");if(g&&i){g.releaseContext(i)}this.setPropStoreFieldValue("operContext",null);var g=this.getPropStoreFieldValue("uiDrawBridge");var i=this.getPropStoreFieldValue("uiContext");if(g&&i){g.releaseContext(i)}this.setPropStoreFieldValue("uiDrawBridge",null);this.setPropStoreFieldValue("uiContext",null);var k=this.getPropStoreFieldValue("boundInfoRecorder");if(k){k.finalize()}this.setPropStoreFieldValue("boundInfoRecorder",null);var f=this.getPropStoreFieldValue("objRendererMap");if(f){f.finalize()}this.setPropStoreFieldValue("objRendererMap",null);$super()},createDefaultConfigs:function(){return new Kekule.Editor.BaseEditorConfigs()},doCreateRootElement:function(g){var f=g.createElement("div");return f},doCreateSubElements:function(h,f){var g=h.createElement("div");g.className=e.EDITOR_CLIENT;f.appendChild(g);this._editClientElem=g;return[g]},getCoreElement:function($super){return this._editClientElem||$super()},getEditClientElem:function(){return this._editClientElem},doGetWidgetClassName:function($super){var g=$super()+" "+e.EDITOR;var f=(this.getRenderType()===Kekule.Render.RendererType.R3D)?e.EDITOR3D:e.EDITOR2D;g+=" "+f;return g},doBindElement:function(f){this.createContextParentElems();this.createUiEventReceiverElem()},doGetInitialZoom:function($super){var f;var g=this.getEditorConfigs();if(g){f=g.getInteractionConfigs().getEditorInitialZoom()}if(!f){f=$super()}return f},doSetInitialZoom:function($super,g){var f=this.getEditorConfigs();if(f){f.getInteractionConfigs().setEditorInitialZoom(g)}$super(g)},zoomTo:function($super,k,h,f){var n=Kekule.CoordUtils;var l=this.getCurrZoom();var i=k;var o=$super(k,h);var m=this.getElement();var j={x:m.scrollLeft,y:m.scrollTop};if(!f){f=this.getZoomCenter()}if(!f){f=n.add(j,{x:m.clientWidth/2,y:m.clientHeight/2})}var g=n.multiply(f,i/l-1);m.scrollLeft+=g.x;m.scrollTop+=g.y;return o},zoomIn:function(h,f){var i=this.getCurrZoom();var g=Kekule.ZoomUtils.getNextZoomInRatio(i,h||1);return this.zoomTo(g,null,f)},zoomOut:function(h,f){var i=this.getCurrZoom();var g=Kekule.ZoomUtils.getNextZoomOutRatio(i,h||1);return this.zoomTo(g,null,f)},resetZoom:function(f){return this.zoomTo(this.getInitialZoom()||1,null,f)},changeClientSize:function(j,r,n){this._initialRenderTransformParams=null;var k=this.getCoreElement();var g=k.style;if(!n){n=1}var q=j*n;var p=r*n;if(q){g.width=q+"px"}if(p){g.height=p+"px"}var f=[this.getObjContext(),this.getOperContext(),this.getUiContext()];for(var o=0,m=f.length;o<m;++o){var s=f[o];if(s){this.getDrawBridge().setContextDimension(s,q,p)}}this.repaint()},isDirty:function(){if(this.getEnableOperHistory()){return this.getOperHistory().getCurrIndex()>=0}else{return this._objChanged}},getChemObjSrcInfo:function(f){if(this.isDirty()){return null}else{return f.getSrcInfo?f.getSrcInfo():null}},getActualDrawOptions:function($super){var g=$super();if(this._initialRenderTransformParams){var f=Object.extend({},this._initialRenderTransformParams);f=Object.extend(f,g);return f}else{return g}},repaint:function($super,h){var g=h;var f=$super(g);if(!this._initialRenderTransformParams){this._initialRenderTransformParams=this.getPainter().getActualInitialRenderTransformOptions(this.getObjContext())}this.recalcUiMarkers();return f},newDoc:function(){this.load(this.doCreateNewDocObj())},doCreateNewDocObj:function(){return new Kekule.Molecule()},getExportableClasses:function(){var f=this.getChemObj();if(!f){return[]}else{return f.getClass?f.getClass():null}},exportObj:function(f){return this.exportObjs(f)[0]},exportObjs:function(f){var g=this.getChemObj();if(!f){return[g]}else{return(g&&(g instanceof f))?[g]:[]}},doLoad:function($super,f){this.deselectAll();this._initialRenderTransformParams=null;this.getObjRendererMap().clear();if(this.getOperHistory()){this.getOperHistory().clear()}$super(f);this._objChanged=false},doLoadEnd:function($super,f){$super();if(!f){this._initialRenderTransformParams=null}},doResize:function($super){this._initialRenderTransformParams=null;$super()},geometryOptionChanged:function($super){var f=this.getDrawOptions().zoom;this.zoomChanged(f);this._clearLengthCaches();$super()},zoomChanged:function(f){},_clearLengthCaches:function(){this._lengthCaches={}},chemObjChanged:function($super,g,f){$super(g,f);if(g!==f){if(f){this._uninstallChemObjEventListener(f)}if(g){this._installChemObjEventListener(g)}}},_installChemObjEventListener:function(f){f.addEventListener("change",this.reactChemObjChange,this)},_uninstallChemObjEventListener:function(f){f.removeEventListener("change",this.reactChemObjChange,this)},createUiEventReceiverElem:function(){var g=this.getCoreElement();if(g){var f=g.ownerDocument.createElement("div");f.className=e.EDITOR_UIEVENT_RECEIVER;g.appendChild(f);d.addClass(f,b.DYN_CREATED);this.setPropStoreFieldValue("uiEventReceiverElem",f);return f}},createContextParentElems:function(){var f=this.getCoreElement();if(f){var g=f.ownerDocument;this._createContextParentElem(g,f,"objContextParentElem");this._createContextParentElem(g,f,"operContextParentElem");this._createContextParentElem(g,f,"uiContextParentElem")}},_createContextParentElem:function(i,g,h){var f=i.createElement("div");f.style.position="absolute";f.style.width="100%";f.style.height="100%";f.className=h+" "+b.DYN_CREATED;this.setPropStoreFieldValue(h,f);g.appendChild(f);return f},createNewPainter:function($super,g){var f=$super(g);if(f){f.setCanModifyTargetObj(true);this.installPainterEventHandlers(f);this.createNewBoundInfoRecorder(this.getPainter())}return f},createNewBoundInfoRecorder:function(h){var f=this.getPropStoreFieldValue("boundInfoRecorder");if(f){f.finalize()}var g=new Kekule.Render.BoundInfoRecorder(h);this.setPropStoreFieldValue("boundInfoRecorder",g)},getDrawContextParentElem:function(){return this.getObjContextParentElem()},createUiDrawBridge:function(){var f=Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!f){Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"))}return f},changeContextDimension:function($super,g){var f=$super(g);if(f){this._resizeContext(this.getOperContext(),this.getObjDrawBridge(),g.width,g.height);this._resizeContext(this.getUiContext(),this.getUiDrawBridge(),g.width,g.height)}return f},_resizeContext:function(g,i,h,f){if(g&&i){i.setContextDimension(g,h,f)}},_clearSpecContext:function(f,g){if(g&&f){g.clearContext(f)}},clearObjContext:function(){this._clearSpecContext(this.getObjContext(),this.getDrawBridge());if(this.getBoundInfoRecorder()){this.getBoundInfoRecorder().clear(this.getObjContext())}},clearOperContext:function(){this._clearSpecContext(this.getOperContext(),this.getDrawBridge())},clearUiContext:function(){this._clearSpecContext(this.getUiContext(),this.getUiDrawBridge())},clearContext:function(){this.clearObjContext();if(this._operatingRenderers){this.clearOperContext()}},repaintOperContext:function(g){if(this._operatingRenderers&&this._operatingObjs){this.clearOperContext();var f={partialDrawObjs:this._operatingObjs,doNotClear:true};this.repaint(f)}},getOperatingRenderers:function(){if(!this._operatingRenderers){this._operatingRenderers=[]}return this._operatingRenderers},setOperatingRenderers:function(f){this._operatingRenderers=f},installPainterEventHandlers:function(f){f.addEventListener("prepareDrawing",this.reactChemObjPrepareDrawing,this);f.addEventListener("clear",this.reactChemObjClear,this)},reactChemObjPrepareDrawing:function(o){var h=o.context;var n=o.obj;if(n&&((h===this.getObjContext())||(h===this.getOperContext()))){var m=o.target;this.getObjRendererMap().set(n,m);if(this.getEnableOperContext()){var k=this._operatingObjs||[];var g=false;for(var j=0,f=k.length;j<f;++j){if(this._isChemObjDirectlyRenderedByRenderer(this.getObjContext(),k[j],m)){g=true;break}}if(g){this._setRendererToOperContext(m);a.pushUnique(this.getOperatingRenderers(),m)}}}},reactChemObjClear:function(i){var f=i.context;var h=i.obj;if(h&&((f===this.getObjContext())||(f===this.getOperContext()))){var g=i.target;this.getObjRendererMap().remove(h);a.remove(this.getOperatingRenderers(),g)}},reactChemObjChange:function(g){var f=g.target;var i=g.changedPropNames||[];var h=["id","owner","ownedObjs"];i=Kekule.ArrayUtils.exclude(i,h);if(i.length||!g.changedPropNames){this.objectChanged(f,i)}},reactOperHistoryPush:function(f){this.invokeEvent("operPush",f)},reactOperHistoryPop:function(f){this.invokeEvent("operPop",f)},reactOperHistoryUndo:function(f){this.invokeEvent("operUndo",f)},reactOperHistoryRedo:function(f){this.invokeEvent("operRedo",f)},reactOperHistoryClear:function(f){this.invokeEvent("operHistoryClear",f)},reactOperHistoryChange:function(f){this.invokeEvent("operChange",f)},beginUpdateObject:function(){if(this._objectUpdateFlag>=0){this.invokeEvent("beginUpdateObject")}--this._objectUpdateFlag},endUpdateObject:function(){++this._objectUpdateFlag;if(!this.isUpdatingObject()){if((this._updatedObjectDetails&&this._updatedObjectDetails.length)){this.objectsChanged(this._updatedObjectDetails);this._updatedObjectDetails=[]}this.invokeEvent("endUpdateObject")}},isUpdatingObject:function(){return(this._objectUpdateFlag<0)},_mergeObjUpdatedDetails:function(g,j){for(var h=0,f=j.length;h<f;++h){this._mergeObjUpdatedDetailItem(g,j[h])}},_mergeObjUpdatedDetailItem:function(g,j){for(var h=0,f=g.length;h<f;++h){var k=g[h];if(k.obj===j.obj){if(!k.propNames){k.propNames=[]}if(j.propNames){Kekule.ArrayUtils.pushUnique(k.propNames,j.propNames)}return}}g.push(j)},_logUpdatedDetail:function(f){var g="";f.forEach(function(h){g+="Obj: "+h.obj.getId()+"["+h.obj.getClassName()+"]     ";g+="Props: ["+h.propNames.join(", ")+"]";g+="\n"});console.log(g)},objectChanged:function(i,g){var h={obj:i,propNames:g};var f=this.objectsChanged(h);this.invokeEvent("editObjChanged",Object.extend({},h));return f},objectsChanged:function(h){var f=DataType.isArrayValue(h)?h:[h];if(this.isUpdatingObject()){this._mergeObjUpdatedDetails(this._updatedObjectDetails,f)}else{var g=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(f);this.doObjectsChanged(f,g);this.invokeEvent("editObjsUpdated",{details:Object.extend({},h)})}this._objChanged=true;this.invokeEvent("editObjsChanged",{details:Object.extend({},h)});var j=this.getSelection();if(j&&g){var i=a.intersect(j,g);if(i.length){this.invokeEvent("selectedObjsUpdated",{objs:i})}}},doObjectsChanged:function(m,j){var g=Kekule.ArrayUtils.clone(m);if(!j){j=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(g)}var l=this._getAdditionalRenderRelatedObjs(j);if(l.length){var i=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(l);Kekule.ArrayUtils.pushUnique(g,i)}Kekule.ArrayUtils.pushUnique(j,l);var f=this._operatingRenderers;var h=f&&this._isAllObjsRenderedByRenderers(this.getObjContext(),j,f);var k=this.canModifyPartialGraphic();if(k){this.getRootRenderer().modify(this.getObjContext(),g);this.recalcUiMarkers()}else{if(h){this.repaintOperContext()}else{this.repaint()}}},beginManipulateObject:function(){if(this._objectManipulateFlag>=0){this.invokeEvent("beginManipulateObject")}--this._objectManipulateFlag},endManipulateObject:function(){++this._objectManipulateFlag;if(!this.isManipulatingObject()){this._objectManipulateFlag=0;this.invokeEvent("endManipulateObject")}},isManipulatingObject:function(){return(this._objectManipulateFlag<0)},_needToCanonicalizeBeforeSaving:function(){return true},_getAdditionalRenderRelatedObjs:function(m){var f=[];for(var h=0,g=m.length;h<g;++h){var j=m[h];var k=j.getCoordDeterminateObjects?j.getCoordDeterminateObjects():[];Kekule.ArrayUtils.pushUnique(f,k)}return f},_isAllObjsRenderedByRenderers:function(f,p,q){for(var o=0,g=p.length;o<g;++o){var n=p[o];var s=false;for(var m=0,h=q.length;m<h;++m){var r=q[m];if(r.isChemObjRenderedBySelf(f,n)){s=true;break}}if(!s){return false}}return true},prepareOperatingObjs:function(f){if(this._operatingRenderers&&this._operatingRenderers.length){this.endOperatingObjs(true)}if(this.getEnableOperContext()){this._prepareRenderObjsInOperContext(f);this._operatingObjs=f}this.repaint()},endOperatingObjs:function(f){if(this.getEnableOperContext()){this._endRenderObjsInOperContext();this._operatingObjs=null;if(!f){this.repaint()}}},_isChemObjDirectlyRenderedByRenderer:function(g,i,h){var f=i.getStandaloneAncestor?i.getStandaloneAncestor():i;return h.isChemObjRenderedDirectlyBySelf(g,f)},_getStandaloneRenderObjsInOperContext:function(k){var j=[];for(var g=0,f=k.length;g<f;++g){var h=k[g];if(h.getStandaloneAncestor){h=h.getStandaloneAncestor()}Kekule.ArrayUtils.pushUnique(j,h)}return j},_prepareRenderObjsInOperContext:function(t){var h=[];var f=this.getObjRendererMap();var p=f.getValues();var g=this.getObjContext();var m=this._getStandaloneRenderObjsInOperContext(t);for(var s=0,n=m.length;s<n;++s){var r=m[s];for(var q=0,o=p.length;q<o;++q){var u=p[q];if(u.isChemObjRenderedDirectlyBySelf(g,r)){Kekule.ArrayUtils.pushUnique(h,u)}}}if(h.length>0){for(var s=0,n=h.length;s<n;++s){var u=h[s];this._setRendererToOperContext(u)}this._operatingRenderers=h}else{this._operatingRenderers=null}},_endRenderObjsInOperContext:function(){var g=this._operatingRenderers;if(g&&g.length){for(var h=0,f=g.length;h<f;++h){var j=g[h];this._unsetRendererToOperContext(j)}this.clearOperContext()}this._operatingRenderers=null},_setRendererToOperContext:function(f){f.setRedirectContext(this.getOperContext())},_unsetRendererToOperContext:function(f){f.setRedirectContext(null)},getInteractionBoundInflation:function(g){var f=this._lengthCaches.interactionBoundInflations;var o=g||"default";if(f){if(f[o]){return f[o]}}var h=this.getEditorConfigs().getInteractionConfigs();var q="objBoundTrackInflationRatio";var s,n=h.getPropValue(q);if(g){var i=g.upperFirst();var l=q+i;if(h.hasProperty(l)){s=h.getPropValue(l)}}var m=s||n;var k=m&&this.getDefBondScreenLength()*m;var v="objBoundTrackMinInflation";var j,t=h.getPropValue(v);if(g){var p=v+i;if(h.hasProperty(p)){j=h.getPropValue(p)}}var u=j||t;var r=Math.max(k||0,u);if(!f){f={};this._lengthCaches.interactionBoundInflations=f}f[o]=r;return r},clearBoundMap:function(){this.getBoundInfoRecorder().clear(this.getObjContext())},findTopmostBoundInfo:function(i,h){if(i&&i.length){var f=null;var g=i.length-1;f=i[g];while((g>=0)&&(h&&(h.indexOf(f.obj)>=0))){--g;f=i[g]}return f}else{return null}},getBoundInfosAtCoord:function(g,j,k){var f=this.getBoundInfoRecorder();var m=k||this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation();var l=this.screenCoordToContext(g);var i=(this.getRenderType()===Kekule.Render.RendererType.R3D)?{x:0,y:0}:null;var h=f.getIntersectionInfos(this.getObjContext(),l,i,m,j);return h},getTopmostBoundInfoAtCoord:function(o,n,r){var f=this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest();if(!f){return this.findTopmostBoundInfo(this.getBoundInfosAtCoord(o,null,r),n,r)}var m=Kekule.Render.MetaShapeUtils;var g=this.getBoundInfosAtCoord(o,null,r);var t,j,l;var p=function(i,u,v){t=i;j=u||i.boundInfo;if(Kekule.ObjUtils.notUnset(v)){l=v}else{l=m.getDistance(o,j)}};for(var k=g.length-1;k>=0;--k){var h=g[k];if(n&&(n.indexOf(h.obj)>=0)){continue}if(!t){p(h)}else{var s=h.boundInfo;if(s.shapeType<j.shapeType){p(h,s)}else{if(s.shapeType===j.shapeType){var q=m.getDistance(o,s);if(q<l){p(h,s,q)}}}}}return t},getTopmostBasicObjectAtCoord:function(f,h){var g=this.getTopmostBoundInfoAtCoord(f,null,h);return g?g.obj:null},getChemObjBounds:function(n,m){var i=[];var o=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),n);if(o&&o.length){for(var g=0,f=o.length;g<f;++g){var l=o[g];var h=l.boundInfo;if(h){h=Kekule.Render.MetaShapeUtils.inflateShape(h,m);i.push(h)}}}return i},beginUpdateUiMarkers:function(){--this._uiMarkerUpdateFlag},endUpdateUiMarkers:function(){++this._uiMarkerUpdateFlag;if(!this.isUpdatingUiMarkers()){this.repaintUiMarker()}},isUpdatingUiMarkers:function(){return(this._uiMarkerUpdateFlag<0)},recalcUiMarkers:function(){this.beginUpdateUiMarkers();try{this.recalcHotTrackMarker();this.recalcSelectionAreaMarker()}finally{this.endUpdateUiMarkers()}},repaintUiMarker:function(){if(this.isUpdatingUiMarkers()){return}this.clearUiContext();var f=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),f.baseCoord,f.drawOptions)},createShapeBasedMarker:function(i,h,j,g){var f=new Kekule.ChemWidget.MetaShapeUIMarker();if(h){f.setShapeInfo(h)}if(j){f.setDrawStyles(j)}this.setPropStoreFieldValue(i,f);this.getUiMarkers().addMarker(f);if(g){this.repaintUiMarker()}return f},modifyShapeBasedMarker:function(g,h,j,i){var f=Kekule.Render.ObjectUpdateType.MODIFY;if(h){g.setShapeInfo(h)}if(j){g.setDrawStyles(j)}if(i){this.repaintUiMarker()}},hideUiMarker:function(f,g){f.setVisible(false);if(g){this.repaintUiMarker()}},showUiMarker:function(f,g){f.setVisible(true);if(g){this.repaintUiMarker()}},removeUiMarker:function(f){if(f){this.getUiMarkers().removeMarker(f);this.repaintUiMarker()}},clearUiMarkers:function(){this.getUiMarkers().clearMarkers();this.repaintUiMarker()},changeHotTrackMarkerBounds:function(q){var o=Kekule.ArrayUtils.toArray(q);var g=this.getEditorConfigs().getUiMarkerConfigs();var n={color:g.getHotTrackerColor(),opacity:g.getHotTrackerOpacity()};var r=this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation();var f=[];for(var k=0,h=o.length;k<h;++k){var m=o[k];var j=r?Kekule.Render.MetaShapeUtils.inflateShape(m,r):m;if(j){f.push(j)}}var p=this.getUiHotTrackMarker();p.setVisible(true);this.modifyShapeBasedMarker(p,f,n,true);return this},hideHotTrackMarker:function(){var f=this.getUiHotTrackMarker();if(f){this.hideUiMarker(f,true)}return this},showHotTrackMarker:function(){var f=this.getUiHotTrackMarker();if(f){this.showUiMarker(f,true)}return this},hotTrackOnCoord:function(f){if(this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){this.setHotTrackedObj(this.getTopmostBasicObjectAtCoord(f,this.getCurrBoundInflation()))}return this},hotTrackOnObj:function(f){this.setHotTrackedObj(f);return this},hideHotTrack:function(f){this.hideHotTrackMarker();if(!f){this.clearHotTrackedObjs()}return this},clearHotTrackedObjs:function(){this.setHotTrackedObjs([])},addHotTrackedObj:function(g){var f=this.getHotTrackedObjs()||[];Kekule.ArrayUtils.pushUnique(f,g);this.setHotTrackedObjs(f);return this},recalcHotTrackMarker:function(){this.setHotTrackedObjs(this.getHotTrackedObjs())},changeSelectionAreaMarkerBound:function(i,h){var g=this.getEditorConfigs().getUiMarkerConfigs();if(!h){h={strokeColor:g.getSelectionMarkerStrokeColor(),strokeWidth:g.getSelectionMarkerStrokeWidth(),fillColor:g.getSelectionMarkerFillColor(),opacity:g.getSelectionMarkerOpacity()}}var f=this.getUiSelectionAreaMarker();if(f){f.setVisible(true);this.modifyShapeBasedMarker(f,i,h,true)}return this},hideSelectionAreaMarker:function(){var f=this.getUiSelectionAreaMarker();if(f){this.hideUiMarker(f,true)}},showSelectionAreaMarker:function(){var f=this.getUiSelectionAreaMarker();if(f){this.showUiMarker(f,true)}},recalcSelectionAreaMarker:function(o){this.beginUpdateUiMarkers();try{var v=this.getSelection();var t=v.length;if(t<=0){this.hideSelectionAreaMarker()}else{var f=[];var g=null;var w=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation();for(var r=0;r<t;++r){var q=v[r];var u=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),q);if(u&&u.length){for(var p=0,n=u.length;p<n;++p){var h=u[p];var m=h.boundInfo;if(m){m=Kekule.Render.MetaShapeUtils.inflateShape(m,w);f.push(m);var s=Kekule.Render.MetaShapeUtils.getContainerBox(m);g=g?Kekule.BoxUtils.getContainerBox(g,s):s}}}}this.setUiSelectionAreaContainerBox(g);if(g){var l=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:g.x1,y:g.y1},{x:g.x2,y:g.y2}]);f.push(l)}else{this.hideSelectionAreaMarker()}if(f.length){this.changeSelectionAreaMarkerBound(f)}}}finally{this.endUpdateUiMarkers()}},_highlightSelectionAreaMarker:function(){var g=this.getEditorConfigs().getUiMarkerConfigs();var f={strokeColor:g.getSelectionMarkerStrokeColor(),strokeWidth:g.getSelectionMarkerStrokeWidth(),fillColor:g.getSelectionMarkerFillColor(),opacity:g.getSelectionMarkerEmphasisOpacity()};this.changeSelectionAreaMarkerBound(null,f)},_restoreSelectionAreaMarker:function(){var g=this.getEditorConfigs().getUiMarkerConfigs();var f={strokeColor:g.getSelectionMarkerStrokeColor(),strokeWidth:g.getSelectionMarkerStrokeWidth(),fillColor:g.getSelectionMarkerFillColor(),opacity:g.getSelectionMarkerOpacity()};this.changeSelectionAreaMarkerBound(null,f)},pulseSelectionAreaMarker:function(g,h){if(this.getUiSelectionAreaMarker()){if(!g){g=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseDuration()||0}if(!h){h=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseCount()||1}if(!g){return}var f=g/h;this.doPulseSelectionAreaMarker(f,h)}return this},doPulseSelectionAreaMarker:function(f,g){this._highlightSelectionAreaMarker();setTimeout(this._restoreSelectionAreaMarker.bind(this),f);if(g>1){setTimeout(this.doPulseSelectionAreaMarker.bind(this,f,g-1),f*2)}},startSelecting:function(f,i){if(i===undefined){i=this.getIsToggleSelectOn()}if(!i){this.deselectAll()}var h=Kekule.Editor.SelectMode;var g=this.getSelectMode();this._currSelectMode=g;return(g===h.POLYLINE||g===h.POLYGON)?this.startSelectingCurveDrag(f,i):this.startSelectingBoxDrag(f,i)},addSelectingAnchorCoord:function(f){var h=Kekule.Editor.SelectMode;var g=this._currSelectMode;return(g===h.POLYLINE||g===h.POLYGON)?this.dragSelectingCurveToCoord(f):this.dragSelectingBoxToCoord(f)},endSelecting:function(n,f){if(f===undefined){f=this.getIsToggleSelectOn()}var o=Kekule.Editor.SelectMode;var m=this._currSelectMode;var q=this.getEditorConfigs().getInteractionConfigs().getEnablePartialAreaSelecting();var j;if(m===o.POLYLINE||m===o.POLYGON){var g=this._selectingCurveCoords;var k=this.getEditorConfigs().getInteractionConfigs().getSelectingCurveSimplificationDistanceThreshold();var i=Kekule.GeometryUtils.simplifyCurveToLineSegments(g,k);this.endSelectingCurveDrag(n,f);if(m===o.POLYLINE){var l=this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth();j=this.getObjectsIntersetExtendedPolyline(i,l)}else{j=this.getObjectsInPolygon(i,q);this.endSelectingCurveDrag(n,f)}}else{var p=this._selectingBoxStartCoord;var h=Kekule.BoxUtils.createBox(p,n);j=this.getObjectsInScreenBox(h,q);this.endSelectingBoxDrag(n,f)}j=this._getActualSelectedObjsInSelecting(j);if(f){this.toggleSelectingState(j)}else{this.select(j)}this.hideSelectingMarker()},cancelSelecting:function(){this.hideSelectingMarker()},_getActualSelectedObjsInSelecting:function(f){if(f&&f.length){if(this._isInAncestorSelectMode()){f=this._getAllStandaloneAncestorObjs(f)}return f}else{return[]}},_isInAncestorSelectMode:function(){return this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR},_getAllStandaloneAncestorObjs:function(k){var f=[];for(var h=0,g=k.length;h<g;++h){var j=k[h];if(j&&j.getStandaloneAncestor){j=j.getStandaloneAncestor()}a.pushUnique(f,j)}return f},startSelectingBoxDrag:function(f,g){this._selectingBoxStartCoord=f},dragSelectingBoxToCoord:function(f){var h=this._selectingBoxStartCoord;var g=f;this.changeSelectingMarkerBox(h,g)},endSelectingBoxDrag:function(f,h){var g=this._selectingBoxStartCoord;this._selectingBoxEndCoord=f},startSelectingCurveDrag:function(f,g){this._selectingCurveCoords=[f]},dragSelectingCurveToCoord:function(f){this._selectingCurveCoords.push(f);this.changeSelectingMarkerCurve(this._selectingCurveCoords,this._currSelectMode===Kekule.Editor.SelectMode.POLYGON)},endSelectingCurveDrag:function(f,g){this._selectingCurveCoords.push(f)},selectOnCoord:function(i,h){if(h===undefined){h=this.getIsToggleSelectOn()}var f=this.getTopmostBasicObjectAtCoord(i,this.getCurrBoundInflation());if(f){var g=this._getActualSelectedObjsInSelecting([f]);if(g){if(h){this.toggleSelectingState(g)}else{this.select(g)}}}},changeSelectingMarkerBound:function(i,h){var g=this.getEditorConfigs().getUiMarkerConfigs();if(!h){h={strokeColor:g.getSelectingMarkerStrokeColor(),strokeWidth:g.getSelectingMarkerStrokeWidth(),strokeDash:g.getSelectingMarkerStrokeDash(),fillColor:g.getSelectingMarkerFillColor(),opacity:g.getSelectingMarkerOpacity()}}var f=this.getUiSelectingMarker();f.setVisible(true);this.modifyShapeBasedMarker(f,i,h,true);return this},changeSelectingMarkerCurve:function(m,n){var g=[];for(var j=0,f=m.length-1;j<f;++j){g.push(this.screenCoordToContext(m[j]))}var o=Kekule.Render.MetaShapeUtils.createShapeInfo(n?Kekule.Render.MetaShapeType.POLYGON:Kekule.Render.MetaShapeType.POLYLINE,g);var h;if(!n){var k=this.getEditorConfigs().getUiMarkerConfigs();h={strokeColor:k.getSelectingBrushMarkerStrokeColor(),strokeWidth:this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth(),strokeDash:k.getSelectingBrushMarkerStrokeDash(),lineCap:k.getSelectingBrushMarkerStrokeLineCap(),lineJoin:k.getSelectingBrushMarkerStrokeLineJoin(),opacity:k.getSelectingBrushMarkerOpacity()}}return this.changeSelectingMarkerBound(o,h)},changeSelectingMarkerBox:function(h,f){var i=this.screenCoordToContext(h);var g=this.screenCoordToContext(f);var j=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:Math.min(i.x,g.x),y:Math.min(i.y,g.y)},{x:Math.max(i.x,g.x),y:Math.max(i.y,g.y)}]);return this.changeSelectingMarkerBound(j)},hideSelectingMarker:function(){var f=this.getUiSelectingMarker();if(f){this.hideUiMarker(f,true)}},showSelectingMarker:function(){var f=this.getUiSelectingMarker();if(f){this.showUiMarker(f,true)}},getCoordRegionInSelectionMarker:function(n,t){var i=Kekule.Editor.BoxRegion;var u=Kekule.CoordUtils;var o=this.screenCoordToContext(n);var j=this.getUiSelectionAreaMarker();if(j&&j.getVisible()){var l=this.getUiSelectionAreaContainerBox();if(Kekule.ObjUtils.isUnset(t)){t=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerEdgeInflation()}var h=(t/2)||0;var q=u.substract({x:l.x1,y:l.y1},{x:h,y:h});var p=u.add({x:l.x2,y:l.y2},{x:h,y:h});if((o.x<q.x)||(o.y<q.y)||(o.x>p.x)||(o.y>p.y)){return i.OUTSIDE}var g=u.substract(o,q);var f=u.substract(p,o);var s=g.x;var r=f.x;var m=g.y;var k=f.y;if(m<k){if(s<r){if(m<=t){return(s<=t)?i.CORNER_TL:i.EDGE_TOP}else{if(s<=t){return i.EDGE_LEFT}else{return i.INSIDE}}}else{if(m<=t){return(r<=t)?i.CORNER_TR:i.EDGE_TOP}else{if(r<=t){return i.EDGE_RIGHT}else{return i.INSIDE}}}}else{if(s<r){if(k<=t){return(s<=t)?i.CORNER_BL:i.EDGE_BOTTOM}else{if(s<=t){return i.EDGE_LEFT}else{return i.INSIDE}}}else{if(k<=t){return(r<=t)?i.CORNER_BR:i.EDGE_BOTTOM}else{if(r<=t){return i.EDGE_RIGHT}else{return i.INSIDE}}}}}return i.OUTSIDE},isCoordInSelectionMarkerBound:function(f){return(this.getCoordRegionInSelectionMarker(f)!==Kekule.Editor.BoxRegion.OUTSIDE)},getObjSelectedRenderOptions:function(){return this._selectedRenderOptions},_getObjRenderOptionItemAppendMethod:function(f){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?f.addOverrideRender3DOptionItem:f.addOverrideRenderOptionItem},_getObjRenderOptionItemRemoveMethod:function(f){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?f.removeOverrideRender3DOptionItem:f.removeOverrideRenderOptionItem},_addSelectRenderOptions:function(h){var f=this.getObjSelectedRenderOptions();if(f){var g=this._getObjRenderOptionItemAppendMethod(h);return g.apply(h,[f])}else{return null}},_removeSelectRenderOptions:function(h){var f=this.getObjSelectedRenderOptions();if(f){var g=this._getObjRenderOptionItemRemoveMethod(h);return g.apply(h,[this.getObjSelectedRenderOptions()])}else{return null}},beginUpdateSelection:function(){this.beginUpdateObject();--this._objSelectFlag},endUpdateSelection:function(){++this._objSelectFlag;if(this._objSelectFlag>=0){this.selectionChanged()}this.endUpdateObject()},isUpdatingSelection:function(){return(this._objSelectFlag<0)},selectionChanged:function(){if(!this.isUpdatingSelection()){this.notifyPropSet("selection",this.getSelection());this.invokeEvent("selectionChange");return this.doSelectionChanged()}},doSelectionChanged:function(){this.recalcSelectionAreaMarker()},isInSelection:function(f){return this.getSelection().indexOf(f)>=0},addObjToSelection:function(g){var f=this.getSelection();Kekule.ArrayUtils.pushUnique(f,g.getNearestSelectableObject());this._addSelectRenderOptions(g);this.selectionChanged();return this},removeObjFromSelection:function(k,j){var h=this.getSelection();Kekule.ArrayUtils.remove(h,k);this._removeSelectRenderOptions(k);for(var f=h.length-1;f>=0;--f){var g=h[f];if(g.isChildOf&&g.isChildOf(k)){this.removeObjFromSelection(g,true)}}this.selectionChanged();return this},deselectAll:function(){var f=this.getSelection();return this.removeFromSelection(f)},select:function(f){this.beginUpdateSelection();try{this.deselectAll();this.addToSelection(f)}finally{this.endUpdateSelection()}return this},addToSelection:function(j){if(!j){return}var h=DataType.isArrayValue(j)?j:[j];this.beginUpdateSelection();try{for(var g=0,f=h.length;g<f;++g){this.addObjToSelection(h[g])}}finally{this.endUpdateSelection()}return this},removeFromSelection:function(h){if(!h){return}var g=DataType.isArrayValue(h)?h:[h];this.beginUpdateSelection();try{for(var f=g.length-1;f>=0;--f){this.removeObjFromSelection(g[f])}}finally{this.endUpdateSelection()}return this},toggleSelectingState:function(k){if(!k){return}var j=DataType.isArrayValue(k)?k:[k];this.beginUpdateSelection();try{for(var g=0,f=j.length;g<f;++g){var h=j[g];if(this.isInSelection(h)){this.removeObjFromSelection(h)}else{this.addObjToSelection(h)}}}finally{this.endUpdateSelection()}return this},hasSelection:function(){return !!this.getSelection().length},deleteSelectedObjs:function(){},getObjectsIntersetExtendedPolyline:function(p,n){var f=[];for(var k=0,j=p.length;k<j;++k){f.push(this.screenCoordToContext(p[k]))}var m=[];var h=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext());var g=Kekule.Render.MetaShapeUtils.isIntersectingPolyline;for(var k=0,j=h.length;k<j;++k){var o=h[k];var q=o.boundInfo;if(q){if(g(q,f,n)){m.push(o.obj)}}}return m},getObjectsInPolygon:function(q,j){var f=[];for(var m=0,k=q.length;m<k;++m){f.push(this.screenCoordToContext(q[m]))}var n=[];var h=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext());var g=j?Kekule.Render.MetaShapeUtils.isIntersectingPolygon:Kekule.Render.MetaShapeUtils.isInsidePolygon;for(var m=0,k=h.length;m<k;++m){var o=h[m];var p=o.boundInfo;if(p){if(g(p,f)){n.push(o.obj)}}}return n},getObjectsInScreenBox:function(q,h){var n=this.screenBoxToContext(q);var m=[];var g=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext());var f=h?Kekule.Render.MetaShapeUtils.isIntersectingBox:Kekule.Render.MetaShapeUtils.isInsideBox;for(var k=0,j=g.length;k<j;++k){var o=g[k];var p=o.boundInfo;if(p){if(f(p,n)){m.push(o.obj)}}}return m},selectObjectsInScreenBox:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.select(g)}return g},addObjectsInScreenBoxToSelection:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.addToSelection(g)}return g},removeObjectsInScreenBoxFromSelection:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.removeFromSelection(g)}return g},toggleSelectingStateOfObjectsInScreenBox:function(f,h){var g=this.getObjectsInScreenBox(f,h);if(g&&g.length){this.toggleSelectingState(g)}return g},getObjectsContainerBox:function(x,v){var u=Kekule.ArrayUtils.toArray(x);var h=v||0;var f=[];var g=null;for(var s=0,n=u.length;s<n;++s){var r=u[s];var w=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),r);if(w&&w.length){for(var q=0,p=w.length;q<p;++q){var m=w[q];var o=m.boundInfo;if(o){if(h){o=Kekule.Render.MetaShapeUtils.inflateShape(o,h)}var t=Kekule.Render.MetaShapeUtils.getContainerBox(o);g=g?Kekule.BoxUtils.getContainerBox(g,t):t}}}}return g},getSelectionContainerBox:function(f){return this.getObjectsContainerBox(this.getSelection(),f)},isSelectionVisible:function(){var f=this.getSelectionContainerBox();if(f){var i=this.getClientDimension();var h=this.getClientScrollPosition();var g={x1:h.x,y1:h.y,x2:h.x+i.width,y2:h.y+i.height};return Kekule.BoxUtils.hasIntersection(f,g)}else{return false}},getObjSize:function(f){return this.doGetObjSize(f)},doGetObjSize:function(g){var f=this.getCoordMode();return g.getSizeOfMode?g.getSizeOfMode(f):null},setObjSize:function(g,f){this.doSetObjSize(g,f);this.objectChanged(g)},doSetObjSize:function(g,f){if(g.setSizeOfMode){g.setSizeOfMode(dimension,this.getCoordMode())}},getObjCoord:function(g,f){return this.doGetObjCoord(g,f)},doGetObjCoord:function(l,k){var j=this.getCoordMode();var h=this.getAllowCoordBorrow();var g=l.getAbsBaseCoord?l.getAbsBaseCoord(j,h):l.getAbsCoordOfMode?l.getAbsCoordOfMode(j,h):l.getCoordOfMode?l.getCoordOfMode(j,h):null;if(j===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(k)){var f=Kekule.Render.CoordPos.DEFAULT;if(k!==f){var h=this.getAllowCoordBorrow();var i=l.getExposedContainerBox?l.getExposedContainerBox(j,h):l.getContainerBox?l.getContainerBox(j,h):null;if(i){if(k===Kekule.Render.CoordPos.CORNER_TL){var m={x:(i.x2-i.x1)/2,y:(i.y2-i.y1)/2};g.x=g.x-m.x;g.y=g.y+m.y}}}}return g},setObjCoord:function(g,h,f){this.doSetObjCoord(g,h,f);this.objectChanged(g)},doSetObjCoord:function(j,l,f){var n=Object.create(l);var i=this.getCoordMode();if(i===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(f)){var g=Kekule.Render.CoordPos.DEFAULT;if(f!==g){var h=this.getAllowCoordBorrow();var k=j.getExposedContainerBox?j.getExposedContainerBox(i,h):j.getContainerBox?j.getContainerBox(i,h):null;if(k){var m={x:(k.x2-k.x1)/2,y:(k.y2-k.y1)/2};if(f===Kekule.Render.CoordPos.CORNER_TL){n.x=l.x+m.x;n.y=l.y-m.y}}}}if(j.setAbsBaseCoord){j.setAbsBaseCoord(n,i)}else{if(j.setAbsCoordOfMode){j.setAbsCoordOfMode(n,i)}else{if(j.setAbsCoordOfMode){j.setCoordOfMode(n,i)}}}},getObjectContextCoord:function(g,f){var h=this.getObjCoord(g,f);return this.objCoordToContext(h)},setObjectContextCoord:function(h,f,g){var i=this.contextCoordToObj(f);if(i){this.setObjCoord(h,i,g)}},getObjectScreenCoord:function(g,f){var h=this.getObjCoord(g,f);return this.objCoordToScreen(h)},setObjectScreenCoord:function(h,f,g){var i=this.screenCoordToObj(f);if(i){this.setObjCoord(h,i,g)}},getCoord:function(i,f,h){var g=this.getObjCoord(i,h);return this.translateCoord(g,Kekule.Editor.CoordSys.OBJ,f)},setCoord:function(j,i,f,h){var g=this.translateCoord(i,f,Kekule.Editor.CoordSys.OBJ);this.setObjCoord(j,g,h)},getSize:function(h,f){var g=this.getObjSize(h);return this.translateCoord(g,Kekule.Editor.CoordSys.OBJ,f)},setSize:function(i,g,f){var h=this.translateCoord(g,f,Kekule.Editor.CoordSys.OBJ);this.setObjSize(i,h)},translateCoord:function(j,g,h){if(!j){return null}var i=Kekule.Editor.CoordSys;if(g===i.SCREEN){if(h===i.SCREEN){return j}else{if(h===i.CONTEXT){return this.getObjDrawBridge().transformScreenCoordToContext(this.getObjContext(),j)}else{var f=this.getObjDrawBridge().transformScreenCoordToContext(this.getObjContext(),j);return this.getRootRenderer().transformCoordToObj(this.getObjContext(),this.getChemObj(),f)}}}else{if(g===i.CONTEXT){if(h===i.SCREEN){return this.getObjDrawBridge().transformContextCoordToScreen(this.getObjContext(),j)}else{if(h===i.CONTEXT){return j}else{return this.getRootRenderer().transformCoordToObj(this.getObjContext(),this.getChemObj(),j)}}}else{if(h===i.SCREEN){var f=this.getRootRenderer().transformCoordToContext(this.getObjContext(),this.getChemObj(),j);return this.getObjDrawBridge().transformContextCoordToScreen(this.getObjContext(),f)}else{if(h===i.CONTEXT){return this.getRootRenderer().transformCoordToContext(this.getObjContext(),this.getChemObj(),j)}else{return j}}}}},translateDistance:function(l,f,g){var j={x:0,y:0,z:0};var h={x:l,y:0,z:0};var k=this.translateCoord(j,f,g);var i=this.translateCoord(h,f,g);return Kekule.CoordUtils.getDistance(k,i)},transformCoordAndSizeOfObjects:function(q,p){var k=this.getCoordMode();var h=this.getAllowCoordBorrow();var o=(k===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(p):Kekule.CoordUtils.calcTransform2DMatrix(p);var f=Object.extend({},p);f=Object.extend(f,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});var g=(k===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(f):Kekule.CoordUtils.calcTransform2DMatrix(f);for(var n=0,j=q.length;n<j;++n){var m=q[n];m.transformAbsCoordByMatrix(o,g,k,true,h);m.scaleSize(p.scale,k,true,h)}},objCoordToContext:function(g){var f=Kekule.Editor.CoordSys;return this.translateCoord(g,f.OBJ,f.CONTEXT)},contextCoordToObj:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.CONTEXT,g.OBJ)},objCoordToScreen:function(g){var f=Kekule.Editor.CoordSys;return this.translateCoord(g,f.OBJ,f.SCREEN)},screenCoordToObj:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.SCREEN,g.OBJ)},screenCoordToContext:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.SCREEN,g.CONTEXT)},contextCoordToScreen:function(f){var g=Kekule.Editor.CoordSys;return this.translateCoord(f,g.CONTEXT,g.SCREEN)},screenBoxToContext:function(f){var h=this.screenCoordToContext({x:f.x1,y:f.y1});var g=this.screenCoordToContext({x:f.x2,y:f.y2});return{x1:h.x,y1:h.y,x2:g.x,y2:g.y}},createDefaultNode:function(j,f,g){var i=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId();var h=new Kekule.Atom();h.setIsotopeId(i);if(g){g.appendNode(h)}this.setCoord(h,j,f);return h},operationDone:function(f){this.doOperationDone(f)},doOperationDone:function(f){},clearOperHistory:function(){var f=this.getOperHistory();if(f){f.clear()}},pushOperation:function(f,i){var g=this.getOperHistory();if(g&&f){g.push(f)}if(i){this.beginUpdateObject();try{f.execute()}finally{this.endUpdateObject()}}},popOperation:function(f){var i;var g=this.getOperHistory();if(g){i=g.pop(operation);if(f){this.beginUpdateObject();try{i.reverse()}finally{this.endUpdateObject()}}return i}else{return null}},execOperation:function(f){this.beginUpdateObject();try{f.execute()}finally{this.endUpdateObject()}if(this.getEnableOperHistory()){this.pushOperation(f,false)}return this},undo:function(){var g;var f=this.getOperHistory();if(f){this.beginUpdateObject();try{g=f.undo()}finally{this.endUpdateObject();if(g){this.operationDone(g)}}}return g},redo:function(){var g;var f=this.getOperHistory();if(f){this.beginUpdateObject();try{g=f.redo()}finally{this.endUpdateObject();if(g){this.operationDone(g)}}}return g},undoAll:function(){var g;var f=this.getOperHistory();if(f){this.beginUpdateObject();try{g=f.undoAll()}finally{this.endUpdateObject()}}return g},canUndo:function(){var f=this.getOperHistory();return f?f.canUndo():false},canRedo:function(){var f=this.getOperHistory();return f?f.canRedo():false},modifyObjects:function(f,j,p){var o=Kekule.ArrayUtils.toArray(f);try{var g=new Kekule.MacroOperation();for(var n=0,k=o.length;n<k;++n){var m=o[n];var h=new Kekule.ChemObjOperation.Modify(m,j,this);g.add(h)}g.execute()}finally{if(p&&this.getEnableOperHistory()&&g.getChildCount()){this.pushOperation(g)}}return this},modifyObjectsRenderOptions:function(h,p,o,u){var t=Kekule.ArrayUtils.toArray(h);var g=o?"render3DOptions":"renderOptions";var v=o?"getRender3DOptions":"getRenderOptions";try{var k=new Kekule.MacroOperation();for(var s=0,n=t.length;s<n;++s){var r=t[s];if(r[v]){var j=r[v]();var f=Object.extend({},j);f=Object.extend(f,p);var q={};q[g]=f;var m=new Kekule.ChemObjOperation.Modify(r,q,this);k.add(m)}}k.execute()}finally{if(u&&this.getEnableOperHistory()&&k.getChildCount()){this.pushOperation(k)}}return this},getClientDimension:function(){var f=this.getElement();return{width:f.clientWidth,height:f.clientHeight}},getClientScrollPosition:function(){var f=this.getEditClientElem().parentNode;return f?{x:f.scrollLeft,y:f.scrollTop}:null},scrollClientTo:function(g,h){var f=this.getEditClientElem().parentNode;if(Kekule.ObjUtils.notUnset(g)){f.scrollTop=g}if(Kekule.ObjUtils.notUnset(h)){f.scrollLeft=h}return this},scrollClientToTop:function(){return this.scrollClientTo(0,null)},doBeforeDispatchUiEvent:function($super,g){var f=g.getType();if(["pointerdown","pointermove","pointerup"].indexOf(f)>=0){this.setCurrPointerType(g.pointerType)}return $super(g)}});Kekule.Editor.BaseEditor.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.Editor.BaseEditor.Settings",initProperties:function(){this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getEnableCreateNewDoc()},setter:function(f){this.getEditor().setEnableCreateNewDoc(f)}});this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getInitOnNewDoc()},setter:function(f){this.getEditor().setInitOnNewDoc(f)}});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getEnableOperHistory()},setter:function(f){this.getEditor().setEnableOperHistory(f)}})},getEditor:function(){return this.getDisplayer()}});Kekule.Editor.IaControllerManager={_controllerMap:new Kekule.MapEx(true),register:function(g,f){c._controllerMap.set(g,f)},unregister:function(f){c._controllerMap.remove(f)},getAllControllerClasses:function(){return c._controllerMap.getKeys()},getAvailableControllerClasses:function(g){var f=[];var m=c.getAllControllerClasses();for(var k=0,h=m.length;k<h;++k){var n=m[k];var j=c._controllerMap.get(n);if(!j||ClassEx.isOrIsDescendantOf(g,j)){f.push(n)}}return f}};var c=Kekule.Editor.IaControllerManager;Kekule.Editor.BaseEditorIaController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function($super,f){$super(f)},initProperties:function(){this.defineProp("manuallyHotTrack",{dataType:DataType.BOOL,serializable:false});this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:false,getter:function(){return this.getEditor().getCurrBoundInflation()},setter:null})},getDefId:function(){return Kekule.ClassUtils.getLastClassName(this.getClassName())},getEditor:function(){return this.getWidget()},setEditor:function(f){return this.setWidget(f)},getEditorConfigs:function(){var f=this.getEditor();return f?f.getEditorConfigs():null},getInteractionBoundInflation:function(f){return this.getEditor().getInteractionBoundInflation(f)},handleUiEvent:function($super,i){var g=false;var h=(i.getTarget&&i.getTarget())||i.target;var f=this.getEditor().getUiEventReceiverElem();if(f){if((h===f)||Kekule.DomUtils.isDescendantOf(h,f)){g=true}}else{g=true}if(g){$super(i)}},canInteractWithObj:function(f){return !!f},hotTrackOnObj:function(f){this.getEditor().hotTrackOnObj(f)},zoomEditor:function(g,f){if(g>0){this.getEditor().zoomIn(g,f)}else{if(g<0){this.getEditor().zoomOut(-g,f)}}},_filterBasicObjectsInEditor:function(n){var j=this.getEditor();var k=j.getChemObj();var f=[];for(var h=0,g=n.length;h<g;++h){var m=n[h];if(m.isChildOf(k)){f.push(m)}}return f},doneInsertOrModifyBasicObjects:function(g){if(this.getEditorConfigs().getInteractionConfigs().getAutoSelectNewlyInsertedObjects()){var f=this._filterBasicObjectsInEditor(g);this.getEditor().select(f)}},react_pointerdown:function(f){f.preventDefault();return true},react_pointermove:function(g){var h=this._getEventMouseCoord(g);var f=this.getEditor().getTopmostBasicObjectAtCoord(h,this.getCurrBoundInflation());if(!this.getManuallyHotTrack()){if(f&&this.canInteractWithObj(f)){this.hotTrackOnObj(f)}else{this.hotTrackOnObj(null)}}g.preventDefault();return true},react_mousewheel:function(g){if(g.getCtrlKey()){var f=this._getEventMouseCoord(g);try{var h=g.wheelDeltaY||g.wheelDelta;if(h){h/=120}this.zoomEditor(h,f)}finally{}g.preventDefault();return true}},_getEventMouseCoord:function($super,h,g){var f=g||this.getWidget().getCoreElement();return $super(h,f)}});Kekule.Editor.ClientDragScrollIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ClientDragScrollIaController",initialize:function($super,f){$super(f);this._isExecuting=false},canInteractWithObj:function(f){return false},doTestMouseCursor:function(g,f){return this.isExecuting()?["grabbing","-webkit-grabbing","-moz-grabbing","move"]:["grab","-webkit-grab","-moz-grab","pointer"]},isExecuting:function(){return this._isExecuting},startScroll:function(f){this._startCoord=f;this._originalScrollPos=this.getEditor().getClientScrollPosition();this._isExecuting=true},endScroll:function(){this._isExecuting=false;this._startCoord=null;this._originalScrollPos=null},scrollTo:function(f){if(this.isExecuting()){var h=this._startCoord;var i=Kekule.CoordUtils.substract(h,f);var g=Kekule.CoordUtils.add(this._originalScrollPos,i);this.getEditor().scrollClientTo(g.y,g.x)}},react_pointerdown:function(f){if(f.getButton()===Kekule.X.Event.MouseButton.LEFT){if(!this.isExecuting()){var g={x:f.getScreenX(),y:f.getScreenY()};this.startScroll(g);f.preventDefault()}}else{if(f.getButton()===Kekule.X.Event.MouseButton.RIGHT){if(this.isExecuting()){this.endScroll();f.preventDefault()}}}},react_pointerup:function(f){if(f.getButton()===Kekule.X.Event.MouseButton.LEFT){if(this.isExecuting()){this.endScroll();f.preventDefault()}}},react_pointermove:function($super,f){$super(f);if(this.isExecuting()){var g={x:f.getScreenX(),y:f.getScreenY()};this.scrollTo(g);f.preventDefault()}return true}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.ClientDragScrollIaController,Kekule.Editor.BaseEditor);Kekule.Editor.BasicEraserIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicEraserIaController",initialize:function($super,f){$super(f);this._isExecuting=false},canInteractWithObj:function(f){return !!f},removeObjs:function(g){if(g&&g.length){var f=this.getEditor();f.beginUpdateObject();try{var h=this.doGetActualRemovedObjs(g);this.doRemoveObjs(h)}finally{f.endUpdateObject()}}},doRemoveObjs:function(f){},doGetActualRemovedObjs:function(f){return f},removeSelection:function(){var f=this.getEditor();this.removeObjs(f.getSelection());f.deselectAll()},removeOnScreenCoord:function(g){var f=this.getEditor().getTopmostBasicObjectAtCoord(g);if(f){this.removeObjs([f]);return true}else{return false}},startRemove:function(){this._isExecuting=true},endRemove:function(){this._isExecuting=false},isRemoving:function(){return this._isExecuting},react_pointerdown:function(f){if(f.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.startRemove();var g=this._getEventMouseCoord(f);this.removeOnScreenCoord(g);f.preventDefault()}else{if(f.getButton()===Kekule.X.Event.MOUSE_BTN_RIGHT){this.endRemove();f.preventDefault()}}},react_pointerup:function(f){if(f.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.endRemove();f.preventDefault()}},react_pointermove:function($super,f){$super(f);if(this.isRemoving()){var g=this._getEventMouseCoord(f);this.removeOnScreenCoord(g);f.preventDefault()}return true}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicEraserIaController,Kekule.Editor.BaseEditor);Kekule.Editor.BasicManipulationIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicManipulationIaController",initialize:function($super,f){$super(f);this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL);this.setEnableSelect(false);this.setEnableGestureManipulation(false);this.setEnableMove(true);this.setEnableResize(true);this.setEnableAspectRatioLockedResize(true);this.setEnableRotate(true);this._suppressConstrainedResize=false;this._manipulationStepBuffer={};this._suspendedOperations=null;this.execManipulationStepBind=this.execManipulationStep.bind(this)},initProperties:function(){this.defineProp("selectMode",{dataType:DataType.INT,serializable:false});this.defineProp("enableSelect",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableResize",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableRotate",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableGestureManipulation",{dataType:DataType.BOOL,serializable:false});this.defineProp("state",{dataType:DataType.INT,serializable:false});this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("startCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("endCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("startBox",{dataType:DataType.HASH,serializable:false});this.defineProp("endBox",{dataType:DataType.HASH,serializable:false});this.defineProp("lastRotateAngle",{dataType:DataType.FLOAT,serializable:false});this.defineProp("rotateRefCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("rotateCenter",{dataType:DataType.HASH,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("rotateCenter");if(!f){var g=this._getManipulateObjsCenterCoord();f=this.getEditor().objCoordToScreen(g);this.setPropStoreFieldValue("rotateCenter",f)}return f}});this.defineProp("resizeStartingRegion",{dataType:DataType.INT,serializable:false});this.defineProp("enableAspectRatioLockedResize",{dataType:DataType.BOOL,serializable:false});this.defineProp("rotateStartingRegion",{dataType:DataType.INT,serializable:false});this.defineProp("manipulateOriginObjs",{dataType:DataType.ARRAY,serializable:false});this.defineProp("manipulateObjs",{dataType:DataType.ARRAY,serializable:false,setter:function(f){this.setPropStoreFieldValue("manipulateObjs",f);if(!f){this.getEditor().endOperatingObjs()}else{this.getEditor().prepareOperatingObjs(f)}}});this.defineProp("manipulateObjInfoMap",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("manipulateObjInfoMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("manipulateObjInfoMap",f)}return f}});this.defineProp("manipulateObjCurrInfoMap",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var f=this.getPropStoreFieldValue("manipulateObjCurrInfoMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("manipulateObjCurrInfoMap",f)}return f}});this.defineProp("manipulationType",{dataType:DataType.INT,serializable:false});this.defineProp("isManipulatingSelection",{dataType:DataType.BOOL,serializable:false});this.defineProp("moveOperations",{dataType:DataType.ARRAY,serializable:false});this.defineProp("objOperationMap",{dataType:"Kekule.MapEx",serializable:false,getter:function(){var f=this.getPropStoreFieldValue("objOperationMap");if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue("objOperationMap",f)}return f}})},doFinalize:function($super){var f=this.getPropStoreFieldValue("manipulateObjInfoMap");if(f){f.clear()}f=this.getPropStoreFieldValue("objOperationMap");if(f){f.clear()}$super()},hotTrackOnObj:function($super,g){if(this.getEnableSelect()&&this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR){var f=this.getStandaloneAncestor(g);(g&&g.getStandaloneAncestor)?g.getStandaloneAncestor():g;return $super(f)}else{return $super(g)}},getStandaloneAncestor:function(f){return(f&&f.getStandaloneAncestor)?f.getStandaloneAncestor():f},isInAncestorSelectMode:function(){return this.getEnableSelect()&&(this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR)},isAspectRatioLockedResize:function(){return this.getEnableAspectRatioLockedResize()&&(!this._suppressConstrainedResize)},getCoordOnSelectionRotationRegion:function(o){var k=Kekule.Editor.BoxRegion;var p=this.getEditor();var q=p.getCoordRegionInSelectionMarker(o);if(q!==k.OUTSIDE){return false}var f=p.getEditorConfigs().getInteractionConfigs().getRotationRegionInflation();var m=p.getUiSelectionAreaContainerBox();if(m&&p.hasSelection()){var n=[k.CORNER_TL,k.CORNER_TR,k.CORNER_BR,k.CORNER_BL];var v=[{x:m.x1,y:m.y1},{x:m.x2,y:m.y1},{x:m.x2,y:m.y2},{x:m.x1,y:m.y2}];var w=false;var u=f;for(var j=0,h=n.length;j<h;++j){var t=n[j];var s=v[j];var g=Kekule.CoordUtils.getDistance(s,o);if(g<=u){w=t;u=g}}return w}else{return false}},createManipulateOperation:function(){return this.doCreateManipulateMoveAndResizeOperation()},doCreateManipulateMoveAndResizeOperation:function(){var m=[];this.setMoveOperations(m);var o=this.getManipulateObjs();var g=this.getManipulateObjInfoMap();var h=this.getObjOperationMap();h.clear();for(var n=0,j=o.length;n<j;++n){var k=o[n];var p=g.get(k);var f=new Kekule.ChemObjOperation.MoveAndResize(k,null,null,this.getEditor().getCoordMode(),true,this.getEditor());f.setAllowCoordBorrow(this.getEditor().getAllowCoordBorrow());f.setOldCoord(p.objCoord);f.setOldDimension(p.size);m.push(f)}return m},updateChildMoveOperation:function(h,f,g){var i=this.getMoveOperations()[h];i.setNewCoord(g)},updateChildResizeOperation:function(h,g,f){var i=this.getMoveOperations()[h];i.setNewDimension(f)},getAllObjOperations:function(f){var h=this.getMoveOperations();var g=h?Kekule.ArrayUtils.clone(h):[];return g},getActiveOperation:function(f){var g=this.getAllObjOperations(f);g=Kekule.ArrayUtils.toUnique(g);if(g.length<=0){return null}else{if(g.length===1){return g[0]}else{var h=new Kekule.MacroOperation(g);return h}}},reverseActiveOperation:function(){var f=this.getActiveOperation();return f.reverse()},addOperationToEditor:function(){var f=this.getEditor();if(f&&f.getEnableOperHistory()){var g=this.getActiveOperation(true);if(g){f.pushOperation(g)}}},getCurrAvailableManipulationTypes:function(){var g=Kekule.Editor.BasicManipulationIaController.ManipulationType;var h=this.getEditor().getSelectionContainerBox();if(!h){return[]}else{var f=[];if(this.getEnableMove()){f.push(g.MOVE)}if(!Kekule.NumUtils.isFloatEqual(h.x1,h.x2,1e-10)||!Kekule.NumUtils.isFloatEqual(h.y1,h.y2,1e-10)){if(this.getEnableResize()){f.push(g.RESIZE)}if(this.getEnableRotate()){f.push(g.ROTATE)}if(this.getEnableResize()||this.getEnableRotate()){f.push(g.TRANSFORM)}}return f}},getActualManipulatingObjects:function(k){var f=[];for(var h=0,g=k.length;h<g;++h){var j=k[h];var m=j.getCoordDependentObjects?j.getCoordDependentObjects():[j];Kekule.ArrayUtils.pushUnique(f,m)}return f},doPrepareManipulatingObjects:function(o,m){var n=this.getActualManipulatingObjects(o);this.setManipulateOriginObjs(o);this.setManipulateObjs(n);var f=this.getManipulateObjInfoMap();f.clear();var p=this.getEditor();for(var k=0,h=n.length;k<h;++k){var j=n[k];var g=this.createManipulateObjInfo(j,k,m);f.set(j,g)}},doPrepareManipulatingStartingCoords:function(f,i,h,g){this.setStartBox(i);this.setRotateCenter(h);this.setRotateRefCoord(g);this.setLastRotateAngle(null)},prepareManipulating:function(j,g,f,k,i,h){this.setManipulationType(j);this.doPrepareManipulatingObjects(g,f);this.doPrepareManipulatingStartingCoords(f,k,i,h);this.createManipulateOperation();this._runManipulationStepId=window.requestAnimationFrame(this.execManipulationStepBind)},cancelManipulate:function(){var f=this.getEditor();var g=this.getManipulateObjs();this.reverseActiveOperation();this.notifyCoordChangeOfObjects(this.getManipulateObjs());this.manipulateEnd()},_getManipulateObjsCenterCoord:function(){var o=this.getManipulateObjs();if(!o||!o.length){return null}var m=this.getEditor().getCoordMode();var g=this.getEditor().getAllowCoordBorrow();var k={x:0,y:0,z:0};for(var h=0,f=o.length;h<f;++h){var n=o[h];var j=n.getAbsBaseCoord?n.getAbsBaseCoord(m,g):n.getAbsCoord?n.getAbsCoord(m,g):n.getCoordOfMode?n.getCoordOfMode(m,g):null;if(j){k=Kekule.CoordUtils.add(k,j)}}return Kekule.CoordUtils.divide(k,o.length)},_maniplateObjsFrameEnd:function(f){},_addManipultingObjNewInfo:function(i,g){var f=this.getManipulateObjCurrInfoMap();var h=f.get(i)||{};h=Object.extend(h,g);f.set(i,h)},applyManipulatingObjsInfo:function(n){var m=this.getManipulateObjs();var j=this.getManipulateObjCurrInfoMap();for(var g=0,f=m.length;g<f;++g){var k=m[g];var h=j.get(k);this.applySingleManipulatingObjInfo(g,k,h,n)}},applySingleManipulatingObjInfo:function(i,g,f,h){if(f){if(f.screenCoord){this.doMoveManipulatedObj(i,g,f.screenCoord,h)}if(f.size){this.doResizeManipulatedObj(i,g,f.size)}}},_calcRotateAngle:function(q){var g=Kekule.CoordUtils;var j;var k=false;var n=this.getRotateCenter();var p=this.getRotateRefCoord()||this.getStartCoord();var l=this.getEditorConfigs().getInteractionConfigs().getRotationLocationPointDistanceThreshold();if(l){var f=g.getDistance(p,n);if(f<l){j=0;k=true;this.setStartCoord(q);return false}var o=g.getDistance(q,n);if(o<l){j=0;k=true;return false}}if(!k){var i=g.substract(q,n);var h=Math.atan2(i.y,i.x);i=g.substract(p,n);var m=Math.atan2(i.y,i.x);j=h-m}return{angle:j,startAngle:m,endAngle:h}},_calcActualRotateAngle:function(i,h,f,g){return h},_calcManipulateObjsRotationParams:function(g,k){if(!this.getEnableRotate()){return false}var i=this.getRotateCenter();var h=this._calcRotateAngle(k);if(!h){return false}var j=this._calcActualRotateAngle(g,h.angle,h.startAngle,h.endAngle);var f=this.getLastRotateAngle();if(Kekule.ObjUtils.notUnset(f)&&Kekule.NumUtils.isFloatEqual(j,f,0.0175)){return false}this.setLastRotateAngle(j);return{center:i,rotateAngle:j}},_calcActualResizeScales:function(f,g){return g},_calcManipulateObjsResizeParams:function(f,g,q){if(!this.getEnableResize()){return false}var h=Kekule.Editor.BoxRegion;var o=Kekule.CoordUtils;var k=this.getStartBox();var r=o.substract(q,this.getStartCoord());var l;var i,t,s;if(g===h.EDGE_TOP){r.x=0;l={x:(k.x1+k.x2)/2,y:k.y2}}else{if(g===h.EDGE_BOTTOM){r.x=0;l={x:(k.x1+k.x2)/2,y:k.y1}}else{if(g===h.EDGE_LEFT){r.y=0;l={x:k.x2,y:(k.y1+k.y2)/2}}else{if(g===h.EDGE_RIGHT){r.y=0;l={x:k.x1,y:(k.y1+k.y2)/2}}else{if(this.isAspectRatioLockedResize()){i=true}l=(g===h.CORNER_TL)?{x:k.x2,y:k.y2}:(g===h.CORNER_TR)?{x:k.x1,y:k.y2}:(g===h.CORNER_BL)?{x:k.x2,y:k.y1}:{x:k.x1,y:k.y1}}}}}var n=(g===h.CORNER_TL)||(g===h.CORNER_BL)||(g===h.EDGE_LEFT);var m=(g===h.CORNER_TL)||(g===h.CORNER_TR)||(g===h.EDGE_TOP);var v,u;if(Kekule.NumUtils.isFloatEqual(k.x1,k.x2,1e-10)){v=1}else{v=1+r.x/(k.x2-k.x1)*(n?-1:1)}if(Kekule.NumUtils.isFloatEqual(k.y1,k.y2,1e-10)){u=1}else{u=1+r.y/(k.y2-k.y1)*(m?-1:1)}if(i){var x=Math.abs(v),w=Math.abs(u);if(x>=w){u=(Math.sign(u)||1)*x}else{v=(Math.sign(v)||1)*w}}var p=this._calcActualResizeScales(f,{scaleX:v,scaleY:u});var j={center:l,scaleX:p.scaleX,scaleY:p.scaleY};return j},_calcManipulateObjsTransformInfo:function(o,u){var f=Kekule.CoordUtils;var v=false;var j=v?f.calcTransform3DMatrix(u):f.calcTransform2DMatrix(u);var t=u.scaleX||u.scale;var r=u.scaleY||u.scale;for(var m=0,h=o.length;m<h;++m){var k=o[m];var g=this.getManipulateObjInfoMap().get(k);var q={};if(!g.hasNoCoord){var p=g.screenCoord;var s=f.transform2DByMatrix(p,j);q.screenCoord=s}if(g.size&&(t||r)){var n={x:g.size.x*Math.abs(t||1),y:g.size.y*Math.abs(r||1)};q.size=n}this._addManipultingObjNewInfo(k,q)}return true},doTransformManipulatedObjs:function(f,m,h){var i=Kekule.Editor.BasicManipulationIaController.ManipulationType;var k=this.getEditor();var j=this.getManipulateObjs();var l=h;if(!l){if(f===i.RESIZE){l=this._calcManipulateObjsResizeParams(j,this.getResizeStartingRegion(),m)}else{if(f===i.ROTATE){l=this._calcManipulateObjsRotationParams(j,m)}}}var n=l&&this._calcManipulateObjsTransformInfo(j,l);if(!n){return}k.beginUpdateObject();var g=this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(m);this._maniplateObjsFrameEnd(j);this.notifyCoordChangeOfObjects(j)}finally{k.endUpdateObject();this.manipulateStepDone()}},_calcActualMovedScreenCoord:function(h,g,f){return f},_calcManipulateObjsMoveInfo:function(o,p){var f=Kekule.CoordUtils;var h=this.getManipulateObjCurrInfoMap();for(var m=0,j=o.length;m<j;++m){var k=o[m];var g=this.getManipulateObjInfoMap().get(k);if(g.hasNoCoord){continue}var n=f.add(p,g.screenCoordOffset);n=this._calcActualMovedScreenCoord(k,g,n);this._addManipultingObjNewInfo(k,{screenCoord:n})}},moveManipulatedObjs:function(k){var j=Kekule.CoordUtils;var g=this.getEditor();var i=this.getManipulateObjs();var f=[];this._calcManipulateObjsMoveInfo(i,k);g.beginUpdateObject();var h=this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(k);this._maniplateObjsFrameEnd(i);this.notifyCoordChangeOfObjects(i)}finally{g.endUpdateObject();this.manipulateStepDone()}},doMoveManipulatedObj:function(j,i,g,f){var h=this.getEditor();this.updateChildMoveOperation(j,i,h.screenCoordToObj(g));h.setObjectScreenCoord(i,g)},doResizeManipulatedObj:function(h,g,f){this.updateChildResizeOperation(h,g,f);if(g.setSizeOfMode){g.setSizeOfMode(f,this.getEditor().getCoordMode())}},startDirectManipulate:function(k,i,f,l,h,g){var j=Kekule.ArrayUtils.toArray(i);this.setState(Kekule.Editor.BasicManipulationIaController.State.MANIPULATING);this.setBaseCoord(f);this.setStartCoord(f);this.setRotateRefCoord(g);this.setIsManipulatingSelection(false);this.prepareManipulating(k||Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE,j,f,l,h,g)},manipulateStepDone:function(){},manipulateEnd:function(){if(this._runManipulationStepId){window.cancelAnimationFrame(this._runManipulationStepId);this._runManipulationStepId=null}var f=this.getEditor();f.endManipulateObject()},stopManipulate:function(){this.setManipulateObjs(null);this.getManipulateObjInfoMap().clear();this.getObjOperationMap().clear();this.manipulateEnd()},refreshManipulateObjs:function(){this.setManipulateObjs(this.getManipulateObjs())},createManipulateObjInfo:function(i,j,f){var g=this.getEditor();var h={objCoord:g.getObjCoord(i),screenCoord:g.getObjectScreenCoord(i),size:g.getObjSize(i)};h.hasNoCoord=!h.objCoord;if(!h.hasNoCoord&&f){h.screenCoordOffset=Kekule.CoordUtils.substract(h.screenCoord,f)}return h},notifyCoordChangeOfObjects:function(q){var f=[];var r=this.getEditor();var n=this.getEditor().getCoordMode()===Kekule.CoordMode.COORD3D?"coord3D":"coord2D";for(var p=0,g=q.length;p<g;++p){var o=q[p];Kekule.ArrayUtils.pushUnique(f,{obj:o,propNames:[n]});var s=o.getCoordDeterminateObjects?o.getCoordDeterminateObjects():[o];for(var m=0,h=s.length;m<h;++m){Kekule.ArrayUtils.pushUnique(f,{obj:s[m],propNames:[n]})}}r.objectsChanged(f)},canInteractWithObj:function(f){return(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL)&&f},doTestMouseCursor:function(h,i){var n="";var j=this._getEventMouseCoord(i,this.getEditor().getEditClientElem());if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL){var g=Kekule.Editor.BoxRegion;var l=this.getEditor().getCoordRegionInSelectionMarker(j);var n;if(this.getEnableSelect()){var f=Kekule.Editor.BasicManipulationIaController.ManipulationType;var m=this.getCurrAvailableManipulationTypes();if(m.indexOf(f.MOVE)>=0){n=(l===g.INSIDE)?"move":""}if(!n&&(m.indexOf(f.RESIZE)>=0)){var n=(l===g.CORNER_TL)?"nwse-resize":(l===g.CORNER_TR)?"nesw-resize":(l===g.CORNER_BL)?"nesw-resize":(l===g.CORNER_BR)?"nwse-resize":(l===g.EDGE_TOP)||(l===g.EDGE_BOTTOM)?"ns-resize":(l===g.EDGE_LEFT)||(l===g.EDGE_RIGHT)?"ew-resize":""}if(!n){if(m.indexOf(f.ROTATE)>=0){var l=this.getCoordOnSelectionRotationRegion(j);if(!!l){var k=Kekule.Widget.StyleResourceNames;n=(l===g.CORNER_TL)?k.CURSOR_ROTATE_NW:(l===g.CORNER_TR)?k.CURSOR_ROTATE_NE:(l===g.CORNER_BL)?k.CURSOR_ROTATE_SW:(l===g.CORNER_BR)?k.CURSOR_ROTATE_SE:k.CURSOR_ROTATE}}}}}return n},setSuspendedOperations:function(g,f,i){var h=this;this._suspendedOperations={immediate:g,delayed:f,delayExecId:setTimeout(this.execSuspendedDelayOperation.bind(this),i)};return this._suspendedOperations},execSuspendedImmediateOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var f=this._suspendedOperations.immediate;this._suspendedOperations=null;return f.apply(this)}},execSuspendedDelayOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var f=this._suspendedOperations.delayed;this._suspendedOperations=null;return f.apply(this)}},haltSuspendedOperations:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);this._suspendedOperations=null}},_startNewSelecting:function(f,g){if(this.getEnableSelect()){this.getEditor().startSelecting(f,g||this.getEditor().getIsToggleSelectOn());this.setState(Kekule.Editor.BasicManipulationIaController.State.SELECTING)}},_startOffSelectionManipulation:function(f){this.beginManipulation(f,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE);this.getEditor().pulseSelectionAreaMarker()},beginManipulation:function(f,u,t){var k=Kekule.Editor.BasicManipulationIaController.State;var h=Kekule.Editor.BasicManipulationIaController.ManipulationType;var p=this.getCurrAvailableManipulationTypes();var o=u&&u.pointerType==="touch";var g=this.getEditor();g.beginManipulateObject();this.setBaseCoord(f);this.setStartCoord(f);var w=f&&this.getEditor().getCoordRegionInSelectionMarker(f);var l=Kekule.Editor.BoxRegion;var q=f&&this.getCoordOnSelectionRotationRegion(f);var m=(p.indexOf(h.TRANSFORM)>=0)&&(t===h.TRANSFORM);if(!m){var n=!o&&(p.indexOf(h.RESIZE)>=0)&&((t===h.RESIZE)||((w!==l.INSIDE)&&(w!==l.OUTSIDE)));var s=!n&&(p.indexOf(h.MOVE)>=0)&&((t===h.MOVE)||(w!==l.OUTSIDE));var j=!o&&!n&&!s&&(p.indexOf(h.ROTATE)>=0)&&((t===h.ROTATE)||!!q)}else{this._availTransformTypes=p}if(m){this.setState(k.MANIPULATING);this.setIsManipulatingSelection(true);this.setResizeStartingRegion(w);this.setRotateStartingRegion(q);this.prepareManipulating(h.TRANSFORM,this.getEditor().getSelection(),f,this.getEditor().getSelectionContainerBox())}else{if(n){this.setState(k.MANIPULATING);this.setIsManipulatingSelection(true);this.setResizeStartingRegion(w);this.prepareManipulating(h.RESIZE,this.getEditor().getSelection(),f,this.getEditor().getSelectionContainerBox())}else{if(s){this.setState(k.MANIPULATING);this.setIsManipulatingSelection(true);this.prepareManipulating(h.MOVE,this.getEditor().getSelection(),f)}else{if(j){this.setState(k.MANIPULATING);this.setIsManipulatingSelection(true);this.setRotateStartingRegion(q);this.prepareManipulating(h.ROTATE,this.getEditor().getSelection(),f,this.getEditor().getSelectionContainerBox())}else{var r=this.getEditor().getTopmostBasicObjectAtCoord(f,this.getCurrBoundInflation());if(r){r=r.getNearestSelectableObject();if(this.isInAncestorSelectMode()){r=this.getStandaloneAncestor(r)}if(this.getEnableMove()){this.startDirectManipulate(null,r,f)}}else{if(this.getEnableMove()&&this.getEnableSelect()&&this.getEditorConfigs().getInteractionConfigs().getEnableOffSelectionManipulation()&&this.getEditor().hasSelection()&&this.getEditor().isSelectionVisible()){this.setState(k.SUSPENDING);var v=this.getEditorConfigs().getInteractionConfigs().getOffSelectionManipulationActivatingTimeThreshold();var i=u&&u.getShiftKey();this.setSuspendedOperations(this._startNewSelecting.bind(this,f,i),this._startOffSelectionManipulation.bind(this,f),v)}else{if(this.getEnableSelect()){var i=u&&u.getShiftKey();this._startNewSelecting(f,i)}}}}}}}},execManipulationStep:function(f){if(this.getState()!==Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){return false}var g=this._manipulationStepBuffer.coord;var h=this._manipulationStepBuffer.event;var i=this._manipulationStepBuffer.explicitTransformParams;if(g&&h){this.doExecManipulationStep(g,h,this._manipulationStepBuffer)}else{if(i){this.doExecManipulationStepWithExplicitTransformParams(i,this._manipulationStepBuffer)}}this._manipulationStepBuffer.coord=null;this._manipulationStepBuffer.event=null;this._manipulationStepBuffer.explicitTransformParams=null;this._runManipulationStepId=window.requestAnimationFrame(this.execManipulationStepBind)},doExecManipulationStep:function(h,i,k){var f=Kekule.Editor.BasicManipulationIaController.ManipulationType;var j=this.getManipulationType();var g=this.getEditor();g.beginUpdateObject();try{this._isBusy=true;if(j===f.MOVE){this.moveManipulatedObjs(h)}else{if(j===f.RESIZE){this._suppressConstrainedResize=i.getAltKey();this.doTransformManipulatedObjs(j,h)}else{if(j===f.ROTATE){this.doTransformManipulatedObjs(j,h)}}}}finally{g.endUpdateObject();this._isBusy=false}},doExecManipulationStepWithExplicitTransformParams:function(j,i){var f=Kekule.Editor.BasicManipulationIaController.ManipulationType;var h=this.getManipulationType();if(h===f.TRANSFORM){var g=this.getEditor();g.beginUpdateObject();try{this._isBusy=true;this.doTransformManipulatedObjs(h,null,j)}finally{g.endUpdateObject();this._isBusy=false}}},updateManipulationStepBuffer:function(f,g){Object.extend(f,g)},react_pointermove:function($super,l){$super(l);if(this._isBusy){return true}var j=Kekule.Editor.BasicManipulationIaController.State;var i=Kekule.Editor.BasicManipulationIaController.ManipulationType;var k=this._getEventMouseCoord(l);var g;if(this._lastMouseMoveCoord){var h=Kekule.CoordUtils.getDistance(k,this._lastMouseMoveCoord);g=h;if(h<2){return true}}this._lastMouseMoveCoord=k;if(this.getState()===j.SUSPENDING){var m=this.getEditorConfigs().getInteractionConfigs().getUnmovePointerDistanceThreshold()||0;if(Kekule.ObjUtils.notUnset(g)&&(g>m)){this.execSuspendedImmediateOperation()}}var f=this.getState();if(f===j.SELECTING){if(this.getEnableSelect()){this.getEditor().addSelectingAnchorCoord(k)}l.preventDefault()}else{if(f===j.MANIPULATING){this.updateManipulationStepBuffer(this._manipulationStepBuffer,{coord:k,event:l});l.preventDefault()}}return true},react_pointerdown:function($super,g){$super(g);var f=Kekule.Editor.BasicManipulationIaController.State;if(g.getButton()===Kekule.X.Event.MouseButton.LEFT){this._lastMouseMoveCoord=null;var h=this._getEventMouseCoord(g);if((this.getState()===f.NORMAL)){this.beginManipulation(h,g);g.preventDefault()}}else{if(g.getButton()===Kekule.X.Event.MouseButton.RIGHT){if(this.getState()===f.MANIPULATING){this.cancelManipulate();this.setState(f.NORMAL);g.stopPropagation();g.preventDefault()}else{if(this.getState()===f.SUSPENDING){this.haltSuspendedOperations()}}}}return true},react_pointerup:function(l){if(l.getButton()===Kekule.X.Event.MouseButton.LEFT){var m=this._getEventMouseCoord(l);this.setEndCoord(m);var i=this.getStartCoord();var f=m;var k=l.getShiftKey();var g=Kekule.Editor.BasicManipulationIaController.State;if(this.getState()===g.SUSPENDING){this.execSuspendedImmediateOperation()}var j=this.getState();if(j===g.SELECTING){this.getEditor().endSelecting(m,k||this.getEditor().getIsToggleSelectOn());this.setState(g.NORMAL);l.preventDefault();var h=this.getEditor();h.endManipulateObject()}else{if(j===g.MANIPULATING){if(Kekule.CoordUtils.isEqual(i,f)){if(this.getEnableSelect()){this.getEditor().selectOnCoord(i,k||this.getEditor().getIsToggleSelectOn())}}else{this.addOperationToEditor()}this.stopManipulate();this.setState(g.NORMAL);l.preventDefault()}}}return true},react_mousewheel:function($super,g){if(g.getCtrlKey()){var f=this.getState();if(f===Kekule.Editor.BasicManipulationIaController.State.NORMAL){return $super(g)}g.preventDefault()}},_isGestureManipulationEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureManipulation()},_isGestureZoomOnEditorEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureZoomOnEditor()},_isInGestureManipulation:function(){return !!this._initialGestureTransformParams},_isGestureZoomOnEditor:function(){return !!this._initialGestureZoomLevel},beginGestureTransform:function(f){if(this.getEditor().hasSelection()){this._initialGestureZoomLevel=null;if(this._isGestureManipulationEnabled()){this.haltSuspendedOperations();this._initialGestureTransformParams={angle:(f.rotation*Math.PI/180)||0};if(this.getState()!==Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){this.beginManipulation(null,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM)}else{if(this.getManipulationType()!==Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM){this.setManipulationType(Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM)}}}else{this._initialGestureTransformParams=null}}else{if(this._isGestureZoomOnEditorEnabled()){this.getEditor().cancelSelecting();this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL);this._initialGestureZoomLevel=this.getEditor().getZoom()}}},endGestureTransform:function(){if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){if(this._isInGestureManipulation()){this.addOperationToEditor();this.stopManipulate();this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL);this._initialGestureTransformParams=null}}if(this._isGestureZoomOnEditor()){this._initialGestureZoomLevel=null}},doGestureTransformStep:function(n){var j=Kekule.Editor.BasicManipulationIaController.ManipulationType;if((this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING)&&(this.getManipulationType()===j.TRANSFORM)&&(this._isInGestureManipulation())){var l=this._availTransformTypes||[];var g=this.getRotateCenter();var o,k;if(l.indexOf(j.RESIZE)>=0){var h=n.scale;o=this._calcActualResizeScales(this.getManipulateObjs(),{scaleX:h,scaleY:h})}else{o={scaleX:1,scaleY:1}}if(l.indexOf(j.ROTATE)>=0){var f=n.rotation*Math.PI/180;var k=f-this._initialGestureTransformParams.angle;k=this._calcActualRotateAngle(this.getManipulateObjs(),k,this._initialGestureTransformParams.angle,f)}else{k=0}this.updateManipulationStepBuffer(this._manipulationStepBuffer,{explicitTransformParams:{center:g,scaleX:o.scaleX,scaleY:o.scaleY,rotateAngle:k}});n.preventDefault()}else{if(this._isGestureZoomOnEditor()){var m=this.getEditor();var h=n.scale;var i=this._initialGestureZoomLevel;m.zoomTo(i*h,null,n.center)}}},react_rotatestart:function(f){if(this.getEnableGestureManipulation()){this.beginGestureTransform(f)}},react_rotate:function(f){if(this.getEnableGestureManipulation()){this.doGestureTransformStep(f)}},react_rotateend:function(f){if(this.getEnableGestureManipulation()){this.endGestureTransform()}},react_rotatecancel:function(f){if(this.getEnableGestureManipulation()){this.endGestureTransform()}},react_pinchstart:function(f){if(this.getEnableGestureManipulation()){this.beginGestureTransform(f)}},react_pinchmove:function(f){if(this.getEnableGestureManipulation()){this.doGestureTransformStep(f)}},react_pinchend:function(f){if(this.getEnableGestureManipulation()){this.endGestureTransform()}},react_pinchcancel:function(f){if(this.getEnableGestureManipulation()){this.endGestureTransform()}}});Kekule.Editor.BasicManipulationIaController.State={NORMAL:0,SELECTING:1,MANIPULATING:2,SUSPENDING:11};Kekule.Editor.BasicManipulationIaController.ManipulationType={MOVE:0,ROTATE:1,RESIZE:2,TRANSFORM:4};Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicManipulationIaController,Kekule.Editor.BaseEditor)})();(function(){Kekule.ChemObjOperation={};Kekule.ChemObjOperation.Base=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemObjOperation.Base",initialize:function($super,b,a){$super();this.setTarget(b);if(a){this.setEditor(a)}},initProperties:function(){this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL});this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false})},notifyBeforeAddingByEditor:function(c,b,a){if(c.beforeAddingByEditor){c.beforeAddingByEditor(b,a)}},notifyBeforeRemovingByEditor:function(b,a){if(b.beforeRemovingByEditor){b.beforeRemovingByEditor(a)}},notifyBeforeModifyingByEditor:function(b,a){if(b.beforeModifyingByEditor){b.beforeModifyingByEditor(a)}},notifyAfterAddingByEditor:function(c,b,a){if(c.afterAddingByEditor){c.afterAddingByEditor(b,a)}},notifyAfterRemovingByEditor:function(b,a){if(b.afterRemovingByEditor){b.afterRemovingByEditor(a)}},notifyAfterModifyingByEditor:function(b,a){if(b.afterModifyingByEditor){b.afterModifyingByEditor(a)}}});Kekule.ChemObjOperation.Modify=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Modify",initialize:function($super,c,b,a){$super(c,a);if(b){this.setNewPropValues(b)}},initProperties:function(){this.defineProp("newPropValues",{dataType:DataType.HASH});this.defineProp("oldPropValues",{dataType:DataType.HASH})},doExecute:function(){var a={};var d=this.getNewPropValues();var c=this.getTarget();c.beginUpdate();try{this.notifyBeforeModifyingByEditor(c,d);for(var e in d){var b=d[e];a[e]=c.getPropValue(e);c.setPropValue(e,b)}this.notifyAfterModifyingByEditor(c,d)}finally{c.endUpdate()}this.setOldPropValues(a)},doReverse:function(){var c=this.getOldPropValues();var b=this.getTarget();b.beginUpdate();try{this.notifyBeforeModifyingByEditor(b,c);for(var d in c){var a=c[d];b.setPropValue(d,a)}this.notifyAfterModifyingByEditor(b,c)}finally{b.endUpdate()}}});Kekule.ChemObjOperation.MoveTo=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveTo",initialize:function($super,e,a,c,d,b){$super(e,b);if(a){this.setNewCoord(a)}this.setCoordMode(c||Kekule.CoordMode.COORD2D);this.setUseAbsBaseCoord(!!d)},initProperties:function(){this.defineProp("newCoord",{dataType:DataType.HASH});this.defineProp("oldCoord",{dataType:DataType.HASH});this.defineProp("coordMode",{dataType:DataType.INT});this.defineProp("useAbsBaseCoord",{dataType:DataType.BOOL})},setObjCoord:function(c,e,b){if(c&&e&&b){var d=false;if(this.getUseAbsBaseCoord()){if(c.setAbsBaseCoord){c.setAbsBaseCoord(e,b,this.getAllowCoordBorrow());d=true}}else{if(c.setCoordOfMode){c.setCoordOfMode(e,b);d=true}}if(!d){var a=c.getClassName?c.getClassName():(typeof c);Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_COORD_OF_CLASS").format(a))}}},getObjCoord:function(b,a){if(this.getUseAbsBaseCoord()){if(b.getAbsBaseCoord){return b.getAbsBaseCoord(a,this.getAllowCoordBorrow())}}else{if(b.getCoordOfMode){return b.getCoordOfMode(a,this.getAllowCoordBorrow())}}return null},doExecute:function(){var a=this.getTarget();if(!this.getOldCoord()){this.setOldCoord(this.getObjCoord(a,this.getCoordMode()))}if(this.getNewCoord()){this.setObjCoord(this.getTarget(),this.getNewCoord(),this.getCoordMode())}},doReverse:function(){if(this.getOldCoord()){this.setObjCoord(this.getTarget(),this.getOldCoord(),this.getCoordMode())}}});Kekule.ChemObjOperation.MoveAndResize=Class.create(Kekule.ChemObjOperation.MoveTo,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResize",initialize:function($super,f,b,a,d,e,c){$super(f,a,d,e,c)},initProperties:function(){this.defineProp("newDimension",{dataType:DataType.HASH});this.defineProp("oldDimension",{dataType:DataType.HASH})},setObjSize:function(d,c,b){if(d&&c){if(d.setSizeOfMode){d.setSizeOfMode(c,b)}else{var a=d.getClassName?d.getClassName():(typeof d);Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_DIMENSION_OF_CLASS").format(a))}}},getObjSize:function(b,a){if(b.getSizeOfMode){return b.getSizeOfMode(a,this.getAllowCoordBorrow())}else{return null}},doExecute:function($super){$super();var a=this.getTarget();if(!this.getOldDimension()){this.setOldDimension(this.getObjSize(a,this.getCoordMode()))}if(this.getNewDimension()){this.setObjSize(this.getTarget(),this.getNewDimension(),this.getCoordMode())}},doReverse:function($super){if(this.getOldDimension()){this.setObjSize(this.getTarget(),this.getOldDimension(),this.getCoordMode())}$super()}});Kekule.ChemObjOperation.Add=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Add",initialize:function($super,d,c,a,b){$super(d,b);this.setParentObj(c);this.setRefSibling(a)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:false})},doExecute:function(){var b=this.getParentObj();var c=this.getTarget();if(b&&c){var a=this.getRefSibling()||null;this.notifyBeforeAddingByEditor(c,b,a);b.insertBefore(c,a);this.notifyAfterAddingByEditor(c,b,a)}},doReverse:function(){var c=this.getTarget();var b=this.getParentObj();if(b&&c){var a=this.getRefSibling();if(!a){a=c.getNextSibling();this.setRefSibling(a)}this.notifyBeforeRemovingByEditor(c,b);b.removeChild(c);this.notifyAfterRemovingByEditor(c,b)}}});Kekule.ChemObjOperation.Remove=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Remove",initialize:function($super,d,c,a,b){$super(d,b);this.setParentObj(c);this.setRefSibling(a)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("ownerObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:false})},_isInEditorSelection:function(b){var a=this.getEditor();return((a&&a.getSelection&&a.getSelection())||[]).indexOf(b)>=0},doExecute:function(){var f=this.getTarget();var e=this.getParentObj();var a=this.getOwnerObj();if(!e&&f.getParent){e=f.getParent();this.setParentObj(e)}if(!a&&f.getOwner){a=f.getOwner();this.setOwnerObj(a)}if(e&&f){if(!this.getRefSibling()){var d=f.getNextSibling?f.getNextSibling():null;this.setRefSibling(d)}var c=this.getEditor();var b=this._isInEditorSelection(f);if(b){c.beginUpdateSelection()}this.notifyBeforeRemovingByEditor(f,e);e.removeChild(f);this.notifyAfterRemovingByEditor(f,e);if(b){c.removeFromSelection(f);c.endUpdateSelection()}}},doReverse:function(){var c=this.getParentObj();var a=this.getOwnerObj();var d=this.getTarget();if(c&&d){var b=this.getRefSibling();if(a){d.setOwner(a)}this.notifyBeforeAddingByEditor(d,c,b);c.insertBefore(d,b);this.notifyAfterAddingByEditor(d,c,b)}}});Kekule.ChemStructOperation={};Kekule.ChemStructOperation.AddNode=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddNode"});Kekule.ChemStructOperation.RemoveNode=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveNode",initProperties:function(){this.defineProp("linkedConnectors",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){if(!this.getLinkedConnectors()){this.setLinkedConnectors(Kekule.ArrayUtils.clone(this.getTarget().getLinkedConnectors()))}$super()},doReverse:function($super){$super();var d=this.getLinkedConnectors();if(d&&d.length){var c=this.getTarget();for(var b=0,a=d.length;b<a;++b){c.appendLinkedConnector(d[b])}}}});Kekule.ChemStructOperation.ReplaceNode=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemStructOperation.ReplaceNode",initialize:function($super,d,a,c,b){$super();this.setOldNode(d);this.setNewNode(a);this.setParentObj(c);this.setEditor(b)},initProperties:function(){this.defineProp("oldNode",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("newNode",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("parentObj",{dataType:"Kekule.ChemStructureFragment",serializable:false});this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false})},_isInEditorSelection:function(b){var a=this.getEditor();return((a&&a.getSelection&&a.getSelection())||[]).indexOf(b)>=0},doExecute:function(){var e=this.getOldNode();var a=this.getNewNode();if(e&&a){var d=this.getParentObj();if(!d){d=e.getParent();this.setParentObj(d)}if(d.replaceNode){var c=this.getEditor();var b=this._isInEditorSelection(e);if(b){c.beginUpdateSelection()}d.replaceNode(e,a);if(b){c.removeFromSelection(e);c.addObjToSelection(a);c.endUpdateSelection()}}}},doReverse:function(){var e=this.getOldNode();var a=this.getNewNode();if(e&&a){var d=this.getParentObj()||a.getParent();if(d.replaceNode){var c=this.getEditor();var b=this._isInEditorSelection(a);if(b){c.beginUpdateSelection()}d.replaceNode(a,e);if(b){c.removeFromSelection(a);c.addObjToSelection(e);c.endUpdateSelection()}}}}});Kekule.ChemStructOperation.AddConnector=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddConnector",initialize:function($super,e,c,a,d,b){$super(e,c,a,b);this.setConnectedObjs(d)},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){$super();var a=Kekule.ArrayUtils.clone(this.getConnectedObjs());if(a&&a.length){this.getTarget().setConnectedObjs(a)}},doReverse:function($super){$super()}});Kekule.ChemStructOperation.RemoveConnector=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveConnector",initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){if(!this.getConnectedObjs()){this.setConnectedObjs(Kekule.ArrayUtils.clone(this.getTarget().getConnectedObjs()))}$super()},doReverse:function($super){$super();var a=this.getConnectedObjs();if(a&&a.length){this.getTarget().setConnectedObjs(a)}}});Kekule.ChemStructOperation.MergeNodesBase=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesBase",initialize:function($super,d,b,a,c){$super(d,c);this.setDest(b);this.setEnableStructFragmentMerge(a||false);this._refSibling=null;this._nodeParent=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL})},getCommonSiblings:function(c,b){var a=c.getLinkedObjs();var d=b.getLinkedObjs();return Kekule.ArrayUtils.intersect(a,d)},doExecute:function(){},doReverse:function(){}});Kekule.ChemStructOperation.MergeNodes=Class.create(Kekule.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodes",initialize:function($super,d,b,a,c){$super(d,b,a,c);this._refSibling=null;this._nodeParent=null;this._structFragmentMergeOperation=null;this._removeConnectorOperations=[];this._removeNodeOperation=null},initProperties:function(){this.defineProp("changedConnectors",{dataType:DataType.ARRAY,serializable:false});this.defineProp("removedConnectors",{dataType:DataType.ARRAY,serializable:false})},doExecute:function(){var o=this.getTarget();var h=this.getDest();var n=o.getParentFragment();var p=h.getParentFragment();if(n!==p){if(this.getEnableStructFragmentMerge()){this._structFragmentMergeOperation=new Kekule.ChemStructOperation.MergeStructFragment(n,p,this.getEditor());this._structFragmentMergeOperation.execute();n=p}else{return null}}this._nodeParent=n;n.beginUpdate();try{var k=this.getEditor();var f=this.getRemovedConnectors();if(!f){var b=this.getCommonSiblings(o,h);var f=[];if(b.length){for(var g=0,e=b.length;g<e;++g){var q=b[g];var d=o.getConnectorTo(q);if(d&&(d.getConnectedObjCount()==2)){f.push(d)}}}var m=o.getConnectorTo(h);if(m){f.push(m)}this.setRemovedConnectors(f)}var a=this.getChangedConnectors();if(!a){var a=Kekule.ArrayUtils.clone(o.getLinkedConnectors())||[];a=Kekule.ArrayUtils.exclude(a,f);this.setChangedConnectors(a)}this._refSibling=o.getNextSibling();for(var g=0,e=a.length;g<e;++g){var d=a[g];var j=d.indexOfConnectedObj(o);d.removeConnectedObj(o);d.insertConnectedObjAt(h,j)}this._removeConnectorOperations=[];for(var g=0,e=f.length;g<e;++g){var d=f[g];var c=new Kekule.ChemStructOperation.RemoveConnector(d,null,null,k);c.execute();this._removeConnectorOperations.push(c)}this._removeNodeOperation=new Kekule.ChemStructOperation.RemoveNode(o,null,null,k);this._removeNodeOperation.execute()}finally{n.endUpdate()}},doReverse:function(){var j=this.getTarget();var f=this.getDest();var h=this._nodeParent;h.beginUpdate();try{this._removeNodeOperation.reverse();if(this._removeConnectorOperations.length){for(var e=this._removeConnectorOperations.length-1;e>=0;--e){var b=this._removeConnectorOperations[e];b.reverse()}}this._removeConnectorOperations=[];var a=this.getChangedConnectors();for(var e=0,c=a.length;e<c;++e){var d=a[e];var g=d.indexOfConnectedObj(f);d.removeConnectedObj(f);d.insertConnectedObjAt(j,g)}}finally{h.endUpdate()}if(this._structFragmentMergeOperation){this._structFragmentMergeOperation.reverse()}}});Kekule.ChemStructOperation.MergeNodes.canMerge=function(e,b,g,d){if((e instanceof Kekule.StructureFragment)||(b instanceof Kekule.StructureFragment)){return false}if(!((e instanceof Kekule.ChemStructureNode)&&(b instanceof Kekule.ChemStructureNode))){return false}var f=e.getParent();var c=b.getParent();var a=(f===c)||g;if(!d){a=a&&(!e.getConnectorTo(b))}return a};Kekule.ChemStructOperation.MergeNodesPreview=Class.create(Kekule.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesPreview",initialize:function($super,d,b,a,c){$super(d,b,a,c);this._nodeParent=null},doExecute:function(){this._moveNodeOperations=[];var j=this.getTarget();var g=this.getDest();var h=j.getParentFragment();var e=Kekule.CoordMode;var d=[e.COORD2D,e.COORD3D];if(h){h.beginUpdate()}try{for(var f=0,b=d.length;f<b;++f){var c=g.getAbsBaseCoord(d[f],false);var a=new Kekule.ChemObjOperation.MoveTo(j,c,d[f],true,this.getEditor());a.execute();this._moveNodeOperations.push(a)}this._nodeParent=h}finally{if(h){h.endUpdate()}}},doReverse:function(){var c=this._nodeParent;if(c){c.beginUpdate()}try{var b=this._moveNodeOperations;for(var a=b.length-1;a>=0;--a){b[a].reverse()}}finally{if(c){c.endUpdate()}}this._moveNodeOperations=null}});Kekule.ChemStructOperation.MergeNodesPreview.canMerge=Kekule.ChemStructOperation.MergeNodes.canMerge;Kekule.ChemStructOperation.MergeConnectorsBase=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectorsBase",initialize:function($super,e,b,d,a,c){$super(e,c);this.setDest(b);this.setCoordMode(d||Kekule.CoordMode.COORD2D);this.setEnableStructFragmentMerge(a||false);this._refSibling=null;this._nodeParent=null;this._nodeMergeOperations=[]},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureConnector",serializable:false});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL});this.defineProp("coordMode",{dataType:DataType.INT})},getMergeNodeOperationClass:function(){},doExecute:function(){var o=Kekule.ChemStructOperation.MergeConnectors.canMerge(this.getTarget(),this.getDest(),this.getEnableStructFragmentMerge());if(!o){Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_MERGE_CONNECTORS"))}var r=this.getCoordMode();var n=[this.getTarget(),this.getDest()];var g=Kekule.ArrayUtils;var e=g.clone(this.getTarget().getConnectedObjs());var f=g.clone(this.getDest().getConnectedObjs());var t=this.getAllowCoordBorrow();for(var q=0,m=n.length;q<m;++q){var a=n[q];var d=a.getConnectedObjAt(0).getAbsCoordOfMode(r,t);var c=a.getConnectedObjAt(1).getAbsCoordOfMode(r,t);var s=Kekule.CoordUtils.substract(d,c);var h=Math.abs(s.x)>Math.abs(s.y)?"x":"y";if(Kekule.ObjUtils.notUnset(d.z)){if(Math.abs(s.z)>Math.abs(s.x)){h="z"}}var k=(q===0)?e:f;k.sort(function(l,i){var v=l.getAbsCoordOfMode(r,t);var u=i.getAbsCoordOfMode(r,t);return(v[h]-u[h])||0})}var b=g.intersect(e,f);e=g.exclude(e,b);f=g.exclude(f,b);this._nodeMergeOperations=[];var p=this.getMergeNodeOperationClass();for(var q=0,m=e.length;q<m;++q){if(e[q]!==f[q]){var j=new p(e[q],f[q],this.getEnableStructFragmentMerge());j.execute()}this._nodeMergeOperations.push(j)}},doReverse:function(){for(var a=this._nodeMergeOperations.length-1;a>=0;--a){var b=this._nodeMergeOperations[a];b.reverse()}this._nodeMergeOperations=[]}});Kekule.ChemStructOperation.MergeConnectors=Class.create(Kekule.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return Kekule.ChemStructOperation.MergeNodes}});Kekule.ChemStructOperation.MergeConnectors.canMerge=function(d,c,e){if(!e&&(d.getParent()!==c.getParent())){return false}if(d.isConnectingConnector()||c.isConnectingConnector()){return false}var a=d.getConnectedExposedObjs();var b=c.getConnectedObjs();if(a.length!==b.length){return false}if(a.length!==2){return false}if(Kekule.ArrayUtils.intersect(a,b).length>=1){return false}return true};Kekule.ChemStructOperation.MergeConnectorsPreview=Class.create(Kekule.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return Kekule.ChemStructOperation.MergeNodesPreview}});Kekule.ChemStructOperation.MergeConnectorsPreview.canMerge=Kekule.ChemStructOperation.MergeConnectors.canMerge;Kekule.ChemStructOperation.MergeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeStructFragment",initialize:function($super,c,a,b){$super(c,b);this.setDest(a);this._removeOperation=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("mergedNodes",{dataType:DataType.ARRAY,serializable:false});this.defineProp("mergedConnectors",{dataType:DataType.ARRAY,serializable:false})},moveChildBetweenStructFragment:function(d,c,b,a){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(d,c,b,a)},doExecute:function(){var e=this.getTarget();var c=this.getDest();if(e&&c){var b=Kekule.ArrayUtils.clone(e.getNodes());this.setMergedNodes(b);var a=Kekule.ArrayUtils.clone(e.getConnectors());this.setMergedConnectors(a);this.moveChildBetweenStructFragment(e,c,b,a);var d=e.getParent();if(d){this._removeOperation=new Kekule.ChemObjOperation.Remove(e,d,null,this.getEditor());this._removeOperation.execute()}}},doReverse:function(){var d=this.getTarget();var c=this.getDest();if(d&&c){if(this._removeOperation){this._removeOperation.reverse();this._removeOperation=null}var b=this.getMergedNodes();var a=this.getMergedConnectors();this.moveChildBetweenStructFragment(c,d,b,a)}}});Kekule.ChemStructOperation.SplitStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.SplitStructFragment",initialize:function($super,b,a){$super(b,a)},initProperties:function(){this.defineProp("splittedFragments",{dataType:DataType.ARRAY,serializable:false,setter:null})},doExecute:function(){var f=Kekule.ChemStructureUtils.splitStructFragment(this.getTarget());if(f.length>1){this.setPropStoreFieldValue("splittedFragments",f);var c=this.getTarget().getParent();var d=this.getTarget().getNextSibling();c.beginUpdate();try{if(c){for(var b=1,a=f.length;b<a;++b){var e=f[b];c.insertBefore(e,d)}}}finally{c.endUpdate()}}else{this.setPropStoreFieldValue("splittedFragments",null)}},doReverse:function(){var a=this.getSplittedFragments();if(a&&a.length){var e=this.getTarget();for(var c=0,b=a.length;c<b;++c){var f=a[c];if(f!==e){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(f,e,Kekule.ArrayUtils.clone(f.getNodes()),Kekule.ArrayUtils.clone(f.getConnectors()));var d=f.getParent();if(d){d.removeChild(f)}f.finalize()}}}}});Kekule.ChemStructOperation.StandardizeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.StandardizeStructFragment",initialize:function($super,b,a){$super(b,a);this.setEnableSplit(true);this.setEnableRemove(true);this._concreteOper=null},initProperties:function(){this.defineProp("enableRemove",{dataType:DataType.BOOL});this.defineProp("enableSplit",{dataType:DataType.BOOL})},doExecute:function(){var c=this.getTarget();var a=c.getNodeCount();this._concreteOper=null;var b=this.getEditor();if(a<=0){if(this.getEnableRemove()){this._concreteOper=new Kekule.ChemObjOperation.Remove(c,null,null,b)}}else{if(this.getEnableSplit()){this._concreteOper=new Kekule.ChemStructOperation.SplitStructFragment(c,b)}}if(this._concreteOper){return this._concreteOper.execute()}else{return null}},doReverse:function(){return this._concreteOper?this._concreteOper.reverse():null}})})();(function(){Kekule.Editor.StructureUtils={getCascadeDeleteObjs:function(a){return Kekule.ChemStructureUtils.getCascadeDeleteObjs(a)},getSurroundingObjs:function(c){var b=c.getLinkedObjs();if(c instanceof Kekule.ChemStructureConnector){var a=c.getConnectedObjs();Kekule.ArrayUtils.pushUnique(b,a)}return b},calcMostEmptyDirectionAngleOfChemObj:function(h,d,e){var n=[];if(!d){d=h.getLinkedObjs()}var p=h.getAbsBaseCoord2D(e);for(var j=0,g=d.length;j<g;++j){var m=d[j].getAbsBaseCoord2D(e);m=Kekule.CoordUtils.substract(m,p);var f=Math.atan2(m.y,m.x);if(f<0){f=Math.PI*2+f}n.push(f)}n.sort();var g=n.length;if(g===0){return 0}else{if(g===1){return -n[0]}else{var o=0;var k=0;for(var j=0;j<g;++j){var b=n[j];var a=n[(j+1)%g];var q=a-b;if(q<0){q+=Math.PI*2}if(q>o){o=q;k=j}}var r=n[k]+o/2;return r}}},calcPreferred2DBondGrowingDirection:function(e,b,d){var c=e.getAbsBaseCoord2D(d);var f=Kekule.Editor.StructureUtils.getSurroundingObjs(e);var m=f?f.length:0;switch(m){case 0:return b;case 1:var a=f[0];var n=a.getAbsBaseCoord2D(d);var o=Kekule.CoordUtils.substract(n,c);var l=Math.atan2(o.y,o.x);var i=l-b;var h=l+b;if(i<0){i+=Math.PI*2}if(h<0){h+=Math.PI*2}var g;if(i!==h){var k=Math.min((i>Math.PI)?Math.abs(i-Math.PI*2):i,Math.abs(i-Math.PI));var j=Math.min((h>Math.PI)?Math.abs(h-Math.PI*2):h,Math.abs(h-Math.PI));g=(k<=j)?i:h}else{g=i}return g;default:var g=Kekule.Editor.StructureUtils.calcMostEmptyDirectionAngleOfChemObj(e,f,d);return g}},calcPreferred2DBondGrowingLocation:function(a,e,f,b){var c=a.getAbsBaseCoord2D(b);var d=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(a,f,b);return Kekule.CoordUtils.add(c,{x:e*Math.cos(d),y:e*Math.sin(d)})},isBondPropsMatch:function(c,b,e){var d=["bondType","bondOrder","stereo"];var a=true;if(a&&e.indexOf("bondType")>=0){a=(c.bondType==b.bondType||(!c.bondType&&!b.bondType))}if(a&&c.bondType===Kekule.BondType.COVALENT){if(a&&e.indexOf("bondOrder")>=0||(!c.bondOrder&&!b.bondOrder)){a=(c.bondOrder==b.bondOrder)}if(a&&e.indexOf("stereo")>=0){a=(c.stereo==b.stereo||(!c.stereo&&!b.stereo))}}if(a){a=Kekule.ObjUtils.equal(c,b,d)}return a},getChemStructureNodeLabel:function(b,d){if(b.getIsotopeId){return b.getIsotopeId()}else{if(b instanceof Kekule.SubGroup){var c=b.getAbbr()||b.getFormulaText();if(d){c=c||d.getRgroup()}return c}else{var a=b.getCoreDisplayRichTextItem(null,null,d);return Kekule.Render.RichTextUtils.toText(a)}}},getAllChemStructureNodesLabel:function(b,e){var g;for(var c=0,a=b.length;c<a;++c){var d=b[c];var f=Kekule.Editor.StructureUtils.getChemStructureNodeLabel(d,e);if(!g){g=f}else{if(g!==f){return null}}}return g},getAllChemStructureNodesHtmlCode:function(b,j,g,a){var k;for(var e=0,d=b.length;e<d;++e){var c=b[e];var h=c.getCoreDisplayRichTextItem(j,g,a);var f=Kekule.Render.RichTextUtils.toSimpleHtmlCode(h);if(!k){k=f}else{if(k!==f){return null}}}return k},getStructureCenterAbsBaseCoord:function(g,d,b){var j=null;var h=Kekule.CoordUtils.add;var c=g.getNodeCount();for(var e=0;e<c;++e){var a=g.getNodeAt(e);var f=a.getAbsBaseCoord(d,b);if(!j){j=f}else{j=h(j,f)}}j=Kekule.CoordUtils.divide(j,c);return j}};Kekule.Editor.RepositoryStructureUtils={_calcNodeMergeAdjustRotateAngle:function(d,u,j){var h=0;var t=d.getCoordMode();if(t!==Kekule.CoordMode.COORD3D){var v=d.getAllowCoordBorrow();var k=d.getEditorConfigs().getStructureConfigs();var f=Kekule.Editor.StructureUtils.getSurroundingObjs(u);var e=Kekule.Editor.StructureUtils.getSurroundingObjs(j);if(f.length===1){var a=u.getLinkedConnectorAt(0);var o=a.getBondOrder?a.getBondOrder():0;var r=k.getNewBondDefAngle(j,o);w=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(j,r,v);var b=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(u,f[0],t,v);var c=Math.atan2(b.y,b.x);h=w-c}else{if(e.length===1){var a=j.getLinkedConnectorAt(0);var o=a.getBondOrder?a.getBondOrder():0;var r=k.getNewBondDefAngle(u,o);var w=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(u,r,v);var b=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(j,e[0],t,v);var n=Math.atan2(b.y,b.x);h=n-w}else{var r=k.getNewBondDefAngle(j,null);var w=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(j,r,v);var m={};for(var q=0,p=f.length;q<p;++q){var b=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(u,f[q],t,v);var s=Math.atan2(b.y,b.x);if(Kekule.ObjUtils.isUnset(m.min)||(s<m.min)){m.min=s}if(Kekule.ObjUtils.isUnset(m.max)||(s>m.max)){m.max=s}}var g=(m.max+m.min)/2;h=w-g}}}return h},_calcConnectorMergeTransformParams:function(d,b,i){var f=b.getConnectedObjAt(0);var e=b.getConnectedObjAt(1);var h=i.getConnectedObjAt(0);var g=i.getConnectedObjAt(1);var c=d.getObjCoord(f);var a=d.getObjCoord(e);var l=d.getObjCoord(h);var j=d.getObjCoord(g);var k=Kekule.CoordUtils.calcCoordGroup2DTransformParams(c,a,j,l);return k},calcRepObjInitialTransformParams:function(k,f,c,g,d){var i=c.baseObjCoord;var b=k.getDefBondLength();var j=b/f.getRefLength();var h;var a=i;if(c.mergeObj){var g=c.mergeDest||g;if(g){d=k.getObjectScreenCoord(g);if((c.mergeObj instanceof Kekule.ChemStructureNode)&&(g instanceof Kekule.ChemStructureNode)){h=Kekule.Editor.RepositoryStructureUtils._calcNodeMergeAdjustRotateAngle(k,c.mergeObj,g)}else{if((c.mergeObj instanceof Kekule.ChemStructureConnector)&&(g instanceof Kekule.ChemStructureConnector)){return Kekule.Editor.RepositoryStructureUtils._calcConnectorMergeTransformParams(k,c.mergeObj,g)}}}}var e=k.translateCoord(d,Kekule.Editor.CoordSys.SCREEN,Kekule.Editor.CoordSys.CHEM);if(i){e=Kekule.CoordUtils.substract(e,i)}var l={scale:j,translateX:e.x,translateY:e.y,translateZ:e.z,rotateAngle:h,center:a};return l},transformChemObjectsCoordAndSize:function(h,m,k){var e=h.getCoordMode();var c=h.getAllowCoordBorrow();var j=(e===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(k):Kekule.CoordUtils.calcTransform2DMatrix(k);var a=Object.extend({},k);a=Object.extend(a,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});var b=(e===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(a):Kekule.CoordUtils.calcTransform2DMatrix(a);for(var g=0,d=m.length;g<d;++g){var f=m[g];f.transformAbsCoordByMatrix(j,b,e,true,c);f.scaleSize(k.scale,e,true,c)}}}})();(function(){var a=Class.PropertyScope;Kekule.Editor.BaseEditorConfigs=Class.create(Kekule.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.Editor.BaseEditorConfigs",initProperties:function(){this.addConfigProp("uiMarkerConfigs","Kekule.EditorConfigs.UiMarkerConfigs");this.addConfigProp("interactionConfigs","Kekule.EditorConfigs.InteractionConfigs");this.addConfigProp("structureConfigs","Kekule.Editor.StructureConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("uiMarkerConfigs",new Kekule.Editor.UiMarkerConfigs());this.setPropStoreFieldValue("interactionConfigs",new Kekule.Editor.InteractionConfigs());this.setPropStoreFieldValue("structureConfigs",new Kekule.Editor.StructureConfigs())}});Kekule.Editor.ChemSpaceEditorConfigs=Class.create(Kekule.Editor.BaseEditorConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditorConfigs",initProperties:function(){this.addConfigProp("chemSpaceConfigs","Kekule.Editor.ChemSpaceConfigs");this.addConfigProp("styleSetterConfigs","Kekule.Editor.StyleSetterConfigs",undefined,{scope:a.PUBLIC})},initPropValues:function($super){$super();this.setPropStoreFieldValue("chemSpaceConfigs",new Kekule.Editor.ChemSpaceConfigs());this.setPropStoreFieldValue("styleSetterConfigs",new Kekule.Editor.StyleSetterConfigs())}});Kekule.ClassUtils.makeSingleton(Kekule.Editor.ChemSpaceEditorConfigs);Kekule.Editor.InteractionConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.InteractionConfigs",initProperties:function(){var b=Math.PI/180;this.addBoolConfigProp("enableTrackOnNearest",true);this.addBoolConfigProp("enableHotTrack",true);this.addBoolConfigProp("autoSelectNewlyInsertedObjects",true);this.addIntConfigProp("objBoundTrackMinInflation",5);this.addIntConfigProp("objBoundTrackMinInflationMouse",null);this.addIntConfigProp("objBoundTrackMinInflationPen",null);this.addIntConfigProp("objBoundTrackMinInflationTouch",10);this.addIntConfigProp("objBoundTrackInflationRatio",0.2);this.addIntConfigProp("objBoundTrackInflationRatioMouse",null);this.addIntConfigProp("objBoundTrackInflationRatioPen",null);this.addIntConfigProp("objBoundTrackInflationRatioTouch",0.33);this.addBoolConfigProp("enablePartialAreaSelecting",false);this.addFloatConfigProp("selectingBrushWidth",12);this.addBoolConfigProp("enableOffSelectionManipulation",true);this.addIntConfigProp("offSelectionManipulationActivatingTimeThreshold",800);this.addFloatConfigProp("unmovePointerDistanceThreshold",5,{scope:a.PUBLIC});this.addIntConfigProp("selectingCurveSimplificationDistanceThreshold",2,{scope:a.PUBLIC});this.addIntConfigProp("selectionMarkerInflation",5);this.addIntConfigProp("selectionMarkerEdgeInflation",5);this.addIntConfigProp("selectionMarkerDefPulseDuration",500);this.addIntConfigProp("selectionMarkerDefPulseCount",2);this.addFloatConfigProp("constrainedResizeStep",0.25);this.addIntConfigProp("rotationRegionInflation",10);this.addFloatConfigProp("constrainedRotateStep",b*15);this.addIntConfigProp("rotationLocationPointDistanceThreshold",10);this.addIntConfigProp("directedMoveDistanceThreshold",10);this.addBoolConfigProp("enableMergePreview",true);this.addBoolConfigProp("enableGestureManipulation",true);this.addBoolConfigProp("enableGestureZoomOnEditor",true);this.addIntConfigProp("clonedObjectScreenOffset",10);this.addIntConfigProp("atomSetterFontSize",14);this.addBoolConfigProp("allowUnknownAtomSymbol",true);this.addIntConfigProp("trackSimplifierDistanceThreshold",8);this.addIntConfigProp("trackSimplifierIgnoreSegmentThreshold",10);this.addIntConfigProp("trackMergeDistanceThreshold",20);this.addFloatConfigProp("trackOptimizationAngleConstraint",b*30);this.addConfigProp("trackOptimizationDistanceConstraints",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addIntConfigProp("trackOptimizationPrimaryDistanceConstraint",1);this.addFloatConfigProp("trackTouchRefLength",0.5,{scope:a.PUBLIC});this.addBoolConfigProp("autoAdjustZoomLevelOnTrackTouching",!true,{scope:a.PUBLIC});this.addFloatConfigProp("editorInitialZoom",1.5)},initPropValues:function($super){$super();this.setTrackOptimizationDistanceConstraints([0.5,1,3,4,5])}});Kekule.Editor.UiMarkerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.UiMarkerConfigs",initProperties:function(){this.addStrConfigProp("hotTrackerColor","#0000FF");this.addFloatConfigProp("hotTrackerOpacity",0.5);this.addStrConfigProp("selectionMarkerStrokeColor","#0000FF");this.addFloatConfigProp("selectionMarkerStrokeWidth",2);this.addStrConfigProp("selectionMarkerFillColor","#0000FF");this.addFloatConfigProp("selectionMarkerOpacity",0.2);this.addFloatConfigProp("selectionMarkerEmphasisOpacity",0.4);this.addFloatConfigProp("selectionTransformMarkerSize",8,{scope:a.PUBLIC});this.addFloatConfigProp("selectionTransformMarkerOpacity",0.4,{scope:a.PUBLIC});this.addStrConfigProp("selectingMarkerStrokeColor","#000000");this.addFloatConfigProp("selectingMarkerStrokeWidth",1);this.addStrConfigProp("selectingMarkerStrokeDash",true);this.addStrConfigProp("selectingMarkerFillColor",null);this.addFloatConfigProp("selectingMarkerOpacity",0.7);this.addStrConfigProp("selectingBrushMarkerStrokeColor","#0000FF");this.addStrConfigProp("selectingBrushMarkerStrokeDash",false);this.addFloatConfigProp("selectingBrushMarkerStrokeLineCap","round");this.addFloatConfigProp("selectingBrushMarkerStrokeLineJoin","round");this.addFloatConfigProp("selectingBrushMarkerOpacity",0.3);this.addStrConfigProp("trackMarkerStrokeColor","#0000AA");this.addFloatConfigProp("trackMarkerStrokeWidth",2);this.addStrConfigProp("trackMarkerStrokeDash",false);this.addFloatConfigProp("trackMarkerOpacity",0.5);this.addStrConfigProp("flexStructureAssocMarkerColor","#0000AA");this.addFloatConfigProp("flexStructureAssocMarkerOpacity",0.5);this.addIntConfigProp("flexStructureAssocMarkerFontSize",14);this.addStrConfigProp("flexStructureAssocMarkerFontFamily","Arial, Helvetica, sans-serif")}});Kekule.Editor.StructureConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StructureConfigs",initProperties:function(){this.addStrConfigProp("defBondType",Kekule.BondType.DEFAULT,{enumSource:Kekule.BondType});this.addIntConfigProp("defBondOrder",Kekule.BondOrder.SINGLE,{enumSource:Kekule.BondOrder});this.addFloatConfigProp("defBondLength",0.8);this.addConfigProp("defBondAngles",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addFloatConfigProp("bondConstrainedDirectionDelta",undefined,{scope:a.PUBLIC});this.addConfigProp("bondConstrainedDirectionAngles",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addFloatConfigProp("bondConstrainedDirectionAngleThreshold",undefined,{scope:a.PUBLIC});this.addFloatConfigProp("initialBondDirection",undefined,{scope:a.PUBLIC});this.addStrConfigProp("defIsotopeId","C");this.addConfigProp("primaryOrgChemAtoms",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addIntConfigProp("maxFlexChainAtomCount",0);this.addIntConfigProp("minFlexRingAtomCount",3);this.addIntConfigProp("maxFlexRingAtomCount",18);this.addHashConfigProp("enabledNonAtomNodeTypes",{RGroup:true,pseudoatomDummy:true,pseudoatomHetero:true,pseudoatomAny:true,variableAtomList:true,variableAtomNotList:true});this.addHashConfigProp("enabledBondForms",{single:true,"double":true,triple:true,quad:true,explicitAromatic:true,up:true,upInverted:true,down:true,downInverted:true,upOrDown:true,eOrZ:true,closer:true,ionic:false,coordinate:false,metallic:false,hydrogen:true})},initPropValues:function($super){$super();var b=Math.PI/180;var d=[];var c=Kekule.BondOrder;var e=Math.PI*2/3;d[0]=e;d[c.EXPLICIT_AROMATIC]=[e];d[c.TRIPLE]=[Math.PI];d[c.DOUBLE]=[e];d[c.DOUBLE][c.DOUBLE]=Math.PI;d[c.SINGLE]=[e];this.setDefBondAngles(d);this.setBondConstrainedDirectionDelta(10*Math.PI/180);this.setBondConstrainedDirectionAngles([0,90*b,180*b,270*b]);this.setBondConstrainedDirectionAngleThreshold(b*3);this.setInitialBondDirection(30*b);this.setPrimaryOrgChemAtoms(["C","H","O","N","P","S","F","Cl","Br","I","Si","D","C13"])},getDefAngleOfBonds:function(f,d){var c=f||0;var b=d||0;if(c>b){c=d||0;b=f||0}var h=this.getDefBondAngles();var g=h[b];if(!g){return h[0]}else{var e=g[c];return e||g[0]}},getNewBondDefAngle:function(d,e){if(Kekule.ObjUtils.isUnset(e)){e=this.getDefBondOrder()}var c;var f=Kekule.Editor.StructureUtils.getSurroundingObjs(d);if(f.length===1){var b=d.getLinkedConnectorAt(0);if(b&&(b.getConnectedObjs().indexOf(f[0])>=0)){var g=b.getBondOrder?b.getBondOrder():null;if(Kekule.ObjUtils.notUnset(g)){c=this.getDefAngleOfBonds(e,g)}}}else{if(f.length===0){c=this.getInitialBondDirection()}else{c=this.getDefAngleOfBonds(e,0)}}return c}});Kekule.Editor.ChemSpaceConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceConfigs",initProperties:function(){this.addHashConfigProp("defScreenSize2D");this.addHashConfigProp("defScreenSize3D");this.addNumConfigProp("defPadding",50)},initPropValues:function($super){$super();this.setDefScreenSize2D({x:900,y:1500});this.setDefScreenSize3D({x:600,y:600,z:600})}});Kekule.Editor.StyleSetterConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StyleSetterConfigs",initProperties:function(){this.defineProp("listedFontSizes",{dataType:DataType.ARRAY});this.defineProp("listedFontNames",{dataType:DataType.ARRAY})},initPropValues:function($super){$super();this.setListedFontSizes([8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88,96]);this.setListedFontNames(Kekule.Widget.FontEnumerator.getAvailableFontFamilies())}})})();(function(){Kekule.Editor.RepositoryData={subGroups:[{name:"methyl",inputTexts:["Me","CH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Thu,15 Sep 2016 15:49:02 GMT"},"__type__":"object"},"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Me","__type__":"Kekule.SubGroup"}'},{name:"ethyl",inputTexts:["Et","C2H5"],structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Et","__type__":"Kekule.SubGroup"}'},{name:"n-propyl",inputTexts:["n-Pr","nPr","C3H7"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Pr","formulaText":"C3H7","__type__":"Kekule.SubGroup"}'},{name:"i-propyl",inputTexts:["i-Pr","iPr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Pr","__type__":"Kekule.SubGroup"}'},{name:"n-butyl",inputTexts:["n-Bu","nBu","C4H9"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Bu","formulaText":"C4H9","__type__":"Kekule.SubGroup"}'},{name:"i-butyl",inputTexts:["i-Bu","iBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Bu","__type__":"Kekule.SubGroup"}'},{name:"s-butyl",inputTexts:["s-Bu","sBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"s-Bu","__type__":"Kekule.SubGroup"}'},{name:"t-butyl",inputTexts:["t-Bu","tBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"t-Bu","__type__":"Kekule.SubGroup"}'},{name:"phenyl",inputTexts:["Ph","C6H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ph","formulaText":"C6H5","__type__":"Kekule.SubGroup"}'},{name:"benzyl",inputTexts:["Bn"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bn","__type__":"Kekule.SubGroup"}'},{name:"benzoyl",inputTexts:["Bz"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bz","__type__":"Kekule.SubGroup"}'},{inputTexts:["CF3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CF3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CCl3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CCl3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CBr3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CBr3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CI3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CI3","__type__":"Kekule.SubGroup"}'},{inputTexts:["OMe","OCH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["OEt","OC2H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ot-Bu","OtBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275525,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275454,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.7763568394002505e-15,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ot-Bu","__type__":"Kekule.SubGroup"}'},{inputTexts:["CO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO","__type__":"Kekule.SubGroup"}'},{inputTexts:["CHO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CHO","__type__":"Kekule.SubGroup"}'},{name:"carboxyl",inputTexts:["COOH","CO2H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOH","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOOH","CO3H","CO2OH"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["COONa"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Na"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COONa","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOK"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"K"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOK","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOCH3","COOMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOC2H5","COOEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.039230484541326,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["COCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["COBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COBr","__type__":"Kekule.SubGroup"}'},{inputTexts:["CONH2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CONH2","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ac"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ac","__type__":"Kekule.SubGroup"}'},{inputTexts:["OAc"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OAc","__type__":"Kekule.SubGroup"}'},{inputTexts:["MeCO","COMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.3464101615137771,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.3464101615137771,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["EtCO","COEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COEt","__type__":"Kekule.SubGroup"}'},{name:"hydroxymethyl",inputTexts:["CH2OH"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999968,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CH2OH","__type__":"Kekule.SubGroup"}'},{name:"amino",inputTexts:["NH2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Thu,15 Sep 2016 15:49:26 GMT"},"__type__":"object"},"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NH2","name":"Untitled Document-1","__type__":"Kekule.SubGroup"}'},{inputTexts:["NMe2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NMe2","__type__":"Kekule.SubGroup"}'},{name:"nitro",inputTexts:["NO2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO2","__type__":"Kekule.SubGroup"}'},{name:"nitroso",inputTexts:["NO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO","__type__":"Kekule.SubGroup"}'},{name:"diazo",inputTexts:["N2","NN","N2 +"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2+","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Cl","NNCl","N2 +Cl-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2+Cl-","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Br","NNBr","N2 +Br-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2+Br-","__type__":"Kekule.SubGroup"}'},{name:"nitrile group",inputTexts:["CN"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CN","__type__":"Kekule.SubGroup"}'},{name:"pyridyl",inputTexts:["Py"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Py","__type__":"Kekule.SubGroup"}'},{name:"sulfonic group",inputTexts:["SO3H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000213,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000213,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.399999999999995,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Cl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Cl","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Br"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Br","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgBr","__type__":"Kekule.SubGroup"}'},{inputTexts:["TMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"TMS","__type__":"Kekule.SubGroup"}'},{inputTexts:["OTMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTMS","__type__":"Kekule.SubGroup"}'}],fragments:[{name:"methane",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Sat,25 Feb 2017 04:21:08 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"fischer1",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer2",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer3",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999972,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.6000000000000085,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,10]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"sawhorseStaggered",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:51:35 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34060000000000024,"y":-0.642199999999999,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.37219999999999764,"y":-1.0575999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.0877999999999997,"y":-0.648899999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3686000000000007,"y":-1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34060000000000024,"y":0.6422000000000061,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.0877999999999997,"y":0.6489000000000011,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3686000000000007,"y":1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"zIndex2D":0,"coord2D":{"x":0.3722000000000012,"y":1.0576000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-6","__type__":"Kekule.Molecule"}'},{name:"sawhorseEclipsed",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:50:51 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3022000000000009,"y":0.4405000000000001,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.4229000000000003,"y":0.8340999999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.1265,"y":0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"coord2D":{"x":0.44500000000000206,"y":1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.1265,"y":-1.6214000000000084,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.4015000000000004,"y":-1.2276999999999987,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3013999999999992,"y":-1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.38010000000000055,"y":-0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-5","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:43:26 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.5715736151962387,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9715297072546738,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.20235354281841378,"y":-0.12653156366939555,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.5714766561436155,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9715297072546738,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.20225658376579414,"y":0.1266285227220152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:44:10 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9716412105880998,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.5715992908679759,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.20239696641355032,"y":-0.14362717166194017,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9716412105880998,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.571696270727303,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.20239696641355032,"y":0.14372415152126905,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-2","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:47:35 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4999174283497734,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.4999174283497734,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:47:08 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.49991742834977515,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.49991742834977515,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":10,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:48:11 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.48039814732735664,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4815600495278858,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0006293636919529888,"y":-0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue,17 Jan 2017 12:48:04 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.4804171472781027,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":-1,"coord2D":{"x":-0.48158784071773564,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0005848625620670234,"y":-0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[4,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"substituentMark",dataFormat:"Kekule-JSON",scale:0.7,structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Pseudoatom","coordPos2D":0,"coordPos3D":0,"renderOptions":{"nodeDisplayMode":-1,"__type__":"object"},"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"atomType":"any","symbol":"A"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"renderOptions":{"opacity":0.5,"__type__":"object"},"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'}]}})();(function(){Kekule.Editor.AbstractRepositoryItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.AbstractRepositoryItem",initialize:function($super){$super()},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAvailableCoordModes:function(){return[]},createObjects:function(c,b){},getScale:function(){return this.doGetScale()||1},doGetScale:function(){return 1},getRefLength:function(){return this.doGetRefLength()/(this.getScale()||1)},doGetRefLength:function(){},isOneStructureFragmentObj:function(){return false}});Kekule.Editor.MolRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.MolRepositoryItem2D",initialize:function($super){$super()},initProperties:function(){this.defineProp("molScale",{dataType:DataType.FLOAT});this.defineProp("molManipulationCenterCoord",{dataType:DataType.HASH});this.defineProp("molManipulationDefDirectionCoord",{dataType:DataType.HASH})},doGetScale:function($super){return this.getMolScale()||$super()},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},isOneStructureFragmentObj:function(){return true},createObjects:function(d,c){var f=this.doCreateObjects(d,c);if(!f){return null}var b=null;var g=null;var e={x:0,y:0};if(d){b=(d instanceof Kekule.ChemStructureNode)?this.doGetMergableNode(f,d):(d instanceof Kekule.ChemStructureConnector)?this.doGetMergableConnector(f,d):null;if(b){g=d;e=b.getAbsBaseCoord2D()}}return{objects:[f],mergeObj:b,mergeDest:g,baseObjCoord:e,centerCoord:{x:0,y:0}}},doCreateObjects:function(c,b){return null},doGetMergableNode:function(b,c){return null},doGetMergableConnector:function(b,c){return null}});Kekule.Editor.StoredStructFragmentRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredStructFragmentRepositoryItem2D",initialize:function($super,b,d,c){$super();this.beginUpdate();try{if(d){this.setDataFormat(d)}if(b){this.setStructData(b)}if(c){this.setMolScale(c)}}finally{this.endUpdate()}},initProperties:function(){this.defineProp("structureFragment",{dataType:"Kekule.StructureFragment",setter:null,serializable:false});this.defineProp("structData",{dataType:DataType.STRING});this.defineProp("dataFormat",{dataType:DataType.STRING})},objectChange:function($super,b){$super(b);if((b.indexOf("structData")>=0)||(b.indexOf("dataFormat")>=0)){var c=null;if(this.getStructData()){c=this._createTemplateStructFragment()}this.setPropStoreFieldValue("structureFragment",c)}},_createTemplateStructFragment:function(){var b=null;if(this.getStructData()){b=Kekule.IO.loadFormatData(this.getStructData(),this.getDataFormat()||Kekule.IO.DataFormat.KEKULE_JSON)}if(b){this._adjustTemplateStructureFragmentCoords(b)}return b},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var f=Kekule.Render.ObjUtils.getContainerBox(e,Kekule.CoordMode.COORD2D,true);if(f){var j=e.getCoordOfMode?e.getCoordOfMode(Kekule.CoordMode.COORD2D,true)||{}:{};var h={};h.x=-(f.x2+f.x1)/2;h.y=-(f.y2+f.y1)/2;e.beginUpdate();try{for(var c=0,b=e.getNodeCount();c<b;++c){var d=e.getNodeAt(c);var g=d.getCoord2D(true);g=Kekule.CoordUtils.add(g,h);d.setCoord2D(g)}}finally{e.endUpdate()}}},doGetRefLength:function(){var b=this.getStructureFragment();return b?b.getConnectorLengthMedian(Kekule.CoordMode.COORD2D,true):0},doCreateObjects:function(c,b){var d=this.getStructureFragment();return d?d.clone():null},doGetMergableNode:function(b,c){return b.getAnchorNodeAt(0)||b.getNodeAt(0)},doGetMergableConnector:function(b,c){return null}});Kekule.Editor.StoredSubgroupRepositoryItem2D=Class.create(Kekule.Editor.StoredStructFragmentRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredSubgroupRepositoryItem2D",initialize:function($super,b,d,c){$super(b,d,c)},initProperties:function(){this.defineProp("inputTexts",{dataType:DataType.STRING})},doCreateObjects:function(d,c){var e=this.getStructureFragment();if(e){var b=new Kekule.SubGroup();b.assign(e,false);return b}else{return null}},createObjects:function($super,c){var b=$super(c);return b},_adjustTemplateStructureFragmentCoords:function(f){f.setCoord2D({x:0,y:0});var c=f.getCurrConnectableObj();if(c){var h=Kekule.CoordUtils.substract({x:0,y:0},c.getCoord2D(true));f.beginUpdate();try{for(var d=0,b=f.getNodeCount();d<b;++d){var e=f.getNodeAt(d);var g=e.getCoord2D(true);g=Kekule.CoordUtils.add(g,h);e.setCoord2D(g)}}finally{f.endUpdate()}}}});Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText=function(f){var e=Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[];for(var c=0,b=e.length;c<b;++c){var d=e[c];if((d.getInputTexts()||[]).indexOf(f)>=0){return d}}return null};Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems=function(){return Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[]};Kekule.Editor.MolRingRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolRingRepositoryItem2D",initialize:function($super,c,b){$super();this.setRingAtomCount(c);this.setBondLength(b||1)},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT});this.defineProp("bondLength",{dataType:DataType.FLOAT,setter:function(b){if(b!==this.getBondLength()){this.setPropStoreFieldValue("bondLength",b)}}});this.defineProp("isAromatic",{dataType:DataType.BOOL});this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getEnableCoordCache()){this.setPropStoreFieldValue("enableCoordCache",b);if(b&&!this._coordCache){this._initCoordCache()}}}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(c,b){var d=b&&b.originalStructFragment;return this.generateRing(d)},doGetMergableNode:function(b,c){return b.getNodeAt(0)},doGetMergableConnector:function(b,c){return b.getConnectorAt(0)},generateRing:function(l,m){if(!m){m=Kekule.Molecule}var s;if(l){s=l}else{s=new m()}var t=this.getRingAtomCount();s.beginUpdate();try{s.setCoord2D({x:0,y:0});var k=s.getNodeCount();if(k>t){for(var p=k-1;p>=t;--p){s.removeNodeAt(p)}}var g=s.getConnectorCount();for(var p=g-1;p>=0;--p){s.removeConnectorAt(p)}var q=this.getEnableCoordCache();var h=q&&this._hasCoordCache(t);var c;if(!h){c=this._calcAtomCoords(t)}else{c=this._getCachedCoords(t)}var j=this.getBondLength();var n;var r;var d;for(var p=0;p<t;++p){var b=s.getNodeAt(p);if(!b){b=this._generateAtom(p);s.appendNode(b)}var e;var o=c[p];if(j!==1){o=Kekule.CoordUtils.multiply(o)}b.setCoord2D(o);if(p===0){d=b}if(n){var f=this._generateBond(r,p);s.appendConnector(f);f.appendConnectedObj(n);f.appendConnectedObj(b)}n=b;r=p}var f=this._generateBond(t-1,0);s.appendConnector(f);f.appendConnectedObj(n);f.appendConnectedObj(d)}finally{s.endUpdate()}return s},_generateAtom:function(b){return new Kekule.Atom(null,"C")},_generateBond:function(d,c){var b=Kekule.BondOrder.SINGLE;if(this.getIsAromatic()){if(d%2){b=Kekule.BondOrder.DOUBLE}}return new Kekule.Bond(null,null,b)},_calcAtomCoords:function(b){var d=1;var e=this.getEnableCoordCache();var o=Math.PI/b;var j=Math.sin(o);var c=2*o;var f=d/2/j;var n=((b===4)||(b===8))?-Math.PI/2-c/2:-Math.PI/2;var m=n;var p=[];for(var g=0;g<b;++g){var l=f*Math.cos(m);var k=f*Math.sin(m);var h={x:l,y:k};p.push(h);if(e){this._setCoordToCache(h,b,g)}m+=c}return p},_initCoordCache:function(){this._coordCache=[];for(var b=3;b<13;++b){this._calcAtomCoords(b)}},_clearCoordCache:function(){this._coordCache=[]},_setCoordToCache:function(e,d,c){var b=this._coordCache[d];if(!b){b=[];this._coordCache[d]=b}b[c]=e},_getCachedCoord:function(d,c){var b=this._coordCache[d];return b&&b[c]},_getCachedCoords:function(b){return this._coordCache[b]},_hasCoordCache:function(b){return !!(this._coordCache&&this._coordCache[b])}});Kekule.Editor.MolChainRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolChainRepositoryItem2D",STEP_X_INC:Math.cos(30/180*Math.PI),STEP_Y_INC:Math.sin(30/180*Math.PI),initialize:function($super,c,b){$super();this.setAtomCount(c);this.setBondLength(b||1)},initProperties:function(){this.defineProp("atomCount",{dataType:DataType.INT});this.defineProp("bondLength",{dataType:DataType.FLOAT});this.defineProp("negativeDirection",{dataType:DataType.BOOL});this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getEnableCoordCache()){this.setPropStoreFieldValue("enableCoordCache",b);if(b&&!this._coordCache){this._initCoordCache()}}}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(c,b){var d=b&&b.originalStructFragment;return this.generateChain(d)},doGetMergableNode:function(b,c){return b.getNodeAt(0)},doGetMergableConnector:function(b,c){return null},generateChain:function(m,b){if(!b){b=Kekule.Molecule}var g=m||new b();var c=this.getAtomCount();var d=this.getBondLength()||1;var q=this.getNegativeDirection();g.beginUpdate();try{g.setCoord2D({x:0,y:0});var j=g.getNodeCount();if(j>c){for(var h=j-1;h>=c;--h){g.removeNodeAt(h)}}var o=g.getConnectorCount();if(o>c-1){for(var h=o-1;h>=c-1;--h){g.removeConnectorAt(h)}}var f,p,r;for(var h=0,e=c;h<e;++h){f=p;var n=false;var p=g.getNodeAt(h);if(!p){p=this._generateAtom(h);n=true}var k=this._getCachedCoord(h);if(!k){k=this._calcAtomCoord(h)}if(d!==1){k=Kekule.CoordUtils.multiply(k,d)}if(q){k={x:k.x,y:-k.y}}p.setCoord2D(k);if(n){g.appendNode(p)}if(f&&n){r=this._generateBond(h-1,h);g.appendConnector(r);r.appendConnectedObj(f);r.appendConnectedObj(p)}}}finally{g.endUpdate()}this.setMolManipulationCenterCoord({x:0,y:0});this.setMolManipulationDefDirectionCoord({x:1,y:0});return g},_generateAtom:function(b){return new Kekule.Atom(null,"C")},_generateBond:function(d,c){var b=Kekule.BondOrder.SINGLE;return new Kekule.Bond(null,null,b)},_calcAtomSetCoords:function(b){var e=this.getEnableCoordCache();var d=1;var g={x:this.STEP_X_INC*d,y:this.STEP_Y_INC*d};var n=[];var c={x:0,y:0};n.push(c);this._coordCache[0]=c;var h,k,m;for(var j=1,f=b;j<f;++j){c={x:c.x+g.x,y:(j%2)?g.y:0};n.push(c);if(e){this._coordCache[j]=c}}return n},_calcAtomCoord:function(d){var e=1;var c={x:this.STEP_X_INC*e,y:this.STEP_Y_INC*e};var b={x:c.x*d,y:(d%2)?c.y:0};if(this._coordCache){this._coordCache[d]=b}return b},_initCoordCache:function(){this._coordCache=[];var b=this._calcAtomSetCoords(30)},_clearCoordCache:function(){this._coordCache=[]},_getCachedCoord:function(b){return this._coordCache&&this._coordCache[b]}});Kekule.Editor.PathGlyphRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.PathGlyphRepositoryItem2D",initialize:function($super,c,d,b){$super();this.setGlyphClass(c);this.setGlyphRefLength(d||1);this.setGlyphInitialParams(b)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT});this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:false});this.defineProp("glyphInitialParams",{dataType:DataType.HASH})},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},doGetRefLength:function(){return this.getGlyphRefLength()},createObjects:function(b){var c=this.generateGlyph();var d={x:0,y:0};return{objects:[c],mergeObj:null,mergeDest:null,baseObjCoord:d,centerCoord:d}},generateGlyph:function(){var b=this.getGlyphClass();var c=new b(null,this.getGlyphRefLength(),this.getGlyphInitialParams());return c}});Kekule.Editor.RepositoryItemManager={_itemClassMap:new Kekule.MapEx(true),_itemNameMap:new Kekule.MapEx(true),getAllItems:function(b){return a._itemClassMap.get(b)},getItem:function(b){return a._itemNameMap.get(b)},register:function(e){var d=e.getName();var f;if(d){f=a.getItem();a._itemNameMap.set(d,e)}var c=e.getClass();var b=a.getAllItems(c);if(!b){b=[e];a._itemClassMap.set(c,b)}else{if(f){Kekule.ArrayUtils.replace(b,f,e)}else{Kekule.ArrayUtils.pushUnique(b,e)}}},unregister:function(e){var c=e.getClass();var b=a.getAllItems(c);if(b){Kekule.ArrayUtils.remove(b,e)}var d=e.getName();if(d){a._itemNameMap.remove(d)}}};var a=Kekule.Editor.RepositoryItemManager;Kekule._registerAfterLoadSysProc(function(){if(Kekule.Editor.RepositoryData){var f=Kekule.Editor.RepositoryData.subGroups||[];for(var c=0,b=f.length;c<b;++c){var d=f[c];var e=new Kekule.Editor.StoredSubgroupRepositoryItem2D(d.structData,d.dataFormat,d.scale);e.setInputTexts(d.inputTexts).setName(d.name||d.inputTexts[0]);a.register(e)}var f=Kekule.Editor.RepositoryData.fragments||[];for(var c=0,b=f.length;c<b;++c){var d=f[c];var e=new Kekule.Editor.StoredStructFragmentRepositoryItem2D(d.structData,d.dataFormat,d.scale);e.setName(d.name);a.register(e)}}})})();(function(){var a=Kekule.ArrayUtils;var b=Kekule.Widget.HtmlClassNames;var c=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{STRUCTURE_NODE_SELECT_PANEL:"K-Chem-StructureNodeSelectPanel",STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureNodeSelectPanel-SetButton",STRUCTURE_NODE_SETTER:"K-Chem-StructureNodeSetter",STRUCTURE_NODE_SETTER_INPUTBOX:"K-Chem-StructureNodeSetter-InputBox",STRUCTURE_CONNECTOR_SELECT_PANEL:"K-Chem-StructureConnectorSelectPanel",STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureConnectorSelectPanel-SetButton",CHARGE_SELECT_PANEL:"K-Chem-Charge-SelectPanel",CHARGE_SELECT_PANEL_BTNGROUP:"K-Chem-Charge-SelectPanel-BtnGroup",CHARGE_SELECT_PANEL_CHARGE_BTN:"K-Chem-Charge-SelectPanel-ChargeBtn"});Kekule.ChemWidget.StructureNodeSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSelectPanel",BTN_DATA_FIELD:"__$btn_data__",initialize:function($super,d){this.setPropStoreFieldValue("displayElements",true);this.setPropStoreFieldValue("displayNonElements",true);this.setPropStoreFieldValue("displaySubgroups",true);$super(d);this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("elementSymbols",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC});this.defineProp("nonElementInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC});this.defineProp("subGroupInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC});this.defineProp("subGroupRepItems",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(d){this.setPropStoreFieldValue("subGroupRepItems",d);this._updateSubGroupInfosFromRepItems(d)}});this.defineProp("displayElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED});this.defineProp("displayNonElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED});this.defineProp("displaySubgroups",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED});this.defineProp("activeNode",{dataType:DataType.ARRAY,serializable:false,setter:function(d){this.setPropStoreFieldValue("activeNode",d);this.activeNodeChanged(d)}});this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PRIVATE,serializable:false,setter:null,getter:function(g){var e=this.getPropStoreFieldValue("periodicTableDialog");if(!e&&g){var d=this.getCoreElement();var f=this.getDocument();e=this._createPeriodicTableDialogWidget(f,d);this.setPropStoreFieldValue("periodicTableDialog",e)}return e}})},initPropValues:function($super){return $super()},doFinalize:function($super){var d=this.getPeriodicTableDialog();if(d){d.finalize()}$super()},setSelectableInfos:function(d){this.beginUpdate();try{this.setPropValues(d)}finally{this.endUpdate()}},reactSelButtonExec:function(h){var d=this;var f=h.target;if(this._selButtons.indexOf(f)>=0){var g=f[this.BTN_DATA_FIELD];if(g){if(g.isPeriodicTable){this._openPeriodicTableDialog(f,function(e){if(e===Kekule.Widget.DialogButtons.OK){var i=d._periodicTable.getSelectedSymbol();d.notifyValueChange(d.generateSelectableDataFromElementSymbol(i))}},{isSimpleAtom:true})}else{if(g.isVarList||g.isVarNotList){this._openPeriodicTableDialog(f,function(e){if(e===Kekule.Widget.DialogButtons.OK){var j=d._periodicTable.getSelectedSymbols();var i=Kekule.VariableAtom;var k=g.isVarList?{allowedIsotopeIds:j,disallowedIsotopeIds:null}:{allowedIsotopeIds:null,disallowedIsotopeIds:j};d.notifyValueChange({nodeClass:i,props:k})}},{isVarList:g.isVarList,isVarNotList:g.isVarNotList})}else{this.notifyValueChange(g)}}}}},notifyValueChange:function(d){this.invokeEvent("valueChange",{value:{nodeClass:d.nodeClass,props:d.props,repositoryItem:d.repositoryItem}})},activeNodeChanged:function(d){},doObjectChange:function(d){var e=["elementSymbols","nonElementInfos","subGroupInfos","displayElements","displayNonElements","displaySubGroups"];if(Kekule.ArrayUtils.intersect(d,e).length){this.updatePanelContent(this.getDocument(),this.getCoreElement())}},doGetWidgetClassName:function($super){return $super()+" "+c.STRUCTURE_NODE_SELECT_PANEL},doCreateRootElement:function(e){var d=e.createElement("span");return d},doCreateSubElements:function($super,f,e){var d=$super(f,e);this.updatePanelContent(f,e);return d},_updateSubGroupInfosFromRepItems:function(d){var n=[];if(d&&d.length){for(var j=0,g=d.length;j<g;++j){var h=d[j];var m=h.getStructureFragment();var o=m.getAbbr();if(!o){var p=m.getFormulaText();var k=Kekule.FormulaUtils.textToFormula(p);var e=k.getDisplayRichText();o=Kekule.Render.RichTextUtils._toDebugHtml(e)}var f={text:o,repositoryItem:h,nodeClass:m.getClass(),node:m,hint:h.getName()};n.push(f)}this.setSubGroupInfos(n)}},updatePanelContent:function(m,g){if(this._selButtons){for(var j=this._selButtons.length-1;j>=0;--j){var e=this._selButtons[j];this.removeWidget(e)}}this._selButtons=[];Kekule.DomUtils.clearChildContent(g);var d=this.generateSelectableData();var h=this._getDisplayedTabPageNames();var f=new Kekule.Widget.TabView(this);if(h.indexOf("atom")>=0){var n=f.createNewTabPage(Kekule.$L("ChemWidgetTexts.CAPTION_ATOM"));if(this.getDisplayElements()){var l=this.doCreateSelButtonSection(m,n.getCoreElement(),d.elementData)}if(this.getDisplayNonElements()){var l=this.doCreateSelButtonSection(m,n.getCoreElement(),d.nonElementData,true)}}if(h.indexOf("subgroup")>=0){var k=f.createNewTabPage(Kekule.$L("ChemWidgetTexts.CAPTION_SUBGROUP"));var l=this.doCreateSelButtonSection(m,k.getCoreElement(),d.subGroupData,true)}f.setShowTabButtons(h.length>1)},_getDisplayedTabPageNames:function(){var d=[];if(this.getDisplayElements()||this.getDisplayNonElements()){d.push("atom")}if(this.getDisplaySubgroups()){d.push("subgroup")}return d},generateSelectableDataFromElementSymbol:function(f){var d=f;var e=Kekule.IsotopesDataUtil.getIsotopeInfoById(f);if(e){if(e.isotopeAlias){d=e.isotopeAlias}else{d="<sup>"+e.massNumber+"</sup>"+e.elementSymbol}}return{text:d,nodeClass:Kekule.Atom,props:{isotopeId:f}}},generateSelectableData:function(){var g=this.getElementSymbols()||[];var j=[];for(var h=0,f=g.length;h<f;++h){var k;if(g[h]==="..."){k={text:"\u2026",nodeClass:null,hint:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE"),isPeriodicTable:true}}else{k=this.generateSelectableDataFromElementSymbol(g[h])}j.push(k)}var e=this.getNonElementInfos();var d=this.getSubGroupInfos();return{elementData:j,nonElementData:e,subGroupData:d}},doCreateSelButton:function(j,e,h,g){var f=h.text;if(g&&h.description){f+='<span style="font-size:80%"> '+h.description+"</span>"}var i=Kekule.Widget.Button;var d=new i(j,f);d.addClassName(c.STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON);if(d.setGroup){d.setGroup(this.getClassName())}if(h.hint){d.setHint(h.hint)}d[this.BTN_DATA_FIELD]=h;this._selButtons.push(d);return d},doCreateSectionSelButtons:function(k,h,j,e){if(!j){return}for(var g=0,d=j.length;g<d;++g){var f=this.doCreateSelButton(k,h,j[g],e);f.setParent(this);f.appendToElem(h)}},doCreateSection:function(f,e){var d=f.createElement("div");d.className=b.SECTION;if(e){e.appendChild(d)}return d},doCreateSelButtonSection:function(h,d,f,e){var g=this.doCreateSection(h,d);this.doCreateSectionSelButtons(h,g,f,e);return g},_createPeriodicTableDialogWidget:function(g,d){var e=new Kekule.Widget.Dialog(g,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);var f=new Kekule.ChemWidget.PeriodicTable(g);f.setUseMiniMode(true).setEnableSelect(true);f.setParent(e);f.appendToElem(e.getClientElem());this._periodicTable=f;return e},_openPeriodicTableDialog:function(d,k,h){var f=this.getPeriodicTableDialog(true);var e=h.isVarList||h.isVarNotList;this._periodicTable.setEnableMultiSelect(e).setSelectedSymbol(null);var g=this.getActiveNode();if((h.isVarList||h.isVarNotList)&&g instanceof Kekule.VariableAtom){var i=g.getAllowedIsotopeIds();var j=g.getDisallowedIsotopeIds();this._periodicTable.setSelectedSymbols(h.isVarList?i:j)}if(!e&&g instanceof Kekule.Atom){this._periodicTable.setSelectedSymbol(g.getSymbol())}f.openPopup(k,this||d)}});Kekule.ChemWidget.StructureNodeSetter=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSetter",initialize:function($super,d){$super(d);this._valueSetBySelectPanel=false},initProperties:function(){this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:false,setter:function(e){var d=Kekule.ArrayUtils.toArray(e);this.setPropStoreFieldValue("nodes",d);this.nodesChanged(d)}});this.defineProp("value",{dataType:DataType.HASH,serializable:false,setter:null,getter:function(){var d=this.getPropStoreFieldValue("value");if(!d&&!this._valueSetBySelectPanel){var e=this.getNodeInputBox().getValue();d=this._getValueFromDirectInputText(e)}return d}});this.defineProp("nodeLabel",{dataType:DataType.STRING,serializable:false,setter:null,getter:function(){return this.getNodeInputBox().getValue()}});this.defineProp("nodeInputBox",{dataType:"Kekule.Widget.ButtonTextBox",serializable:false,setter:false});this.defineProp("nodeSelectPanel",{dataType:"Kekule.ChemWidget.StructureNodeSelectPanel",serializable:false,setter:false});this.defineProp("showInputBox",{dataType:DataType.BOOL,getter:function(){return this.getNodeInputBox().getDisplayed()},setter:function(d){this.getNodeInputBox().setDisplayed(d)}});this.defineProp("showSelectPanel",{dataType:DataType.BOOL,getter:function(){return this.getNodeSelectPanel().getDisplayed()},setter:function(d){this.getNodeSelectPanel().setDisplayed(d)}});this.defineProp("useDropDownSelectPanel",{dataType:DataType.BOOL,setter:function(d){if(this.getUseDropDownSelectPanel()!==d){this.setPropStoreFieldValue("useDropDownSelectPanel",d);this._updateDropDownSettings(d)}}});this.defineProp("labelConfigs",{dataType:DataType.OBJECT,serializable:false});this._defineSelectPanelDelegatedProp("selectableElementSymbols","elementSymbols");this._defineSelectPanelDelegatedProp("selectableNonElementInfos","nonElementInfos");this._defineSelectPanelDelegatedProp("selectableSubGroupInfos","subGroupInfos");this._defineSelectPanelDelegatedProp("selectableSubGroupRepItems","subGroupRepItems");this._defineSelectPanelDelegatedProp("displaySelectableElements","displayElements");this._defineSelectPanelDelegatedProp("displaySelectableNonElements","displayNonElements");this._defineSelectPanelDelegatedProp("displaySelectableSubgroups","displaySubgroups")},initPropValues:function($super){$super()},doFinalize:function($super){var d=this.getNodeSelectPanel();d.finalize();$super()},_defineSelectPanelDelegatedProp:function(g,d){if(!d){d=g}var e=ClassEx.getPropInfo(Kekule.ChemWidget.StructureNodeSelectPanel,d);var f=Object.create(e);f.getter=null;f.setter=null;if(e.getter){f.getter=function(){return this.getNodeSelectPanel().getPropValue(d)}}if(e.setter){f.setter=function(h){this.getNodeSelectPanel().setPropValue(d,h)}}return this.defineProp(g,f)},doGetWidgetClassName:function($super){return $super()+" "+c.STRUCTURE_NODE_SETTER},doCreateRootElement:function(e){var d=e.createElement("span");return d},doCreateSubElements:function($super,i,g){var d=$super(i,g);var f=this;var h=new Kekule.Widget.ButtonTextBox(this);this.setPropStoreFieldValue("nodeInputBox",h);h.addClassName(c.STRUCTURE_NODE_SETTER_INPUTBOX);h.appendToElem(this.getCoreElement());h.addEventListener("valueChange",function(j){f._valueSetBySelectPanel=false;j.stopPropagation()});h.addEventListener("keyup",function(l){var j=l.htmlEvent;var k=j.getKeyCode();if(k===Kekule.X.Event.KeyCode.ENTER){f._applyDirectInput()}if(f.getUseDropDownSelectPanel()){if(k===Kekule.X.Event.KeyCode.DOWN){f.showNodeSelectPanel()}else{if(k===Kekule.X.Event.KeyCode.UP){f.hideNodeSelectPanel()}}}});h.addEventListener("blur",function(j){if(j.target===h.getTextBox()&&h.getIsDirty()){f._applyDirectInput()}});h.getButton().addEventListener("execute",function(j){if(f.getUseDropDownSelectPanel()){f.toggleNodeSelectPanel()}else{f._applyDirectInput()}});var e=new Kekule.ChemWidget.StructureNodeSelectPanel(this);this.setPropStoreFieldValue("nodeSelectPanel",e);e.appendToElem(this.getCoreElement());e.addEventListener("valueChange",function(k){var j=Object.extend({},k);k.stopPropagation();f._valueSetBySelectPanel=true;f.notifyValueChange(k.value,true);if(f.getUseDropDownSelectPanel()){e.hide()}});this._updateDropDownSettings(this.getUseDropDownSelectPanel());return d},_updateDropDownSettings:function(d){var e=this.getNodeInputBox();var f=this.getNodeSelectPanel();if(d){e.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);f.removeFromDom()}else{e.setButtonKind(Kekule.Widget.Button.Kinds.ENTER);f.appendToElem(this.getCoreElement());f.setStyleProperty("position","");f.show(null,null,Kekule.Widget.ShowHideType.DEFAULT)}},_indexOfNonElementLabel:function(h){var g=this.getNonAtomLabelInfos();for(var e=0,d=g.length;e<d;++e){var f=g[e];if(f.nodeLabel===h){return e}}return -1},_getNonAtomInfo:function(h){var g=this.getSelectableNonElementInfos();if(g){for(var e=0,d=g.length;e<d;++e){var f=g[e];if(f.text===h){return f}}}return null},_getValueFromDirectInputText:function(l){var d,i,j,g,e;var k=this._getNonAtomInfo(l);if(k){d=k.nodeClass;i=k.props}else{var f=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(l);g=f;if(f){j=f.getStructureFragment();d=j.getClass()}else{if(l){d=Kekule.ChemStructureNodeFactory.getClassByLabel(l,null);if(!d){d=Kekule.Pseudoatom;e=true}i=(d===Kekule.Atom)?{isotopeId:l}:(d===Kekule.Pseudoatom)?{symbol:l}:{}}}}var h={nodeClass:d,props:i,repositoryItem:g,isUnknownPseudoatom:e};return h},_applyDirectInput:function(){this._valueSetBySelectPanel=false;var d=this.getNodeInputBox();var f=d.getValue();var e=this._getValueFromDirectInputText(f);this.notifyValueChange(e);d.setIsDirty(false)},_getVarAtomListLabel:function(){var d=this.getLabelConfigs();return d?d.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var d=this.getLabelConfigs();return"~"+(d?d.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM)},_getAllNodeLabels:function(d){return Kekule.Editor.StructureUtils.getAllChemStructureNodesLabel(d,this.getLabelConfigs())},nodesChanged:function(d){var f=this._getAllNodeLabels(d)||"";var e=f?d[0]:null;this.getNodeSelectPanel().setActiveNode(e);this.getNodeInputBox().setValue(f);this.getNodeInputBox().setIsDirty(false);this.setPropStoreFieldValue("value",null);this._valueSetBySelectPanel=false},notifyValueChange:function(e,d){this.setPropStoreFieldValue("value",e);var f={nodeClass:e.nodeClass,props:e.props,repositoryItem:e.repositoryItem,isUnknownPseudoatom:e.isUnknownPseudoatom};if(d){this.invokeEvent("valueSelect",{value:f})}this.invokeEvent("valueChange",{value:f})},setSelectableInfos:function(d){this.getNodeSelectPanel().setSelectableInfos(d)},showNodeSelectPanel:function(){var d=this.getNodeSelectPanel();if(!d.isShown()){d.show(this.getNodeInputBox(),null,Kekule.Widget.ShowHideType.DROPDOWN)}},hideNodeSelectPanel:function(){var d=this.getNodeSelectPanel();if(d.isShown()){d.hide()}},toggleNodeSelectPanel:function(){var d=this.getNodeSelectPanel();if(d.isShown()){d.hide()}else{d.show(this.getNodeInputBox(),null,Kekule.Widget.ShowHideType.DROPDOWN)}}});Kekule.ChemWidget.StructureConnectorSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureConnectorSelectPanel",BTN_DATA_FIELD:"__$btn_data__",BTN_GROUP:"__$bond_btn_group__",initialize:function($super,d){$super(d);this._selButtons=[];this._activeBtn=null;this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("bondData",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC});this.defineProp("activeBondPropValues",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC,setter:function(d){this.setPropStoreFieldValue("activeBondPropValues",d);this.activeBondPropsChanged(d)}});this.defineProp("activeBondHtmlClass",{dataType:DataType.STRING,scope:Class.PropertyScope.PRIVATE,setter:null,getter:function(){var d=this._activeBtn;if(d){var e=d[this.BTN_DATA_FIELD];return e&&e.htmlClass}return null}});this.defineProp("bondPropNames",{dataType:DataType.ARRAY,serializable:false})},doObjectChange:function(d){var e=["bondData"];if(Kekule.ArrayUtils.intersect(d,e).length){this.updatePanelContent(this.getDocument(),this.getCoreElement())}},doGetWidgetClassName:function($super){return $super()+" "+c.STRUCTURE_CONNECTOR_SELECT_PANEL},doCreateRootElement:function(e){var d=e.createElement("span");return d},doCreateSubElements:function($super,f,e){var d=$super(f,e);this.updatePanelContent(f,e);return d},activeBondPropsChanged:function(h){if(this._activeBtn){this._activeBtn.setChecked(false);this._activeBtn=null}if(h){var f=this._selButtons;for(var e=0,d=f.length;e<d;++e){var g=f[e][this.BTN_DATA_FIELD];if(g&&this._isBondPropsMatch(h,g.bondProps,this.getBondPropNames())){f[e].setChecked(true);this._activeBtn=f[e];break}}}},_isBondPropsMatch:function(e,d,f){return Kekule.Editor.StructureUtils.isBondPropsMatch(e,d,f)},reactSelButtonExec:function(h){var d=this;var f=h.target;if(this._selButtons.indexOf(f)>=0){this._activeBtn=f;var g=f[this.BTN_DATA_FIELD];if(g){this.setPropStoreFieldValue("activeBondPropValues",g.bondProps);this.notifyValueChange(g.bondProps)}}},notifyValueChange:function(d){this.invokeEvent("valueChange",{value:d})},updatePanelContent:function(m,e){if(this._selButtons){for(var j=this._selButtons.length-1;j>=0;--j){var d=this._selButtons[j];this.removeWidget(d)}}var n=[];this._selButtons=[];var g=this.getBondData();if(g){for(var j=0,f=g.length;j<f;++j){var h=g[j];var k=h.bondProps;var d=this._createBondSelButton(m,h);d.appendToElem(e);this._selButtons.push(d);if(k){a.pushUnique(n,Kekule.ObjUtils.getOwnedFieldNames(k))}}}if(!this.getBondPropNames()){this.setPropStoreFieldValue("bondPropNames",n)}},_createBondSelButton:function(f,e){var d=new Kekule.Widget.RadioButton(this);d.addClassName(c.STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON);d.setGroup(this.BTN_GROUP).setShowGlyph(true).setShowText(false);d.setText(e.text||null).setHint(e.hint||e.description||null);if(e.htmlClass){d.addClassName(e.htmlClass)}d[this.BTN_DATA_FIELD]=e;return d}});Kekule.ChemWidget.ChargeSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.ChargeSelectPanel",CHARGE_FIELD:"__$charge__",initialize:function($super,d){this._chargeBtnGroups={};this._selectedButton=null;this._chargeButtonMap=[];$super(d);this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(g){var e=this.getValue();if(g!==e){var d=this._chargeButtonMap[e];if(d){d.setChecked(false);d.blur()}this.setPropStoreFieldValue("value",g);var f=this._chargeButtonMap[g];if(f){f.setChecked(true)}this._selectedButton=f}}});this.defineProp("minCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC});this.defineProp("maxCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC})},initPropValues:function($super){$super();this.setMaxCharge(4).setMinCharge(-4)},doGetWidgetClassName:function($super){return $super()+" "+c.CHARGE_SELECT_PANEL},doCreateSubElements:function($super,f,e){var d=$super(f,e);this.updateChargeButtons(f,e);return d},updateChargeButtons:function(n,f){var g=this._chargeBtnGroups;var q=["zero","positive","negative"];for(var j=0,h=q.length;j<h;++j){var p=g[q[j]];if(p){p.clearWidgets()}else{p=new Kekule.Widget.ButtonGroup(this);p.addClassName(c.CHARGE_SELECT_PANEL_BTNGROUP);p.appendToElem(f);g[q[j]]=p}}var e=Math.floor(this.getMaxCharge());var m=Math.floor(this.getMinCharge());var d;var o=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE");var k=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE");if(e>=1){var p=this._chargeBtnGroups.positive;for(var j=Math.max(m,1);j<=e;++j){d=this._createChargeButton(p,j,j+o)}}if(e>=0&&m<=0){var p=this._chargeBtnGroups.zero;d=this._createChargeButton(p,0,Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NONE"),Kekule.$L("ChemWidgetTexts.HINT_CHARGE_NONE"))}if(m<=-1){var p=this._chargeBtnGroups.negative;for(var j=Math.min(e,-1);j>=m;--j){d=this._createChargeButton(p,j,Math.abs(j)+k)}}},_createChargeButton:function(h,e,g,f){var d=new Kekule.Widget.RadioButton(h,g);d[this.CHARGE_FIELD]=e;this._chargeButtonMap[e]=d;if(f){d.setHint(f)}d.addClassName(c.CHARGE_SELECT_PANEL_CHARGE_BTN);d.appendToWidget(h);if(this.getValue()===e){d.setChecked(true);this._selectedButton=d}return d},reactSelButtonExec:function(g){var f=g.target;var d=f[this.CHARGE_FIELD];if(Kekule.ObjUtils.notUnset(d)){this.setValue(d);this.notifyValueChange(d)}},notifyValueChange:function(d){this.invokeEvent("valueChange",{value:d})}})})();(function(){var a=Kekule.ArrayUtils;var b=Kekule.CoordUtils;var d=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMSPACE_EDITOR:"K-Chem-Space-Editor",CHEMSPACE_EDITOR2D:"K-Chem-Space-Editor2D",CHEMSPACE_EDITOR3D:"K-Chem-Space-Editor3D",CHEMEDITOR_ATOM_SETTER:"K-ChemEditor-Atom-Setter",CHEMEDITOR_TEXT_SETTER:"K-ChemEditor-Text-Setter",CHEMEDITOR_FORMULA_SETTER:"K-ChemEditor-Formula-Setter"});Kekule.Editor.ChemSpaceEditor=Class.create(Kekule.Editor.BaseEditor,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor",initialize:function($super,e,h,g,f){this.setPropStoreFieldValue("allowCreateNewChild",true);this.setPropStoreFieldValue("autoCreateNewStructFragment",true);$super(e,h,g,f);this._containerChemSpace=null},initProperties:function(){this.defineProp("chemSpace",{dataType:"Kekule.ChemSpace",serializable:false,getter:function(){return this.getChemObj()},setter:function(e){this.setChemObj(e)}});this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("autoCreateNewStructFragment")&&this.canCreateNewChild()}});this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL})},canCreateNewChild:function(){return this.getChemSpace()&&(this.getAllowCreateNewChild()||(this.getChemSpace().getChildCount()<=0))},getActualDrawOptions:function($super){var e=$super();e.useExplicitSpaceSize=true;return e},doSetChemObj:function($super,g){var e=this.getChemObj();if(e!==g){if(e&&this._containerChemSpace){e.finalize();this._containerChemSpace=null}if(g){if(g instanceof Kekule.ChemSpace){this._initChemSpaceDefProps(g);return $super(g)}else{var f=this.createContainerChemSpace(null,g);this._containerChemSpace=f;$super(f)}}else{$super(g)}}else{$super(g)}},getExportableClasses:function($super){var e=$super();var h=this.getChemSpace();if(h){for(var g=0,f=h.getChildCount();g<f;++g){var j=h.getChildAt(g);if(j&&j.getClass){Kekule.ArrayUtils.pushUnique(e,j.getClass())}}}return e},exportObjs:function($super,g){var e=$super(g);if((!e||!e.length)&&g){e=[];var j=this.getChemSpace();if(j){for(var h=0,f=j.getChildCount();h<f;++h){var k=j.getChildAt(h);if(k&&(k instanceof g)){e.push(k)}}}}return e},getSavingTargetObj:function($super){var f=this.getChemSpace();var e=f.getChildCount();if(e===1){return f.getChildAt(0)}else{return $super()}},createDefaultConfigs:function(){return Kekule.Editor.ChemSpaceEditorConfigs.getInstance()},doCreateNewDocObj:function(){return this.createContainerChemSpace()},doLoad:function($super,e){this._supplyChemMarkersOnObj(e);$super(e)},doLoadEnd:function($super,i){var e=$super(i);var g=null;if(i){var f=i.getAllContainingConnectors();if(f&&f.length){var h=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;g=Kekule.ChemStructureUtils.getConnectorLengthMedian(f,h,this.getAllowCoordBorrow())}}this.setDefBondLength(g);return e},resetDisplay:function($super){$super();var h=this.getChemObj();if(h){var f=h.getScreenSize();this.changeClientSize(f.x,f.y,this.getCurrZoom());var g=this.getEditClientElem().parentNode;var e=Kekule.HtmlElementUtils.getElemClientDimension(g);this.scrollClientTo(0,(f.x*this.getCurrZoom()-e.width)/2)}},zoomChanged:function($super,g){$super();var f=this.getChemObj();if(f){var e=f.getScreenSize();this.changeClientSize(e.x,e.y,g)}},createNewBoundInfoRecorder:function($super,f){$super(f);var e=this.getBoundInfoRecorder();if(e){e.addEventListener("updateBasicDrawObject",this.reactUpdateBasicDrawObject,this)}},reactUpdateBasicDrawObject:function(h){var g=h.obj;if(g&&(g instanceof Kekule.TextBlock)){var f=h.boundInfo;this.updateTextBlockSize(g,f)}},objectChanged:function($super,f,e){return $super(f,e)},updateTextBlockSize:function(f,g){if(this.getCoordMode()!==Kekule.CoordMode.COORD2D){return}if(!f.getNeedRecalcSize()){return}var e=g.shapeType;if(e===Kekule.Render.BoundShapeType.RECT){}},createContainerChemSpace:function(e,h){var p=new Kekule.ChemDocument(e);this._initChemSpaceDefProps(p,h);if(h){p.appendChild(h);var g=p.getSizeOfMode(this.getCoordMode(),this.getAllowCoordBorrow());var k,l;var i=Kekule.Render.ObjUtils.getContainerBox(h,this.getCoordMode(),this.getAllowCoordBorrow());if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var n=this.getEditorConfigs().getChemSpaceConfigs().getDefPadding();var l=p.getObjScreenLengthRatio()}var j=h.getAbsBaseCoord?h.getAbsBaseCoord(this.getCoordMode(),this.getAllowCoordBorrow())||{}:{};if(l&&i){k=Kekule.CoordUtils.divide(g,2);var f={x:(i.x1+i.x2)/2,y:(i.y1+i.y2)/2};var o={x:k.x,y:g.y-n*l-(i.y2-i.y1)/2};var m=Kekule.CoordUtils.substract(o,f);k=Kekule.CoordUtils.add(j,m)}else{k=Kekule.CoordUtils.divide(g,2)}if(h.setAbsBaseCoord){h.setAbsBaseCoord(k,this.getCoordMode())}}return p},_initChemSpaceDefProps:function(h,i){var j=this.getEditorConfigs();var e=j.getChemSpaceConfigs();if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var f=h.getScreenSize();if(!f.x&&!f.y){f=e.getDefScreenSize2D();h.setScreenSize(f)}if(!h.getDefAutoScaleRefLength()){var m;if(i&&i.getAllAutoScaleRefLengths){var g=i.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow());m=g&&g.length?Kekule.ArrayUtils.getMedian(g):null}else{var g=h.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow());m=g.length?Kekule.ArrayUtils.getMedian(g):null}if(!m){m=j.getStructureConfigs().getDefBondLength()}h.setDefAutoScaleRefLength(m)}if(!h.getSize2D()){var l=this.getRenderConfigs().getLengthConfigs().getDefBondLength();var k=h.getDefAutoScaleRefLength()/l;h.setObjScreenLengthRatio(k);h.setSize2D({x:f.x*k,y:f.y*k})}}},createNewStructFragmentAnchor:function(f){if(this.getAutoCreateNewStructFragment()){var e=new Kekule.Molecule(f);this.getChemSpace().appendChild(e);return e}else{return null}},createStructStartingAtom:function(g,i,e,f){this.beginUpdateObject();try{if(g){if(!f){f=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId()}var h=new Kekule.Atom(null,f);g.appendNode(h);h.setAbsCoordOfMode(e,this.getCoordMode());return h}else{return null}}finally{this.endUpdateObject()}},createNewStructFragmentAndStartingAtom:function(h,e,f){this.beginUpdateObject();try{var g;g=this.createNewStructFragmentAnchor(h);if(g){return this.createStructStartingAtom(g,h,e,f)}else{return null}}finally{this.endUpdateObject()}},hasOnlyOneBlankStructFragment:function(){var e=false;if(this.getChemSpace().getChildCount()===1){var f=this.getChemSpace().getChildAt(0);if(f instanceof Kekule.StructureFragment){if(f.getNodeCount()<=0&&f.getConnectorCount()<=0&&!f.hasFormula()){e=true}}}return e},getOnlyOneBlankStructFragment:function(){if(this.hasOnlyOneBlankStructFragment()){return this.getChemSpace().getChildAt(0)}},canAddNewStandaloneObject:function(){return this.getAllowCreateNewChild()||(this.getChemSpace().getChildCount()<=0)},canAddUnconnectedStructFragment:function(){return this.canAddNewStandaloneObject()||this.hasOnlyOneBlankStructFragment()},canCloneObjects:function(){return this.getAllowCreateNewChild()},cloneObjects:function(e,f,m){if(!this.getChemSpace()){return null}var u=this.getAllowCreateNewChild();var q=function(G,F){for(var E=0,D=F.length;E<D;++E){var H=F[E];if((H.isChildOf(G))){return true}}return false};var p=function(G,F,D){if(D.indexOf(F)>=0){a.remove(D,F);return}if(G.getChildAt&&F.getChildAt){var l=F.getChildCount();for(var E=l-1;E>=0;--E){var I=G.getChildAt(E);if(!D.length){G.removeChild(I);continue}var H=F.getChildAt(E);if(D.indexOf(H)>=0){a.remove(D,H)}else{if(q(H,D)){if(H.getChildObjs){p(I,H,D)}}else{G.removeChild(I)}}}}};var z=Kekule.ArrayUtils.toArray(e);var A=[];var r=new Kekule.MapEx();for(var v=0,t=z.length;v<t;++v){var o=z[v];var B=o.getStandaloneAncestor?o.getStandaloneAncestor():o;if(B.clone){Kekule.ArrayUtils.pushUnique(A,B);var n=r.get(B);if(!n){n=[];r.set(B,n)}n.push(o)}}var x=this.getChemSpace();var j=[];var w=this.getCoordMode();var y=this.getAllowCoordBorrow();var g=A.length;for(var v=0;v<g;++v){var o=A[v];var h=o.clone();if(h.clearIds){h.clearIds()}p(h,o,r.get(o));if(m&&u){x.appendChild(h);if(f){var s=this.getObjectScreenCoord(h);var k=Kekule.CoordUtils.add(s,f);this.setObjectScreenCoord(h,k)}}j.push(h)}r.finalize();return j},cloneSelection:function(g,f){if(g===undefined){g=this.getDefaultCloneScreenCoordOffset()}var h=this.getSelection();var e=this.cloneObjects(h,g,f);if(f){this.setSelection(e)}return e},getDefaultCloneScreenCoordOffset:function(){var g=this.getEditorConfigs().getInteractionConfigs().getClonedObjectScreenOffset()||0;var e=this.getCoordMode();var f={x:g,y:g};if(e===Kekule.CoordMode.COORD3D){f.z=g}return f},_supplyChemMarkersOnObj:function(h){if(h){var g=Kekule.ChemStructureUtils.getAllStructFragments(h,true);if(g||g.length){for(var f=0,e=g.length;f<e;++f){this._createLosingChemMarkerOnStructFragment(g[f])}}}},_createLosingChemMarkerOnStructFragment:function(j){j.beginUpdate();try{if(j.getCharge&&j.getCharge()){j.fetchChargeMarker(true)}var f=j.getNodes();for(var g=0,e=j.getNodeCount();g<e;++g){var h=j.getNodeAt(g);h.beginUpdate();try{if(h.getCharge()){h.fetchChargeMarker(true)}if(h.getRadical()){h.fetchRadicalMarker(true)}if(h.getNodeAt){this._createLosingChemMarkerOnStructFragment(h)}}finally{h.endUpdate()}}}finally{j.endUpdate()}},getEnabledNonAtomInputData:function(){var e=[];var g=this.getRenderConfigs().getDisplayLabelConfigs();var f=this.getEditorConfigs().getStructureConfigs().getEnabledNonAtomNodeTypes();if(f.RGroup){e.push({text:g.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")})}if(f.pseudoatomDummy){e.push({text:g.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")})}if(f.pseudoatomHetero){e.push({text:g.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")})}if(f.pseudoatomAny){e.push({text:g.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")})}if(f.variableAtomList){e.push({text:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,isVarList:true,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")})}if(f.variableAtomNotList){e.push({text:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,isNotVarList:true,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")})}return e},_getVarAtomListLabel:function(){var e=this.getRenderConfigs().getDisplayLabelConfigs();return e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var e=this.getRenderConfigs().getDisplayLabelConfigs();return"~"+(e?e.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM)},getEnabledBondFormData:function(){var h=Kekule.BondType;var n=Kekule.BondOrder;var k=Kekule.BondStereo;var f=Kekule.$L;var e="K-Chem-MolBondIaController-";var m={single:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),htmlClass:e+"Single",isDefault:true,bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.NONE}},"double":{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),htmlClass:e+"Double",bondProps:{bondType:h.COVALENT,bondOrder:n.DOUBLE,stereo:k.NONE}},triple:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),htmlClass:e+"Triple",bondProps:{bondType:h.COVALENT,bondOrder:n.TRIPLE,stereo:k.NONE}},quad:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_QUAD"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_QUAD"),htmlClass:e+"Quad",bondProps:{bondType:h.COVALENT,bondOrder:n.QUAD,stereo:k.NONE}},explicitAromatic:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_EXPLICIT_AROMATIC"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_EXPLICIT_AROMATIC"),htmlClass:e+"Aromatic",bondProps:{bondType:h.COVALENT,bondOrder:n.EXPLICIT_AROMATIC,stereo:k.NONE}},up:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),htmlClass:e+"WedgeUp",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.UP}},upInverted:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP_INVERTED"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP_INVERTED"),htmlClass:e+"WedgeUpInverted",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.UP_INVERTED}},down:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),htmlClass:e+"WedgeDown",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.DOWN}},downInverted:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN_INVERTED"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN_INVERTED"),htmlClass:e+"WedgeDownInverted",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.DOWN_INVERTED}},upOrDown:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),htmlClass:e+"WedgeUpOrDown",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.UP_OR_DOWN}},closer:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),htmlClass:e+"Closer",bondProps:{bondType:h.COVALENT,bondOrder:n.SINGLE,stereo:k.CLOSER}},eOrZ:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),htmlClass:e+"Double-Either",bondProps:{bondType:h.COVALENT,bondOrder:n.DOUBLE,stereo:k.E_OR_Z}},ionic:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_IONIC"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_IONIC"),htmlClass:e+"Ionic",bondProps:{bondType:h.IONIC}},coordinate:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_COORDINATE"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_COORDINATE"),htmlClass:e+"Coordinate",bondProps:{bondType:h.COORDINATE}},metallic:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_METALLIC"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_METALLIC"),htmlClass:e+"Metallic",bondProps:{bondType:h.METALLIC}},hydrogen:{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_HYDROGEN"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_HYDROGEN"),htmlClass:e+"Hydrogen",bondProps:{bondType:h.HYDROGEN}}};var p={single:{},"double":{text:f("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),hint:f("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE")}};var o=this.getEditorConfigs().getStructureConfigs().getEnabledBondForms();var r=Kekule.ObjUtils.getOwnedFieldNames(o,false);var s=[];for(var j=0,g=r.length;j<g;++j){var q=r[j];if(o[q]){if(DataType.isObjectValue(o[q])){s.push(o[q])}else{if(m[q]){s.push(m[q])}}}}return s}});Kekule.Editor.ChemSpaceEditor.Settings=Class.create(Kekule.Editor.BaseEditor.Settings,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor.Settings",initProperties:function(){this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getAllowCreateNewChild()},setter:function(e){this.getEditor().setAllowCreateNewChild(e)}})}});Kekule.Editor.BasicMolEraserIaController=Class.create(Kekule.Editor.BasicEraserIaController,{CLASS_NAME:"Kekule.Editor.BasicMolEraserIaController",initialize:function($super,e){$super(e)},doGetActualRemovedObjs:function(j){var e=[];Kekule.ArrayUtils.pushUnique(e,j);for(var h=0,g=j.length;h<g;++h){var f=j[h].getCascadeDeleteObjs?j[h].getCascadeDeleteObjs():[];if(f){Kekule.ArrayUtils.pushUnique(e,f)}}return e},doRemoveObjs:function(n){if(!n.length){return}var e=new Kekule.MacroOperation();var p=[];for(var m=0,g=n.length;m<g;++m){var k=n[m];var q=k.getParent();var o=this.getEditor();var f;if(k instanceof Kekule.BaseStructureNode){f=new Kekule.ChemStructOperation.RemoveNode(k,null,null,o);Kekule.ArrayUtils.pushUnique(p,k.getParent())}else{if(k instanceof Kekule.BaseStructureConnector){f=new Kekule.ChemStructOperation.RemoveConnector(k,null,null,o);Kekule.ArrayUtils.pushUnique(p,k.getParent())}else{f=new Kekule.ChemObjOperation.Remove(k,null,null,o)}}if(f){e.add(f)}}for(var m=0,g=p.length;m<g;++m){var j=p[m];if(j&&(j instanceof Kekule.StructureFragment)){var h=new Kekule.ChemStructOperation.StandardizeStructFragment(j,o);h.setEnableSplit(this.getEditor().canCreateNewChild());e.add(h)}}o.execOperation(e)}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolEraserIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.BasicMolManipulationIaController=Class.create(Kekule.Editor.BasicManipulationIaController,{CLASS_NAME:"Kekule.Editor.BasicMolManipulationIaController",initialize:function($super,e){$super(e);this.setEnableMagneticMerge(true);this.setEnableNodeMerge(true);this.setEnableNeighborNodeMerge(true);this.setEnableConnectorMerge(true);this.setEnableStructFragmentMerge(true);this.setEnableConstrainedMove(true);this.setEnableConstrainedRotate(true);this.setEnableConstrainedResize(true);this.setEnableDirectedMove(true);this._suppressConstrainedMoving=false;this._suppressConstrainedRotating=false;this._isInDirectedMoving=false;this._directedMovingDirection=null},initProperties:function(){this.defineProp("enableMagneticMerge",{dataType:DataType.BOOL});this.defineProp("enableNodeMerge",{dataType:DataType.BOOL});this.defineProp("enableNeighborNodeMerge",{dataType:DataType.BOOL});this.defineProp("enableConnectorMerge",{dataType:DataType.BOOL});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL});this.defineProp("allManipulateObjsMerged",{dataType:DataType.BOOL,serializable:false});this.defineProp("isMergeDone",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableConstrainedMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableConstrainedRotate",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableConstrainedResize",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableDirectedMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("mergeOperations",{dataType:DataType.ARRAY,serializable:false});this.defineProp("mergePreviewOperations",{dataType:DataType.ARRAY,serializable:false});this.defineProp("mergingDests",{dataType:DataType.ARRAY,serializable:false})},canInteractWithObj:function($super,e){return $super(e)||(this._isMerging&&e)},doSetManipulateObjs:function($super,e){var f=e?a.clone(e):[];if(this.getMergingDests()&&!this.useMergePreview()){a.pushUnique(f,this.getMergingDests())}this.setPropStoreFieldValue("manipulateObjs",e);if(!e){this.getEditor().endOperatingObjs()}else{this.getEditor().prepareOperatingObjs(f)}},isConstrainedRotate:function(){return this.getEnableConstrainedMove()},isConstrainedResize:function(){return this.getEnableConstrainedResize()},isConstrainedMove:function(){if(!this.getEnableConstrainedMove()){return false}var g=this.getManipulateObjs();if(g.length===1){var f=g[0];var e=this.getEditor().getSelection();if(e&&(e.indexOf(f)<0)){return f.getConstraintManipulationBaseObj&&f.getConstraintManipulationBaseObj()}}return false},isInActualConstrainedRotation:function(){return(this.isConstrainedRotate()&&(!this._suppressConstrainedRotating))},isDirectedMove:function(){return(this.getEnableDirectedMove()&&(!this.isConstrainedMove())&&this._isInDirectedMoving)},useMergePreview:function(){return this._useMergePreview},setUseMergePreview:function(e){this._useMergePreview=e},getMergeOperationsInManipulating:function(){return this._useMergePreview?this.getMergePreviewOperations():this.getMergeOperations()},createManipulateObjInfo:function($super,g,e,h){var i=this.getEditor();var f=$super(g,e,h);var j=this.isConstrainedMove();if(j){var k=g.getConstraintManipulationBaseObj();if(k){f.isConstrained=true;if(!f.hasNoCoord){f.originScreenCoord=i.getObjectScreenCoord(g);f.refScreenCoord=i.getObjectScreenCoord(k);f.connectorScreenLength=Kekule.CoordUtils.getDistance(f.screenCoord,f.refScreenCoord);f.connectorObjLength=Kekule.CoordUtils.getDistance(i.getObjCoord(g),i.getObjCoord(k));var l=Kekule.CoordUtils.substract(f.originScreenCoord,f.refScreenCoord);f.originBondDirectionAngle=Math.atan2(l.y,l.x);f.constrainedBondDirectionDelta=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionDelta();f.constrainedBondDirectionAngles=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngles();f.constrainedBondDirectionAngleThreshold=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngleThreshold()}}}return f},_calcActualMovedScreenCoord:function($super,m,u,j){var n=Kekule.CoordUtils;var k;var s=j;if(u.isConstrained&&(!this._suppressConstrainedMoving)){var p=u.constrainedBondDirectionDelta||null;var q=u.constrainedBondDirectionAngles||null;var f=u.constrainedBondDirectionAngleThreshold||null;var e=false;var w;var v=n.substract(j,u.refScreenCoord);var o=Math.atan2(v.y,v.x);if(q&&f){for(var t=0,r=q.length;t<r;++t){var h=q[t];if(Math.abs(h-o)<=f){e=true;w=h}}}if(!e&&p){var g=Math.round((o-u.originBondDirectionAngle)/p);w=u.originBondDirectionAngle+g*p;e=true}if(!e){w=o}k=n.add(u.refScreenCoord,{x:u.connectorScreenLength*Math.cos(w),y:u.connectorScreenLength*Math.sin(w)})}else{k=s}return k},_calcActualRotateAngle:function($super,k,i,g,h){var e=(this.isConstrainedRotate()&&(!this._suppressConstrainedRotating));var f=e?this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;if(f){var j=Math.round(i/f);return j*f}else{return $super(k,i)}},_calcActualResizeScales:function(i,k){var e=(this.isConstrainedResize()&&(!this._suppressConstrainedResize));if(!e){return k}else{var f=this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep();if(f){var j=(Math.round(k.scaleX/f)||1)*f;var h=(Math.round(k.scaleY/f)||1)*f;var g={scaleX:j,scaleY:h};return g}else{return k}}},prepareManipulating:function($super,i,f,e,j,h,g){this.setUseMergePreview(this.getEditorConfigs().getInteractionConfigs().getEnableMergePreview());this.setMergeOperations([]);this.setMergePreviewOperations([]);$super(i,f,e,j,h,g);this._directedMovingDirection=null;this.setManuallyHotTrack(true)},manipulateEnd:function($super){$super();this.getEditor().hideHotTrack();this.setManuallyHotTrack(false)},createManipulateOperation:function($super){$super();this.setMergeOperations([]);this.setMergePreviewOperations([])},getAllObjOperations:function($super,n){var e;if(n&&this.useMergePreview()){var o=this.getMergePreviewOperations();if(o&&o.length){var k=this.getMergeOperations();for(var m=0,j=o.length;m<j;++m){var h=o[m];if(h){var f=(h instanceof Kekule.ChemStructOperation.MergeConnectorsBase);var g=f?this.createConnectorMergeOperation(h.getTarget(),h.getDest()):this.createNodeMergeOperation(h.getTarget(),h.getDest());k.push(g)}}this.executeMergeOpers(k)}e=k}else{e=this.getMergeOperationsInManipulating()}var p=$super()||[];if(e&&e.length){Kekule.ArrayUtils.pushUnique(p,e)}return p},_canMergeNodes:function(g,h){var f=this.getEnableStructFragmentMerge();var e=this.getEnableNeighborNodeMerge();if(this.getEnableNodeMerge()){return Kekule.ChemStructOperation.MergeNodes.canMerge(g,h,f,e)}else{return false}},_canMergeConnectors:function(f,g){var e=this.getEnableStructFragmentMerge();if(this.getEnableConnectorMerge()){return Kekule.ChemStructOperation.MergeConnectors.canMerge(f,g,e)}else{return false}},_findSuitableMergeTargetBoundInfo:function(f,j,h,e){for(var g=f.length-1;g>=0;--g){var l=f[g];var k=l.obj;if(j.indexOf(k)>=0){continue}if(!(k instanceof h)){continue}if(e&&!e(k)){continue}return l}return null},_getMagneticNodeMergeDest:function(j,l,i){var h=this.getEditor();var f=this;var k=function(m){var n=m.obj;return(j!==n)&&(i.indexOf(n)<0)&&(n instanceof Kekule.ChemStructureNode)&&f._canMergeNodes(j,n)};if(l){var e=h.getBoundInfosAtCoord(l,k,this.getCurrBoundInflation());var g=e.length?e[e.length-1]:null;return g?g.obj:null}else{return null}},moveManipulatedObjs:function($super,i){var e;if(this.isDirectedMove()){var h=Kekule.CoordUtils;var g=this.getStartCoord();var k=h.getDistance(g,i);var j=h.substract(i,g);var f=this._directedMovingDirection;if(this._directedMovingDirection){}else{f=(Math.abs(j.x)>=Math.abs(j.y))?"x":"y";if(k<this.getEditor().getEditorConfigs().getInteractionConfigs().getDirectedMoveDistanceThreshold()){}else{this._directedMovingDirection=f}}e=Object.extend({},g);e[f]=i[f]}else{e=i}return $super(e)},applyManipulatingObjsInfo:function($super,n){this.setAllManipulateObjsMerged(false);var Y=this.useMergePreview();var f=this.getEditor();f.hotTrackOnObj(null);var am=Kekule.Editor.BasicManipulationIaController.ManipulationType;var I=this.getManipulationType();var v=this.getManipulateOriginObjs();var s=this.getManipulateObjs();var ad=[].concat(v);Kekule.ArrayUtils.pushUnique(ad,s);var u=this.getMergeOperationsInManipulating();var r=this;var E=function(i){if(i instanceof Kekule.StructureFragment){return false}else{return(i instanceof Kekule.ChemStructureNode)||(i instanceof Kekule.ChemStructureConnector)}};var Z=(v.length===1)&&(v[0] instanceof Kekule.ChemStructureConnector);var aj=(s.length===1)&&(s[0] instanceof Kekule.ChemStructureNode)&&E(s[0]);if(!Z&&this.getEnableMagneticMerge()){var e=this.getManipulateObjCurrInfoMap();var g=this.getManipulateObjInfoMap();var r=this;var y=[];var ae=[];var h=[];for(var ag=0,af=s.length;ag<af;++ag){var m=s[ag];if(!E(m)){continue}var G=e.get(m);var L=G.screenCoord;if(L){var W=f.getBoundInfosAtCoord(L,null,this.getCurrBoundInflation());var R=this._getMagneticNodeMergeDest(m,L,ad);if(R){y.push(ag);ae.push(m);h.push(R)}else{}}}if(ae.length){var ak=ae.length;this.setAllManipulateObjsMerged(ak===s.length);var B=(ak<=1);var al=false;if(!al){var z=[];for(var ag=0,af=ae.length;ag<af;++ag){var m=ae[ag];var S=h[ag];var V=y[ag];var J=u[V];if(!J||!this.isSameNodeMerge(J,m,S)){al=true;break}else{z.push(J)}}for(var ag=0,af=u.length;ag<af;++ag){var J=u[ag];if(J){var V=z.indexOf(J);if(V<0){al=true;break}else{z.splice(V,1)}}}}if(al||B){if(al){this.reverseMergeOpers(this.getMergeOperationsInManipulating())}var t=Kekule.CoordUtils;if((ak===1)||(f.getCoordMode()===Kekule.CoordMode.COORD3D)){var G=e.get(ae[0]);var L=G.screenCoord;var aa=f.getObjectScreenCoord(h[0]);var ac=t.substract(aa,L);var ai=false;var k=Kekule.NumUtils.isFloatEqual;var j=1e-10;if(!k(ac.x,0,j)||!k(ac.y,0,j)){for(var ag=0,af=s.length;ag<af;++ag){var m=s[ag];if(m!==ae[0]){var ah=e.get(m);if(ah.screenCoord){var D=t.add(ah.screenCoord,ac);ah.screenCoord=D;if(this._getMagneticNodeMergeDest(m,D,ad)){ai=true}}}}}if(ai){return this.applyManipulatingObjsInfo(n)}else{for(var ag=0,af=s.length;ag<af;++ag){var m=s[ag];var ah=e.get(m);this.applySingleManipulatingObjInfo(ag,m,ah,n)}}}else{if((ak>1)&&(f.getCoordMode()!==Kekule.CoordMode.COORD3D)){var p=ae[0];var o=ae[1];var Q=g.get(p).screenCoord;var O=g.get(o).screenCoord;var T=f.getObjectScreenCoord(h[0]);var P=f.getObjectScreenCoord(h[1]);var ab=t.calcCoordGroup2DTransformParams(Q,O,T,P);var N=t.calcTransform2DMatrix(ab);var ai=false;for(var ag=0,af=s.length;ag<af;++ag){var m=s[ag];if(ae.indexOf(m)<0){var ah=g.get(m);var G=e.get(m);if(ah.screenCoord){var D=t.transform2DByMatrix(ah.screenCoord,N);G.screenCoord=D;if(this._getMagneticNodeMergeDest(m,D,ad)){ai=true}}if(ah.size){G.size=t.multiply(ah.size,ab.scale)}}}if(ai){return this.applyManipulatingObjsInfo(n)}else{for(var ag=0,af=s.length;ag<af;++ag){var m=s[ag];if(ae.indexOf(m)<0){var G=e.get(m);this.applySingleManipulatingObjInfo(ag,m,G,n)}}}}}if(al){for(var ag=0,af=ak;ag<af;++ag){var m=ae[ag];var S=h[ag];var V=y[ag];if(Y){var x=this.createNodeMergeOperation(m,S,true);this.getMergePreviewOperations()[V]=x}else{var F=this.createNodeMergeOperation(m,S);this.getMergeOperations()[V]=F}}this.executeMergeOpers(this.getMergeOperationsInManipulating())}}f.hotTrackOnObj(h);return}}if(I===am.MOVE){var A=false;if((Z&&this.getEnableConnectorMerge())||(aj&&this.getEnableNodeMerge())){var K;var W=f.getBoundInfosAtCoord(n,null,this.getCurrBoundInflation());var M=Z?Kekule.ChemStructureConnector:Kekule.ChemStructureNode;var q=Z?v[0]:s[0];var X=Z?function(i){return r._canMergeConnectors(q,i)}:function(i){return r._canMergeNodes(q,i)};var H=this._findSuitableMergeTargetBoundInfo(W,ad,M,X);if(H){var w=H.obj;if(w){this.setAllManipulateObjsMerged(true);f.hotTrackOnObj(w);var J=u[0];if((Z&&this.isSameConnectorMerge(J,q,w))||(aj&&this.isSameNodeMerge(J,q,w))){return}else{if(J){this.reverseMergeOpers(this.getMergeOperationsInManipulating())}if(Y){var F=Z?this.createConnectorMergeOperation(q,w,Y):this.createNodeMergeOperation(q,w,Y);this.getMergePreviewOperations()[0]=F}else{var F=Z?this.createConnectorMergeOperation(q,w):this.createNodeMergeOperation(q,w);this.getMergeOperations()[0]=F}this.executeMergeOpers(this.getMergeOperationsInManipulating());return}}}}}this.reverseMergeOpers(this.getMergeOperationsInManipulating());$super(n)},doMoveManipulatedObj_old:function($super,p,m,j,h){var f=this.getEditor();var y=this.getManipulateObjInfoMap().get(m);var u=j;var e=this.getManipulateOriginObjs();var t=this.getManipulationType();var q=(t===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE)&&(e.length===1)&&(e[0] instanceof Kekule.ChemStructureConnector);var s=u;var o=null;var A=this.getMergeOperations();var k=A[p];var B=this.getManipulateObjs();if(!q&&this.getEnableMagneticMerge()&&(m instanceof Kekule.ChemStructureNode)){var g=f.getBoundInfosAtCoord(s);if(g&&g.length){for(var v=g.length-1;v>=0;--v){var y=g[v];var r=y.obj;if(r===m){continue}if(B.indexOf(r)>=0){continue}if(r instanceof Kekule.ChemStructureNode){if(this._canMergeNodes(m,r)){f.addHotTrackedObj(r);if(this.isSameNodeMerge(k,m,r)){return}o=this.createNodeMergeOperation(m,r);break}}}if(!o){f.hotTrackOnObj(null)}else{if(k){this.reverseMergeOpers(p)}this.getMergeOperations()[p]=o;this.executeMergeOpers()}}}var s=h;var z=false;if((t===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE)){var n=e[0];if(e&&(e.length===1)){var x=f.getTopmostBoundInfoAtCoord(s,[n]);if(x){var l=x.obj;if(l&&(B.indexOf(l)<0)){if(q&&(n instanceof Kekule.ChemStructureConnector)&&(l instanceof Kekule.ChemStructureConnector)){if(this.getEnableConnectorMerge()){f.hotTrackOnObj(l);if(this.getEnableStructFragmentMerge()){z=true}else{z=(n.getParent()===l.getParent())}if(z){o=this.createConnectorMergeOperation(n,l)}}}else{if((n instanceof Kekule.ChemStructureNode)&&(l instanceof Kekule.ChemStructureNode)){if(this._canMergeNodes(n,l)){f.hotTrackOnObj(l);if(this.isSameNodeMerge(k,n,l)){return}else{}o=this.createNodeMergeOperation(n,l)}}}if(o){var k=A[p];if(k){this.reverseMergeOpers(p)}this.getMergeOperations()[p]=o;this.executeMergeOpers();return}}}}}if(!o){f.hideHotTrack();var w=!!this.getMergeOperations().length;if(w){this.reverseMergeOpers(p)}$super(p,m,j,h)}},createNodeMergeOperation:function(h,g,f){var e=this.getEnableStructFragmentMerge();if(!Kekule.ChemStructOperation.MergeNodes.canMerge(h,g,e,this.getEnableNeighborNodeMerge())){return null}else{var i=f?(new Kekule.ChemStructOperation.MergeNodesPreview(h,g,e,this.getEditor())):(new Kekule.ChemStructOperation.MergeNodes(h,g,e,this.getEditor()));return i}},createConnectorMergeOperation:function(i,g,f){var e=this.getEnableStructFragmentMerge();if(!Kekule.ChemStructOperation.MergeConnectors.canMerge(i,g,e)){return null}else{var h=f?Kekule.ChemStructOperation.MergeConnectorsPreview:Kekule.ChemStructOperation.MergeConnectors;var j=new h(i,g,this.getEditor().getCoordMode(),e,this.getEditor());return j}},isSameConnectorMerge:function(f,g,e){return f&&(f instanceof Kekule.ChemStructOperation.MergeConnectorsBase)&&(g===f.getTarget())&&(e===f.getDest())},isSameNodeMerge:function(f,g,e){return f&&(f instanceof Kekule.ChemStructOperation.MergeNodesBase)&&(g===f.getTarget())&&(e===f.getDest())},executeMergeOpers:function(j){var m=this.getEditor();var k=Kekule.ArrayUtils.toUnique(j||this.getMergeOperationsInManipulating());var f=[];m.beginUpdateObject();try{for(var h=0,e=k.length;h<e;++h){if(k[h]){k[h].execute();var g=k[h].getDest?k[h].getDest():null;if(g){a.pushUnique(f,g)}}}this.setMergingDests(f.length?f:null);this.refreshManipulateObjs();this._mergeJustReversed=false}finally{m.endUpdateObject()}},reverseMergeOpers:function(j){var h=this.getEditor();this.setMergingDests(null);var e=j||this.getMergeOperationsInManipulating();var g=Kekule.ArrayUtils.toUnique(e);if(!g||!g.length){}else{h.beginUpdateObject();try{for(var f=g.length-1;f>=0;--f){if(g[f]){g[f].reverse()}}e.length=0;this._mergeJustReversed=true;this.refreshManipulateObjs()}finally{h.endUpdateObject()}}},react_pointermove:function($super,f){this._suppressConstrainedMoving=f.getAltKey();this._suppressConstrainedRotating=f.getAltKey();this._isInDirectedMoving=f.getShiftKey();return $super(f)}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolManipulationIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.StructureInsertIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.StructureInsertIaController",initialize:function($super,e){$super(e);this._manipulatedBasicObjs=null},getInsertedObjs:function(){return this._manipulatedBasicObjs},doSetManipulateOriginObjs:function($super,e){this._manipulatedBasicObjs=this._getManipulatedBasicObjects(e);return $super(e)},_getManipulatedBasicObjects:function(j){var e=[];for(var h=0,f=j.length;h<f;++h){var k=j[h];if(k instanceof Kekule.ChemStructureObject){if(k instanceof Kekule.StructureFragment&&k.isExpanded()){var g=[].concat(k.getNodes()).concat(k.getConnectors());a.pushUnique(e,g)}else{a.pushUnique(e,k)}}else{a.pushUniqueEx(e,k)}}return e},stopManipulate:function($super){if(this.getEditorConfigs().getInteractionConfigs().getAutoSelectNewlyInsertedObjects()){var e=this.getInsertedObjs();this.doneInsertOrModifyBasicObjects(e)}return $super()}});Kekule.Editor.MolBondIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.MolBondIaController",initialize:function($super,e){$super(e);this.setState(c.State.INITIAL);this.setBondOrder(Kekule.BondOrder.SINGLE);this.setAllowBondingToBond(false);this.setEnableBondModification(true);this.setEnableSelect(false);this.setEnableMove(true);this.setAutoSwitchBondOrder(false);this.setEnableNeighborNodeMerge(false)},initProperties:function(){this.defineProp("allowBondingToBond",{dataType:DataType.BOOL,serializable:false});this.defineProp("state",{dataType:DataType.INT,serializable:false});this.defineProp("enableBondModification",{dataType:DataType.BOOL,serializable:false});this.defineProp("autoSwitchBondOrder",{dataType:DataType.BOOL,serializable:false});this.defineProp("startingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("endingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("structFragment",{dataType:"Kekule.ChemStructureFragment",serializable:false});this.defineProp("autoCreatedStructFragment",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("autoCreatedStartingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("bond",{dataType:"Kekule.Bond",serializable:false});this.defineProp("bondType",{dataType:DataType.STRING,serializable:false});this.defineProp("bondOrder",{dataType:DataType.INT,serializable:false});this.defineProp("bondStereo",{dataType:DataType.INT,serializable:false});this.defineProp("initialBondDirection",{dataType:DataType.FLOAT})},_isBondDifferent:function(g){var e=this.getBondStereo();var f=Kekule.BondStereo;if(e===f.UP||e===f.UP_INVERTED||e===f.DOWN||e===f.DOWN_INVERTED){return true}else{return(g.getBondType()!==this.getBondType())||(g.getBondOrder()!==this.getBondOrder())||(g.getStereo()!==this.getBondStereo())}},canInteractWithObj:function($super,f){var e=this.getState();if(e===c.State.INITIAL){if(f instanceof Kekule.ChemStructureNode){return true}else{if(f instanceof Kekule.ChemStructureConnector){if(this.getAllowBondingToBond()){return true}else{if(this.getEnableBondModification()){if(f instanceof Kekule.Bond){return this._isBondDifferent(f)}}else{return false}}}}}else{return $super(f)}},doTestMouseCursor:function(g,f){return""},getInsertedObjs:function($super){var e=this.getBond();return e?[e]:$super()},isObjValidBondTerminator:function(e){if(!e){return false}if(!this.getAllowBondingToBond()){return(e instanceof Kekule.ChemStructureNode)}else{return((e instanceof Kekule.ChemStructureNode)||(e instanceof Kekule.ChemStructureConnector))}},isBond:function(e){return(e instanceof Kekule.Bond)},getNewBondDefAngle:function(e,f){var g=this.getEditorConfigs().getStructureConfigs();return g.getNewBondDefAngle(e,f)},addDefBond:function(r,i,j){var u;var l=this.getEditor();l.beginUpdateObject();try{if(!i){if(!this.getEditor().canAddUnconnectedStructFragment()){return null}var g=this.getEditor().screenCoordToObj(r);var s=this.getEditor().getOnlyOneBlankStructFragment();if(!s){i=this.getEditor().createNewStructFragmentAndStartingAtom(null,g);this.setAutoCreatedStartingObj(null);this.setAutoCreatedStructFragment(i?i.getParent():null)}else{i=this.getEditor().createStructStartingAtom(s,null,g);this.setAutoCreatedStructFragment(null);this.setAutoCreatedStartingObj(i)}}else{this.setAutoCreatedStartingObj(null);this.setAutoCreatedStructFragment(null)}if(this.isObjValidBondTerminator(i)){var l=this.getEditor();this.setStartingObj(i);var o=i.getParent();this.setStructFragment(o);var e=this.getEditorConfigs().getStructureConfigs();var m=Kekule.oneOf(this.getBondType(),e.getDefBondType());var q=Kekule.oneOf(this.getBondOrder(),e.getDefBondOrder());var n=Kekule.oneOf(this.getBondStereo(),Kekule.BondStereo.NONE);var f=l.getDefBondLength?l.getDefBondLength():e.getDefBondLength();var p=this.getNewBondDefAngle(i,q);var k=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingLocation(i,f,p,this.getEditor().getAllowCoordBorrow());var h=this.getEditor().createDefaultNode(k,Kekule.Editor.CoordSys.OBJ,o);this.setEndingObj(h);var t=new Kekule.Bond();t.setBondType(m);t.setBondOrder(q);t.setStereo(n);o.appendConnector(t);t.appendConnectedObj(i);t.appendConnectedObj(h);this.setBond(t);if(j){this.getEditor().objectsChanged([{obj:t},{obj:h}])}u=k}else{u=null}}finally{l.endUpdateObject()}return u},addOperationToEditor:function($super){return $super()},getAllObjOperations:function($super,f){var e=$super(f)||[];var g=this.getAddBondOperation();if(g){e.unshift(g)}return e},getAddBondOperation:function(){var n=new Kekule.MacroOperation();var j=this.getEditor();var i=this.getAutoCreatedStructFragment();if(i){var e=new Kekule.ChemObjOperation.Add(i,this.getEditor().getChemObj(),null,this.getEditor());n.add(e)}var h=this.getStartingObj();var m=this.getEndingObj();var o=this.getBond();var l=this.getStructFragment();var j=this.getEditor();var g=this.getAutoCreatedStartingObj();if(g){var f=new Kekule.ChemStructOperation.AddNode(g,l,null,j);n.add(f)}var f=new Kekule.ChemStructOperation.AddNode(m,l,null,j);n.add(f);var k=new Kekule.ChemStructOperation.AddConnector(o,l,null,[h,m],j);n.add(k);return n},modifyBond:function(k){var x=this.getBondType();var s;var v=Kekule.BondOrder;var w=[v.SINGLE,v.DOUBLE,v.TRIPLE];if(this.getAutoSwitchBondOrder()&&(x===Kekule.BondType.COVALENT)&&(k.getBondType===Kekule.BondType.COVALENT)){var r=k.getBondOrder();var m=w.indexOf(r);if(m>=0){m=(++m)%w.length}else{m=0}s=w[m]}else{s=this.getBondOrder()}var f=k.getStereo();var g=this.getBondStereo();if(f===g){g=Kekule.BondStereo.getInvertedDirection(g)}var y={bondType:x,bondOrder:s,stereo:g};var o=false;for(var e in y){var q=k.getPropValue(e);if(q!==y[e]){o=true;break}}if(o){var h=this.getEditor();h.beginUpdateObject();try{var n=new Kekule.ChemObjOperation.Modify(k,y,this.getEditor());n.execute();h.pushOperation(n);var j=[k].concat(k.getConnectedObjs());var p=[];for(var u=0,t=j.length;u<t;++u){p.push({obj:j[u]})}this.getEditor().objectsChanged(p)}finally{h.endUpdateObject()}}},react_pointerdown:function(k){if(k.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var h=c.State;var l=this._getEventMouseCoord(k);var i=this.getState();if(i===h.INITIAL){var f=this.getEditor().getTopmostBoundInfoAtCoord(l,null,this.getCurrBoundInflation());if(f){var j=f.obj;if(this.isObjValidBondTerminator(j)){var g=this.addDefBond(l,j,true);if(g){this.startDirectManipulate(null,this.getEndingObj(),l);this.moveManipulatedObjs(l)}return true}else{if(this.isBond(j)&&this.getEnableBondModification()){this.modifyBond(j);return true}}k.preventDefault()}else{if(this.getEditor().canAddUnconnectedStructFragment()){var g=this.addDefBond(l,null,true);if(g){this.startDirectManipulate(null,this.getEndingObj(),l);this.moveManipulatedObjs(l)}k.preventDefault();return true}}}}},react_pointerup:function($super,j){var i=this.getState();var h=this.getStartCoord();var f=this._getEventMouseCoord(j);var g=Kekule.Editor.BasicManipulationIaController.State;if((i===g.MANIPULATING)&&(j.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT)){j.preventDefault();if(Kekule.CoordUtils.isEqual(h,f)){this.addOperationToEditor();this.stopManipulate();this.setState(g.NORMAL);return true}}return $super(j)}});Kekule.Editor.MolBondIaController.State={INITIAL:0,START_NODE_SET:21,ADJUSTING:22};var c=Kekule.Editor.MolBondIaController;Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolBondIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolAtomIaController_OLD=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController_OLD",initialize:function($super,e){$super(e);this._createNonAtomLabelInfos();this._setterShown=false},finalize:function($super){if(this.getAtomSetter()){this.getAtomSetter().finalize()}$super()},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:false});this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:false});this.defineProp("periodicTable",{dataType:DataType.OBJECT,serializable:false});this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,serializable:false});this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:false})},canInteractWithObj:function($super,e){if(this.isValidNode(e)){return true}else{return false}},isValidNode:function(e){return e instanceof Kekule.ChemStructureNode},getNodeLabel:function(g){var f=this.getEditor();var j=f.getRenderConfigs().getDisplayLabelConfigs();if(g.getIsotopeId){return g.getIsotopeId()}else{if(g instanceof Kekule.SubGroup){var i=g.getAbbr()||g.getFormulaText();return i||j.getRgroup()}else{if(g instanceof Kekule.VariableAtom){var h=g.getAllowedIsotopeIds();var k=g.getDisallowedIsotopeIds();return(h&&h.length)?this._getVarAtomListLabel():(k&&k.length)?this._getVarAtomNotListLabel():this._getVarAtomListLabel()}else{var e=g.getCoreDisplayRichTextItem(null,null,j);return Kekule.Render.RichTextUtils.toText(e)}}}},_getVarAtomListLabel:function(){var e=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return e.getVariableAtom()},_getVarAtomNotListLabel:function(){var e=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return"~"+e.getVariableAtom()},_createNonAtomLabelInfos:function(){var e=[];var f=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();e.push({nodeLabel:f.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")});e.push({nodeLabel:f.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")});e.push({nodeLabel:f.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")});e.push({nodeLabel:f.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")});e.push({nodeLabel:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")});e.push({nodeLabel:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")});this.setNonAtomLabelInfos(e);return e},_indexOfNonAtomLabel:function(j){var h=this.getNonAtomLabelInfos();for(var f=0,e=h.length;f<e;++f){var g=h[f];if(g.nodeLabel===j){return f}}return -1},_getNonAtomInfo:function(f){var e=this._indexOfNonAtomLabel(f);return(e<0)?null:this.getNonAtomLabelInfos()[e]},getAtomSetterWidget:function(h){var f=this.getAtomSetter();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createAtomSetterWidget(g,e);this.setAtomSetter(f)}return f},_createAtomSetterWidget:function(o,n){var q=new Kekule.Widget.ComboBox(o);var g=this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms();var j=[];for(var m=0,k=g.length;m<k;++m){j.push({value:g[m],data:{props:{isotopeId:g[m]}}})}j.push({value:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")});var f=this.getNonAtomLabelInfos();for(var m=0,k=f.length;m<k;++m){var h=f[m];var e={value:h.nodeLabel,data:{props:h.props}};if(h.description){e.text=h.nodeLabel+" - "+h.description}j.push(e)}q.setItems(j);q.appendToElem(n);var p=this;q.addEventListener("keyup",function(l){var i=l.htmlEvent;if(i.getKeyCode()===Kekule.X.Event.KeyCode.ENTER){p.applySetter(q);q.dismiss()}});q.addEventListener("valueSelect",function(i){p.applySetter(q);q.dismiss()});q.addEventListener("showStateChange",function(i){if(!i.isShown&&!i.isDismissed){if(p.getAtomSetter()&&p.getAtomSetter().isShown()){p.applySetter(q)}}});return q},getPeriodicTableDialogWidget:function(h){var f=this.getPeriodicTableDialog();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createPeriodicTableDialogWidget(g,e);this.setPeriodicTableDialog(f)}return f},_createPeriodicTableDialogWidget:function(h,e){var f=new Kekule.Widget.Dialog(h,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);var g=new Kekule.ChemWidget.PeriodicTable(h);g.setUseMiniMode(true);g.setEnableSelect(true);g.appendToElem(f.getClientElem());this.setPeriodicTable(g);return f},openSetterUi:function(l,i){var j=this.getAtomSetter();if(!this.isValidNode(i)){return}this.setCurrAtom(i);var h=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0;var f=h/1.5;var e=this.getNodeLabel(i);var k=this.getAtomSetterWidget(true);k.setValue(e);k.setIsDirty(false);var g=k.getElement().style;g.position="absolute";g.fontSize=h;g.left=(l.x-f)+"px";g.top=(l.y-f)+"px";k._applied=false;k.show(null,null,Kekule.Widget.ShowHideType.POPUP);(function(){k.focus();k.selectAll()}).defer()},applySetter:function(j,m){if(j._applied){return}if(!j.getIsDirty()){return}if(!m){m=this.getCurrAtom()}var e;var n=null;var s=j.getValue();var k;if(s===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){var k=this.getPeriodicTableDialogWidget(true);k.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var i=m.getSymbol?m.getSymbol():null;this.getPeriodicTable().setEnableSelect(true).setEnableMultiSelect(false).setSelectedSymbol(i)}else{if(s===this._getVarAtomListLabel()||s===this._getVarAtomNotListLabel()){var l=s===this._getVarAtomNotListLabel();var k=this.getPeriodicTableDialogWidget(true);k.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var o=m.getAllowedIsotopeIds?m.getAllowedIsotopeIds():null;var f=m.getDisallowedIsotopeIds?m.getDisallowedIsotopeIds():null;this.getPeriodicTable().setEnableSelect(true).setEnableMultiSelect(true).setSelectedSymbols(l?f:o)}}if(k){var u=this;k.openModal(function(v){if(v===Kekule.Widget.DialogButtons.OK){var y;var x;if(s===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){var z=u.getPeriodicTable().getSelectedSymbol();y=Kekule.Atom;x={isotopeId:z}}if(s===u._getVarAtomListLabel()){var w=u.getPeriodicTable().getSelectedSymbols();y=Kekule.VariableAtom;x={allowedIsotopeIds:w,disallowedIsotopeIds:null}}if(s===u._getVarAtomNotListLabel()){var w=u.getPeriodicTable().getSelectedSymbols();y=Kekule.VariableAtom;x={allowedIsotopeIds:null,disallowedIsotopeIds:w}}u.applyModification(m,null,y,x)}},this);return}var q=null;var p=this._getNonAtomInfo(s);if(p){e=p.nodeClass;n=p.props}else{var h=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(s);if(h){var g=h.createObjects(m)||{};var t=g.objects;var r=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),h,g,m,null);this.getEditor().transformCoordAndSizeOfObjects(t,r);q=t[0];e=q.getClass()}else{e=Kekule.ChemStructureNodeFactory.getClassByLabel(s,null);if(!e){if(this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()){e=Kekule.Pseudoatom}}n=(e===Kekule.Atom)?{isotopeId:s}:(e===Kekule.Pseudoatom)?{symbol:s}:{}}}if(!e){Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL"))}else{this.applyModification(m,q,e,n);j._applied=true}},applyModification:function(g,o,q,m){var o;var h,i;var f=g.getClass();if(o&&!q){q=o.getClass()}if(o||q!==f){h=new Kekule.MacroOperation();if(!o){o=new q()}var j=new Kekule.ChemStructureNode();j.assign(g);o.assign(j);var p=new Kekule.ChemStructOperation.ReplaceNode(g,o,null,this.getEditor());h.add(p)}else{o=g}if(m){i=new Kekule.ChemObjOperation.Modify(o,m,this.getEditor());if(h){h.add(i)}}var k=h||i;if(k){var l=this.getEditor();l.beginUpdateObject();try{k.execute()}catch(n){throw (n)}finally{l.endUpdateObject()}if(l&&l.getEnableOperHistory()&&k){l.pushOperation(k)}}},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var j=this._getEventMouseCoord(i);var f=this.getEditor().getTopmostBoundInfoAtCoord(j,null,this.getCurrBoundInflation());if(f){var h=f.obj;if(this.isValidNode(h)){var g=this.getEditor().getObjectScreenCoord(h);i.preventDefault();i.stopPropagation();this.openSetterUi(g,h);this.getEditor().setSelection([h])}return true}}}});Kekule.Editor.MolAtomIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController",initialize:function($super,e){$super(e);this._createNonAtomLabelInfos();this._setterShown=false},finalize:function($super){if(this.getAtomSetter()){this.getAtomSetter().finalize()}$super()},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:false});this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:false});this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:false})},canInteractWithObj:function($super,e){if(this.isValidNode(e)){return true}else{return false}},isValidNode:function(e){return(e instanceof Kekule.ChemStructureNode)&&!(e instanceof Kekule.StructureFragment&&e.isStandalone())},_createNonAtomLabelInfos:function(){var f=this.getEditor();var e=f&&f.getEnabledNonAtomInputData&&f.getEnabledNonAtomInputData();this.setNonAtomLabelInfos(e);return e},_indexOfNonAtomLabel:function(j){var h=this.getNonAtomLabelInfos();for(var f=0,e=h.length;f<e;++f){var g=h[f];if(g.nodeLabel===j){return f}}return -1},_getNonAtomInfo:function(f){var e=this._indexOfNonAtomLabel(f);return(e<0)?null:this.getNonAtomLabelInfos()[e]},getAtomSetterWidget:function(h){var f=this.getAtomSetter();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createAtomSetterWidget(g,e);this.setAtomSetter(f)}return f},_createAtomSetterWidget:function(j,f){var e=new Kekule.ChemWidget.StructureNodeSetter(this.getEditor());e.setUseDropDownSelectPanel(true);e.addClassName(d.CHEMEDITOR_ATOM_SETTER);var i=a.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());i.push("...");var h=this.getNonAtomLabelInfos();e.setSelectableInfos({elementSymbols:i,nonElementInfos:h,subGroupRepItems:Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()});var g=this;e.addEventListener("keyup",function(l){var k=l.htmlEvent;if(k.getKeyCode()===Kekule.X.Event.KeyCode.ENTER){g.applySetter(e);e.dismiss()}});e.addEventListener("valueSelect",function(k){if(g.getAtomSetter()&&g.getAtomSetter().isShown()){g.applySetter(e);e.dismiss()}});e.addEventListener("showStateChange",function(k){if(k.target===e&&!k.byDomChange){if(!k.isShown&&!k.isDismissed){if(g.getAtomSetter()&&g.getAtomSetter().isShown()){g.applySetter(e)}}}});e.appendToElem(f);return e},getPeriodicTableDialogWidget:function(h){var f=this.getPeriodicTableDialog();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createPeriodicTableDialogWidget(g,e);this.setPeriodicTableDialog(f)}return f},_createPeriodicTableDialogWidget:function(h,e){var f=new Kekule.Widget.Dialog(h,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);var g=new Kekule.ChemWidget.PeriodicTable(h);g.setUseMiniMode(true);g.setEnableSelect(true);g.appendToElem(f.getClientElem());this.setPeriodicTable(g);return f},openSetterUi:function(k,i){var g=this.getAtomSetter();if(g&&g.isShown()){g.hide();g._haltPrevShowHideProcess()}if(!this.isValidNode(i)){return}this.setCurrAtom(i);var m=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0;m*=this.getEditor().getZoom()||1;var l=m/1.5;var f=this.getAtomSetterWidget(true);f.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs());f.setNodes([i]);var j=this.getEditor().getCoreElement();f.appendToElem(j);var h=f.getNodeInputBox();var e=f.getElement().style;e.position="absolute";e.left=(k.x-l)+"px";e.top=(k.y-l)+"px";h.getElement().style.fontSize=m+"px";f._applied=false;f.show(null,null,Kekule.Widget.ShowHideType.POPUP);(function(){h.focus();h.selectAll()}).defer()},applySetter:function(g,i){if(g._applied){return}if(!i){i=this.getCurrAtom()}var n=g.getValue();if(!n){return}var e=n.nodeClass;var j=n.props;var h=n.repositoryItem;var k;if(h){var f=h.createObjects(i)||{};var m=f.objects;var l=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),h,f,i,null);this.getEditor().transformCoordAndSizeOfObjects(m,l);k=m[0];e=k.getClass()}if(n.isUnknownPseudoatom&&!this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()){e=null}if(!e){Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL"))}else{this.applyModification(i,k,e,j);g._applied=true}},applyModification:function(g,o,q,m){var o;var h,i;var f=g.getClass();if(o&&!q){q=o.getClass()}if(o||q!==f){h=new Kekule.MacroOperation();if(!o){o=new q()}var j=new Kekule.ChemStructureNode();j.assign(g);o.assign(j);var p=new Kekule.ChemStructOperation.ReplaceNode(g,o,null,this.getEditor());h.add(p)}else{o=g}if(m){i=new Kekule.ChemObjOperation.Modify(o,m,this.getEditor());if(h){h.add(i)}}var k=h||i;if(k){var l=this.getEditor();l.beginUpdateObject();try{k.execute()}catch(n){throw (n)}finally{l.endUpdateObject()}if(l&&l.getEnableOperHistory()&&k){l.pushOperation(k)}}},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var j=this._getEventMouseCoord(i);var f=this.getEditor().getTopmostBoundInfoAtCoord(j,null,this.getCurrBoundInflation());if(f){var h=f.obj;if(this.isValidNode(h)){var g=this.getEditor().getObjectScreenCoord(h);i.preventDefault();i.stopPropagation();this.openSetterUi(g,h);this.doneInsertOrModifyBasicObjects([h])}return true}}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolAtomIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.RepositoryIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.RepositoryIaController",initialize:function($super,e){$super(e);this.setEnableSelect(false);this._repObjStartingScreenCoord=null},initProperties:function(){this.defineProp("repositoryItem",{dataType:"Kekule.AbstractRepositoryItem",serializable:false});this.defineProp("addRepObjsOper",{dataType:"Kekule.MacroOperation",serializable:false});this.defineProp("initialTransformParams",{dataType:DataType.HASH,serializable:false});this.defineProp("currRepositoryObjects",{dataType:"Kekule.ChemObject",serializable:false})},doTestMouseCursor:function(g,f){return""},canInteractWithObj:function($super,e){return $super(e)},isValidStartingObj:function(e){return true},calcInitialTransformParams:function(g,f,e,h){return Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),g,f,e,h)},getRepObjCreationOptions:function(){return null},createObjFromRepositoryItem:function(f,g){var e=g.createObjects(f,this.getRepObjCreationOptions())||{};return e},addRepositoryObj:function(h,u,z){var g=this.getEditor();this.setAddRepObjsOper(null);var y=null;g.beginUpdateObject();try{var m=g.getChemSpace();var s=this.getRepositoryItem();var y=this.createObjFromRepositoryItem(h,s);var v=y.objects;this.setCurrRepositoryObjects(v);var e=s.isOneStructureFragmentObj();var f=false;var r=this.getEditor().getOnlyOneBlankStructFragment();if(!g.canCreateNewChild()&&!y.mergeObj&&!z){if(!e||!g.canAddUnconnectedStructFragment()){return null}else{f=true}}var p=new Kekule.MacroOperation();for(var w=0,t=v.length;w<t;++w){var n=v[w];var k;if(f){k=new Kekule.ChemStructOperation.MergeStructFragment(n,r,g)}else{k=new Kekule.ChemObjOperation.Add(n,m,null,g)}p.add(k)}p.execute();this.setAddRepObjsOper(p);var x=f?[r]:v;var j=this.calcInitialTransformParams(s,y,h,u);this._transformObjectsCoordAndSize(x,j);this.setInitialTransformParams(j);y.objects=x;var o=s.getMolManipulationCenterCoord&&s.getMolManipulationCenterCoord();if(o){y.manipulationCenterCoord=Kekule.CoordUtils.transform2D(o,j)}var q=s.getMolManipulationDefDirectionCoord&&s.getMolManipulationDefDirectionCoord();if(q){y.manipulationDefDirectionCoord=Kekule.CoordUtils.transform2D(q,j)}}finally{g.endUpdateObject()}return y},doRefreshRepositoryObj:function(f,e,i,h,g){this.doPrepareManipulatingObjects(f,e);this.doPrepareManipulatingStartingCoords(e,i,h,g);this.doCreateManipulateMoveAndResizeOperation()},_transformObjectsCoordAndSize:function(e,f){return this.getEditor().transformCoordAndSizeOfObjects(e,f)},getAllObjOperations:function($super,g){var f=$super(g)||[];var e=this.getAddRepObjsOper();if(e){f.unshift(e)}return f},addOperationToEditor:function($super){return $super()},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE},doInsertRepositoryObjToEditor:function(j,e,h,n){if(!n){this._initialStartingObj=h;this._repObjStartingScreenCoord=e}var g=j;if(g){var f=g.objects;var l=null,m=null;var i=this.getInitManipulationType();if(g.mergeObj){l=this.getEditor().getObjectScreenCoord(g.mergeObj);i=Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE}else{if(g.manipulationCenterCoord){l=this.getEditor().objCoordToScreen(g.manipulationCenterCoord)}}if(g.manipulationDefDirectionCoord){m=this.getEditor().objCoordToScreen(g.manipulationDefDirectionCoord)}var k=this.getEditor().getObjectsContainerBox(f);return{objects:f,manipulateType:i,coord:e,box:k,rotateCenter:l,rotateRefCoord:m,startingObj:h}}else{return null}},insertRepositoryObjToEditor:function(f,e,h){var g=this.addRepositoryObj(e,f);return this.doInsertRepositoryObjToEditor(g,f,e,h)},updateRepositoryObjInEditor:function(){var h=this.getEditor();h.beginUpdateObject();try{if(!this.useMergePreview()){this.reverseActiveOperation()}var o=this.getCurrRepositoryObjects();var k=this.addRepositoryObj(this._initialStartingObj,this._repObjStartingScreenCoord,true);var m=a.exclude(o,(k||{}).objects);for(var g=0,e=m.length;g<e;++g){var f=m[g];var j=f.getParent();if(j){j.removeChild(f)}}if(!this.useMergePreview()||m.length){this.setMergeOperations([]);this.setMergePreviewOperations([])}var n=this.doInsertRepositoryObjToEditor(k,this._repObjStartingScreenCoord,this._initialStartingObj,true);if(n){this.doRefreshRepositoryObj(n.objects,n.coord,n.box,n.rotateCenter,n.rotateRefCoord);this.moveManipulatedObjs(this._repObjStartingScreenCoord)}}finally{h.endUpdateObject()}return n},react_pointerdown:function(j){if(j.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var g=c.State;var l=this._getEventMouseCoord(j);var i=this.getState();if(i===g.INITIAL){var f=this.getEditor().getTopmostBoundInfoAtCoord(l,null,this.getCurrBoundInflation());var k=f?f.obj:null;var h=this.insertRepositoryObjToEditor(l,k);if(h){this.startDirectManipulate(h.manipulateType,h.objects,h.coord,h.box,h.rotateCenter);this.moveManipulatedObjs(l)}j.preventDefault();return true}}},react_pointerup:function($super,j){var i=this.getState();var h=this.getStartCoord();var f=this._getEventMouseCoord(j);var g=Kekule.Editor.BasicManipulationIaController.State;if((i===g.MANIPULATING)&&(j.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT)){if(Kekule.CoordUtils.isEqual(h,f)){this.addOperationToEditor();this.stopManipulate();this.setState(g.NORMAL);j.preventDefault();return true}}return $super(j)}});Kekule.Editor.MolRingIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.MolRingIaController",initialize:function($super,e){$super(e);this.setRepositoryItem(new Kekule.Editor.MolRingRepositoryItem2D())},getActualManipulatingObjects:function(f){var e=this.getCurrRepositoryObjects()[0];return e?a.clone(e.getNodes()):[]},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getRingAtomCount()},setter:function(e){this.getRepositoryItem().setRingAtomCount(e)}});this.defineProp("isAromatic",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getIsAromatic()},setter:function(e){this.getRepositoryItem().setIsAromatic(e)}})}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolRingIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.RepositoryStructureFragmentIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.RepositoryStructureFragmentIaController",initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("repItemName",{dataType:DataType.STRING,setter:function(f){if(f!==this.getRepItemName()){var e=Kekule.Editor.RepositoryItemManager.getItem(f);if(e){this.setRepositoryItem(e);this.setPropStoreFieldValue("repItemName",f)}}}})}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.RepositoryStructureFragmentIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolFlexStructureIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.MolFlexStructureIaController",initialize:function($super,e){$super(e);this.setEnableSelect(false)},initProperties:function(){this.defineProp("assocMarker",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var e=this.getPropStoreFieldValue("assocMarker");if(!e){e=new Kekule.ChemWidget.TextUiMarker();this.setPropStoreFieldValue("assocMarker",e)}return e}})},manipulateEnd:function($super){$super();this.hideAssocMarker()},initAssocMarker:function(){var e=this.getAssocMarker();var f=this.getEditorConfigs().getUiMarkerConfigs();var g={color:f.getFlexStructureAssocMarkerColor(),opacity:f.getFlexStructureAssocMarkerOpacity(),fontSize:f.getFlexStructureAssocMarkerFontSize(),fontFamily:f.getFlexStructureAssocMarkerFontFamily(),textBoxXAlignment:Kekule.Render.BoxXAlignment.CENTER,textBoxYAlignment:Kekule.Render.BoxYAlignment.CENTER};e.setDrawStyles(g);e.setVisible(true);this.getEditor().getUiMarkers().addMarker(e);return e},hideAssocMarker:function(){var e=this.getPropStoreFieldValue("assocMarker");if(e){e.setVisible(false);this.getEditor().getUiMarkers().removeMarker(e);this.repaintMarker()}},updateAssocMarker:function(h,f,g){var e=this.getAssocMarker();if(h){e.setCoord(h)}if(f){e.setPropValues(f)}if(!g){this.repaintMarker()}},repaintMarker:function(){this.getEditor().repaintUiMarker()}});Kekule.Editor.MolFlexChainIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexChainIaController",initialize:function($super,e){$super(e);this.setEnableSelect(false);this._deltaDistance=null;this._deltaCount=0;this._lastDeltaCount=1;this._repObjStartingScreenCoord=null;this._repObjNeedUpdate=false;this._isForceReversedChainDirection=false;this._assocMarkerInitCoord=null;this._manipulateObjInfoCache=[];this._chain=null;var f=new Kekule.Editor.MolChainRepositoryItem2D(2);f.setEnableCoordCache(true);this.setRepositoryItem(f)},updateAssocMarker:function($super,o,i,u){var j=this.getEditor();var s=this.getAssocMarker().getDrawStyles();var r=this._chain;var g=o;if(!g&&r){var p=r.getNodeAt(0);var k=r.getNodeAt(r.getNodeCount()-1);var l=j.getObjectContextCoord(p);g=j.getObjectContextCoord(k);var m=b.substract(g,l);if(m){var h=s.fontSize||10;var n=h/2;var q={x:0,y:0};if(g){var t=b.getDistance(m);var f=m.x/t;var e=m.y/t;var q={x:n*f,y:n*e};g=Kekule.CoordUtils.add(g,q)}}}$super(g,i,u)},getChainMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexChainAtomCount(),0)},manipulateEnd:function($super){this._clearManipulateObjInfoCache();$super()},createManipulateObjInfo:function($super,i,j,f){var e=this.getRepositoryItem().getNegativeDirection();var h=this._getCachedManipulateObjInfo(j,e);if(h){return h}else{var g=$super(i,j,f);this._setCachedManipulateObjInfo(g,j,e);return g}},canInteractWithObj:function($super,e){return $super(e)&&(e instanceof Kekule.ChemStructureNode)},getActualManipulatingObjects:function(f){var e=this.getCurrRepositoryObjects()[0];return e?a.clone(e.getNodes()):[]},_setCachedManipulateObjInfo:function(i,h,e){var g=e?1:0;var f=this._manipulateObjInfoCache[g];if(!f){f=[];this._manipulateObjInfoCache[g]=f}f[h]=i},_getCachedManipulateObjInfo:function(h,e){var g=e?1:0;var f=this._manipulateObjInfoCache[g];return f&&f[h]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var i=this.getRepositoryItem().getBondLength();var j=this.getInitialTransformParams();var f=this.getEditor();var h=f.objCoordToScreen(Kekule.CoordUtils.transform2D({x:0,y:0},j));var g=f.objCoordToScreen(Kekule.CoordUtils.transform2D({x:i*Math.cos(Math.PI/6),y:0},j));var e=Kekule.CoordUtils.getDistance(h,g);return e},getRepObjCreationOptions:function(){if(this._isUpdateRepObj){var e=this.getCurrRepositoryObjects()[0];return{originalStructFragment:e}}else{return null}},addRepositoryObj:function($super,g,f,h){var e=$super(g,f,h);this._deltaDistance=this._calcStepDeltaDistance();this._repObjNeedUpdate=false;return e},insertRepositoryObjToEditor:function($super,h,g,i){if(!i){this._deltaDistance=null;this._deltaCount=0;this._lastDeltaCount=1;var j=2;this.getRepositoryItem().setAtomCount(j)}this._isUpdateRepObj=i;var e=$super(h,g,i);this._chain=e&&e.objects[0];if(e&&!i){var f=this.initAssocMarker();this.updateAssocMarker(null,{text:""+j})}return e},_updateChain:function(){this._isUpdateRepObj=true;var e=this.updateRepositoryObjInEditor();this._chain=e.objects[0];this._repObjNeedUpdate=false;return e},doTransformManipulatedObjs:function($super,p,r,g){var m=r;var f=this.getState();if(f===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){var n=this.getBaseCoord();if(n){var o=Kekule.CoordUtils.getDistance(m,n);var h=Math.max(Math.round(o/this._deltaDistance),1);if(!this._lastDeltaCount||h!==this._lastDeltaCount){this._deltaCount=h;var v=this.getChainMaxAtomCount();var u=v?Math.min(v,h+1):h+1;if(this.getRepositoryItem().getAtomCount()!==u){this.getRepositoryItem().setAtomCount(u);this._repObjNeedUpdate=true;this.updateAssocMarker(null,{text:""+u},true)}this._lastDeltaCount=h}var e=this._calcRotateAngle(m);var s=e&&e.angle;var i=this.isInActualConstrainedRotation();var w;if(i){var l=i?this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep()*2:null;var j=Math.round(s/l);var t=j*l-s;w=t<0}else{w=false}if(this._isForceReversedChainDirection){w=!w}if(!!this.getRepositoryItem().getNegativeDirection()!==w){this.getRepositoryItem().setNegativeDirection(w);this._repObjNeedUpdate=true}}}if(this._repObjNeedUpdate){this._updateChain()}var q=this.getCurrRepositoryObjects()[0];q.beginUpdate();try{var k=$super(p,r,g);this.updateAssocMarker(null,null,false)}finally{q.endUpdate()}return k},react_pointermove:function($super,g){this._isForceReversedChainDirection=!!g.getShiftKey();var f=$super(g);return f}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolFlexChainIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolFlexRingIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexRingIaController",initialize:function($super,e){$super(e);this.setEnableSelect(false);this._deltaDistance=null;this._lastDeltaCount=1;this._repObjStartingScreenCoord=null;this._repObjNeedUpdate=false;this._manipulateObjInfoCache=[];var f=new Kekule.Editor.MolRingRepositoryItem2D(3);f.setEnableCoordCache(true);this.setRepositoryItem(f)},getRingMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexRingAtomCount(),0)},getRingMinAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount(),3)},getActualManipulatingObjects:function(f){var e=this.getCurrRepositoryObjects()[0];return e?a.clone(e.getNodes()):[]},manipulateEnd:function($super){this._clearManipulateObjInfoCache();$super()},createManipulateObjInfo:function($super,h,j,e){var i=this.getRepositoryItem().getRingAtomCount();var g=this._getCachedManipulateObjInfo(j,i);if(g){return g}else{var f=$super(h,j,e);this._setCachedManipulateObjInfo(f,j,i);return f}},_setCachedManipulateObjInfo:function(g,f,h){var e=this._manipulateObjInfoCache[h];if(!e){e=[];this._manipulateObjInfoCache[h]=e}e[f]=g},_getCachedManipulateObjInfo:function(f,g){var e=this._manipulateObjInfoCache[g];return e&&e[f]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var i=this.getRepositoryItem().getBondLength();var j=this.getInitialTransformParams();var f=this.getEditor();var h=f.objCoordToScreen(Kekule.CoordUtils.transform2D({x:0,y:0},j));var g=f.objCoordToScreen(Kekule.CoordUtils.transform2D({x:i,y:0},j));var e=Kekule.CoordUtils.getDistance(h,g)/3;return e},getRepObjCreationOptions:function(){if(this._isUpdateRepObj){var e=this.getCurrRepositoryObjects()[0];return{originalStructFragment:e}}else{return null}},addRepositoryObj:function($super,g,f,h){var e=$super(g,f,h);this._deltaDistance=this._calcStepDeltaDistance();this._repObjNeedUpdate=false;return e},insertRepositoryObjToEditor:function($super,h,f,i){if(!i){this._deltaDistance=null;this._lastDeltaCount=1;var j=this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount();this.getRepositoryItem().setRingAtomCount(j)}this._isUpdateRepObj=i;var e=$super(h,f);if(e&&!i){var g=e.objects[0];this.initAssocMarker();this.updateAssocMarker(this._getRingCenterAbsContextCoord(g),{text:""+j})}return e},updateAssocMarker:function($super,h,e,f){if(!h){var g=this._getManipulateObjsCenterCoord();h=this.getEditor().objCoordToContext(g)}return $super(h,e,f)},_getRingCenterAbsContextCoord:function(e){var g=this.getEditor();var f=Kekule.Editor.StructureUtils.getStructureCenterAbsBaseCoord(e,g.getCoordMode(),g.getAllowCoordBorrow());return g.objCoordToContext(f)},_updateRing:function(){this._isUpdateRepObj=true;var e=this.updateRepositoryObjInEditor();this._repObjNeedUpdate=false;return e},doTransformManipulatedObjs:function($super,g,p,i){var l=p;var f=this.getState();if(f===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){var o=this.getBaseCoord();if(o){var m=this.getRingMinAtomCount();var h=Kekule.CoordUtils.getDistance(l,o);var j=Math.round(h/this._deltaDistance)+m;if(!this._lastDeltaCount||j!==this._lastDeltaCount){var n=this.getRingMaxAtomCount();var e=n?Math.min(n,j):j;e=m?Math.max(e,m):e;if(this.getRepositoryItem().getRingAtomCount()!==e){this.getRepositoryItem().setRingAtomCount(e);this._repObjNeedUpdate=true;this.updateAssocMarker(null,{text:""+e},true)}this._lastDeltaCount=j}}}if(this._repObjNeedUpdate){this._updateRing()}var k=this.getCurrRepositoryObjects()[0];k.beginUpdate();try{var q=$super(g,p,i);this.updateAssocMarker(null,null,false)}finally{k.endUpdate()}return q}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolFlexRingIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.ArrowLineIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.ArrowLineIaController",initialize:function($super,e){$super(e);this.setRepositoryItem(new Kekule.Editor.PathGlyphRepositoryItem2D())},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT,getter:function(){return this.getRepositoryItem().getGlyphRefLength()},setter:function(e){this.getRepositoryItem().setGlyphRefLength(e)}});this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:false,getter:function(){return this.getRepositoryItem().getGlyphClass()},setter:function(e){this.getRepositoryItem().setGlyphClass(e)}});this.defineProp("glyphInitialParams",{dataType:DataType.HASH,getter:function(){return this.getRepositoryItem().getGlyphInitialParams()},setter:function(e){this.getRepositoryItem().setGlyphInitialParams(e)}})},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE},addRepositoryObj:function($super,f,e,g){this.getRepositoryItem().setGlyphRefLength(this.getEditor().getChemSpace().getDefAutoScaleRefLength());return $super(f,e,g)}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.ArrowLineIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.FormulaIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.FormulaIaController",initialize:function($super,e){$super(e);this._operAddMol=null},initProperties:function(){this.defineProp("currMol",{dataType:DataType.OBJECT,serializable:false});this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:false})},canInteractWithObj:function($super,e){if(e&&this.isValidMol(e)){return true}else{return false}},isValidMol:function(e){return(e instanceof Kekule.StructureFragment)&&e.hasFormula()&&!e.hasCtab()},getFormulaText:function(e){return e.hasFormula()?e.getFormula().getText():""},createNewMol:function(h,i){var g;var f=this.getEditor();if(!f.canCreateNewChild()){g=f.getOnlyOneBlankStructFragment();if(!g){return null}}f.beginUpdateObject();try{if(!g){var g=new Kekule.Molecule()}g.getFormula(true);h.appendChild(g);f.setObjectScreenCoord(g,i);var e=new Kekule.ChemObjOperation.Add(g,h,null,f);this._operAddBlock=e}finally{f.endUpdateObject()}return g},getTextSetterWidget:function(h){var f=this.getTextSetter();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createTextSetterWidget(g,e);this.setTextSetter(f)}return f},_createTextSetterWidget:function(h,f){var e=new Kekule.Widget.TextBox(this.getEditor());e.addClassName(d.CHEMEDITOR_FORMULA_SETTER);e.appendToElem(f);var g=this;e.addEventListener("keyup",function(k){var i=k.htmlEvent;var j=i.getKeyCode();if(j===Kekule.X.Event.KeyCode.ENTER){g.applySetter(e);e.dismiss()}else{if(j===Kekule.X.Event.KeyCode.ESC){e.dismiss();g.cancelSetter()}}});e.addEventListener("showStateChange",function(i){if(!i.byDomChange){if(!i.isShown&&!i.isDismissed){g.applySetter(e)}if(i.isShown){e._applied=false}}});return e},cancelSetter:function(){if(this._operAddBlock){this._operAddBlock.reverse();this._operAddBlock=null}},applySetter:function(j,f){if(j._applied){return}if(!f){f=this.getCurrMol()}var i;var h=j.getText();if(!h){if(this._operAddBlock){this.cancelSetter()}else{i=new Kekule.ChemObjOperation.Remove(f,f.getParent(),null,this.getEditor())}}else{var i=new Kekule.ChemObjOperation.Modify(f.getFormula(),{text:h},this.getEditor())}if(i){i.execute();var e=this.getEditor();if(e&&e.getEnableOperHistory()){if(this._operAddBlock){var g=new Kekule.MacroOperation();g.add(this._operAddBlock);g.add(i);e.pushOperation(g);this._operAddBlock=null}else{e.pushOperation(i)}this.doneInsertOrModifyBasicObjects([f])}}j._applied=true},openSetterUi:function(l,j){var i=this.getTextSetter();if(i&&i.isShown()){this.applySetter(i,this.getCurrMol());i.hide();i._haltPrevShowHideProcess()}if(!j){j=this.createNewMol(this.getEditor().getChemObj(),l)}if(!this.isValidMol(j)){return}this.setCurrMol(j);this.getEditor().setSelection([j]);var n=j.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();n*=this.getEditor().getZoom()||1;var g=j.getCascadedRenderOption("fontFamily")||"";var m=this.getFormulaText(j);var h=this.getTextSetterWidget(true);var k=this.getEditor().getCoreElement();h.appendToElem(k);var e=m||"";h.setValue(e);var f=h.getElement().style;f.position="absolute";f.fontSize=n+"px";f.left=l.x+"px";f.top=l.y+"px";f.fontFamily=g;h._applied=false;h.show(null,null,Kekule.Widget.ShowHideType.POPUP);h.selectAll();h.focus()},react_pointerup:function(j){if(j.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var k=this._getEventMouseCoord(j);var h;var f=this.getEditor().getTopmostBoundInfoAtCoord(k,null,this.getCurrBoundInflation());if(f){var i=f.obj;if(this.isValidMol(i)){h=i}}var g;if(f&&f.boundInfo){g=f.boundInfo.coords[0]}else{g=k}j.preventDefault();j.stopPropagation();this.openSetterUi(g,h);return true}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.FormulaIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.ContentBlockIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ContentBlockIaController",initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("currBlock",{dataType:DataType.OBJECT,serializable:false})},canInteractWithObj:function($super,e){return(e&&this.isValidBlock(e))},isValidBlock:function(e){return e instanceof Kekule.ContentBlock},execute:function(f,e,g){},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MouseButton.LEFT){this.getEditor().setSelection(null);var k=this._getEventMouseCoord(i);var j;var f=this.getEditor().getTopmostBoundInfoAtCoord(k,null,this.getCurrBoundInflation());if(f){var h=f.obj;if(this.isValidBlock(h)){j=h}}var g=j?this.getEditor().getObjectScreenCoord(j):k;i.preventDefault();i.stopPropagation();this.execute(this.getEditor().getChemObj(),g,j);return true}}});Kekule.Editor.TextBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.TextBlockIaController",initialize:function($super,e){$super(e);this._operAddBlock=null},initProperties:function(){this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:false})},isValidBlock:function(e){return e instanceof Kekule.TextBlock},createNewBlock:function(g,i){var f=this.getEditor();if(!f.canCreateNewChild()){return null}f.beginUpdateObject();try{var h=new Kekule.TextBlock();if(h){g.appendChild(h);f.setObjectScreenCoord(h,i,Kekule.Render.CoordPos.CORNER_TL);var e=new Kekule.ChemObjOperation.Add(h,g,null,f);this._operAddBlock=e}}finally{f.endUpdateObject()}return h},getBlockText:function(e){return e.getText()},execute:function(f,e,g){this.openSetterUi(e,g)},getTextSetterWidget:function(h){var f=this.getTextSetter();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createTextSetterWidget(g,e);this.setTextSetter(f)}return f},_createTextSetterWidget:function(h,f){var e=new Kekule.Widget.TextArea(this.getEditor());e.setAutoSizeX(true);e.setAutoSizeY(true);e.setDisplayed(false);e.addClassName(d.CHEMEDITOR_TEXT_SETTER);e.appendToElem(f);var g=this;e.addEventListener("keyup",function(k){var i=k.htmlEvent;var j=i.getKeyCode();if((j===Kekule.X.Event.KeyCode.ENTER)&&(i.getCtrlKey())){g.applySetter(e);e.dismiss()}else{if(j===Kekule.X.Event.KeyCode.ESC){e.dismiss();g.cancelSetter()}}});e.addEventListener("showStateChange",function(i){if(!i.byDomChange){if(!i.isShown&&!i.isDismissed){g.applySetter(e)}if(i.isShown){e._applied=false}}});return e},cancelSetter:function(){if(this._operAddBlock){this._operAddBlock.reverse();this._operAddBlock=null}},applySetter:function(j,h){if(j._applied){return}if(!h){h=this.getCurrBlock()}var g=j.getText();var i;if(!g){if(this._operAddBlock){this.cancelSetter()}else{i=new Kekule.ChemObjOperation.Remove(h,h.getParent(),null,this.getEditor())}}else{i=new Kekule.ChemObjOperation.Modify(h,{text:g},this.getEditor())}if(i){i.execute();var e=this.getEditor();if(e&&e.getEnableOperHistory()){if(this._operAddBlock){var f=new Kekule.MacroOperation();f.add(this._operAddBlock);f.add(i);e.pushOperation(f);this._operAddBlock=null}else{e.pushOperation(i)}}this.doneInsertOrModifyBasicObjects([h])}j._applied=true},openSetterUi:function(l,i){var j=this.getTextSetter();if(j&&j.isShown()){this.applySetter(j,this.getCurrBlock());j._haltPrevShowHideProcess()}if(!i){i=this.createNewBlock(this.getEditor().getChemObj(),l)}if(!this.isValidBlock(i)){return}this.setCurrBlock(i);var n=this.getEditor().getObjectScreenCoord(i,Kekule.Render.CoordPos.CORNER_TL);var o=i.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();o*=(this.getEditor().getZoom()||1);var g=i.getCascadedRenderOption("fontFamily")||"";var m=this.getBlockText(i);var h=this.getTextSetterWidget(true);h._applied=false;h.setValue(m);var e=m||Kekule.$L("ChemWidgetTexts.CAPTION_TEXTBLOCK_INIT");h.setPlaceholder(e);var k=this.getEditor().getCoreElement();h.appendToElem(k);var f=h.getElement().style;f.position="absolute";f.fontSize=o+"px";f.left=n.x+"px";f.top=n.y+"px";f.fontFamily=g;h.show(null,null,Kekule.Widget.ShowHideType.POPUP);(function(){h.selectAll();h.focus()}).defer()}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.TextBlockIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.ImageBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.ImageBlockIaController",initialize:function($super,e){$super(e);this._operAddBlock=null;this._imgProbeElem=null;this._actionOpenFile=this.createOpenAction()},doFinalize:function(){if(this._actionOpenFile){this.actionOpenFile.finalize()}},initProperties:function(){},isValidBlock:function(e){return e instanceof Kekule.ImageBlock},createNewBlock:function(h,k,f,j){var g=this.getEditor();if(!g.canCreateNewChild()){return null}g.beginUpdateObject();try{var i=new Kekule.ImageBlock();if(j){i.setSrc(j)}if(f){i.setSize2D(f)}g.setObjectScreenCoord(i,k,Kekule.Render.CoordPos.CORNER_TL);var e=new Kekule.ChemObjOperation.Add(i,h,null,g);this._operAddBlock=e}finally{g.endUpdateObject()}return i},_getImgFilters:function(){var e=[{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_PNG"),filter:".png"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_JPG"),filter:".jpg,.jpeg"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_GIF"),filter:".gif"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_SVG"),filter:".svg"},Kekule.NativeServices.FILTER_ALL_SUPPORT,Kekule.NativeServices.FILTER_ANY];return e},createOpenAction:function(){var e=new Kekule.ActionFileOpen();e.setFilters(this._getImgFilters());e.on("open",this.reactImageFileOpen,this);return e},reactImageFileOpen:function(i){var h=i.file;if(h){var g=this;var f=new FileReader();f.addEventListener("load",function(){var k=g._getImageProbeElem();var m=k.ownerDocument;try{delete k.width;delete k.height}catch(l){}k.src=f.result;var j=g.getEditor();(function(){var u={x:k.width,y:k.height};if(u.x<=0||u.y<=0){Kekule.error(Kekule.$L("ErrorMsg.INVALID_OR_EMPTY_IMAGE"));return}var q=g._currCoord;var s=j.objCoordToContext(q);var r=Kekule.CoordUtils.add(s,u);var p=j.contextCoordToObj(r);var u=Kekule.CoordUtils.substract(p,q);u=Kekule.CoordUtils.absValue(u);var t=g.getCurrBlock();var n;var e=j.getChemObj();if(t){n=new Kekule.ChemObjOperation.Modify(t,{src:f.result,size2D:u})}else{var o=g.createNewBlock(g.getEditor().getChemObj(),g._currCoord,u,f.result);g.setCurrBlock(o);n=new Kekule.ChemObjOperation.Add(o,e,null,j)}if(n){try{n.execute();if(j&&j.getEnableOperHistory()){j.pushOperation(n)}g.doneInsertOrModifyBasicObjects([g.getCurrBlock()])}finally{}}}).defer()});f.readAsDataURL(h)}},_getImageProbeElem:function(){if(!this._imgProbeElem){var e=this.getEditor().getElement().ownerDocument;this._imgProbeElem=e.createElement("img")}return this._imgProbeElem},execute:function(f,e,g){this.setCurrBlock(g);this._currCoord=e;this._actionOpenFile.execute(this.getEditor())}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.ImageBlockIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.AttachedMarkerIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.AttachedMarkerIaController",initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("markerClass",{dataType:DataType.CLASS,serializable:false});this.defineProp("targetClass",{dataType:DataType.CLASS,serializable:false});this.defineProp("markerClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getMarkerClass())},setter:function(e){this.setMarkerClass(ClassEx.findClass(e))}});this.defineProp("targetClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getTargetClass())},setter:function(e){this.setTargetClass(ClassEx.findClass(e))}});this.defineProp("initialPropValues",{dataType:DataType.HASH})},canInteractWithObj:function($super,e){return this.isValidTarget(e)},isValidTarget:function(f){var e=this.getTargetClass();return(f instanceof e)||!e},createMarker:function(){var e;var g=this.getMarkerClass();if(g){e=new g();var f=this.getInitialPropValues();if(f&&e&&e.setPropValues){e.setPropValues(f)}}return e},createOperations:function(g){var e;var f=this.createMarker();if(f){e=new Kekule.ChemObjOperation.Add(f,g,null,this.getEditor())}return[e]},apply:function(f){var e=this.createOperations(f);var h=(e.length<=0)?null:(e.length===1)?e[0]:new Kekule.MacroOperation(e);if(h){h.execute();var g=this.getEditor();if(g&&g.getEnableOperHistory()){g.pushOperation(h)}}},react_pointerup:function(h){if(h.getButton()===Kekule.X.Event.MouseButton.LEFT){var i=this._getEventMouseCoord(h);var f=this.getEditor().getTopmostBoundInfoAtCoord(i,null,this.getCurrBoundInflation());if(f){var g=f.obj;if(this.isValidTarget(g)){this.apply(g);h.preventDefault();h.stopPropagation()}return true}}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.AttachedMarkerIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolNodeChargeIaController=Class.create(Kekule.Editor.AttachedMarkerIaController,{CLASS_NAME:"Kekule.Editor.MolNodeChargeIaController",initialize:function($super,e){$super(e);this.setChargeInc(1)},initProperties:function(){this.defineProp("chargeInc",{dataType:DataType.NUMBER,serializable:false});this.defineProp("charge",{dataType:DataType.NUMBER,serializable:false});this.defineProp("radical",{dataType:DataType.INT,serializable:false});this.defineProp("currNode",{dataType:DataType.OBJECT,serializable:false})},initPropValues:function($super){$super();this.setTargetClass(Kekule.ChemStructureNode)},createOperations:function(i){var q;var g=false;var f=false;var m={};var n=i.getCharge();if(Kekule.ObjUtils.notUnset(this.getCharge())){if(n!==this.getCharge()){m.charge=this.getCharge();g=true}}else{if(this.getChargeInc()){n+=this.getChargeInc();m.charge=n;g=true}}var o=i.getRadical();if(this.getRadical()!==o){m.radical=this.getRadical();f=true}var q=[];var e=[];var j;var l=this.getEditor();if(g){var k=i.fetchChargeMarker(false);if(m.charge!==0&&!k){j=new Kekule.ChemMarker.Charge();j.setValue(m.charge);e.push(new Kekule.ChemObjOperation.Add(j,i,null,l))}if(m.charge===0&&k){e.push(new Kekule.ChemObjOperation.Remove(k,null,null,l))}}if(f){var p=i.fetchRadicalMarker(false);if(m.radical!==0&&!p){j=new Kekule.ChemMarker.Radical();j.setValue(m.radical);e.push(new Kekule.ChemObjOperation.Add(j,i,null,l))}if(m.radical===0&&p){e.push(new Kekule.ChemObjOperation.Remove(p,null,null,l))}}q=q.concat(e);var h;if(g||f){h=new Kekule.ChemObjOperation.Modify(i,m,this.getEditor());q.push(h)}return q}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolNodeChargeIaController,Kekule.Editor.ChemSpaceEditor)})();(function(){Kekule.Editor.EditorNexus=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.EditorNexus",initialize:function($super,a){$super();this._currInvoker=null;if(a){if(a.editor){this.setEditor(a.editor)}if(a.structureTreeView){this.setStructureTreeView(a.structureTreeView)}if(a.objectInspector){this.setObjectInspector(a.objectInspector)}}},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("editor");this.setPropStoreFieldValue("editor",b);this.editorChanged(b,a)}});this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("structureTreeView");this.setPropStoreFieldValue("structureTreeView",b);this.structureTreeViewChanged(b,a)}});this.defineProp("objectInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("objectInspector");this.setPropStoreFieldValue("objectInspector",b);this.objectInspectorChanged(b,a)}})},editorChanged:function(b,a){if(a){this._uninstallEditorEventHandler(a)}if(b){this._installEditorEventHandler(b)}},structureTreeViewChanged:function(b,a){if(a){this._uninstallStructureTreeViewEventHandler(a)}if(b){this._installStructureTreeViewEventHandler(b);this._updateByEditor()}},objectInspectorChanged:function(c,a){var b=this.getEditor();if(b){if(a){if(a.getOperHistory()===b.getOperHistory()){a.setOperHistory(null)}}if(c){c.setOperHistory(b.getOperHistory());c.setEnableOperHistory(b.getEnableOperHistory());this._updateByEditor()}}},_installEditorEventHandler:function(a){a.addEventListener("change",this._reactEditorChanged,this);a.addEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this);a.addEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_uninstallEditorEventHandler:function(a){a.removeEventListener("change",this._reactEditorChanged,this);a.removeEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this);a.removeEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_installStructureTreeViewEventHandler:function(a){a.addEventListener("change",this._reactStructureTreeViewChanged,this)},_uninstallStructureTreeViewEventHandler:function(a){a.removeEventListener("change",this._reactStructureTreeViewChanged,this)},_reactEditorChanged:function(b){if(this._currInvoker){return}var a=b.target;if(a!==this.getEditor()){return}var d=b.changedPropNames;if(d.indexOf("chemObj")>=0){this.changeRootObj(a.getChemObj(),a)}if(d.indexOf("selection")>=0){this.changeSelection(a.getSelection(),a)}if((d.indexOf("operHistory")>=0)||(d.indexOf("enableOperHistory")>=0)){var c=this.getObjectInspector();if(c){c.setOperHistory(a.getOperHistory());c.setEnableOperHistory(a.getEnableOperHistory())}}},_reactEditorBeginUpdateObject:function(a){this.pauseLiveUpdate()},_reactEditorEndUpdateObject:function(a){this.resumeLiveUpdate()},_updateByEditor:function(){this._reactEditorChanged({target:this.getEditor(),changedPropNames:["chemObj","selection","operHistory"]})},_reactStructureTreeViewChanged:function(b){if(this._currInvoker){return}var a=b.target;if(a!==this.getStructureTreeView()){return}var d=b.changedPropNames;if(d.indexOf("selection")>=0){var c=a.getSelectedChemObjs();this.changeSelection(c,a)}},pauseLiveUpdate:function(){var a=this.getStructureTreeView();if(a){a.pauseLiveUpdate()}},resumeLiveUpdate:function(){var a=this.getStructureTreeView();if(a){a.resumeLiveUpdate()}},changeSelection:function(d,b){this._currInvoker=b;try{var c=this.getEditor();if(c){if(this._currInvoker!==c){c.setSelection(d)}}var a=this.getStructureTreeView();if(a){if(this._currInvoker!==a){a.selectChemObjs(d)}}var e=this.getObjectInspector();if(e){if(this._currInvoker!==e){e.setObjects(d)}}}finally{this._currInvoker=null}},changeRootObj:function(a,c){this._currInvoker=c;try{var d=this.getEditor();if(d&&this._currInvoker!==d){d.setChemObj(a)}var b=this.getStructureTreeView();if(b&&this._currInvoker!==b){b.setRootObj(a)}}finally{this._currInvoker=null}}})})();(function(){var g=Class.PropertyScope;var a=Kekule.ArrayUtils;var c=Kekule.ChemWidget;var e=Kekule.Editor;var b=Kekule.Widget.HtmlClassNames;var f=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER:"K-Chem-Composer",COMPOSER_EDITOR_STAGE:"K-Chem-Composer-Editor-Stage",COMPOSER_ADV_PANEL:"K-Chem-Composer-Adv-Panel",COMPOSER_TOP_REGION:"K-Chem-Composer-Top-Region",COMPOSER_LEFT_REGION:"K-Chem-Composer-Left-Region",COMPOSER_BOTTOM_REGION:"K-Chem-Composer-Bottom-Region",COMPOSER_TOOLBAR:"K-Chem-Composer-Toolbar",COMPOSER_COMMON_TOOLBAR:"K-Chem-Composer-Common-Toolbar",COMPOSER_ZOOM_TOOLBAR:"K-Chem-Composer-Zoom-Toolbar",COMPOSER_CHEM_TOOLBAR:"K-Chem-Composer-Chem-Toolbar",COMPOSER_ASSOC_TOOLBAR:"K-Chem-Composer-Assoc-Toolbar",COMPOSER_STYLE_TOOLBAR:"K-Chem-Composer-Style-Toolbar",COMPOSER_OBJMODIFIER_TOOLBAR:"K-Chem-Composer-ObjModifier-Toolbar",COMPOSER_FONTNAME_BOX:"K-Chem-Composer-FontName-Box",COMPOSER_FONTSIZE_BOX:"K-Chem-Composer-FontSize-Box",COMPOSER_COLOR_BOX:"K-Chem-Composer-Color-Box",COMPOSER_TEXTDIRECTION_BUTTON:"K-Chem-Composer-TextDirection-Button",COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT:"K-Chem-Composer-TextDirection-Button-Default",COMPOSER_TEXTDIRECTION_BUTTON_LTR:"K-Chem-Composer-TextDirection-Button-LTR",COMPOSER_TEXTDIRECTION_BUTTON_RTL:"K-Chem-Composer-TextDirection-Button-RTL",COMPOSER_TEXTDIRECTION_BUTTON_TTB:"K-Chem-Composer-TextDirection-Button-TTB",COMPOSER_TEXTDIRECTION_BUTTON_BTT:"K-Chem-Composer-TextDirection-Button-BTT",COMPOSER_TEXTALIGN_BUTTON:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL:"K-Chem-Composer-TextAlign-Button-Horizontal",COMPOSER_TEXTALIGN_BUTTON_VERTICAL:"K-Chem-Composer-TextAlign-Button-Vertical",COMPOSER_TEXTALIGN_BUTTON_DEFAULT:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_LEADING:"K-Chem-Composer-TextAlign-Button-Leading",COMPOSER_TEXTALIGN_BUTTON_TRAILING:"K-Chem-Composer-TextAlign-Button-Trailing",COMPOSER_TEXTALIGN_BUTTON_CENTER:"K-Chem-Composer-TextAlign-Button-Center",COMPOSER_TEXTALIGN_BUTTON_LEFT:"K-Chem-Composer-TextAlign-Button-Left",COMPOSER_TEXTALIGN_BUTTON_RIGHT:"K-Chem-Composer-TextAlign-Right",COMPOSER_TEXTALIGN_BUTTON_TOP:"K-Chem-Composer-TextAlign-Top",COMPOSER_TEXTALIGN_BUTTON_BOTTOM:"K-Chem-Composer-TextAlign-Bottom",COMPOSER_DIALOG:"K-Chem-ComposerDialog",COMPOSER_FRAME:"K-Chem-ComposerFrame",COMPOSER_FRAME_CONTENT_DOC:"K-Chem-ComposerFrame-ContentDoc",COMPOSER_FRAME_CONTENT_BODY:"K-Chem-ComposerFrame-ContentBody"});Kekule.globalOptions.add("chemWidget.composer",{commonToolButtons:[d.newDoc,d.loadData,d.saveData,d.undo,d.redo,d.copy,d.cut,d.paste,d.zoomIn,d.zoomOut,d.config,d.objInspector],chemToolButtons:[d.manipulate,d.erase,d.molBond,d.molAtomAndFormula,d.molRing,d.molCharge,d.glyph,d.textImage],styleToolComponentNames:[d.fontName,d.fontSize,d.color,d.textDirection,d.textAlign]});Kekule.Editor.ComposerStyleToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerStyleToolbar",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:Kekule.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:b.COLORPICKER_SPEC_COLOR_MIXED},LINKED_VALUE_FIELD:"__$value__",initialize:function($super,h){$super(h);this.setPropStoreFieldValue("composer",h);this.createChildWidgets();this.appendToWidget(h);this._relatedPropNames=(h.getCoordMode()===Kekule.CoordMode.COORD3D)?["renderOptions","render3DOptions"]:["renderOptions"];this.getEditor().addEventListener("selectionChange",function(i){if(!this._isApplying){this.updateStyleValues()}},this);this.getEditor().addEventListener("editObjChanged",function(i){var j=i.propNames;if(!j||!j.length||!Kekule.ArrayUtils.intersect(this._relatedPropNames,j).length){return}if(!this._isApplying){this.updateStyleValues()}},this);this._isApplying=false},doFinalize:function($super){this.clearWidgets();$super()},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false,setter:null});this.defineProp("fontNameBox",{dataType:"Kekule.Widget.ComboBox",serializable:false,setter:null});this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.ComboBox",serializable:false,setter:null});this.defineProp("colorBox",{dataType:"Kekule.Widget.ColorDropButton",serializable:false,setter:null});this.defineProp("textDirectionButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("textHorizontalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("textVerticalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("fontName",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getFontNameBox()?this.getFontNameBox().getValue():null},setter:function(h){if(this.getFontNameBox()){this.getFontNameBox().setValue(h)}}});this.defineProp("fontSize",{dataType:DataType.NUMBER,serializable:false,getter:function(){return this.getFontSizeBox()?parseFloat(this.getFontSizeBox().getValue()):null},setter:function(h){if(this.getFontSizeBox()){this.getFontSizeBox().setValue(h)}}});this.defineProp("color",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getColorBox()?this.getColorBox().getValue():undefined},setter:function(h){if(this.getColorBox()){this.getColorBox().setValue(h)}}});this.defineProp("textDirection",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextDirectionButtonSet())},setter:function(h){this._setButtonSetLinkedValue(this.getTextDirectionButtonSet(),h)}});this.defineProp("textHorizontalAlign",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet())},setter:function(h){this._setButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet(),h)}});this.defineProp("textVerticalAlign",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextVerticalAlignButtonSet())},setter:function(h){this._setButtonSetLinkedValue(this.getTextVerticalAlignButtonSet(),h)}});this.defineProp("componentNames",{dataType:DataType.ARRAY,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("componentNames");if(!h){h=this.getDefaultComponentNames();this.setPropStoreFieldValue("componentNames",h)}return h},setter:function(h){this.setPropStoreFieldValue("componentNames",h);this.recreateComponents()}})},initPropValues:function($super){$super();this.setShowGlyph(true)},removeWidget:function($super,i,h){if(i===this.getFontNameBox()){this.setPropStoreFieldValue("fontNameBox",null)}if(i===this.getFontSizeBox()){this.setPropStoreFieldValue("fontSizeBox",null)}if(i===this.getColorBox()){this.setPropStoreFieldValue("colorBox",null)}if(i===this.getTextDirectionButtonSet()){this.setPropStoreFieldValue("textDirectionButtonSet",null)}if(i===this.getTextHorizontalAlignButtonSet()){this.setPropStoreFieldValue("textHorizontalAlignButtonSet",null)}if(i===this.getTextVerticalAlignButtonSet()){this.setPropStoreFieldValue("textVerticalAlignButtonSet",null)}$super(i,h)},doGetWidgetClassName:function($super){var h=$super()+" "+f.COMPOSER_TOOLBAR+" "+f.COMPOSER_STYLE_TOOLBAR;return h},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},createChildWidgets:function(n){if(!n){n=this.getComponentNames()}for(var m=0,k=n.length;m<k;++m){var h=n[m];if(h===d.fontName){var r=new Kekule.Widget.ComboBox(this);this.fillFontNameBox(r);r.addClassName(f.COMPOSER_FONTNAME_BOX);r.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME"));r.addEventListener("valueChange",function(i){this.applyFontName()},this);this.setPropStoreFieldValue("fontNameBox",r)}else{if(h===d.fontSize){r=new Kekule.Widget.ComboBox(this);this.fillFontSizeBox(r);r.addClassName(f.COMPOSER_FONTSIZE_BOX);r.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE"));r.addEventListener("valueChange",function(i){this.applyFontSize()},this);this.setPropStoreFieldValue("fontSizeBox",r)}else{if(h===d.color){var p=new Kekule.Widget.ColorDropButton(this);p.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR"));p.setShowText(false);p.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]);p.addClassName(f.COMPOSER_COLOR_BOX);p.addEventListener("valueChange",function(i){this.applyColor()},this);this.setPropStoreFieldValue("colorBox",p)}else{if(h===d.textDirection){var q=Kekule.Render.TextDirection;var o=[{value:q.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT},{value:q.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_LTR},{value:q.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_RTL},{value:q.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_TTB},{value:q.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT"),className:f.COMPOSER_TEXTDIRECTION_BUTTON_BTT}];var j=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION"),f.COMPOSER_TEXTDIRECTION_BUTTON,o);j.addEventListener("select",function(i){this.applyTextDirection()},this);this.setPropStoreFieldValue("textDirectionButtonSet",j)}else{if(h===d.textAlign){var s=Kekule.Render.TextAlign;var o=[{value:s.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:f.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:s.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:f.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:s.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:f.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:s.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:f.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:s.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT"),className:f.COMPOSER_TEXTALIGN_BUTTON_LEFT},{value:s.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT"),className:f.COMPOSER_TEXTALIGN_BUTTON_RIGHT}];var j=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN"),f.COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL,o);j.addEventListener("select",function(i){this.applyTextHorizontalAlign()},this);this.setPropStoreFieldValue("textHorizontalAlignButtonSet",j);var s=Kekule.Render.TextAlign;var o=[{value:s.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:f.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:s.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:f.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:s.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:f.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:s.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:f.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:s.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP"),className:f.COMPOSER_TEXTALIGN_BUTTON_TOP},{value:s.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM"),className:f.COMPOSER_TEXTALIGN_BUTTON_BOTTOM}];var j=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN"),f.COMPOSER_TEXTALIGN_BUTTON_VERTICAL,o);j.addEventListener("select",function(i){this.applyTextVerticalAlign()},this);this.setPropStoreFieldValue("textVerticalAlignButtonSet",j)}}}}}}this.updateStyleValues()},_createStyleButtonSet:function(r,n,p,q){var j=new Kekule.Widget.CompactButtonSet(this);j.setText(r);j.setHint(n);j.addClassName(p);j.setShowText(false);j.setShowCompactMark(false);j.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);j.getButtonSet().addClassName(f.COMPOSER_STYLE_TOOLBAR);j.getButtonSet().setShowText(true);if(q){for(var o=0,m=q.length;o<m;++o){var k=q[o];var h=new Kekule.Widget.RadioButton(j,k.text||"");h.setHint(k.hint||"");h.addClassName(k.className);h[this.LINKED_VALUE_FIELD]=k.value;j.append(h,k.selected)}}return j},_getButtonSetLinkedValue:function(h){var i=h?h.getSelected():null;return i?i[this.LINKED_VALUE_FIELD]:undefined},_setButtonSetLinkedValue:function(j,n){if(j){var o=j.getButtonSet();var m=o.getChildWidgets();j.setSelected(null);for(var k=0,h=m.length;k<h;++k){var p=m[k];if(p.hasOwnProperty(this.LINKED_VALUE_FIELD)){if(p[this.LINKED_VALUE_FIELD]==n){j.setSelected(p);break}}}}},getDefaultComponentNames:function(){return Kekule.globalOptions.chemWidget.composer.styleToolComponentNames},recreateComponents:function(){var h=this.getComponentNames();this.clearWidgets();this.createChildWidgets(h)},fillFontSizeBox:function(n){var m=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes();var j=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:undefined}];for(var k=0,h=m.length;k<h;++k){j.push({text:m[k]+" px",value:m[k]})}n.setItems(j)},fillFontNameBox:function(n){var m=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames();var j=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}];for(var k=0,h=m.length;k<h;++k){j.push({text:m[k],value:m[k]})}n.setItems(j)},applyStyle:function(h,j,k){this._isApplying=true;try{var i=this.getEditor();i.modifyObjectsRenderOptions(h,j,k,true)}finally{this._isApplying=false}},getStyleValue:function(h,j,i){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(h,j,i)},applyStyleToEditorSelection:function(h,i){var j=this.getEditor().getSelection();if(j&&j.length){return this.applyStyle(j,h,i)}},applyFontName:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getFontName();this.applyStyle(i,{fontFamily:h})}},applyFontSize:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getFontSize();this.applyStyle(i,{fontSize:h})}},applyColor:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getColor();if(h===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value){this.applyStyle(i,{useAtomSpecifiedColor:true,color:undefined})}else{if(h==Kekule.Widget.ColorPicker.SpecialColors.UNSET){h=undefined}this.applyStyle(i,{useAtomSpecifiedColor:false,color:h})}}},applyTextDirection:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getTextDirection();this.applyStyle(i,{charDirection:h})}},applyTextHorizontalAlign:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getTextHorizontalAlign();this.applyStyle(i,{horizontalAlign:h})}},applyTextVerticalAlign:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){var h=this.getTextVerticalAlign();this.applyStyle(i,{verticalAlign:h})}},updateStyleValues:function(h){if(!h){h=this.getEditor().getSelection()}if(h&&h.length){this.updateFontName(h);this.updateFontSize(h);this.updateColor(h);this.updateTextDirection(h);this.updateTextHorizontalAlign(h);this.updateTextVerticalAlign(h)}},updateFontName:function(i){if(i&&i.length&&this.getFontNameBox()){var h=this.getStyleValue(i,"fontFamily");this.setFontName(h||"")}},updateFontSize:function(i){if(i&&i.length&&this.getFontSizeBox()){var h=this.getStyleValue(i,"fontSize");this.setFontSize(h||undefined)}},updateColor:function(j){if(j&&j.length&&this.getColorBox()){var h;var i=this.getStyleValue(j,"useAtomSpecifiedColor");var h=this.getStyleValue(j,"color");this.getColorBox().setColorClassName(null);if(h){this.getColorBox().setColorClassName(null)}else{if(i){h=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value;this.getColorBox().setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className)}}this.setColor(h||undefined)}},updateTextDirection:function(i){if(i&&i.length&&this.getTextDirectionButtonSet()){var h=this.getStyleValue(i,"charDirection");this.setTextDirection(h)}},updateTextHorizontalAlign:function(i){if(i&&i.length&&this.getTextHorizontalAlignButtonSet()){var h=this.getStyleValue(i,"horizontalAlign");this.setTextHorizontalAlign(h)}},updateTextVerticalAlign:function(i){if(i&&i.length&&this.getTextVerticalAlignButtonSet()){var h=this.getStyleValue(i,"verticalAlign");this.setTextVerticalAlign(h)}},updateState:function(){var i=this.getEditor();var h=(i&&i.hasSelection());if(this.getFontNameBox()){this.getFontNameBox().setEnabled(h)}if(this.getFontSizeBox()){this.getFontSizeBox().setEnabled(h)}if(this.getColorBox()){this.getColorBox().setEnabled(h)}if(this.getTextDirectionButtonSet()){this.getTextDirectionButtonSet().setEnabled(h)}if(this.getTextHorizontalAlignButtonSet()){this.getTextHorizontalAlignButtonSet().setEnabled(h)}if(this.getTextVerticalAlignButtonSet()){this.getTextVerticalAlignButtonSet().setEnabled(h)}}});Kekule.Editor.ComposerObjModifierToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerObjModifierToolbar",initialize:function($super,h){$super(h);this.setPropStoreFieldValue("modifiers",[]);this.setPropStoreFieldValue("modifierMap",new Kekule.MapEx());this.setPropStoreFieldValue("composer",h);this.appendToWidget(h);h.addEventListener("selectionChange",function(i){if(!this._isApplying){this.updateModifierValues()}},this);h.addEventListener("selectedObjsUpdated",function(i){if(!this._isApplying){if(h.getEditor().isManipulatingObject()){this._suppressUpdateModifierValuesInManipulation=true}else{this.updateModifierValues()}}},this);h.addEventListener("endManipulateObject",function(i){if(this._suppressUpdateModifierValuesInManipulation){this.updateModifierValues();this._suppressUpdateModifierValuesInManipulation=false}},this);this._isApplying=false},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false,setter:null});this.defineProp("modifierMap",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("modifiers",{dataType:DataType.ARRAY,serializable:false,setter:null})},initPropValues:function($super){$super();this.setShowGlyph(true)},doFinalize:function($super){this.clearWidgets();this.getModifierMap().finalize();var j=this.getModifiers();for(var k=0,h=j.length;k<h;++k){j[k].finalize()}$super()},doGetWidgetClassName:function($super){var h=$super()+" "+f.COMPOSER_TOOLBAR+" "+f.COMPOSER_OBJMODIFIER_TOOLBAR;return h},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getAllowedModifierCategories:function(){var h=this.getComposer();return h&&h.getAllowedObjModifierCategories()},getTargetObjs:function(){return this.getEditor().getSelection()},getAvailableModifierClasses:function(){var m=[];var k=this.getTargetObjs();for(var n=0,j=k.length;n<j;++n){if(k[n].getClass){a.pushUnique(m,k[n].getClass())}}var h=[];var p=this.getAllowedModifierCategories();for(var n=0,j=m.length;n<j;++n){var o=Kekule.Editor.ObjModifierManager.getModifierClasses(m[n],p);if(o){a.pushUnique(h,o)}}if(h.length){h.sort(function(l,i){var t=l&&ClassEx.getPrototype(l);var s=i&&ClassEx.getPrototype(i);var r=t&&t.getModifierName&&t.getModifierName();var q=s&&s.getModifierName&&s.getModifierName();return(r===q)?0:(r<q)?-1:1})}return h},getModifierInstanceOfClass:function(i,j){var k=this.getModifierMap();var h=k.get(i);if(!h&&j){h=new i(this.getEditor());k.set(i,h)}return h},updateModifierWidgets:function(){var k=[];this.clearWidgets(true);var p=this.getAvailableModifierClasses();for(var m=0,j=p.length;m<j;++m){var n=p[m];var h=this.getModifierInstanceOfClass(n,true);var o=h.getWidget();if(o){this.appendWidget(o);k.push(h)}}this.setPropStoreFieldValue("modifiers",k);this.updateModifierValues();if(this._isAllModifierWidgetButtons(k)){this.removeClassName(b.TOOLBAR).addClassName(b.BUTTON_GROUP)}else{this.removeClassName(b.BUTTON_GROUP).addClassName(b.TOOLBAR)}},updateState:function(){this.updateModifierWidgets()},updateModifierValues:function(){var j=this.getModifiers();for(var k=0,h=j.length;k<h;++k){j[k].loadFromTargets()}},_isAllModifierWidgetButtons:function(n){for(var o=0,k=n.length;o<k;++o){var h=n[o];var j=h&&h.getWidget();if(!j||!j.getDisplayed()||j instanceof Kekule.Widget.Button){continue}else{return false}}return true}});Kekule.Editor.Composer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.Composer",BINDABLE_TAG_NAMES:["div"],CHEM_TOOL_CHILD_FIELDS:"__$children__",initialize:function($super,h,i){this.updateSelectionAssocToolbarStateBind=this.updateSelectionAssocToolbarState.bind(this);this.setPropStoreFieldValue("enableStyleToolbar",true);this.setPropStoreFieldValue("enableObjModifierToolbar",true);this.setPropStoreFieldValue("editor",i);this.setPropStoreFieldValue("editorNexus",new Kekule.Editor.EditorNexus());$super(h);this.bindEditor(i);if(!this.getCommonBtnGroup()){this.createCommonToolbar()}if(!this.getChemBtnGroup()){this.createChemToolbar()}if(!this.getZoomBtnGroup()){this.createZoomToolbar()}this.uiLayoutChanged()},doFinalize:function($super){var h=this.getCommonBtnGroup();if(h){h.finalize()}var h=this.getChemBtnGroup();if(h){h.finalize()}var i=this.getPropStoreFieldValue("editor");if(i){i.finalize()}this.getEditorNexus().finalize();$super()},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("editor");if(!h){h=this.createDefaultEditor();this.setPropStoreFieldValue("editor",h)}return h}});this.defineProp("showInspector",{dataType:DataType.BOOL,setter:function(h){if(this.getShowInspector()!==h){this.setPropStoreFieldValue("showInspector",h);this.showInspectorChanged()}}});this.defineProp("autoSetMinDimension",{dataType:DataType.BOOL});this.defineProp("editorStageElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("advPanelElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("topRegionElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("leftRegionElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("bottomRegionElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("editorNexus",{dataType:"Kekule.Editor.EditorNexus",serializable:false,setter:null});this.defineProp("objInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:false,setter:null});this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:false,setter:null});this.defineProp("commonBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("zoomBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("chemBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("assocBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("styleToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:false,getter:function(){var h=this.getPropStoreFieldValue("styleToolbar");if(!h){if(this.getEnableStyleToolbar()){h=this.createStyleToolbar();this.setPropStoreFieldValue("styleToolbar",h)}}return h}});this.defineProp("styleToolComponentNames",{dataType:DataType.ARRAY,serializable:false,getter:function(){var h=this.getStyleToolbar();return h?h.getComponentNames():null},setter:function(i){var h=this.getStyleToolbar();if(h){h.setComponentNames(i)}return this}});this.defineProp("enableStyleToolbar",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableStyleToolbar")&&!this.getEnableObjModifierToolbar()},setter:function(h){this.setPropStoreFieldValue("enableStyleToolbar",h);this.updateSelectionAssocToolbarState()}});this.defineProp("objModifierToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:false,getter:function(){var h=this.getPropStoreFieldValue("objModifierToolbar");if(!h){if(this.getEnableObjModifierToolbar()){h=this.createObjModifierToolbar();this.setPropStoreFieldValue("objModifierToolbar",h)}}return h}});this.defineProp("enableObjModifierToolbar",{dataType:DataType.BOOL,setter:function(h){this.setPropStoreFieldValue("enableObjModifierToolbar",h);this.updateSelectionAssocToolbarState()}});this.defineProp("allowedObjModifierCategories",{dataType:DataType.ARRAY});this.defineProp("commonToolButtons",{dataType:DataType.HASH,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("commonToolButtons");if(!h){h=this.getDefaultCommonToolBarButtons();this.setPropStoreFieldValue("commonToolButtons",h)}return h},setter:function(h){this.setPropStoreFieldValue("commonToolButtons",h);this.updateCommonToolbar();this.updateZoomToolbar()}});this.defineProp("chemToolButtons",{dataType:DataType.HASH,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("chemToolButtons");if(!h){h=this.getDefaultChemToolBarButtons();this.setPropStoreFieldValue("chemToolButtons",h)}return h},setter:function(h){this.setPropStoreFieldValue("chemToolButtons",h);this.updateChemToolbar()}});this.defineProp("styleBarComponents",{dataType:DataType.ARRAY,serializable:false,getter:function(){var h=this.getPropStoreFieldValue("styleBarComponents");if(!h){h=null;this.setPropStoreFieldValue("styleBarComponents",h)}return h},setter:function(h){this.setPropStoreFieldValue("styleBarComponents",h);if(this.getStyleToolbar()){this.getStyleToolbar().setComponentNames(h)}}});this.defineProp("commonActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("commonActions");if(!h){h=new Kekule.ActionList();this.setPropStoreFieldValue("commonActions",h)}return h}});this.defineProp("zoomActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("zoomActions");if(!h){h=new Kekule.ActionList();this.setPropStoreFieldValue("zoomActions",h)}return h}});this.defineProp("chemActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("chemActions");if(!h){h=new Kekule.ActionList();this.setPropStoreFieldValue("chemActions",h)}return h}});this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("actionMap");if(!h){h=new Kekule.MapEx();this.setPropStoreFieldValue("actionMap",h)}return h}});this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,getter:function(){var h=this.getEditor();return(h&&h.getAllowCreateNewChild)?h.getAllowCreateNewChild():null},setter:function(i){var h=this.getEditor();if(h.setAllowCreateNewChild){h.setAllowCreateNewChild(i)}return this}});this._defineEditorDelegatedProp("chemObj");this._defineEditorDelegatedProp("chemObjLoaded");this._defineEditorDelegatedProp("renderType");this._defineEditorDelegatedProp("renderConfigs");this._defineEditorDelegatedProp("drawOptions");this._defineEditorDelegatedProp("allowCoordBorrow");this._defineEditorDelegatedProp("editorConfigs");this._defineEditorDelegatedProp("operHistory");this._defineEditorDelegatedProp("enableOperHistory");this._defineEditorDelegatedProp("selection");this._defineEditorDelegatedProp("hotTrackedObjs");this._defineEditorDelegatedProp("enableOperContext");this._defineEditorDelegatedProp("enableCreateNewDoc");this._defineEditorDelegatedProp("enableLoadNewFile");this._defineEditorDelegatedProp("initOnNewDoc")},_defineEditorDelegatedProp:function(k,h){if(!h){h=k}var j=ClassEx.getPropInfo(Kekule.Editor.BaseEditor,h);var i=Object.create(j);i.getter=null;i.setter=null;if(j.getter){i.getter=function(){return this.getEditor().getPropValue(h)}}if(j.setter){i.setter=function(l){this.getEditor().setPropValue(h,l)}}return this.defineProp(k,i)},loadPredefinedResDataToProp:function(i,h,k){if(i==="chemObj"){if(k){try{var l=Kekule.IO.loadTypedData(h.data,h.resType,h.resUri);this.setChemObj(l)}catch(j){Kekule.raise(j,Kekule.ExceptionLevel.ERROR)}}else{Kekule.throwException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+h.resUri||"")}}},initPropValues:function($super){$super()},doCreateRootElement:function(i){var h=i.createElement("div");return h},doCreateSubElements:function(k,i){var h=[];var j=this._doCreateSubElement(k,i,"div",f.COMPOSER_EDITOR_STAGE,"editorStageElem");h.push(j);j=this._doCreateSubElement(k,i,"div",f.COMPOSER_ADV_PANEL,"advPanelElem");h.push(j);h.push(this._doCreateSubElement(k,i,"div",f.COMPOSER_TOP_REGION,"topRegionElem"));h.push(this._doCreateSubElement(k,i,"div",f.COMPOSER_LEFT_REGION,"leftRegionElem"));h.push(this._doCreateSubElement(k,i,"div",f.COMPOSER_BOTTOM_REGION,"bottomRegionElem"));return h},_doCreateSubElement:function(m,i,l,j,k){var h=m.createElement(l);h.className=j;if(i){i.appendChild(h)}if(k){this.setPropStoreFieldValue(k,h)}return h},doGetWidgetClassName:function($super){var h=$super()+" "+f.COMPOSER;return h},doWidgetShowStateChanged:function($super,h){$super(h);if(h){this.adjustComponentPositions()}},getResizerElement:function(){return this.getEditorStageElem()},getChildActionClass:function($super,i,j){var h=$super(i,j);if(!h){h=this.getEditor().getChildActionClass(i,j)}return h},getCoordMode:function(){return this.getEditor().getCoordMode()},isDirty:function(){return this.getEditor().isDirty()},newDoc:function(){return this.getEditor().newDoc()},load:function(h){return this.getEditor().load(h)},getSavingTargetObj:function(){var h=this.getEditor();if(h){return h.getSavingTargetObj()}else{return null}},getExportableClasses:function(){return this.getEditor().getExportableClasses()},exportObj:function(h){return this.getEditor().exportObj(h)},exportObjs:function(h){return this.getEditor().exportObjs(h)},undo:function(){return this.getEditor().undo()},redo:function(){return this.getEditor().redo()},undoAll:function(){return this.getEditor().undoAll()},canUndo:function(){return this.getEditor().canUndo()},canRedo:function(){return this.getEditor().canRedo()},repaint:function(h){this.getEditor().repaint(h);return this},uiLayoutChanged:function(){this.adjustComponentPositions()},doResize:function($super){this.adjustComponentPositions()},adjustComponentPositions:function(){var u=this.getCommonBtnGroup()?this.getCommonBtnGroup().getElement():null;var w=this.getZoomBtnGroup()?this.getZoomBtnGroup().getElement():null;var i=this.getChemBtnGroup()?this.getChemBtnGroup().getElement():null;if(!u||!i){return}if(u){var s=Kekule.HtmlElementUtils.getElemPageRect(u)}if(w){var o=Kekule.HtmlElementUtils.getElemPageRect(w)}if(i){var v=Kekule.HtmlElementUtils.getElemPageRect(i)}if(!s.width||!v.width){return}var p=s.height;var B=v.width;var A=(o&&o.height)||p;var y=this.getTopRegionElem();var x=y.style;x.top="0px";x.left=B+"px";x.right="0px";x.height=p+"px";y=this.getBottomRegionElem();x=y.style;x.bottom="0px";x.height=A+"px";x.left=B+"px";x.right="0px";var t=Kekule.HtmlElementUtils.getElemPageRect(y);var j=t.width-(o?o.width:0);y=this.getLeftRegionElem();x=y.style;x.left="0px";x.top=p+"px";x.bottom="0px";x.width=B+"px";var m=Kekule.HtmlElementUtils.getElemPageRect(y);var l=m.height-v.height;if(l/j>0.9){this.changeAssocToolbarRegion(true)}else{this.changeAssocToolbarRegion(false)}var r=p,k=B,n=A,z;if(!this.getShowInspector()){z=0}else{var y=this.getAdvPanelElem();var h=Kekule.HtmlElementUtils.getElemPageRect(y);z=h.width}var D=this.getEditorStageElem();var x=D.style;x.position="absolute";x.top=r+"px";x.left=k+"px";x.bottom=n+"px";x.right=z+"px";y=this.getAdvPanelElem();x=y.style;x.position="absolute";x.top=r+"px";x.bottom=n+"px";if(this.getAutoSetMinDimension()){var q={width:B+s.width,height:p+v.height};if(q.width&&q.height){this.setMinDimension(q)}}},adjustAssocToolbarPositions:function(){this.adjustStyleAndObjModifierToolbarPosition()},adjustStyleAndObjModifierToolbarPosition:function(){},bindEditor:function(k){if(!k){k=this.getEditor()}else{k.setParent(this)}k.setTouchAction("none");var i=this;var h=this.getCommonActions();var j=this.getChemActions();this.createIaControllers(k);k.addEventListener("load",function(m){this.updateAllActions();this.updateUiWidgets();var n=this.getChemActions();var l=n.getActionAt(0);if(l){l.execute()}},this);k.addEventListener("operChange",function(l){h.updateAll();this.updateUiWidgets()},this);k.addEventListener("selectionChange",function(l){h.updateAll();this.updateUiWidgets()},this);k.appendToElem(this.getEditorStageElem());this.getEditorNexus().setEditor(k)},createDefaultEditor:function(){var h=new Kekule.Editor.ChemSpaceEditor(this,null,Kekule.Render.RendererType.R2D);h.addClassName(b.DYN_CREATED);return h},createIaControllers:function(n){var m=Kekule.Editor.IaControllerManager.getAvailableControllerClasses(n.getClass());for(var k=0,j=m.length;k<j;++k){var o=m[k];var h=new o(n);n.addIaController(h.getDefId(),h)}},showInspectorChanged:function(){var h=this.getShowInspector();if(h){if(!this.getObjInspector()){this.createAdvControls()}this.showAdvPanel()}else{this.hideAdvPanel()}this.uiLayoutChanged()},createAdvControls:function(h){if(!h){h=this.getAdvPanelElem()}var k=this.getDocument();var i=new Kekule.ChemWidget.StructureTreeView(k);i.setItemInitialExpanded(true);i.appendToElem(h);this.setPropStoreFieldValue("structureTreeView",i);var l=new Kekule.Widget.ObjectInspector(k);l.setShowPropInfoPanel(false);l.appendToElem(h);this.setPropStoreFieldValue("objInspector",l);var j=this.getEditorNexus();j.setObjectInspector(l);j.setStructureTreeView(i)},showAdvPanel:function(){this.getAdvPanelElem().style.display="block"},hideAdvPanel:function(){this.getAdvPanelElem().style.display="none"},getDefaultCommonToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.commonToolButtons},getZoomButtonNames:function(){return[d.zoomIn,d.zoomOut,d.reset,d.resetZoom]},getDefaultChemToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.chemToolButtons},getCompActionClass:function(h){return this.getChildActionClass(h,true)},_getActionTargetWidget:function(h){if(ClassEx.isOrIsDescendantOf(h,Kekule.Editor.ActionOnComposer)||ClassEx.isOrIsDescendantOf(h,Kekule.Widget.ActionOpenConfigWidget)){return this}else{return this.getEditor()}},createToolButton:function(p,n,k,o){var r=null;var i=DataType.isObjectValue(p)?p.name:p;var l=this.getCompActionClass(i);var j=this._createToolButtonAction(p,k,o);if(DataType.isObjectValue(p)&&!l){if(!l){var m=Object.extend({widget:Kekule.Widget.Button},p)}r=Kekule.Widget.Utils.createFromHash(n,m)}else{var q=j.getPreferredWidgetClass&&j.getPreferredWidgetClass();var h=q?q:(p===d.objInspector)?Kekule.Widget.CheckButton:(!!o)?Kekule.Widget.RadioButton:Kekule.Widget.Button;r=new h(n)}if(j){r.setAction(j)}return r},_createActionButton:function(l,h){var k=l.getCheckGroup();var j=l.getPreferredWidgetClass&&l.getPreferredWidgetClass();var m=j?j:(!!k)?Kekule.Widget.RadioButton:Kekule.Widget.Button;var i=new m(h);i.setAction(l);return i},_createToolButtonAction:function(w,E,B){var r=null;var F=DataType.isObjectValue(w)?w.name:w;var o=DataType.isObjectValue(w)?w.attached:null;var k=this.getCompActionClass(F);var r;if(DataType.isObjectValue(w)&&!k){var n=w;var k=n.actionClass;if(k){if(typeof(k)==="string"){k=ClassEx.findClass(n.actionClass)}}}if(k){var j=this.getActionMap();var r=j.get(k);if(!r){var r=new k(this._getActionTargetWidget(k));j.set(k,r)}var t=B||"";var x=r.getExplicitGroup&&r.getExplicitGroup();if(Kekule.ObjUtils.notUnset(x)){t=x}if(t){r.setCheckGroup(t)}if(r&&E){E.add(r)}if(r&&r.addAttachedAction){var A=r.getClassName();var D=Kekule.ArrayUtils.clone(r.getAttachedActions().getActions()||[]);var m=function(H,G,i,l,J){if(!G){return null}var I=i.indexOf(G);if(I>=0){i[I]=null}else{H.addAttachedAction(G,l)}if(Kekule.ObjUtils.notUnset(J)){H.setAttachedActionIndex(G,J)}};if(o){for(var z=0,y=o.length;z<y;++z){var q=o[z];var p=this._createToolButtonAction(q,null,A);m(r,p,D,z===0,z)}}else{var u=r.getAttachedActionClasses();if(u){for(var z=0,y=u.length;z<y;++z){var v=u[z];var p=j.get(v);if(!p){p=new v(this._getActionTargetWidget(v));var h=(p.getExplicitGroup&&p.getExplicitGroup());if(Kekule.ObjUtils.notUnset(h)){p.setCheckGroup(h)}else{p.setCheckGroup(A)}j.set(v,p)}m(r,p,D,z===0,z)}}}if(D.length){for(var z=0,y=D.length;z<y;++z){var s=D[z];if(s){r.removeAttachedAction(s);j.remove(s.getClass())}}}}}return r},createInnerToolbar:function(h){var i=new Kekule.Widget.ButtonGroup(this);i.addClassName(f.COMPOSER_TOOLBAR);i.addClassName(f.INNER_TOOLBAR);i.addClassName(b.DYN_CREATED);i.setShowText(false);i.doSetShowGlyph(true);i.appendToElem(h||this.getElement());return i},createCommonToolbar:function(){var p=this.getTopRegionElem();var r=this.createInnerToolbar(p);r.addClassName(f.COMPOSER_COMMON_TOOLBAR);var n=this.getCommonToolButtons();n=Kekule.ArrayUtils.exclude(n,this.getZoomButtonNames());var m=this.getCommonActions();var q=this.getEditor();m.clear();for(var o=0,k=n.length;o<k;++o){var h=n[o];var j=this.createToolButton(h,r,m)}this.setCommonBtnGroup(r);r.addClassName(b.DYN_CREATED);this.updateZoomToolbar();this.adjustComponentPositions();return r},createZoomToolbar:function(){var n=Kekule.ArrayUtils.intersect(this.getCommonToolButtons(),this.getZoomButtonNames());if(n.length){var p=this.getBottomRegionElem();var r=this.createInnerToolbar(p);r.addClassName(f.COMPOSER_ZOOM_TOOLBAR);var m=this.getZoomActions();var q=this.getEditor();m.clear();for(var o=0,k=n.length;o<k;++o){var h=n[o];var j=this.createToolButton(h,r,m)}this.setZoomBtnGroup(r);r.addClassName(b.DYN_CREATED);this.adjustComponentPositions();return r}else{this.setZoomBtnGroup(null);return null}},updateCommonToolbar:function(){var h=this.getCommonBtnGroup();if(h){h.finalize()}this.createCommonToolbar()},updateZoomToolbar:function(){var h=this.getZoomBtnGroup();if(h){h.finalize()}this.createZoomToolbar()},createChemToolbar:function(){var q=this.getLeftRegionElem();var t=this.createInnerToolbar(q);t.addClassName(f.COMPOSER_CHEM_TOOLBAR);t.setLayout(Kekule.Widget.Layout.VERTICAL);var o=this.getChemToolButtons();var n=this.getChemActions();n.clear();var s="chemTools";var r;for(var p=0,k=o.length;p<k;++p){var h=o[p];var j=this.createToolButton(h,t,n,s);if(p===0){r=j}}this.setChemBtnGroup(t);t.addClassName(b.DYN_CREATED);this.adjustComponentPositions();if(r){var m=r.getAction();if(m){m.setChecked(true);var u=m.getAttachedActions&&m.getAttachedActions();this.bindAssocActions(u||null)}}return t},updateChemToolbar:function(){var h=this.getChemBtnGroup();if(h){h.finalize()}this.createChemToolbar()},createAssocToolbar:function(){var h=this.getBottomRegionElem();var i=this.createInnerToolbar(h);i.addClassName(f.COMPOSER_ASSOC_TOOLBAR);this.setAssocBtnGroup(i);this.adjustAssocToolbarPositions();i.addClassName(b.DYN_CREATED);return i},changeAssocToolbarRegion:function(i){var k=this.getAssocBtnGroup();if(!k){k=this.createAssocToolbar()}var j;if(i){j=this.getLeftRegionElem();if(k.getElement().parentNode!==j){k.setLayout(Kekule.Widget.Layout.VERTICAL);k.appendToElem(j)}}else{j=this.getBottomRegionElem();if(k.getElement().parentNode!==j){k.setLayout(Kekule.Widget.Layout.HORIZONTAL);var h=Kekule.DomUtils.getFirstChildElem(j);j.insertBefore(k.getElement(),h)}}},showAssocToolbar:function(){var i=this.getAssocBtnGroup();if(!i){i=this.createAssocToolbar()}var h=this;i.show(null,function(){h.uiLayoutChanged();setTimeout(h.updateSelectionAssocToolbarStateBind,0)});return this},hideAssocToolbar:function(){var i=this.getAssocBtnGroup();if(i){var h=this;i.hide(null,function(){h.uiLayoutChanged();setTimeout(h.updateSelectionAssocToolbarStateBind,0)})}return this},isAssocToolbarShown:function(){var h=this.getAssocBtnGroup();return h&&h.isShown()},bindAssocActions:function(o){var m=this.getAssocBtnGroup();if(!m){m=this.createAssocToolbar()}m.clearWidgets();if(o){for(var k=0,h=o.getActionCount();k<h;++k){var n=o.getActionAt(k);var j=this._createActionButton(n,m)}}},createObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var h=new Kekule.Editor.ComposerObjModifierToolbar(this);h.appendToElem(this.getBottomRegionElem());this.setObjModifierToolbar(h);this.adjustAssocToolbarPositions();this.updateObjModifierToolbarState();return h}else{return null}},showObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var i=this.getObjModifierToolbar();if(!i.isShown()){var h=this;i.show(null,function(){h.uiLayoutChanged()})}}return this},hideObjModifierToolbar:function(){var i=this.getPropStoreFieldValue("objModifierToolbar");if(i){if(i.isShown()){var h=this;i.hide(null,function(){h.uiLayoutChanged()},null,{instantly:true})}}return this},isObjModifierToolbarShown:function(){var h=this.getPropStoreFieldValue("objModifierToolbar");return(h&&h.isShown())},updateObjModifierToolbarState:function(){var h=false;if(this.getEnableObjModifierToolbar()&&this.needShowSelectionAssocToolbar()){h=true}if(h){this.showObjModifierToolbar();this.getObjModifierToolbar().updateState()}else{this.hideObjModifierToolbar()}},createStyleToolbar:function(){if(this.getEnableStyleToolbar()){var h=new Kekule.Editor.ComposerStyleToolbar(this);h.setComponentNames(this.getStyleBarComponents());h.appendToElem(this.getBottomRegionElem());this.setStyleToolbar(h);this.adjustAssocToolbarPositions();this.updateStyleToolbarState();return h}else{return null}},showStyleToolbar:function(){if(this.getEnableStyleToolbar()){var i=this.getStyleToolbar();if(!i.isShown()){var h=this;i.show(null,function(){h.uiLayoutChanged()})}}return this},hideStyleToolbar:function(){var i=this.getPropStoreFieldValue("styleToolbar");if(i){if(i.isShown()){var h=this;i.hide(null,function(){h.uiLayoutChanged()})}}return this},isStyleToolbarShown:function(){var h=this.getPropStoreFieldValue("styleToolbar");return(h&&h.isShown())},updateStyleToolbarState:function(){if(this.getEnableStyleToolbar()&&this.needShowSelectionAssocToolbar()){this.showStyleToolbar();this.getStyleToolbar().updateState()}else{this.hideStyleToolbar()}},needShowSelectionAssocToolbar:function(){var h=this.getEditor();return h&&h.hasSelection()},updateSelectionAssocToolbarState:function(){this.adjustStyleAndObjModifierToolbarPosition();this.updateStyleToolbarState();this.updateObjModifierToolbarState()},updateAllActions:function(){this.getCommonActions().updateAll();this.getZoomActions().updateAll();this.getChemActions().updateAll()},updateUiWidgets:function(){this.updateStyleToolbarState();this.updateObjModifierToolbarState()},createConfigurator:function($super){var h=$super();h.addEventListener("configChange",function(i){this.getEditor().repaint()},this);return h}});Kekule.Editor.Composer.getMinPreferredDimension=function(){return{width:630,height:350}};Kekule.Editor.Composer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.Editor.Composer.Settings",initialize:function($super,h){$super(h)},initProperties:function(){this.defineDelegatedProps(["enableCreateNewDoc","enableLoadNewFile","initOnNewDoc","enableOperHistory","allowCreateNewChild","enableStyleToolbar"])}});Kekule.Editor.Composer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.Editor.Composer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function($super,h){$super(h)},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function($super){var w=$super();var h=this.getComposer();var t=h.getEditor();var p=[t.getDisplayerConfigs(),t.getRenderConfigs()];for(var q=0,o=p.length;q<o;++q){var m=p[q];var v=m.getPropListOfScopes([Class.PropertyScope.PUBLISHED]);for(var s=0,n=v.getLength();s<n;++s){var u=v.getPropInfoAt(s);var r=m.getPropValue(u.name);if(r){w.push({obj:r,name:u.name,title:u.title,description:u.description})}}}return w},getComposer:function(){return this.getWidget()},getEditor:function(){return this.getComposer().getEditor()}});Kekule._registerAfterLoadSysProc(function(){var i=Kekule.Editor.ObjModifier.Category;var h=Kekule.ObjPropSettingManager;h.register("Kekule.Editor.Composer.fullFunc",{enableStyleToolbar:true,enableOperHistory:true,enableLoadNewFile:true,enableCreateNewDoc:true,allowCreateNewChild:true,commonToolButtons:null,chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null});h.register("Kekule.Editor.Composer.molOnly",{enableStyleToolbar:true,enableOperHistor:true,enableLoadNewFile:true,enableCreateNewDoc:true,allowCreateNewChild:true,commonToolButtons:null,chemToolButtons:[d.manipulate,d.erase,d.molBond,d.molAtom,d.molRing,d.molCharge],styleToolComponentNames:null,allowedObjModifierCategories:[i.GENERAL,i.CHEM_STRUCTURE]});h.register("Kekule.Editor.Composer.compact",{enableStyleToolbar:false,commonToolButtons:[d.newDoc,d.loadData,d.saveData,d.undo,d.redo,d.zoomIn,d.zoomOut],chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null});h.register("Kekule.Editor.Composer.singleObj",{allowCreateNewChild:false})});Kekule.Editor.ComposerDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.Editor.ComposerDialog",initialize:function($super,h,i,j){$super(h,i,j||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false,setter:null});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,getter:function(){var h=this.getComposer();return h&&h.getChemObj()},setter:function(h){var i=this.getComposer();if(i){i.setChemObj(h)}}})},initPropValues:function($super){$super()},doGetWidgetClassName:function($super){return $super()+" "+f.COMPOSER_DIALOG},doCreateClientContents:function($super,i){$super();var h=this.doCreateComposerWidget();this.setPropStoreFieldValue("composer",h);h.appendToElem(i)},getSavingTargetObj:function(){var h=this.getComposer();if(h){return h.getSavingTargetObj()}else{return null}},doCreateComposerWidget:function(){var h=new Kekule.Editor.Composer(this);h.addClassName(b.DYN_CREATED);if(h.setResizable){h.setResizable(true)}var i=h.getEditor();i.addClassName(b.DYN_CREATED);return h}});Kekule.Editor.ComposerFrame=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.ComposerFrame",BINDABLE_TAG_NAMES:["iframe"],initialize:function($super,h){$super(h)},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null});this.defineProp("frameDocument",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null,getter:function(){return this.getElement().contentDocument}});this.defineProp("frameWindow",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:false,setter:null,getter:function(){return Kekule.DocumentUtils.getDefaultView(this.getFrameDocument())}})},initPropValues:function($super){$super();this.setMinDimension({width:550,height:350});this.setEnableDimensionTransform(true)},doGetWidgetClassName:function($super){return $super()+" "+f.COMPOSER_FRAME},doCreateRootElement:function(i){var h=i.createElement("iframe");return h},doBindElement:function($super,h){$super(h);var i=!h.parentNode;if(i){this.setDisplayed(false);var j=h.ownerDocument;j.body.appendChild(h)}this._createComposerWidgetInFrame()},_initFrame:function(){var h="<!DOCTYPE html><html><head></head><body></body></html>";var i=this.getFrameDocument();i.open("text/htmlreplace");i.write(h);i.close()},_createComposerWidgetInFrame:function(j){this._initFrame();var h=this;var i=this.getFrameDocument();i.documentElement.className=f.COMPOSER_FRAME_CONTENT_DOC;i.body.className=f.COMPOSER_FRAME_CONTENT_BODY;Kekule.X.Event.addListener(i.body,"kekuleload",function(l){var k=new Kekule.Editor.Composer(i);k.appendToElem(i.body);h.setPropStoreFieldValue("composer",k);if(j){j(k)}});this._insertKekuleScriptAndStyleSheetFiles(i)},_insertKekuleScriptAndStyleSheetFiles:function(h,l){var k=Kekule.scriptSrcInfo;var j=h.head;var i=h.createElement("link");i.setAttribute("rel","stylesheet");i.setAttribute("type","text/css");i.setAttribute("href",Kekule.getStyleSheetUrl());j.appendChild(i);Kekule.ScriptFileUtils.appendScriptFile(h,Kekule.getScriptSrc(),l)}})})();(function(){var a=Kekule.ArrayUtils;var c=Kekule.ChemWidget.ComponentWidgetNames;var e=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ActionManager;var b=[];Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{ACTION_UNDO:"K-Chem-Undo",ACTION_REDO:"K-Chem-Redo",ACTION_NEWDOC:"K-Chem-NewDoc",ACTION_CLONE_SELECTION:"K-Chem-Clone-Selection",ACTION_COPY:"K-Chem-Copy",ACTION_CUT:"K-Chem-Cut",ACTION_PASTE:"K-Chem-Paste",ACTION_TOGGLE_SELECT:"K-Chem-Toggle-Select-State",ACTION_TOGGLE_INSPECTOR:"K-Chem-Toggle-Inspector"});Object.extend(Kekule.ChemWidget.ComponentWidgetNames,{manipulateMarquee:"manipulateMarquee",manipulateLasso:"manipulateLasso",manipulateBrush:"manipulateBrush",manipulateAncestor:"manipulateAncestor",molBondSingle:"bondSingle",molBondDouble:"bondDouble",molBondTriple:"bondTriple",molBondCloser:"bondCloser",molBondWedgeUp:"bondWedgeUp",molBondWedgeDown:"bondWedgeDown",molBondWedgeUpOrDown:"bondWedgeUpOrDown",molBondDoubleEither:"bondDoubleEither",molChargeClear:"chargeClear",molChargePositive:"chargePositive",molChargeNegative:"chargeNegative",molRadicalSinglet:"radicalSinglet",molRadicalTriplet:"radicalTriplet",molRadicalDoublet:"radicalDoublet",molElectronLonePair:"electronLonePair",molChain:"chain",molRing3:"ring3",molRing4:"ring4",molRing5:"ring5",molRing6:"ring6",molRing7:"ring7",molRing8:"ring8",molRingAr6:"ringAr6",molRingAr5:"ringAr5",molFlexRing:"flexRing",molRepCyclopentaneHaworth1:"repCyclopentaneHaworth1",molRepCyclopentaneHaworth2:"repCyclopentaneHaworth2",molRepCyclohexaneHaworth1:"repCyclohexaneHaworth1",molRepCyclohexaneHaworth2:"repCyclohexaneHaworth2",molRepCyclohexaneChair1:"repCyclohexaneChair1",molRepCyclohexaneChair2:"repCyclohexaneChair2",molRepSubBondMark:"subBondMark",molRepMethane:"methane",molRepFischer1:"repFischer1",molRepFischer2:"repFischer2",molRepFischer3:"repFischer3",molRepSawhorseStaggered:"repSawhorseStaggered",molRepSawhorseEclipsed:"repSawhorseEclipsed",glyphRepLine:"repLine",glyphRepOpenArrowLine:"repOpenArrowLine",glyphRepTriangleArrowLine:"repTriangleArrowLine",glyphRepDiOpenArrowLine:"repDiOpenArrowLine",glyphRepDiTriangleArrowLine:"repDiTriangleArrowLine",glyphRepReversibleArrowLine:"repReversibleArrowLine",glyphRepOpenArrowDiLine:"repOpenArrowDiLine",glyphRepHeatSymbol:"repHeatSymbol",glyphRepAddSymbol:"repAddSymbol"});Kekule.Editor.ActionOperUtils={addObjectsToChemSpaceEditor:function(p,n,f){var g=p.getChemSpace&&p.getChemSpace();if(p&&g&&p.canAddNewStandaloneObject&&p.canAddNewStandaloneObject()){p.beginUpdateObject();try{var r=new Kekule.MacroOperation();for(var m=0,j=n.length;m<j;++m){var k=n[m];var h=new Kekule.ChemObjOperation.Add(n[m],g,null,p);r.add(h)}r.execute();if(f){for(var m=0,j=n.length;m<j;++m){var k=n[m];var o=p.getObjectScreenCoord(k);var q=Kekule.CoordUtils.add(o,f);p.setObjectScreenCoord(k,q)}}p.pushOperation(r);p.select(n)}finally{p.endUpdateObject()}}}};Kekule.Editor.ActionOnEditor=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.Editor.ActionOnEditor",initialize:function($super,g,f,h){$super(g,f,h)},initProperties:function(){this.defineProp("explicitGroup",{dataType:DataType.STRING})},getPreferredWidgetClass:function(){return null},doUpdate:function(){var f=this.getDisplayer();this.setEnabled(f&&f.getChemObj()&&f.getChemObjLoaded()&&f.getEnabled())},getEditor:function(){var f=this.getDisplayer();return(f instanceof Kekule.Editor.BaseEditor)?f:null}});Kekule.Editor.ActionEditorUndo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorUndo",HTML_CLASSNAME:e.ACTION_UNDO,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_UNDO"),Kekule.$L("ChemWidgetTexts.HINT_UNDO"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().canUndo())}},doExecute:function(){var f=this.getEditor();if(f){f.undo()}}});Kekule.Editor.ActionEditorRedo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorRedo",HTML_CLASSNAME:e.ACTION_REDO,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_REDO"),Kekule.$L("ChemWidgetTexts.HINT_REDO"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().canRedo())}},doExecute:function(){var f=this.getEditor();if(f){f.redo()}}});Kekule.Editor.ActionEditorNewDoc=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorNewDoc",HTML_CLASSNAME:e.ACTION_NEWDOC,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_NEWDOC"),Kekule.$L("ChemWidgetTexts.HINT_NEWDOC"))},doUpdate:function(){var f=this.getDisplayer();this.setEnabled(f&&f.getEnabled()&&f.getEnableCreateNewDoc())},doExecute:function(){var f=this.getEditor();if(f){f.newDoc()}}});Kekule.Editor.ActionCloneSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCloneSelection",HTML_CLASSNAME:e.ACTION_CLONE_SELECTION,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_CLONESELECTION"),Kekule.$L("ChemWidgetTexts.HINT_CLONE_SELECTION"))},_hasCloneMethod:function(){var f=this.getEditor();return f&&f.cloneSelection},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this._hasCloneMethod()&&this.getEditor().hasSelection())}this.setDisplayed(this._hasCloneMethod()&&this.getEditor().canCloneObjects())},doExecute:function(){var f=this.getEditor();if(f&&f.getChemSpace){var g=f.getDefaultCloneScreenCoordOffset&&f.getDefaultCloneScreenCoordOffset();var h=f.cloneSelection();Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(f,h,g)}}});Kekule.Editor.ActionCopySelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCopySelection",HTML_CLASSNAME:e.ACTION_COPY,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_COPY"),Kekule.$L("ChemWidgetTexts.HINT_COPY"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().hasSelection())}},doExecute:function(){var f=this.getEditor();var g=f.getChemSpace&&f.getChemSpace();if(f&&g){var h=f.cloneSelection();Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,h)}}});Kekule.Editor.ActionCutSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCutSelection",HTML_CLASSNAME:e.ACTION_CUT,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_CUT"),Kekule.$L("ChemWidgetTexts.HINT_CUT"))},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().hasSelection())}},doExecute:function(){var g=this.getEditor();var h=g.getChemSpace&&g.getChemSpace();if(g&&h){var i=g.cloneSelection();Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,i);var f=g.getIaController("BasicMolEraserIaController");if(f){f.removeSelection()}}}});Kekule.Editor.ActionPaste=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionPaste",HTML_CLASSNAME:e.ACTION_PASTE,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_PASTE"),Kekule.$L("ChemWidgetTexts.HINT_PASTE"));Kekule.Widget.clipboard.addEventListener("setData",this._reactClipboardChange,this)},finalize:function($super){Kekule.Widget.clipboard.removeEventListener("setData",this._reactClipboardChange,this);$super()},_reactClipboardChange:function(){this.update()},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(Kekule.Widget.clipboard.hasData(Kekule.IO.MimeType.JSON)&&this.getEditor().canAddNewStandaloneObject())}},getObjsCenterScreenCoord:function(m,o){var h=Kekule.BoxUtils;var r=Kekule.CoordUtils;var f=null;for(var j=0,g=o.length;j<g;++j){var k=Kekule.Render.ObjUtils.getContainerBox(o[j],m.getCoordMode(),m.getAllowCoordBorrow());if(!f){f=k}else{f=h.getContainerBox(k,f)}}var n=h.getMinMaxCoords(f);var q={min:m.objCoordToScreen(n.min),max:m.objCoordToScreen(n.max)};var p=r.add(q.min,q.max);var p=r.divide(p,2);return p},doExecute:function(){var i=this.getEditor();if(i&&i.getChemSpace){var l=Kekule.Widget.clipboard.getObjects(Kekule.IO.MimeType.JSON);var k=null;var m=i.getSelection();if(m&&m.length){k=i.getDefaultCloneScreenCoordOffset?i.getDefaultCloneScreenCoordOffset():null;var j=a.clone(m);if(j&&j.length&&k){var g=this.getObjsCenterScreenCoord(i,j);var h=this.getObjsCenterScreenCoord(i,l);var f=Kekule.CoordUtils.substract(g,h);k=Kekule.CoordUtils.add(k,f)}}Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(i,l,k)}}});Kekule.Editor.ActionToggleSelectState=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionToggleSelectState",HTML_CLASSNAME:e.ACTION_TOGGLE_SELECT,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_SELECT"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_SELECT"));this.setExplicitGroup("")},getPreferredWidgetClass:function(){return Kekule.Widget.CheckButton},doUpdate:function($super){$super();this.setChecked(this.getEditor().getIsToggleSelectOn())},checkedChanged:function($super){$super()},doExecute:function($super,i,f){$super(i,f);var h=this.getChecked();var g=this.getEditor();g.setIsToggleSelectOn(!h);this.setChecked(!h)}});Kekule.Editor.ActionOnComposer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Editor.ActionOnComposer",initialize:function($super,g,f,h){$super();this.setText(f);this.setHint(h);this.setComposer(g)},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false})},doUpdate:function(){var f=this.getComposer();var g=this.getEditor();this.setEnabled(f&&f.getEnabled()&&g&&g.getChemObj()&&g.getChemObjLoaded()&&g.getEnabled())},getEditor:function(){var f=this.getComposer();return f?f.getEditor():null}});Kekule.Editor.ActionOnComposerAdv=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionOnComposerAdv",initialize:function($super,g,f,i){var h=new Kekule.ActionList();h.setOwnActions(true);this.setPropStoreFieldValue("attachedActions",h);$super(g,f,i)},finalize:function($super){this.getAttachedActions().finalize();$super()},initProperties:function(){this.defineProp("attachedActionClasses",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("attachedActions",{dataType:"Kekule.ActionList",serializable:false,setter:null});this.defineProp("defaultAttachedAction",{dataType:"Kekule.Action",serializable:false})},checkedChanged:function($super){$super();var h=this.getChecked();if(this.hasAttachedActions()){var g=this.getComposer();if(g){if(h){var f=this.getAttachedActions();g.bindAssocActions(f);g.showAssocToolbar();var i=f.getCheckedAction(this.getClassName());if(!i){i=this.getDefaultAttachedAction()}if(i){i.setChecked(false);i.execute()}}else{g.hideAssocToolbar()}}}},hasAttachedActions:function(){return !!this.getAttachedActions().getActionCount()},setAttachedActionIndex:function(g,f){var h=this.getAttachedActions();if(h){h.setActionIndex(g,f)}return this},addAttachedAction:function(g,f){this.getAttachedActions().add(g);if(f){this.setDefaultAttachedAction(g)}return this},removeAttachedAction:function(f){if(this.getDefaultAttachedAction()===f){this.setDefaultAttachedAction(null)}this.getAttachedActions().remove(f);return this},clearAttachedActions:function(){this.setDefaultAttachedAction(null);var f=this.getAttachedActions();f.clear()},doExecute:function(){},update:function($super){$super();this.getAttachedActions().updateAll()}});Kekule.Editor.ActionComposerToggleInspector=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleInspector",HTML_CLASSNAME:e.ACTION_TOGGLE_INSPECTOR,initialize:function($super,f){$super(f,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_INSPECTOR"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_INSPECTOR"))},doUpdate:function(){var f=this.getComposer();if(f){this.setChecked(f.getShowInspector())}},doExecute:function(){var f=this.getComposer();if(f){this.setChecked(!this.getChecked());f.setShowInspector(this.getChecked())}}});Kekule.Editor.ActionComposerSetIaController=Class.create(Kekule.Editor.ActionOnComposerAdv,{CLASS_NAME:"Kekule.Editor.ActionComposerSetIaController",initialize:function($super,g,f,i,h){$super(g,f,i);this.setPropStoreFieldValue("iaControllerId",h)},initProperties:function(){this.defineProp("iaControllerId",{dataType:DataType.STRING,serializable:false,setter:null})},doExecute:function(){this.getEditor().setActiveIaControllerId(this.getIaControllerId())}});Kekule.Editor.createComposerIaControllerActionClass=function(o,p,j,m,l,i,f,g,n,h){if(!l){l=m}if(!l.startsWith(Kekule.ChemWidget.HtmlClassNames.PREFIX)){l=Kekule.ChemWidget.HtmlClassNames.PREFIX+l}var k={CLASS_NAME:o,HTML_CLASSNAME:l,initialize:function($super,s){$super(s,p,j,m);if(this.initAttachedActions){this.initAttachedActions()}}};if(g){k=Object.extend(k,g)}if(i){var r;if(k.doExecute){r=k.doExecute}k.doExecute=function($super){var t=this.getEditor();var s=t.getIaController(m);if(s){s.setPropValues(i)}if(r){r.apply(this,[$super])}else{$super()}}}if(f){k.initAttachedActions=function(){this.setPropStoreFieldValue("attachedActionClasses",f)}}var q=Class.create(Kekule.Editor.ActionComposerSetIaController,k);if(n){b.push({name:n,actionClass:q,widgetClass:h})}return q};Kekule.Editor.ActionComposerClientDragScrollController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerClientDragScrollController",Kekule.$L("ChemWidgetTexts.CAPTION_CLIENT_DRAGSCROLL"),Kekule.$L("ChemWidgetTexts.HINT_CLIENT_DRAGSCROLL"),"ClientDragScrollIaController",null,null,null,null,c.dragScroll);Kekule.Editor.ActionComposerSetManipulateControllerMarquee=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerMarquee",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_MARQUEE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_MARQUEE"),"BasicMolManipulationIaController","BasicMolManipulationIaController-Marquee",{enableSelect:true,enableGestureManipulation:true,selectMode:Kekule.Editor.SelectMode.RECT},null,{doExecute:function($super){$super();var f=this.getEditor();f.setSelectMode(Kekule.Editor.SelectMode.RECT)}},c.manipulateMarquee);Kekule.Editor.ActionComposerSetManipulateControllerLasso=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerLasso",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_LASSO"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_LASSO"),"BasicMolManipulationIaController","BasicMolManipulationIaController-Lasso",{enableSelect:true,enableGestureManipulation:true,selectMode:Kekule.Editor.SelectMode.POLYGON},null,{doExecute:function($super){$super();var f=this.getEditor();f.setSelectMode(Kekule.Editor.SelectMode.POLYGON)}},c.manipulateLasso);Kekule.Editor.ActionComposerSetManipulateControllerBrush=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerBrush",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_BRUSH"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_BRUSH"),"BasicMolManipulationIaController","BasicMolManipulationIaController-Brush",{enableSelect:true,enableGestureManipulation:true,selectMode:Kekule.Editor.SelectMode.POLYLINE},null,{doExecute:function($super){$super();var f=this.getEditor();f.setSelectMode(Kekule.Editor.SelectMode.POLYLINE)}},c.manipulateBrush);Kekule.Editor.ActionComposerSetManipulateControllerAncestor=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerAncestor",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_ANCESTOR"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_ANCESTOR"),"BasicMolManipulationIaController","BasicMolManipulationIaController-Ancestor",{enableSelect:true,enableGestureManipulation:true,selectMode:Kekule.Editor.SelectMode.ANCESTOR},null,{doExecute:function($super){$super();var f=this.getEditor();f.setSelectMode(Kekule.Editor.SelectMode.ANCESTOR)}},c.manipulateAncestor);Kekule.Editor.ActionComposerSetManipulateController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateController",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE"),"BasicMolManipulationIaController",null,null,[Kekule.Editor.ActionComposerSetManipulateControllerMarquee,Kekule.Editor.ActionComposerSetManipulateControllerLasso,Kekule.Editor.ActionComposerSetManipulateControllerBrush,Kekule.Editor.ActionComposerSetManipulateControllerAncestor,Kekule.Editor.ActionComposerClientDragScrollController,Kekule.Editor.ActionToggleSelectState],null,c.manipulate);Kekule.Editor.ActionComposerSetEraserController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetEraserController",Kekule.$L("ChemWidgetTexts.CAPTION_ERASE"),Kekule.$L("ChemWidgetTexts.HINT_ERASE"),"BasicMolEraserIaController",null,null,null,{doExecute:function($super){$super();var f=this.getEditor();if(f.hasSelection()){f.getActiveIaController().removeSelection()}}},c.erase);Kekule.Editor.ActionComposerSetTrackController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTrackController",Kekule.$L("ChemWidgetTexts.CAPTION_TRACK_INPUT"),Kekule.$L("ChemWidgetTexts.HINT_TRACK_INPUT"),"TrackInputIaController",null,null,null,null,c.trackInput);Kekule.Editor.ActionComposerSetBondControllerSingle=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerSingle",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),"MolBondIaController","MolBondIaController-Single",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.NONE},null,null,c.molBondSingle);Kekule.Editor.ActionComposerSetBondControllerDouble=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDouble",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),"MolBondIaController","MolBondIaController-Double",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.NONE},null,null,c.molBondDouble);Kekule.Editor.ActionComposerSetBondControllerTriple=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerTriple",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),"MolBondIaController","MolBondIaController-Triple",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.TRIPLE,bondStereo:Kekule.BondStereo.NONE},null,null,c.molBondTriple);Kekule.Editor.ActionComposerSetBondControllerCloser=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerCloser",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),"MolBondIaController","MolBondIaController-Closer",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.CLOSER},null,null,c.molBondCloser);Kekule.Editor.ActionComposerSetBondControllerWedgeUp=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUp",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),"MolBondIaController","MolBondIaController-WedgeUp",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP},null,null,c.molBondWedgeUp);Kekule.Editor.ActionComposerSetBondControllerWedgeDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),"MolBondIaController","MolBondIaController-WedgeDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.DOWN},null,null,c.molBondWedgeDown);Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),"MolBondIaController","MolBondIaController-WedgeUpOrDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP_OR_DOWN},null,null,c.molBondWedgeUpOrDown);Kekule.Editor.ActionComposerSetBondControllerDoubleEither=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDoubleEither",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),"MolBondIaController","MolBondIaController-Double-Either",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.E_OR_Z},null,null,c.molBondDoubleEither);Kekule.Editor.ActionComposerSetRepositoryFischer1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer1",{repItemName:"fischer1"},null,null,c.molRepFischer1);Kekule.Editor.ActionComposerSetRepositoryFischer2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer2",{repItemName:"fischer2"},null,null,c.molRepFischer2);Kekule.Editor.ActionComposerSetRepositoryFischer3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER3"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer3",{repItemName:"fischer3"},null,null,c.molRepFischer3);Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_STAGGERED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_STAGGERED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseStaggered",{repItemName:"sawhorseStaggered"},null,null,c.molRepSawhorseStaggered);Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_ECLIPSED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_ECLIPSED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseEclipsed",{repItemName:"sawhorseEclipsed"},null,null,c.molRepSawhorseEclipsed);Kekule.Editor.ActionComposerSetRepositoryMethaneController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMethaneController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_METHANE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_METHANE"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Methane",{repItemName:"methane"},null,null,c.molRepMethane);Kekule.Editor.ActionComposerSetRepositorySubBondMarkController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySubBondMarkController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SUBBOND_MARK"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SUBBOND_MARK"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SubBondMark",{repItemName:"substituentMark"},null,null,c.molRepSubBondMark);Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FLEXCHAIN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FLEXCHAIN"),"MolFlexChainIaController","MolFlexChainIaController",null,null,null,c.molChain);Kekule.Editor.ActionComposerSetBondController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND"),"MolBondIaController",null,null,[Kekule.Editor.ActionComposerSetBondControllerSingle,Kekule.Editor.ActionComposerSetBondControllerDouble,Kekule.Editor.ActionComposerSetBondControllerTriple,Kekule.Editor.ActionComposerSetBondControllerWedgeUp,Kekule.Editor.ActionComposerSetBondControllerWedgeDown,Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController,Kekule.Editor.ActionComposerSetTrackController,Kekule.Editor.ActionComposerSetRepositoryFischer1Controller,Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController,Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController],null,c.molBond);Kekule.Editor.ActionComposerSetAtomController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM"),"MolAtomIaController",null,null,null,null,c.molAtom);Kekule.Editor.ActionComposerSetFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FORMULA"),"FormulaIaController",null,null,null,null,c.molFormula);Kekule.Editor.ActionComposerSetAtomAndFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomAndFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM_AND_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM_AND_FORMULA"),"MolAtomIaController",null,null,[Kekule.Editor.ActionComposerSetAtomController,Kekule.Editor.ActionComposerSetFormulaController],null,c.molAtomAndFormula);Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ELECTRON_LONEPAIR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ELECTRON_LONEPAIR"),"AttachedMarkerIaController","AttachedMarkerIaController-LonePair",{markerClassName:"Kekule.ChemMarker.UnbondedElectronSet",targetClassName:"Kekule.AbstractAtom",initialPropValues:{electronCount:2}},null,null,c.molElectronLonePair);Kekule.Editor.ActionComposerSetNodeChargeControllerClear=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerClear",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_CLEAR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_CLEAR"),"MolNodeChargeIaController","MolNodeChargeIaController-Clear",{charge:0,chargeInc:0,radical:Kekule.RadicalOrder.NONE},null,null,c.molChargeClear);Kekule.Editor.ActionComposerSetNodeChargeControllerPositive=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerPositive",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_POSITIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_POSITIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Positive",{charge:null,chargeInc:1,radical:Kekule.RadicalOrder.NONE},null,null,c.molChargePositive);Kekule.Editor.ActionComposerSetNodeChargeControllerNegative=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerNegative",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_NEGATIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_NEGATIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Negative",{charge:null,chargeInc:-1,radical:Kekule.RadicalOrder.NONE},null,null,c.molChargeNegative);Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_SINGLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_SINGLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Singlet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.SINGLET},null,null,c.molRadicalSinglet);Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_TRIPLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_TRIPLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Triplet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.TRIPLET},null,null,c.molRadicalTriplet);Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_DOUBLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_DOUBLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Doublet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.DOUBLET},null,null,c.molRadicalDoublet);Kekule.Editor.ActionComposerSetNodeChargeController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE"),"MolNodeChargeIaController",null,null,[Kekule.Editor.ActionComposerSetNodeChargeControllerClear,Kekule.Editor.ActionComposerSetNodeChargeControllerPositive,Kekule.Editor.ActionComposerSetNodeChargeControllerNegative,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet,Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair],null,c.molCharge);Kekule.Editor.ActionComposerSetTextBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_BLOCK"),"TextBlockIaController",null,null,null,null,c.textBlock);Kekule.Editor.ActionComposerSetImageBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetImageBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_IMAGE_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_IMAGE_BLOCK"),"ImageBlockIaController",null,null,null,null,c.imageBlock);Kekule.Editor.ActionComposerSetTextImageController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextImageController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_IMAGE"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_IMAGE"),"TextImageIaController","TextImageIaController",null,[Kekule.Editor.ActionComposerSetTextBlockController,Kekule.Editor.ActionComposerSetImageBlockController],null,c.textImage);Kekule.Editor.ActionComposerSetRepositoryRing3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_3"),"MolRingIaController","MolRingIaController-3",{ringAtomCount:3,isAromatic:false},null,null,c.molRing3);Kekule.Editor.ActionComposerSetRepositoryRing4Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing4Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_4"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_4"),"MolRingIaController","MolRingIaController-4",{ringAtomCount:4,isAromatic:false},null,null,c.molRing4);Kekule.Editor.ActionComposerSetRepositoryRing5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_5"),"MolRingIaController","MolRingIaController-5",{ringAtomCount:5,isAromatic:false},null,null,c.molRing5);Kekule.Editor.ActionComposerSetRepositoryRing6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_6"),"MolRingIaController","MolRingIaController-6",{ringAtomCount:6,isAromatic:false},null,null,c.molRing6);Kekule.Editor.ActionComposerSetRepositoryRing7Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing7Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_7"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_7"),"MolRingIaController","MolRingIaController-7",{ringAtomCount:7,isAromatic:false},null,null,c.molRing7);Kekule.Editor.ActionComposerSetRepositoryRing8Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing8Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_8"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_8"),"MolRingIaController","MolRingIaController-8",{ringAtomCount:8,isAromatic:false},null,null,c.molRing8);Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_6"),"MolRingIaController","MolRingIaController-Ar-6",{ringAtomCount:6,isAromatic:true},null,null,c.molRingAr6);Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_5"),"MolRingIaController","MolRingIaController-Ar-5",{ringAtomCount:5,isAromatic:true},null,null,c.molRingAr5);Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FLEXRING"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FLEXRING"),"MolFlexRingIaController","MolFlexRingIaController",null,null,null,c.molFlexRing);Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth1",{repItemName:"cyclopentaneHaworth1"},null,null,c.molRepCyclopentaneHaworth1);Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth2",{repItemName:"cyclopentaneHaworth2"},null,null,c.molRepCyclopentaneHaworth2);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth1",{repItemName:"cyclohexaneHaworth1"},null,null,c.molRepCyclohexaneHaworth1);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth2",{repItemName:"cyclohexaneHaworth2"},null,null,c.molRepCyclohexaneHaworth2);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair1",{repItemName:"cyclohexaneChair1"},null,null,c.molRepCyclohexaneChair1);Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair2",{repItemName:"cyclohexaneChair2"},null,null,c.molRepCyclohexaneChair2);Kekule.Editor.ActionComposerSetRepositoryRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING"),"MolRingIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryRing3Controller,Kekule.Editor.ActionComposerSetRepositoryRing4Controller,Kekule.Editor.ActionComposerSetRepositoryRing5Controller,Kekule.Editor.ActionComposerSetRepositoryRing6Controller,Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController,Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller,Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller],null,c.molRing);Kekule.Editor.ActionComposerSetRepositoryPathLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathGlyphLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:null,lineLength:1.5},null,null,c.glyphRepLine);Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepOpenArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-TriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepTriangleArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiOpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepDiOpenArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiTriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.TRIANGLE,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}},null,null,c.glyphRepDiTriangleArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_REV_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-ReversibleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowSide:Kekule.Glyph.ArrowSide.REVERSED,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowSide:Kekule.Glyph.ArrowSide.SINGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5,lineGap:0.1,lineCount:2}},null,null,c.glyphRepReversibleArrowLine);Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowDiLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5,lineGap:0.1,lineCount:2}},null,null,c.glyphRepOpenArrowDiLine);Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_HEAT_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_HEAT_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-HeatSymbol",{glyphClass:Kekule.Glyph.HeatSymbol,glyphInitialParams:{lineLength:1}},null,null,c.glyphRepHeatSymbol);Kekule.Editor.ActionComposerSetRepositoryAddSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryAddSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ADD_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ADD_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-AddSymbol",{glyphClass:Kekule.Glyph.AddSymbol,glyphInitialParams:{lineLength:1}},null,null,c.glyphRepAddSymbol);Kekule.Editor.ActionComposerSetRepositoryGlyphController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryGlyphController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ARROWLINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ARROWLINE"),"ArrowLineIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController,Kekule.Editor.ActionComposerSetRepositoryPathLineController,Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController,Kekule.Editor.ActionComposerSetRepositoryAddSymbolController],null,c.glyph);Kekule._registerAfterLoadSysProc(function(){var m=Kekule.ActionManager;var g=Kekule.ChemWidget;var o=Kekule.Editor;var n=Kekule.Editor.ChemSpaceEditor;var j=m.registerNamedActionClass;j(c.newDoc,o.ActionEditorNewDoc,n);j(c.loadFile,g.ActionDisplayerLoadFile,n);j(c.loadData,g.ActionDisplayerLoadData,n);j(c.saveData,g.ActionDisplayerSaveFile,n);j(c.zoomIn,g.ActionDisplayerZoomIn,n);j(c.zoomOut,g.ActionDisplayerZoomOut,n);j(c.resetZoom,g.ActionDisplayerResetZoom,n);j(c.reset,g.ActionDisplayerReset,n);j(c.config,Kekule.Widget.ActionOpenConfigWidget,n);j(c.undo,o.ActionEditorUndo,n);j(c.redo,o.ActionEditorRedo,n);j(c.cloneSelection,o.ActionCloneSelection,n);j(c.copy,o.ActionCopySelection,n);j(c.cut,o.ActionCutSelection,n);j(c.paste,o.ActionPaste,n);j(c.objInspector,o.ActionComposerToggleInspector,n);for(var h=0,f=b.length;h<f;++h){var k=b[h];j(k.name,k.actionClass,k.widgetClass||n)}})})();(function(){var a=Kekule.ArrayUtils;var b=Kekule.CoordUtils;Kekule.Editor.PointerTrackConstraint={NONE:0,LEADING:1,BOTH:2,CIRCLE:5};Kekule.Editor.TrackParser=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackParser",simplifyCurveToLineSegments:function(d,c){return Kekule.GeometryUtils.simplifyCurveToLineSegments(d,c)},addLineCrossPoints:function(m){var n=[];var c=m.length;for(var g=0;g<c-1;++g){var d={coord1:m[g],coord2:m[g+1]};for(var f=g+2;f<c-1;++f){var l={coord1:m[f],coord2:m[f+1]};var h=Kekule.GeometryUtils.getCrossPointOfLines(d.coord1,d.coord2,l.coord1,l.coord2);if(h){this._addInsertedPoint(g,h,n);this._addInsertedPoint(f,h,n)}}}for(var g=0;g<c-1;++g){if(n[g]){this._sortInsertedPointsInLine(n[g],m[g],m[g+1])}}var o=[];for(var g=0;g<c-1;++g){o.push(m[g]);if(n[g]){for(var f=0,e=n[g].length;f<e;++f){o.push(n[g][f])}}}o.push(m[c-1]);return o},addVertexToLineMergePoint:function(o,g){if(g<=0){return o}var c=o.length;var p=[];for(var l=0;l<c-1;++l){var e=o[l];for(var h=0;h<c-1;++h){if(h<l-1||h>l+1){var m=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(e,o[h],o[h+1],false);if(m){var n=Kekule.CoordUtils.getDistance(e,m);if(n<=g){e.x=m.x;e.y=m.y;this._addInsertedPoint(h,e,p)}}}}}var q=[];for(var l=0;l<c-1;++l){q.push(o[l]);if(p[l]){this._sortInsertedPointsInLine(p[l],o[l],o[l+1]);for(var h=0,f=p[l].length;h<f;++h){q.push(p[l][h])}}}q.push(o[c-1]);return q},_addInsertedPoint:function(d,c,e){if(!e[d]){e[d]=[]}e[d].push(c)},_sortInsertedPointsInLine:function(g,f,d){if(!g){return}var e=d.x-f.x;var c=d.y-f.y;g.sort(function(i,h){if(Math.abs(c)>Math.abs(e)){return -(h.y-i.y)*c}else{return -(h.x-i.x)*e}})},mergeNearbyTrackPoints:function(p,h){if(h<=0){return p}var f="__$merge_handled__";var r="__$merge_weight__";var e=p.length;var t=p.concat([]);for(var m=0;m<e;++m){var c=t[m];if(!c[f]){for(var l=m+1;l<e;++l){var g=t[l];if(!g[f]){var s=c[r]||1;var k=g[r]||1;var o=Kekule.CoordUtils.getDistance(c,g);if(o<=h){var q;var n=s+k;c[r]=n;if(c.boundObj){q=c}else{if(g.boundObj){q=g;c.boundObj=g.boundObj}else{q=(s===1)?c:b.multiply(c,s);q=b.add(q,(k===1)?g:b.multiply(g,k));q=b.divide(q,n)}}c.x=q.x;c.y=q.y;t.splice(l,1,c)}}}}c[f]=true}return t},mergeCloseVertexes:function(d,c){c=c||this.getVertexMergeRadius();if(c<=0){return d}return this._doMergeCloseVertexes(d,c)},_doMergeCloseVertexes:function(q,k){var h=q.getVertexes();var g=h.length;var f=false;for(var n=0;n<g;++n){var e=h[n];var p=h[n].getData("coord");for(var l=n+1;l<g;++l){var m=h[l];var c=m.getData("coord");var o=Kekule.CoordUtils.getDistance(p,c);if(o<=k){this._doMergeVertex(q,e,m);f=true;break}}if(f){break}}if(f){return this._doMergeCloseVertexes(q,k)}else{return q}},_doMergeVertex:function(n,c,f){var j=c.getData("coord");var g=c.getData("weight")||1;var m=f.getData("coord");var p=f.getData("weight")||1;var o=a.clone(f.getEdges());for(var h=0,e=o.length;h<e;++h){var d=o[h];d.replaceVertex(f,c)}n.removeVertex(f);var k=(g===1)?j:b.multiply(j,g);k+=(p===1)?m:b.multiply(m,p);k=b.divide(k,g+p);c.setData("coord",k)},removeRepetitivePoints:function(e){var c=[];var g=null;for(var f=0,d=e.length;f<d;++f){if(e[f]!==g){c.push(e[f]);g=e[f]}}return c},refineTrack:function(d,e,f){var c=this.simplifyCurveToLineSegments(d,e);c=this.addLineCrossPoints(c);c=this.addVertexToLineMergePoint(c,f);c=this.mergeNearbyTrackPoints(c,f);c=this.removeRepetitivePoints(c);return c},convertTrackToStructure:function(l,m,c,n){if(!m||!m.length){return null}var f=m.length;if(f<2){return null}var o=n||new Kekule.StructureFragment();var d="__$structure_node__";var e;for(var j=0;j<f;++j){var k=m[j];var g=k[d];if(!g){g=new Kekule.Atom();g.setIsotopeId(c);l.setObjectScreenCoord(g,k);k[d]=g;o.appendNode(g)}if(e&&e!==g){if(!g.getConnectorTo(e)){var h=new Kekule.Bond(null,[e,g]);h.setBondOrder(1);o.appendConnector(h)}}e=g}return o},convertLinesToGraph:function(h){if(!h||!h.length){return null}else{var k="__$graph_vertex__";var l=new Kekule.Graph();var d=h.length;var g,e;for(var f=0;f<d;++f){var j=h[f];var g=j[k];if(!g){g=new Kekule.GraphVertex();g.setData("coord",j);j[k]=g;l.addVertex(g)}if(e){if(!g.getEdgeTo(e)){var c=new Kekule.GraphEdge();l.addEdge(c,e,g)}}e=g}return l}}});Kekule.Editor.TrackLayoutOptimizer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackLayoutOptimizer",OPTIMIZED_COORD_FIELD:"__$optimizedCoord__",COORD_INDEX_FIELD:"__$coordIndex__",RING_END_INDEX_FIELD:"__$ringEndIndex__",initialize:function($super){$super()},initProperties:function(){},initPropValues:function($super){$super()},splitTrackByRings:function(d){var n=[];var f=function(u,t){for(var s=0,q=n.length;s<q;++s){var r=n[s];if(r.startIndex>t||r.endIndex<u){continue}else{return false}}return true};for(var h=0,e=d.length;h<e;++h){var m=d[h];if(m[this.COORD_INDEX_FIELD]===undefined){m[this.COORD_INDEX_FIELD]=h}else{var o=m[this.COORD_INDEX_FIELD];var k=h;m[this.RING_END_INDEX_FIELD]=k;if(f(o,k)){n.push({startIndex:o,endIndex:k})}}}var p=[];var c=n.length;if(c>0){var g=0;for(var h=0;h<c;++h){var j=n[h];if(j.startIndex>g){p.push({track:d.slice(g,j.startIndex+1),isRing:false})}p.push({track:d.slice(j.startIndex,j.endIndex+1),isRing:true});g=j.endIndex}if(g<d.length-1){p.push({track:d.slice(g,d.length),isRing:false})}return p}else{return[{track:d,isRing:false}]}},optimize:function(f,m){var j=f;var c=Kekule.Editor.PointerTrackConstraint;var d;var k=f[0];var e=k.boundObj;var l=f[f.length-1];var g=l.boundObj;if(e&&g){d=(e===g)?c.CIRCLE:c.BOTH}else{if(e||g){d=c.LEADING;if(g){j=a.reverse(f)}}else{if(k===l){d=c.CIRCLE}else{d=c.LEADING}}}var i=Object.extend({},m);i.preferredStartingAngles=m.preferredStartingAngles||[0];i.segmentsInfo=this._calcTrackSegmentsInfo(j);i.distanceMedian=a.getMedian(i.segmentsInfo.distances);var h=(d===c.CIRCLE)?this.doOptimizeOnCircleConstraint(j,i):(d===c.BOTH)?this.doOptimizeOnBothConstraint(j,i):this.doOptimizeOnLeadingConstraint(j,i);return h},_calcTrackSegmentsInfo:function(d){var m=[],k=[];for(var g=0,f=d.length;g<f-1;++g){var j=d[g];var h=d[g+1];var c=b.getDistance(j,h);var n=b.substract(h,j);var e=Math.atan2(n.y,n.x);m.push(c);k.push(e)}return{distances:m,angles:k}},doOptimizeOnLeadingConstraint:function(y,g,H){var p=Kekule.GeometryUtils;var t=[];if(H){var w=Kekule.Editor.PointerTrackConstraint;var q=this.splitTrackByRings(y);if(q.length===1){return q[F].isRing?this.doOptimizeOnCircleConstraint(c,g,true):this.doOptimizeOnLeadingConstraint(c,g,true)}var f;for(var F=0,A=q.length;F<A;++F){var c=q[F].track;var v=q[F].isRing?this.doOptimizeOnCircleConstraint(c,g,true):this.doOptimizeOnLeadingConstraint(c,g,true);if(!f){f=v[v.length-1];t=t.concat(v)}else{var z=v[0];var I=b.substract(f,z);for(var E=0,B=v.length;E<B;++E){v[E]=b.add(v[E],I)}f=v[v.length-1];v.shift();t=t.concat(v)}}return t}var o=g.preferredStartingAngles;var n;t.push(y[0]);var u=[g.preferredIncludeAngle,-g.preferredIncludeAngle];for(var F=1,A=y.length;F<A;++F){if(y[F][this.OPTIMIZED_COORD_FIELD]){t.push(y[F][this.OPTIMIZED_COORD_FIELD])}else{var e=y[F-1];var m=t[F-1];var d=y[F];var I=b.substract(d,e);var G=b.getDistance(e,d);var s=this._optimizeLineSegmentDistance(G,g);var D=Math.atan2(I.y,I.x);var x;x=this._optimizeDirectionAngle(D,o,g,n);n=x;var J=Math.PI-g.preferredIncludeAngle;var o=[p.standardizeAngle(x-J),p.standardizeAngle(x+J)];var r={x:s*Math.cos(x),y:s*Math.sin(x)};var h=b.add(m,r);t.push(h);y[F][this.OPTIMIZED_COORD_FIELD]=h}}return t},doOptimizeOnBothConstraint:function(s,g,w){var t=s.length;var h=this.doOptimizeOnLeadingConstraint(s,g,w);var f=h[t-1];var c=s[t-1];var r=s[0];var q=b.substract(c,r);var p=Math.atan2(q.y,q.x);var v=b.substract(f,r);var d=Math.atan2(v.y,v.x);var x=b.getDistance(q)/b.getDistance(v);if(x<=2){var l=b.calcTransform2DMatrix({rotateAngle:-d,center:r});var k=b.calcTransform2DMatrix({scale:x,center:r});var j=b.calcTransform2DMatrix({rotateAngle:p,center:r});var m=Kekule.MatrixUtils.multiply(l,k);m=Kekule.MatrixUtils.multiply(m,j);var o=[h[0]];for(var u=1;u<t-1;++u){o.push(b.transform2DByMatrix(h[u],m))}o.push(s[t-1])}else{var e=b.divide(b.substract(c,f),t-1);var o=[h[0]];var n={x:0,y:0};for(var u=0;u<t-1;++u){n=b.add(n,e);o.push(b.add(h[u],n))}o.push(s[t-1])}return o},doOptimizeOnCircleConstraint:function(e,q,g){var c=e.length-1;var k=Object.create(q);if(c<=8){var h=(1-2/c)*Math.PI;var k=Object.create(q);k.preferredIncludeAngle=h}var d=e.length;var l=this.doOptimizeOnLeadingConstraint(e,k,g);var o=l[d-1];var n=e[d-1];var m=b.divide(b.substract(n,o),d-1);var p=[l[0]];var f={x:0,y:0};for(var j=1;j<d-1;++j){f=b.add(f,m);p.push(b.add(l[j],f))}p.push(e[d-1]);return p},_optimizeIncludeAngle:function(d,e,c){return this._optimizeDirectionAngle(d,e,c)},_optimizeDirectionAngle:function(m,f,t,c){var n=Kekule.GeometryUtils;var u=null,s=null;if(f&&f.length){var r=null;for(var j=0,h=f.length;j<h;++j){var e=Math.abs(n.standardizeAngle(m)-f[j]);if(r===null||e<r){s=f[j];r=e}}if(r<=Math.PI/6){u=s}}if(u===null){var o=t.angleConstraint;if(!o){return m}if(s===null){s=0}var e=m-s;var d=Math.round(e/o);u=s+d*o;if(c){var k=5*Math.PI/180;var q=Math.abs(n.standardizeAngle(u-c,-Math.PI));if(Kekule.NumUtils.isFloatEqual(q,0,k)||Kekule.NumUtils.isFloatEqual(q,Math.PI,k)){var g=u+o;var p=u-o;if(Math.abs(m-g)<Math.abs(m-p)){u=g}else{u=p}}}}return u},_optimizeLineSegmentDistance:function(g,o){var l=o.defBondScreenLength;var j=o.distanceConstraints||[];if(!j){return g}var f=j[j.length-1]*l;if(g>f){var c=Math.round(g/l);return c*l}else{var m=o.primaryDistanceConstraint;var e=j.length;var k=j.indexOf(m);if(k<0){k=0}var n;for(var h=e-1;h>=k;--h){var d=j[h];n=d*l;if(g>n){return n}}for(var h=0;h<=k;++h){n=d*l;if(g<n){return n}}return n}}});Kekule.Editor.TrackInputIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.TrackInputIaController",initialize:function($super,c){$super(c);this.setEnableSelect(false);this._isTracking=false;this._trackCoordToObjBindings=null;this._trackParser=new Kekule.Editor.TrackParser();this._trackLayoutOptimizer=new Kekule.Editor.TrackLayoutOptimizer();this._addStructureOperation=null;this._editorScaled=false;this._editorOriginalZoomLevel=1;this._lastRenderedMarkerCoord=null;this._debugMarkers={}},doFinalize:function($super){this._trackLayoutOptimizer.finalize();this._trackParser.finalize();var c=this.getPropStoreFieldValue("trackMarker");if(c){c.finalize()}$super()},initProperties:function(){this.defineProp("trackMarker",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var c=this.getPropStoreFieldValue("trackMarker");if(!c){c=new Kekule.ChemWidget.MetaShapeUIMarker({shapeType:Kekule.Render.MetaShapeType.POLYLINE,coords:[]});this.setPropStoreFieldValue("trackMarker",c)}return c}})},initPropValues:function($super){$super()},getEditorUiMarkers:function(){return this.getEditor().getUiMarkers()},refineTrackCoords:function(r){var m=this.getEditor();var o=this.getEditorConfigs();var k={angleConstraint:o.getInteractionConfigs().getTrackOptimizationAngleConstraint(),distanceConstraints:o.getInteractionConfigs().getTrackOptimizationDistanceConstraints(),primaryDistanceConstraint:o.getInteractionConfigs().getTrackOptimizationPrimaryDistanceConstraint(),preferredIncludeAngle:Math.PI*2/3};var u=m.getDefBondLength?m.getDefBondLength():o.getStructureConfigs().getDefBondLength();var q=m.objCoordToScreen({x:0,y:0});var p=m.objCoordToScreen({x:u,y:0});var s=b.getDistance(q,p);k.defBondScreenLength=s;var e=this.getEditorConfigs().getInteractionConfigs().getTrackSimplifierDistanceThreshold();var j=this.getEditorConfigs().getInteractionConfigs().getTrackMergeDistanceThreshold();var h=this._mergeCoordsToBoundNodesAndSplitTrack(r);var t=[];for(var g=0,f=h.length;g<f;++g){var c=h[g];c=this._trackParser.refineTrack(c,e,j);var d=c[0].obj||c[c.length-1].obj;var n=d?o.getStructureConfigs.getNewBondDefAngle(d,1):-Math.PI/6;k.preferredStartingAngles=[n];c=this._trackLayoutOptimizer.optimize(c,k);t.push(c)}return t},_mergeCoordsToBoundNodesAndSplitTrack:function(p){var c=this._trackCoordToObjBindings;var d=c.length;if(d){var o=this.getEditor();var g=[];var e=c[0].obj;var r=c[0].coordIndex;var q=0;for(var m=1;m<=d;++m){var k=c[m];if((m<d&&k&&(e!==k.obj||(k.coordIndex-r>10))||m===d)){if(r>q){g.push(p.slice(q,r))}var f=o.getObjectScreenCoord(e);f.boundObj=e;var n=c[m-1].coordIndex;q=n+1;g.push([f]);if(m!==d){e=k.obj;r=k.coordIndex}}}if(p.length-1>c[d-1].coordIndex){g.push(p.slice(c[d-1].coordIndex))}var t=[];var s=[];for(var m=0,h=g.length;m<h;++m){var j=g[m];t=t.concat(j);if(m===h-1){s.push(t)}else{if(j[0].boundObj&&m>0){s.push(t);t=j}}}return s}else{return[p]}},convertTracksToStructure:function(e,h){var c=new Kekule.Molecule();c.setCoord2D({x:0,y:0});var g=this.getEditor();for(var f=0,d=e.length;f<d;++f){this._trackParser.convertTrackToStructure(g,e[f],h,c)}if(c.getNodeCount()<2){return null}else{return c}},getStructureSelectableChildren:function(c){return[].concat(c.getNodes()).concat(c.getConnectors())},addStructureToEditor:function(c){var d=this.getEditor();this._addStructureOperation=null;d.beginUpdateObject();try{var f;var e=d.getChemSpace();if(this._targetMol){f=new Kekule.ChemStructOperation.MergeStructFragment(c,this._targetMol,d);this._targetMol=null}else{f=new Kekule.ChemObjOperation.Add(c,e,null,d)}f.execute();this._addStructureOperation=f}finally{d.endUpdateObject()}},getTrackCoords:function(){return this.getTrackMarker().getShapeInfo().coords},clearTrackCoords:function(){var c=this.getTrackMarker();c.getShapeInfo().coords=[]},startTracking:function(c,h){this._targetMol=null;var m=this.getEditor();var g=this._getMergeDestObjAtCoord(h);if(!m.canCreateNewChild()&&!g){if(!m.canAddUnconnectedStructFragment()){return null}else{var n=m.getOnlyOneBlankStructFragment();this._targetMol=n}}this._isTracking=true;this._trackCoordToObjBindings=[];this.setManuallyHotTrack(true);this.clearTrackCoords();var i=this.getTrackMarker();this.getEditorUiMarkers().addMarker(i);var d=this.getEditorConfigs().getUiMarkerConfigs();var l={strokeColor:d.getTrackMarkerStrokeColor(),strokeWidth:d.getTrackMarkerStrokeWidth(),strokeDash:d.getTrackMarkerStrokeDash(),opacity:d.getTrackMarkerOpacity()};i.setDrawStyles(l);i.setVisible(true);this.addTrackCoord(h,false);if(this.getEditorConfigs().getInteractionConfigs().getAutoAdjustZoomLevelOnTrackTouching()){var m=this.getEditor();var f=this.getEditorConfigs().getInteractionConfigs().getTrackTouchRefLength();if(f){var p=m.getDocument();var r=m.getDefBondScreenLength();var e=Kekule.DocumentUtils.getDevicePPI(p)*f/Kekule.DocumentUtils.getClientScaleLevel(p);var k=e/r;if(k>0.9){var q=m.getCurrZoom();m.setZoomCenter(h);m.zoomTo(q*k);var j=this._getEventMouseCoord(c);var o=this.getTrackCoords();var s=o[o.length-1];h=j;Object.extend(s,j);this._editorScaled=true;this._editorOriginalZoomLevel=q;this._autoScaleStartCoord=j}else{this._editorScaled=false;this._editorOriginalZoomLevel=null}}}this.repaintMarker();this._lastRenderedMarkerCoord=h},endTracking:function(g){var f=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId()||"C";this._isTracking=false;this.addTrackCoord(g);var c=this.refineTrackCoords(this.getTrackCoords());if(c.length){var e=this.convertTracksToStructure(c,f);if(e){this.addStructureToEditor(e);this.startDirectManipulate(null,e,g);this.moveManipulatedObjs(g);this.stopManipulate();var d=this.getStructureSelectableChildren(e);this.doneInsertOrModifyBasicObjects(d)}}this.doneTracking()},cancelTracking:function(){this._isTracking=false;this.getEditorUiMarkers().removeMarker(this.getTrackMarker());this.doneTracking()},doneTracking:function(){if(this._editorScaled){var d=this.getTrackCoords();var c=d[d.length-1];this._editorScaled=false;this.getEditor().zoomTo(this._editorOriginalZoomLevel,null,this._autoScaleStartCoord);this._editorOriginalZoomLevel=null;this._autoScaleStartCoord=null}this.setManuallyHotTrack(false);this.getEditor().hideHotTrack();this.clearTrackCoords();this.repaintMarker()},_getMergeDestObjAtCoord:function(c){var d=this.getEditor().getTopmostBasicObjectAtCoord(c,this.getCurrBoundInflation());if(this.isValidMergeDestObj(d)){return d}else{return null}},addTrackCoord:function(c,g){var e=this.getTrackCoords();var d=e&&e[e.length-1];if(d&&Kekule.CoordUtils.isEqual(c,d)){return}var f=this._getMergeDestObjAtCoord(c);if(f){this._trackCoordToObjBindings.push({coord:c,obj:f,coordIndex:this.getTrackCoords().length});this.getEditor().addHotTrackedObj(f)}e.push(c);if(!g){var h;if(this._lastRenderedMarkerCoord){h=Kekule.CoordUtils.getDistance(this._lastRenderedMarkerCoord,c);if(h>5){this.repaintMarker();this._lastRenderedMarkerCoord=c}}else{this.repaintMarker();this._lastRenderedMarkerCoord=c}}},repaintMarker:function(){this.getEditor().repaintUiMarker()},isValidMergeDestObj:function(c){return c instanceof Kekule.ChemStructureNode},canInteractWithObj:function(c){return c instanceof Kekule.ChemStructureNode},getAllObjOperations:function($super,d){var c=$super(d)||[];var e=this._addStructureOperation;if(e){c.unshift(e)}return c},react_pointerdown:function($super,c){this.getEditor().setCurrPointerType(c.pointerType);if(c.getButton()===Kekule.X.Event.MouseButton.LEFT){var d=this._getEventMouseCoord(c);this.startTracking(c,d);c.preventDefault()}else{if(c.getButton()===Kekule.X.Event.MouseButton.RIGHT){this.cancelTracking();c.preventDefault()}}},react_pointerup:function($super,c){if(c.getButton()===Kekule.X.Event.MouseButton.LEFT){if(this._isTracking){var d=this._getEventMouseCoord(c);this.endTracking(d);this.addOperationToEditor()}this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL);c.preventDefault()}},react_pointermove:function($super,c){$super(c);if(this._isTracking){var d=this._getEventMouseCoord(c);this.addTrackCoord(d);c.preventDefault()}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.TrackInputIaController,Kekule.Editor.ChemSpaceEditor)})();(function(){var a=Kekule.ArrayUtils;var e=Kekule.Editor;var c=Kekule.Widget.HtmlClassNames;var f=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ChemWidget.ComponentWidgetNames;Kekule.Editor.ObjModifier={};Kekule.Editor.ObjModifier.Category={GENERAL:"general",CHEM_STRUCTURE:"chemStruct",GLYPH:"glyph",STYLE:"style",MISC:"misc"};Kekule.Editor.ObjModifier.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.ObjModifier.Base",initialize:function($super,g){$super();this.setEditor(g);this.modifierWidgetValueChangedBind=this.modifierWidgetValueChanged.bind(this)},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false});this.defineProp("targetObjs",{dataType:DataType.ARRAY,serializable:false,getter:function(){return this.getEditor().getSelection()}});this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null,getter:function(){var g=this.getPropStoreFieldValue("widget");if(!g){g=this.createWidget();this.setPropStoreFieldValue("widget",g)}return g}})},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getModifierName:function(){return this.getClassLocalName().toLowerCase()},createWidget:function(){var g=this.doCreateWidget();if(g){this.installValueChangeEventHandler(g)}return g},doCreateWidget:function(){return null},installValueChangeEventHandler:function(g){g.on("valueChange",this.modifierWidgetValueChangedBind)},modifierWidgetValueChanged:function(){this.applyToTargets()},loadFromTargets:function(){var h=this.getEditor();if(h){var g=this.getTargetObjs();if(g){this.doLoadFromTargets(h,g)}}return this},doLoadFromTargets:function(h,g){},applyToTargets:function(){var h=this.getEditor();if(h){var g=this.getTargetObjs();if(g){this.doApplyToTargets(h,g)}}return this},doApplyToTargets:function(h,g){var i=this.createModificationOper();if(i){h.execOperation(i)}},createModificationOper:function(j){var k=[];if(target&&j.length){for(var m=0,h=j.length;m<h;++m){var n=this.createModificationOperOnTarget(j[m]);if(n){k.push(n)}}}var g=k.length;if(g<=0){return null}else{if(g===1){return k[0]}else{return new Kekule.MacroOperation(k)}}},createModificationOperOnTarget:function(h){var g=this.getModifiedPropValues();if(g){return this.createModificationOperation(h,g)}else{return null}},getModifiedPropValues:function(){return null},createModificationOperation:function(g,h){return new Kekule.ChemObjOperation.Modify(g,h,this.getEditor())}});Kekule.Editor.ObjModifierManager={_modifierMap:new Kekule.MapEx(true),register:function(o,n){if(!n||!o){return}var m=a.toArray(n);var k=a.toArray(o);for(var j=0,g=k.length;j<g;++j){var h=k[j];var p=b._modifierMap.get(h);if(!p){p=m;b._modifierMap.set(h,p)}else{a.pushUnique(p,m)}}},unregister:function(m){if(!m){return}var j=a.toArray(m);var k=b._modifierMap.getKeys();for(var h=0,g=k.length;h<g;++h){var n=b._modifierMap.get(k[h]);if(n&&n.length){b._modifierMap.set(k[h],a.exclude(n,j))}}},getModifierCategories:function(h){var g=(h.getCategories&&h.getCategories())||[];var i=ClassEx.getSuperClass(h);if(i){a.pushUnique(g,b.getModifierCategories(i))}return g},getModifierClasses:function(j,p){var g=b._modifierMap.get(j)||[];var n=ClassEx.getSuperClass(j);if(n){a.pushUnique(g,b.getModifierClasses(n,p))}if(p&&p.length){var o=g;g=[];for(var m=0,h=o.length;m<h;++m){var k=b.getModifierCategories(o[m]);if(a.intersect(k,p).length){g.push(o[m])}}}return g}};var b=Kekule.Editor.ObjModifierManager})();(function(){var a=Kekule.ArrayUtils;var e=Kekule.Editor;var c=Kekule.Widget.HtmlClassNames;var f=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ChemWidget.ComponentWidgetNames;Kekule.Editor.ObjModifier.BaseRenderOptionModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.BaseRenderOptionModifier",getRenderOptionValue:function(g,i,h){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(g,i,h)}});Kekule.Editor.ObjModifier.BaseRenderOptionModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.STYLE]};Kekule.Editor.ObjModifier.Color=Class.create(Kekule.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Color",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:Kekule.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:c.COLORPICKER_SPEC_COLOR_MIXED},initProperties:function(){this.defineProp("colorBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},doCreateWidget:function(){var g=new Kekule.Widget.ColorDropButton(this.getEditor());g.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR"));g.setShowText(false);g.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]);g.addClassName(f.COMPOSER_COLOR_BOX);this.setPropStoreFieldValue("colorBox",g);return g},doLoadFromTargets:function(j,h){if(h&&h.length){var g=this.getColorBox();if(g){var i;var k=this.getRenderOptionValue(h,"useAtomSpecifiedColor");var i=this.getRenderOptionValue(h,"color");if(k){i=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value;g.setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className);g.setValue(i)}else{g.setColorClassName(null);g.setValue(i)}}}},doApplyToTargets:function($super,i,g){var h=this.getWidget().getValue();if(h===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value){i.modifyObjectsRenderOptions(g,{useAtomSpecifiedColor:true,color:undefined},false,true)}else{if(h==Kekule.Widget.ColorPicker.SpecialColors.UNSET){h=undefined}i.modifyObjectsRenderOptions(g,{useAtomSpecifiedColor:false,color:h},false,true)}}});var b=Kekule.Editor.ObjModifierManager;b.register(Kekule.ChemObject,[Kekule.Editor.ObjModifier.Color])})();(function(){var d=Kekule.DomUtils;var e=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;var f=Kekule.ChemWidget.HtmlClassNames;var c=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_TEXTFORMAT_BUTTON:"K-Chem-Composer-TextFormat-Button",COMPOSER_MODIFIER_RICHTEXT_PANEL:"K-Chem-Composer-Modifier-RichText-Panel",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP:"K-Chem-Composer-Modifier-RichText-Panel-Group",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-LabelCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-CtrlCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABEL:"K-Chem-Composer-Modifier-RichText-Panel-Group-Label",COMPOSER_TEXTDIRECTION_BOX:"K-Chem-Composer-TextDirection-Box",COMPOSER_TEXTALIGN_BOX:"K-Chem-Composer-TextAlign-Box"});Kekule.globalOptions.add("chemWidget.composer.objModifier.richText",{componentNames:[c.fontName,c.fontSize,c.textDirection,c.textAlign]});Kekule.Editor.ObjModifier.RichText=Class.create(Kekule.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.RichText",initialize:function($super,g){$super(g);this._valueStorage={}},initProperties:function(){this.defineProp("fontPanel",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("fontNameBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("textDirectionBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("textHorizontalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("textVerticalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},_createCtrlGroup:function(m,h,k,l){var g=m.createElement("tr");g.className=f.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP;var i=m.createElement("td");i.className=f.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL;var j=m.createElement("label");j.className=f.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUPLABEL;d.setElementText(j,k);i.appendChild(j);g.appendChild(i);var i=m.createElement("td");i.className=f.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL;l.appendToElem(i);g.appendChild(i);h.appendChild(g);return g},_doCreateDropDownPanel:function(){var h=new Kekule.Widget.Panel(this.getEditor());h.addClassName(f.COMPOSER_MODIFIER_RICHTEXT_PANEL).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT"));var o=Kekule.globalOptions.chemWidget.composer.objModifier.richText.componentNames;var n,l;var k=this.getEditor().getDocument();var i=k.createElement("table");h.getContainerElement().appendChild(i);if(o.indexOf(c.fontName)>=0){var n=new Kekule.Widget.ComboBox(h);this.fillFontNameBox(n);n.addClassName(f.COMPOSER_FONTNAME_BOX);n.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME"));n.addEventListener("valueChange",function(q){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontFamily:this.getFontNameBox().getValue()},false,true)},this);this.setPropStoreFieldValue("fontNameBox",n);this._createCtrlGroup(k,i,Kekule.$L("ChemWidgetTexts.CAPTION_FONTNAME"),n)}if(o.indexOf(c.fontSize)>=0){n=new Kekule.Widget.ComboBox(h);this.fillFontSizeBox(n);n.addClassName(f.COMPOSER_FONTSIZE_BOX);n.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE"));n.addEventListener("valueChange",function(q){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontSize:this.getFontSizeBox().getValue()},false,true)},this);this.setPropStoreFieldValue("fontSizeBox",n);this._createCtrlGroup(k,i,Kekule.$L("ChemWidgetTexts.CAPTION_FONTSIZE"),n)}if(o.indexOf(c.textDirection)>=0){l=new Kekule.Widget.SelectBox(h);var m=Kekule.Render.TextDirection;var j=[{value:m.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT")},{value:m.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR")},{value:m.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL")},{value:m.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB")},{value:m.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT")}];l.setItems(j);n.addClassName(f.COMPOSER_TEXTDIRECTION_BOX);l.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION"));l.addEventListener("valueChange",function(q){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{charDirection:this.getTextDirectionBox().getValue()},false,true)},this);this.setPropStoreFieldValue("textDirectionBox",l);this._createCtrlGroup(k,i,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),l)}if(o.indexOf(c.textAlign)>=0){l=new Kekule.Widget.SelectBox(h);var p=Kekule.Render.TextAlign;var j=[{value:p.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:p.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:p.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:p.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:p.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT")},{value:p.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT")}];l.setItems(j);n.addClassName(f.COMPOSER_TEXTALIGN_BOX);l.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN"));l.addEventListener("valueChange",function(q){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{horizontalAlign:this.getTextHorizontalAlignBox().getValue()},false,true)},this);this.setPropStoreFieldValue("textHorizontalAlignBox",l);this._createCtrlGroup(k,i,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),l);l=new Kekule.Widget.SelectBox(h);var p=Kekule.Render.TextAlign;var j=[{value:p.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:p.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:p.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:p.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:p.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP")},{value:p.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM")}];l.setItems(j);n.addClassName(f.COMPOSER_TEXTALIGN_BOX);l.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN"));l.addEventListener("valueChange",function(q){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{verticalAlign:this.getTextVerticalAlignBox().getValue()},false,true)},this);this.setPropStoreFieldValue("textVerticalAlignBox",l);this._createCtrlGroup(k,i,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),l)}this.setPropStoreFieldValue("fontPanel",h);var g=this._valueStorage;if(g){this.getFontNameBox().setValue(g.fontName);this.getFontSizeBox().setValue(g.fontSize);this.getTextDirectionBox().setValue(g.textDirection);this.getTextHorizontalAlignBox().setValue(g.textHAlign);this.getTextVerticalAlignBox().setValue(g.textVAlign)}return h},doCreateWidget:function(){var g=new Kekule.Widget.DropDownButton(this.getEditor());g.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_FORMAT"));g.setText(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT"));g.setShowText(false);g.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);g.addClassName(f.COMPOSER_TEXTFORMAT_BUTTON);g.setDropDownWidgetGetter(this._doCreateDropDownPanel.bind(this));return g},doLoadFromTargets:function(i,g){if(g&&g.length){var h=this._valueStorage;h.fontName=this.getRenderOptionValue(g,"fontFamily")||"";h.fontSize=this.getRenderOptionValue(g,"fontSize")||undefined;h.textDirection=this.getRenderOptionValue(g,"charDirection")||Kekule.Render.TextDirection.DEFAULT;h.textHAlign=this.getRenderOptionValue(g,"horizontalAlign")||Kekule.Render.TextAlign.DEFAULT;h.textVAlign=this.getRenderOptionValue(g,"verticalAlign")||Kekule.Render.TextAlign.DEFAULT;if(this.getFontPanel()){this.getFontNameBox().setValue(h.fontName);this.getFontSizeBox().setValue(h.fontSize);this.getTextDirectionBox().setValue(h.textDirection);this.getTextHorizontalAlignBox().setValue(h.textHAlign);this.getTextVerticalAlignBox().setValue(h.textVAlign)}}},doApplyToTargets:function($super,h,g){},fillFontSizeBox:function(m){var k=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes();var h=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:undefined}];for(var j=0,g=k.length;j<g;++j){h.push({text:k[j]+" px",value:k[j]})}m.setItems(h)},fillFontNameBox:function(m){var k=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames();var h=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}];for(var j=0,g=k.length;j<g;++j){h.push({text:k[j],value:k[j]})}m.setItems(h)}});var a=Kekule.Editor.ObjModifierManager;a.register(Kekule.ChemObject,[Kekule.Editor.ObjModifier.RichText])})();(function(){var a=Kekule.ArrayUtils;var e=Kekule.DomUtils;var f=Kekule.HtmlElementUtils;var c=Kekule.Widget.HtmlClassNames;var g=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_ATOM_MODIFIER_BUTTON:"K-Chem-Composer-AtomModifier-Button",COMPOSER_ATOM_MODIFIER_DROPDOWN:"K-Chem-Composer-AtomModifier-DropDown",COMPOSER_BOND_MODIFIER_BUTTON:"K-Chem-Composer-BondModifier-Button",COMPOSER_BOND_MODIFIER_DROPDOWN:"K-Chem-Composer-BondModifier-DropDown",COMPOSER_CHARGE_MODIFIER_BUTTON:"K-Chem-Composer-ChargeModifier-Button",COMPOSER_CHARGE_MODIFIER_DROPDOWN:"K-Chem-Composer-ChargeModifier-DropDown"});Kekule.Editor.ObjModifier.ChemStructureModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.ChemStructureModifier",installValueChangeEventHandler:function(h){}});Kekule.Editor.ObjModifier.ChemStructureModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.CHEM_STRUCTURE]};Kekule.Editor.ObjModifier.Atom=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Atom",initialize:function($super,h){$super(h);this._valueStorage={}},initProperties:function(){this.defineProp("atomSetter",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},doCreateWidget:function(){var h=new Kekule.Widget.DropDownButton(this.getEditor());h.setHint(Kekule.$L("ChemWidgetTexts.HINT_ATOM_MODIFIER"));h.setText(Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER"));h.setShowText(true);h.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);h.addClassName(g.COMPOSER_ATOM_MODIFIER_BUTTON);h.setDropDownWidgetGetter(this._createAtomSetter.bind(this));return h},_createAtomSetter:function(j){if(!j){j=this.getEditor()}var m=this.getEditor();var i=new Kekule.ChemWidget.StructureNodeSetter(j);i.addClassName([c.PANEL,g.COMPOSER_ATOM_MODIFIER_DROPDOWN,c.CORNER_ALL]);i.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs());var o=j.getDocument().createElement("div");o.className=c.PANEL_CAPTION;e.setElementText(o,Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER"));var h=i.getElement();h.insertBefore(o,Kekule.DomUtils.getFirstChildElem(h));var n=a.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());n.push("...");var l=m&&m.getEnabledNonAtomInputData&&m.getEnabledNonAtomInputData();i.setSelectableInfos({elementSymbols:n,nonElementInfos:l,subGroupRepItems:Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()});var k=this;i.addEventListener("valueChange",function(p){k.applyToTargets();i.dismiss()});this.setPropStoreFieldValue("atomSetter",i);if(this._valueStorage.nodes){i.setNodes(this._valueStorage.nodes)}return i},_filterStructureNodes:function(j){var k=[];for(var m=0,h=j.length;m<h;++m){var n=j[m];if(n instanceof Kekule.ChemStructureNode){k.push(n)}}return k},_getActualModificationNodes:function(m,k){var h=[];for(var o=0,j=m.length;o<j;++o){var p=m[o];if(p instanceof Kekule.StructureFragment&&p.isExpanded()){var n=this._getActualModificationNodes(p.getNodes(),true);a.pushUnique(h,n)}else{h.push(p)}}if(!k){h=this._filterStructureNodes(h)}return h},doLoadFromTargets:function(j,h){var k;var i=this._getActualModificationNodes(h);this._valueStorage.nodes=i;if(this.getAtomSetter()){this.getAtomSetter().setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs());this.getAtomSetter().setNodes(i)}k=Kekule.Editor.StructureUtils.getAllChemStructureNodesHtmlCode(i,null,null,this.getEditor().getRenderConfigs().getDisplayLabelConfigs());this.getWidget().setText(k||Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER_MIXED")).setShowText(true).setDisplayed(!!i.length)},doApplyToTargets:function($super,q,r){var m=this.getAtomSetter().getValue();var n=[];var h=this._getActualModificationNodes(r);for(var o=0,j=h.length;o<j;++o){var s=h[o];if(s instanceof Kekule.ChemStructureNode){var p=this._createNewDataToAtomOperation(m,s);if(p){n.push(p)}}}var k;if(n.length>1){k=new Kekule.MacroOperation(n)}else{k=n[0]}if(k){var q=this.getEditor();q.execOperation(k)}},_createNewDataToAtomOperation:function(p,k){if(!p){return}var h=p.nodeClass;var l=p.props;var j=p.repositoryItem;var m;if(j){var i=j.createObjects(k)||{};var o=i.objects;var n=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),j,i,k,null);this.getEditor().transformCoordAndSizeOfObjects(o,n);m=o[0];h=m.getClass()}if(p.isUnknownPseudoatom&&!this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()){h=null}if(!h){Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL"));return null}else{return this._createModificationOperation(k,m,h,l)}},_createModificationOperation:function(i,o,q,n){var o;var j,k;var h=i.getClass();if(o&&!q){q=o.getClass()}if(o||q!==h){j=new Kekule.MacroOperation();if(!o){o=new q()}var l=new Kekule.ChemStructureNode();l.assign(i);o.assign(l);var p=new Kekule.ChemStructOperation.ReplaceNode(i,o,null,this.getEditor());j.add(p)}else{o=i}if(n){k=new Kekule.ChemObjOperation.Modify(o,n,this.getEditor());if(j){j.add(k)}}var m=j||k;return m}});Kekule.Editor.ObjModifier.Bond=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Bond",initialize:function($super,h){$super(h);this._activeSelBtnHtmlClass=null;this._defaultBondTypeData=null;this._valueStorage={};var i=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=i[0]},initProperties:function(){this.defineProp("bondSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},doCreateWidget:function(){var h=new Kekule.Widget.DropDownButton(this.getEditor());h.setHint(Kekule.$L("ChemWidgetTexts.HINT_BOND_MODIFIER"));h.setText(Kekule.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER"));h.setShowText(false);h.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);h.addClassName(g.COMPOSER_BOND_MODIFIER_BUTTON);h.setDropDownWidgetGetter(this._createBondSelector.bind(this));if(this._defaultBondTypeData.htmlClass){h.addClassName(this._defaultBondTypeData.htmlClass)}return h},_filterBond:function(k){var h=[];for(var m=0,j=k.length;m<j;++m){var n=k[m];if(n instanceof Kekule.Bond){h.push(n)}}return h},_getActualModificationBonds:function(k,m){var h=[];for(var o=0,j=k.length;o<j;++o){var p=k[o];if(p instanceof Kekule.StructureFragment&&p.isExpanded()){var n=this._getActualModificationBonds(p.getNodes(),true);a.pushUnique(h,n);a.pushUnique(h,p.getConnectors())}else{if(p instanceof Kekule.Bond){h.push(p)}}}if(!m){h=this._filterBond(h)}return h},_createBondSelector:function(i){if(!i){i=this.getEditor()}var h=new Kekule.ChemWidget.StructureConnectorSelectPanel(i);h.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER"));h.addClassName(g.COMPOSER_BOND_MODIFIER_DROPDOWN);if(this.getEditor().getEnabledBondFormData){var k=this.getEditor().getEnabledBondFormData();h.setBondPropNames(this._getBondComparePropNames(k));h.setBondData(k)}if(this._valueStorage.bondsPropValues){h.setActiveBondPropValues(this._valueStorage.bondsPropValues)}this.setPropStoreFieldValue("bondSelector",h);var j=this;h.addEventListener("valueChange",function(l){j.applyToTargets();h.dismiss()});return h},_setActiveBondHtmlClass:function(i){var h=this._activeSelBtnHtmlClass;if(h){this.getWidget().removeClassName(h)}this._activeSelBtnHtmlClass=i;if(!i){i=this._defaultBondTypeData.htmlClass}if(i){this.getWidget().addClassName(i)}},_extractBondPropValues:function(h,i){return h.getPropValues(i)},_extractBondsPropValues:function(n,o){var h;var m;for(var k=0,j=n.length;k<j;++k){m=this._extractBondPropValues(n[k],o);if(!h){h=m}else{if(!Kekule.Editor.StructureUtils.isBondPropsMatch(h,m,o)){h=null;break}}}return h},_getBondComparePropNames:function(m){var j=[];for(var n=0,k=m.length;n<k;++n){var o=m[n];var h=o.bondProps;if(h){a.pushUnique(j,Kekule.ObjUtils.getOwnedFieldNames(h))}}return j},_getMatchedBondData:function(o,k,j){if(!o){return null}for(var m=0,h=k.length;m<h;++m){var n=k[m];if(n&&Kekule.Editor.StructureUtils.isBondPropsMatch(o,n.bondProps,j)){return n}}return null},doLoadFromTargets:function(k,i){var n=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=n[0];var h=this._getActualModificationBonds(i);this._valueStorage.connectors=h;if(this.getBondSelector()){this.getBondSelector().setBondData(n);var m=this.getBondSelector().getBondPropNames();var l=this._extractBondsPropValues(h,m);this.getBondSelector().setActiveBondPropValues(l);this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())}else{this._valueStorage.bondPropNames=this._getBondComparePropNames(n);this._valueStorage.bondsPropValues=this._extractBondsPropValues(h,this._valueStorage.bondPropNames);var j=this._getMatchedBondData(this._valueStorage.bondsPropValues,n,this._valueStorage.bondPropNames);this._setActiveBondHtmlClass(j&&j.htmlClass)}this.getWidget().setDisplayed(!!h.length)},doApplyToTargets:function($super,p,q){var k=this.getBondSelector().getActiveBondPropValues();var m=[];var r=this._getActualModificationBonds(q);for(var n=0,h=r.length;n<h;++n){var s=r[n];var o=this._createBondModificationOperation(k,s);if(o){m.push(o)}}var j;if(m.length>1){j=new Kekule.MacroOperation(m)}else{j=m[0]}if(j){var p=this.getEditor();p.execOperation(j)}this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())},_createBondModificationOperation:function(h,i){var j=new Kekule.ChemObjOperation.Modify(i,h,this.getEditor());return j}});Kekule.Editor.ObjModifier.Charge=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Charge",initialize:function($super,h){$super(h);this._valueStorage={}},initProperties:function(){this.defineProp("chargeSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},doCreateWidget:function(){var h=new Kekule.Widget.DropDownButton(this.getEditor());h.setHint(Kekule.$L("ChemWidgetTexts.HINT_CHARGE_MODIFIER")).setText(Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN")).setShowText(true).setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);h.addClassName(g.COMPOSER_CHARGE_MODIFIER_BUTTON);h.setDropDownWidgetGetter(this._createChargeSelector.bind(this));return h},_createChargeSelector:function(i){if(!i){i=this.getEditor()}var h=new Kekule.ChemWidget.ChargeSelectPanel(i);h.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_CHARGE_MODIFIER"));h.addClassName(g.COMPOSER_CHARGE_MODIFIER_DROPDOWN);if(Kekule.ObjUtils.notUnset(this._valueStorage.charge)){h.setValue(this._valueStorage.charge)}this.setPropStoreFieldValue("chargeSelector",h);var j=this;h.addEventListener("valueChange",function(k){j.applyToTargets();h.dismiss()});return h},_filterStructureNodes:function(j){var k=[];for(var m=0,h=j.length;m<h;++m){var n=j[m];if(n instanceof Kekule.ChemStructureNode&&n.getCharge){k.push(n)}}return k},_getActualModificationNodes:function(m,k){var h=[];for(var o=0,j=m.length;o<j;++o){var p=m[o];if(p instanceof Kekule.StructureFragment&&p.isExpanded()){var n=this._getActualModificationNodes(p.getNodes(),true);a.pushUnique(h,n)}else{h.push(p)}}if(!k){h=this._filterStructureNodes(h)}return h},_getChargeOfNodes:function(k){var h=null;for(var m=0,j=k.length;m<j;++m){var p=k[m];if(p.getCharge){var o=p.getCharge()||0;if(h===null){h=o}else{if(h!==o){return null}}}}return h},doLoadFromTargets:function(k,l){var i;var h=this._getActualModificationNodes(l);var o=(h.length>=0)&&(h.length<=1);if(o){var m=this._getChargeOfNodes(h);this._valueStorage.charge=m;if(this.getChargeSelector()){this.getChargeSelector().setValue(m)}var p;if(m){var j=(m>0)?Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE"):Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE");var n=Kekule.NumUtils.toDecimals(m,1);p=Math.abs(n)+j}else{p=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN")}this.getWidget().setText(p).setShowText(true)}this.getWidget().setDisplayed(o)},doApplyToTargets:function($super,p,q){var s=this.getChargeSelector().getValue();var m=[];var h=this._getActualModificationNodes(q);var p=this.getEditor();for(var n=0,j=h.length;n<j;++n){var r=h[n];if(r instanceof Kekule.ChemStructureNode){var o=new Kekule.ChemObjOperation.Modify(r,{charge:s},p);if(o){m.push(o)}}}var k;if(m.length>1){k=new Kekule.MacroOperation(m)}else{k=m[0]}if(k){var p=this.getEditor();p.execOperation(k)}}});var b=Kekule.Editor.ObjModifierManager;b.register(Kekule.ChemStructureNode,[Kekule.Editor.ObjModifier.Atom]);b.register(Kekule.ChemStructureNode,[Kekule.Editor.ObjModifier.Charge]);b.register([Kekule.Bond,Kekule.StructureFragment],[Kekule.Editor.ObjModifier.Bond])})();(function(){var a=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.ChemIdEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemIdEditor",getAttributes:function($super){var b=$super();if(b&a.MULTIOBJS){b=b^a.MULTIOBJS}return b}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemIdEditor,null,Kekule.ChemObject,"id");Kekule.PropertyEditor.ChemCoordSizeFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordSizeFieldEditor",initProperties:function(){this.defineProp("parentObjects",{dataType:DataType.Object,serializable:false});this.defineProp("parentPropName",{dataType:DataType.STRING,serializable:false})},getCoordFieldValue:function(j,g,h){if(!j.length){return undefined}var e=j[0].getPropValue(g);if(!e){return undefined}var b=e[h];for(var f=1,c=j.length;f<c;++f){var d=j[f].getPropValue(g)[h];if(d!==b){return undefined}}return b},getValue:function($super){var b=this.getParentObjects();var c=this.getParentPropName();if(b&&c){return this.getCoordFieldValue(b,c,this.getPropertyName())}else{return $super()}}});Kekule.PropertyEditor.ChemCoordEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordEditor",is3DCoord:function(){var b=this.getPropertyName();return(b.indexOf("3")>=0)},getFieldEditorClass:function(b,c){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function($super,d,c){var b=$super(d,c);if(b.setParentObjects){b.setParentObjects(this.getObjects())}if(b.setParentPropName){b.setParentPropName(this.getPropertyName())}return b},getFieldValueType:function(b,c){return DataType.FLOAT},getObjFields:function(b){return this.is3DCoord()?["x","y","z"]:["x","y"]},getValueText:function($super){var f=Kekule.Widget.ValueListEditor.ValueDisplayMode;var d=this.getValueTextMode();if(d===f.JSON){return $super()}var g=this.getValue();if(g){var e=this.getObjFields();var j="";for(var c=0,b=e.length;c<b;++c){var h=g[e[c]];if(Kekule.ObjUtils.notUnset(h)){if(!!j){j+=", "}j+=e[c]+": "+h}}return"{"+j+"}"}else{return""}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord3D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord3D");Kekule.PropertyEditor.ChemSizeEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemSizeEditor",is3DSize:function(){var b=this.getPropertyName();return(b.indexOf("3")>=0)},getFieldEditorClass:function(b,c){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function($super,d,c){var b=$super(d,c);if(b.setParentObjects){b.setParentObjects(this.getObjects())}if(b.setParentPropName){b.setParentPropName(this.getPropertyName())}return b},getFieldValueType:function(b,c){return DataType.FLOAT},getObjFields:function(b){return this.is3DSize()?["x","y","z"]:["x","y"]},getValueText:function($super){var f=Kekule.Widget.ValueListEditor.ValueDisplayMode;var d=this.getValueTextMode();if(d===f.JSON){return $super()}var g=this.getValue();if(g){var e=this.getObjFields();var j="";for(var c=0,b=e.length;c<b;++c){var h=g[e[c]];if(Kekule.ObjUtils.notUnset(h)){if(!!j){j+=", "}j+=e[c]+": "+h}}return"{"+j+"}"}else{return""}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size3D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"screenSize");Kekule.PropertyEditor.ChemOptionObjectEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemOptionObjectEditor",CHILD_FIELD_INFOS:null,initialize:function($super){$super();this.setAllowEmpty(true)},getObjFieldInfos:function(g){var e=ClassEx.getCommonSuperClass(this.getObjects());var b=[];var h=this.CHILD_FIELD_INFOS;for(var d=0,c=h.length;d<c;++d){var f=h[d];if(!f.targetClass||!e||ClassEx.isOrIsDescendantOf(e,f.targetClass)){b.push(f)}}b.sort(function(j,i){return(j.name>i.name)?1:(j.name<i.name)?-1:0});return b},notifyChildEditorValueChange:function($super,d,c){var b=this.getValue()||this._initialObjValue;b=Object.extend({},b);if(Kekule.ObjUtils.notUnset(c)){b[d]=c}else{delete b[d]}this.setValue(b)}});Kekule.PropertyEditor.ChemRender2DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender2DOptionsEditor",CHILD_FIELD_INFOS:[{name:"expanded",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"unitLength",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"moleculeDisplayType",dataType:DataType.INT,enumSource:Kekule.Render.MoleculeDisplayType,targetClass:Kekule.StructureFragment},{name:"renderType",dataType:DataType.INT,enumSource:Kekule.Render.BondRenderType,targetClass:Kekule.ChemStructureConnector},{name:"nodeDisplayMode",dataType:DataType.INT,enumSource:Kekule.Render.NodeLabelDisplayMode,targetClass:Kekule.ChemStructureNode},{name:"hydrogenDisplayLevel",dataType:DataType.INT,enumSource:Kekule.Render.HydrogenDisplayLevel,targetClass:Kekule.ChemStructureNode},{name:"showCharge",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkType",dataType:DataType.INT,enumSource:Kekule.Render.ChargeMarkRenderType,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkFontSize",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkMargin",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chemMarkerFontSize",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chemMarkerMargin",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"distinguishSingletAndTripletRadical",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"fontSize",dataType:DataType.NUMBER},{name:"fontFamily",dataType:DataType.STRING},{name:"supFontSizeRatio",dataType:DataType.FLOAT},{name:"subFontSizeRatio",dataType:DataType.FLOAT},{name:"superscriptOverhang",dataType:DataType.FLOAT},{name:"subscriptOversink",dataType:DataType.FLOAT},{name:"textBoxXAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxXAlignment},{name:"textBoxYAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxYAlignment},{name:"horizontalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"verticalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"charDirection",dataType:DataType.INT,enumSource:Kekule.Render.TextDirection},{name:"customLabel",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"boldBondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"hashSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingAbs",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondMaxAbsSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowLength",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeHashMinWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondLengthScaleRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"opacity",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"fillColor",dataType:DataType.STRING},{name:"strokeColor",dataType:DataType.STRING},{name:"strokeWidth",dataType:DataType.NUMBER},{name:"atomRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender2DOptionsEditor,null,Kekule.ChemObject,"renderOptions");Kekule.PropertyEditor.ChemRender3DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender3DOptionsEditor",CHILD_FIELD_INFOS:[{name:"displayMultipleBond",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"useVdWRadius",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"nodeRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"nodeRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"connectorLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"hideHydrogens",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"bondSpliceMode",dataType:DataType.INT,enumSource:Kekule.Render.Bond3DSpliceMode,targetClass:Kekule.ChemStructureObject}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender3DOptionsEditor,null,Kekule.ChemObject,"render3DOptions");Kekule.PropertyEditor.GlyphPathParamsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathParamsEditor",CHILD_FIELD_INFOS:[{name:"lineCount",dataType:DataType.INT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"lineGap",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowType",dataType:DataType.STRING,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowType",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.GlyphPathParamsEditor,null,Kekule.Glyph.PathGlyphConnector,"pathParams")})();(function(){var a=Kekule.ArrayUtils;Kekule.GraphElement=Class.create(ObjectEx,{CLASS_NAME:"Kekule.GraphElement",initialize:function($super){$super();this._data={}},initProperties:function(){this.defineProp("storedData",{dataType:DataType.HASH,getter:function(){return this._data},setter:function(b){this._data=b||{}}})},getData:function(b){return b?this._data[b]:this._data},setData:function(b,c){if(b){this._data[b]=c}return this},removeData:function(b){if(this._data[b]){delete this._data[b]}return this}});Kekule.GraphVertex=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphVertex",initialize:function($super){$super();this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("edges",{dataType:DataType.ARRAY,serializable:false,setter:null})},getEdgeCount:function(){return this.getEdges().length},getNeighbors:function(){var b=[];var d=this.getEdges();for(var e=0,c=d.length;e<c;++e){var f=d[e].getVertexes();a.pushUnique(b,a.exclude(f,this))}return b},getNeighborOnEdge:function(d){var e=d.getVertexes();for(var c=0,b=e.length;c<b;++c){if(e[c]!==this){return e[c]}}},getEdgeTo:function(c){var d=this.getEdges();for(var e=0,b=d.length;e<b;++e){var f=d[e].getVertexes();if(f.indexOf(c)>=0){return d[e]}}return null},doAppendEdge:function(b){Kekule.ArrayUtils.pushUnique(this.getEdges(),b);return this},doRemoveEdge:function(b){Kekule.ArrayUtils.remove(this.getEdges(),b);return this},doClearEdges:function(){var b=this.getEdges();for(var c=b.length-1;c>=0;--c){this.removeEdge(b[c])}return this}});Kekule.GraphEdge=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphEdge",initialize:function($super){$super();this.setPropStoreFieldValue("vertexes",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:false,setter:null})},replaceVertex:function(c,d){var f=this.getVertexes();var e=f.indexOf(c);var b=f.indexOf(d);if(e<0||b>=0){return}else{f.splice(e,1,d)}c.doRemoveEdge(this);d.doAppendEdge(this)}});Kekule.GraphTraverseMode={DEPTH_FIRST:0,BREADTH_FIRST:1};Kekule.Graph=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Graph",VISITED_KEY:"__$visited__",initialize:function($super){$super();this.setPropStoreFieldValue("vertexes",[]);this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("edges",{dataType:DataType.ARRAY,serializable:false,setter:null})},addVertex:function(b){Kekule.ArrayUtils.pushUnique(this.getVertexes(),b);return this},newVertex:function(){var b=new Kekule.GraphVertex();this.addVertex(b);return b},removeVertex:function(e){if(Kekule.ArrayUtils.remove(this.getVertexes(),e)){var c=Kekule.ArrayUtils.clone(e.getEdges());for(var d=0,b=c.length;d<b;++d){this.removeEdge(c[d])}}},addEdge:function(d,c,b){if(Kekule.ArrayUtils.pushUnique(this.getEdges(),d)){d.setPropStoreFieldValue("vertexes",[c,b]);c.doAppendEdge(d);b.doAppendEdge(d)}return this},newEdge:function(d,c){var b=new Kekule.GraphEdge();this.addEdge(b,d,c);return b},removeEdge:function(e){var f=e.getVertexes();for(var d=0,b=f.length;d<b;++d){var c=f[d];c.doRemoveEdge(e)}Kekule.ArrayUtils.remove(this.getEdges(),e);return this},traverse:function(h,f,b){var m=[];var g=a.clone(this.getVertexes());for(var e=0,c=g.length;e<c;++e){g[e].setData(this.VISITED_KEY,false)}while(g.length){var j={vertexes:[],edges:[]};var d;if(b&&(g.indexOf(b)>=0)){d=b}else{d=g[0]}var k=this._doTravers(h,f,d);j.vertexes=j.vertexes.concat(k.vertexes);j.edges=j.edges.concat(k.edges);g=a.exclude(g,k.vertexes);m.push(j)}return m},_doTravers:function(p,h,c){var q={vertexes:[],edges:[]};var j=c;if(!j.getData(this.VISITED_KEY)){q.vertexes.push(j);j.setData(this.VISITED_KEY,true);if(p){p(j,false)}}var e=j.getEdges();var k=[];var m=h===Kekule.GraphTraverseMode.BREADTH_FIRST;for(var f=0,d=e.length;f<d;++f){var b=e[f];var o=j.getNeighborOnEdge(b);if(!o.getData(this.VISITED_KEY)){q.vertexes.push(o);q.edges.push(b);o.setData(this.VISITED_KEY,true);if(p){p(b,true);p(o,false)}if(m){k.push(o)}else{var g=this._doTravers(p,h,o);q.vertexes=q.vertexes.concat(g.vertexes);q.edges=q.edges.concat(g.edges)}}}if(m){for(var f=0,d=k.length;f<d;++f){var n=k[f];var g=this._doTravers(p,h,n);q.vertexes=q.vertexes.concat(g.vertexes);q.edges=q.edges.concat(g.edges)}}return q}});Kekule.globalOptions.add("algorithm.molToGraph",{expandSubStructures:true,ignoreBondedHydrogen:true});Kekule.GraphAdaptUtils={ctabToGraph:function(p,c,f){var q=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.molToGraph),f||{});var J=p;var m=Kekule.ArrayUtils;var u=null;var y=q.expandSubStructures;if(J){var g=q.nodeFilter||function(i,e){if(q.nodeClasses){var k=i.getClass();if(!ClassEx.isOrIsDescendantOfClasses(k,q.nodeClasses)){return false}}if(q.ignoreBondedHydrogen){if(i.isHydrogenAtom&&i.isHydrogenAtom()){var j=i.getLinkedConnectors();if(e){j=m.intersect(j,e)}if(j.length<=1){return false}}}return true};var d=q.connectorFilter||function(e,i){if(q.connectorClasses){var j=e.getClass();if(!ClassEx.isOrIsDescendantOfClasses(j,q.connectorClasses)){return false}}if(e.getBondType&&q.bondTypes){if(q.bondTypes.indexOf(e.getBondType())<0){return false}}return true};var u=c||new Kekule.Graph();var D=y?J.getAllContainingConnectors():J.getConnectors();var z=y?J.getLeafNodes():J.getNodes();var n=[];var K=new Kekule.MapEx();for(var G=0,B=D.length;G<B;++G){var b=D[G];if(!d(b)){continue}var o=[];var r=y?b.getConnectedObjs():b.getConnectedSiblings();for(var F=0,E=r.length;F<E;++F){var H=r[F];if(z.indexOf(H)>=0){if(g(H,D)){o.push(H)}else{m.pushUnique(n,H)}if(o.length>=2){var t=m.exclude(o,n);for(var x=0,s=t.length;x<s;++x){var w=u.newVertex();w.setData("object",t[x]);K.set(t[x],w)}var I=u.newEdge(K.get(o[0]),K.get(o[1]));I.setData("object",b);m.pushUnique(n,o);break}}}}var h=m.exclude(z,n);for(var G=0,B=h.length;G<B;++G){var A=h[G];if(g(A,D)){var w=u.newVertex();w.setData("object",A)}}K.finalize()}return u},molToGraph:function(g,f,d){var c=Kekule.ArrayUtils;var b=null;if(!g||!g.hasCtab()){return null}var e=g.getCtab();if(e){return Kekule.GraphAdaptUtils.ctabToGraph(e,f,d)}return b},chemObjToGraph:function(h,g,e){var c=Kekule.ChemStructureUtils.getAllStructFragments(h,true);var b=g||new Kekule.Graph();for(var f=0,d=c.length;f<d;++f){Kekule.GraphAdaptUtils.molToGraph(c[f],b,e)}return b}};Kekule.GraphAlgorithmUtils={SEQ_KEY:"__$seq__",RESD_DEGREE_KEY:"__$resdDegree__",VISIT_EDGE_DEGREE_KEY:"__$visitedEdgeDegree__",TYPE_KEY:"__$type__",TYPE_CYCLE:"cycle",TYPE_BRIDGE:"bridge",VISITED_KEY:"__$visited",createSpanningTrees:function(c,b){return c.traverse(null,b)},findCycleBlocks:function(b){var v=[];var m=Kekule.GraphAlgorithmUtils;var c=m.SEQ_KEY;var e=m.RESD_DEGREE_KEY;var u=m.VISIT_EDGE_DEGREE_KEY;var h=m.TYPE_KEY;var p=m.TYPE_CYCLE;var n=m.TYPE_BRIDGE;var d=b.getEdges();for(var E=0,A=d.length;E<A;++E){d[E].removeData(c)}var r=b.getVertexes();for(var E=0,A=r.length;E<A;++E){r[E].removeData(h)}var F=1;var w=1;var L=[];var g=[];var z=[];var f=b.traverse(function(j,i){if(i){j.setData(c,F);g.push(j);++F}else{j.setData(c,w);++w;L.push(j)}});for(var E=0,A=L.length;E<A;++E){var x=L[E];var H=x.getEdges();x.setData(e,H.length);var J=0;for(var D=0,B=H.length;D<B;++D){var o=H[D];if(o.getData(c)){++J}}x.setData(u,J);if(J<H.length){z.push(x)}}var s=function(S,Q){if(Q&&S.getData(c)<=1){return null}var O=S.getEdges();var T=null;var R=null;for(var P=0,j=O.length;P<j;++P){var k=O[P].getData(c);if(k){if(!R){T=O[P];R=k}else{if(k<R){T=O[P];R=k}}}}if(T){return T}else{return null}};var t=function(P){var k=P.getEdges();for(var O=0,j=k.length;O<j;++O){if(!k[O].getData(c)&&!k[O].getData(h)){return k[O]}}return null};var I=function(O){var j=[],X=[];var k=O.getData(u);var T=O.getData(e);var S=T-k;if(S>0){O.setData(h,p);a.pushUnique(j,O);for(var Q=0;Q<S;++Q){O.setData(e,T+1);var l=t(O);if(l){l.setData(h,p);a.pushUnique(X,l);var W=O.getNeighborOnEdge(l);W.setData(e,W.getData(e)+1);W.setData(h,p);a.pushUnique(j,W);do{var k=W.getData(u);var T=W.getData(e);if(k<T){var P=I(W);a.pushUnique(j,P.vertexes);a.pushUnique(X,P.edges)}var V=s(W,false);if(!V){break}V.setData(h,p);a.pushUnique(X,V);var R=W.getNeighborOnEdge(V);if(!R.getData(h)){R.setData(h,p);a.pushUnique(j,R);W=R}else{break}}while(true)}}}return{vertexes:j,edges:X}};var y=L.shift();while(y){if(y.getData(h)){}else{var N=y.getData(u);var M=y.getData(e);var K=M-N;if(K>0){var G=I(y);v.push(G)}else{y.setData(h,n);var q=s(y,true);if(q){q.setData(h,n)}}}y=L.shift()}return v},findEndChains:function(o){var m=Kekule.ArrayUtils;var h="__$currConnectivity__";var q={vertexes:[],edges:[]};var j=m.clone(o.getVertexes());var b=[];for(var g=0,d=j.length;g<d;++g){var n=j[g];var c=n.getEdgeCount();n.setData(h,c);if(c<=1){b.push(n)}}if(b.length){var f=b.pop();m.remove(j,f);q.vertexes.push(f);while(j.length){var k=false;var e=m.exclude(f.getEdges(),q.edges);if(e.length){q.edges=q.edges.concat(e);var p=f.getNeighborOnEdge(e[0]);var c=p.getData(h)-1;p.setData(h,c);if(c<=1){f=p;m.remove(j,f);q.vertexes.push(f);k=true}}if(!k){if(b.length){var f=b.pop();m.remove(j,f);q.vertexes.push(f)}else{break}}}}return q},removeEndChains:function(e){var d=Kekule.GraphAlgorithmUtils.findEndChains(e);for(var c=0,b=d.vertexes.length;c<b;++c){e.removeVertex(d.vertexes[c])}return d},findBridgeChains:function(f){var h=f.getVertexes();var g=f.getEdges();var e=Kekule.GraphAlgorithmUtils.findCycleBlocks(f);for(var d=0,c=e.length;d<c;++d){h=a.exclude(h,e[d].vertexes);g=a.exclude(g,e[d].edges)}var b={vertexes:h,edges:g};return b},removeBridgeChains:function(e){var d=Kekule.GraphAlgorithmUtils.findBridgeChains(e);for(var c=0,b=d.vertexes.length;c<b;++c){e.removeVertex(chainElems.vertexes[c])}return d},findAllRings:function(w){var f=Kekule.GraphAlgorithmUtils;var g="__$path_detail__";var r="__$vertextPartDegree__";var n=[];var h;if(w instanceof Kekule.Graph){h=f.findCycleBlocks(w)}else{h=[w]}var s=function(i){return i.vertexes.length===i.edges.length};var o=function(i,k){var x=i.vertexes;var j=x.length;return j&&((x[0]===k)||(x[j-1]===k))};var b=function(k,j,i){var y=a.clone(k.vertexes);var x=a.clone(j.vertexes);y.shift();y.pop();x.shift();x.pop();var l=a.intersect(y,x);return(l.length>=1)};var c=function(k,j,i){var x=a.clone(k.vertexes);var l=a.clone(j.vertexes);var A=a.clone(k.edges);var z=a.clone(j.edges);if(x[0]===i){x.reverse();A.reverse()}if(l[l.length-1]===i){l.reverse();z.reverse()}x.pop();var B=x.concat(l);var y=A.concat(z);return{vertexCount:k.vertexCount+j.vertexCount-1,vertexes:B,edges:y}};var d=function(y){var D=[];var I=a.clone(y.vertexes);var x=y.edges;for(var M=0,J=I.length;M<J;++M){var E=I[M];var O=a.intersect(E.getEdges(),x);E.setData(r,O.length)}I.sort(function(j,i){return(j.getData(r)-i.getData(r))});var N=[];for(var M=0,J=y.edges.length;M<J;++M){var z=y.edges[M];var K=z.getVertexes();N.push({vertexCount:K.length,vertexes:[K[0],K[1]],edges:[z]})}while(I.length){var G=I.shift();var F=null;var k=-1;for(var M=N.length-1;M>=0;--M){var H=N[M];if(o(H,G)){F=H;for(var L=M-1;L>=0;--L){var H=N[L];if(o(H,G)){if(!b(F,H,G)){var B=c(F,H,G);var A=B.vertexes;if(A[0]===A[A.length-1]){A.pop();D.push(B)}else{N.push(B)}}}}N.splice(M,1)}}}return D};for(var v=0,q=h.length;v<q;++v){var p=h[v];if(s(p)){n.push({vertexes:a.clone(p.vertexes),edges:a.clone(p.edges)})}else{var e=d(p);for(var u=0,t=e.length;u<t;++u){var m=e[u];n.push({vertexes:a.clone(m.vertexes),edges:a.clone(m.edges)})}}}return n},findSSSR:function(g,k){var e=Kekule.GraphAlgorithmUtils;var n=[];var m;if(g instanceof Kekule.Graph){m=e.findCycleBlocks(g);k=null}else{m=[g]}var b=1||function(w){var v=[];var p=cycleBlock.edges.length-cycleBlock.vertexes.length+1;if(p<=0){return[]}var u=e.findAllRings(cycleBlock);var x=new Kekule.MapEx(true);for(var E=0,A=u.length;E<A;++E){var o=u[E].edges.length;var t=x.get(o);if(!t){t=[];x.set(o,t)}t.push(u[E])}var z=x.getKeys();z.sort(function(l,i){return l-i});var s;var q=a.clone(cycleBlock.edges);var y=function(l,i){return a.intersect(l,i.edges).length};var r=function(i){v.push(i);q=a.exclude(q,i.edges)};for(var D=0,B=z.length;D<B;++D){var H=z[D];var G=x.get(H);if(G.length<=1){if(v.length===0){s=G.shift();r(s)}else{s=G.shift();if(!!y(q,s)){r(s)}}}else{while(G.length&&(v.length<p)&&q.length){if(v.length===0){s=G.shift();r(s)}else{for(var E=G.length-1;E>=0;--E){s=G[E];var F=y(q,s);if(F<=0){G.splice(E,1)}else{s.__uncheckedEdgeCount__=F}}G.sort(function(l,i){return l.__uncheckedEdgeCount__-i.__uncheckedEdgeCount__});s=G.shift();r(s)}}}if((v.length>=p)||(q.length<=0)){break}}return v};var h=function(u,s){var v=[];var p=u.edges.length-u.vertexes.length+1;if(p<=0){return[]}var r=s?a.clone(s):e.findAllRings(u);r.sort(function(x,w){return x.vertexes.length-w.vertexes.length});var i=function(w){v.push(w)};var t;var l=[];var q=Kekule.RingVectorUtils;q.prepareConvertRingToVector(u);var o=r.shift();i(o);t=q.convertRingToVector(o,u);l.push(t);while((v.length<p)&&r.length){o=r.shift();t=q.convertRingToVector(o,u);if(!q.isLinearDependant(t,l)){l.push(t);i(o)}}return v};for(var f=0,d=m.length;f<d;++f){var c=m[f];var j=h(c,k);n=n.concat(j)}return n},analysisRings:function(f){var c=Kekule.GraphAlgorithmUtils;var k=[];var j;if(f instanceof Kekule.Graph){j=c.findCycleBlocks(f)}else{j=[f]}for(var e=0,d=j.length;e<d;++e){var b=j[e];var g=c.findAllRings(b);var h=c.findSSSR(b,g);k.push({vertexes:b.vertexes,edges:b.edges,allRings:g,sssrRings:h})}return k}};Kekule.RingVectorUtils={MAX_INT_BITNUM:23,EDGE_INDEX_FIELD:"__$index__",prepareConvertRingToVector:function(e){var c=e.edges;for(var d=0,b=c.length;d<b;++d){c[d][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]=d}},convertRingToVector:function(e,h){var k;var b=h.edges.length;var j=e.edges;if(b<Kekule.RingVectorUtils.MAX_INT_BITNUM){k=0;for(var f=0,d=j.length;f<d;++f){var c=j[f];var g=c[Kekule.RingVectorUtils.EDGE_INDEX_FIELD];k+=1<<g}}else{k=[];for(var f=0,d=j.length;f<d;++f){var c=j[f];var g=c[Kekule.RingVectorUtils.EDGE_INDEX_FIELD];k[g]=true}}return k},vectorNotNull:function(b){if(DataType.isSimpleValue(b)){return !!b}else{for(var c=0;c<b.length;++c){if(b[c]){return true}}return false}},getVectorLength:function(b){if(DataType.isSimpleValue(b)){return b.toString(2).length}else{return b.length}},ringVectorAnd:function(f,e){if(DataType.isSimpleValue(f)){return f&e}else{var b=[];var c=Math.min(f.length,e.length);for(var d=0;d<c;++d){b[d]=f[d]&&e[d]}return b}},ringVectorAndAll:function(f){if(f.length<2){return f[0]}var d=Kekule.RingVectorUtils;var b=d.ringVectorAnd(f[0],f[1]);for(var e=2,c=f.length;e<c;++e){b=d.ringVectorAnd(b,f[e])}return b},ringVectorOr:function(f,e){if(DataType.isSimpleValue(f)){return f|e}else{var b=[];var c=Math.max(f.length,e.length);for(var d=0;d<c;++d){b[d]=f[d]||e[d]}return b}},ringVectorOrAll:function(f){if(f.length<2){return f[0]}var d=Kekule.RingVectorUtils;var b=d.ringVectorOr(f[0],f[1]);for(var e=2,c=f.length;e<c;++e){b=d.ringVectorOr(b,f[e])}return b},ringVectorXor:function(f,e){if(DataType.isSimpleValue(f)){return f^e}else{var b=[];var c=Math.max(f.length,e.length);for(var d=0;d<c;++d){b[d]=!!(f[d]^e[d])}return b}},ringVectorXorAll:function(f){if(f.length<2){return f[0]}var d=Kekule.RingVectorUtils;var b=d.ringVectorXor(f[0],f[1]);for(var e=2,c=f.length;e<c;++e){b=d.ringVectorXor(b,f[e])}return b},ringVectorNot:function(d){if(DataType.isSimpleValue(d)){return ~d}else{var b=[];for(var e=0,c=d.length;e<c;++e){b[e]=!d[e]}return b}},isLinearDependant:function(c,b){var q=Kekule.RingVectorUtils;var g=q.ringVectorOrAll(b);var p=q.ringVectorAnd(c,q.ringVectorNot(g));if(q.vectorNotNull(p)){return false}else{var r=b.length;var j=function(v){var l=[];for(var u=0;u<v;++u){l[u]=v-u-1}return l};var n=function(v,z,x){var u=v[z];var y=++u;if(y>=x-z){if(z>=v.length-1){return false}else{return n(v,z+1,x)}}else{v[z]=y;var l=y;for(var w=z-1;w>=0;--w){++l;v[w]=l}return true}};var o=function(i,l){return n(i,0,l)};var k=0;var t=false;for(var h=2;h<=r;++h){var d=j(h);while(true){++k;var s=[];for(var f=0,e=d.length;f<e;++f){s.push(b[d[f]])}var m=q.ringVectorXorAll(s);if(!q.vectorNotNull(q.ringVectorXor(m,c))){t=true;break}if(!o(d,r)){t=false;break}}if(t){break}}return t}},isLinearDependant_wrong:null&&function(d,g){var c=Kekule.RingVectorUtils;var k=c.ringVectorOrAll(g);var x=c.ringVectorAnd(d,c.ringVectorNot(k));if(c.vectorNotNull(x)){return false}else{var o=c.getVectorLength(d);var e=g.length;var f=[];try{var n=DataType.isSimpleValue(d);if(n){for(var v=0;v<o;++v){var r=1<<v;if(r&d){var p=[];f.push(p);for(var u=0;u<e;++u){if(g[u]&r){p.push(g[u])}}}}}else{for(var v=0;v<o;++v){if(d[v]){var p=[];f.push(p);for(var u=0;u<e;++u){if(g[u][v]){p.push(g[u])}}}}}var w=[];var h=[];for(var v=0,t=f.length;v<t;++v){w[v]=f[v].length;h[v]=0}var z=function(i,j,l){if(i[l]<j[l]-1){++i[l];return true}else{if(l>=j.length-1){return false}i[l]=0;return z(i,j,l+1)}};var b=function(i,j){return z(i,j,0)};var m=0;var q;while(true){++m;var y=[];for(var v=0,t=h.length;v<t;++v){a.pushUnique(y,f[v][h[v]])}if((f.length===4)){}var s=c.ringVectorXorAll(y);if(!c.vectorNotNull(c.ringVectorXor(s,d))){q=true;break}if(!b(h,w)){q=false;break}}return q}finally{}}}}})();(function(){Kekule.ChemStructObjContainer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructObjContainer",initialize:function($super){$super();this.setPropStoreFieldValue("nodes",[]);this.setPropStoreFieldValue("connectors",[])},initProperties:function(){this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:false,setter:null})},clear:function(){this.getNodes().length=0;this.getConnectors().length=0;return this},add:function(c){var b=null;if(c instanceof Kekule.ChemStructureConnector){b=this.getConnectors()}else{if(c instanceof Kekule.ChemStructureNode){b=this.getNodes()}}if(!b){Kekule.error(Kekule.$L("ErrorMsg.CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER"))}else{Kekule.ArrayUtils.pushUnique(b,c)}return this},remove:function(c){var b=null;if(c instanceof Kekule.ChemStructureConnector){b=this.getConnectors()}else{b=this.getNodes()}Kekule.ArrayUtils.remove(b,c);return this}})})();(function(){var b=Kekule;var a=Kekule.ArrayUtils;var c=Kekule.BondType;Kekule.CanonicalizationIndexer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationIndexer",initialize:function($super){$super()},execute:function(e){var d=(e instanceof Kekule.StructureFragment)?e.getCtab():e;if(d){return this.doExecute(d)}else{return null}},doExecute:function(d){}});Kekule.CanonicalizationNodeSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationNodeSorter",execute:function(e){var d=(e instanceof Kekule.StructureFragment)?e.getCtab():e;if(d){return this.doExecute(d,d.getNodes())}else{return null}},doExecute:function(d){}});Kekule.CanonicalizationConnectorSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationConnectorSorter",execute:function(e){var d=(e instanceof Kekule.StructureFragment)?e.getCtab():e;if(d){return this.doExecute(d,d.getConnectors())}else{return null}},doExecute:function(d){}});Kekule.CanonicalizationConnectorConnectedObjsSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationConnectorConnectedObjsSorter",execute:function(e){var d=(e instanceof Kekule.StructureFragment)?e.getCtab():e;if(d){return this.doExecute(d,d.getConnectors())}else{return null}},doExecute:function(d){}});Kekule.CanonicalizationCustomExecutor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationCustomExecutor",execute:function(e){var d=this.doExecute(e);if(d){this.doCanonicalizeConnectedObjs(d)}return d},doExecute:function(d){return d},doCanonicalizeConnectedObjs:function(d){if(!d){return}var e=new Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter();e.execute(d)}});Kekule.CanonicalizationGeneralConnectorSorter=Class.create(Kekule.CanonicalizationConnectorSorter,{CLASS_NAME:"Kekule.CanonicalizationGeneralConnectorSorter",doExecute:function(n){var d=new Kekule.MapEx();try{for(var q=0,g=n.getConnectorCount();q<g;++q){var f=n.getConnectorAt(q);var m=f.getConnectedObjs();var r=[];for(var o=0,h=m.length;o<h;++o){var p=m[o];var e;if(p instanceof Kekule.ChemStructureNode){e=n.indexOfNode(p);r.push(e)}else{}}r.sort(function(j,i){return j-i});d.set(f,r)}n.sortConnectors(function(l,j){var s=d.get(l);var k=d.get(j);var i=a.compare(s,k);if(i===0){i=-(l.getConnectedObjCount()-j.getConnectedObjCount())}return i})}finally{d.finalize()}}});Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter=Class.create(Kekule.CanonicalizationConnectorConnectedObjsSorter,{CLASS_NAME:"Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter",doExecute:function(k){var d=new Kekule.MapEx();try{for(var n=0,h=k.getConnectorCount();n<h;++n){var g=k.getConnectorAt(n);if(g.getConnectedObjCount()===2){var f=g.getConnectedObjAt(0);var e=g.getConnectedObjAt(1);var m=k.indexOfChild(f);var j=k.indexOfChild(e);if(m<0||j<0){m=(f.getCanonicalizationIndex?-f.getCanonicalizationIndex():0)||0;j=(e.getCanonicalizationIndex?-e.getCanonicalizationIndex():0)||0}if(m>j){g.reverseConnectedObjOrder()}}else{g.sortConnectedObjs(function(q,p){var o=k.indexOfChild(q);var l=k.indexOfChild(p);if(o<0||l<0){o=(q.getCanonicalizationIndex?-q.getCanonicalizationIndex():0)||0;l=(p.getCanonicalizationIndex?-p.getCanonicalizationIndex():0)||0;i=(o||0)-(l||0)}var i=k.indexOfChild(q)-k.indexOfChild(p);return i})}}}finally{d.finalize()}}});Kekule.CanonicalizationMorganIndexer=Class.create(Kekule.CanonicalizationIndexer,{CLASS_NAME:"Kekule.CanonicalizationMorganIndexer",doExecute:function(e){var h=Kekule.GraphAdaptUtils.ctabToGraph(e,null,{expandSubStructures:true,ignoreBondedHydrogen:true});if(!h){return null}var i=this._calcGraphFinalECs(h);var d=i.ecMapping;var g=i.vertexGroup;var f=this._sortNodeByEcMapping(h,d,g);this._setCanonicalizationIndexToNodeGroups(f)},_sortNodeByEcMapping:function(f,j,n){var s=[];var e=n;for(var q=0,p=e.length;q<p;++q){var k=e[q];var o=this._vertexesToNodes(k.vertexes);if(o.length===1){a.pushUnique(s,o[0])}else{var t=this._groupNodesWithSameEcValue(o,s);s=s.concat(t)}}var r=[];var g=[];for(var q=0,p=s.length;q<p;++q){var d=s[q];if(!a.isArray(d)){r.push([d]);g.push(d)}else{var w=function(z){for(var y=0,x=r.length;y<x;++y){if(!a.isArray(r[y])){if(r[y]===z){return y}}else{if(r[y].indexOf(z)>=0){return y}}}return -1};var m=function(B,z){var x=[];for(var A=0,y=z.length;A<y;++A){x.push(w(z[A]))}x.sort(function(l,i){return i-l});return x};var v=function(z,y){var B=a.intersect(z.getLinkedObjs(),g);var A=a.intersect(y.getLinkedObjs(),g);var i=B.length-A.length;if(i===0&&B.length>0){var x=m(z,B);var l=m(y,A);i=a.compare(x,l)}return i};var u=a.group(d,v);r=r.concat(u)}g=g.concat(d)}var h=[];for(var q=0,p=r.length;q<p;++q){var d=r[q];if(!a.isArray(d)){h.push(d)}else{if(d.length===1){h.push(d[0])}else{h.push(d)}}}return h},_setCanonicalizationIndexToNodeGroups:function(n){for(var h=0,d=n.length;h<d;++h){var g=h+1;var m=n[h];if(a.isArray(m)){for(var f=0,e=m.length;f<e;++f){m[f].setCanonicalizationIndex(g)}}else{m.setCanonicalizationIndex(g)}}},_vertexesToNodes:function(h){var d=[];for(var f=0,e=h.length;f<e;++f){var g=h[f].getData("object");d.push(g)}return d},_processECs:function(v,f,r,p){if(p){return this._initECs(v,f)}var t=[];var x=[];var e=v.getVertexes();for(var o=0,g=e.length;o<g;++o){var q=e[o];var d=this._usePrimeECs?1:0;if(this._usePrimeECs){var s=this._getPrimeArray()}var w=q.getNeighbors();for(var n=0,m=w.length;n<m;++n){if(this._usePrimeECs){d*=s[(r.get(w[n])-1)||0]}else{d+=r.get(w[n])||0}}a.pushUnique(t,d);if(!x[d]){x[d]=[q]}else{x[d].push(q)}}t.sort(function(j,i){return j-i});var h=[];for(var o=0,g=t.length;o<g;++o){var u=t[o];if(x[u]){h.push(x[u])}}this._setECValueByVertexGroup(h,f);return h.length},_initECs:function(s,g){var r=[];var f=s.getVertexes();for(var p=0,h=f.length;p<h;++p){var q=f[p];var d=q.getEdgeCount();if(!r[d]){r[d]=[q]}else{r[d].push(q)}}var n=[];for(var p=0,h=r.length;p<h;++p){var f=r[p];if(f){if(f.length===1){n.push(f)}else{var e=a.group(f,function(t,l){var k=t.getData("object");var j=l.getData("object");var i=k.getLinkedConnectorCount()-j.getLinkedConnectorCount();if(!i){i=k.compareStructure(j);if(!i){i=(k.getHydrogenCount?k.getHydrogenCount(true):0)-(j.getHydrogenCount?j.getHydrogenCount(true):0)}}return i});for(var o=0,m=e.length;o<m;++o){n.push(a.toArray(e[o]))}}}}this._setECValueByVertexGroup(n,g);return n.length},_setECValueByVertexGroup:function(m,h){for(var g=0,d=m.length;g<d;++g){var n=m[g];for(var f=0,e=n.length;f<e;++f){h.set(n[f],g+1)}}},_getPrimeArray:function(){if(!Kekule.CanonicalizationMorganIndexer.primes){Kekule.CanonicalizationMorganIndexer.primes=Kekule.NumUtils.getPrimes(10000)}return Kekule.CanonicalizationMorganIndexer.primes},_calcGraphFinalECs:function(m){var g=[new Kekule.MapEx(),new Kekule.MapEx()];try{if(m.getVertexes().length<this._getPrimeArray().length){this._usePrimeECs=true}else{this._usePrimeECs=false}var i=0;var n=g[0];var h=g[0];var f=0;var k,l;var j=[];var e=this._processECs(m,n,h,true);var d=true;while(d){f=e;k=l;h=n;++i;n=g[i%2];e=this._processECs(m,n,h);l=null;d=e>f;if(e===f){l=this._groupVertexesByEcValue(m,n);if(!k&&h){k=this._groupVertexesByEcValue(m,h)}j.push(k);d=!this._hasVertexGroup(l,j)}else{j=[]}}}finally{n.finalize()}return{ecMapping:h,ecCount:f,vertexGroup:k||this._groupVertexesByEcValue(m,h)}},_groupVertexesByEcValue:function(n,h){var e=[];var j=[];var d=n.getVertexes();for(var g=0,f=d.length;g<f;++g){var m=d[g];var k=h.get(m);a.pushUnique(j,k);if(!e[k]){e[k]=[]}e[k].push(m)}j.sort(function(l,i){return l-i});var p=[];for(var g=0,f=j.length;g<f;++g){var o=e[j[g]];p.push({ecValue:j[g],vertexes:o,vertexesCount:o.length})}return p},_hasVertexGroup:function(g,d){for(var f=0,e=d.length;f<e;++f){if(this._compareEcVertexGroup(g,d[f])===0){return true}}return false},_compareEcVertexGroup:function(f,j){var h=f.length;var e=h-j.length;if(e===0){var d;for(var g=0;g<h;++g){e=f[g].vertexes.length-j[g].vertexes.length;if(e===0){e=a.exclude(f[g].vertexes,j[g].vertexes).length}if(e!==0){break}}}return e},_groupNodesWithSameEcValue:function(e,g){var d=function(p,m){var h=p.getLinkedObjs();var u=a.intersect(h,m);var k=[];var s=[];for(var t=0,r=u.length;t<r;++t){var j=u[t];k.push(m.indexOf(j))}k.sort(function(l,i){return l-i});for(var t=0,r=k.length;t<r;++t){var j=m[k[t]];var o=p.getConnectorTo(j);var q=o.getBondOrder?o.getBondOrder()||0:0;s.push(q)}return{nodeOrders:k,connectorOrders:s}};var f=a.group(e,function(l,j){var h=l.compareStructure(j);if(h===0){var k=d(l,g);var i=d(j,g);h=a.compare(k.nodeOrders,i.nodeOrders);if(h===0){h=a.compare(k.connectorOrders,i.connectorOrders)}}return h});return f}});Kekule.CanonicalizationMorganNodeSorter=Class.create(Kekule.CanonicalizationNodeSorter,{CLASS_NAME:"Kekule.CanonicalizationMorganNodeSorter",doExecute:function(e){var f=this._getNodeSortedArray(e);var g=f.length;var d=this;e.sortNodes(function(j,i){var l=f.indexOf(j);var k=f.indexOf(i);if(l<0){l=g}if(k<0){k=g}var h=l-k;if(h===0&&l===g){h=d._getNeighborNodesMinIndex(j,f)-d._getNeighborNodesMinIndex(i,f)}return h})},_getNeighborNodesMinIndex:function(j,k){var h=j.getLinkedChemNodes();var d=k.length;for(var g=0,e=h.length;g<e;++g){var f=k.indexOf(h[g]);if(f>0&&f<d){d=f}}return d},_getNodeSortedArray:function(k){var v=[];var q=function(j,z,y){var A;var x=z.getCanonicalizationIndex();var w=y.getCanonicalizationIndex();A=(x||-1)-(w||-1);if(A===0){if(j){var i=j.getConnectorTo(z);var B=j.getConnectorTo(y);A=i.compareStructure(B)}if(A===0){if(z.hasCoord3D(true)&&y.hasCoord3D(true)){var l=Kekule.CoordUtils.substract(z.getAbsCoord3D(true),y.getAbsCoord3D(true));A=l.z||l.y||l.x}}}return A};try{var u=a.clone(k.getNodes());var n,r;for(var m=0,f=u.length;m<f;++m){var e=u[m];if(!n){n=e;r=m}else{if(q(null,e,n)>0){n=e;r=m}}}u.splice(r,1);var d=[];var h=[];if(n){d.push(n)}for(var m=0;m<d.length;++m){var n=d[m];if(m!==0){var p=u.indexOf(n);if(p>=0){d.push(n);u.splice(p,1)}}var t=n.getLinkedObjs();t=a.intersect(t,u);if(t.length){t.sort(function(l,j){var i=n;return q(i,l,j)});for(var g=t.length-1;g>=0;--g){var s=t[g];p=u.indexOf(s);if(p>=0){var o=s.getCanonicalizationIndex();if(Kekule.ObjUtils.isUnset(o)){h.push(s)}else{d.push(s)}u.splice(p,1)}}}}d=d.concat(h);return d}finally{}}});Kekule.Canonicalizer=Class.create({CLASS_NAME:"Kekule.Canonicalizer",initialize:function(){this._executorClasses={};this._executorInstances={};this._defExecutorId=null},registerExecutor:function(f,d,e){if(a.isArray(d)){this._executorClasses[f]={indexer:d[0],nodeSorter:d[1],connectorSorter:d[2]||Kekule.CanonicalizationGeneralConnectorSorter,connectorConnectedObjsSorter:d[3]||Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter}}else{this._executorClasses[f]={customExecutor:d}}if(e){this._defExecutorId=f}},getExecutor:function(f){if(!f){return null}var d=this._executorInstances[f];if(!d){var e=this._executorClasses[f];if(e){if(e.customExecutor){d={customExecutor:new (e.customExecutor)()}}else{d={indexer:new (e.indexer)(),nodeSorter:new (e.nodeSorter)(),connectorSorter:new (e.connectorSorter)(),connectorConnectedObjsSorter:new (e.connectorConnectedObjsSorter)()}}this._executorInstances[f]=d}}return d},canonicalize:function(e,d){e.beginUpdate();try{var k=d||this._defExecutorId;var j=this.getExecutor(k);if(!j){Kekule.error(Kekule.$L("ErrorMsg.REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND"))}else{var i=(e instanceof Kekule.StructureFragment)?e:null;var h=i.getCanonicalizationInfo();if(h&&h.id===k){return e}var f=e.getCtab?e.getCtab():e;if(!f||f.isEmpty()){return e}var g=f.getParent();if(j.customExecutor){j.customExecutor.execute(f)}else{this._doDefaultCanonicalize(j,f,g)}i.setCanonicalizationInfo({id:k})}}finally{e.endUpdate()}return e},_doDefaultCanonicalize:function(g,e,f){var d=f.getFlattenedShadowFragment();var e=d.getCtab();e.beginUpdate();try{g.indexer.execute(e);g.nodeSorter.execute(e);g.connectorSorter.execute(e);g.connectorConnectedObjsSorter.execute(e)}finally{e.endUpdate()}if(!f.getFlattenedShadowOnSelf()){f.beginUpdate();try{this._sortSrcStructBaseOnShadow(f,d);g.connectorConnectedObjsSorter.execute(f.getCtab())}finally{f.endUpdate()}}},_sortSrcStructBaseOnShadow:function(l,r){var q="__$flattern_index$__";var o=function(i){return i[q]};var m=function(s,i){s[q]=i};var d=function(i,u,s,x){m(u,s);var t=u.getParent();if(t.isChildOf(l)){var v=o(t);var w=s+x;if(Kekule.ObjUtils.isUnset(v)||v>w){d(i,t,w,x)}}};var e=function(v){v.beginUpdate();try{v.sortNodes(function(w,i){return o(w)-o(i)});v.sortConnectors(function(w,i){return o(w)-o(i)});for(var t=0,s=v.getNodeCount();t<s;++t){var u=v.getNodeAt(t);if(u instanceof Kekule.StructureFragment){e(u)}}}finally{v.endUpdate()}};l.cascadeOnChildren(function(i){if(i){m(i,null)}});var n=r.getChildCount();l.beginUpdate();try{for(var h=0;h<n;++h){var p=r.getChildAt(h);if(p instanceof Kekule.ChemStructureNode){var g=p;var k=l.getFlatternedShadowSourceObj(g);if(k){d(l,k,h,n);k.setCanonicalizationIndex(g.getCanonicalizationIndex())}}else{if(p instanceof Kekule.ChemStructureConnector){var f=p;var j=l.getFlatternedShadowSourceObj(f);m(j,h)}}}e(l)}finally{l.endUpdate()}}});Kekule.ClassUtils.makeSingleton(Kekule.Canonicalizer);Kekule.canonicalizer=Kekule.Canonicalizer.getInstance();ClassEx.extend(Kekule.ChemObject,{canonicalize:function(e){var d=Kekule.ChemStructureUtils.getAllStructFragments(this,true);for(var g=0,f=d.length;g<f;++g){d[g].canonicalize(e)}return this}});ClassEx.extend(Kekule.StructureConnectionTable,{canonicalize:function(d){Kekule.canonicalizer.canonicalize(this);return this}});ClassEx.extend(Kekule.StructureFragment,{canonicalize:function(d){Kekule.canonicalizer.canonicalize(this);return this}});ClassEx.defineProp(Kekule.ChemStructureObject,"canonicalizationIndex",{dataType:DataType.INT,serializable:false,scope:Class.PropertyScope.PUBLISHED});Kekule.canonicalizer.registerExecutor("morgan",[Kekule.CanonicalizationMorganIndexer,Kekule.CanonicalizationMorganNodeSorter],true)})();(function(){var a=Kekule.ArrayUtils;var b=Kekule.GraphAlgorithmUtils;var d=Kekule.ChemStructureUtils;var c=Kekule.BondType;Kekule.globalOptions.add("algorithm.ringSearch",{bondTypes:[c.COVALENT]});ClassEx.extend(Kekule.StructureConnectionTable,{getGraph:function(e){var f=Class.create(e);f.connectorClasses=[Kekule.Bond];return Kekule.GraphAdaptUtils.ctabToGraph(this,null,f)},extractStructObjs:function(j){var h=j.edges;var n=j.vertexes;var g=[],f=[];for(var k=0,e=n.length;k<e;++k){var m=n[k].getData("object");if(m instanceof Kekule.BaseStructureNode){g.push(m)}}for(var k=0,e=h.length;k<e;++k){var m=h[k].getData("object");if(m instanceof Kekule.BaseStructureConnector){f.push(m)}}return{nodes:g,connectors:f}},findCycleBlocks:function(){var e=this.getRingInfo();return e?e.cycleBlocks:[]},findAllRings:function(){var k=this.getRingInfo();var f=[];if(k){for(var h=0,g=k.cycleBlocks.length;h<g;++h){var e=k.cycleBlocks[h];var j=e.allRings;f=f.concat(j)}}return f},findSSSR:function(){var k=this.getRingInfo();var f=[];if(k){for(var h=0,g=k.cycleBlocks.length;h<g;++h){var e=k.cycleBlocks[h];var j=e.sssrRings;f=f.concat(j)}}return f},analysisRings:function(y){var h=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.ringSearch),y);var s=this.getGraph(h);if(s){var w=[];var e=b.analysisRings(s);for(var q=0,n=e.length;q<n;++q){var v=e[q];var r=this.extractStructObjs(v);w.push(r);r.allRings=[];var m=v.allRings;for(var p=0,o=m.length;p<o;++p){var u=m[p];var f=this.extractStructObjs(u);r.allRings.push(f)}r.sssrRings=[];var x=v.sssrRings;for(var p=0,o=x.length;p<o;++p){var u=x[p];var t=m.indexOf(u);if(t>=0){r.sssrRings.push(r.allRings[t])}else{var f=this.extractStructObjs(u);r.sssrRings.push(f)}}}return{cycleBlocks:w}}else{return null}}});ClassEx.defineProps(Kekule.StructureConnectionTable,[{name:"ringInfo",dataType:DataType.HASH,serializable:false,getter:function(f){var e=this.getPropStoreFieldValue("ringInfo");if(!e&&!f){e=this.analysisRings();this.setPropStoreFieldValue("ringInfo",e)}return e},setter:null}]);ClassEx.extendMethod(Kekule.StructureConnectionTable,"objectChange",function(f,e){this.setPropStoreFieldValue("ringInfo",null);return f(e)});ClassEx.extend(Kekule.StructureFragment,{findCycleBlocks:function(){return this.hasCtab()?this.getCtab().findCycleBlocks():null},findAllRings:function(){return this.hasCtab()?this.getCtab().findAllRings():null},findSSSR:function(){return this.hasCtab()?this.getCtab().findSSSR():null},analysisRings:function(e){return this.hasCtab()?this.getCtab().analysisRings(e):null}});ClassEx.defineProps(Kekule.StructureFragment,[{name:"ringInfo",dataType:DataType.HASH,serializable:false,getter:function(e){return this.hasCtab()?this.getCtab().getRingInfo(e):null},setter:null}]);ClassEx.extendMethod(Kekule.StructureFragment,"_copyAdditionalFragmentInfo",function(o,y,s,w){var x=function(A){var j={nodes:[],connectors:[]};for(var z=0,k=A.nodes.length;z<k;++z){var B=s.get(A.nodes[z]);if(B){j.nodes.push(B)}}for(var z=0,k=A.connectors.length;z<k;++z){var B=s.get(A.connectors[z]);if(B){j.connectors.push(B)}}return j};o(y,s,w);var q=this;var g=q.getRingInfo(true);if(g){var r={cycleBlocks:[]};for(var p=0,h=g.cycleBlocks.length;p<h;++p){var v=g.cycleBlocks[p];var u={allRings:[],sssrRings:[]};var e=v.allRings;for(var n=0,m=e.length;n<m;++n){var t=e[n];u.allRings.push(x(t))}var f=v.sssrRings;for(var n=0,m=f.length;n<m;++n){var t=f[n];u.sssrRings.push(x(t))}r.cycleBlocks.push(u)}y.setPropStoreFieldValue("ringInfo",r)}});ClassEx.extend(Kekule.ChemStructureObject,{getBelongedSssrRings:function(){var e=[];var j=this.getParent();if(j&&j.findSSSR){var k=j.findSSSR();for(var h=0,f=k.length;h<f;++h){var g=k[h];if(this instanceof Kekule.BaseStructureConnector){if(g.connectors.indexOf(this)>=0){e.push(g)}}else{if(g.nodes.indexOf(this)>=0){e.push(g)}}}}return e},getBelongedRingMinSize:function(){var e=null;var k=this.getBelongedSssrRings();if(k&&k.length){for(var j=0,f=k.length;j<f;++j){var h=k[j];var g=h.nodes.length;if(!e){e=g}else{e=Math.min(e,g)}}}return e}});ClassEx.extend(Kekule.ChemObject,{findCycleBlocks:function(){var h=d.getAllStructFragments(this);var e=[];for(var g=0,f=h.length;g<f;++g){var j=h[g].findCycleBlocks();if(j){e=e.concat(j)}}return e.length?e:null},findAllRings:function(){var h=d.getAllStructFragments(this);var e=[];for(var g=0,f=h.length;g<f;++g){var j=h[g].findAllRings();if(j){e=e.concat(j)}}return e.length?e:null},findSSSR:function(){var h=d.getAllStructFragments(this);var e=[];for(var g=0,f=h.length;g<f;++g){var j=h[g].findSSSR();if(j){e=e.concat(j)}}return e.length?e:null},analysisRings:function(g){var j=d.getAllStructFragments(this);var e=[];for(var h=0,f=j.length;h<f;++h){var k=j[h].analysisRings(g);if(k){e=e.concat(k)}}return e.length?e:null}})})();(function(){var b=Kekule.ArrayUtils;var c=Kekule.BondType;var e=Kekule.BondOrder;var d=Kekule.ChemStructureUtils;var a={SATURATED_CARBON:-1,ESTER_CARBON:-16,SULFONE_OR_SULFOXIDE_SULPHUR:-32};Kekule.AromaticTypes={NONAROMATIC:0,EXPLICIT_AROMATIC:1,ANTIAROMATIC:-1,UNCERTAIN:64};ClassEx.extend(Kekule.Atom,{isSulfoneOrSulfoxideSulphur:function(){if(this.getSymbol()==="S"){var g=this.getLinkedMultipleBonds();if(g.length>=1){for(var n=0,f=g;n<f;++n){var p=this.getLinkedObjsOnConnector(g[n]);for(var m=0,h=p.length;m<h;++m){var o=p[m];if((o instanceof Kekule.Atom)&&(o.getSymbol()==="O")){return true}}}}}return false},isEsterCarbon:function(){if(this.getSymbol()==="C"){var m=this.getLinkedBonds(c.COVALENT);var j,k;for(var h=0,g=m.length;h<g;++h){var f=m[h];if(f.isBondBetween("C","O")){if(!k&&(f.getBondOrder()===e.SINGLE)){k=true}else{if(!j&&(f.getBondOrder()===e.DOUBLE)){j=true}}if(k&&j){return true}}}}return false}});Kekule.globalOptions.add("algorithm.aromaticRingsPerception",{allowUncertainRings:false});ClassEx.extend(Kekule.StructureConnectionTable,{_getPossibleRingNodePiElectronCounts:function(j,g,p){var m=function(x,H,B,z){var J=x;var s=Kekule.IsotopeFactory.getIsotope(J);var G=H.getCharge();var F=H.isSaturated&&H.isSaturated();if(!F){var t=H.getLinkedMultipleBonds();if(H.isSulfoneOrSulfoxideSulphur&&H.isSulfoneOrSulfoxideSulphur()){return a.SULFONE_OR_SULFOXIDE_SULPHUR}else{if(H.isEsterCarbon&&H.isEsterCarbon()){return a.ESTER_CARBON}}var D=b.intersect(t,z);var A=D.length;if(A){if((A===2)&&(D[0].getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC)){if(s.isHetero&&s.isHetero()){return[1,2]}else{return 1}}else{if((A===1)&&(D[0].getBondOrder()===Kekule.BondOrder.DOUBLE)){return 1}else{return 0}}}else{if(J==="C"){var u=false;for(var K=0,I=t.length;K<I;++K){var y=t[K];var v=H.getLinkedObjsOnConnector(y);if(v.length===1){var E=v[0];var w=E.getPrimaryIsotope();if(w.isHetero()){u=true;break}}}if(u){return 0}else{return 1}}else{return 1}}}else{if(H.getRadical&&(H.getRadical()===Kekule.RadicalOrder.DOUBLET)){return 1}else{if(s.isHetero()){return 2}else{if(J==="C"){if(G>0){return 0}else{if(G<0){return 2}else{return a.SATURATED_CARBON}}}}}}return 0};if(j instanceof Kekule.VariableAtom){var f=j.getAllowedIsotopeIds();if(f&&f.length){var r=[];for(var o=0,n=f.length;o<n;++o){var h=f[o];var k=Kekule.IsotopeFactory.getIsotopeById(h).getSymbol();b.pushUnique(r,m(k,j,g,p))}return r}else{return[0,1,2]}}var q=j.getPrimaryIsotope();if(!q){return[0,1,2]}else{var k=q.getSymbol();return m(k,j,g,p)}},_checkRingAromaticType:function(h,f){if(f){var q=h.nodes;var v=[];var o=[];var t=q.length;for(var s=0;s<t;++s){var p=q[s];var u=f.get(p);if(b.isArray(u)){v.push(u)}else{v.push([u])}o[s]=0}var y=function(B,n){var i=n[B];var A=++i;if(A>=v[B].length){if(B>=n.length-1){return false}else{n[B]=0;return y(B+1,n)}}else{n[B]=A;return true}};var x=function(i){return y(0,i)};var j;var r=null;var m=0;do{++m;var l=0;var g=null;for(var s=0;s<t;++s){var w=v[s][o[s]];if(w>=0){l+=w}else{g=Kekule.AromaticTypes.NONAROMATIC;break}}if(g===null){var k=parseInt(l/4);var z=l%4;if((k<=5)&&(k!==2)){if(z===2){g=Kekule.AromaticTypes.EXPLICIT_AROMATIC}else{if(!z){g=Kekule.AromaticTypes.ANTIAROMATIC}}}}if(r!==null){if(r!==g){if((r===Kekule.AromaticTypes.EXPLICIT_AROMATIC)||(g===Kekule.AromaticTypes.EXPLICIT_AROMATIC)){return Kekule.AromaticTypes.UNCERTAIN;break}}}else{r=g}}while(x(o));return r}},_calcPossibleRingNodesPElectronCounts:function(f,q,h){var g=[];var m=[];var p=[];if(!h){for(var n=0,k=q.length;n<k;++n){b.pushUnique(g,q[n].nodes);b.pushUnique(m,q[n].connectors)}p=g}else{for(var n=0,k=h.length;n<k;++n){b.pushUnique(g,h[n].nodes);b.pushUnique(m,h[n].connectors)}for(var n=0,k=q.length;n<k;++n){b.pushUnique(p,q[n].nodes)}}for(var n=0,k=p.length;n<k;++n){var j=p[n];var o=this._getPossibleRingNodePiElectronCounts(j,g,m);f.set(j,o)}},perceiveAromaticRings:function(k,o){if(Kekule.ObjUtils.isUnset(k)){k=Kekule.globalOptions.algorithm.aromaticRingsPerception.allowUncertainRings}var m=o||this.findSSSR();var p=[];var f=new Kekule.MapEx();try{this._calcPossibleRingNodesPElectronCounts(f,m,null);for(var j=0,g=m.length;j<g;++j){var h=m[j];var n=this._checkRingAromaticType(h,f);if((n===Kekule.AromaticTypes.EXPLICIT_AROMATIC)||(k&&(n===Kekule.AromaticTypes.UNCERTAIN))){p.push(h)}}return p}finally{f.finalize()}},findAromaticRings:function(f,g){return this.perceiveAromaticRings(f,g)},getRingAromaticType:function(h,g){if(!g){g=this.findSSSR()}var f;var i=new Kekule.MapEx();try{this._calcPossibleRingNodesPElectronCounts(i,[h],g);f=this._checkRingAromaticType(h,i)}finally{i.finalize()}return f}});ClassEx.extend(Kekule.StructureFragment,{perceiveAromaticRings:function(g,h){var f=this.hasCtab()?this.getCtab().perceiveAromaticRings(g,h):[];this.setAromaticRings(f||[]);return f},findAromaticRings:function(f,g){return this.perceiveAromaticRings(f,g)},getRingAromaticType:function(g,f){return this.hasCtab()?this.getCtab().getRingAromaticType(g,f):null}});ClassEx.extend(Kekule.ChemObject,{perceiveAromaticRings:function(h,n){var k=d.getAllStructFragments(this);var f=[];for(var j=0,g=k.length;j<g;++j){var m=k[j].perceiveAromaticRings(h,n);if(m){f=f.concat(m)}}return f.length?f:null},findAromaticRings:function(f,g){return this.perceiveAromaticRings(f,g)}})})();(function(){Kekule.globalOptions.add("algorithm.molStandardization",{cleanStructure:true,unmarshalSubFragments:true,doCanonicalization:true,doAromaticPerception:true,doStereoPerception:true});Kekule.MolStandardizer={standardize:function(d,a){var c=Object.extend({},Kekule.globalOptions.algorithm.molStandardization);var b=d;var e=Object.extend(c,a);if(e.unmarshalSubFragments){b.unmarshalAllSubFragments(true)}if(e.cleanStructure){b.clean()}if(e.doCanonicalization){Kekule.canonicalizer.canonicalize(b,e.canonicalizerExecutorId||null)}if(e.doAromaticPerception){b.perceiveAromaticRings()}if(e.doStereoPerception){b.perceiveStereos(null,true)}return b}};Object.extend(Kekule.ChemStructureUtils,{compareStructFragment:function(b,f,a){var d=b.clone(false);var c=f.clone(false);d.setCanonicalizationIndex(null);c.setCanonicalizationIndex(null);d=Kekule.MolStandardizer.standardize(d);c=Kekule.MolStandardizer.standardize(c);var e=Object.create(a||{});e.doStandardize=false;e.extraComparisonProperties=["canonicalizationIndex"];return d.compareStructure(c,e)},isSameStructure:function(b,c,a){return Kekule.ChemStructureUtils.compareStructFragment(b,c,a)===0}});ClassEx.extend(Kekule.ChemObject,{standardize:function(c){var a=Kekule.ChemStructureUtils.getAllStructFragments(this,true);for(var d=0,b=a.length;d<b;++d){a[d].standardize(c)}return this}});ClassEx.extend(Kekule.StructureFragment,{standardize:function(a){return Kekule.MolStandardizer.standardize(this,a)},isSameStructureWith:function(b,a){return Kekule.ChemStructureUtils.isSameStructure(this,b,a)}});ClassEx.extendMethod(Kekule.StructureFragment,"compare",function(c,b,a){if(a.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(a.doStandardize!==false)&&(b instanceof Kekule.StructureFragment)){return Kekule.ChemStructureUtils.compareStructFragment(this,b,a)}else{return c(b,a)}})})();(function(){var b=Kekule.ArrayUtils;Kekule.globalOptions.add("algorithm.structureSearch",{doStandardize:true});Kekule.ChemStructureSearcher={findSubStructure:function(f,j,d){var k=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.structureSearch),d);if(k.exactMatch){var l=j.isSameStructureWith(f,k);if(l){return[].concat(j.getNodes()).concat(j.getConnectors())}else{return false}}k=Object.extend({level:Kekule.StructureComparationLevel.CONSTITUTION,compareLinkedConnectorCount:false,compareHydrogenCount:false,compareConnectedObjCount:false},k);k=Kekule.ObjComparer.getStructureComparisonDetailOptions(k);var g=k;if(k.doStandardize){var q={unmarshalSubFragments:!true,doCanonicalization:true,doAromaticPerception:true};if(!k.compareStereo){q.doCanonicalization=false}f.standardize(q);j.standardize(q)}var s=j.getFlattenedShadowFragment(true);var c=f.getFlattenedShadowFragment(true);var m=c.getNonHydrogenNodes()[0];var p=s.getNonHydrogenNodes();var o=p.length;var e=0;var r=[];var t=[];var i=false;while(!i&&(e<o)){i=a._compareNode(m,p[e],r,t,g);++e}if(!i){return false}else{var h=b.toUnique(i);var n=j.getFlatternedShadowSourceObjs(h);return n}},_addToComparedObjs:function(d,e,c){e.push(d)},_removeFromComparedObjs:function(e,f,c){var d=f.indexOf(e);f.length=d},_isSameMappedObj:function(h,g,c,f){var e=f.indexOf(g);var d=c.indexOf(h);return(e>=0)&&(e===d)},_compareComparedNeighbors:function(d,c,j,k){if(d.length>c.length){return false}var g=[];for(var h=0,e=d.length;h<e;++h){g.push(j.indexOf(d[h]))}var f=[];for(var h=0,e=c.length;h<e;++h){f.push(k.indexOf(c[h]))}for(var h=0,e=g.length;h<e;++h){if(f.indexOf(g[h])<0){return false}}return true},_compareNode:function(f,n,q,j,u){if(f.compareStructure(n,u)!==0){return false}else{var l=f.getLinkedNonHydrogenConnectors();var d=n.getLinkedNonHydrogenConnectors();var p=l.length;var i=d.length;if(p>i){return false}var e=b.clone(q);var g=b.clone(j);a._addToComparedObjs(f,e,"target");a._addToComparedObjs(n,g,"src");var r=b.intersect(l,e);var s=b.intersect(d,g);var m=true;if(!a._compareComparedNeighbors(r,s,e,g)){m=false}else{l=b.exclude(l,r);d=b.exclude(d,s);if(l.length>d.length){m=false}}var o=[];while(m&&l.length){var k=false;var t=l.shift();var h=0;var c;while(d.length&&!k&&(h<d.length)){c=d[h];k=a._compareConnector(t,c,e,g,u);if(k){o=o.concat(k)}++h}if(!k){m=false;break}else{b.remove(d,c)}}if(m){m=[n].concat(o)}return m}},_compareConnector:function(s,d,q,k,t){if(s.compareStructure(d,t)!==0){return false}else{var i=s.getConnectedObjCount();var e=d.getConnectedObjCount();if(i>e){return false}var f=b.clone(q);var h=b.clone(k);a._addToComparedObjs(s,f,"target");a._addToComparedObjs(d,h,"src");var r=b.clone(s.getConnectedObjs());var u=b.clone(d.getConnectedObjs());var n=b.intersect(r,f);var g=b.intersect(u,h);var o=true;if(!a._compareComparedNeighbors(n,g,f,h)){o=false}else{r=b.exclude(r,n);u=b.exclude(u,g);if(r.length>u.length){o=false}}var p=[];while(o&&r.length){var l=false;var m=r.shift();var j=0;var c;while(u.length&&!l&&(j<u.length)){c=u[j];if(c.getClass()!==m.getClass()){l=false}else{if(c instanceof Kekule.ChemStructureNode){l=a._compareNode(m,c,f,h,t)}else{if(c instanceof Kekule.ChemStructureConnector){l=a._compareConnector(m,c,f,h,t)}else{l=false}}}if(l){p=p.concat(l)}++j}if(!l){o=false;break}else{b.remove(u,c)}}if(o){o=[d].concat(p)}return o}}};var a=Kekule.ChemStructureSearcher;ClassEx.extend(Kekule.StructureFragment,{search:function(d,c){return a.findSubStructure(d,this,c)}})})();(function(){var a=Kekule.ArrayUtils;var b=Kekule.CoordUtils;Kekule.RotationDir={CLOCKWISE:1,ANTICLOCKWISE:-1,UNKNOWN:0};var c=Kekule.RotationDir;Kekule.globalOptions.add("algorithm.stereoPerception",{useFlatternedShadow:true,perceiveStereoConnectors:true,perceiveChiralNodes:true,calcParity:true});Kekule.MolStereoUtils={FISCHER_PROJECTION_BOND_ALLOWED_ERROR:0.08,getDihedralAngleOfNodes:function(o,n,m,l,h,e){if(Kekule.ObjUtils.isUnset(e)){e=true}if(Kekule.ObjUtils.isUnset(h)){if(n.hasCoord3D()){h=Kekule.CoordMode.COORD3D}else{h=Kekule.CoordMode.COORD2D}}var p=function(t,s,x,w,u,A){if(w!==Kekule.CoordMode.COORD2D){return t.getAbsCoordOfMode(w,true)}else{var F=t.getAbsCoordOfMode(w,true);if(s&&x){var v=t.getConnectorTo(s);if(v.getStereo){var D=v.getStereo();var y=Kekule.BondStereo;var E=[y.UP,y.UP_INVERTED,y.DOWN,y.DOWN_INVERTED];if(E.indexOf(D)>=0){var B=v.indexOfConnectedObj(t)-v.indexOfConnectedObj(s);if(B<0){D=y.getInvertedDirection(D)}var z=[1,-1,-1,1];var r=b.getDistance(F,x);F.z=r*z[E.indexOf(D)]}else{if([y.UP_OR_DOWN,y.UP_OR_DOWN_INVERTED].indexOf(D)>=0){return null}}}}F.z=F.z||0;return F}};var d=n.getConnectorTo(m);var k=d&&d.isDoubleBond&&d.isDoubleBond();var i=p(n,null,null,h,e);var g=p(m,null,null,h,e);var j=p(o,n,i,h,e,k);var f=p(l,m,g,h,e,k);if(j&&i&&g&&f){var q=Kekule.GeometryUtils.getDihedralAngleOfPoints(j,i,g,f);return q}else{return -1}},getParityOfNodeSeq:function(j,i,h,g,f,d){var k=Kekule.StereoParity;var e=Kekule.MolStereoUtils.getDihedralAngleOfNodes(j,i,h,g,f,d);var l=(e<0)?k.UNKNOWN:(e<Math.PI*2/5||e>Math.PI*8/5)?k.ODD:(e>Math.PI*3/5&&e<Math.PI*7/5)?k.EVEN:k.UNKNOWN;return l},isStereoBond:function(f){var l=Kekule.ObjUtils.isUnset;if(f.getBelongedRingMinSize){var k=f.getBelongedRingMinSize()||0;if(k>0&&k<=10){return false}}var n=false;var j=f.isDoubleBond&&f.isDoubleBond();if(j&&(f.getConnectedObjCount()===2)){var m=f.getConnectedChemNodes();if(m.length===2){var n=true;for(var h=0;h<2;++h){var e=m[h];var g=e.getHydrogenCount(true);var d=a.exclude(e.getLinkedChemNodes(),m);if((g>=2)||(!d.length)){n=false;break}if(d.length===1){}else{if(d.length===2){if(l(d[0].getCanonicalizationIndex())&&l(d[1].getCanonicalizationIndex())||(d[0].getCanonicalizationIndex()===d[1].getCanonicalizationIndex())){n=false;break}}}}}}else{n=false}return n},doFindStereoBonds:function(f,j){var d=[];if(!j){Kekule.canonicalizer.canonicalize(f,"morganEx")}for(var g=0,e=f.getConnectorCount();g<e;++g){var h=f.getConnectorAt(g);if(Kekule.MolStereoUtils.isStereoBond(h)){d.push(h)}}return d},getStereoBondKeyNodes:function(f){var n=null;if(f.getConnectedObjCount()===2){var m=f.getConnectedChemNodes();if(m.length===2){var h=[];for(var j=0;j<2;++j){var e=m[j];var g=e.getHydrogenCount();var d=a.exclude(e.getLinkedChemNodes(),m);if(d.length===1){h.push(d[0])}else{if(d.length===2){var l=d[0].getCanonicalizationIndex()||-1;var k=d[1].getCanonicalizationIndex()||-1;h.push((k>l)?d[1]:d[0])}else{return null}}}n=[h[0],m[0],m[1],h[1]]}}return n},calcStereoBondParity:function(e,h,g){var i=Kekule.StereoParity;if(!g&&!Kekule.MolStereoUtils.isStereoBond(e)){return i.NONE}if(e.getStereo&&[Kekule.BondStereo.E_OR_Z,Kekule.BondStereo.CIS_OR_TRANS].indexOf(e.getStereo())>=0){return i.NONE}var d=i.UNKNOWN;var f=Kekule.MolStereoUtils.getStereoBondKeyNodes(e);if(f&&f.length){d=Kekule.MolStereoUtils.getParityOfNodeSeq(f[0],f[1],f[2],f[3],h)}return d},doPerceiveStereoConnectors:function(f,h,k){var d=Kekule.MolStereoUtils.doFindStereoBonds(f,k);f.beginUpdate();try{if(d&&d.length){for(var g=0,e=d.length;g<e;++g){var m=d[g];var j=Kekule.MolStereoUtils.calcStereoBondParity(m,h,true);if(m.setParity){m.setParity(j)}}}}finally{f.endUpdate()}return d},isChiralNode:function(g){var v=false;if(g.mayContainElement){var d;var q;var r=null;var e=false;if(g.mayContainElement("C")||g.mayContainElement("Si")){d=4;q=0;r=[0];e=true}else{if(g.mayContainElement("N")){d=4;q=0;e=true}else{if(g.mayContainElement("S")||g.mayContainElement("P")){d=3;q=0;e=true}else{if(g.mayContainElement("B")){d=3;q=0;r=[-1];e=true}}}}if(e){var u=g.getLinkedChemNodes();var t=g.getLinkedMultipleBonds();var j=g.getHydrogenCount?g.getHydrogenCount():0;var p=g.getHydrogenCount?g.getHydrogenCount(true):0;var s=g.getCharge()||0;if(t.length>q||p>=2||u.length+j<d||(r&&r.indexOf(s)<0)){v=false}else{v=true;var m=[];for(var k=0,h=u.length;k<h;++k){var f=u[k];var o=f.getCanonicalizationIndex()||0;if(!m[o]){m[o]=1}else{v=false;break}}}}}return v},doFindChiralNodes:function(f,j){var d=[];if(!j){Kekule.canonicalizer.canonicalize(f,"morganEx")}for(var g=0,e=f.getNodeCount();g<e;++g){var h=f.getNodeAt(g);if(Kekule.MolStereoUtils.isChiralNode(h)){d.push(h)}}return d},calcRotationDirection:function(g,t,n,m,l,k){var s=k?b.substract(g,t):b.substract(t,g);var q,h;var e=null;if(!(s.x===0&&s.y===0)){q=Kekule.GeometryUtils.getVectorCrossProduct(s,{x:0,y:0,z:1});h=Kekule.GeometryUtils.getVectorIncludedAngle(s,{x:0,y:0,z:1});if(s.z<0){h=Math.PI-h}}else{if(s.z<0){q={x:1,y:0,z:0};h=Math.PI}}if(q&&h){e=b.calcRotate3DMatrix({rotateAngle:h,rotateAxisVector:q,center:{x:0,y:0,z:0}})}var r=b.substract(n,g);var p=b.substract(m,g);var o=b.substract(l,g);if(e){r=b.transform3DByMatrix(r,e);p=b.transform3DByMatrix(p,e);o=b.transform3DByMatrix(o,e)}var h=-Math.atan2(r.y,r.x);var e=b.calcTransform2DMatrix({rotateAngle:h,center:{x:0,y:0,z:0}});var f=b.transform2DByMatrix(p,e);var d=b.transform2DByMatrix(o,e);if(f.x===0||d.x===0){return c.UNKNOWN}var j=Math.atan2(f.y,f.x);var i=Math.atan2(d.y,d.x);if(i<0){i=Math.PI*2+i}if(j<0){j=Math.PI*2+j}return(j<i)?c.ANTICLOCKWISE:(j>i)?c.CLOCKWISE:c.UNKNOWN},_getFischerProjectionInfo:function(x,q,k){var f=Object.create(k||null);if(q.length<3||q.length>4){return null}if(q.length===3&&!f.allowExplicitHydrogen){return null}var A=Kekule.CoordMode.COORD2D;var v=f.allowedError||Kekule.MolStereoUtils.FISCHER_PROJECTION_BOND_ALLOWED_ERROR;if(!f.ignoreStructure){var p=(x instanceof Kekule.Atom)&&(x.getAtomicNumber()===6);if(p&&x.getRenderOption){p=x.getRenderOption("nodeDisplayMode")!==Kekule.Render.NodeLabelDisplayMode.SHOWN}if(!p){return null}}var j=x.getAbsCoordOfMode(A,true);var w=[];var h=0;var g=function(i,l,E){if(i[l]){return false}else{i[l]=E;return true}};for(var z=0,y=q.length;z<y;++z){var B=q[z];if(!f.ignoreStructure){var o=B.getConnectorTo(x);var m=o.getStereo()||Kekule.BondStereo.NONE;var u=(o instanceof Kekule.Bond)&&(m===Kekule.BondStereo.NONE);if(!u){return null}}var n=B.getAbsCoordOfMode(A,true);var D=b.substract(n,j);var e=Math.abs(D.x);var d=Math.abs(D.y);if(Kekule.NumUtils.isFloatEqual(e,0)&&Kekule.NumUtils.isFloatEqual(d,0)){return null}var r;var t;if(e>d){t=d/e;r=(D.x>0)?1:3}else{t=e/d;r=(D.y>0)?0:2;++h}if(t>v){return null}else{if(!g(w,r,B)){return null}}}if(h!==2&&!f.allowExplicitVerticalHydrogen){return null}var s={horizontalSiblings:[w[3],w[1]],verticalSiblings:[w[0],w[2]]};if(!f.reversedDirection){s.towardSiblings=s.horizontalSiblings;s.awaySiblings=s.verticalSiblings}else{s.towardSiblings=s.verticalSiblings;s.awaySiblings=s.horizontalSiblings}return s},calcTetrahedronChiralCenterRotationDirectionEx:function(h,d,k,j){var g=Object.extend({implicitFischerProjection:true,allowExplicitHydrogenInFischer:true},j);var A=g.coordMode;var e=!!g.withImplicitSibling;var w=!!g.refSiblingBehind;var r=!!g.implicitFischerProjection;if(!A){var s=h||d||k[0];if(!s){return c.UNKNOWN}if(s.hasCoord3D()){A=Kekule.CoordMode.COORD3D}else{A=Kekule.CoordMode.COORD2D}}var B=A===Kekule.CoordMode.COORD2D;var p=k.length;var m=p;if(d){++m}if(e){++m}if(m<4){return c.UNKNOWN}var n=function(J,l,O,L,M){if(L!==Kekule.CoordMode.COORD2D){return J.getAbsCoordOfMode(L,true)}else{var V=J.getAbsCoordOfMode(L,true);var N;if(l&&O){N=O.z;var K=J.getConnectorTo(l);if(K.getStereo){var Q=K.indexOfConnectedObj(J)-K.indexOfConnectedObj(l);var P=Kekule.BondStereo;var S=K.getStereo()||P.NONE;if(S===P.NONE&&M){if(M.towardSiblings.indexOf(J)>=0){S=(Q<0)?P.UP_INVERTED:P.UP}else{if(M.awaySiblings.indexOf(J)>=0){S=(Q<0)?P.DOWN_INVERTED:P.DOWN}}}var T=[P.UP,P.UP_INVERTED,P.DOWN,P.DOWN_INVERTED];if(T.indexOf(S)>=0){if(Q<0){S=P.getInvertedDirection(S)}var R=[1,-1,-1,1];var i=b.getDistance(V,O);V.z=i*R[T.indexOf(S)]}else{if([P.UP_OR_DOWN,P.UP_OR_DOWN_INVERTED].indexOf(S)>=0){return null}}}}if(Kekule.ObjUtils.isUnset(V.z)&&J.getZIndex2D){V.z=J.getZIndex2D();if(Kekule.ObjUtils.isUnset(V.z)){V.z=N}}V.z=V.z||0;return V}};var v=h?n(h,null,null,A):null;var o={allowedError:g.fischerAllowedError,reversedDirection:g.reversedFischer,allowExplicitHydrogen:g.allowExplicitHydrogenInFischer,allowExplicitVerticalHydrogen:g.allowExplicitVerticalHydrogen};var z=[].concat(k);if(d){Kekule.ArrayUtils.pushUnique(z,d)}var I=(h&&g.implicitFischerProjection)?Kekule.MolStereoUtils._getFischerProjectionInfo(h,z,o):null;var y=[];for(var x=0;x<p;++x){var u=n(k[x],h,v,A,I);y.push(u)}var G=a.clone(y);var D=d?n(d,h,v,A,I):null;if(D){G.push(D)}if(G.indexOf(null)>=0){return c.UNKNOWN}if(!v){var f={};for(var x=0,t=G.length;x<t;++x){f=b.add(G[x],f)}v=b.divide(f,G.length)}var H=0;for(var x=0,t=G.length;x<t;++x){var q=G[x];var F=b.substract(q,v);q.x=F.x;q.y=F.y;q.z=F.z;if(B&&!!F.z){++H}}if(B&&H<=0){return c.UNKNOWN}v={x:0,y:0,z:0};if(e){var f={};for(var x=0,t=G.length;x<t;++x){f=b.add(G[x],f)}var E=b.substract({x:0,y:0,z:0},f);if(!d){D=E}else{y.push(E)}}if(y.length===3&&y.indexOf(null)<0){return Kekule.MolStereoUtils.calcRotationDirection(v,D,y[0],y[1],y[2],w)}else{return c.UNKNOWN}},calcTetrahedronChiralCenterRotationDirection:function(h,g,d,k,i,j,e){var f=Object.create(e);return Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirectionEx(g,d,k,Object.extend(f,{coordMode:h,withImplicitSibling:i,refSiblingBehind:j}))},calcTetrahedronChiralNodeParity:function(e,g,m){var d=Object.create(m||null);if(!g){if(e.hasCoord3D()){g=Kekule.CoordMode.COORD3D}else{g=Kekule.CoordMode.COORD2D}}d.coordMode=g;d.refSiblingBehind=true;var f=Kekule.StereoParity;var j=d.ignoreChiralCheck;if(!j&&!Kekule.MolStereoUtils.isChiralNode(e)){return f.NONE}var k=e.getLinkedChemNodes();var h=e.getHydrogenCount();d.withImplicitSibling=!!h||(k.length<4);k.sort(function(o,n){return -((o.getCanonicalizationIndex()||0)-(n.getCanonicalizationIndex()||0))});var l=d.withImplicitSibling?null:k[3];k=k.slice(0,3);var i=Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirectionEx(e,l,k,d);return(i===c.CLOCKWISE)?f.ODD:(i===c.ANTICLOCKWISE)?f.EVEN:f.UNKNOWN},doPerceiveChiralNodes:function(o,h,d,p){var e=Object.create(p||null);var k=Object.create(e);k.ignoreChiralCheck=true;var q=Kekule.MolStereoUtils.doFindChiralNodes(o,d);o.beginUpdate();try{if(q&&q.length){for(var m=0,g=q.length;m<g;++m){var f=q[m];var j=Kekule.MolStereoUtils.calcTetrahedronChiralNodeParity(f,h,k);if(f.setParity){f.setParity(j)}}}}finally{o.endUpdate()}return q},perceiveStereos:function(q,h,d,r){var e=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.stereoPerception),r);var s;var n=(q instanceof Kekule.StructureConnectionTable)?q.getParent():q;var m;if(e.useFlatternedShadow){m=n.getFlattenedShadowFragment(true)}else{m=n}if(!d){Kekule.canonicalizer.canonicalize(m,"morganEx")}m.beginUpdate();try{var o,k;if(e.perceiveStereoConnectors){if(e.calcParity){o=Kekule.MolStereoUtils.doPerceiveStereoConnectors(m,h,true)}else{o=Kekule.MolStereoUtils.doFindStereoBonds(m,true)}}if(e.perceiveChiralNodes){if(e.calcParity){k=Kekule.MolStereoUtils.doPerceiveChiralNodes(m,h,true,e)}else{k=Kekule.MolStereoUtils.doFindChiralNodes(m,true)}}var g=(k||[]).concat(o||[]);if(e.useFlatternedShadow&&!n.getFlattenedShadowOnSelf()){s=[];n.beginUpdate();try{for(var j=0,f=g.length;j<f;++j){var p=n.getFlatternedShadowSourceObj(g[j]);if(p){if(e.calcParity){p.setParity(g[j].getParity())}s.push(p)}}}finally{n.endUpdate()}}else{s=g}}finally{m.endUpdate()}return s},findStereoConnectors:function(d,e){return Kekule.MolStereoUtils.perceiveStereos(d,null,e,{perceiveStereoConnectors:true,perceiveChiralNodes:false,calcParity:false})},perceiveStereoConnectors:function(d,e,f){return Kekule.MolStereoUtils.perceiveStereos(d,e,f,{perceiveStereoConnectors:true,perceiveChiralNodes:false,calcParity:true})},findChiralNodes:function(d,e){return Kekule.MolStereoUtils.perceiveStereos(d,null,e,{perceiveStereoConnectors:false,perceiveChiralNodes:true,calcParity:false})},perceiveChiralNodes:function(e,g,h,d){var f=Object.create(d||null);f=Object.extend(f,{perceiveStereoConnectors:false,perceiveChiralNodes:true,calcParity:true});return Kekule.MolStereoUtils.perceiveStereos(e,g,h,f)}};Kekule.CanonicalizationMorganExIndexer=Class.create(Kekule.CanonicalizationMorganIndexer,{CLASS_NAME:"Kekule.CanonicalizationMorganExIndexer",doExecute:function($super,g){$super(g);var e=g.getNonHydrogenNodes();var h=this._groupNodesByCanoIndex(e);var f=null;var d=0;f=Kekule.MolStereoUtils.perceiveStereos(g,null,true)||[];while(d<f.length){h=this._regroupSortedNodes(h);this._setCanonicalizationIndexToNodeGroups(h);d=f.length;f=Kekule.MolStereoUtils.perceiveStereos(g,null,true)||[]}},_groupNodesByCanoIndex:function(d){return a.group(d,function(f,e){return(f.getCanonicalizationIndex()||-1)-(e.getCanonicalizationIndex()||-1)})},_regroupSortedNodes:function(h){var d=[];for(var g=0,e=h.length;g<e;++g){var j=h[g];if(!a.isArray(j)){d.push(j)}else{var f=a.group(j,function(l,k){var i=l.compareStructure(k);if(i===0){var n=l.getLinkedConnectors();var m=k.getLinkedConnectors();i=Kekule.ObjComparer.compareStructure(n,m)}return i});d=d.concat(f)}}return d}});Kekule.canonicalizer.registerExecutor("morganEx",[Kekule.CanonicalizationMorganExIndexer,Kekule.CanonicalizationMorganNodeSorter],true);ClassEx.extend(Kekule.StructureFragment,{perceiveChiralNodes:function(e,f,d){return Kekule.MolStereoUtils.perceiveChiralNodes(this,e,f,d)},perceiveStereoConnectors:function(d,e){return Kekule.MolStereoUtils.perceiveStereoConnectors(this,d,e)},perceiveStereos:function(e,f,d){return Kekule.MolStereoUtils.perceiveStereos(this,e,f,d)}})})();(function(){Kekule.Calculator={};Kekule.Calculator.getWorkerBasePath=function(){var c=Kekule.scriptSrcInfo.useMinFile;var b=c?"workers/":"calculation/workers/";b=Kekule.scriptSrcInfo.path+b;return b};Kekule.Calculator.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Calculator.Base",initProperties:function(){this.defineProp("async",{dataType:DataType.BOOL});this.defineProp("worker",{dataType:DataType.OBJECT,setter:null})},initPropValues:function($super){$super();this.setAsync(true);this.reactWorkerMessageBind=this.reactWorkerMessage.bind(this);this.reactWorkerErrorBind=this.reactWorkerError.bind(this)},getWorkerBasePath:function(){return Kekule.Calculator.getWorkerBasePath()},execute:function(j,c,f){var d=this;this._doneCallback=j;this._errCallback=c;this._msgCallback=f;if(this.getAsync()&&this.isWorkerSupported()&&this.createWorker()){var b=this.getWorker();this.workerStartCalc(b)}else{var h,g;try{g=this.executeSync(j)}catch(i){h=i}if(h){Kekule.error(h);this.error(h)}else{if(g){if(h){this.error(h)}else{this.done()}}}}},executeSync:function(b){},error:function(b){Kekule.error(b);if(this._errCallback){this._errCallback(b)}},done:function(){if(this._doneCallback){this._doneCallback.apply(this,arguments)}this.workerJobDone()},halt:function(){var b=this.getWorker();if(b){b.terminate();this.error(Kekule.$L("ErrorMsg.CALC_TERMINATED_BY_USER"))}},isWorkerSupported:function(){return Kekule.BrowserFeature.workers},createWorker:function(){if(this.isWorkerSupported()){var c=this.getWorkerScriptFile();if(c){var b=new Worker(c);b.addEventListener("message",this.reactWorkerMessageBind);b.addEventListener("error",this.reactWorkerErrorBind);this.setPropStoreFieldValue("worker",b);return b}}},getWorkerScriptFile:function(){return null},importWorkerScriptFile:function(b){this.postWorkerMessage({type:"importScript",url:b})},postWorkerMessage:function(c){var b=this.getWorker();if(b){b.postMessage(c)}},reactWorkerMessage:function(b){if(this._msgCallback){this._msgCallback(b.data)}return this.doReactWorkerMessage(b.data,b)},doReactWorkerMessage:function(b,c){},reactWorkerError:function(b){Kekule.error(b.message);this.error(b.message)},workerStartCalc:function(b){},workerJobDone:function(){var b=this.getWorker();if(b){b.terminate();this.setPropStoreFieldValue("worker",null)}}});Kekule.Calculator.AbstractStructure3DGenerator=Class.create(Kekule.Calculator.Base,{CLASS_NAME:"Kekule.Calculator.AbstractStructure3DGenerator",initProperties:function(){this.defineProp("sourceMol",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("generatedMol",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("options",{dataType:DataType.HASH,getter:function(){var b=this.getPropStoreFieldValue("options");if(!b){b={};this.setPropStoreFieldValue("options",b)}return b}})}});Kekule.Calculator.ServiceManager={_services:{},_getServiceClasses:function(c,d){var b=a._services[c];if(!b&&d){b=[];a._services[c]=b}return b},register:function(d,e){var c=a._getServiceClasses(d,true);var b=c.indexOf(e);if(b>=0){c.splice(b,1)}c.push(e)},unregister:function(d,e){var c=a._getServiceClasses(d,true);var b=c.indexOf(e);if(b>=0){c.splice(b,1)}},getServiceClass:function(d){var b=null;var c=a._getServiceClasses(d);if(c&&c.length){b=c[c.length-1]}return b}};var a=Kekule.Calculator.ServiceManager;Kekule.Calculator.Services={GEN3D:"3D structure generator"};Kekule.Calculator.generate3D=function(m,q,p,j,b){var i=Kekule.Calculator.Services.GEN3D;var l=a.getServiceClass(i);if(l){var d=new l();try{var f=function(){if(p){p(d.getGeneratedMol())}};var k=function(c){if(j){j(c)}};var n=function(c){if(b){b(c)}};try{d.setSourceMol(m);d.setOptions(q);d.execute(f,k,n)}catch(h){k(h)}}finally{return d}}else{var g=Kekule.$L("ErrorMsg.CALC_SERVICE_UNAVAILABLE").format(i);if(p){p(g)}return null}}})();Kekule.chemicalElementsData=[{symbol:"H",casId:"1333-74-0",group:1,period:1,name:"Hydrogen",atomicNumber:1,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:0.37,radiiVdw:1.2,paulingE:2.2,naturalMass:1.00794075382579},{symbol:"He",casId:"7440-59-7",group:18,period:1,name:"Helium",atomicNumber:2,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:0.32,radiiVdw:1.4,naturalMass:4.002601902393709},{symbol:"Li",casId:"7439-93-2",group:1,period:2,name:"Lithium",atomicNumber:3,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:0.32,radiiVdw:2.2,paulingE:0.98,naturalMass:6.9400376247955},{symbol:"Be",casId:"7440-41-7",group:2,period:2,name:"Beryllium",atomicNumber:4,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:0.9,radiiVdw:1.9,paulingE:1.57,naturalMass:9.0121822},{symbol:"B",casId:"7440-42-8",group:13,period:2,name:"Boron",atomicNumber:5,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:0.82,radiiVdw:1.8,paulingE:2.04,naturalMass:10.811028088400002},{symbol:"C",casId:"7440-44-0",group:14,period:2,name:"Carbon",atomicNumber:6,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:0.77,radiiVdw:1.7,paulingE:2.55,naturalMass:12.010735896788},{symbol:"N",casId:"7727-37-9",group:15,period:2,name:"Nitrogen",atomicNumber:7,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:0.77,radiiVdw:1.6,paulingE:3.04,naturalMass:14.006743088432001},{symbol:"O",casId:"7782-44-7",group:16,period:2,name:"Oxygen",atomicNumber:8,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:0.73,radiiVdw:1.55,paulingE:3.44,naturalMass:15.999404927569397},{symbol:"F",casId:"7782-41-4",group:17,period:2,name:"Fluorine",atomicNumber:9,chemicalSerie:"Halogens",phase:"Gas",radiiCova:0.73,radiiVdw:1.5,paulingE:3.98,naturalMass:18.99840322},{symbol:"Ne",casId:"7440-01-9",group:18,period:2,name:"Neon",atomicNumber:10,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:0.69,radiiVdw:1.54,naturalMass:20.180046383574997},{symbol:"Na",casId:"7440-23-5",group:1,period:3,name:"Sodium",atomicNumber:11,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.54,radiiVdw:2.4,paulingE:0.93,naturalMass:22.98976928},{symbol:"Mg",casId:"7439-95-4",group:2,period:3,name:"Magnesium",atomicNumber:12,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.3,radiiVdw:2.2,paulingE:1.31,naturalMass:24.305051612423004},{symbol:"Al",casId:"7429-90-5",group:13,period:3,name:"Aluminum",atomicNumber:13,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.18,radiiVdw:2.1,paulingE:1.61,naturalMass:26.98153863},{symbol:"Si",casId:"7440-21-3",group:14,period:3,name:"Silicon",atomicNumber:14,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.11,radiiVdw:2.1,paulingE:1.9,naturalMass:28.085384754933294},{symbol:"P",casId:"7723-14-0",group:15,period:3,name:"Phosphorus",atomicNumber:15,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.06,radiiVdw:1.95,paulingE:2.19,naturalMass:30.97376163},{symbol:"S",casId:"7704-34-9",group:16,period:3,name:"Sulfur",atomicNumber:16,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.02,radiiVdw:1.8,paulingE:2.58,naturalMass:32.066084993038},{symbol:"Cl",casId:"7782-50-5",group:17,period:3,name:"Chlorine",atomicNumber:17,chemicalSerie:"Halogens",phase:"Gas",radiiCova:0.99,radiiVdw:1.8,paulingE:3.16,naturalMass:35.452538168202},{symbol:"Ar",casId:"7440-37-1",group:18,period:3,name:"Argon",atomicNumber:18,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:0.97,radiiVdw:1.8,naturalMass:39.947676710841314},{symbol:"K",casId:"7440-09-7",group:1,period:4,name:"Potassium",atomicNumber:19,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.96,radiiVdw:2.8,paulingE:0.82,naturalMass:39.09830112446276},{symbol:"Ca",casId:"7440-70-2",group:2,period:4,name:"Calcium",atomicNumber:20,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.74,radiiVdw:2.4,paulingE:1,naturalMass:40.078022651988505},{symbol:"Sc",casId:"7440-20-2",group:3,period:4,name:"Scandium",atomicNumber:21,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.3,paulingE:1.36,naturalMass:44.9559119},{symbol:"Ti",casId:"7440-32-6",group:4,period:4,name:"Titanium",atomicNumber:22,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.15,paulingE:1.54,naturalMass:47.866749245159994},{symbol:"V",casId:"7440-62-2",group:5,period:4,name:"Vanadium",atomicNumber:23,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.63,naturalMass:50.94146749750001},{symbol:"Cr",casId:"7440-47-3",group:6,period:4,name:"Chromium",atomicNumber:24,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.27,radiiVdw:2.05,paulingE:1.66,naturalMass:51.996133070619},{symbol:"Mn",casId:"7439-96-5",group:7,period:4,name:"Manganese",atomicNumber:25,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.39,radiiVdw:2.05,paulingE:1.55,naturalMass:54.9380451},{symbol:"Fe",casId:"7439-89-6",group:8,period:4,name:"Iron",atomicNumber:26,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.83,naturalMass:55.845145623527},{symbol:"Co",casId:"7440-48-4",group:9,period:4,name:"Cobalt",atomicNumber:27,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2,paulingE:1.88,naturalMass:58.933195},{symbol:"Ni",casId:"7440-02-0",group:10,period:4,name:"Nickel",atomicNumber:28,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.21,radiiVdw:2,paulingE:1.91,naturalMass:58.693351562447994},{symbol:"Cu",casId:"7440-50-8",group:11,period:4,name:"Copper",atomicNumber:29,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2,paulingE:1.9,naturalMass:63.5456400936},{symbol:"Zn",casId:"7440-66-6",group:12,period:4,name:"Zinc",atomicNumber:30,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.1,paulingE:1.65,naturalMass:65.39556265691999},{symbol:"Ga",casId:"7440-55-3",group:13,period:4,name:"Gallium",atomicNumber:31,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.1,paulingE:1.81,naturalMass:69.723065622084},{symbol:"Ge",casId:"7440-56-4",group:14,period:4,name:"Germanium",atomicNumber:32,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.22,radiiVdw:2.1,paulingE:2.01,naturalMass:72.61275825015},{symbol:"As",casId:"7440-38-2",group:15,period:4,name:"Arsenic",atomicNumber:33,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.19,radiiVdw:2.05,paulingE:2.18,naturalMass:74.9215965},{symbol:"Se",casId:"7782-49-2",group:16,period:4,name:"Selenium",atomicNumber:34,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.16,radiiVdw:1.9,paulingE:2.55,naturalMass:78.9593882401},{symbol:"Br",casId:"7726-95-6",group:17,period:4,name:"Bromine",atomicNumber:35,chemicalSerie:"Halogens",phase:"Liquid",radiiCova:1.14,radiiVdw:1.9,paulingE:2.96,naturalMass:79.90352797085},{symbol:"Kr",casId:"7439-90-9",group:18,period:4,name:"Krypton",atomicNumber:36,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.1,radiiVdw:2.02,paulingE:3,naturalMass:83.79932499157},{symbol:"Rb",casId:"7440-17-7",group:1,period:5,name:"Rubidium",atomicNumber:37,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.11,radiiVdw:2.9,paulingE:0.82,naturalMass:85.46766359685701},{symbol:"Sr",casId:"7440-24-6",group:2,period:5,name:"Strontium",atomicNumber:38,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.92,radiiVdw:2.55,paulingE:0.95,naturalMass:87.61664410489999},{symbol:"Y",casId:"7440-65-5",group:3,period:5,name:"Yttrium",atomicNumber:39,chemicalSerie:"Transition metals",phase:"Solid",naturalMass:88.9058483},{symbol:"Zr",casId:"7440-67-7",group:4,period:5,name:"Zirconium",atomicNumber:40,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:91.22364760672002},{symbol:"Nb",casId:"7440-03-1",group:5,period:5,name:"Niobium",atomicNumber:41,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2.15,naturalMass:92.9063781},{symbol:"Mo",casId:"7439-98-7",group:6,period:5,name:"Molybdenum",atomicNumber:42,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.45,radiiVdw:2.1,naturalMass:95.93129211008},{symbol:"Tc",casId:"7440-26-8",group:7,period:5,name:"Technetium",atomicNumber:43,chemicalSerie:"Transition metals",phase:"Synthetic",radiiCova:1.56,radiiVdw:2.05},{symbol:"Ru",casId:"7440-18-8",group:8,period:5,name:"Ruthenium",atomicNumber:44,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2.05,naturalMass:101.06494544279},{symbol:"Rh",casId:"7440-16-6",group:9,period:5,name:"Rhodium",atomicNumber:45,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.35,radiiVdw:2,naturalMass:102.905504},{symbol:"Pd",casId:"7440-05-3",group:10,period:5,name:"Palladium",atomicNumber:46,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.05,naturalMass:106.41532878129999},{symbol:"Ag",casId:"7440-22-4",group:11,period:5,name:"Silver",atomicNumber:47,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.53,radiiVdw:2.1,naturalMass:107.86815084455},{symbol:"Cd",casId:"7440-43-9",group:12,period:5,name:"Cadmium",atomicNumber:48,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.2,naturalMass:112.41155220052002},{symbol:"In",casId:"7440-74-6",group:13,period:5,name:"Indium",atomicNumber:49,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.25,naturalMass:114.818085722},{symbol:"Sn",casId:"7440-31-5",group:14,period:5,name:"Tin",atomicNumber:50,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.41,radiiVdw:2.25,naturalMass:118.71010831537001},{symbol:"Sb",casId:"7440-36-0",group:15,period:5,name:"Antimony",atomicNumber:51,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:121.75978613257},{symbol:"Te",casId:"13494-80-9",group:16,period:5,name:"Tellurium",atomicNumber:52,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.35,radiiVdw:2.1,naturalMass:127.60312784714},{symbol:"I",casId:"7553-56-2",group:17,period:5,name:"Iodine",atomicNumber:53,chemicalSerie:"Halogens",phase:"Solid",radiiCova:1.33,radiiVdw:2.1,naturalMass:126.904473},{symbol:"Xe",casId:"7440-63-3",group:18,period:5,name:"Xenon",atomicNumber:54,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.3,radiiVdw:2.16,naturalMass:131.29248059059},{symbol:"Cs",casId:"7440-46-2",group:1,period:6,name:"Cesium",atomicNumber:55,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.25,radiiVdw:3,naturalMass:132.9054519},{symbol:"Ba",casId:"7440-39-3",group:2,period:6,name:"Barium",atomicNumber:56,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.98,radiiVdw:2.7,naturalMass:137.32689183471098},{symbol:"La",casId:"7439-91-0",group:3,period:6,name:"Lanthanum",atomicNumber:57,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.69,radiiVdw:2.5,naturalMass:138.90545398283},{symbol:"Ce",casId:"7440-45-1",period:6,name:"Cerium",atomicNumber:58,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.48,naturalMass:140.11572621392},{symbol:"Pr",casId:"7440-10-0",period:6,name:"Praseodymium",atomicNumber:59,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:140.9076528},{symbol:"Nd",casId:"7440-00-8",period:6,name:"Neodymium",atomicNumber:60,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:144.23613137220002},{symbol:"Pm",casId:"7440-12-2",period:6,name:"Promethium",atomicNumber:61,chemicalSerie:"Lanthanides",phase:"Synthetic",radiiVdw:2.43},{symbol:"Sm",casId:"7440-19-9",period:6,name:"Samarium",atomicNumber:62,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.43,naturalMass:150.36634852618},{symbol:"Eu",casId:"7440-53-1",period:6,name:"Europium",atomicNumber:63,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:2.4,naturalMass:151.96437047419},{symbol:"Gd",casId:"7440-54-2",period:6,name:"Gadolinium",atomicNumber:64,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.38,naturalMass:157.25212221544},{symbol:"Tb",casId:"7440-27-9",period:6,name:"Terbium",atomicNumber:65,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.37,naturalMass:158.9253468},{symbol:"Dy",casId:"7429-91-6",period:6,name:"Dysprosium",atomicNumber:66,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.35,naturalMass:162.49703350552},{symbol:"Ho",casId:"7440-60-0",period:6,name:"Holmium",atomicNumber:67,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.33,naturalMass:164.9303221},{symbol:"Er",casId:"7440-52-0",period:6,name:"Erbium",atomicNumber:68,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.32,naturalMass:167.25630413192},{symbol:"Tm",casId:"7440-30-4",period:6,name:"Thulium",atomicNumber:69,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.3,naturalMass:168.9342133},{symbol:"Yb",casId:"7440-64-4",period:6,name:"Ytterbium",atomicNumber:70,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.28,naturalMass:173.03769558789998},{symbol:"Lu",casId:"7439-94-3",period:6,name:"Lutetium",atomicNumber:71,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.6,radiiVdw:2.27,naturalMass:174.96672138555},{symbol:"Hf",casId:"7440-58-6",group:4,period:6,name:"Hafnium",atomicNumber:72,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.5,radiiVdw:2.25,naturalMass:178.48497214162},{symbol:"Ta",casId:"7440-25-7",group:5,period:6,name:"Tantalum",atomicNumber:73,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:180.94787573628},{symbol:"W",casId:"7440-33-7",group:6,period:6,name:"Tungsten",atomicNumber:74,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.46,radiiVdw:2.1,naturalMass:183.84177810241},{symbol:"Re",casId:"7440-15-5",group:7,period:6,name:"Rhenium",atomicNumber:75,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.59,radiiVdw:2.05,naturalMass:186.2067066106},{symbol:"Os",casId:"7440-04-2",group:8,period:6,name:"Osmium",atomicNumber:76,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2,naturalMass:190.22486304558998},{symbol:"Ir",casId:"7439-88-5",group:9,period:6,name:"Iridium",atomicNumber:77,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2,naturalMass:192.2160564148},{symbol:"Pt",casId:"7440-06-4",group:10,period:6,name:"Platinum",atomicNumber:78,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2.05,naturalMass:195.07780788031297},{symbol:"Au",casId:"7440-57-5",group:11,period:6,name:"Gold",atomicNumber:79,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.1,naturalMass:196.9665687},{symbol:"Hg",casId:"7439-97-6",group:12,period:6,name:"Mercury",atomicNumber:80,chemicalSerie:"Transition metals",phase:"Liquid",radiiCova:1.49,radiiVdw:2.05,naturalMass:200.59916661780002},{symbol:"Tl",casId:"7440-28-0",group:13,period:6,name:"Thallium",atomicNumber:81,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.49,radiiVdw:2.2,naturalMass:204.38333242650796},{symbol:"Pb",casId:"7439-92-1",group:14,period:6,name:"Lead",atomicNumber:82,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:207.21690766300003},{symbol:"Bi",casId:"7440-69-9",group:15,period:6,name:"Bismuth",atomicNumber:83,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.47,radiiVdw:2.3,naturalMass:208.9803987},{symbol:"Po",casId:"7440-08-6",group:16,period:6,name:"Polonium",atomicNumber:84,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.46,radiiVdw:2},{symbol:"At",casId:"7440-08-6",group:17,period:6,name:"Astatine",atomicNumber:85,chemicalSerie:"Halogens",phase:"Solid",radiiVdw:2},{symbol:"Rn",casId:"10043-92-2",group:18,period:6,name:"Radon",atomicNumber:86,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.45,radiiVdw:2},{symbol:"Fr",casId:"7440-73-5",group:1,period:7,name:"Francium",atomicNumber:87,chemicalSerie:"Alkali Metals",phase:"Solid",radiiVdw:2},{symbol:"Ra",casId:"7440-14-4",group:2,period:7,name:"Radium",atomicNumber:88,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiVdw:2},{symbol:"Ac",casId:"7440-34-8",group:3,period:7,name:"Actinium",atomicNumber:89,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Th",casId:"7440-29-1",period:7,name:"Thorium",atomicNumber:90,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:232.0380553},{symbol:"Pa",casId:"7440-13-3",period:7,name:"Protactinium",atomicNumber:91,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2,naturalMass:231.035884},{symbol:"U",casId:"7440-61-1",period:7,name:"Uranium",atomicNumber:92,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:238.0289182792545},{symbol:"Np",casId:"7439-99-8",period:7,name:"Neptunium",atomicNumber:93,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Pu",casId:"7440-07-5",period:7,name:"Plutonium",atomicNumber:94,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Am",casId:"7440-35-9",period:7,name:"Americium",atomicNumber:95,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cm",casId:"7440-51-9",period:7,name:"Curium",atomicNumber:96,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Bk",casId:"7440-40-6",period:7,name:"Berkelium",atomicNumber:97,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cf",casId:"7440-71-3",period:7,name:"Californium",atomicNumber:98,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Es",casId:"7429-92-7",period:7,name:"Einsteinium",atomicNumber:99,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Fm",casId:"7440-72-4",period:7,name:"Fermium",atomicNumber:100,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Md",casId:"7440-11-1",period:7,name:"Mendelevium",atomicNumber:101,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"No",casId:"10028-14-5",period:7,name:"Nobelium",atomicNumber:102,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Lr",casId:"22537-19-5",period:7,name:"Lawrencium",atomicNumber:103,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Rf",casId:"53850-36-5",group:4,period:7,name:"Rutherfordium",atomicNumber:104,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Db",casId:"53850-35-4",group:5,period:7,name:"Dubnium",atomicNumber:105,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Sg",casId:"54038-81-2",group:6,period:7,name:"Seaborgium",atomicNumber:106,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Bh",casId:"54037-14-8",group:7,period:7,name:"Bohrium",atomicNumber:107,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Hs",casId:"54037-57-9",group:8,period:7,name:"Hassium",atomicNumber:108,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Mt",casId:"54038-01-6",group:9,period:7,name:"Meitnerium",atomicNumber:109,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Ds",casId:"54083-77-1",group:10,period:7,name:"Darmstadtium",atomicNumber:110,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Rg",casId:"54386-24-2",group:11,period:7,name:"Roentgenium",atomicNumber:111,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Uub",group:12,period:7,name:"Ununbium",atomicNumber:112,chemicalSerie:"Transition metals",phase:"Synthetic"}];Kekule.isotopesData=[{elementSymbol:"H",atomicNumber:1,isotopes:[{id:"H1",massNumber:1,relativeAbundance:0.999885,atomicNumber:1,exactMass:1.007825032,spin:"1/2+",magneticMoment:"+2.792846",halfLife:-1},{id:"H2",massNumber:2,relativeAbundance:0.000115,atomicNumber:1,exactMass:2.014101778,spin:"1+",magneticMoment:"+0.857438",halfLife:-1},{id:"H3",massNumber:3,exactMass:3.016049278,atomicNumber:1,spin:"1/2+",magneticMoment:"+2.978960",halfLife:388839000,betaminusDecay:"0.01861",betaminusDecayLikeliness:"100.0"},{id:"H4",massNumber:4,exactMass:4.02781,atomicNumber:1},{id:"H5",massNumber:5,exactMass:5.03531,atomicNumber:1},{id:"H6",massNumber:6,exactMass:6.04494,atomicNumber:1},{id:"H7",massNumber:7,exactMass:7.05275,atomicNumber:1}]},{elementSymbol:"He",atomicNumber:2,isotopes:[{id:"He3",massNumber:3,relativeAbundance:0.00000137,atomicNumber:2,exactMass:3.016029319,spin:"1/2+",magneticMoment:"-2.127624",halfLife:-1},{id:"He4",massNumber:4,relativeAbundance:0.99999863,atomicNumber:2,exactMass:4.002603254,spin:"0+",halfLife:-1},{id:"He5",massNumber:5,exactMass:5.01222,atomicNumber:2},{id:"He6",massNumber:6,exactMass:6.0188891,atomicNumber:2,halfLife:0.8067},{id:"He7",massNumber:7,exactMass:7.028021,atomicNumber:2},{id:"He8",massNumber:8,exactMass:8.033922,atomicNumber:2,halfLife:0.119},{id:"He9",massNumber:9,exactMass:9.04395,atomicNumber:2},{id:"He10",massNumber:10,exactMass:10.0524,atomicNumber:2}]},null,null,null,{elementSymbol:"C",atomicNumber:6,isotopes:[{id:"C8",massNumber:8,exactMass:8.037675,atomicNumber:6},{id:"C9",massNumber:9,exactMass:9.0310367,atomicNumber:6,halfLife:0.126},{id:"C10",massNumber:10,exactMass:10.0168532,atomicNumber:6,halfLife:19.255},{id:"C11",massNumber:11,exactMass:11.0114336,atomicNumber:6,spin:"3/2-",halfLife:1223.4,betaplusDecay:"0.96",betaplusDecayLikeliness:"100.0"},{id:"C12",massNumber:12,relativeAbundance:0.9893000000000001,atomicNumber:6,exactMass:12,spin:"0+",halfLife:-1},{id:"C13",massNumber:13,relativeAbundance:0.010700000000000001,atomicNumber:6,exactMass:13.00335484,spin:"1/2-",magneticMoment:"+0.702411",halfLife:-1},{id:"C14",massNumber:14,exactMass:14.00324199,atomicNumber:6,halfLife:180701000000,betaminusDecay:"0.15648",betaminusDecayLikeliness:"100.0"},{id:"C15",massNumber:15,exactMass:15.0105993,atomicNumber:6,halfLife:2.449},{id:"C16",massNumber:16,exactMass:16.014701,atomicNumber:6,halfLife:0.747},{id:"C17",massNumber:17,exactMass:17.022586,atomicNumber:6,halfLife:0.193},{id:"C18",massNumber:18,exactMass:18.02676,atomicNumber:6,halfLife:0.095},{id:"C19",massNumber:19,exactMass:19.03481,atomicNumber:6,halfLife:0.046},{id:"C20",massNumber:20,exactMass:20.04032,atomicNumber:6,halfLife:0.014},{id:"C21",massNumber:21,exactMass:21.04934,atomicNumber:6},{id:"C22",massNumber:22,exactMass:22.0572,atomicNumber:6}]},{elementSymbol:"N",atomicNumber:7,isotopes:[{id:"N10",massNumber:10,exactMass:10.04165,atomicNumber:7},{id:"N11",massNumber:11,exactMass:11.02609,atomicNumber:7},{id:"N12",massNumber:12,exactMass:12.0186132,atomicNumber:7,halfLife:0.011},{id:"N13",massNumber:13,exactMass:13.00573861,atomicNumber:7,halfLife:597.9},{id:"N14",massNumber:14,relativeAbundance:0.9963200000000001,atomicNumber:7,exactMass:14.003074,spin:"1+",magneticMoment:"+0.403761",halfLife:-1},{id:"N15",massNumber:15,relativeAbundance:0.00368,atomicNumber:7,exactMass:15.0001089,spin:"1/2-",magneticMoment:"-0.283189",halfLife:-1},{id:"N16",massNumber:16,exactMass:16.0061017,atomicNumber:7,halfLife:7.13},{id:"N17",massNumber:17,exactMass:17.00845,atomicNumber:7,halfLife:4.173},{id:"N18",massNumber:18,exactMass:18.014079,atomicNumber:7,halfLife:0.624},{id:"N19",massNumber:19,exactMass:19.017029,atomicNumber:7,halfLife:0.304},{id:"N20",massNumber:20,exactMass:20.02337,atomicNumber:7,halfLife:0.1},{id:"N21",massNumber:21,exactMass:21.02711,atomicNumber:7,halfLife:0.085},{id:"N22",massNumber:22,exactMass:22.03439,atomicNumber:7,halfLife:0.024},{id:"N23",massNumber:23,exactMass:23.04122,atomicNumber:7},{id:"N24",massNumber:24,exactMass:24.05104,atomicNumber:7},{id:"N25",massNumber:25,exactMass:25.06066,atomicNumber:7}]},{elementSymbol:"O",atomicNumber:8,isotopes:[{id:"O12",massNumber:12,exactMass:12.034405,atomicNumber:8},{id:"O13",massNumber:13,exactMass:13.024812,atomicNumber:8,halfLife:0.00858},{id:"O14",massNumber:14,exactMass:14.00859625,atomicNumber:8,halfLife:70.606},{id:"O15",massNumber:15,exactMass:15.0030656,atomicNumber:8,halfLife:122.24},{id:"O16",massNumber:16,relativeAbundance:0.9975700000000001,atomicNumber:8,exactMass:15.99491462,spin:"0+",halfLife:-1},{id:"O17",massNumber:17,relativeAbundance:0.00037999999999999997,atomicNumber:8,exactMass:16.9991317,spin:"5/2+",magneticMoment:"-1.89379",halfLife:-1},{id:"O18",massNumber:18,relativeAbundance:0.0020499999999999997,atomicNumber:8,exactMass:17.999161,spin:"0+",halfLife:-1},{id:"O19",massNumber:19,exactMass:19.00358,atomicNumber:8,halfLife:26.91},{id:"O20",massNumber:20,exactMass:20.0040767,atomicNumber:8,halfLife:13.51},{id:"O21",massNumber:21,exactMass:21.008656,atomicNumber:8,halfLife:3.42},{id:"O22",massNumber:22,exactMass:22.00997,atomicNumber:8,halfLife:2.25},{id:"O23",massNumber:23,exactMass:23.01569,atomicNumber:8,halfLife:0.082},{id:"O24",massNumber:24,exactMass:24.02047,atomicNumber:8,halfLife:0.061},{id:"O25",massNumber:25,exactMass:25.02946,atomicNumber:8},{id:"O26",massNumber:26,exactMass:26.03834,atomicNumber:8},{id:"O27",massNumber:27,exactMass:27.04826,atomicNumber:8},{id:"O28",massNumber:28,exactMass:28.05781,atomicNumber:8}]},{elementSymbol:"F",atomicNumber:9,isotopes:[{id:"F14",massNumber:14,exactMass:14.03506,atomicNumber:9},{id:"F15",massNumber:15,exactMass:15.01801,atomicNumber:9,halfLife:-1},{id:"F16",massNumber:16,exactMass:16.011466,atomicNumber:9},{id:"F17",massNumber:17,exactMass:17.00209524,atomicNumber:9,halfLife:64.49},{id:"F18",massNumber:18,exactMass:18.000938,atomicNumber:9,spin:"1+",halfLife:6586.2,betaplusDecay:"0.64",betaplusDecayLikeliness:"97.0",ecDecay:"",ecDecayLikeliness:"3.0"},{id:"F19",massNumber:19,relativeAbundance:1,atomicNumber:9,exactMass:18.99840322,spin:"1/2+",magneticMoment:"+2.628866",halfLife:-1},{id:"F20",massNumber:20,exactMass:19.99998132,atomicNumber:9,halfLife:11},{id:"F21",massNumber:21,exactMass:20.999949,atomicNumber:9,halfLife:4.158},{id:"F22",massNumber:22,exactMass:22.002999,atomicNumber:9,halfLife:4.23},{id:"F23",massNumber:23,exactMass:23.00357,atomicNumber:9,halfLife:2.23},{id:"F24",massNumber:24,exactMass:24.00812,atomicNumber:9,halfLife:0.34},{id:"F25",massNumber:25,exactMass:25.0121,atomicNumber:9,halfLife:0.059},{id:"F26",massNumber:26,exactMass:26.01962,atomicNumber:9},{id:"F27",massNumber:27,exactMass:27.02676,atomicNumber:9},{id:"F28",massNumber:28,exactMass:28.03567,atomicNumber:9},{id:"F29",massNumber:29,exactMass:29.04326,atomicNumber:9},{id:"F30",massNumber:30,exactMass:30.0525,atomicNumber:9},{id:"F31",massNumber:31,exactMass:31.06043,atomicNumber:9}]},null,null,null,null,{elementSymbol:"Si",atomicNumber:14,isotopes:[{id:"Si22",massNumber:22,exactMass:22.03453,atomicNumber:14,halfLife:0.006},{id:"Si23",massNumber:23,exactMass:23.02552,atomicNumber:14},{id:"Si24",massNumber:24,exactMass:24.011546,atomicNumber:14,halfLife:0.102},{id:"Si25",massNumber:25,exactMass:25.004106,atomicNumber:14,halfLife:0.22},{id:"Si26",massNumber:26,exactMass:25.99233,atomicNumber:14,halfLife:2.234},{id:"Si27",massNumber:27,exactMass:26.98670491,atomicNumber:14,halfLife:4.16},{id:"Si28",massNumber:28,relativeAbundance:0.9222969999999999,atomicNumber:14,exactMass:27.97692653,spin:"0+",halfLife:-1},{id:"Si29",massNumber:29,relativeAbundance:0.046832000000000006,atomicNumber:14,exactMass:28.9764947,spin:"1/2+",magneticMoment:"-0.55529",halfLife:-1},{id:"Si30",massNumber:30,relativeAbundance:0.030872,atomicNumber:14,exactMass:29.97377017,spin:"0+",halfLife:-1},{id:"Si31",massNumber:31,exactMass:30.97536323,atomicNumber:14,halfLife:9438},{id:"Si32",massNumber:32,exactMass:31.97414808,atomicNumber:14,halfLife:4730400000},{id:"Si33",massNumber:33,exactMass:32.978,atomicNumber:14,halfLife:6.18},{id:"Si34",massNumber:34,exactMass:33.978576,atomicNumber:14,halfLife:2.77},{id:"Si35",massNumber:35,exactMass:34.98458,atomicNumber:14,halfLife:0.78},{id:"Si36",massNumber:36,exactMass:35.9866,atomicNumber:14,halfLife:0.45},{id:"Si37",massNumber:37,exactMass:36.99294,atomicNumber:14},{id:"Si38",massNumber:38,exactMass:37.99563,atomicNumber:14},{id:"Si39",massNumber:39,exactMass:39.00207,atomicNumber:14},{id:"Si40",massNumber:40,exactMass:40.00587,atomicNumber:14},{id:"Si41",massNumber:41,exactMass:41.01456,atomicNumber:14},{id:"Si42",massNumber:42,exactMass:42.01979,atomicNumber:14},{id:"Si43",massNumber:43,exactMass:43.02866,atomicNumber:14},{id:"Si44",massNumber:44,exactMass:44.03526,atomicNumber:14}]},{elementSymbol:"P",atomicNumber:15,isotopes:[{id:"P24",massNumber:24,exactMass:24.03435,atomicNumber:15},{id:"P25",massNumber:25,exactMass:25.02026,atomicNumber:15},{id:"P26",massNumber:26,exactMass:26.01178,atomicNumber:15,halfLife:0.02},{id:"P27",massNumber:27,exactMass:26.99923,atomicNumber:15,halfLife:0.26},{id:"P28",massNumber:28,exactMass:27.992315,atomicNumber:15,halfLife:0.2703},{id:"P29",massNumber:29,exactMass:28.9818006,atomicNumber:15,halfLife:4.14},{id:"P30",massNumber:30,exactMass:29.9783138,atomicNumber:15,halfLife:149.88},{id:"P31",massNumber:31,relativeAbundance:1,atomicNumber:15,exactMass:30.97376163,spin:"1/2+",magneticMoment:"+1.13160",halfLife:-1},{id:"P32",massNumber:32,exactMass:31.97390727,atomicNumber:15,spin:"1+",magneticMoment:"-0.2524",halfLife:1232240,betaminusDecay:"1.710",betaminusDecayLikeliness:"100.0"},{id:"P33",massNumber:33,exactMass:32.9717255,atomicNumber:15,halfLife:2189380},{id:"P34",massNumber:34,exactMass:33.973636,atomicNumber:15,halfLife:12.43},{id:"P35",massNumber:35,exactMass:34.9733141,atomicNumber:15,halfLife:47.3},{id:"P36",massNumber:36,exactMass:35.97826,atomicNumber:15,halfLife:5.6},{id:"P37",massNumber:37,exactMass:36.97961,atomicNumber:15,halfLife:2.31},{id:"P38",massNumber:38,exactMass:37.98416,atomicNumber:15,halfLife:0.64},{id:"P39",massNumber:39,exactMass:38.98618,atomicNumber:15,halfLife:0.16},{id:"P40",massNumber:40,exactMass:39.9913,atomicNumber:15,halfLife:0.26},{id:"P41",massNumber:41,exactMass:40.99434,atomicNumber:15,halfLife:0.12},{id:"P42",massNumber:42,exactMass:42.00101,atomicNumber:15,halfLife:0.11},{id:"P43",massNumber:43,exactMass:43.00619,atomicNumber:15,halfLife:0.033},{id:"P44",massNumber:44,exactMass:44.01299,atomicNumber:15},{id:"P45",massNumber:45,exactMass:45.01922,atomicNumber:15},{id:"P46",massNumber:46,exactMass:46.02738,atomicNumber:15}]},{elementSymbol:"S",atomicNumber:16,isotopes:[{id:"S26",massNumber:26,exactMass:26.02788,atomicNumber:16},{id:"S27",massNumber:27,exactMass:27.01883,atomicNumber:16,halfLife:0.021},{id:"S28",massNumber:28,exactMass:28.00437,atomicNumber:16,halfLife:0.125},{id:"S29",massNumber:29,exactMass:28.99661,atomicNumber:16,halfLife:0.187},{id:"S30",massNumber:30,exactMass:29.984903,atomicNumber:16,halfLife:1.178},{id:"S31",massNumber:31,exactMass:30.9795547,atomicNumber:16,halfLife:2.572},{id:"S32",massNumber:32,relativeAbundance:0.9493,atomicNumber:16,exactMass:31.972071,spin:"0+",halfLife:-1},{id:"S33",massNumber:33,relativeAbundance:0.0076,atomicNumber:16,exactMass:32.97145876,spin:"3/2+",magneticMoment:"+0.643821",halfLife:-1},{id:"S34",massNumber:34,relativeAbundance:0.0429,atomicNumber:16,exactMass:33.9678669,spin:"0+",halfLife:-1},{id:"S35",massNumber:35,exactMass:34.96903216,atomicNumber:16,spin:"3/2+",magneticMoment:"+1",halfLife:7544450,betaminusDecay:"0.1674",betaminusDecayLikeliness:"100.0"},{id:"S36",massNumber:36,relativeAbundance:0.0002,atomicNumber:16,exactMass:35.96708076,spin:"0+",halfLife:-1},{id:"S37",massNumber:37,exactMass:36.97112557,atomicNumber:16,halfLife:303},{id:"S38",massNumber:38,exactMass:37.971163,atomicNumber:16,halfLife:10218},{id:"S39",massNumber:39,exactMass:38.97513,atomicNumber:16,halfLife:11.5},{id:"S40",massNumber:40,exactMass:39.97545,atomicNumber:16,halfLife:8.8},{id:"S41",massNumber:41,exactMass:40.97958,atomicNumber:16},{id:"S42",massNumber:42,exactMass:41.98102,atomicNumber:16,halfLife:0.56},{id:"S43",massNumber:43,exactMass:42.98715,atomicNumber:16,halfLife:0.22},{id:"S44",massNumber:44,exactMass:43.99021,atomicNumber:16,halfLife:0.123},{id:"S45",massNumber:45,exactMass:44.99651,atomicNumber:16,halfLife:0.082},{id:"S46",massNumber:46,exactMass:46.00075,atomicNumber:16},{id:"S47",massNumber:47,exactMass:47.00859,atomicNumber:16},{id:"S48",massNumber:48,exactMass:48.01417,atomicNumber:16},{id:"S49",massNumber:49,exactMass:49.02362,atomicNumber:16}]},{elementSymbol:"Cl",atomicNumber:17,isotopes:[{id:"Cl28",massNumber:28,exactMass:28.02851,atomicNumber:17},{id:"Cl29",massNumber:29,exactMass:29.01411,atomicNumber:17},{id:"Cl30",massNumber:30,exactMass:30.00477,atomicNumber:17},{id:"Cl31",massNumber:31,exactMass:30.99241,atomicNumber:17,halfLife:0.15},{id:"Cl32",massNumber:32,exactMass:31.98569,atomicNumber:17,halfLife:0.298},{id:"Cl33",massNumber:33,exactMass:32.9774519,atomicNumber:17,halfLife:2.511},{id:"Cl34",massNumber:34,exactMass:33.97376282,atomicNumber:17,halfLife:1.5264},{id:"Cl35",massNumber:35,relativeAbundance:0.7578,atomicNumber:17,exactMass:34.96885268,spin:"3/2+",magneticMoment:"+0.82187",halfLife:-1},{id:"Cl36",massNumber:36,exactMass:35.96830698,atomicNumber:17},{id:"Cl37",massNumber:37,relativeAbundance:0.2422,atomicNumber:17,exactMass:36.96590259,spin:"3/2+",magneticMoment:"+0.68412",halfLife:-1},{id:"Cl38",massNumber:38,exactMass:37.96801043,atomicNumber:17,halfLife:2234.4},{id:"Cl39",massNumber:39,exactMass:38.9680082,atomicNumber:17,halfLife:3336},{id:"Cl40",massNumber:40,exactMass:39.97042,atomicNumber:17,halfLife:81},{id:"Cl41",massNumber:41,exactMass:40.97068,atomicNumber:17,halfLife:38.4},{id:"Cl42",massNumber:42,exactMass:41.97325,atomicNumber:17,halfLife:6.8},{id:"Cl43",massNumber:43,exactMass:42.97405,atomicNumber:17,halfLife:3.3},{id:"Cl44",massNumber:44,exactMass:43.97828,atomicNumber:17,halfLife:0.434},{id:"Cl45",massNumber:45,exactMass:44.98029,atomicNumber:17,halfLife:0.4},{id:"Cl46",massNumber:46,exactMass:45.98421,atomicNumber:17,halfLife:0.223},{id:"Cl47",massNumber:47,exactMass:46.98871,atomicNumber:17},{id:"Cl48",massNumber:48,exactMass:47.99495,atomicNumber:17},{id:"Cl49",massNumber:49,exactMass:49.00032,atomicNumber:17},{id:"Cl50",massNumber:50,exactMass:50.00784,atomicNumber:17},{id:"Cl51",massNumber:51,exactMass:51.01449,atomicNumber:17}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"Br",atomicNumber:35,isotopes:[{id:"Br67",massNumber:67,exactMass:66.96479,atomicNumber:35},{id:"Br68",massNumber:68,exactMass:67.95852,atomicNumber:35},{id:"Br69",massNumber:69,exactMass:68.95011,atomicNumber:35},{id:"Br70",massNumber:70,exactMass:69.94479,atomicNumber:35,halfLife:0.0791},{id:"Br71",massNumber:71,exactMass:70.93874,atomicNumber:35,halfLife:21.4},{id:"Br72",massNumber:72,exactMass:71.93664,atomicNumber:35,halfLife:78.6},{id:"Br73",massNumber:73,exactMass:72.93169,atomicNumber:35,halfLife:204},{id:"Br74",massNumber:74,exactMass:73.929891,atomicNumber:35,halfLife:1524},{id:"Br75",massNumber:75,exactMass:74.925776,atomicNumber:35,halfLife:5802},{id:"Br76",massNumber:76,exactMass:75.924541,atomicNumber:35,halfLife:58320},{id:"Br77",massNumber:77,exactMass:76.921379,atomicNumber:35,halfLife:205330},{id:"Br78",massNumber:78,exactMass:77.921146,atomicNumber:35,halfLife:387.6},{id:"Br79",massNumber:79,relativeAbundance:0.5069,atomicNumber:35,exactMass:78.9183371,spin:"3/2-",magneticMoment:"+2.1064",halfLife:-1},{id:"Br80",massNumber:80,exactMass:79.9185293,atomicNumber:35,halfLife:1060.8},{id:"Br81",massNumber:81,relativeAbundance:0.49310000000000004,atomicNumber:35,exactMass:80.9162906,spin:"3/2-",magneticMoment:"+2.2706",halfLife:-1},{id:"Br82",massNumber:82,exactMass:81.9168041,atomicNumber:35,halfLife:127080},{id:"Br83",massNumber:83,exactMass:82.91518,atomicNumber:35,halfLife:8640},{id:"Br84",massNumber:84,exactMass:83.916479,atomicNumber:35,halfLife:1908},{id:"Br85",massNumber:85,exactMass:84.915608,atomicNumber:35,halfLife:174},{id:"Br86",massNumber:86,exactMass:85.918798,atomicNumber:35,halfLife:55.1},{id:"Br87",massNumber:87,exactMass:86.920711,atomicNumber:35,halfLife:55.6},{id:"Br88",massNumber:88,exactMass:87.92407,atomicNumber:35,halfLife:16.34},{id:"Br89",massNumber:89,exactMass:88.92639,atomicNumber:35,halfLife:4.348},{id:"Br90",massNumber:90,exactMass:89.93063,atomicNumber:35,halfLife:1.91},{id:"Br91",massNumber:91,exactMass:90.93397,atomicNumber:35,halfLife:0.541},{id:"Br92",massNumber:92,exactMass:91.93926,atomicNumber:35,halfLife:0.343},{id:"Br93",massNumber:93,exactMass:92.94305,atomicNumber:35,halfLife:0.102},{id:"Br94",massNumber:94,exactMass:93.94868,atomicNumber:35,halfLife:0.07},{id:"Br95",massNumber:95,exactMass:94.95287,atomicNumber:35},{id:"Br96",massNumber:96,exactMass:95.95853,atomicNumber:35},{id:"Br97",massNumber:97,exactMass:96.9628,atomicNumber:35}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,isotopes:[{id:"I108",massNumber:108,exactMass:107.94348,atomicNumber:53,halfLife:0.036},{id:"I109",massNumber:109,exactMass:108.93815,atomicNumber:53,halfLife:0.0001},{id:"I110",massNumber:110,exactMass:109.93524,atomicNumber:53,halfLife:0.65},{id:"I111",massNumber:111,exactMass:110.93028,atomicNumber:53,halfLife:2.5},{id:"I112",massNumber:112,exactMass:111.92797,atomicNumber:53,halfLife:3.42},{id:"I113",massNumber:113,exactMass:112.92364,atomicNumber:53,halfLife:6.6},{id:"I114",massNumber:114,exactMass:113.92185,atomicNumber:53,halfLife:2.1},{id:"I115",massNumber:115,exactMass:114.91805,atomicNumber:53,halfLife:78},{id:"I116",massNumber:116,exactMass:115.91681,atomicNumber:53,halfLife:2.91},{id:"I117",massNumber:117,exactMass:116.91365,atomicNumber:53,halfLife:133.2},{id:"I118",massNumber:118,exactMass:117.913074,atomicNumber:53,halfLife:822},{id:"I119",massNumber:119,exactMass:118.91007,atomicNumber:53,halfLife:1146},{id:"I120",massNumber:120,exactMass:119.910048,atomicNumber:53,halfLife:4860},{id:"I121",massNumber:121,exactMass:120.907367,atomicNumber:53,halfLife:7632},{id:"I122",massNumber:122,exactMass:121.907589,atomicNumber:53,halfLife:217.8},{id:"I123",massNumber:123,exactMass:122.905589,atomicNumber:53,halfLife:47772},{id:"I124",massNumber:124,exactMass:123.9062099,atomicNumber:53,halfLife:360806},{id:"I125",massNumber:125,exactMass:124.9046302,atomicNumber:53,spin:"5/2+",halfLife:5132850},{id:"I126",massNumber:126,exactMass:125.905624,atomicNumber:53,spin:"2-",halfLife:1132700},{id:"I127",massNumber:127,relativeAbundance:1,atomicNumber:53,exactMass:126.904473,spin:"5/2+",magneticMoment:"+2.808",halfLife:-1},{id:"I128",massNumber:128,exactMass:127.905809,atomicNumber:53,spin:"1+",halfLife:1499.4},{id:"I129",massNumber:129,exactMass:128.904988,atomicNumber:53,magneticMoment:"+2.617",halfLife:15700000,betaminusDecay:"0.193",betaminusDecayLikeliness:"100.0"},{id:"I130",massNumber:130,exactMass:129.906674,atomicNumber:53,halfLife:44496},{id:"I131",massNumber:131,exactMass:130.9061246,atomicNumber:53,halfLife:692988},{id:"I132",massNumber:132,exactMass:131.907997,atomicNumber:53,halfLife:8262},{id:"I133",massNumber:133,exactMass:132.907797,atomicNumber:53,halfLife:74880},{id:"I134",massNumber:134,exactMass:133.909744,atomicNumber:53,halfLife:3150},{id:"I135",massNumber:135,exactMass:134.910048,atomicNumber:53,halfLife:23652},{id:"I136",massNumber:136,exactMass:135.91465,atomicNumber:53,halfLife:83.4},{id:"I137",massNumber:137,exactMass:136.917871,atomicNumber:53,halfLife:24.5},{id:"I138",massNumber:138,exactMass:137.92235,atomicNumber:53,halfLife:6.49},{id:"I139",massNumber:139,exactMass:138.9261,atomicNumber:53,halfLife:2.29},{id:"I140",massNumber:140,exactMass:139.931,atomicNumber:53,halfLife:0.86},{id:"I141",massNumber:141,exactMass:140.93503,atomicNumber:53,halfLife:0.43},{id:"I142",massNumber:142,exactMass:141.94018,atomicNumber:53},{id:"I143",massNumber:143,exactMass:142.94456,atomicNumber:53},{id:"I144",massNumber:144,exactMass:143.94999,atomicNumber:53}]}];Kekule.structGenAtomTypesData=[{elementSymbol:"H",atomicNumber:1,atomTypes:[{id:"H1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Li",atomicNumber:3,atomTypes:[{id:"Li1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"B",atomicNumber:5,atomTypes:[{id:"B3",maxBondOrder:2,bondOrderSum:3}]},{elementSymbol:"C",atomicNumber:6,atomTypes:[{id:"C4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"N",atomicNumber:7,atomTypes:[{id:"N3",maxBondOrder:3,bondOrderSum:3},{id:"N5",maxBondOrder:2,bondOrderSum:5}]},{elementSymbol:"O",atomicNumber:8,atomTypes:[{id:"O2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"F",atomicNumber:9,atomTypes:[{id:"F1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Na",atomicNumber:11,atomTypes:[{id:"Na1",maxBondOrder:1,bondOrderSum:1}]},null,null,{elementSymbol:"Si",atomicNumber:14,atomTypes:[{id:"Si4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"P",atomicNumber:15,atomTypes:[{id:"P3",maxBondOrder:3,bondOrderSum:3},{id:"P4",maxBondOrder:3,bondOrderSum:5}]},{elementSymbol:"S",atomicNumber:16,atomTypes:[{id:"S2",maxBondOrder:2,bondOrderSum:2},{id:"S3",maxBondOrder:2,bondOrderSum:4},{id:"S4",maxBondOrder:2,bondOrderSum:6}]},{elementSymbol:"Cl",atomicNumber:17,atomTypes:[{id:"Cl1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"As",atomicNumber:33,atomTypes:[{id:"As3",maxBondOrder:1,bondOrderSum:3}]},{elementSymbol:"Se",atomicNumber:34,atomTypes:[{id:"Se2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"Br",atomicNumber:35,atomTypes:[{id:"Br1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,atomTypes:[{id:"I1",maxBondOrder:1,bondOrderSum:1}]}];Kekule.ChemicalElementsDataUtil={_getElementInfoBySymbol:function(d){var a;for(var c=0,b=Kekule.chemicalElementsData.length;c<b;++c){a=Kekule.chemicalElementsData[c];if(a&&(a.symbol==d)){return a}}return null},_getElementInfoByAtomicNumber:function(c){var a=Kekule.chemicalElementsData[c-1];if(a&&(a.atomicNumber==c)){return a}else{if((!a)||(a.atomicNumber<c)){for(var d=c,b=Kekule.chemicalElementsData.length;d<b;++d){a=Kekule.chemicalElementsData[d];if(a&&(a.atomicNumber==c)){return a}}for(var d=c-2;d>=0;--d){a=Kekule.chemicalElementsData[d];if(a&&(a.atomicNumber==c)){return a}}}else{for(var d=c-2;d>=0;--d){a=Kekule.chemicalElementsData[d];if(a&&(a.atomicNumber==c)){return a}}for(var d=c,b=Kekule.chemicalElementsData.length;d<b;++d){a=Kekule.chemicalElementsData[d];if(a&&(a.atomicNumber==c)){return a}}}}return null},getElementInfo:function(a){if(typeof(a)=="number"){return Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(a)}else{return Kekule.ChemicalElementsDataUtil._getElementInfoBySymbol(a)}},getElementProp:function(a,b){var c=Kekule.ChemicalElementsDataUtil.getElementInfo(a);return c?c[b]:null},getAtomicNumber:function(a){var b=Kekule.ChemicalElementsDataUtil._getElementInfoBySymbol(a);if(b){return b.atomicNumber}else{return 0}},getElementSymbol:function(a){var b=Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(a);if(b){return b.symbol}else{return null}},isAtomicNumberAvailable:function(a){var b=Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(a);return(!!b)},isElementSymbolAvailable:function(a){return Kekule.ChemicalElementsDataUtil.getAtomicNumber(a)>0}};Kekule.IsotopeAliasUtil={enableAlias:true,ALIAS:[{alias:"D",atomicNumber:1,massNumber:2}],getAllAlias:function(){return Kekule.IsotopeAliasUtil.enableAlias?Kekule.IsotopeAliasUtil.ALIAS:[]},getAliasInfo:function(f){var d=Kekule.IsotopeAliasUtil.getAllAlias();for(var e=0,c=d.length;e<c;++e){var b=d[e];if(b.alias===f){return Object.extend(Kekule.IsotopesDataUtil.getIsotopeInfo(b.atomicNumber,b.massNumber),{isotopeAlias:f})}}return null},getAlias:function(f,e){var d=Kekule.IsotopeAliasUtil.getAllAlias();for(var g=0,c=d.length;g<c;++g){var b=d[g];if(b.atomicNumber===f&&b.massNumber===e){return b.alias}}return null}};Kekule.IsotopesDataUtil={_getElementItem:function(a){var c;if(typeof(a)=="number"){c=a}else{c=Kekule.ChemicalElementsDataUtil.getAtomicNumber(a)}var e=Kekule.isotopesData[c-1];if((!e)||(e.atomicNumber!=c)){for(var d=0,b=Kekule.isotopesData.length;d<b;++d){var e=Kekule.isotopesData[d];if(e&&(e.atomicNumber==c)){break}}}return e},getAllIsotopeInfos:function(a){var b=Kekule.IsotopesDataUtil._getElementItem(a);if(b){return b.isotopes}else{return null}},getIsotopeInfo:function(b,c){var a=null;var f;if(!c&&typeof(b)==="string"){a=Kekule.IsotopeAliasUtil.getAliasInfo(b);if(a){return a}}var h=Kekule.IsotopesDataUtil._getElementItem(b);var e=h.isotopes;if(e){if(c){for(var g=0,d=e.length;g<d;++g){a=e[g];if(a&&(a.massNumber==c)){break}}}else{if(e.length===1){a=e[0]}}if(a){a.elementSymbol=h.elementSymbol;return a}}return null},getIsotopeInfoById:function(a){var b=Kekule.IsotopesDataUtil.getIsotopeIdDetail(a);return Kekule.IsotopesDataUtil.getIsotopeInfo(b.symbol,b.massNumber)},isMassNumberAvailable:function(a,b){var c=Kekule.IsotopesDataUtil.getIsotopeInfo(a,b);return(!!c)},getIsotopeId:function(a,c){if(typeof(a)==="string"&&!c){var f=Kekule.IsotopeAliasUtil.getAliasInfo(a);if(f){return a}}else{var d=Kekule.IsotopeAliasUtil.getAlias(a,c);if(d){return d}}var b=Kekule.ChemicalElementsDataUtil.getElementInfo(a);if(!b){return null}var e=b.symbol;if(c){return e+c.toString()}else{return e}},getIsotopeIdDetail:function(j){if(!j){return null}var g="";var b="";for(var d=0,a=j.length;d<a;++d){var h=j.charAt(d);if((h>="0")&&(h<="9")){b+=h}else{g+=h}}var f=b?parseInt(b,10):null;var e={symbol:g};if(f){e.massNumber=f}return e},isIsotopeIdAvailable:function(e){var c=Kekule.IsotopesDataUtil.getIsotopeIdDetail(e);if(!!Kekule.IsotopeAliasUtil.getAliasInfo(e)){return true}var a=Kekule.ChemicalElementsDataUtil.isElementSymbolAvailable(c.symbol);if(a&&c.massNum){var b=Kekule.IsotopesDataUtil.getIsotopeInfo(c.symbol,c.massNum);a=!!b}return a}};Kekule.AtomTypeDataUtil={getAtomTypeInfoObj:function(b){if(typeof(b)=="number"){atomicNumber=b}else{atomicNumber=Kekule.ChemicalElementsDataUtil.getAtomicNumber(b)}var a=Kekule.structGenAtomTypesData[atomicNumber-1];if(a&&(a.atomicNumber==atomicNumber)){return a}else{for(var d=0,c=Kekule.structGenAtomTypesData.length;d<c;++d){a=Kekule.structGenAtomTypesData[d];if(a&&(a.atomicNumber==atomicNumber)){return a}}return null}},getAllAtomTypes:function(a){var b=Kekule.AtomTypeDataUtil.getAtomTypeInfoObj(a);if(b){return b.atomTypes}else{return null}},getAtomTypeFromId:function(a,h){if(!a){var f="";for(var e=0,b=h.length;e<b;++e){var g=h.chatAt(e);if((g<"0")||(g>"9")){f+=g}}a=f}if(a){var d=Kekule.AtomTypeDataUtil.getAllAtomTypes(a);for(var e=0,b=d.length;e<b;++e){if(d[e].id==h){return d[e]}}}return null}};(function(b){Kekule.EmscriptenUtils={DEF_MODULE_NAME:"Module",_createdModules:{},_getActualModule:function(c){return b[c||a.DEF_MODULE_NAME]},isSupported:function(c){return(typeof(a._getActualModule(c))!=="undefined")},getRootModule:function(g,e){var f=a._getActualModule(g);var d=a._createdModules[f];if(d){return d}var c=a._getActualModule(g);d=c;if(typeof(c)==="function"){d=c(e);a._createdModules[f]=d}return d},getModuleObj:function(c){if(typeof(c)==="object"){return c}else{return a.getRootModule(c)}},getClassCtor:function(c,d){return(a.getModuleObj(d)||{})[c]},cwrap:function(f,e,d,g){var c=a.getModuleObj(g);return(c&&c.cwrap&&c.cwrap(f,e,d))},loadScript:function(c,e,d){if(!d){d=document}Kekule.ScriptFileUtils.appendScriptFile(d,c,e)}};var a=Kekule.EmscriptenUtils})(this);Kekule.LOCAL_RES=true;Kekule.Localization.setCurrModule("extra.openbabel");Kekule.Localization.addResource("en","ErrorMsg",{OpenBabel:{CHEM_NODE_TYPE_NOT_SUITABLE:"Unsuitable node type",CHEM_CONNECTOR_TYPE_NOT_SUITABLE:"Unsuitable connector type",ONLY_STR_INPUT_DATA_ALLOWED:"Input data must be text",ONLY_STR_OUTPUT_DATA_ALLOWED:"Output data must be text",FAIL_TO_GENERATE_3D_STRUCTURE:"Fail to generate 3D structure coordinates"}});(function(){var c=Kekule.EmscriptenUtils;var b={usingModulaize:true,moduleName:"OpenBabelModule"};Kekule.OpenBabel={_autoEnabled:true,_module:null,SCRIPT_FILE:"openbabel.js",_enableFuncs:[],BondOrder:{SINGLE:1,DOUBLE:2,TRIPLE:3,EXPLICIT_AROMATIC:5},getObInitOptions:function(){return b},getModule:function(){if(!a._module){a._module=c.getRootModule(b.moduleName)}return a._module},getClassCtor:function(d){return c.getClassCtor(d,a.getModule())},isScriptLoaded:function(){return c.isSupported(b.moduleName)},enable:function(d){if(!a.isScriptLoaded()){a.loadObScript(document,function(){a._enableAllFunctions();if(d){d()}})}else{a._enableAllFunctions();if(d){d()}}},_enableAllFunctions:function(){if(a.isScriptLoaded()){var e=a._enableFuncs;for(var f=0,d=e.length;f<d;++f){var g=e[f];if(g){g()}}}}};Kekule._registerAfterLoadProc(function(){if(a._autoEnabled){a._enableAllFunctions()}});Kekule.OpenBabel.getObPath=function(){var e=Kekule.scriptSrcInfo.useMinFile;var d=e?"extra/":"_extras/OpenBabel/";d=Kekule.scriptSrcInfo.path+d;return d};Kekule.OpenBabel.getObScriptUrl=function(){var d=Kekule.OpenBabel.getObPath()+Kekule.OpenBabel.SCRIPT_FILE;var e=Kekule.scriptSrcInfo.useMinFile;if(!e){d+=".dev"}return d};Kekule.OpenBabel.loadObScript=function(e,f){if(!e){e=document}if(!a._obScriptLoadedBySelf&&!a.isScriptLoaded()){var d=Kekule.OpenBabel.getObScriptUrl();c.loadScript(d,f,e);a._obScriptLoadedBySelf=true}else{a._obScriptLoadedBySelf=true;if(f){f()}}};var a=Kekule.OpenBabel;Kekule.OpenBabel.AdaptUtils={DEF_ATOM_ID_PREFIX:"A",DEF_BOND_ID_PREFIX:"B",DEF_MOL_ID_PREFIX:"M",wrapCFuncs:function(){if(!Kekule.OpenBabel._funcInited){var d={};Object.extend(Kekule.OpenBabel,d);Kekule.OpenBabel._funcInited=true}},isAvailable:function(){return typeof(a.getClassCtor("ObBaseHelper"))!=="undefined"},obObjToKekule:function(e){var d=Kekule.OpenBabel.AdaptUtils;var f=Kekule.ObjUtils.getPrototypeOf(e).constructor.name;var g=(f==="OBReaction")?d.obReactionToKekule:(f==="OBMol")?d.obMolToKekule:(f==="OBAtom")?d.obAtomToKekule:(f==="OBBond")?d.obBondToKekule:d.obBaseToKekule;return g(e)},kObjToOB:function(f){var d=Kekule.OpenBabel.AdaptUtils;var e=(f instanceof Kekule.Reaction)?d.kReactionToOB:(f instanceof Kekule.StructureFragment)?d.kMolToOB:(f instanceof Kekule.ChemStructureNode)?d.kChemNodeToOB:(f instanceof Kekule.ChemStructureConnector)?d.kBondToOB:null;if(e){return e(f)}else{return null}},kIdToOB:function(e){var d=parseInt(e,10);if(d){return d}else{return null}},obBondOrderToKekule:function(d){if(d<=3){return d}else{if(d===Kekule.OpenBabel.BondOrder.EXPLICIT_AROMATIC){return Kekule.BondOrder.EXPLICIT_AROMATIC}else{return Kekule.BondOrder.OTHER}}},kBondOrderToOB:function(d){if(d<=3){return d}else{if(d===Kekule.BondOrder.EXPLICIT_AROMATIC){return Kekule.OpenBabel.BondOrder.EXPLICIT_AROMATIC}else{return 0}}},obBaseToKekule:function(n,e){var o=e||new Kekule.ChemObject();var g=new (a.getClassCtor("ObBaseHelper"))(n);var k=g.getTitle();if(k&&o.setName){o.setName(k)}var d=g.getDataSize();if(d){var f=o.getInfo(true);for(var j=0;j<d;++j){var h=g.getDataAt(j);if(h){var m=h.GetAttribute();var l=h.GetValue();if(m&&l){f[m]=l}}}}return o},kChemObjToOB:function(d,n){var o=n||new (a.getClassCtor("OBBase"))();if(d.getName&&o.SetTitle){o.SetTitle(d.getName())}var e=d.getInfo();if(e){var m=Kekule.ObjUtils.getOwnedFieldNames(e);for(var h=0,f=m.length;h<f;++h){var k=m[h];var j=e[k];if(k&&j){var g=new (a.getClassCtor("OBPairData"))();g.SetAttribute(""+k);g.SetValue(""+j);o.SetData(g)}}}},obAtomToKekule:function(i,h,g){var j=i.GetAtomicNum();var f=j?Kekule.Atom:Kekule.SubGroup;if(h&&(!(h instanceof f))){Kekule.Error(Kekule.$L("ErrorMsg.OpenBabel.CHEM_NODE_TYPE_NOT_SUITABLE"))}var d=h||new f();Kekule.OpenBabel.AdaptUtils.obBaseToKekule(i,d);var e;e=i.GetId();if(Kekule.ObjUtils.notUnset(e)){d.setId(Kekule.OpenBabel.AdaptUtils.DEF_ATOM_ID_PREFIX+e)}e=i.GetFormalCharge();if(e){d.setCharge(e)}e=i.GetSpinMultiplicity();if(e){d.setRadical(e)}e={x:i.GetX(),y:i.GetY()};if(g===Kekule.CoordMode.COORD3D){e.z=i.GetZ()}if(d.setAbsCoordOfMode){d.setAbsCoordOfMode(e,g)}else{d.setCoordOfMode(e,g)}if(d instanceof Kekule.Atom){if(j){d.setAtomicNumber(j)}e=i.GetIsotope();if(e){d.setMassNumber(e)}e=i.GetHyb();if(e){d.setHybridizationType(e)}}return d},kChemNodeToOB:function(k,l,h){var d=l||new (a.getClassCtor("OBAtom"))();var e;e=k.getId();e=Kekule.OpenBabel.AdaptUtils.kIdToOB(e);if(Kekule.ObjUtils.notUnset(e)){d.SetId(e)}e=k.getCharge();if(e){if(parseInt(e,10)===parseFloat(e)){d.SetFormalCharge(e)}else{var g=parseInt(e,10);var j=e-g;d.SetFormalCharge(g);d.SetPartialCharge(j)}}e=k.getRadical();if(e){d.SetSpinMultiplicity(e)}e=k.getAbsCoordOfMode?k.getAbsCoordOfMode(h):k.getCoordOfMode(h);d.SetVector(e.x||0,e.y||0,e.z||0);if(k instanceof Kekule.Atom){d.SetAtomicNum(k.getAtomicNumber());e=k.getMassNumber();if(e){d.SetIsotope(e)}e=k.getHybridizationType();if(e){d.SetHyb(e)}}else{d.SetAtomicNum(0)}return d},obBondToKekule:function(k,n,e){var o=n||new Kekule.Bond();Kekule.OpenBabel.AdaptUtils.obBaseToKekule(k,o);var m;m=k.GetId();if(Kekule.ObjUtils.notUnset(m)){o.setId(Kekule.OpenBabel.AdaptUtils.DEF_BOND_ID_PREFIX+m)}m=k.GetBondOrder();o.setBondOrder(Kekule.OpenBabel.AdaptUtils.obBondOrderToKekule(m));var f=Kekule.BondStereo;m=k.IsWedge()?f.UP:k.IsHash()?f.DOWN:k.IsWedgeOrHash()?f.UP_OR_DOWN:k.IsCisOrTrans()?f.CIS_OR_TRANS:k.IsDoubleBondGeometry()?f.E_Z_BY_COORDINATES:f.NONE;o.setStereo(m);if(e){m=null;var h=[k.GetBeginAtom(),k.GetEndAtom()];for(var g=0,d=h.length;g<d;++g){var j=h[g];if(j){m=e.get(j.GetIdx());if(m){o.appendConnectedObj(m)}}}}return o},kBondToOB:function(n,k,f,d){var p=k||new (a.getClassCtor("OBBond"))();Kekule.OpenBabel.AdaptUtils.kChemObjToOB(n,p);var m;m=Kekule.OpenBabel.AdaptUtils.kIdToOB(n.getId());if(Kekule.ObjUtils.notUnset(m)){p.SetId(m)}m=n.getBondOrder();if(m){p.SetBondOrder(Kekule.OpenBabel.AdaptUtils.kBondOrderToOB(m));if(m===Kekule.BondOrder.EXPLICIT_AROMATIC){p.SetAromatic()}}p.UnsetHash();p.UnsetWedge();p.UnsetUp();p.UnsetDown();p.UnsetAromatic();var j=Kekule.BondStereo;m=n.getStereo();if(m===j.UP){p.SetWedge()}else{if(m===j.DOWN){p.SetHash()}else{if(m===j.UP_OR_DOWN){p.SetWedgeOrHash()}}}if(f){var o=0;for(var h=0,e=n.getConnectedObjCount();h<e;++h){var g=n.getConnectedObjAt(h);if(g&&(g instanceof Kekule.ChemStructureNode)){var m=f.get(g);if(m){if(o===0){p.SetBegin(m)}else{if(o===1){p.SetEnd(m)}}++o}if(o>1){break}}}}return p},obMolToKekule:function(d,k){var o=k||new Kekule.Molecule();Kekule.OpenBabel.AdaptUtils.obBaseToKekule(d,o);var f=d.Has3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;o.clearNodes();o.clearConnectors();var g=new Kekule.MapEx(true);var l=d.NumAtoms();for(var j=0;j<l;++j){var h=d.GetAtom(j+1);if(h){var e=Kekule.OpenBabel.AdaptUtils.obAtomToKekule(h,null,f);if(e){o.appendNode(e);g.set(h.GetIdx(),e)}}}var l=d.NumBonds();for(var j=0;j<l;++j){var m=d.GetBond(j);if(m){var n=Kekule.OpenBabel.AdaptUtils.obBondToKekule(m,null,g);if(n){o.appendConnector(n)}}}g.finalize();g=null;return o},kMolToOB:function(m,d){var g=m.nodesHasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;var p=d||new (a.getClassCtor("OBMol"))();if(d){p.Clear()}var h=new Kekule.MapEx(false);for(var k=0,f=m.getNodeCount();k<f;++k){var e=m.getNodeAt(k);if(e){var j=Kekule.OpenBabel.AdaptUtils.kChemNodeToOB(e,p.NewAtom(),g);if(j){h.set(e,j)}}}for(var k=0,f=m.getConnectorCount();k<f;++k){var o=m.getConnectorAt(k);if(o&&(o instanceof Kekule.Bond)){var n=Kekule.OpenBabel.AdaptUtils.kBondToOB(o,p.NewBond(),h,p)}}h.finalize();h=null;return p},obReactionToKekule:function(k,h){var d=h||new Kekule.Reaction();d.clearAll();Kekule.OpenBabel.AdaptUtils.obBaseToKekule(k,d);d.setDirection(k.IsReversible()?Kekule.ReactionDirection.BIDIRECTION:Kekule.ReactionDirection.FORWARD);for(var j=0,g=k.NumReactants();j<g;++j){var f=k.GetReactant(j);var e=Kekule.OpenBabel.AdaptUtils.obMolToKekule(f);d.appendReactant(e)}for(var j=0,g=k.NumProducts();j<g;++j){var f=k.GetProduct(j);var e=Kekule.OpenBabel.AdaptUtils.obMolToKekule(f);d.appendProduct(e)}return d},kReactionToOB:function(k,f){var n=f||new (a.getClassCtor("OBReaction"))();n.Clear();Kekule.OpenBabel.AdaptUtils.kChemObjToOB(k,n);var d=false;var m=k.getDirection();if(m===Kekule.ReactionDirection.BIDIRECTION){n.SetReversible(true)}else{if(m===Kekule.ReactionDirection.BACKWARD){d=true}}for(var h=0,g=k.getReactantCount();h<g;++h){var j=k.getReactantAt(h);if(j){var e=Kekule.OpenBabel.AdaptUtils.kMolToOB(j);if(d){n.AddProduct(e)}else{n.AddReactant(e)}}}for(var h=0,g=k.getProductCount();h<g;++h){var j=k.getProductAt(h);if(j){var e=Kekule.OpenBabel.AdaptUtils.kMolToOB(j);if(d){n.AddReactant(e)}else{n.AddProduct(e)}}}}}})();(function(){var c=Kekule.EmscriptenUtils;var b=Kekule.OpenBabel;var a=Kekule.OpenBabel.AdaptUtils;Kekule.IO.OpenBabelReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.OpenBabelReader",initialize:function($super,d){$super()},finalize:function($super){$super()},getFormatTargetObClassName:function(d){var f=d.getTypeName();var e=(f.toLowerCase().indexOf("reaction")>=0);return e?"OBReaction":"OBMol"},doReadData:function(k,n,o){this._obConv=new (b.getClassCtor("ObConversionWrapper"))();try{var m=Kekule.IO.DataFormatsManager.getFormatInfo(o);var d=m.mimeType;var r=m.fileExts[0];var f=this._obConv.setInFormat(d,r);var h=this.getFormatTargetObClassName(f);try{var l=[];this._obConv.setInStr(k);var g=new (b.getClassCtor(h))();var p=this._obConv.readFromInput(g);while(p){if(g.NumAtoms&&(g.NumAtoms()>0)){kObj=a.obObjToKekule(g);l.push(kObj)}p=this._obConv.readFromInput(g)}var e=l.length;if(e<=0){return null}else{if(e===1){return l[0]}else{var q=new Kekule.ChemObjList();for(var j=0;j<e;++j){q.append(l[j])}return q}}}finally{if(g){g["delete"]();g=null}}}finally{if(this._obConv){this._obConv["delete"]();this._obConv=null}}}});Kekule.IO.OpenBabelWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.OpenBabelWriter",initialize:function($super,d){$super(d)},finalize:function($super){$super()},doWriteData:function(g,n,o){this._obConv=new (b.getClassCtor("ObConversionWrapper"))();try{var m=Kekule.IO.DataFormatsManager.getFormatInfo(o);var d=m.mimeType;var r=m.fileExts[0];this._obConv.setOutFormat(d,r);var j=Kekule.ChemStructureUtils.getChildStructureObjs(g,true);for(var h=0,f=j.length;h<f;++h){var k=j[h];if(k){var e=a.kObjToOB(k);if(e){try{var p=this._obConv.writeToOutput(e);if(!p){break}}finally{e["delete"]();e=null}}}}var q=this._obConv.getOutStr();return q}finally{if(this._obConv){this._obConv["delete"]()}}},isAllowedObj:function(d){var e=Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES;return Kekule.ObjUtils.isInstanceOf(d,e)}});Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES=[Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.OpenBabel.IORegHelper=Class.create({listFormatInfo:function(n,j){var r=[];var d="\n";var g="--";var k;if(n==="in"){k=j.getSupportedInputFormatsStr(d)}else{k=j.getSupportedOutputFormatsStr(d)}var o=k.split(d);for(var m=0,h=o.length;m<h;++m){var q=o[m];var p=q.indexOf(g);if(p>0){var e=q.substring(0,p).trim();var f=j.getFormatInfoById(e);r.push(f)}}return r},registerByInfos:function(q,p){var o=Kekule.IO.DataFormatsManager;var m=[];for(var n=0,j=q.length;n<j;++n){var h=q[n];var e=h.id;var d=h.mimeType;var f=o.findFormatId(d);if(f){f=o.findFormatId(null,e)}if(!f){var g=o.register(e,d,e,Kekule.IO.ChemDataType.UNKNOWN,h.description,h.description,{specificationUrl:h.specificationURL});var f=g.id}var k=(p==="in")?Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(f):Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(f);if(!k){Kekule.ArrayUtils.pushUnique(m,f)}}if(m.length){if(p==="in"){Kekule.IO.ChemDataReaderManager.register("openbabel",Kekule.IO.OpenBabelReader,m)}else{Kekule.IO.ChemDataWriterManager.register("openbabel",Kekule.IO.OpenBabelWriter,Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES,m)}}},registerAll:function(){var d=new (b.getClassCtor("ObConversionWrapper"))();try{var e=this.listFormatInfo("in",d);this.registerByInfos(e,"in");var e=this.listFormatInfo("out",d);this.registerByInfos(e,"out")}finally{d["delete"]()}}});Kekule.IO.registerAllOpenBabelFormats=function(){if(Kekule.OpenBabel.AdaptUtils.isAvailable()){try{var d=new Kekule.OpenBabel.IORegHelper();d.registerAll()}finally{d=null}}};Kekule.OpenBabel._enableFuncs.push(Kekule.IO.registerAllOpenBabelFormats);Kekule.IO.enableOpenBabelFormats=function(){if(!Kekule.OpenBabel.AdaptUtils.isAvailable()){Kekule.OpenBabel.loadObScript(document,function(){Kekule.IO.registerAllOpenBabelFormats()})}else{Kekule.IO.registerAllOpenBabelFormats()}};(function(){})()})();(function(){var c=Kekule.EmscriptenUtils;var b=Kekule.OpenBabel;var a=Kekule.OpenBabel.AdaptUtils;Kekule.OpenBabel.StructUtils={generate3DStructure:function(g,f){var h=new (b.getClassCtor("OB3DGenWrapper"))();try{var e=Kekule.IO.saveMimeData(g,"chemical/x-mdl-molfile");try{var d=h.generate3DStructureFromMolData(e,f||"");if(!d){Kekule.raise(Kekule.$L("ErrorMsg.OpenBabel.FAIL_TO_GENERATE_3D_STRUCTURE"))}else{var i=a.obObjToKekule(d)}d["delete"]()}finally{}}finally{h["delete"]()}return i}};if(Kekule.Calculator){Kekule.Calculator.ObStructure3DGenerator=Class.create(Kekule.Calculator.AbstractStructure3DGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructure3DGenerator",getObInitOptions:function(){return Kekule.OpenBabel.getObInitOptions()},getForceField:function(){return this.getOptions().forceField},createWorker:function($super){var d=$super();if(d){var e=Kekule.OpenBabel.getObScriptUrl();this.importWorkerScriptFile(e);var f=this.getObInitOptions();this.postWorkerMessage({type:"obInit",usingModulaize:f.usingModulaize,moduleName:f.moduleName})}return d},getWorkerScriptFile:function(){var d=Kekule.OpenBabel.getObPath()+"workers/kekule.worker.obStructure3DGenerator.js";return d},doReactWorkerMessage:function($super,f,h){$super(f,h);if(f.type==="output3D"){var g=f.molData;if(g){var d=Kekule.IO.loadMimeData(g,"chemical/x-mdl-molfile");this.setGeneratedMol(d);this.done()}}},workerStartCalc:function(f){var e=this.getSourceMol();var d=Kekule.IO.saveMimeData(e,"chemical/x-mdl-molfile");this.postWorkerMessage({type:"gen3D",molData:d,forceField:this.getForceField()})},executeSync:function(e){if(Kekule.OpenBabel&&document){var d=this;Kekule.OpenBabel.loadObScript(document,function(){var f;try{var g=Kekule.OpenBabel.StructUtils.generate3DStructure(d.getSourceMol(),d.getForceField());d.setGeneratedMol(g)}catch(h){f=h}if(e){e(f)}})}else{Kekule.error(Kekule.$L("ErrorMsg.MODULE_NOT_LOADED").format("OpenBabel"))}return false}});Kekule.Calculator.ServiceManager.register(Kekule.Calculator.Services.GEN3D,Kekule.Calculator.ObStructure3DGenerator)}})();(function(c){var b=Kekule.EmscriptenUtils;var a={usingModulaize:true,moduleName:"IndigoModule",indigoAdaptFuncName:"CreateIndigo"};Kekule.Indigo={_autoEnabled:true,_module:null,_indigo:null,SCRIPT_FILE:"indigo.js",HELPER_SCRIPT_FILE:"indigoAdapter.js",_enableFuncs:[],isScriptLoaded:function(){return b.isSupported(a.moduleName)&&(typeof(c[a.indigoAdaptFuncName])!=="undefined")},getModule:function(){if(!d._module){d._module=b.getRootModule(a.moduleName)}return d._module},getIndigo:function(){if(!d._indigo){var e=d.getModule();if(e){d._indigo=(c[a.indigoAdaptFuncName])(e)}}return d._indigo},getClassCtor:function(e){return b.getClassCtor(e,d.getModule())},isAvailable:function(){return d.getModule()&&d.getIndigo()},enable:function(e){if(!d.isScriptLoaded()){d.loadIndigoScript(document,function(){d._enableAllFunctions();if(e){e()}})}else{d._enableAllFunctions();if(e){e()}}},_enableAllFunctions:function(){if(d.isScriptLoaded()){var f=d._enableFuncs;for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h){h()}}}}};Kekule.Indigo.getIndigoPath=function(){var f=Kekule.scriptSrcInfo.useMinFile;var e=f?"extra/":"_extras/Indigo/";e=Kekule.scriptSrcInfo.path+e;return e};Kekule.Indigo.getIndigoScriptUrl=function(){var e=d.getIndigoPath()+d.SCRIPT_FILE;var f=Kekule.scriptSrcInfo.useMinFile;if(!f){e+=".dev"}return e};Kekule.Indigo.getIndigoHelperScriptUrl=function(){var e=d.getIndigoPath()+d.HELPER_SCRIPT_FILE;return e};Kekule.Indigo.loadIndigoScript=function(g,h){if(!g){g=document}var e=function(){Kekule.Indigo.getIndigo();if(h){h()}};if(!d._scriptLoadedBySelf&&!d.isScriptLoaded()){var f=[d.getIndigoScriptUrl(),d.getIndigoHelperScriptUrl()];Kekule.ScriptFileUtils.appendScriptFiles(g,f,e);d._scriptLoadedBySelf=true}else{d._scriptLoadedBySelf=true;if(h){h()}}};var d=Kekule.Indigo;Kekule.Indigo.AdaptUtils={};Kekule._registerAfterLoadSysProc(function(){if(d._autoEnabled){d._enableAllFunctions()}})})(this);(function(){var a=Kekule.EmscriptenUtils;var b=Kekule.Indigo;Kekule.IO.IndigoReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.InChIWriter",doReadData:function(h,d,i){var g=b.getIndigo();var f=g.loadMoleculeFromString(h);if(f>=0){if(i===Kekule.IO.DataFormat.SMILES){g.setOption("smart-layout","true");g.layout(f)}var e=g.molfile(f);g.free(f);var c=Kekule.IO.loadFormatData(e,Kekule.IO.DataFormat.MOL);return c}else{return null}}});Kekule.IO.registerAllIndigoFormats=function(){if(b.isAvailable()){Kekule.IO.ChemDataReaderManager.register("Indigo-smiles",Kekule.IO.IndigoReader,Kekule.IO.DataFormat.SMILES)}};Kekule.IO.enableIndigoFormats=function(){if(!b.isAvailable()){b.loadIndigoScript(document,function(){Kekule.IO.registerAllIndigoFormats()})}else{Kekule.IO.registerAllIndigoFormats()}};b._enableFuncs.push(Kekule.IO.registerAllIndigoFormats)})();(function(){var c=Kekule.EmscriptenUtils;var a={usingModulaize:true,moduleName:"InChIModule"};Kekule.InChI={_autoEnabled:true,_scriptLoadedBySelf:false,_module:null,_enableFuncs:[],SCRIPT_FILE:"inchi.js",isScriptLoaded:function(){return c.isSupported(a.moduleName)},getModule:function(){if(!b._module){b._module=c.getRootModule(a.moduleName)}return b._module},getInChIPath:function(){var e=Kekule.scriptSrcInfo.useMinFile;var d=e?"extra/":"_extras/InChI/";d=Kekule.scriptSrcInfo.path+d;return d},getInChIScriptUrl:function(){var d=b.getInChIPath()+b.SCRIPT_FILE;var e=Kekule.scriptSrcInfo.useMinFile;if(!e){d+=".dev"}return d},loadInChIScript:function(e,f){if(!e){e=document}if(!b.isScriptLoaded()&&!b._scriptLoadedBySelf){var d=b.getInChIScriptUrl();c.loadScript(d,f,e);b._scriptLoadedBySelf=true}else{b._scriptLoadedBySelf=true;if(f){f()}}},molDataToInChI:function(f,e){var g=b._molToInChI;if(!g){g=b.getModule().cwrap("molToInchiJson","string",["string","string"])}var d=g(f,e);return JSON.parse(d)},getInChIInfo:function(d){var e=Kekule.IO.saveFormatData(d,Kekule.IO.DataFormat.MOL);var f=b.molDataToInChI(e);return f},enable:function(d){if(!b.isScriptLoaded()){b.loadInChIScript(document,function(){b._enableAllFunctions();if(d){d()}})}else{b._enableAllFunctions();if(d){d()}}},_enableAllFunctions:function(){if(b.isScriptLoaded()){var e=b._enableFuncs;for(var f=0,d=e.length;f<d;++f){var g=e[f];if(g){g()}}}}};var b=Kekule.InChI;Kekule.IO.InChIWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.InChIWriter",doWriteData:function(h,e,g){var f=b.getInChIInfo(h);if(f&&f.inchi){var d=f.inchi;if(f.auxInfo){d+="\n"+f.auxInfo}return d}else{return null}},isAllowedObj:function(e){var d=Kekule.IO.InChIWriter.ALLOWED_CLASSES;return Kekule.ObjUtils.isInstanceOf(e,d)}});Kekule.IO.InChIWriter.ALLOWED_CLASSES=[Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.registerAllInChIFormats=function(){if(b.isScriptLoaded()){var d="inchi";Kekule.IO.DataFormat.INCHI=d;Kekule.IO.MimeType.INCHI="chemical/x-inchi";Kekule.IO.DataFormatsManager.register(d,Kekule.IO.MimeType.INCHI,"inchi",Kekule.IO.ChemDataType.TEXT,"InChI format");Kekule.IO.ChemDataWriterManager.register("inchi",Kekule.IO.InChIWriter,Kekule.IO.InChIWriter.ALLOWED_CLASSES,d)}};Kekule.IO.enableInChIFormats=function(){b.enable()};b._enableFuncs.push(Kekule.IO.registerAllInChIFormats);Kekule._registerAfterLoadProc(function(){if(b._autoEnabled){b._enableAllFunctions()}})})();if(this.Kekule){Kekule._loaded()};